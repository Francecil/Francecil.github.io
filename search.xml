<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>ä»ã€Œæ¶ˆå¤±çš„ 1 åƒç²‰ä¸ã€è°ˆåŠ toFixed çš„å‘</title>
    <url>/2020/06/14/2020/%E4%BB%8E%E3%80%8C%E6%B6%88%E5%A4%B1%E7%9A%84%201%20%E5%8D%83%E7%B2%89%E4%B8%9D%E3%80%8D%E8%B0%88%E5%8F%8A%20toFixed%20%E7%9A%84%E5%9D%91/</url>
    <content><![CDATA[<h2 id="æ•…äº‹æ˜¯è¿™æ ·çš„"><a href="#æ•…äº‹æ˜¯è¿™æ ·çš„" class="headerlink" title="æ•…äº‹æ˜¯è¿™æ ·çš„"></a>æ•…äº‹æ˜¯è¿™æ ·çš„</h2><p>å°éƒ‘æ˜¯æŸå¹³å°ä¸€ä½ UP ğŸ·ï¼Œç»è¿‡ä¸¤å¹´åŠªåŠ›ç°åœ¨å¹³å°ç²‰ä¸ä¹Ÿæœ‰ 994500 ä¸ªäº†ï¼Œè·ç¦»å†²å‡»ç™¾ä¸‡ UP ä»…å‰©ä¸€æ­¥ä¹‹é¥ã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/9277731-4c8db063ccdf1ca1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="99.45w"></p>
<p>é‡‘ä¸»çˆ¸çˆ¸å‘Šè¯‰ä»–ï¼Œåªè¦ç™¾ä¸‡ï¼Œå°±è®©ä»–æ¥ä¸ªå¤§çš„å¹¿å‘Šå•ã€‚</p>
<p>å¥ˆä½•æœ€è¿‘æ²¡æœ‰çµæ„Ÿï¼Œå¤©å¤©ğŸ•Šï¼Œå§‹ç»ˆä¸æ¶¨ç²‰ã€‚</p>
<p>äºæ˜¯ä»–ä¾¿æ‰“èµ·äº†æ­ªä¸»æ„ï¼Œä¹°ç²‰ï¼å…ˆåˆ°æŸå®ä¸Šä¹°äº† 1 åƒç²‰ä¸è¯•è¯•æ°´ï¼Œå¾ˆå¿«ï¼Œå¯¹æ–¹è¯´å·²åˆ°è´¦ã€‚</p>
<p>å°éƒ‘å…´å†²å†²çš„ä¸Šå¹³å°ä¸Šä¸€çœ‹ï¼Œå¹¶æ²¡æœ‰ï¼Œè¿˜æ˜¯æ˜¾ç¤ºçš„ <code>99.5</code> ï¼Œ1 åƒä¸ªç²‰ä¸å»å“ªäº†ï¼Ÿï¼Ÿ</p>
<a id="more"></a>

<p>æ­£å‡†å¤‡æŠ•è¯‰å•†å®¶æ—¶ï¼Œé¼ æ ‡ä¸‹æ»‘çœ‹åˆ°äº†è¿™æ ·çš„ä¸€å¹•ï¼</p>
<p><img src="https://upload-images.jianshu.io/upload_images/9277731-4790996ca7d0b42f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="99.55w"></p>
<p>å…·ä½“ç²‰ä¸æ•°ç¡®å®æ˜¯æ­£ç¡®çš„ï¼ŒæŒ‰ç…§å°å­¦æ•™çš„çš„å››èˆäº”å…¥ï¼Œåº”è¯¥æ˜¾ç¤º <code>99.6ä¸‡</code> æ‰å¯¹ã€‚</p>
<p>éš¾é“æ˜¯å¹³å°çš„ bug ?ä¸è§£çš„å°éƒ‘æ‰“ç®—å‘ç¨‹åºå‘˜æœ‹å‹å°ç›–è¯¢é—®ï¼Œå°ç›–ä¸€çœ‹ï¼š</p>
<p>ã€Œ è¿™åº”è¯¥æ˜¯ç”¨äº† toFixed äº†å§ï¼Œè¿™æ–¹æ³•æœ‰ä¸ªå‘ã€‚ã€‚å®¹æˆ‘ç»†ç»†é“æ¥ ã€</p>
<blockquote>
<p>ä»¥ä¸Šæ•…äº‹çº¯å±è™šæ„ï¼ˆåŒ…æ‹¬å›¾ç‰‡ï¼‰</p>
</blockquote>
<h2 id="toFixed-æ˜¯ä»€ä¹ˆ"><a href="#toFixed-æ˜¯ä»€ä¹ˆ" class="headerlink" title="toFixed æ˜¯ä»€ä¹ˆ"></a>toFixed æ˜¯ä»€ä¹ˆ</h2><p>ä»¥ä¸‹å¼•è‡ª <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Number/toFixed" target="_blank" rel="noopener">MDN</a> çš„å®šä¹‰</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">numObj.toFixed(digits)</span><br></pre></td></tr></table></figure>

<p>è¿”å›æŒ‡å®š digits ä½æ•°çš„å­—ç¬¦ä¸²ï¼Œå¿…è¦æ—¶ä¼šè¿›è¡Œå››èˆäº”å…¥ã€‚çœ‹ä»¥ä¸‹ä¾‹å­</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="number">99.45</span>.toFixed(<span class="number">1</span>);   <span class="comment">// "99.5"</span></span><br><span class="line"><span class="number">99.99</span>.toFixed(<span class="number">1</span>);   <span class="comment">// "100.0"</span></span><br><span class="line"><span class="number">99.55</span>.toFixed(<span class="number">1</span>);   <span class="comment">// "99.5" warning: è§ä¸‹é¢è§£é‡Š</span></span><br></pre></td></tr></table></figure>

<p>æ˜¯ä¸æ˜¯å‘ç°ç¬¬ä¸‰ä¸ªä¾‹å­ä¸å¤ªå¯¹ï¼Ÿ</p>
<p>æˆ‘ä»¬çŸ¥é“ï¼Œjs ä¸­çš„æµ®ç‚¹æ•°å†…éƒ¨æ˜¯ç”¨åŒç²¾åº¦ 64ä½ï¼ˆdoubleï¼‰è¡¨ç¤ºçš„ï¼Œé‡‡ç”¨çš„æ˜¯ <a href="https://en.wikipedia.org/wiki/IEEE_754" target="_blank" rel="noopener">IEEE 754 è¡¨ç¤ºæ³•</a>ï¼Œ</p>
<p>æ‰€ä»¥ <code>99.55</code> å®é™…æ˜¯ <code>99.549999999999997</code></p>
<blockquote>
<p>ç½‘ä¸Šæœ‰<a href="https://www.binaryconvert.com/convert_double.html?decimal=057057046053053" target="_blank" rel="noopener">åœ¨çº¿å·¥å…·</a>å¯ä»¥ç›´æ¥ç®—å‡ºæ¥</p>
</blockquote>
<p>é‚£ä¹ˆå¾ˆæ˜æ˜¾å¯ä»¥çœ‹å‡ºæ¥ç­”æ¡ˆï¼Œå››èˆäº”å…¥ç»“æœå°±æ˜¯ <code>99.5</code> </p>
<p>soï¼Œå¾—åˆ°ç­”æ¡ˆäº†ï¼Œæœ¬æ–‡ç»“æŸ?</p>
<p>æˆ‘ä»¬å†çœ‹ä¸‹ ecmascript è§„èŒƒæ˜¯æ€ä¹ˆæè¿°çš„</p>
<p><a href="http://www.ecma-international.org/ecma-262/6.0/#sec-number.prototype.tofixed" target="_blank" rel="noopener">Number.prototype.toFixed ( fractionDigits )</a></p>
<p><img src="https://upload-images.jianshu.io/upload_images/9277731-b6ba435aed1e5c67.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="toFixed"></p>
<p>å…³é”®çœ‹çº¢è‰²åŒºåŸŸï¼Œæˆ‘ä»¬éœ€è¦æ‰¾ä¸ªä¸€ä¸ª n ï¼Œä½¿å…¶ <code>n / 10 - 99.55</code> å°½å¯èƒ½æ¥è¿‘é›¶ã€‚ æ‰¾åˆ° n ä¹‹ååé¢çš„ç»“æœå°±éƒ½ç¡®å®šäº†ã€‚</p>
<p>ï¼ˆé¢ï¼Œçœ‹èµ·æ¥å¥½åƒå¾ˆå¤æ‚çš„æ ·å­ï¼Œä¸æ˜¯ç›´æ¥å¯¹å°æ•°ä½å››èˆäº”å…¥ã€‚ã€‚ï¼‰</p>
<p>å‡è®¾ n ä¸º 995,åˆ™ m ä¸º â€œ995â€, k = m.length = 3, a = â€œ99â€, b = â€œ5â€, æœ€ç»ˆç»“æœä¸º â€œ99.5â€</p>
<p>é‚£ä¹ˆ n æ˜¯ä¸æ˜¯ 995 å‘¢ï¼Ÿ</p>
<p>æ»¡è¶³ <code>n / 10 - 99.55</code> å°½å¯èƒ½æ¥è¿‘é›¶è¿™ä¸ªæ¡ä»¶çš„æœ‰ä¸¤ä¸ªæ•°ï¼š 995,996 è€Œä»–ä»¬çš„è®¡ç®—ç»“æœåˆ†åˆ«ä¸ºï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="number">995</span>/<span class="number">10</span> - <span class="number">99.55</span> <span class="comment">// -0.04999999999999716</span></span><br><span class="line"><span class="number">996</span>/<span class="number">10</span> - <span class="number">99.55</span> <span class="comment">//  0.04999999999999716</span></span><br></pre></td></tr></table></figure>

<p>å’Œ 0 é—´çš„å·®å€¼æ˜¯ä¸€æ ·çš„ï¼Œé€‰å¤§çš„ç»“æœæ˜¯ 996 ï¼Œå¯æˆ‘ä»¬è¿è¡Œçš„ç»“æœå´æ˜¯ 99.5 ï¼Œè¿™åˆæ˜¯ä¸ºä½•ï¼Ÿéš¾é“æµè§ˆå™¨å¼•æ“çš„å®ç°æœ‰è¯¯ï¼Ÿæˆ–è€…æ²¡æŒ‰è§„èŒƒå®ç°ï¼Ÿ</p>
<p>å¯¹æ¯”äº†å‡ ä¸ªå¼•æ“ï¼Œç»“æœéƒ½æ˜¯ 995ï¼Œæˆ‘ä»¬å…ˆçœ‹ä¸€å“ˆ JavaScriptCore (Webkit çš„ js å¼•æ“) å®ç°</p>
<h2 id="JavaScriptCore-toFixed-æºç "><a href="#JavaScriptCore-toFixed-æºç " class="headerlink" title="JavaScriptCore toFixed æºç "></a>JavaScriptCore toFixed æºç </h2><p>æºç åœ¨ <code>webkit/Source/JavaScriptCore/runtime/NumberPrototype.cpp</code> ä¸­çš„ numberProtoFuncToFixed æ–¹æ³•</p>
<p>åœ¨ JavaScriptCore ä¸­ï¼ŒåŸå‹æ–¹æ³•å¾ˆå¥½æ‰¾ï¼Œå°±æ˜¯ xxxProtoFuncXxx çš„ç»“æ„</p>
<h3 id="è°ƒè¯•ç¯å¢ƒ"><a href="#è°ƒè¯•ç¯å¢ƒ" class="headerlink" title="è°ƒè¯•ç¯å¢ƒ"></a>è°ƒè¯•ç¯å¢ƒ</h3><p>ï¼ˆæœ¬å°ç»“å¯ä»¥é€‰æ‹©ç•¥è¿‡ï¼Œç›´æ¥çœ‹åé¢çš„åˆ†æå’Œå°ç»“ï¼‰</p>
<p>åœ¨ macOS ä¸Šç¼–è¯‘ webkit æ¯” v8 ç®€å•å¤šäº†ï¼Œè¯¦è§ <a href="https://liveoverflow.com/setup-and-debug-javascriptcore-webkit-browser-0x01/" target="_blank" rel="noopener">Setup and Debug JavaScriptCore / WebKit</a></p>
<p>é€šè¿‡ä»¥ä¸‹å‘½ä»¤è¿›å…¥ debug ç¯å¢ƒ</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åˆ©ç”¨ lldb è°ƒè¯• jsc</span></span><br><span class="line">$ lldb ./WebKitBuild/Debug/bin/jsc</span><br><span class="line"><span class="comment"># å¼€å§‹è°ƒè¯•</span></span><br><span class="line">(lldb) run</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="comment"># control + c å†æ¬¡è¿›å…¥ lldb</span></span><br><span class="line"><span class="comment"># æ‰“æ–­ç‚¹, æ–­ç‚¹æ–¹æ³•è¾“å‡ ä¸ªå­—ç¬¦æŒ‰ Tab å°±å¯ä»¥å‡ºæç¤ºäº†</span></span><br><span class="line">(lldb): b JSC::numberProtoFuncToFixed(JSC::JSGlobalObject*, JSC::CallFrame*)</span><br><span class="line">(lldb): b WTF::double_conversion::FastFixedDtoa(double, int, WTF::double_conversion::BufferReference&lt;char&gt;, int*, int*) </span><br><span class="line"><span class="comment"># ç»“æŸè°ƒè¯•ï¼Œåˆ‡åˆ° jsc, éœ€è¦æŒ‰ 2æ¬¡å›è½¦</span></span><br><span class="line">(lldb): c</span><br><span class="line"><span class="comment"># è¾“å…¥ js ä»£ç ï¼Œå›è½¦è¿›å…¥ lldb è°ƒè¯•ç¯å¢ƒ</span></span><br><span class="line">&gt;&gt;&gt; 99.55.toFixed(1)</span><br><span class="line"><span class="comment"># EncodedJSValue JSC_HOST_CALL numberProtoFuncToFixed(JSGlobalObject* globalObject, CallFrame* callFrame)</span></span><br></pre></td></tr></table></figure>

<p>jsc å¸¸ç”¨æŒ‡ä»¤</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">describe(x) <span class="comment">#æŸ¥çœ‹å¯¹è±¡ï¼ˆjsåœ¨ c ä¸­å‡ä¸ºå¯¹è±¡ï¼‰ çš„å†…éƒ¨æè¿°ï¼Œç»“æ„ï¼Œå†…å­˜åœ°å€</span></span><br></pre></td></tr></table></figure>

<p>lldb å¸¸ç”¨æŒ‡ä»¤</p>
<blockquote>
<p>å¢å¼ºæ’ä»¶ chisel ï¼Œæ›´å¤šä½¿ç”¨æ–¹æ³•åç»­å†™ä¸€ç¯‡æ–‡ç« ï¼Œ</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">x/8gx address <span class="comment">#æŸ¥çœ‹å†…å­˜åœ°å€ address</span></span><br><span class="line"></span><br><span class="line">next(n) <span class="comment">#å•æ­¥æ‰§è¡Œ</span></span><br><span class="line">step(s) <span class="comment">#è¿›å…¥å‡½æ•°</span></span><br><span class="line"><span class="built_in">continue</span>(c) <span class="comment">#å°†ç¨‹åºè¿è¡Œåˆ°ç»“æŸæˆ–è€…æ–­ç‚¹å¤„ï¼ˆè¿›å…¥ä¸‹ä¸€æ–­ç‚¹ï¼‰</span></span><br><span class="line">finish <span class="comment">#å°†ç¨‹åºè¿è¡Œåˆ°å½“å‰å‡½æ•°è¿”å›ï¼ˆä»å‡½æ•°è·³å‡ºï¼‰</span></span><br><span class="line">breakpoint(b) è¡Œå·/å‡½æ•°å &lt;æ¡ä»¶è¯­å¥&gt; <span class="comment">#è®¾ç½®æ–­ç‚¹</span></span><br><span class="line">fr v <span class="comment">#æŸ¥çœ‹å±€éƒ¨å˜é‡ä¿¡æ¯</span></span><br><span class="line"><span class="built_in">print</span>(p) x <span class="comment">#è¾“å‡ºå˜é‡ x çš„å€¼</span></span><br></pre></td></tr></table></figure>

<h3 id="æºç åˆ†æ"><a href="#æºç åˆ†æ" class="headerlink" title="æºç åˆ†æ"></a>æºç åˆ†æ</h3><p>å…¥å£ï¼Œå„ç§æƒ…å†µçš„å¤„ç†</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="function">EncodedJSValue JSC_HOST_CALL <span class="title">numberProtoFuncToFixed</span><span class="params">(JSGlobalObject* globalObject, CallFrame* callFrame)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    VM&amp; vm = globalObject-&gt;vm();</span><br><span class="line">    <span class="keyword">auto</span> scope = DECLARE_THROW_SCOPE(vm);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// x å–å€¼ 99.549999999999997</span></span><br><span class="line">    <span class="keyword">double</span> x;</span><br><span class="line">    <span class="keyword">if</span> (!toThisNumber(vm, callFrame-&gt;thisValue(), x))</span><br><span class="line">        <span class="keyword">return</span> throwVMToThisNumberError(globalObject, scope, callFrame-&gt;thisValue());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// decimalPlaces å–å€¼ 1</span></span><br><span class="line">    <span class="keyword">int</span> decimalPlaces = <span class="keyword">static_cast</span>&lt;<span class="keyword">int</span>&gt;(callFrame-&gt;argument(<span class="number">0</span>).toInteger(globalObject));</span><br><span class="line">    RETURN_IF_EXCEPTION(scope, &#123; &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç‰¹æ®Šå¤„ç†ï¼Œç•¥</span></span><br><span class="line">    <span class="keyword">if</span> (decimalPlaces &lt; <span class="number">0</span> || decimalPlaces &gt; <span class="number">100</span>)</span><br><span class="line">        <span class="keyword">return</span> throwVMRangeError(globalObject, scope, <span class="string">"toFixed() argument must be between 0 and 100"</span>_s);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// x çš„ç‰¹æ®Šå¤„ç†ï¼Œç•¥</span></span><br><span class="line">    <span class="keyword">if</span> (!(<span class="built_in">fabs</span>(x) &lt; <span class="number">1e+21</span>))</span><br><span class="line">        <span class="keyword">return</span> JSValue::encode(jsString(vm, <span class="keyword">String</span>::number(x)));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// NaN or Infinity çš„ç‰¹æ®Šå¤„ç†</span></span><br><span class="line">    ASSERT(<span class="built_in">std</span>::isfinite(x));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿›å…¥æ‰§è¡Œ number=99.549999999999997, decimalPlaces=1</span></span><br><span class="line">    <span class="keyword">return</span> JSValue::encode(jsString(vm, <span class="keyword">String</span>::numberToStringFixedWidth(x, decimalPlaces)));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä» numberToStringFixedWidth æ–¹æ³•ä¸æ–­è¿›å…¥ï¼Œåˆ°è¾¾ FastFixedDtoa å¤„ç†æ–¹æ³•</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒåŸæ•°å€¼çš„æ•´æ•°å’Œå°æ•°éƒ¨åˆ†éƒ½åˆ†åˆ«é‡‡ç”¨äº†æŒ‡æ•°è¡¨ç¤ºæ³•ï¼Œæ–¹ä¾¿åé¢ä½è¿ç®—å¤„ç†</p>
<p><code>99.549999999999997 = 7005208482886451 * 2 ** -46
= 99 + 38702809297715 * 2 ** -46</code></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// FastFixedDtoa(v=99.549999999999997, fractional_count=1, buffer=(start_ = "", length_ = 122), length=0x00007ffeefbfd488, decimal_point=0x00007ffeefbfd494)</span></span><br><span class="line"></span><br><span class="line">bool FastFixedDtoa(double v,</span><br><span class="line">                   int fractional_count,</span><br><span class="line">                   BufferReference&lt;char&gt; buffer,</span><br><span class="line">                   int* length,</span><br><span class="line">                   int* decimal_point) &#123;</span><br><span class="line">  <span class="keyword">const</span> uint32_t kMaxUInt32 = <span class="number">0xFFFFFFFF</span>;</span><br><span class="line">  <span class="comment">// å°† v è¡¨ç¤ºæˆ å°¾æ•°(significand) Ã— åº•æ•°(2) ^ æŒ‡æ•°(exponent) </span></span><br><span class="line">  <span class="comment">// 7005208482886451 x 2 ^ -46</span></span><br><span class="line">  uint64_t significand = Double(v).Significand();</span><br><span class="line">  int exponent = Double(v).Exponent();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// çœç•¥éƒ¨åˆ†ä»£ç </span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (exponent + kDoubleSignificandSize &gt; <span class="number">64</span>) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (exponent &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (exponent &gt; -kDoubleSignificandSize) &#123;</span><br><span class="line">    <span class="comment">// exponent &gt; -53 çš„æƒ…å†µ, åˆ‡å‰²æ•°å­—</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ•´æ•°éƒ¨åˆ†: integrals = 7005208482886451 &gt;&gt; 46 = 99 </span></span><br><span class="line">    uint64_t integrals = significand &gt;&gt; -exponent;</span><br><span class="line">    <span class="comment">// å°æ•°éƒ¨åˆ†(æŒ‡æ•°è¡¨è¾¾æ³•çš„å°¾æ•°éƒ¨åˆ†): fractionals = 7005208482886451 - 99 &lt;&lt; 46  = 38702809297715</span></span><br><span class="line">    <span class="comment">// æŒ‡æ•°ä¸å˜ -46</span></span><br><span class="line">    <span class="comment">// 38702809297715 * (2 ** -46) = 0.5499999999999972</span></span><br><span class="line">    uint64_t fractionals = significand - (integrals &lt;&lt; -exponent);</span><br><span class="line">    <span class="keyword">if</span> (integrals &gt; kMaxUInt32) &#123;</span><br><span class="line">      FillDigits64(integrals, buffer, length);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// buffer ä¸­æ”¾å…¥ "99"</span></span><br><span class="line">      FillDigits32(static_cast&lt;uint32_t&gt;(integrals), buffer, length);</span><br><span class="line">    &#125;</span><br><span class="line">    *decimal_point = *length;</span><br><span class="line">    <span class="comment">// å¡«å……å°æ•°éƒ¨åˆ†ï¼Œbuffer ä¸º "995"</span></span><br><span class="line">    FillFractionals(fractionals, exponent, fractional_count,</span><br><span class="line">                    buffer, length, decimal_point);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (exponent &lt; <span class="number">-128</span>) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">  TrimZeros(buffer, length, decimal_point);</span><br><span class="line">  buffer[*length] = <span class="string">'\0'</span>;</span><br><span class="line">  <span class="keyword">if</span> ((*length) == <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="comment">// The string is empty and the decimal_point thus has no importance. Mimick</span></span><br><span class="line">    <span class="comment">// Gay's dtoa and and set it to -fractional_count.</span></span><br><span class="line">    *decimal_point = -fractional_count;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>FillFractionals ç”¨æ¥å¡«å……å°æ•°éƒ¨åˆ†ï¼Œå–å‡ ä½ï¼Œæ˜¯å¦è¿›ä½éƒ½åœ¨è¯¥æ–¹æ³•ä¸­å¤„ç†</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// FillFractionals(fractionals=38702809297715, exponent=-46, fractional_count=1, buffer=(start_ = "99ï¿½ï¿½ï¿½", length_ = 122), length=0x00007ffeefbfd488, decimal_point=0x00007ffeefbfd494)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">å°æ•°éƒ¨åˆ†çš„äºŒè¿›åˆ¶è¡¨ç¤ºæ³•ï¼š fractionals * 2 ^ -exponent</span></span><br><span class="line"><span class="comment">38702809297715 * (2 ** -46) = 0.5499999999999972</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">å‰æï¼š</span></span><br><span class="line"><span class="comment">  -128 &lt;= exponent &lt;=0ã€‚</span></span><br><span class="line"><span class="comment">  0 &lt;= fractionals * 2 ^ exponent &lt; 1 </span></span><br><span class="line"><span class="comment">  buffer å¯ä»¥ä¿å­˜ç»“æœ</span></span><br><span class="line"><span class="comment">æ­¤å‡½æ•°å°†èˆå…¥ç»“æœã€‚åœ¨èˆå…¥è¿‡ç¨‹ä¸­ï¼Œæ­¤å‡½æ•°æœªç”Ÿæˆçš„æ•°å­—å¯èƒ½ä¼šæ›´æ–°ï¼Œä¸”å°æ•°ç‚¹å˜é‡å¯èƒ½ä¼šæ›´æ–°ã€‚å¦‚æœæ­¤å‡½æ•°ç”Ÿæˆæ•°å­— 99ï¼Œå¹¶ä¸”ç¼“å†²åŒºå·²ç»åŒ…å« â€œ199â€ï¼ˆå› æ­¤äº§ç”Ÿçš„ç¼“å†²åŒºä¸ºâ€œ19999â€ï¼‰ï¼Œåˆ™å‘ä¸Šèˆå…¥ä¼šå°†ç¼“å†²åŒºçš„å†…å®¹æ›´æ”¹ä¸º â€œ20000â€ã€‚</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">FillFractionals</span><span class="params">(<span class="keyword">uint64_t</span> fractionals, <span class="keyword">int</span> exponent,</span></span></span><br><span class="line"><span class="function"><span class="params">                            <span class="keyword">int</span> fractional_count, BufferReference&lt;<span class="keyword">char</span>&gt; <span class="built_in">buffer</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">                            <span class="keyword">int</span>* length, <span class="keyword">int</span>* decimal_point)</span> </span>&#123;</span><br><span class="line">  ASSERT(<span class="number">-128</span> &lt;= exponent &amp;&amp; exponent &lt;= <span class="number">0</span>);</span><br><span class="line">  <span class="keyword">if</span> (-exponent &lt;= <span class="number">64</span>) &#123; </span><br><span class="line">    ASSERT(fractionals &gt;&gt; <span class="number">56</span> == <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">int</span> <span class="built_in">point</span> = -exponent; <span class="comment">// 46</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ¯æ¬¡è¿­ä»£ï¼Œå°†å°æ•°ä¹˜ä»¥10ï¼Œå»é™¤æ•´æ•°éƒ¨åˆ†æ”¾å…¥ buffer</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; fractional_count; ++i) &#123; <span class="comment">// 0-&gt;1</span></span><br><span class="line">      <span class="keyword">if</span> (fractionals == <span class="number">0</span>) <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// fractionals ä¹˜ä»¥ 5 è€Œä¸æ˜¯ä¹˜ä»¥ 10 ï¼Œå¹¶è°ƒæ•´ point çš„ä½ç½®ï¼Œè¿™æ ·ï¼Œ fractionals å˜é‡å°†ä¸ä¼šæº¢å‡ºã€‚ç„¶åæ•´ä½“ç›¸å½“äºä¹˜ä»¥ 10</span></span><br><span class="line">      <span class="comment">// ä¸ä¼šæº¢å‡ºçš„éªŒè¯è¿‡ç¨‹ï¼š</span></span><br><span class="line">      <span class="comment">// å¾ªç¯åˆå§‹ï¼š fractionals &lt; 2 ^ point , point &lt;= 64 ä¸” fractionals &lt; 2 ^ 56</span></span><br><span class="line">      <span class="comment">// æ¯æ¬¡è¿­ä»£åï¼Œ point-- ã€‚</span></span><br><span class="line">      <span class="comment">// æ³¨æ„ 5 ^ 3 = 125 &lt; 128 = 2 ^ 7ã€‚</span></span><br><span class="line">      <span class="comment">// å› æ­¤ï¼Œæ­¤å¾ªç¯çš„ä¸‰ä¸ªè¿­ä»£ä¸ä¼šæº¢å‡º fractionals ï¼ˆå³ä½¿åœ¨å¾ªç¯ä½“æœ«å°¾æ²¡æœ‰å‡æ³•ï¼‰ã€‚</span></span><br><span class="line">      <span class="comment">// ä¸æ­¤åŒæ—¶ point å°†æ»¡è¶³ point &lt;= 61ï¼Œå› æ­¤ fractionals &lt; 2 ^ point ï¼Œå¹¶ä¸” fractionals å†ä¹˜ä»¥ 5 å°†ä¸ä¼šæº¢å‡º(&lt;int64)ã€‚</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      <span class="comment">// è¯¥æ“ä½œä¸ä¼šæº¢å‡ºï¼Œè¯æ˜è§ä¸Šæ–¹</span></span><br><span class="line">      fractionals *= <span class="number">5</span>; <span class="comment">// 193514046488575</span></span><br><span class="line">      <span class="built_in">point</span>--; <span class="comment">// 45</span></span><br><span class="line">      <span class="keyword">int</span> digit = <span class="keyword">static_cast</span>&lt;<span class="keyword">int</span>&gt;(fractionals &gt;&gt; <span class="built_in">point</span>); <span class="comment">// 193514046488575 * 2 ** -45 = 5</span></span><br><span class="line">      ASSERT(digit &lt;= <span class="number">9</span>);</span><br><span class="line">      <span class="built_in">buffer</span>[*length] = <span class="keyword">static_cast</span>&lt;<span class="keyword">char</span>&gt;(<span class="string">'0'</span> + digit); <span class="comment">// '995'</span></span><br><span class="line">      (*length)++;</span><br><span class="line">      <span class="comment">// å»æ‰æ•´æ•°ä½</span></span><br><span class="line">      fractionals -= <span class="keyword">static_cast</span>&lt;<span class="keyword">uint64_t</span>&gt;(digit) &lt;&lt; <span class="built_in">point</span>; <span class="comment">// 193514046488575 - 5 * 2 ** 45 = 17592186044415 </span></span><br><span class="line">      <span class="comment">// 17592186044415 * 2 ** -45 = 0.4999999999999716 </span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// çœ‹å°æ•°çš„ä¸‹ä¸€ä½æ˜¯å¦å€¼å¾—è®© buffer ä¸­å…ƒç´ è¿›ä½</span></span><br><span class="line">    <span class="comment">// é€šè¿‡ä¹˜2çœ‹æ˜¯å¦èƒ½ &gt;=1 æ¥åˆ¤æ–­</span></span><br><span class="line">    ASSERT(fractionals == <span class="number">0</span> || <span class="built_in">point</span> - <span class="number">1</span> &gt;= <span class="number">0</span>);</span><br><span class="line">    <span class="comment">// æœ¬ä¾‹ä¸­ 17592186044415 &gt;&gt; 44 = 17592186044415 * 2 ** -44 = 0.9999999999999432 , &amp; 1 = 0</span></span><br><span class="line">    <span class="keyword">if</span> ((fractionals != <span class="number">0</span>) &amp;&amp; ((fractionals &gt;&gt; (<span class="built_in">point</span> - <span class="number">1</span>)) &amp; <span class="number">1</span>) == <span class="number">1</span>) &#123;</span><br><span class="line">      RoundUp(<span class="built_in">buffer</span>, length, decimal_point);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;  <span class="comment">// We need 128 bits.</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·å°±å¾—åˆ°äº† 995 ï¼Œå³è§„èŒƒæè¿°ä¸­çš„ n ï¼Œåé¢æ’å…¥ä¸€ä¸ªå°æ•°ç‚¹å³ä¸ºæœ€ç»ˆç»“æœ 99.5</p>
<h3 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><p>js å¼•æ“å¹¶æ²¡æœ‰æŒ‰è§„èŒƒä¸­è¯´çš„ï¼Œå»å¯»æ‰¾ä¸€ä¸ª n ï¼Œä½¿å…¶ <code>n / (10 ^ f)</code> å°½å¯èƒ½ç­‰äº x ï¼Œæ„Ÿè§‰è¿™æ ·æ•ˆç‡å¤ªæ…¢äº†ã€‚è€Œæ˜¯ç›´æ¥å°† x åˆ†ä¸ºæ•´æ•°å’Œå°æ•°éƒ¨åˆ†ï¼Œå¹¶é‡‡ç”¨æŒ‡æ•°è¡¨ç¤ºæ³•åˆ†åˆ«è¿›è¡Œè®¡ç®—ã€‚</p>
<p>å¤„ç†å°æ•°çš„æ—¶å€™ï¼Œå…¶å®å°±æ˜¯è®©å°æ•°ç‚¹å³ç§»ã€‚ç”¨æŒ‡æ•°è¡¨ç¤ºæ³•çš„æ—¶å€™ï¼Œå…¶ä¸­æœ‰ä¸ªç»†èŠ‚å°±æ˜¯è€ƒè™‘äº†åº•æ•°ç›´æ¥ <code>*10</code> å¯èƒ½ä¼šå¯¼è‡´æº¢å‡ºï¼Œç„¶åé‡‡ç”¨äº† <code>åº•æ•° *5 ï¼ŒæŒ‡æ•°é€’å‡</code> çš„æ–¹å¼ ï¼Œæ³¨é‡Šä¸­ç»™å‡ºäº†è¯æ˜ã€‚ åœ¨ f ä½è®¡ç®—åï¼Œæœ€åå†è®¡ç®—ä¸‹ä¸€ä½ï¼Œçœ‹æ˜¯å¦éœ€è¦è¿›ä½ã€‚</p>
<p>å½“ç„¶ï¼Œæœ€ç»ˆç»“æœä¸ç¬¦åˆæˆ‘ä»¬æ—¥å¸¸çš„è®¡ç®—ï¼Œæ ¸å¿ƒè¿˜æ˜¯åœ¨äº IEEE 754 è¡¨ç¤ºæ³•</p>
<p>99.55 åœ¨è°ƒè¯•åˆæœŸå–å€¼å°±æ˜¯ 99.549999999999997 äº†</p>
<p>å› æ­¤ï¼Œä»¥åç”¨ toFixed æ–¹æ³•çš„æ—¶å€™ï¼Œè¦æ˜¯æ‹…å¿ƒæ²¡æœ‰æ­£å¸¸å››èˆäº”å…¥ï¼Œå°±å…ˆå» <a href="https://www.binaryconvert.com/convert_double.html?decimal=057057046053053" target="_blank" rel="noopener">åœ¨çº¿å·¥å…·</a> ä¸ŠæŸ¥çœ‹çœ‹</p>
<h2 id="V8-toFixed-æºç "><a href="#V8-toFixed-æºç " class="headerlink" title="V8 toFixed æºç "></a>V8 toFixed æºç </h2><p><a href="https://source.chromium.org/chromium/chromium/src/+/master:v8/src/builtins/builtins-number.cc;l=67?q=NumberPrototypeToFixed&ss=chromium%2Fchromium%2Fsrc:v8%2F" target="_blank" rel="noopener">v8 toFixed</a></p>
<p>å…¥å£åœ¨è¿™ï¼Œå°±ä¸å†åˆ†æäº†ï¼Œå’Œ JavaScriptCore å¤§åŒå°å¼‚ï¼Œæ„Ÿå…´è¶£çš„è¯»è€…å¯ä»¥è‡ªè¡ŒæŸ¥çœ‹</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ES6 section 20.1.3.3 Number.prototype.toFixed ( fractionDigits )</span></span><br><span class="line">BUILTIN(NumberPrototypeToFixed) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ... çœç•¥å‚æ•°è§£æï¼Œæ‹†åŒ…ï¼Œç±»å‹åˆ¤æ–­</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">// value_number å’Œ fraction_digits_number å³ä¸ºæˆ‘ä»¬ç›®æ ‡å€¼</span></span><br><span class="line">  <span class="comment">// å‡è®¾ value_number = 99.55, fraction_digits_number = 1.0</span></span><br><span class="line">  <span class="keyword">double</span> <span class="keyword">const</span> value_number = value-&gt;Number();</span><br><span class="line">  <span class="keyword">double</span> <span class="keyword">const</span> fraction_digits_number = fraction_digits-&gt;Number();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ... çœç•¥èŒƒå›´æ£€æŸ¥</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// ... çœç•¥ value_number ç‰¹æ®Šå€¼å¤„ç†ï¼š Infinity NaN</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// å®é™…å¤„ç†æ–¹æ³• DoubleToFixedCString</span></span><br><span class="line">  <span class="keyword">char</span>* <span class="keyword">const</span> str = DoubleToFixedCString(</span><br><span class="line">      value_number, <span class="keyword">static_cast</span>&lt;<span class="keyword">int</span>&gt;(fraction_digits_number));</span><br><span class="line">  Handle&lt;<span class="keyword">String</span>&gt; result = isolate-&gt;factory()-&gt;NewStringFromAsciiChecked(str);</span><br><span class="line">  DeleteArray(str);</span><br><span class="line">  <span class="keyword">return</span> *result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="æ­£ç¡®çš„-ã€Œå››èˆäº”å…¥ã€"><a href="#æ­£ç¡®çš„-ã€Œå››èˆäº”å…¥ã€" class="headerlink" title="æ­£ç¡®çš„ ã€Œå››èˆäº”å…¥ã€"></a>æ­£ç¡®çš„ ã€Œå››èˆäº”å…¥ã€</h2><p>é‚£å¦‚ä½•å†™å‡ºä¸€ä¸ªç¬¦åˆå¸¸ç†çš„å››èˆäº”å…¥æ–¹æ³•å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥å€ŸåŠ© <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Math/round" target="_blank" rel="noopener">Math.round</a> æ–¹æ³•å®ç°</p>
<h3 id="Math-round-x"><a href="#Math-round-x" class="headerlink" title="Math.round(x)"></a>Math.round(x)</h3><p>ç»™å®šæ•°å­—çš„å€¼ x å››èˆäº”å…¥åˆ°æœ€æ¥è¿‘çš„æ•´æ•°ã€‚</p>
<ul>
<li>å¦‚æœ x çš„å°æ•°éƒ¨åˆ†å¤§äº 0.5ï¼Œåˆ™èˆå…¥åˆ°ç›¸é‚»çš„ç»å¯¹å€¼æ›´å¤§çš„æ•´æ•°ã€‚ </li>
<li>å¦‚æœ x çš„å°æ•°éƒ¨åˆ†å°äº 0.5ï¼Œåˆ™èˆå…¥åˆ°ç›¸é‚»çš„ç»å¯¹å€¼æ›´å°çš„æ•´æ•°ã€‚</li>
<li>å¦‚æœå‚æ•°çš„å°æ•°éƒ¨åˆ†æ°å¥½ç­‰äº0.5ï¼Œåˆ™èˆå…¥åˆ°ç›¸é‚»çš„åœ¨æ­£æ— ç©·ï¼ˆ+âˆï¼‰æ–¹å‘ä¸Šçš„æ•´æ•°ã€‚<blockquote>
<p>âš ï¸ æ³¨æ„ï¼š ä¸å¾ˆå¤šå…¶ä»–è¯­è¨€ä¸­çš„round()å‡½æ•°ä¸åŒï¼ŒMath.round()å¹¶ä¸æ€»æ˜¯èˆå…¥åˆ°è¿œç¦»0çš„æ–¹å‘ï¼ˆå°¤å…¶æ˜¯åœ¨è´Ÿæ•°çš„å°æ•°éƒ¨åˆ†æ°å¥½ç­‰äº0.5çš„æƒ…å†µä¸‹ï¼‰ã€‚</p>
</blockquote>
</li>
</ul>
<p>ä¸¾ä¾‹</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Math</span>.round(<span class="number">99.51</span>) <span class="comment">// 100</span></span><br><span class="line"><span class="built_in">Math</span>.round(<span class="number">99.5</span>) <span class="comment">// 100</span></span><br><span class="line"><span class="built_in">Math</span>.round(<span class="number">99.49</span>) <span class="comment">//99</span></span><br><span class="line"><span class="built_in">Math</span>.round(<span class="number">-99.51</span>) <span class="comment">// -100</span></span><br><span class="line"><span class="built_in">Math</span>.round(<span class="number">-99.5</span>) <span class="comment">// -99</span></span><br><span class="line"><span class="built_in">Math</span>.round(<span class="number">-99.49</span>) <span class="comment">//-99</span></span><br></pre></td></tr></table></figure>

<h3 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ³¨æ„ï¼Œè¦ç”¨é™¤æ³•ã€‚è‹¥ç”¨ä¹˜æ³•çš„è¯ï¼Œä¹˜ä»¥å°æ•°ï¼Œè¯¥å°æ•°æ˜¯ä¸ç²¾ç¡®çš„ ï¼ˆè¿˜æ˜¯ä¸Šé¢çš„åŸå› ï¼Œieee 754 è¡¨ç¤ºæ³•ï¼‰</span></span><br><span class="line"><span class="comment">// 996 * 0.1 = 99.60000000000001</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">round</span>(<span class="params">number, precision=<span class="number">0</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Math</span>.round(+number + <span class="string">'e'</span> + precision) / (<span class="number">10</span> ** precision)</span><br><span class="line">    <span class="comment">//same as:</span></span><br><span class="line">    <span class="comment">//return Number(Math.round(+number + 'e' + precision) + 'e-' + precision);</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">round(<span class="number">99.55</span>,<span class="number">1</span>) <span class="comment">// 99.6</span></span><br><span class="line">round(<span class="number">-99.5</span>,<span class="number">0</span>) <span class="comment">// -99</span></span><br></pre></td></tr></table></figure>

<p>å¯¹è´Ÿæ•°è¿›è¡Œï¼Œæ¯”å¦‚ -99.5 å››èˆäº”å…¥æŒ‰å…¶ä»–å¹³å°å¤„ç†ï¼Œå–å€¼ -100</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>number </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>precision </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;boolean&#125;</span> </span>flag è´Ÿæ•°å››èˆäº”å…¥æ˜¯å¦æŒ‰è¿œç¦» 0 å¤„ç†</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">round</span>(<span class="params">number, precision = <span class="number">0</span>, flag = false</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (flag &amp;&amp; number &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> -round(<span class="built_in">Math</span>.abs(number), precision)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Math</span>.round(+number + <span class="string">'e'</span> + precision) / (<span class="number">10</span> ** precision)</span><br><span class="line">&#125;</span><br><span class="line">round(<span class="number">99.55</span>,<span class="number">1</span>) <span class="comment">// 99.6</span></span><br><span class="line">round(<span class="number">-99.55</span>,<span class="number">1</span>) <span class="comment">// -99.5</span></span><br><span class="line">round(<span class="number">-99.55</span>,<span class="number">1</span>,<span class="literal">true</span>) <span class="comment">// -99.6</span></span><br></pre></td></tr></table></figure>

<p>ä¹‹å‰æƒ³è¯´è¿˜éœ€è¦è€ƒè™‘æº¢å‡ºï¼Œå› ä¸ºå‘ç°æˆ‘ä»¬è‡ªå·±å®ç°çš„ round å’Œ toFixed éƒ½ä¸ç¬¦åˆé¢„æœŸ</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">round(<span class="number">999999999955.2376236232</span>, <span class="number">6</span>) <span class="comment">// 999999999955.2378</span></span><br><span class="line"><span class="number">999999999955.2376236232</span>.toFixed(<span class="number">6</span>) <span class="comment">// "999999999955.237671</span></span><br></pre></td></tr></table></figure>

<p>åæ¥å‘ç° <code>999999999955.2376236232</code> è¿™ä¸ªæ•°å­—åœ¨ 64 ä½ä¸­å°±æ— æ³•è¡¨ç¤ºäº†ï¼Œåªèƒ½è¡¨ç¤ºä¸º <code>9.999999999552376708984375e11</code></p>
<p>æ‰€ä»¥ï¼Œæº¢å‡ºçš„ä¾‹å­æˆ‘ä»¬å°±ä¸è€ƒè™‘äº†ã€‚</p>
<p>PS: å¤„ç†æ—¶å‘ç°çš„ä¸€ä¸ªæ–¹æ³• <code>Math.trunc</code> å¯ä»¥ç›´æ¥æ‹¿åˆ°æ•´æ•°éƒ¨åˆ†ï¼Œä¸ç®¡æ­£è´Ÿï¼Œä¸åƒ <code>Math.floor</code> å¯¹äºè´Ÿæ•°ä¼šå‘ä¸‹å–æ•´</p>
<p>PS: æ„Ÿè§‰è¿™ä¸ªå¯ä»¥æ‹¿æ¥å½“ç¬”è¯•é¢˜ ï¼šï¼‰</p>
<h2 id="æœ€å"><a href="#æœ€å" class="headerlink" title="æœ€å"></a>æœ€å</h2><p>ä»å‘ç°é—®é¢˜ï¼Œåˆ°å†™ä¸‹è¿™ç¯‡æ–‡ç« æ‹–äº†å¤§æ¦‚ 2 å‘¨äº†ï¼Œä¸»è¦æ˜¯ä¹‹å‰å¯¹ JS å¼•æ“è°ƒè¯•å®Œå…¨ä¸äº†è§£</p>
<p>å…‰æ­å»º v8 è°ƒè¯•ç¯å¢ƒå°±èŠ±äº†å¥½å‡ ä¸ªæ™šä¸Šï¼ŒåŒ…æ‹¬ macOS ä¸Š gdb çš„å‘ï¼ŒV8 æ„å»ºçš„å‘ï¼Œæ–­ç‚¹è°ƒè¯•çš„å‘ï¼Œå¦‚ä½•é…åˆ vscode ç­‰ç­‰â€¦ åé¢ä¼šå†å‡ºå‡ ç¯‡æ–‡ç« è®²è¿™ä¸ªï¼Œæ¬¢è¿å…³æ³¨</p>
<p>å¦‚æœæ˜¯ macOS ä¸Šï¼Œå»ºè®®è¿˜æ˜¯å»çœ‹ JavaScriptCore æºç å§ï¼Œè¿™äº›åŸºç¡€æ–¹æ³•å®ç°ï¼Œå…¶å®å¤§éƒ¨åˆ†å’Œ V8 æ˜¯ä¸€æ ·çš„</p>
<h2 id="å‚è€ƒæ–‡æ¡£"><a href="#å‚è€ƒæ–‡æ¡£" class="headerlink" title="å‚è€ƒæ–‡æ¡£"></a>å‚è€ƒæ–‡æ¡£</h2><ul>
<li><a href="https://liveoverflow.com/setup-and-debug-javascriptcore-webkit-browser-0x01/" target="_blank" rel="noopener">JavaScriptCore ç¼–è¯‘è°ƒè¯•</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/26144355" target="_blank" rel="noopener">è°ƒè¯• WebKit</a></li>
</ul>
]]></content>
      <categories>
        <category>å¤§å‰ç«¯</category>
      </categories>
      <tags>
        <tag>ECMAScript</tag>
        <tag>JavaScriptCore</tag>
      </tags>
  </entry>
  <entry>
    <title>å¤šå¹³å°å®‰è£…ç¨‹åºè¸©å‘è®°å½•</title>
    <url>/2020/06/11/2020/%E5%A4%9A%E5%B9%B3%E5%8F%B0%E5%AE%89%E8%A3%85%E7%A8%8B%E5%BA%8F%E8%B8%A9%E5%9D%91%E8%AE%B0%E5%BD%95/</url>
    <content><![CDATA[<h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>ç›®å‰æœ‰ä¸ªéœ€æ±‚æ˜¯ç½‘ç«™æä¾›ä¸€ä¸ªå®‰è£…åŒ…ï¼Œå®‰è£…ååœ¨æ¡Œé¢æä¾›ä¸€ä¸ªå¿«æ·æ–¹å¼ï¼Œç‚¹å‡»å¿«æ·æ–¹å¼èƒ½å¤Ÿè·³åˆ°æœ¬ç½‘ç«™ï¼Œé™¤äº†å¤šå¹³å°æ”¯æŒå¤–ï¼Œå¦ä¸€ä¸ªè¿°æ±‚æ˜¯å®‰è£…åŒ…å°½å¯èƒ½çš„å°ã€‚</p>
<a id="more"></a>

<h2 id="pkg"><a href="#pkg" class="headerlink" title="pkg"></a>pkg</h2><p>ä½œä¸ºä¸€ä¸ªå‰ç«¯æœ€å…ˆæƒ³åˆ°çš„æ˜¯ nodejs è§£æ³•ï¼Œæ‰¾åˆ°äº†ä¸€ä¸ª npm åŒ…èƒ½å¤Ÿæ‰“åŒ… js æˆ exe ï¼ˆä»¥åŠå…¶ä»–å¹³å°å¯æ‰§è¡Œç¨‹åºï¼‰</p>
<p><a href="https://www.npmjs.com/package/pkg" target="_blank" rel="noopener">pkg</a></p>
<p>ä»£ç ä¹Ÿå¾ˆç®€å•</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> open = <span class="built_in">require</span>(<span class="string">'open'</span>);</span><br><span class="line"> </span><br><span class="line">(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">await</span> open(<span class="string">'https://www.baidu.com'</span>);</span><br><span class="line">    process.exit();</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>

<p>æ‰“åŒ…è„šæœ¬</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">pkg . --target macos --out-path=dist/ -c package.</span><br></pre></td></tr></table></figure>

<p>pkg çš„åŸç†æ˜¯æ‹‰äº†å„ä¸ªå¹³å°çš„ nodejs ç¯å¢ƒï¼Œæ‰€ä»¥æ‰“åŒ…å®Œæ‰§è¡Œç¨‹åºè¦ 50+M</p>
<p>å¹¶ä¸”å®ç°çš„æ˜¯å¯æ‰§è¡Œç¨‹åºï¼Œä¸æ˜¯å®‰è£…åŒ…</p>
<p>ä¼˜ç‚¹å°±æ˜¯è·¨å¹³å°</p>
<p>æ³¨æ„ï¼šä¸‹è½½æœ‰é—®é¢˜çš„å¯ä»¥çœ‹è¿™ä¸ª <a href="https://github.com/vercel/pkg/issues/419" target="_blank" rel="noopener">https://github.com/vercel/pkg/issues/419</a> ï¼Œå¯èƒ½éœ€è¦å¼€å…¨å±€ä»£ç†fqè§£å†³</p>
<h2 id="Electron"><a href="#Electron" class="headerlink" title="Electron"></a>Electron</h2><p>è¿™ä¸ªå°±ä¸ç”¨ä»‹ç»äº†ï¼Œè·¨å¹³å°å¼€å‘æ–¹æ¡ˆé¦–é€‰</p>
<p>ä¸è¿‡ç¼ºç‚¹ä¸€æ ·æ˜¯æ‰“çš„åŒ…å¤ªå¤§äº†</p>
<h2 id="webloc-ä¿®æ”¹"><a href="#webloc-ä¿®æ”¹" class="headerlink" title="webloc ä¿®æ”¹"></a>webloc ä¿®æ”¹</h2><p>macOS æœ¬åœ°ä¿®æ”¹å¿«æ·æ–¹å¼ï¼Œè¯¦è§</p>
<p><a href="http://blog.sina.com.cn/s/blog_46577ccc0102w2js.html" target="_blank" rel="noopener">http://blog.sina.com.cn/s/blog_46577ccc0102w2js.html</a></p>
<p>åªæ˜¯æœ¬åœ°çœ‹ç€èˆ’æœï¼Œå®é™…æ²¡ä»€ä¹ˆç”¨</p>
<h2 id="å„è‡ªå¹³å°å¤„ç†"><a href="#å„è‡ªå¹³å°å¤„ç†" class="headerlink" title="å„è‡ªå¹³å°å¤„ç†"></a>å„è‡ªå¹³å°å¤„ç†</h2><p>æœ€åè¿˜æ˜¯é€‰æ‹©äº†è¿™ç§æ–¹æ¡ˆï¼Œ window åˆ©ç”¨ .Net æ–¹æ¡ˆè¿›è¡Œå¼€å‘ï¼Œæœ€åå®‰è£…åŒ…ä»…å‡ ç™¾ KB</p>
<p>å…¶ä»–å¹³å°æœ‰å¾…ç ”ç©¶</p>
]]></content>
      <categories>
        <category>å¤§å‰ç«¯</category>
      </categories>
      <tags>
        <tag>éšç¬”</tag>
      </tags>
  </entry>
  <entry>
    <title>åœ°ç†åæ ‡ç³»å°ç»“</title>
    <url>/2020/06/11/2020/%E5%9C%B0%E7%90%86%E5%9D%90%E6%A0%87%E7%B3%BB%E5%B0%8F%E7%BB%93/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æœ€è¿‘åš h5 åº”ç”¨ï¼Œé‡åˆ°çš„ä¸€äº›å…³äºåæ ‡ç³»çš„çŸ¥è¯†ç‚¹ï¼ˆå‘ï¼‰ï¼Œåšä¸ªè®°å½•</p>
<a id="more"></a>

<h2 id="åœ°çƒåæ ‡ç³»â€”â€”WGS84"><a href="#åœ°çƒåæ ‡ç³»â€”â€”WGS84" class="headerlink" title="åœ°çƒåæ ‡ç³»â€”â€”WGS84"></a>åœ°çƒåæ ‡ç³»â€”â€”WGS84</h2><p>GPS åŸå§‹åæ ‡ï¼Œå¸¸è§äº GPS è®¾å¤‡, Google åœ°å›¾ï¼ˆé™¤ä¸­å›½å¤§é™†å¤–åŒºåŸŸï¼‰ç­‰å›½é™…æ ‡å‡†çš„åæ ‡ä½“ç³»ã€‚</p>
<p>è·å–æ–¹å¼åŒ…æ‹¬</p>
<ol>
<li>Android Location</li>
<li>js çš„ navigator.geolocation.getCurrentPosition</li>
</ol>
<p><del>å¯ä»¥åœ¨ <a href="https://www.earthol.com/" target="_blank" rel="noopener">https://www.earthol.com/</a> ä¸Šè¿›è¡Œåæ ‡å®šä½</del></p>
<p>æš‚æ—¶æ²¡æœ‰åœ°å›¾å¯ä»¥ç›´æ¥è¿›è¡Œå®šä½ï¼Œéœ€è¦è½¬åˆ°ç«æ˜Ÿåæ ‡ç³»</p>
<h2 id="ç«æ˜Ÿåæ ‡ç³»â€”â€”GCJ-02"><a href="#ç«æ˜Ÿåæ ‡ç³»â€”â€”GCJ-02" class="headerlink" title="ç«æ˜Ÿåæ ‡ç³»â€”â€”GCJ-02"></a>ç«æ˜Ÿåæ ‡ç³»â€”â€”GCJ-02</h2><p>ä¸­å›½å›½å†…ä½¿ç”¨çš„è¢«å¼ºåˆ¶åŠ å¯†åçš„åæ ‡ä½“ç³»ã€‚</p>
<p>å±äºè¯¥ç§åæ ‡ä½“ç³»çš„æœ‰ï¼šGoogle åœ°å›¾ä¸­å›½å¤§é™†åŒºåŸŸåæ ‡(è²Œä¼¼æ‰¾é«˜å¾·ä¹°çš„)ï¼Œé«˜å¾·åœ°å›¾</p>
<p>å¯åœ¨ä»¥ä¸‹é¡µé¢è¾“å…¥ç»çº¬åº¦è¿›è¡ŒæŸ¥çœ‹</p>
<p><a href="https://www.google.com/maps" target="_blank" rel="noopener">https://www.google.com/maps</a></p>
<p><a href="https://lbs.amap.com/console/show/picker" target="_blank" rel="noopener">https://lbs.amap.com/console/show/picker</a></p>
<h2 id="ç™¾åº¦åæ ‡ç³»â€”â€”BD-09"><a href="#ç™¾åº¦åæ ‡ç³»â€”â€”BD-09" class="headerlink" title="ç™¾åº¦åæ ‡ç³»â€”â€”BD-09"></a>ç™¾åº¦åæ ‡ç³»â€”â€”BD-09</h2><p>ç™¾åº¦åœ°å›¾æ‰€ä½¿ç”¨çš„åæ ‡ä½“ç³»ï¼Œæ˜¯åœ¨ç«æ˜Ÿåæ ‡ç³»çš„åŸºç¡€ä¸Šåˆè¿›è¡Œäº†ä¸€æ¬¡åŠ å¯†å¤„ç†ã€‚</p>
<p>å¯ä»¥åœ¨ <a href="http://api.map.baidu.com/lbsapi/getpoint/index.html" target="_blank" rel="noopener">http://api.map.baidu.com/lbsapi/getpoint/index.html</a> ä¸Šè¿›è¡Œåæ ‡å®šä½</p>
<h2 id="åæ ‡äº’è½¬"><a href="#åæ ‡äº’è½¬" class="headerlink" title="åæ ‡äº’è½¬"></a>åæ ‡äº’è½¬</h2><p>åœ¨çº¿å·¥å…·ï¼š<a href="https://tool.lu/coordinate/" target="_blank" rel="noopener">https://tool.lu/coordinate/</a></p>
<p>é«˜å¾·åœ°å›¾ js api ï¼ˆéœ€è¦ç”³è¯· <em>Web ç«¯ç±»å‹</em> è€Œä¸æ˜¯ <em>WebæœåŠ¡ç±»å‹</em> ï¼‰æ”¯æŒå…¶ä»–åæ ‡ç³»è½¬ç«æ˜Ÿåæ ‡ç³»ï¼Œè¯¦è§ <a href="https://lbs.amap.com/api/javascript-api/guide/transform/convertfrom" target="_blank" rel="noopener">å…¶ä»–åæ ‡è½¬é«˜å¾·åæ ‡</a></p>
<h2 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h2><p>å¦é—¨æ±‡é‡‘çš„åæ ‡</p>
<p>gps åŸå§‹åœ°ç†åæ ‡, é€šè¿‡ js geo location è·å–çš„åæ ‡</p>
<p>24.486724,118.191702</p>
<hr>
<p>å¤´æ¡ jsb App.getAddress get_address æ‹¿åˆ°çš„åæ ‡</p>
<p>24.483637,118.196664</p>
<hr>
<p>Lite jsb get_address æ‹¿åˆ°çš„åæ ‡</p>
<p>24.490307887488875,118.20294601202556</p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ol>
<li><a href="https://www.cnblogs.com/lihualuo/p/3527495.html" target="_blank" rel="noopener">å…³äºandroidå®šä½çš„åæ ‡ç³»é—®é¢˜</a></li>
</ol>
]]></content>
      <categories>
        <category>éšç¬”</category>
      </categories>
      <tags>
        <tag>éšç¬”</tag>
      </tags>
  </entry>
  <entry>
    <title>macOS ä¸Šä½¿ç”¨ gdb</title>
    <url>/2020/06/03/2020/macOS%20%E4%B8%8A%E4%BD%BF%E7%94%A8%20gdb/</url>
    <content><![CDATA[<h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>åœ¨å°è¯•è°ƒè¯• V8 çš„æ—¶å€™ï¼Œå‘ç°éœ€è¦ç”¨åˆ°è¿™ä¸ªå·¥å…·</p>
<p>macOS ç‰ˆæœ¬ï¼š 10.15 </p>
<a id="more"></a>

<h2 id="å®‰è£…ä¸ç­¾å"><a href="#å®‰è£…ä¸ç­¾å" class="headerlink" title="å®‰è£…ä¸ç­¾å"></a>å®‰è£…ä¸ç­¾å</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">brew install gdb</span><br><span class="line">gdb -v</span><br><span class="line"><span class="comment"># 9.2</span></span><br></pre></td></tr></table></figure>

<p>ç½‘ä¸Šæœ‰è¯´ä»€ä¹ˆé«˜ç‰ˆæœ¬æœ‰å‘çš„éœ€è¦ä¸‹ç‰¹å®šç‰ˆæœ¬çš„ï¼Œåæ­£æˆ‘æš‚æ—¶æ²¡é‡åˆ°</p>
<p>ä¸Šé¢å®‰è£…å®Œåè¿˜ä¼šè¾“å‡ºä»¥ä¸‹ä¿¡æ¯ï¼ˆå¾ˆå…³é”®ï¼‰</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">gdb requires special privileges to access Mach ports.</span><br><span class="line">You will need to codesign the binary. For instructions, see:</span><br><span class="line"></span><br><span class="line">  https:&#x2F;&#x2F;sourceware.org&#x2F;gdb&#x2F;wiki&#x2F;BuildingOnDarwin</span><br><span class="line"></span><br><span class="line">On 10.12 (Sierra) or later with SIP, you need to run this:</span><br><span class="line"></span><br><span class="line">  echo &quot;set startup-with-shell off&quot; &gt;&gt; ~&#x2F;.gdbinit</span><br></pre></td></tr></table></figure>

<p>å®‰è£…å®Œéœ€è¦è¿›è¡Œç­¾åï¼Œå¦åˆ™ä¼šæŠ¥ç±»ä¼¼ä»¥ä¸‹çš„é”™è¯¯</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Starting program: &#x2F;x&#x2F;y&#x2F;foo</span><br><span class="line">Unable to find Mach task port for process-id 28885: (os&#x2F;kern) failure (0x5).</span><br><span class="line"> (please check gdb is codesigned - see taskgated(8))</span><br></pre></td></tr></table></figure>
<p>ç½‘ä¸Š<a href="https://blog.csdn.net/weixin_30257433/article/details/94883470" target="_blank" rel="noopener">å¤§éƒ¨åˆ†æ–‡ç« </a>è®²çš„éƒ½æ˜¯ 10.14 ä¹‹å‰çš„åšæ³•ï¼ŒæŒ‰ä¹‹å‰çš„åšæ³•è¿˜æ˜¯ä¼šç­¾åå¤±è´¥ã€‚</p>
<p>å¯ä»¥çœ‹ä¸Šé¢è¾“å‡ºçš„åœ°å€ â€“ <a href="https://sourceware.org/gdb/wiki/BuildingOnDarwin" target="_blank" rel="noopener">https://sourceware.org/gdb/wiki/BuildingOnDarwin</a> ï¼Œé‡Œé¢è®²äº†å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>
<h2 id="è°ƒè¯•å‘½ä»¤"><a href="#è°ƒè¯•å‘½ä»¤" class="headerlink" title="è°ƒè¯•å‘½ä»¤"></a>è°ƒè¯•å‘½ä»¤</h2><p>æƒå½“è®°å½•</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">list(l) <span class="comment"># æŸ¥çœ‹ç¨‹åºä»£ç </span></span><br><span class="line">å›è½¦ <span class="comment"># è¡¨ç¤ºæ‰§è¡Œä¸Šä¸€æ¡å‘½ä»¤</span></span><br><span class="line">start(s) <span class="comment"># å¼€å§‹æ‰§è¡Œç¨‹åº</span></span><br><span class="line">run(r) <span class="comment">#ä»å¤´å¼€å§‹è°ƒè¯•</span></span><br><span class="line">quit(q) <span class="comment">#é€€å‡ºç¨‹åº</span></span><br><span class="line">next(n) <span class="comment">#å•æ­¥æ‰§è¡Œ</span></span><br><span class="line">step(s) <span class="comment">#è¿›å…¥å‡½æ•°</span></span><br><span class="line">backtrace(bt) <span class="comment">#æŸ¥çœ‹å‡½æ•°è°ƒç”¨æ ˆå¸§ ç»“æœæ˜¾ç¤º: #0 xxx #1 xxx</span></span><br><span class="line">frame(f) x <span class="comment">#é€‰æ‹© x å·æ ˆå¸§</span></span><br><span class="line"></span><br><span class="line">info(i) locals <span class="comment">#æŸ¥çœ‹å˜é‡ä¿¡æ¯</span></span><br><span class="line">info(i) breakpoints <span class="comment">#æŸ¥çœ‹æ–­ç‚¹ä¿¡æ¯</span></span><br><span class="line">info(i) watchpoints <span class="comment">#æŸ¥è¯¢è§‚å¯Ÿç‚¹</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(p) x <span class="comment">#è¾“å‡ºå˜é‡ x çš„å€¼</span></span><br><span class="line">finish <span class="comment">#å°†ç¨‹åºè¿è¡Œåˆ°å½“å‰å‡½æ•°è¿”å›</span></span><br><span class="line"><span class="built_in">continue</span>(c) <span class="comment">#å°†ç¨‹åºè¿è¡Œåˆ°ç»“æŸæˆ–è€…æ–­ç‚¹å¤„</span></span><br><span class="line"><span class="built_in">set</span> var å˜é‡=XX <span class="comment">#è¿›è¡Œå˜é‡èµ‹å€¼</span></span><br><span class="line">display å˜é‡ <span class="comment">#è¿½è¸ªå˜é‡å€¼ï¼Œæ¯æ¬¡æ‰§è¡Œ(next)éƒ½ä¼šå¯¹è¿½è¸ªå˜é‡è¿›è¡Œè¾“å‡ºæ˜¾ç¤º</span></span><br><span class="line">undisplay ç¼–å· <span class="comment">#å–æ¶ˆè¿½è¸ª</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">break</span>(b) è¡Œå·/å‡½æ•°å &lt;æ¡ä»¶è¯­å¥&gt; <span class="comment">#è®¾ç½®æ–­ç‚¹</span></span><br><span class="line">delete breakpoints æ–­ç‚¹ç¼–å·  <span class="comment">#åˆ é™¤æ–­ç‚¹ï¼Œæ²¡å¸¦æ–­ç‚¹ç¼–å·åˆ™åˆ é™¤æ‰€æœ‰æ–­ç‚¹</span></span><br><span class="line"><span class="built_in">disable</span> breakpoints æ–­ç‚¹ç¼–å· <span class="comment">#ç¦ç”¨æ–­ç‚¹</span></span><br><span class="line"><span class="built_in">enable</span> æ–­ç‚¹ç¼–å· <span class="comment">#å¯ç”¨æ–­ç‚¹</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#è§‚å¯Ÿç‚¹æ˜¯å½“ç¨‹åºè®¿é—®æŸä¸ªå­˜å‚¨å•å…ƒæ—¶ä¸­æ–­</span></span><br><span class="line">watch arr[4] <span class="comment"># è®¿é—®arr[4] æ—¶ä¸­æ–­</span></span><br></pre></td></tr></table></figure>
<h2 id="å®ä¾‹åˆ†æ"><a href="#å®ä¾‹åˆ†æ" class="headerlink" title="å®ä¾‹åˆ†æ"></a>å®ä¾‹åˆ†æ</h2><p><a href="https://www.jianshu.com/p/30ffc01380a0" target="_blank" rel="noopener">GDBè°ƒè¯•å·¥å…·æ€»ç»“</a> è¿™ç¯‡æ–‡ç« ä¸¾äº†å‡ ä¸ªä¾‹å­ï¼Œå¹¶ä¸€æ­¥æ­¥æ•™å‘½ä»¤æ€ä¹ˆä½¿ç”¨ï¼Œå»ºè®®é˜…è¯»ï¼Œè¿™é‡Œå°±ä¸é‡å¤äº†ã€‚</p>
<h2 id="å‚è€ƒæ–‡æ¡£"><a href="#å‚è€ƒæ–‡æ¡£" class="headerlink" title="å‚è€ƒæ–‡æ¡£"></a>å‚è€ƒæ–‡æ¡£</h2><ul>
<li><a href="https://www.jianshu.com/p/30ffc01380a0" target="_blank" rel="noopener">GDBè°ƒè¯•å·¥å…·æ€»ç»“</a></li>
<li><a href="https://sourceware.org/gdb/wiki/PermissionsDarwin" target="_blank" rel="noopener">PermissionsDarwin</a></li>
</ul>
]]></content>
      <categories>
        <category>éšç¬”</category>
      </categories>
      <tags>
        <tag>gcc</tag>
      </tags>
  </entry>
  <entry>
    <title>æŠŠç½‘ç«™æ·»åŠ åˆ°æ¡Œé¢ï¼Œã€Œçˆ±å¥‡è‰ºç½‘é¡µåº”ç”¨ã€æ˜¯å¦‚ä½•å®ç°çš„</title>
    <url>/2020/05/21/2020/%E6%8A%8A%E7%BD%91%E7%AB%99%E6%B7%BB%E5%8A%A0%E5%88%B0%E6%A1%8C%E9%9D%A2%EF%BC%8C%E3%80%8C%E7%88%B1%E5%A5%87%E8%89%BA%E7%BD%91%E9%A1%B5%E5%BA%94%E7%94%A8%E3%80%8D%E6%98%AF%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E7%9A%84/</url>
    <content><![CDATA[<h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>å¸Œæœ›ç½‘ç«™æä¾›ä¸€ä¸ªã€Œæ·»åŠ ç½‘é¡µåº”ç”¨ã€åŠŸèƒ½ï¼Œç‚¹å‡»å®‰è£…åï¼Œè‡ªåŠ¨ä¸ºç”¨æˆ·åˆ›å»ºä¸€ä¸ªç½‘ç«™çš„æ¡Œé¢å¿«æ·æ–¹å¼ã€‚</p>
<p>ä¸‹æ¬¡ç”¨æˆ·ç›´æ¥ä»æ¡Œé¢å¿«æ·æ–¹å¼ï¼Œå³å¯è®¿é—®æˆ‘ä»¬çš„ç½‘ç«™</p>
<p><img src="https://upload-images.jianshu.io/upload_images/9277731-20ffae80eca4d59d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="iqiyi.png"></p>
<a id="more"></a>

<h2 id="æ–¹æ¡ˆ"><a href="#æ–¹æ¡ˆ" class="headerlink" title="æ–¹æ¡ˆ"></a>æ–¹æ¡ˆ</h2><h3 id="1-Chrome-App"><a href="#1-Chrome-App" class="headerlink" title="1. Chrome App"></a>1. Chrome App</h3><p>åœ¨çº¿å®‰è£…ï¼ˆç”±äºç½‘ç»œåŸå› ä¸å¤ªå¯è¡Œï¼Œè€Œä¸”å¦‚ä»Šå·²ç»æ²¡æœ‰å…¥å£äº†ï¼‰ or ç¦»çº¿ä¸‹è½½</p>
<p>ä¸¾å‡ ä¸ªç†Ÿæ‚‰çš„ Chrome åº”ç”¨ï¼šå¾®ä¿¡ã€Postman ã€‚å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªç‹¬ç«‹çš„æ–°åº”ç”¨äº†ï¼Œå’Œç½‘ç«™æœ¬èº«æ²¡æœ‰ä»»ä½•å…³ç³»ï¼Œå› æ­¤å¯æ‹“å±•æ€§ä¹Ÿè¾ƒé«˜ã€‚</p>
<p>æ›¾ç»è¾ƒä¸ºæµè¡Œï¼Œç”±äºå„ç§åŸå› ï¼Œchrome å°†ä¸å†æ”¯æŒï¼ˆç›®å‰åªæ”¯æŒæ›´æ–°ï¼Œä¸å†ä¸Šæ–°ï¼‰ï¼Œæ‰€ä»¥è¯¥æ–¹æ¡ˆæ”¾å¼ƒ</p>
<p>è¯¦è§ <a href="https://blog.chromium.org/2020/01/moving-forward-from-chrome-apps.html" target="_blank" rel="noopener">https://blog.chromium.org/2020/01/moving-forward-from-chrome-apps.html</a></p>
<h3 id="2-Progressive-Web-App-ï¼ˆPWAï¼‰"><a href="#2-Progressive-Web-App-ï¼ˆPWAï¼‰" class="headerlink" title="2. Progressive Web App ï¼ˆPWAï¼‰"></a>2. Progressive Web App ï¼ˆPWAï¼‰</h3><p>å³ <a href="https://developer.mozilla.org/zh-CN/docs/Web/Progressive_web_apps/Introduction" target="_blank" rel="noopener">æ¸è¿›å¼ Web åº”ç”¨</a>ï¼Œè¿™ä¸æ˜¯ä¸€ä¸ªå•ç‹¬çš„æŠ€æœ¯ï¼Œè€Œæ˜¯å¤šç§æŠ€æœ¯çš„ç»„åˆï¼ŒåŒ…æ‹¬</p>
<ul>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/Manifest" target="_blank" rel="noopener">Web app manifests</a>: é€šè¿‡ JSON æä¾›åº”ç”¨ç¨‹åºç›¸å…³ä¿¡æ¯ï¼Œç›®çš„æ˜¯å°†åº”ç”¨ç¨‹åºå®‰è£…åˆ°è®¾å¤‡æ¡Œé¢</li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/API/Service_Worker_API" target="_blank" rel="noopener">Service Worker</a>: å……å½“æµè§ˆå™¨ä¸æœåŠ¡ç«¯é—´çš„ç½‘ç»œä»£ç†ï¼Œæä¾›ç¦»çº¿è®¿é—®èƒ½åŠ›</li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/API/Push_API" target="_blank" rel="noopener">Push API</a>: ä»æœåŠ¡å™¨å‘å®¢æˆ·ç«¯æ¨é€æ¶ˆæ¯ï¼Œéœ€è¦å€ŸåŠ© service worker</li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/API/Notifications_API" target="_blank" rel="noopener">Notifications API</a>: å…è®¸ç½‘é¡µæˆ–åº”ç”¨ç¨‹åºåœ¨ç³»ç»Ÿçº§åˆ«å‘é€åœ¨é¡µé¢å¤–éƒ¨æ˜¾ç¤ºçš„é€šçŸ¥</li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/Progressive_web_apps/Add_to_home_screen" target="_blank" rel="noopener">Add to Home Screen</a>: å°†åº”ç”¨ç¨‹åºå®‰è£…åˆ°è®¾å¤‡æ¡Œé¢çš„å…³é”®ï¼Œéœ€è¦æµè§ˆå™¨æ”¯æŒ beforeinstallprompt äº‹ä»¶</li>
</ul>
<p>ä¸è¦è¢«ä¸Šè¿°æŠ€æœ¯æ ˆå“åˆ°ã€‚ã€‚å¦‚æœåªæ˜¯ä¸ºäº†å®ç° ã€ŒæŠŠç½‘ç«™æ·»åŠ åˆ°æ¡Œé¢ã€åŠŸèƒ½ï¼Œä»…éœ€è¦ <code>Web app manifests</code>, <code>Add to Home Screen</code> , <code>Service Worker</code> . 5åˆ†é’Ÿå°±å¯ä»¥å¼€å‘å¥½</p>
<h2 id="åŠŸèƒ½å®ç°"><a href="#åŠŸèƒ½å®ç°" class="headerlink" title="åŠŸèƒ½å®ç°"></a>åŠŸèƒ½å®ç°</h2><p>é¦–å…ˆéœ€è¦è¯´æ˜çš„æ˜¯ï¼Œæˆ‘ä»¬çš„ç½‘ç«™å¿…é¡»è¿è¡Œåœ¨ https ç¯å¢ƒã€‚æ‰€ä»¥å¼€å‘æµ‹è¯•çš„æ—¶å€™å¯ä»¥ç”¨ <code>github.io</code> ç™½å«–</p>
<p>å¤§ä½“æµç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li>ç¼–å†™ä¸€ä¸ªç®€å•çš„ HTML é¡µé¢<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>A2HS demo<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="css">      <span class="selector-class">.add-button</span> &#123;</span></span><br><span class="line">        position: absolute;</span><br><span class="line">        top: 1px;</span><br><span class="line">        left: 1px;</span><br><span class="line">      &#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"index.js"</span> <span class="attr">defer</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"manifest"</span> <span class="attr">href</span>=<span class="string">"manifest.webmanifest"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>æµ‹è¯•æ–‡æœ¬<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">"add-button"</span>&gt;</span>æ·»åŠ åˆ°æ¡Œé¢<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>ç¼–å†™ä¸€ä»½ <code>Web app manifests</code> JSON(åé¢ä¼šè¯¦ç»†è®²è§£å„ä¸ªå­—æ®µ) ,å‘½åä¸º <code>manifest.webmanifest</code> <a href="https://developer.mozilla.org/en-US/docs/Web/Progressive_web_apps/Add_to_home_screen#Manifest" target="_blank" rel="noopener">?</a></li>
</ol>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"background_color"</span>: <span class="string">"purple"</span>,</span><br><span class="line">  <span class="attr">"display"</span>: <span class="string">"fullscreen"</span>,</span><br><span class="line">  <span class="attr">"icons"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"src"</span>: <span class="string">"icon/fox-icon.png"</span>,</span><br><span class="line">      <span class="attr">"sizes"</span>: <span class="string">"192x192"</span>,</span><br><span class="line">      <span class="attr">"type"</span>: <span class="string">"image/png"</span></span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">"name"</span>: <span class="string">"xxå¿«æ·ç‰ˆ"</span>,</span><br><span class="line">  <span class="attr">"short_name"</span>: <span class="string">"å¿«"</span>,</span><br><span class="line">  <span class="attr">"start_url"</span>: <span class="string">"."</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>æ³¨å†Œå®‰è£…äº‹ä»¶ </li>
</ol>
<p>index.js</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> deferredPrompt;</span><br><span class="line"><span class="comment">// é»˜è®¤ä¸å±•ç¤ºæŒ‰é’®ï¼Œä»…æ”¯æŒ ã€ŒAdd to Home Screenã€ åŠŸèƒ½æ‰å±•ç°</span></span><br><span class="line"><span class="keyword">const</span> addBtn = <span class="built_in">document</span>.querySelector(<span class="string">'.add-button'</span>);</span><br><span class="line">addBtn.style.display = <span class="string">'none'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è§„å®šå¿…é¡»æ³¨å†Œ serviceWorker æ‰èƒ½ä½¿ç”¨ Add to Home Screenï¼Œ</span></span><br><span class="line"><span class="comment">// ä¸”éœ€è¦ç›‘å¬ install å’Œ fetch äº‹ä»¶ï¼Œå¯ä»¥ä¸å¤„ç†</span></span><br><span class="line"><span class="keyword">if</span>(<span class="string">'serviceWorker'</span> <span class="keyword">in</span> navigator) &#123;</span><br><span class="line">  navigator.serviceWorker</span><br><span class="line">           .register(<span class="string">'./sw.js'</span>)</span><br><span class="line">           .then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="built_in">console</span>.log(<span class="string">'Service Worker Registered'</span>); &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä»…æµè§ˆå™¨æ”¯æŒä¸”æœªå®‰è£…è¯¥åº”ç”¨ï¼Œä»¥ä¸‹äº‹ä»¶æ‰ä¼šè§¦å‘</span></span><br><span class="line"><span class="built_in">window</span>.addEventListener(<span class="string">'beforeinstallprompt'</span>, (e) =&gt; &#123;</span><br><span class="line">  <span class="comment">// Chrome 67 åŠä¹‹å‰ç‰ˆæœ¬ï¼Œä¼šè‡ªåŠ¨å±•ç°å®‰è£…çš„ prompt</span></span><br><span class="line">  <span class="comment">// ä¸ºäº†ç‰ˆæœ¬ç»Ÿä¸€åŠç”¨æˆ·ä½“éªŒï¼Œæˆ‘ä»¬ç¦æ­¢è‡ªåŠ¨å±•ç° prompt</span></span><br><span class="line">  e.preventDefault();</span><br><span class="line">  <span class="comment">// å­˜æ”¾äº‹ä»¶ç”¨äºåç»­è§¦å‘</span></span><br><span class="line">  deferredPrompt = e;</span><br><span class="line">  <span class="comment">// å±•ç°æŒ‰é’®</span></span><br><span class="line">  addBtn.style.display = <span class="string">'block'</span>;</span><br><span class="line"></span><br><span class="line">  addBtn.addEventListener(<span class="string">'click'</span>, (e) =&gt; &#123;</span><br><span class="line">    <span class="comment">// hide our user interface that shows our A2HS button</span></span><br><span class="line">    addBtn.style.display = <span class="string">'none'</span>;</span><br><span class="line">    <span class="comment">// å±•ç°å®‰è£…çš„ prompt</span></span><br><span class="line">    deferredPrompt.prompt();</span><br><span class="line">    <span class="comment">// ç­‰å¾…ç”¨æˆ·å¯¹ prompt è¿›è¡Œæ“ä½œ</span></span><br><span class="line">    <span class="comment">// å¦‚æœç”¨æˆ·ä»åœ°å€æ æˆ–å…¶ä»–æµè§ˆå™¨ç»„ä»¶å®‰è£…äº†PWAï¼Œåˆ™ä»¥ä¸‹ä»£ç å°†ä¸èµ·ä½œç”¨ </span></span><br><span class="line">    deferredPrompt.userChoice.then(<span class="function">(<span class="params">choiceResult</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (choiceResult.outcome === <span class="string">'accepted'</span>) &#123;</span><br><span class="line">          <span class="built_in">console</span>.log(<span class="string">'ç‚¹å‡»æ·»åŠ '</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="built_in">console</span>.log(<span class="string">'å–æ¶ˆæ·»åŠ '</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        deferredPrompt = <span class="literal">null</span>;</span><br><span class="line">      &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// æ— è®ºä»¥ä½•ç§æ–¹å¼å®‰è£… PWA è¯¥äº‹ä»¶éƒ½ä¼šè§¦å‘</span></span><br><span class="line"><span class="comment">// å› æ­¤è¿™é‡Œå¯ä»¥ç”¨æ¥åšåŸ‹ç‚¹</span></span><br><span class="line"><span class="built_in">window</span>.addEventListener(<span class="string">'appinstalled'</span>, (evt) =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'åº”ç”¨å®‰è£…'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>ç¼–å†™ sw æ–‡ä»¶</li>
</ol>
<p>sw.js</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">self.addEventListener(<span class="string">'install'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'install success'</span>)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">self.addEventListener(<span class="string">'fetch'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(e.request.url);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>æœ€åï¼Œå‡†å¤‡ä¸€ä¸ª icon ï¼Œè§ <code>manifest.webmanifest</code> ä¸­çš„ icons é…ç½®</li>
</ol>
<p>ä¹‹åï¼Œå°±å¯ä»¥ä½“éªŒè¿™ä¸ªåŠŸèƒ½äº† </p>
<h3 id="åœ¨çº¿ç¤ºä¾‹"><a href="#åœ¨çº¿ç¤ºä¾‹" class="headerlink" title="åœ¨çº¿ç¤ºä¾‹"></a>åœ¨çº¿ç¤ºä¾‹</h3><p><a href="https://fe-examples.github.io/pwa-examples/a2hs/" target="_blank" rel="noopener">https://fe-examples.github.io/pwa-examples/a2hs/</a></p>
<p>å¦‚æœæµè§ˆå™¨æ”¯æŒ ,é¡µé¢å·¦ä¸Šè§’å°†å±•ç° ã€Œæ·»åŠ åˆ°æ¡Œé¢ã€æŒ‰é’®</p>
<p>æ¬¢è¿è¯•ç”¨ï¼Œå¹¶æŠŠæ“ä½œç³»ç»Ÿã€æµè§ˆå™¨å‹å·å‘åœ¨è¯„è®ºåŒºï¼Œçœ‹çœ‹å…¼å®¹æ€§å¦‚ä½•~</p>
<h3 id="Web-app-manifests-ç›¸å…³é…ç½®"><a href="#Web-app-manifests-ç›¸å…³é…ç½®" class="headerlink" title="Web app manifests ç›¸å…³é…ç½®"></a>Web app manifests ç›¸å…³é…ç½®</h3><p>è¿™é‡Œåªä¸¾å¸¸ç”¨çš„ï¼Œæ›´å¤šè¯¦è§ <a href="https://w3c.github.io/manifest/#webappmanifest-dictionary" target="_blank" rel="noopener">WebAppManifest</a></p>
<ul>
<li>background_color: åº”ç”¨å¯åŠ¨æ—¶èµ„æºæœªåŠ è½½æ—¶å±•ç¤ºçš„èƒŒæ™¯è‰²ã€‚ä»…ç”¨äºæ”¹å–„åŠ è½½æ—¶çš„ç”¨æˆ·ä½“éªŒï¼Œä¸å½±å“åç»­ç½‘ç«™èƒŒæ™¯ã€‚</li>
<li>theme_color: ä¸»é¢˜è‰²ï¼Œç›¸å½“äºæ˜¾å¼çš„è®¾ç½® <code>&lt;meta name=&quot;theme-color&quot; content=&quot;é¢œè‰²å€¼&quot;&gt;</code> ,å°†ä¼šå½±å“æµè§ˆå™¨å¤–è§‚é¢œè‰²çš„å±•ç°ã€‚</li>
<li>display: æŒ‡å®šå¦‚ä½•æ˜¾ç¤ºåº”ç”¨ã€‚æœ‰ä»¥ä¸‹å‡ ç§å–å€¼ï¼Œåœ¨ä¸æ”¯æŒçš„æƒ…å†µä¸‹æŒ‰ä»ä¸Šå¾€ä¸‹é¡ºåº fallback<ul>
<li>fullscreen: å ç”¨æ‰€æœ‰å¯ç”¨æ˜¾ç¤ºåŒºåŸŸï¼Œæ— ä»»ä½•æµè§ˆå™¨ UI å…ƒç´ ã€‚ä¸å½±å“ Fullscreen API</li>
<li>standalone: ç±»ä¼¼æœ¬æœºåº”ç”¨ç¨‹åºã€‚æ’é™¤åœ°å€æ ï¼Œä½†æ˜¯å¯èƒ½åŒ…å«çŠ¶æ€æ å’Œç³»ç»Ÿåé€€æŒ‰é’®</li>
<li>minimal-ui: ç›¸æ¯” <code>standalone</code> å¢åŠ äº†å¯¼èˆªæ§ä»¶ï¼ˆåé€€ï¼Œå‰è¿›ï¼Œåˆ·æ–°ï¼‰ç­‰ UI å…ƒç´ </li>
<li>browser: ç­‰åŒäºæ‰“å¼€æ ‡ç­¾é¡µã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ browser æ˜¯å…œåº•æ–¹å¼ä¸”ä»…éƒ¨åˆ†æµè§ˆå™¨æ”¯æŒï¼Œå¦‚æœæµè§ˆå™¨è¿˜ä¸æ”¯æŒï¼Œæ•´ä»½é…ç½®å°†æ— æ•ˆ<blockquote>
<p>Macos chrome ä¸‹æµ‹è¯• 2 å’Œ 1 æ˜¾ç¤ºä¸€è‡´ï¼Œä¸æ”¯æŒ 4</p>
</blockquote>
</li>
</ul>
</li>
<li>icons: æŒ‡å®šåœ¨ä¸åŒä½ç½®æ—¶é‡‡ç”¨çš„å›¾æ ‡ï¼Œä¸»è¦æ˜¯æ ¹æ® sizes å­—æ®µæ¥åˆ¤æ–­ã€‚ç›¸æ¯”ç§»åŠ¨ç«¯ APP çš„ icon ï¼ŒPWA å¤šäº†æ¡Œé¢ä½ç½®ã€Chrome åº”ç”¨å…¥å£ä½ç½®ã€‚è‡³å°‘æŒ‡å®šä¸€ä¸ª icon</li>
<li>name/short_name: å‰è€…ä¸ºå®Œæ•´çš„åº”ç”¨åç§°ï¼Œåè€…ä¸ºå½“æ²¡æœ‰è¶³å¤Ÿç©ºé—´æ˜¾ç¤ºå…¨åæ—¶æ‰å±•ç¤ºã€‚æœ€å¥½ä¸¤è€…éƒ½æä¾›</li>
<li>start_url: åº”ç”¨å¯åŠ¨æ—¶æ‰€åŠ è½½çš„ URL ã€‚å…¶å€¼ä¸ºç›¸å¯¹äº manifest çš„ url çš„ç›¸å¯¹è·¯å¾„<blockquote>
<p>ä¾‹å¦‚ manifest URL ä¸º <code>https://www.iqiyi.com/manifest.json</code> ; start_url ä¸º <code>./index.html</code> ï¼Œåˆ™å¯åŠ¨åœ°å€ä¸º <code>https://www.iqiyi.com/index.html</code> ã€‚è€Œ start_url ä¸º <code>.</code> å¯åŠ¨åœ°å€å°±æ˜¯ <code>https://www.iqiyi.com/</code> <br>è¿˜æœ‰æ›´å¤šçš„éªšæ“ä½œï¼Œæ¯”å¦‚æŠŠ uuid æˆ–è€… launcher æ–¹å¼å¸¦åœ¨ <code>start_url</code> åé¢ï¼ˆ <code>./?launcher=homescreen&amp;uuid=xxxx</code>ï¼‰ï¼Œæœ‰åŠ©äºç”¨æˆ·åˆ†æ</p>
</blockquote>
</li>
</ul>
<p>singleton</p>
<p><img src="https://upload-images.jianshu.io/upload_images/9277731-57ee6b2f8bbbbb7a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="singleton"></p>
<p>minimal-ui<br><img src="https://upload-images.jianshu.io/upload_images/9277731-dd9fcf46d8a2642c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="minimal-ui"></p>
<h3 id="æ ¹æ®ä¸åŒçš„å¯åŠ¨æ–¹å¼åº”ç”¨ä¸åŒæ ·å¼"><a href="#æ ¹æ®ä¸åŒçš„å¯åŠ¨æ–¹å¼åº”ç”¨ä¸åŒæ ·å¼" class="headerlink" title="æ ¹æ®ä¸åŒçš„å¯åŠ¨æ–¹å¼åº”ç”¨ä¸åŒæ ·å¼"></a>æ ¹æ®ä¸åŒçš„å¯åŠ¨æ–¹å¼åº”ç”¨ä¸åŒæ ·å¼</h3><p>æ¯”å¦‚è¯´ï¼ŒPWA èƒŒæ™¯è‰²åº”ç”¨çº¢è‰²ï¼Œæ™®é€š Tab åº”ç”¨ç™½è‰²ï¼Œè¯¥å¦‚ä½•å®ç°å‘¢ï¼Ÿ</p>
<p>å¯ä»¥é‡‡ç”¨ CSS çš„åª’ä½“æŸ¥è¯¢</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="keyword">@media</span> all <span class="keyword">and</span> (<span class="attribute">display-mode:</span> standalone) &#123;</span><br><span class="line">  <span class="selector-tag">body</span> &#123;</span><br><span class="line">    <span class="attribute">background-color</span>: red;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ–è€…è„šæœ¬æ£€æµ‹</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">window</span>.addEventListener(<span class="string">'load'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (navigator.standalone) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Launched: Installed (iOS)'</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (matchMedia(<span class="string">'(display-mode: standalone)'</span>).matches) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Launched: Installed'</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Launched: Browser Tab'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>âš ï¸ æ³¨æ„ï¼šiOS Safari ä¸æ”¯æŒ matchMedia ï¼Œä½†æ˜¯å…¶å¯ä»¥é€šè¿‡ <code>navigator.standalone</code> è¿”å›çš„ true è¡¨æ˜è‡ªå·±ä»¥ç‹¬ç«‹æ¨¡å¼è¿è¡Œ</p>
<h2 id="æµè§ˆå™¨å…¼å®¹æ€§"><a href="#æµè§ˆå™¨å…¼å®¹æ€§" class="headerlink" title="æµè§ˆå™¨å…¼å®¹æ€§"></a>æµè§ˆå™¨å…¼å®¹æ€§</h2><p>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬ä»…ç”¨åˆ°äº† PWA ä½“ç³»ä¸­çš„ <code>Web app manifests</code> , <code>Add to Home Screen</code> å’Œ <code>Service Worker</code>ï¼Œå› æ­¤è¯¥åŠŸèƒ½çš„æµè§ˆå™¨å…¼å®¹æ€§å–å†³äºè¿™å‡ ä¸ªçš„çŸ­æ¿</p>
<h3 id="Service-Worker"><a href="#Service-Worker" class="headerlink" title="Service Worker"></a>Service Worker</h3><p><img src="https://upload-images.jianshu.io/upload_images/9277731-8d545f352e70a70f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="sw.png"></p>
<h3 id="Add-to-Home-Screen"><a href="#Add-to-Home-Screen" class="headerlink" title="Add to Home Screen"></a>Add to Home Screen</h3><p>å¾…æµ‹è¯•ï¼Œæœ¬æœºï¼ˆMacos chrome 81 æ”¯æŒï¼‰</p>
<h3 id="Web-app-manifests"><a href="#Web-app-manifests" class="headerlink" title="Web app manifests"></a>Web app manifests</h3><p>å¾…æµ‹è¯•ï¼Œæœ¬æœºï¼ˆMacos chrome 81 æ”¯æŒï¼‰</p>
<h3 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h3><p>ï¼ˆå…¼å®¹æ€§åˆ—è¡¨æ¬¢è¿å¤§å®¶ä¸€èµ·ç»´æŠ¤~ï¼‰<br>â€¦</p>
<h2 id="é¢˜å¤–è¯-è‡ªå·±åŠ¨æ‰‹ä¸°è¡£è¶³é£Ÿ"><a href="#é¢˜å¤–è¯-è‡ªå·±åŠ¨æ‰‹ä¸°è¡£è¶³é£Ÿ" class="headerlink" title="é¢˜å¤–è¯ - è‡ªå·±åŠ¨æ‰‹ä¸°è¡£è¶³é£Ÿ"></a>é¢˜å¤–è¯ - è‡ªå·±åŠ¨æ‰‹ä¸°è¡£è¶³é£Ÿ</h2><p>å¯¹äºæ™®é€šçš„ Chrome ç”¨æˆ·ï¼Œå¦‚æœè‡ªå·±å–œæ¬¢çš„ç½‘ç«™æ²¡æœ‰å®ç°ä¸Šè¿°åŠŸèƒ½ï¼Œè‡ªå·±å¦‚ä½•æŠŠç½‘ç«™æ·»åŠ åˆ°æ¡Œé¢å‘¢ï¼Ÿ</p>
<p>å³ä¸Šè§’é€‰æ‹©ã€Œæ›´å¤šå·¥å…·ã€-ã€Œåˆ›å»ºå¿«æ·æ–¹å¼ã€- ã€Œç¡®å®šã€</p>
<blockquote>
<p>å¦‚æœé€‰æ‹©æ–°çª—å£æ‰“å¼€ï¼Œæ–°å¼€çª—å£å°†ä¸å¸¦å¯¼èˆªæ ã€å·¥å…·æ ç­‰ï¼Œç±»ä¼¼äº <code>display=standalone</code> ï¼Œå¦åˆ™å°±æ˜¯æ™®é€šçš„æ‰“å¼€æ ‡ç­¾é¡µ <code>display=browser</code></p>
</blockquote>
<p>å¯ä»¥çœ‹åˆ°æ¡Œé¢å°±å­˜åœ¨ä¸€ä¸ªè¯¥ç½‘ç«™çš„å›¾æ ‡äº†~ ç‚¹å‡»å°±å¯ä»¥æ‰“å¼€è¯¥ç½‘ç«™</p>
<h2 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h2><ol>
<li><a href="https://web.dev/customize-install/" target="_blank" rel="noopener">Provide a custom install experience</a></li>
<li><a href="https://developers.chrome.com/apps/migration" target="_blank" rel="noopener">Transitioning from Chrome Apps</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/Progressive_web_apps" target="_blank" rel="noopener">æ¸è¿›å¼ Web åº”ç”¨ï¼ˆPWAï¼‰</a></li>
</ol>
]]></content>
      <categories>
        <category>å¤§å‰ç«¯</category>
      </categories>
      <tags>
        <tag>éšç¬”</tag>
        <tag>PWA</tag>
      </tags>
  </entry>
  <entry>
    <title>é¢è¯•å®˜é—®ï¼šå¦‚ä½•åˆ©ç”¨ random è®¡ç®— Ï€</title>
    <url>/2020/05/07/2020/%E9%9D%A2%E8%AF%95%E5%AE%98%E9%97%AE%EF%BC%9A%E5%A6%82%E4%BD%95%E5%88%A9%E7%94%A8%20random%20%E8%AE%A1%E7%AE%97%20%CF%80/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>è¿™æ˜¯åŸºå‹é¢è¯• RingCenter æ—¶è¢«é—®åˆ°çš„ä¸€ä¸ªé¢˜ç›®</p>
<p>è¡¨é¢ä¸Šè€ƒå¯Ÿçš„æ˜¯æ¦‚ç‡è®ºç­‰åŸºç¡€çŸ¥è¯†ï¼Œå®é™…å¯èƒ½è¿˜ä¼šé—®åˆ°äº‹ä»¶å¾ªç¯ç­‰åº•å±‚çŸ¥è¯†ï¼Œä»¥åŠ React Fiber</p>
<a id="more"></a>

<h2 id="è’™ç‰¹å¡æ´›æ³•æ±‚-Ï€"><a href="#è’™ç‰¹å¡æ´›æ³•æ±‚-Ï€" class="headerlink" title="è’™ç‰¹å¡æ´›æ³•æ±‚ Ï€"></a>è’™ç‰¹å¡æ´›æ³•æ±‚ Ï€</h2><p>è¯´è’™ç‰¹å¡æ´›å¯èƒ½ä¸å¤ªç†è§£ï¼Œæ¢ä¸ªè¯´æ³• â€“ éšæœºæŠ½æ ·</p>
<p>æ„é€ ä¸€ä¸ªå•ä½æ­£æ–¹å½¢å’Œ 1/4 å•ä½åœ†ï¼Œå¾€å•ä½æ­£æ–¹å½¢ä¸­æŠ•å…¥ç‚¹ï¼Œæ ¹æ®ç‚¹ä¸åŸç‚¹é—´çš„è·ç¦»åˆ¤æ–­ç‚¹æ˜¯è½åœ¨åœ†å†…è¿˜æ˜¯åœ†å¤–ï¼Œåˆ†åˆ«ç»Ÿè®¡è½åœ¨ä¸¤ä¸ªåŒºåŸŸçš„ç‚¹çš„ä¸ªæ•° n1,n2 ï¼Œ<code>n1/(n1+n2)</code> å³ 1/4 åœ†çš„é¢ç§¯ä¼°è®¡å€¼ï¼Œä»è€Œæ±‚å¾— Ï€</p>
<p><img src="https://img-blog.csdn.net/20180121211732625?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvRGFuaWVsOTYwNjAx/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="å¼•è‡ª CSDN/Daniel960601"></p>
<p>ä»¥ä¸‹æ˜¯ js ä»£ç </p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">inCicle</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> x = <span class="built_in">Math</span>.random();</span><br><span class="line">  <span class="keyword">var</span> y = <span class="built_in">Math</span>.random();</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Math</span>.pow(x, <span class="number">2</span>) + <span class="built_in">Math</span>.pow(y, <span class="number">2</span>) &lt; <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">calcPi</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> N = <span class="number">1e+6</span></span><br><span class="line">  <span class="keyword">let</span> pointsInside = <span class="number">0</span></span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">let</span> i=<span class="number">0</span>;i&lt;N;i++)&#123;</span><br><span class="line">    <span class="keyword">if</span>(inCicle())&#123;</span><br><span class="line">      pointsInside++;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">4</span> * pointsInside / N</span><br><span class="line">&#125;</span><br><span class="line">calcPi()</span><br></pre></td></tr></table></figure>

<p>ç›´æ¥åœ¨æ§åˆ¶å°è¿è¡Œï¼Œä¼šå‘ç°æœ‰å¡é¡¿å’Œæ‰å¸§å‘ç”Ÿï¼Œä¸‹é¢æˆ‘ä»¬æ¥è°ˆè°ˆå¦‚ä½•è§£å†³</p>
<h2 id="å¦‚ä½•é¿å…ä¸»çº¿ç¨‹é˜»å¡"><a href="#å¦‚ä½•é¿å…ä¸»çº¿ç¨‹é˜»å¡" class="headerlink" title="å¦‚ä½•é¿å…ä¸»çº¿ç¨‹é˜»å¡"></a>å¦‚ä½•é¿å…ä¸»çº¿ç¨‹é˜»å¡</h2><p>calcPi æ˜¯ä¸ªè€—æ—¶ä»»åŠ¡ï¼Œä¼šé˜»å¡ä¸»çº¿ç¨‹ï¼Œç”šè‡³å¯¼è‡´æ‰å¸§ï¼Œæœ‰ä»€ä¹ˆè§£å†³æ–¹æ³•ï¼Ÿ</p>
<p>æä¾›å‡ ä¸ªæ€è·¯</p>
<ol>
<li>Web Worker</li>
<li>requestIdleCallback</li>
<li>requestAnimationFrame + MessageChannel</li>
</ol>
<h3 id="Web-Worker"><a href="#Web-Worker" class="headerlink" title="Web Worker"></a>Web Worker</h3><p>Web Worker æ˜¯å•¥å°±ä¸å†ä»‹ç»äº†ï¼Œä¸æ‡‚çš„è‡ªè¡Œ MDN æœç´¢</p>
<p>æˆ‘ä»¬æ–°å»ºä¸€ä¸ª Worker çº¿ç¨‹è¿›è¡Œè€—æ—¶ä»»åŠ¡è®¡ç®—ï¼Œè€Œåå†æŠŠç»“æœå‘é€ç»™ä¸»çº¿ç¨‹</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createWorker</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> text = <span class="string">`</span></span><br><span class="line"><span class="string">  function inCicle() &#123;</span></span><br><span class="line"><span class="string">    var x = Math.random();</span></span><br><span class="line"><span class="string">    var y = Math.random();</span></span><br><span class="line"><span class="string">    return Math.pow(x, 2) + Math.pow(y, 2) &lt; 1</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">  function calcPi() &#123;</span></span><br><span class="line"><span class="string">    const N = 1e+6</span></span><br><span class="line"><span class="string">    let pointsInside = 0</span></span><br><span class="line"><span class="string">    for(let i=0;i&lt;N;i++)&#123;</span></span><br><span class="line"><span class="string">      if(inCicle())&#123;</span></span><br><span class="line"><span class="string">        pointsInside++;</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    return 4 * pointsInside / N</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">  this.addEventListener('message', (msg) =&gt; &#123;</span></span><br><span class="line"><span class="string">    let pi = calcPi()</span></span><br><span class="line"><span class="string">    this.postMessage(pi);</span></span><br><span class="line"><span class="string">  &#125;, false);</span></span><br><span class="line"><span class="string">  `</span></span><br><span class="line">  <span class="keyword">let</span> blob = <span class="keyword">new</span> Blob([text]);</span><br><span class="line">  <span class="keyword">let</span> url = <span class="built_in">window</span>.URL.createObjectURL(blob);</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> Worker(url)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> worker = createWorker()</span><br><span class="line">worker.onmessage = <span class="function">(<span class="params">evt</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'PI: '</span>, evt.data)</span><br><span class="line">&#125;;</span><br><span class="line">worker.postMessage(<span class="string">"calc"</span>);</span><br></pre></td></tr></table></figure>

<p>ç¼ºç‚¹å°±æ˜¯è®¡ç®—æ¬¡æ•°æ˜¯å›ºå®šçš„ï¼ŒåŒæ—¶ä¸èƒ½çœ‹åˆ°å®æ—¶è®¡ç®—çš„ç»“æœ</p>
<h3 id="requestIdleCallback"><a href="#requestIdleCallback" class="headerlink" title="requestIdleCallback"></a>requestIdleCallback</h3><p>åˆ©ç”¨ <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/requestIdleCallback" target="_blank" rel="noopener">requestIdleCallback</a> åœ¨å¸§ç©ºä½™æ—¶é—´æ‰§è¡Œä»»åŠ¡çš„ç‰¹ç‚¹è¿›è¡Œè€—æ—¶ä»»åŠ¡çš„è®¡ç®—</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line"></span><br><span class="line">&lt;head&gt;</span><br><span class="line">  &lt;title&gt;Scheduling background tasks using requestIdleCallback&lt;<span class="regexp">/title&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>head&gt;</span><br><span class="line"></span><br><span class="line">&lt;body&gt;</span><br><span class="line">  &lt;script&gt;</span><br><span class="line">    <span class="keyword">var</span> requestId = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">var</span> pointsTotal = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">var</span> pointsInside = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">piStep</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> r = <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">var</span> x = <span class="built_in">Math</span>.random() * r;</span><br><span class="line">      <span class="keyword">var</span> y = <span class="built_in">Math</span>.random() * r;</span><br><span class="line">      <span class="keyword">return</span> (<span class="built_in">Math</span>.pow(x, <span class="number">2</span>) + <span class="built_in">Math</span>.pow(y, <span class="number">2</span>) &lt; <span class="built_in">Math</span>.pow(r, <span class="number">2</span>))</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">refinePi</span>(<span class="params">deadline</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">while</span> (deadline.timeRemaining() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (piStep())</span><br><span class="line">          pointsInside++;</span><br><span class="line">        pointsTotal++;</span><br><span class="line">      &#125;</span><br><span class="line">      currentEstimate = (<span class="number">4</span> * pointsInside / pointsTotal);</span><br><span class="line">      textElement = <span class="built_in">document</span>.getElementById(<span class="string">"piEstimate"</span>);</span><br><span class="line">      textElement.innerHTML = <span class="string">"Pi Estimate: "</span> + currentEstimate;</span><br><span class="line">      requestId = <span class="built_in">window</span>.requestIdleCallback(refinePi);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">start</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      textElement = <span class="built_in">document</span>.getElementById(<span class="string">"piEstimate"</span>);</span><br><span class="line">      textElement.innerHTML = <span class="string">"Pi Estimate: "</span> + <span class="string">"loading"</span>;</span><br><span class="line">      requestId = <span class="built_in">window</span>.requestIdleCallback(refinePi);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">stop</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">// alert(1)</span></span><br><span class="line">      <span class="keyword">if</span> (requestId)</span><br><span class="line">        <span class="built_in">window</span>.cancelIdleCallback(requestId);</span><br><span class="line">      requestId = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">  &lt;button onclick="start()"&gt;Click me to start!&lt;/</span>button&gt;</span><br><span class="line">  &lt;button onclick=<span class="string">"stop()"</span>&gt;Click me to stop!<span class="xml"><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">  &lt;div id=<span class="string">"piEstimate"</span>&gt;Not started&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>body&gt;</span><br><span class="line"></span><br><span class="line">&lt;<span class="regexp">/html&gt;</span></span><br></pre></td></tr></table></figure>


<p>å‡ ä¸ªè¦ç‚¹</p>
<ol>
<li>requestIdleCallback ä¸­è¿›è¡Œçš„ dom å˜æ›´ï¼Œåªèƒ½åœ¨ä¸‹ä¸€å¸§çš„ Update Rendering é˜¶æ®µè¿›è¡Œæ¸²æŸ“<blockquote>
<p>stop æ—¶ piEstimate innerHTML å¸§æ¸²æŸ“å‰åä¸ä¸€è‡´</p>
</blockquote>
</li>
<li>requestIdleCallback æœ‰å…¼å®¹æ€§é—®é¢˜ï¼Œå¸¸ç”¨ requestAnimationFrame å’Œ MessageChannel å» fallback</li>
</ol>
<h3 id="requestAnimationFrame-MessageChannel"><a href="#requestAnimationFrame-MessageChannel" class="headerlink" title="requestAnimationFrame + MessageChannel"></a>requestAnimationFrame + MessageChannel</h3><p>requestAnimationFrame å°†åœ¨äº‹ä»¶å¾ªç¯ä¸­ <a href="https://html.spec.whatwg.org/multipage/webappapis.html#update-the-rendering" target="_blank" rel="noopener">UI Render é˜¶æ®µ</a>çš„å®é™…æ¸²æŸ“å‰æ‰§è¡Œï¼Œå¯ä»¥ç®€å•ç†è§£ä¸ºå¸§æ¸²æŸ“åˆæœŸ</p>
<p>MessageChannel ç”¨æ¥æ”¶å‘æ¶ˆæ¯å¼€å¯ä¸€ä¸ªå®ä»»åŠ¡ï¼Œç›¸æ¯” setTimeout å¯ä»¥æ›´å¿«æ‰§è¡Œï¼ˆ4msçš„åŸå› ï¼‰</p>
<p>æˆ‘ä»¬åœ¨ requestAnimationFrame è®¾ç½®ä¸€ä¸ªæ ‡è®°æ—¶é—´ç‚¹ markPoint ï¼Œå¹¶é€šè¿‡ MessageChannel å‘èµ·ä¸€ä¸ªå®ä»»åŠ¡ï¼Œè®¾ç½®è¯¥å®ä»»åŠ¡çš„è¿‡æœŸæ—¶é—´ä¸º markPoint + timeout(16ms) ï¼Œè¶…è¿‡è¿™ä¸ªæ—¶é—´ï¼Œä»»åŠ¡ä¸å†æ‰§è¡Œ</p>
<p>è¿™æ ·å¯ä»¥ä¿è¯å®ä»»åŠ¡ä¸ä¼šå› ä¸ºæ‰§è¡Œå¤ªä¹…å¯¼è‡´å¡é¡¿å’Œæ‰å¸§</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line"></span><br><span class="line">&lt;head&gt;</span><br><span class="line">  &lt;title&gt;Scheduling background tasks using requestIdleCallback&lt;<span class="regexp">/title&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>head&gt;</span><br><span class="line"></span><br><span class="line">&lt;body&gt;</span><br><span class="line">  &lt;script&gt;</span><br><span class="line">    <span class="keyword">const</span> timeout = <span class="number">16</span> <span class="comment">// é»˜è®¤ä¸€å¸§ä¸º16ms</span></span><br><span class="line">    <span class="keyword">var</span> requestId = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">var</span> pointsTotal = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">var</span> pointsInside = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">let</span> currentTask = &#123;</span><br><span class="line">      startTime: <span class="number">0</span>,</span><br><span class="line">      endTime: <span class="number">0</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> channel = <span class="keyword">new</span> MessageChannel();</span><br><span class="line">    <span class="keyword">var</span> sender = channel.port2; <span class="comment">// port2 ç”¨æ¥å‘æ¶ˆæ¯</span></span><br><span class="line">    channel.port1.onmessage = <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (performance.now() &gt; currentTask.endTime) &#123;</span><br><span class="line">        <span class="comment">// å¯èƒ½æ˜¯æ’å…¥äº†å…¶ä»–å®ä»»åŠ¡å¯¼è‡´è¯¥ä»»åŠ¡è¿‡æœŸï¼Œç›´æ¥ rAF</span></span><br><span class="line">        requestId = requestAnimationFrame(markPoint)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">      &#125;</span><br><span class="line">      refinePi(currentTask.endTime)</span><br><span class="line">      requestId = requestAnimationFrame(markPoint)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">piStep</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> r = <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">var</span> x = <span class="built_in">Math</span>.random() * r;</span><br><span class="line">      <span class="keyword">var</span> y = <span class="built_in">Math</span>.random() * r;</span><br><span class="line">      <span class="keyword">return</span> (<span class="built_in">Math</span>.pow(x, <span class="number">2</span>) + <span class="built_in">Math</span>.pow(y, <span class="number">2</span>) &lt; <span class="built_in">Math</span>.pow(r, <span class="number">2</span>))</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">refinePi</span>(<span class="params">deadline</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">while</span> (performance.now() &lt; deadline) &#123;</span><br><span class="line">        <span class="keyword">if</span> (piStep()) &#123;</span><br><span class="line">          pointsInside++;</span><br><span class="line">        &#125;</span><br><span class="line">        pointsTotal++;</span><br><span class="line">      &#125;</span><br><span class="line">      currentEstimate = (<span class="number">4</span> * pointsInside / pointsTotal);</span><br><span class="line">      textElement = <span class="built_in">document</span>.getElementById(<span class="string">"piEstimate"</span>);</span><br><span class="line">      textElement.innerHTML = <span class="string">"Pi Estimate: "</span> + currentEstimate;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">markPoint</span>(<span class="params">timestamp</span>) </span>&#123;</span><br><span class="line">      currentTask.startTime = timestamp</span><br><span class="line">      currentTask.endTime = timestamp + timeout</span><br><span class="line">      <span class="comment">// ä¸‹è½®å®ä»»åŠ¡</span></span><br><span class="line">      sender.postMessage(<span class="string">""</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">start</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      requestId = requestAnimationFrame(markPoint)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">stop</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">// alert(1)</span></span><br><span class="line">      <span class="keyword">if</span> (requestId)</span><br><span class="line">        <span class="built_in">window</span>.cancelAnimationFrame(requestId);</span><br><span class="line">      requestId = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">handle</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">let</span> start = performance.now()</span><br><span class="line">      <span class="keyword">while</span> (performance.now() - start &lt; <span class="number">100</span>) &#123; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">  &lt;button onclick="start()"&gt;Click me to start!&lt;/</span>button&gt;</span><br><span class="line">  &lt;button onclick=<span class="string">"stop()"</span>&gt;Click me to stop!<span class="xml"><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">  &lt;button onclick=<span class="string">"handle()"</span>&gt;æ‰§è¡Œè€—æ—¶ä»»åŠ¡ï¼Œè§‚å¯Ÿ PI çš„è®¡ç®—æƒ…å†µ&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">  &lt;div id="piEstimate"&gt;Not started&lt;/</span>div&gt;</span><br><span class="line">&lt;<span class="regexp">/body&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&lt;/</span>html&gt;</span><br></pre></td></tr></table></figure>

<p><a href="https://jsfiddle.net/bdsyf50c/" target="_blank" rel="noopener">åœ¨çº¿æµ‹è¯•</a></p>
<h2 id="æ‹“å±•é˜…è¯»"><a href="#æ‹“å±•é˜…è¯»" class="headerlink" title="æ‹“å±•é˜…è¯»"></a>æ‹“å±•é˜…è¯»</h2><ol>
<li><a href="https://www.w3.org/TR/requestidlecallback/" target="_blank" rel="noopener">Cooperative Scheduling of Background Tasks</a></li>
<li><a href="https://github.com/facebook/react/tree/master/packages/scheduler" target="_blank" rel="noopener">react-scheduler</a></li>
</ol>
]]></content>
      <categories>
        <category>å¤§å‰ç«¯</category>
      </categories>
      <tags>
        <tag>HTML</tag>
      </tags>
  </entry>
  <entry>
    <title>2020/æµ…è°ˆ React Fiber</title>
    <url>/2020/05/01/2020/%E6%B5%85%E8%B0%88%20React%20Fiber/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>çœ‹äº†å¾ˆå¤šå…³äº React Fiber çš„æ–‡ç« ï¼Œå¤§æ¦‚å°±æ˜¯è¿™æ ·ä¸€ä¸ªæ„æ€</p>
<p>React Fiber é¿å…äº†åŒæ­¥æ¸²æŸ“æ‰€æœ‰ç»„ä»¶å¯¼è‡´ä¸»çº¿ç¨‹å¡é¡¿ï¼Œç°åœ¨ä¼šæ ¹æ®ä¼˜å…ˆçº§å»æ¸²æŸ“</p>
<p>å¯èƒ½è¿˜ä¼šæ”¾å¼ƒä¹‹å‰å·²ç»æ¸²æŸ“åˆ°ä¸€åŠçš„è™šæ‹Ÿ dom</p>
]]></content>
  </entry>
  <entry>
    <title>é¢è¯•å®˜é—®ï¼šæ€ä¹ˆé¿å…å‡½æ•°è°ƒç”¨æ ˆæº¢å‡º</title>
    <url>/2020/04/14/2020/%E9%9D%A2%E8%AF%95%E5%AE%98%E9%97%AE%EF%BC%9A%E6%80%8E%E4%B9%88%E9%81%BF%E5%85%8D%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8%E6%A0%88%E6%BA%A2%E5%87%BA/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>åŸºå‹æœ€è¿‘é‡åˆ°çš„ä¸€é“é¢è¯•é¢˜</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/** </span></span><br><span class="line"><span class="comment"> * è¾“å‡º n-&gt;0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params">n</span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(n)</span><br><span class="line">  <span class="keyword">if</span>(n &gt; <span class="number">0</span>)&#123;</span><br><span class="line">    foo(n - <span class="number">1</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">foo(<span class="number">100000</span>)</span><br><span class="line"><span class="comment">// è¯·é—®è¾“å‡ºä»€ä¹ˆ</span></span><br></pre></td></tr></table></figure>

<p>ç­”æ¡ˆå¾ˆç®€å•ï¼Œæ ˆæº¢å‡ºå‘—ã€‚è§£å†³æ–¹æ³•ä¹Ÿå¾ˆç®€å•ï¼Œé€’å½’æ”¹è¿­ä»£å’¯ã€‚</p>
<p>æ­£å¸¸æ¥è¯´ï¼Œè¿™ä¸ªé—®é¢˜å°±åº”è¯¥ç»“æŸäº†ã€‚ã€‚é‚£è¦æ˜¯é¢è¯•å®˜å†è¿™æ ·é—®ä½  â€“</p>
<a id="more"></a>

<h2 id="é‚£ä½ çŸ¥é“å‡½æ•°æ‰§è¡Œæ ˆçš„ä¸Šé™ä¹ˆ"><a href="#é‚£ä½ çŸ¥é“å‡½æ•°æ‰§è¡Œæ ˆçš„ä¸Šé™ä¹ˆ" class="headerlink" title="é‚£ä½ çŸ¥é“å‡½æ•°æ‰§è¡Œæ ˆçš„ä¸Šé™ä¹ˆ"></a>é‚£ä½ çŸ¥é“å‡½æ•°æ‰§è¡Œæ ˆçš„ä¸Šé™ä¹ˆ</h2><p>åœ¨æ²¡çœ‹è¿‡ v8 é…ç½®çš„æƒ…å†µä¸‹å¯ä»¥è¿™æ ·æµ‹è¯•</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">c</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span> + c()</span><br><span class="line">  &#125; <span class="keyword">catch</span>(e)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">c()</span><br></pre></td></tr></table></figure>
<p>æµ‹è¯•ç»“æœï¼š</p>
<ul>
<li>win7x64 chrome74ï¼š25173</li>
<li>win7x64 chrome81: 12571</li>
<li>mbp chrome80: 12547</li>
<li>mbp chrome81: 12540</li>
<li>mbp Safari13: 36244</li>
</ul>
<p>å¯ä»¥å‘ç°ï¼Œä¸åŒçš„æ‰§è¡Œå¼•æ“ï¼Œæ‰§è¡Œå¼•æ“çš„ä¸åŒç‰ˆæœ¬ï¼Œä¸åŒçš„è®¾å¤‡é…ç½®éƒ½ä¼šå½±å“æ ˆçš„æ·±åº¦</p>
<p>åœ¨æ˜ç™½è¿™ç‚¹ä¹‹åæˆ‘ä»¬å†çœ‹è¿™ä¸ªä¾‹å­</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">c</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">let</span> arr = <span class="keyword">new</span> <span class="built_in">Array</span>(<span class="number">10000</span>).fill(<span class="number">1</span>)</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> res = c() + arr[<span class="number">999</span>]</span><br><span class="line">    <span class="comment">// æ— ç”¨ä»£ç </span></span><br><span class="line">    <span class="keyword">if</span>(res &lt; <span class="number">0</span>)&#123;</span><br><span class="line">      <span class="keyword">for</span>(<span class="keyword">let</span> i=<span class="number">0</span>;i&lt;arr.length;i++)&#123;</span><br><span class="line">        res+=arr[i]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line">  &#125; <span class="keyword">catch</span>(e)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">c()</span><br></pre></td></tr></table></figure>
<p>åœ¨ win7x64 chrome81 å¾—åˆ°çš„ç»“æœä¸ºï¼š 9669</p>
<p>å¯ä»¥å‘ç°ï¼Œè°ƒç”¨æ ˆçš„æ·±åº¦å–å†³äºè°ƒç”¨å‡½æ•°çš„å‡½æ•°ä½“å¤§å°å’Œæœ¬åœ°å˜é‡çš„ä¸ªæ•°</p>
<p>ç”±äºæ ˆçš„å®¹é‡(size)æ˜¯å›ºå®šçš„ï¼Œå…¶å®æ›´åº”è¯¥å…³æ³¨æ ˆçš„å®¹é‡ï¼Œè€Œä¸æ˜¯æ ˆçš„æ·±åº¦</p>
<p>åœ¨ Node.js ä¸­ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹æ ˆçš„å®¹é‡</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ node --v8-options | grep stack-size -A 1</span><br><span class="line">  --stack-size (default size of stack region v8 is allowed to use (<span class="keyword">in</span> kBytes))</span><br><span class="line">        <span class="built_in">type</span>: int  default: 984</span><br><span class="line">--</span><br><span class="line">  --sim-stack-size (Stack size of the ARM64, MIPS64 and PPC64 simulator <span class="keyword">in</span> kByte</span><br><span class="line">s (default is 2 MB))</span><br><span class="line">        <span class="built_in">type</span>: int  default: 2048</span><br></pre></td></tr></table></figure>
<p>win7x64 å’Œ mbp çš„ Node.js 12 è¾“å‡ºå‡ä¸€è‡´ï¼Œé»˜è®¤æ ˆå¤§å°ä¸º 984KB</p>
<p>æˆ‘ä»¬å¯ä»¥åœ¨è¿è¡Œæ—¶æŒ‡å®šæ ˆçš„å¤§å°æ¥é˜²æ­¢æ ˆæº¢å‡ºï¼Œè¿˜æ˜¯ä¸Šé¢é‚£ä¸ªä¾‹å­ï¼Œåœ¨ node.js ä¸Šæµ‹è¯•ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params">n</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(n &gt; <span class="number">0</span>)&#123;</span><br><span class="line">    foo(n - <span class="number">1</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">foo(<span class="number">20000</span>)</span><br></pre></td></tr></table></figure>
<p>ç›´æ¥æ‰§è¡Œ <code>node a.js</code> ä¼šæ ˆæº¢å‡ºï¼Œä½†æ˜¯</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">node --stack-size&#x3D;1968 a.js</span><br></pre></td></tr></table></figure>
<p>åˆ™ä¸ä¼šã€‚</p>
<p>æ€»çš„æ¥è¯´ï¼Œåœ¨æ—¥å¸¸å¼€å‘ä¸­ï¼Œå¦‚æœæœ‰æ•°åƒçš„é€’å½’ï¼Œå°±éœ€è¦è€ƒè™‘é‡å†™ä¼˜åŒ–äº†ï¼Œå¦åˆ™æœ‰äº›å¹³å°å°†å¯¼è‡´é”™è¯¯</p>
<h2 id="å¬è¿‡å°¾è°ƒç”¨å’Œå°¾é€’å½’ä¹ˆ"><a href="#å¬è¿‡å°¾è°ƒç”¨å’Œå°¾é€’å½’ä¹ˆ" class="headerlink" title="å¬è¿‡å°¾è°ƒç”¨å’Œå°¾é€’å½’ä¹ˆ"></a>å¬è¿‡å°¾è°ƒç”¨å’Œå°¾é€’å½’ä¹ˆ</h2><p>å°¾è°ƒç”¨å³åœ¨å‡½æ•°çš„æœ€åä¸€æ­¥è°ƒç”¨å¦ä¸€ä¸ªå‡½æ•°ï¼Œè€Œå°¾é€’å½’åˆ™æ˜¯å‡½æ•°çš„æœ€åä¸€æ­¥è°ƒç”¨è‡ªèº«</p>
<p>æ³¨æ„ï¼Œæœ€åä¸€æ­¥éœ€è¦æ˜¯å•ä¸ªå‡½æ•°è°ƒç”¨ï¼Œä»¥ä¸‹ä»£ç å‡ä¸æ˜¯å°¾è°ƒç”¨</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">a</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">let</span> t = b()</span><br><span class="line">  <span class="keyword">return</span> t</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">b</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  c()</span><br><span class="line">  <span class="comment">// ç­‰æ•ˆäº</span></span><br><span class="line">  <span class="comment">// return undefined</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">c</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> d() + <span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨å°¾è°ƒç”¨å’Œå°¾é€’å½’ï¼Œå¯ä»¥é¿å…ä¸­é—´æ— ç”¨çš„ä¸Šä¸‹æ–‡ï¼ˆè°ƒç”¨å¸§ï¼‰ï¼Œä»…ä¿ç•™æœ€å¤–å±‚å’Œå½“å‰å±‚ï¼Œé¿å…æ ˆæº¢å‡º</p>
<h2 id="é¢˜ç›®è¦é‡‡ç”¨å°¾é€’å½’è§£å†³ï¼Œæ€ä¹ˆæ”¹"><a href="#é¢˜ç›®è¦é‡‡ç”¨å°¾é€’å½’è§£å†³ï¼Œæ€ä¹ˆæ”¹" class="headerlink" title="é¢˜ç›®è¦é‡‡ç”¨å°¾é€’å½’è§£å†³ï¼Œæ€ä¹ˆæ”¹"></a>é¢˜ç›®è¦é‡‡ç”¨å°¾é€’å½’è§£å†³ï¼Œæ€ä¹ˆæ”¹</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params">n</span>)</span>&#123;</span><br><span class="line"><span class="meta">  'use strict'</span>;</span><br><span class="line">  <span class="built_in">console</span>.log(n)</span><br><span class="line">  <span class="keyword">if</span>(n &gt; <span class="number">0</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> foo(n - <span class="number">1</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ES6 çš„å°¾è°ƒç”¨ä¼˜åŒ–åªåœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹å¼€å¯ï¼Œä¸»è¦åŸå› åœ¨äºæ­£å¸¸æ¨¡å¼ä¸‹å‡½æ•°æœ‰ä¸¤ä¸ªå˜é‡å¯ä»¥è·Ÿè¸ªå‡½æ•°çš„è°ƒç”¨æ ˆ</p>
<ul>
<li>func.argumentsï¼šè¿”å›è°ƒç”¨æ—¶å‡½æ•°çš„å‚æ•°</li>
<li>func.callerï¼šè¿”å›è°ƒç”¨å½“å‰å‡½æ•°çš„é‚£ä¸ªå‡½æ•°<br>è¿™ä¸¤ä¸ªå˜é‡åœ¨å°¾è°ƒç”¨ä¼˜åŒ–ä¸Šçš„å€¼ä¸æœªä¼˜åŒ–çš„æƒ…å†µä¸ä¸€è‡´ï¼Œè€Œä¸¥æ ¼æ¨¡å¼ä¸‹è¿™ä¸¤ä¸ªå˜é‡æ˜¯ç¦ç”¨çš„ï¼Œè¿™æ ·å¯ä»¥ä¿è¯è°ƒç”¨æ ˆçš„æ­£ç¡®æ€§</li>
</ul>
<h2 id="æµè§ˆå™¨çš„å…¼å®¹æ€§æ€ä¹ˆæ ·"><a href="#æµè§ˆå™¨çš„å…¼å®¹æ€§æ€ä¹ˆæ ·" class="headerlink" title="æµè§ˆå™¨çš„å…¼å®¹æ€§æ€ä¹ˆæ ·"></a>æµè§ˆå™¨çš„å…¼å®¹æ€§æ€ä¹ˆæ ·</h2><p>å¦‚æœæŠŠä¸Šé¢é‚£æ®µä»£ç æ”¾åœ¨ chrome æ§åˆ¶å°æ‰§è¡Œï¼Œè¿˜æ˜¯ä¼šæŠ¥æ ˆæº¢å‡ºã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥çœ‹ä¸‹<a href="http://kangax.github.io/compat-table/es6/" target="_blank" rel="noopener">å°¾è°ƒç”¨ä¼˜åŒ–çš„å…¼å®¹æ€§</a></p>
<p>å¯ä»¥çœ‹åˆ°ä¸»æµæµè§ˆå™¨åŸºæœ¬ä¸Šåªæœ‰ Safari æ”¯æŒï¼ŒæŠŠä¸Šè¿°é‚£æ®µä»£ç æ”¾ Safari ä¸Šæµ‹è¯•äº†ä¸‹æ˜¯å¯ä»¥é€šè¿‡çš„</p>
<p>æ‰€ä»¥åœ¨æµè§ˆå™¨ç¯å¢ƒï¼Œè¿˜æ˜¯ä¸æ˜¯æƒ³ç€åˆ©ç”¨å°¾é€’å½’æ¥è§£å†³é—®é¢˜</p>
<h2 id="Node-js-èƒ½ä½¿ç”¨å°¾é€’å½’ä¹ˆ"><a href="#Node-js-èƒ½ä½¿ç”¨å°¾é€’å½’ä¹ˆ" class="headerlink" title="Node.js èƒ½ä½¿ç”¨å°¾é€’å½’ä¹ˆ"></a>Node.js èƒ½ä½¿ç”¨å°¾é€’å½’ä¹ˆ</h2><p>åœ¨ node 6,7 å¯ä»¥é€šè¿‡ <code>--harmony-tailcalls</code> å¼€å¯ï¼Œè€Œåœ¨ 8 ä¹‹ååˆ æ‰äº†è¿™ä¸ªé€‰é¡¹ã€‚</p>
<p>æ‰€ä»¥å¯ä»¥ç†è§£ä¸º Node.js ä¸æ”¯æŒå°¾é€’å½’</p>
<h2 id="å°¾é€’å½’çœ‹ç€è¿™ä¹ˆå¥½ï¼Œä¸ºä»€ä¹ˆè¿™ä¹ˆå¤šæ‰§è¡Œå¼•æ“ä¸æ”¯æŒï¼Ÿ"><a href="#å°¾é€’å½’çœ‹ç€è¿™ä¹ˆå¥½ï¼Œä¸ºä»€ä¹ˆè¿™ä¹ˆå¤šæ‰§è¡Œå¼•æ“ä¸æ”¯æŒï¼Ÿ" class="headerlink" title="å°¾é€’å½’çœ‹ç€è¿™ä¹ˆå¥½ï¼Œä¸ºä»€ä¹ˆè¿™ä¹ˆå¤šæ‰§è¡Œå¼•æ“ä¸æ”¯æŒï¼Ÿ"></a>å°¾é€’å½’çœ‹ç€è¿™ä¹ˆå¥½ï¼Œä¸ºä»€ä¹ˆè¿™ä¹ˆå¤šæ‰§è¡Œå¼•æ“ä¸æ”¯æŒï¼Ÿ</h2><p>å…³äºè¿™ä¸ªé—®é¢˜ï¼ŒV8 çš„<a href="https://v8.dev/blog/modern-javascript" target="_blank" rel="noopener">è¿™ç¯‡æ–‡ç« </a>ç»™å‡ºäº†ç­”æ¡ˆ</p>
<p>æ¦‚æ‹¬å¦‚ä¸‹</p>
<h3 id="1-éšå¼ä¼˜åŒ–é—®é¢˜"><a href="#1-éšå¼ä¼˜åŒ–é—®é¢˜" class="headerlink" title="1. éšå¼ä¼˜åŒ–é—®é¢˜"></a>1. éšå¼ä¼˜åŒ–é—®é¢˜</h3><p>å¼•æ“æ¶ˆé™¤å°¾è°ƒç”¨æ˜¯éšå¼çš„ï¼Œç¨‹åºå‘˜å¾ˆéš¾ç¡®å®šå“ªäº›å‡½æ•°å®é™…ä¸Šä½äºå°¾éƒ¨è°ƒç”¨ä½ç½®ï¼Œè¿™å¯¼è‡´äº†ç¨‹åºå‘˜åœ¨ç¼–ç æ—¶å¾—ä¸æ–­çš„è°ƒè¯•æ‰èƒ½å†™å‡ºæ­£ç¡®çš„å°¾é€’å½’æ–¹æ³•ã€‚</p>
<h3 id="2-æ ˆå¸§ä¸¢å¤±"><a href="#2-æ ˆå¸§ä¸¢å¤±" class="headerlink" title="2. æ ˆå¸§ä¸¢å¤±"></a>2. æ ˆå¸§ä¸¢å¤±</h3><p>å°¾è°ƒç”¨ä¼šæ¸…é™¤ä¸­é—´æ‰§è¡Œæ ˆå¸§ï¼Œå¯¼è‡´ error.stack ä¸­åŒ…å«çš„æœ‰å…³æ‰§è¡Œæµç¨‹çš„ä¿¡æ¯è¾ƒå°‘ï¼Œè¿›è€Œå½±å“ä¾èµ–è°ƒç”¨å †æ ˆä¿¡æ¯çš„è°ƒè¯•å’Œé”™è¯¯æ”¶é›†è¿‡ç¨‹</p>
<h2 id="STC-äº†è§£ä¹ˆï¼Ÿ"><a href="#STC-äº†è§£ä¹ˆï¼Ÿ" class="headerlink" title="STC äº†è§£ä¹ˆï¼Ÿ"></a>STC äº†è§£ä¹ˆï¼Ÿ</h2><p>STC æ˜¯ä¸ºäº†è§£å†³å°¾è°ƒç”¨ä¼˜åŒ–ä¸å—å¼€å‘è€…æ§åˆ¶çš„é—®é¢˜ï¼Œé€šè¿‡æ–°çš„è¯­æ³•ç³–æ˜¾å¼æŒ‡å®šå°¾è°ƒç”¨ï¼Œæ¯”å¦‚ <code>return continue foo(n-1)</code></p>
<p>åœ¨éå°¾è°ƒç”¨çš„åœºæ™¯ä¸‹ä½¿ç”¨è¯¥è¯­æ³•ç³–åˆ™ä¼šæŠ¥é”™</p>
<p>å…·ä½“çš„å¯ä»¥çœ‹ <a href="https://github.com/tc39/proposal-ptc-syntax/blob/master/README.md" target="_blank" rel="noopener">tc39 - proposal-ptc-syntax</a></p>
<hr>
<h2 id="æ‹“å±•é˜…è¯»"><a href="#æ‹“å±•é˜…è¯»" class="headerlink" title="æ‹“å±•é˜…è¯»"></a>æ‹“å±•é˜…è¯»</h2><ul>
<li><a href="https://zhuanlan.zhihu.com/p/46993552" target="_blank" rel="noopener">æ·±å…¥ç†è§£ V8 çš„ Call Stack</a></li>
<li><a href="https://imweb.io/topic/5a244260a192c3b460fce275" target="_blank" rel="noopener">å°¾é€’å½’çš„åç»­æ¢ç©¶</a></li>
<li><a href="https://es6.ruanyifeng.com/#docs/function#%E5%B0%BE%E8%B0%83%E7%94%A8%E4%BC%98%E5%8C%96" target="_blank" rel="noopener">å°¾è°ƒç”¨ä¼˜åŒ–</a></li>
</ul>
]]></content>
      <categories>
        <category>å¤§å‰ç«¯</category>
      </categories>
      <tags>
        <tag>ECMAScript</tag>
        <tag>é¢è¯•é¢˜</tag>
      </tags>
  </entry>
  <entry>
    <title>å®ç°ç¬¬ä¸‰æ–¹ç™»å½•æ— åˆ·æ–°æ›´æ–°é¡µé¢</title>
    <url>/2020/04/12/2020/%E5%AE%9E%E7%8E%B0%E7%AC%AC%E4%B8%89%E6%96%B9%E7%99%BB%E5%BD%95%E6%97%A0%E5%88%B7%E6%96%B0%E6%9B%B4%E6%96%B0%E9%A1%B5%E9%9D%A2/</url>
    <content><![CDATA[<h2 id="éœ€æ±‚èƒŒæ™¯"><a href="#éœ€æ±‚èƒŒæ™¯" class="headerlink" title="éœ€æ±‚èƒŒæ™¯"></a>éœ€æ±‚èƒŒæ™¯</h2><p>æœ€è¿‘åœ¨ç ”ç©¶ iqiyi çš„ç™»å½•æµç¨‹ï¼Œå‘ç°ä»–ä»¬çš„ç¬¬ä¸‰æ–¹ç™»å½•ä½“éªŒæŒºå¥½çš„ã€‚</p>
<p>åœ¨ç›®æ ‡é¡µé¢ï¼ˆä»¥ä¸‹ç›®æ ‡é¡µé¢å‡æŒ‡ç”¨æˆ·å½“å‰æµè§ˆçš„é¡µé¢ï¼‰ç‚¹å‡»ç™»å½•ï¼Œå¼¹å‡ºç™»å½•å¼¹æ¡†ï¼Œé€‰æ‹©ç¬¬ä¸‰æ–¹ç™»å½•ï¼Œæ¯”å¦‚ qqï¼Œå¾®ä¿¡ï¼Œç‚¹å‡»åˆ™æ–°å¼€é¡µé¢ã€‚</p>
<p>åœ¨æ–°é¡µé¢ä¸­ç™»å½•å®Œæ¯•ï¼Œé¡µé¢ä¼šè‡ªåŠ¨å…³é—­ï¼Œä¸”åˆšåˆšé‚£ä¸ªé¡µé¢ä¸åˆ·æ–°ä¸”è‡ªåŠ¨è¿›è¡ŒçŠ¶æ€å˜æ›´</p>
<a id="more"></a>

<h2 id="é¦–å…ˆæ˜¯é¡µé¢è‡ªåŠ¨å…³é—­"><a href="#é¦–å…ˆæ˜¯é¡µé¢è‡ªåŠ¨å…³é—­" class="headerlink" title="é¦–å…ˆæ˜¯é¡µé¢è‡ªåŠ¨å…³é—­"></a>é¦–å…ˆæ˜¯é¡µé¢è‡ªåŠ¨å…³é—­</h2><p>è¿™ä¸ªå¾ˆç®€å•ï¼Œé€šè¿‡ <code>window.close()</code> å³å¯å®ç°</p>
<p>ä½†æ˜¯é—®é¢˜æ˜¯ï¼Œç¬¬ä¸‰æ–¹ç™»å½•é¡µä¸€èˆ¬ä¸ä¼šè‡ªå·±åœ¨ä»£ç ä¸­åšè¿™ä»¶äº‹ï¼Œæ¯•ç«Ÿä¸€èˆ¬ç™»å½•åæ˜¯é‡å®šå‘åˆ°æŸä¸ªé¡µé¢ï¼ˆé€šè¿‡ ticket å†™å…¥ cookie ï¼‰è€Œä¸æ˜¯å…³é—­å½“å‰é¡µé¢</p>
<p>é‚£ä¹ˆå¦‚ä½•å…³é—­å‘¢ï¼Ÿå…¶å®ä¹Ÿå¾ˆç®€å•ï¼Œè®©ç›®æ ‡é¡µé¢æ‰§è¡Œç™»å½•é¡µçš„å…³é—­å³å¯</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">newWin = <span class="built_in">window</span>.open(<span class="string">"//open.weixin.qq.com"</span>)</span><br><span class="line"><span class="comment">// åœ¨æŸä¸ªæ—¶æœº</span></span><br><span class="line">newWin.close()</span><br></pre></td></tr></table></figure>

<p>è‡³äºè¿™ä¸ªæ—¶æœºï¼Œå°±æ˜¯ç™»å½•æˆåŠŸä¹‹åã€‚</p>
<p>é‚£ä¹ˆç›®æ ‡é¡µé¢å¦‚ä½•çŸ¥é“ç™»å½•æˆåŠŸäº†ï¼Ÿ</p>
<p>ä½ å¯èƒ½ä¼šæƒ³è¯´å¯ä»¥åˆ©ç”¨è½®è¯¢å•Šï¼Œé•¿è¿æ¥å•Šï¼Œå†æˆ–è€… websocket å’¯</p>
<p>è¿™ä¸ªæ˜¯å¯ä»¥å®ç°ï¼Œä½†æ˜¯é¢å¤–æµªè´¹äº†æ€§èƒ½ï¼Œå…¶å®åœ¨å½“å‰é¡µé¢ï¼ˆç™»å½•å®Œé‡å®šå‘çš„é¡µé¢ï¼‰é€šè¿‡ <code>window.opener</code> æ“ä½œç›®æ ‡é¡µé¢</p>
<blockquote>
<p>è‡³äºè¿™ä¸œè¥¿æ˜¯å•¥ï¼Œå¤§å®¶åº”è¯¥éƒ½çŸ¥é“ï¼Œä¸æ‡‚çš„çœ‹ MDN</p>
</blockquote>
<p>æ‰€ä»¥è¿™å°±è¦æ±‚ï¼Œç™»å½•å®Œæˆ‘ä»¬æœ€åé‡å®šå‘çš„é¡µé¢é™¤äº†å†™å…¥ cookie çš„ä½œç”¨ï¼Œè¿˜æœ‰å°±æ˜¯æ“ä½œ <code>window.opener</code></p>
<p>æ¯”å¦‚è¿™æ˜¯ iqiyi ç¬¬ä¸‰æ–¹ç™»å½•åé‡å®šå‘çš„é¡µé¢ <code>https://passport.iqiyi.com/oauth/closepage.php?fromurl=&amp;from=29&amp;isNew=0</code></p>
<p>å…¶é¡µé¢ä»£ç å°±æ˜¯ä»¥ä¸‹ç®€å•çš„å‡ è¡Œ</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span><span class="tag">&lt;<span class="name">head</span>&gt;</span><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript"><span class="comment">//æˆåŠŸè°ƒç”¨</span></span></span><br><span class="line"><span class="javascript"><span class="built_in">document</span>.domain=<span class="string">"iqiyi.com"</span>;</span></span><br><span class="line"><span class="javascript"><span class="built_in">window</span>.opener.lib.__callbacks__._oAuthSuccess(<span class="string">'http://passport.iqiyi.com/pages/user/success.action'</span>);</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span><span class="tag">&lt;<span class="name">body</span>&gt;</span><span class="tag">&lt;/<span class="name">body</span>&gt;</span><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œéœ€è¦å°† domain è®¾ä¸ºä¸€è‡´ï¼Œæ‰èƒ½æ“ä½œç›¸åŒ domain çš„ window </p>
<blockquote>
<p>æ˜¯çš„ï¼Œ <a href="http://www.iqiyi.com" target="_blank" rel="noopener">www.iqiyi.com</a> çš„ domain ä¹Ÿè¢«æ”¹ä¸ºäº† â€œiqiyi.comâ€ äº†ï¼ŒåŒæ ·çš„ï¼Œ iqiyi çš„å…¶ä»–å­åŸŸåæ¯”å¦‚ <code>https://edu.iqiyi.com/</code> ç­‰éƒ½æ”¹å†™äº† domainï¼Œä½¿å¾—å…¨ç«™éƒ½èƒ½é¡ºæ»‘çš„å®ç°æ— åˆ·æ–°ç™»å½•</p>
</blockquote>
<p>æœ€åçœ‹çœ‹ä»£ç ä¸­çš„ <code>window.opener.lib.__callbacks__._oAuthSuccess(xxx)</code> ,å…¶å®ä½œç”¨ä¹Ÿå¾ˆç®€å•ï¼Œä¸€æ˜¯å…³é—­æ–°å¼€é¡µé¢ï¼ŒäºŒæ˜¯è·å–ç”¨æˆ·ä¿¡æ¯å¹¶æ›´æ–°çŠ¶æ€</p>
<p>è¿™æ ·å·®ä¸å¤šå°±å®ç°äº†æˆ‘ä»¬çš„éœ€æ±‚ï¼Œå¦å¤–è¿˜æœ‰ä¸€ç‚¹æ²¡æåˆ°çš„æ˜¯ï¼Œå†™å…¥ cookie çš„æ—¶å€™ï¼Œdomain iqiyi å†™çš„æ˜¯äºŒçº§åŸŸå <code>.iqiyi.com</code> ï¼Œè¿™æ ·å…¶ä»–ä¸‰çº§åŸŸåå¦‚ <code>edu.iqiyi.com</code> æ‰èƒ½å…±ç”¨ cookie</p>
<p>PSï¼šåœ¨æµ‹è¯•è¿‡ç¨‹ä¸­å‘ç°æœ‰ iqiyi æœ‰ä¸¤ä¸ªbug(æˆªæ­¢ 20/04/12)ï¼Œå½“ç„¶ï¼Œæ™®é€šç”¨æˆ·ä½¿ç”¨ä¸€èˆ¬ä¸ä¼šå‡ºç°ã€‚ã€‚</p>
<ul>
<li>è‹¥ç™»å½•å¼¹æ¡†å…³é—­ï¼Œç¬¬ä¸‰æ–¹ç™»å½•æˆåŠŸåä¸ä¼šè‡ªåŠ¨å…³é—­é¡µé¢ä¸”ä¸è¿›è¡Œç”¨æˆ·ä¿¡æ¯è¯·æ±‚ï¼Œè¿™ä¸ªæ˜¯ç”±äº _oAuthSuccess å…¶å®æ˜¯è°ƒç”¨çš„ç™»å½•çª—å£ iframe ä¸­çš„æ–¹æ³•</li>
<li>æ‰‹åŠ¨è°ƒç”¨ _oAuthSuccess æ–¹æ³•ï¼Œå¤´åƒå˜æˆç™»å½•åçš„é»˜è®¤å¤´åƒï¼Œæ­¤æ—¶å…¶å®å¹¶æ²¡æœ‰ç™»å½•</li>
</ul>
<h2 id="é‚£ä»¥ä¸Šæ–¹æ¡ˆæœ‰ä»€ä¹ˆé—®é¢˜ä¹ˆï¼Ÿ"><a href="#é‚£ä»¥ä¸Šæ–¹æ¡ˆæœ‰ä»€ä¹ˆé—®é¢˜ä¹ˆï¼Ÿ" class="headerlink" title="é‚£ä»¥ä¸Šæ–¹æ¡ˆæœ‰ä»€ä¹ˆé—®é¢˜ä¹ˆï¼Ÿ"></a>é‚£ä»¥ä¸Šæ–¹æ¡ˆæœ‰ä»€ä¹ˆé—®é¢˜ä¹ˆï¼Ÿ</h2><p>é™¤äº†å…¨ç«™éœ€è¦æ”¹é€  <code>document.domain</code> å¤–ï¼Œæ­£å¸¸æ¥è¯´æ˜¯æ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯å¯èƒ½ä¼šé‡åˆ°ä¸èƒ½ä¿®æ”¹ domain çš„åœºæ™¯ï¼Œä½ è¦æ˜¯é—®æˆ‘æœ‰å“ªäº›åœºæ™¯ï¼Œemmmmâ€¦åæ­£æˆ‘å°±æ˜¯ä¸ºäº†è¯´æˆ‘çš„æ–°æ–¹æ¡ˆçš„ï¼Œæ–°æ–¹æ¡ˆå°±æ˜¯ postMessage</p>
<blockquote>
<p>æˆ‘ç°åœ¨èƒ½æƒ³åˆ°çš„ä¸€ä¸ªï¼Œæ¯”å¦‚æœ€åä¸€ä¸ªé‡å®šå‘çš„æœ€åä¸€ä¸ªé¡µé¢ä¸æ˜¯ <code>.iqiyi.com</code>åŸŸåï¼Œè€Œæ˜¯å…¶ä»–é¡µé¢ï¼ˆå¯èƒ½æ˜¯ä¸ºäº†é›†å›¢å†…å¤šä¸ªäº§å“å¤ç”¨å§ï¼‰ï¼Œæ¯”å¦‚ <code>util.baidu.com</code></p>
</blockquote>
<p><a href="http://www.iqiyi.com" target="_blank" rel="noopener">www.iqiyi.com</a></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">newWin = <span class="built_in">window</span>.open(<span class="string">"//util.baidu.com"</span>)</span><br><span class="line"><span class="built_in">window</span>.addEventListener(<span class="string">"message"</span>,(evt)=&gt;&#123;</span><br><span class="line">    <span class="comment">// æ ¹æ®ä¿¡æ¯æ¥æºè¿›è¡Œç‰¹æ®Šå¤„ç†ï¼Œé¿å…å—å…¶ä»– postMessage å½±å“</span></span><br><span class="line">    <span class="keyword">if</span>(evt.origin === <span class="string">"https://util.baidu.com"</span>)&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(evt.data)</span><br><span class="line">        newWin.close()</span><br><span class="line">        <span class="comment">// or</span></span><br><span class="line">        <span class="comment">// evt.source.close()</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>util.baidu.com</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">window</span>.opener.postMessage(<span class="string">"test"</span>,<span class="string">"*"</span>) <span class="comment">//æ‰€æœ‰</span></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥åœ¨ <a href="http://www.iqiyi.com" target="_blank" rel="noopener">www.iqiyi.com</a> ä¸­çœ‹åˆ°è¾“å‡ºï¼Œä¸” util.baidu.com è‡ªåŠ¨å…³é—­</p>
<p>å½“ç„¶è¯¥æ–¹æ¡ˆä¹Ÿæœ‰ä¸å¥½çš„åœ°æ–¹ï¼Œå°±æ˜¯ postMessage ä½¿ç”¨ä¸å½“ä¼šå¯¼è‡´å®‰å…¨é—®é¢˜ï¼Œä¸»è¦æœ‰ä»¥ä¸‹2ç‚¹</p>
<ol>
<li><p>postMessage ç¬¬äºŒä¸ªå‚æ•° targetOrigin è®¾ç½®ä¸º * å¯èƒ½å¯¼è‡´æ•°æ®æ³„éœ²<br>æ¯”å¦‚ä½¿ç”¨äº†æŸä¸ªä¸å®‰å…¨çš„ç¬¬ä¸‰æ–¹ç™»å½•é¡µé¢ï¼Œå…¶å¯¹ç›®æ ‡ç½‘ç«™è¿›è¡Œäº†é‡å®šå‘ï¼Œæ¯”å¦‚å˜æˆ <code>www.ihack.com</code> ï¼Œç¬¬ä¸‰æ–¹ç™»å½•åé€šè¿‡ postMessage ä¼ é€’éšç§ä¿¡æ¯ï¼Œç”±äºè®¾ç½®çš„æ˜¯ * ï¼Œå¯¼è‡´ <code>www.ihack.com</code> å¯ä»¥æ”¶åˆ°éšç§ä¿¡æ¯ã€‚å½“ç„¶ä½ åé¢å‘ç°è¿™ä¸ª ihack ç½‘ç«™ä¸æ­£å¸¸ä¹Ÿæ²¡ç”¨ï¼Œå› ä¸ºæ•°æ®å·²ç»æ³„éœ²äº†ã€‚<br>è§£å†³æ–¹æ¡ˆå°±æ˜¯ targetOrigin è®¾ç½®ä¸ºç‰¹å®šçš„åœ°å€æ¯”å¦‚ <code>edu.iqiyi.como</code> ï¼Œè¿™å°±éœ€è¦æˆ‘ä»¬å°†å½“å‰é¡µé¢ä½œä¸ºä¼ é€’åˆ°é‡å®šå‘é¡µé¢ <br>ä¸¾ä¾‹ï¼Œåƒç¬¬ä¸‰æ–¹ç™»å½•é¡µä¼ é€’è¿™æ ·çš„å‚æ•° â€“ <code>&amp;redirect_uri=https://passport.iqiyi.com?targetOrigin=edu.iqiyi.com</code> , ç¬¬ä¸‰æ–¹ç™»å½•åé‡å®šå‘åˆ° passport å†™å…¥ cookie ï¼Œå†æ¬¡é‡å®šå‘åˆ° <code>https://util.baidu.com?targetOrigin=edu.iqiyi.com</code> ï¼Œå†å½“å‰é¡µé¢è¯»å– targetOrigin å‚æ•°å¹¶ä¼ é€’ postMessage ã€‚æ•´ä¸ªå°±æ˜¯è¿™æ ·çš„ä¸€ä¸ªè¿‡ç¨‹ <br>å½“ç„¶åœ¨æœ¬ä¾‹ä¸­ä¸éœ€è¦ä¼ é€’éšç§ä¿¡æ¯</p>
</li>
<li><p>æ¥æ”¶ message æ—¶è¯·å§‹ç»ˆä½¿ç”¨ origin å’Œ source å±æ€§éªŒè¯å‘ä»¶äººçš„èº«ä»½<br>æ¯”å¦‚ç‚¹å‡»æ‰“å¼€äº†ç”¨æˆ·è¯„è®ºçš„ urlï¼ˆæŸä¸ªé»‘å®¢ç½‘ç«™ï¼‰ï¼Œå…¶å¯¹ç›®æ ‡é¡µé¢å‘èµ· postMessage ï¼Œè€Œæˆ‘ä»¬å¦‚æœåœ¨æ”¶åˆ° message æ—¶ä¸è¿›è¡ŒéªŒè¯å°±æ‰§è¡Œå±é™©æ“ä½œæ—¶ï¼Œå¯èƒ½å°±ä¼šå¯¼è‡´å®‰å…¨é—®é¢˜<br>å¦å¤–ï¼Œå¦‚æœå›è°ƒæ‰§è¡Œå®‰å…¨æ€§ä¾èµ–äºæ¶ˆæ¯çš„è¯ï¼ˆæ¯”å¦‚æ‰§è¡Œ <code>eval(msg.data)</code>ï¼‰ï¼Œå³ä½¿æ£€æŸ¥é€šè¿‡ï¼Œè¿˜éœ€è¦å¯¹æ¶ˆæ¯æ ¼å¼å†ä¸€æ¬¡æ£€æŸ¥ï¼Œé¿å…å› ä¿¡ä»»ç½‘ç«™æ”¶åˆ°è·¨ç«™è„šæœ¬æ”»å‡»è€Œå¯¼è‡´æœ¬ç½‘ç«™ä¹Ÿé­åˆ°æ”»å‡»<br>å½“ç„¶åœ¨æœ¬ä¾‹ä¸­åªæ˜¯ç®€å•çš„å…³é—­æ–°å¼€é¡µé¢åŠå‘é€è¯·æ±‚ï¼Œæ²¡æœ‰ä»€ä¹ˆå±é™©æ“ä½œï¼Œæ£€æŸ¥ä¸‹ origin å³å¯</p>
</li>
</ol>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>domain é€‚ç”¨äºå¤§éƒ¨åˆ†æƒ…æ™¯ï¼Œæœ‰å…¨ç«™æ”¹é€  <code>document.domain</code> çš„æˆæœ¬ï¼Œä¸”æœ€åé‡å®šå‘é¡µé¢éœ€è¦æ˜¯ç›¸åŒçš„ domain</p>
<p>postMessage é€‚ç”¨äºæ‰€æœ‰æƒ…æ™¯ï¼Œå¯¹äºå®‰å…¨é—®é¢˜éœ€è¦é¢å¤–å¤„ç†</p>
<p>ä¸¤ç§æ–¹æ¡ˆå„æœ‰åƒç§‹ï¼Œçœ‹å°±å…·ä½“çš„åœºæ™¯å•¦~</p>
<h2 id="å‚è€ƒæ–‡æ¡£"><a href="#å‚è€ƒæ–‡æ¡£" class="headerlink" title="å‚è€ƒæ–‡æ¡£"></a>å‚è€ƒæ–‡æ¡£</h2><ul>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/postMessage" target="_blank" rel="noopener">postMessage</a></li>
</ul>
]]></content>
      <categories>
        <category>å¤§å‰ç«¯</category>
      </categories>
      <tags>
        <tag>éšç¬”</tag>
      </tags>
  </entry>
  <entry>
    <title>é¢è¯•å®˜é—®ï¼šèƒ½å¦å®ç°ä¸€ä¸ªç¼“å­˜è®¡ç®—ç»“æœçš„æ–¹æ³•</title>
    <url>/2020/03/31/2020/%E9%9D%A2%E8%AF%95%E5%AE%98%E9%97%AE%EF%BC%9A%E8%83%BD%E5%90%A6%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E7%BC%93%E5%AD%98%E8%AE%A1%E7%AE%97%E7%BB%93%E6%9E%9C%E7%9A%84%E6%96%B9%E6%B3%95/</url>
    <content><![CDATA[<h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ¨¡æ‹Ÿè€—æ—¶ä»»åŠ¡</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">taskA</span> (<span class="params">n, initialValue, incre</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> result = initialValue</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">    result += incre</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">cache</span> (<span class="params">callback</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.time(<span class="string">'task'</span>)</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="built_in">console</span>.timeEnd(<span class="string">'task'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> taskACache = cache(taskA)</span><br><span class="line">taskACache(<span class="number">1e+9</span>, <span class="number">0</span>, <span class="number">1</span>) <span class="comment">// 1.5s</span></span><br><span class="line">taskACache(<span class="number">1e+9</span>, <span class="number">0</span>, <span class="number">1</span>) <span class="comment">// 0s</span></span><br><span class="line">taskACache(<span class="number">1e+9</span>, <span class="number">2</span>, <span class="number">1</span>) <span class="comment">// 1.5s</span></span><br><span class="line">taskACache(<span class="number">1e+9</span>, <span class="number">2</span>, <span class="number">1</span>) <span class="comment">// 0s</span></span><br><span class="line">taskACache(<span class="number">1e+9</span>, <span class="number">0</span>, <span class="number">1</span>) <span class="comment">// 0s</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> taskBCache = cache(taskB)</span><br><span class="line">taskBCache(<span class="string">'abc'</span>, <span class="number">123</span>, &#123; <span class="attr">a</span>: <span class="number">1</span>, <span class="attr">b</span>: <span class="number">2</span> &#125;) <span class="comment">// 5s</span></span><br><span class="line">taskBCache(<span class="string">'abc'</span>, <span class="number">123</span>, &#123; <span class="attr">b</span>: <span class="number">2</span>, <span class="attr">a</span>: <span class="number">1</span> &#125;) <span class="comment">// 0s</span></span><br></pre></td></tr></table></figure>
<p>å®Œå–„ cache æ–¹æ³•ï¼Œä½¿å¾—ç›¸åŒå‚æ•°è°ƒç”¨æ—¶èƒ½å¤Ÿå¿«é€Ÿå“åº”ç»“æœ</p>
<p><strong>æ³¨æ„</strong>ï¼š</p>
<ul>
<li>ç›¸åŒå‚æ•°éœ€è¦è¿›è¡Œæ·±åº¦æ¯”è¾ƒï¼Œ <code>{a:1,b:2}</code> å’Œ <code>{b:2,a:1}</code> å±äºå‚æ•°ä¸å˜çš„æƒ…å†µ</li>
<li>å±æ€§å€¼ä»…éœ€è€ƒè™‘åŸºæœ¬ç±»å‹å’Œçº¯å¯¹è±¡(typeof is object)ï¼Œä¸”ä¸è€ƒè™‘å¾ªç¯å¼•ç”¨çš„é—®é¢˜</li>
</ul>
<a id="more"></a>

<h2 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h2><p>å…ˆä¸è€ƒè™‘ Web Worker å’Œ Node.js å¤šçº¿ç¨‹ ï¼Œæˆ‘ä»¬å…ˆè€ƒè™‘å•çº¿ç¨‹åº”è¯¥å¦‚ä½•å®ç°</p>
<p>åŒç§ä»»åŠ¡å‚æ•°ä¸åŒå¯ä»¥è¢«ç¼“å­˜å¤šæ¬¡ï¼Œå› æ­¤æ¯æ¬¡æ‰§è¡Œä»»åŠ¡æ—¶å…ˆåˆ¤æ–­æ˜¯å¦å­˜åœ¨ç›¸åŒçš„å‚æ•°åˆ—è¡¨</p>
<p>ç›´è§‚çš„æƒ³æ³•æ˜¯ç»´æŠ¤ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„å…ƒç´ ä¸ºå‚æ•°åˆ—è¡¨ï¼Œæ¯æ¬¡éƒ½éœ€è¦éå†æ•°ç»„å…ƒç´ é€ä¸€æ¯”è¾ƒï¼Œè¿™æ˜¯ <code>O(n)</code> çš„æ—¶é—´å¤æ‚åº¦</p>
<p>é‚£ä¹ˆæœ‰ä»€ä¹ˆå…¶ä»–æ–¹æ³•ä¹ˆï¼Ÿ</p>
<h2 id="json-map"><a href="#json-map" class="headerlink" title="json + map"></a>json + map</h2><p>å¯¹å‚æ•°åˆ—è¡¨åº”ç”¨ <code>JSON.stringify</code> ï¼Œå…¶ç»“æœ json ä½œä¸º map çš„ key</p>
<p>éœ€è¦ä¿è¯</p>
<ul>
<li>ä¸åŒçš„å‚æ•°åˆ—è¡¨ç”Ÿæˆçš„ key æ˜¯ä¸åŒçš„</li>
<li>ç›¸åŒçš„å‚æ•°åˆ—è¡¨ç”Ÿæˆçš„ key å§‹ç»ˆä¸€è‡´</li>
</ul>
<p>å¯¹äºä¸‹é¢ 2 ç»„ï¼Œè™½ç„¶å‚æ•°åˆ—è¡¨æ˜¯ç›¸åŒçš„ï¼Œä½†æ˜¯ç”±äº<strong>å¯¹è±¡ä¸­å±æ€§çš„ä½ç½®ä¸ä¸€è‡´</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="built_in">JSON</span>.stringify([<span class="string">'abc'</span>, <span class="number">123</span>, &#123; <span class="attr">a</span>: <span class="number">1</span>, <span class="attr">b</span>: <span class="number">2</span> &#125;]))</span><br><span class="line"><span class="comment">// ["abc",123,&#123;"a":1,"b":2&#125;]</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">JSON</span>.stringify([<span class="string">'abc'</span>, <span class="number">123</span>, &#123; <span class="attr">b</span>: <span class="number">2</span>, <span class="attr">a</span>: <span class="number">1</span> &#125;]))</span><br><span class="line"><span class="comment">// ["abc",123,&#123;"b":2,"a":1&#125;]</span></span><br></pre></td></tr></table></figure>
<p>ç®€å•åº”ç”¨ <code>JSON.stringify</code> ä¼šå¾—åˆ°ä¸åŒç»“æœ</p>
<p>éœ€è¦å€Ÿç”¨ç¬¬äºŒä¸ªå‚æ•° replacer è¿›è¡Œå¯¹è±¡çš„å¤„ç†</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">replacer</span> (<span class="params">key, value</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> isPureObject = <span class="keyword">typeof</span> value === <span class="string">'object'</span> &amp;&amp; value !== <span class="literal">null</span> &amp;&amp; !<span class="built_in">Array</span>.isArray(value)</span><br><span class="line">  <span class="keyword">if</span> (!isPureObject) &#123;</span><br><span class="line">    <span class="keyword">return</span> value</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Object</span></span><br><span class="line">    .entries(value)</span><br><span class="line">    .sort(<span class="function">(<span class="params">[a], [b]</span>) =&gt;</span> +(a &gt; b) || +(a === b) - <span class="number">1</span>)</span><br><span class="line">    .reduce(<span class="function">(<span class="params">_sortedObj, [k, v]</span>) =&gt;</span> (&#123;</span><br><span class="line">      ..._sortedObj,</span><br><span class="line">      [k]: v</span><br><span class="line">    &#125;), &#123;&#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">JSON</span>.stringify([<span class="string">'abc'</span>, <span class="number">123</span>, &#123; <span class="attr">a</span>: <span class="number">1</span>, <span class="attr">b</span>: <span class="number">2</span> &#125;], replacer))</span><br><span class="line"><span class="comment">// ["abc",123,&#123;"a":1,"b":2&#125;]</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">JSON</span>.stringify([<span class="string">'abc'</span>, <span class="number">123</span>, &#123; <span class="attr">b</span>: <span class="number">2</span>, <span class="attr">a</span>: <span class="number">1</span> &#125;], replacer))</span><br><span class="line"><span class="comment">// ["abc",123,&#123;"a":1,"b":2&#125;]</span></span><br></pre></td></tr></table></figure>

<p>å°†è®¡ç®—ç»“æœæ”¾å…¥ map å³å¯</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">replacer</span> (<span class="params">key, value</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> isObject = <span class="keyword">typeof</span> value === <span class="string">'object'</span> &amp;&amp; value !== <span class="literal">null</span> &amp;&amp; !<span class="built_in">Array</span>.isArray(value)</span><br><span class="line">  <span class="keyword">if</span> (!isObject) &#123;</span><br><span class="line">    <span class="keyword">return</span> value</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Object</span></span><br><span class="line">    .entries(value)</span><br><span class="line">    .sort(<span class="function">(<span class="params">[a], [b]</span>) =&gt;</span> +(a &gt; b) || +(a === b) - <span class="number">1</span>)</span><br><span class="line">    .reduce(<span class="function">(<span class="params">_sortedObj, [k, v]</span>) =&gt;</span> (&#123;</span><br><span class="line">      ..._sortedObj,</span><br><span class="line">      [k]: v</span><br><span class="line">    &#125;), &#123;&#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">cache</span> (<span class="params">callback</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> map = <span class="keyword">new</span> <span class="built_in">Map</span>()</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">...args</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.time(<span class="string">'task'</span>)</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> json = <span class="built_in">JSON</span>.stringify(args, replacer)</span><br><span class="line">      <span class="keyword">let</span> result = map.get(json)</span><br><span class="line">      <span class="keyword">if</span> (result !== <span class="keyword">void</span> <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line">      &#125;</span><br><span class="line">      result = callback.apply(<span class="literal">null</span>, args)</span><br><span class="line">      map.set(json, result)</span><br><span class="line">      <span class="keyword">return</span> result</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.timeEnd(<span class="string">'task'</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•ç”¨ä¾‹</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ¨¡æ‹Ÿè€—æ—¶ä»»åŠ¡</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">taskA</span> (<span class="params">n, &#123; initialValue, incre &#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> result = initialValue</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">    result += incre</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> taskACache = cache(taskA)</span><br><span class="line"><span class="built_in">console</span>.log(taskACache(<span class="number">1e+9</span>, &#123; <span class="attr">initialValue</span>: <span class="number">0</span>, <span class="attr">incre</span>: <span class="number">1</span> &#125;))</span><br><span class="line"><span class="built_in">console</span>.log(taskACache(<span class="number">1e+9</span>, &#123; <span class="attr">incre</span>: <span class="number">1</span>, <span class="attr">initialValue</span>: <span class="number">0</span> &#125;))</span><br><span class="line"><span class="built_in">console</span>.log(taskACache(<span class="number">1e+9</span>, &#123; <span class="attr">initialValue</span>: <span class="number">2</span>, <span class="attr">incre</span>: <span class="number">1</span> &#125;))</span><br><span class="line"><span class="built_in">console</span>.log(taskACache(<span class="number">1e+9</span>, &#123; <span class="attr">initialValue</span>: <span class="number">2</span>, <span class="attr">incre</span>: <span class="number">1</span> &#125;))</span><br><span class="line"><span class="built_in">console</span>.log(taskACache(<span class="number">1e+9</span>, &#123; <span class="attr">initialValue</span>: <span class="number">0</span>, <span class="attr">incre</span>: <span class="number">1</span> &#125;))</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">task: 2050.12890625ms</span></span><br><span class="line"><span class="comment">1000000000</span></span><br><span class="line"><span class="comment">task: 0.097900390625ms</span></span><br><span class="line"><span class="comment">1000000000</span></span><br><span class="line"><span class="comment">task: 2088.137939453125ms</span></span><br><span class="line"><span class="comment">1000000002</span></span><br><span class="line"><span class="comment">task: 0.0810546875ms</span></span><br><span class="line"><span class="comment">1000000002</span></span><br><span class="line"><span class="comment">task: 0.042724609375ms</span></span><br><span class="line"><span class="comment">1000000000</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p>è¿˜èƒ½ç»§ç»­ä¼˜åŒ–ï¼Ÿ</p>
<p>å½“ç¼“å­˜çš„æ•°æ®é‡è¶³å¤Ÿå¤§æ—¶ï¼Œæ—¢å ç”¨å†…å­˜ï¼Œè¿˜æ‹–æ…¢æŸ¥è¯¢é€Ÿåº¦ï¼Œæˆ‘ä»¬ä¸Š LRUCache</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;number&#125;</span> <span class="variable">capacity</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> LRUCache = <span class="function"><span class="keyword">function</span> (<span class="params">capacity</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.capacity = capacity</span><br><span class="line">  <span class="keyword">this</span>.map = <span class="keyword">new</span> <span class="built_in">Map</span>()</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;number&#125;</span> <span class="variable">key</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return <span class="type">&#123;number&#125;</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">LRUCache.prototype.get = <span class="function"><span class="keyword">function</span> (<span class="params">key</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!<span class="keyword">this</span>.map.has(key)) &#123;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> value = <span class="keyword">this</span>.map.get(key)</span><br><span class="line">    <span class="keyword">this</span>.map.delete(key)</span><br><span class="line">    <span class="keyword">this</span>.map.set(key, value)</span><br><span class="line">    <span class="keyword">return</span> value</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;number&#125;</span> </span>key </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;number&#125;</span> <span class="variable">value</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return <span class="type">&#123;void&#125;</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">LRUCache.prototype.set = <span class="function"><span class="keyword">function</span> (<span class="params">key, value</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!<span class="keyword">this</span>.map.has(key)) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.map.size &gt;= <span class="keyword">this</span>.capacity) &#123;</span><br><span class="line">      <span class="comment">// åˆ é™¤é¦–ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">      <span class="keyword">this</span>.map.delete(<span class="keyword">this</span>.map.keys().next().value)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>.map.set(key, value)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">this</span>.map.delete(key)</span><br><span class="line">    <span class="keyword">this</span>.map.set(key, value)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>å®ç°åŸç†è¯·çœ‹ <a href="https://github.com/francecil/leetcode/issues/8" target="_blank" rel="noopener">å®ç°ä¸€ä¸ª LRU-K
</a></p>
<p>ä¿®æ”¹ä¸‹ cache çš„å®ç°</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">replacer</span> (<span class="params">key, value</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> isObject = <span class="keyword">typeof</span> value === <span class="string">'object'</span> &amp;&amp; value !== <span class="literal">null</span> &amp;&amp; !<span class="built_in">Array</span>.isArray(value)</span><br><span class="line">  <span class="keyword">if</span> (!isObject) &#123;</span><br><span class="line">    <span class="keyword">return</span> value</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Object</span></span><br><span class="line">    .entries(value)</span><br><span class="line">    .sort(<span class="function">(<span class="params">[a], [b]</span>) =&gt;</span> +(a &gt; b) || +(a === b) - <span class="number">1</span>)</span><br><span class="line">    .reduce(<span class="function">(<span class="params">_sortedObj, [k, v]</span>) =&gt;</span> (&#123;</span><br><span class="line">      ..._sortedObj,</span><br><span class="line">      [k]: v</span><br><span class="line">    &#125;), &#123;&#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">cache</span> (<span class="params">callback</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// è®¾ç½®å®¹é‡</span></span><br><span class="line">  <span class="keyword">let</span> map = <span class="keyword">new</span> LRUCache(<span class="number">2</span>)</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">...args</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.time(<span class="string">'task'</span>)</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> json = <span class="built_in">JSON</span>.stringify(args, replacer)</span><br><span class="line">      <span class="keyword">let</span> result = map.get(json)</span><br><span class="line">      <span class="keyword">if</span> (result !== <span class="keyword">void</span> <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line">      &#125;</span><br><span class="line">      result = callback.apply(<span class="literal">null</span>, args)</span><br><span class="line">      map.set(json, result)</span><br><span class="line">      <span class="keyword">return</span> result</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.timeEnd(<span class="string">'task'</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å†æ¬¡è¿›è¡Œæµ‹è¯•</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ¨¡æ‹Ÿè€—æ—¶ä»»åŠ¡</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">taskA</span> (<span class="params">n, &#123; initialValue, incre &#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> result = initialValue</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">    result += incre</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> taskACache = cache(taskA)</span><br><span class="line"><span class="built_in">console</span>.log(taskACache(<span class="number">1e+9</span>, &#123; <span class="attr">initialValue</span>: <span class="number">0</span>, <span class="attr">incre</span>: <span class="number">1</span> &#125;))</span><br><span class="line"><span class="built_in">console</span>.log(taskACache(<span class="number">1e+9</span>, &#123; <span class="attr">incre</span>: <span class="number">1</span>, <span class="attr">initialValue</span>: <span class="number">0</span> &#125;))</span><br><span class="line"><span class="built_in">console</span>.log(taskACache(<span class="number">1e+9</span>, &#123; <span class="attr">initialValue</span>: <span class="number">2</span>, <span class="attr">incre</span>: <span class="number">1</span> &#125;))</span><br><span class="line"><span class="built_in">console</span>.log(taskACache(<span class="number">1e+9</span>, &#123; <span class="attr">initialValue</span>: <span class="number">2</span>, <span class="attr">incre</span>: <span class="number">1</span> &#125;))</span><br><span class="line"><span class="built_in">console</span>.log(taskACache(<span class="number">1e+9</span>, &#123; <span class="attr">initialValue</span>: <span class="number">3</span>, <span class="attr">incre</span>: <span class="number">1</span> &#125;))</span><br><span class="line"><span class="built_in">console</span>.log(taskACache(<span class="number">1e+9</span>, &#123; <span class="attr">initialValue</span>: <span class="number">0</span>, <span class="attr">incre</span>: <span class="number">1</span> &#125;))</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">task: 2190.304931640625ms</span></span><br><span class="line"><span class="comment">1000000000</span></span><br><span class="line"><span class="comment">task: 0.12890625ms</span></span><br><span class="line"><span class="comment">1000000000</span></span><br><span class="line"><span class="comment">task: 2263.181884765625ms</span></span><br><span class="line"><span class="comment">1000000002</span></span><br><span class="line"><span class="comment">task: 0.123779296875ms</span></span><br><span class="line"><span class="comment">1000000002</span></span><br><span class="line"><span class="comment">task: 2218.0888671875ms</span></span><br><span class="line"><span class="comment">1000000003</span></span><br><span class="line"><span class="comment">task: 2395.6279296875ms</span></span><br><span class="line"><span class="comment">1000000000</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p>æ³¨æ„æœ€åä¸€ä¸ªä¾‹å­ï¼Œè®¡ç®—ç»“æœå·²è¢« lru ç§»é™¤</p>
<h2 id="hashMap"><a href="#hashMap" class="headerlink" title="hashMap"></a>hashMap</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ä¸‡ç‰©å‡å¯ hash</span><br><span class="line">        -- é²è¿…</span><br></pre></td></tr></table></figure>

<p>å°†å‚æ•°åˆ—è¡¨è¿›è¡Œå“ˆå¸Œå¾—åˆ° hashCode ï¼Œå¹¶ä½œä¸º hashMap çš„ key</p>
<p>hashMap çš„ value æ˜¯å®ä½“ä¸ºå‚æ•°åˆ—è¡¨ä¸è®¡ç®—å€¼çš„é“¾è¡¨ï¼Œé“¾è¡¨è¾ƒé•¿åˆ™ä¸Šçº¢é»‘æ ‘</p>
<p>æ¥ä¸‹æ¥å°±æ˜¯ hashCode çš„è®¡ç®—ï¼Œéœ€è¦æ˜ç¡®çš„æ˜¯ï¼š</p>
<ul>
<li>ç›¸åŒçš„å‚æ•°åˆ—è¡¨ç”Ÿæˆçš„ hashCode å§‹ç»ˆä¸€è‡´</li>
<li>ç”±äºæ— éœ€ä¿è¯ä¸åŒçš„å‚æ•°åˆ—è¡¨ç”Ÿæˆçš„ hashCode ä¸ä¸€è‡´ï¼Œå› æ­¤ hashCode çš„è®¡ç®—åº”å°½å¯èƒ½å¿«</li>
</ul>
<p>è¿™é‡Œç®€å•ä½¿ç”¨å¦‚ä¸‹è®¡ç®—è§„åˆ™</p>
<ul>
<li>Object<ul>
<li>æ•°ç»„ï¼Œå…¶ hashCode ä¸ºæ¯ä¸€é¡¹çš„ hashCode çš„ç´¯åŠ </li>
<li>null, å…¶ hashCode ä¸º -1</li>
<li>çº¯å¯¹è±¡ï¼Œå…¶ hashCode ä¸ºæŒ‰å±æ€§å‡åºåæ¯ä¸€é¡¹çš„å€¼çš„ hashCode çš„ç´¯åŠ </li>
</ul>
</li>
<li>undefined, å…¶ hashCode ä¸º -1</li>
<li>Number<ul>
<li>NaN, å…¶ hashCode ä¸º -1</li>
<li>Infinity, å…¶ hashCode ä¸º 0xffff</li>
<li>å…¶ä»–ï¼Œå…¶ hashCode ä¸ºè‡ªèº«å€¼</li>
</ul>
</li>
<li>Stringï¼Œå…¶ hashCode ä¸º charCode ç´¯åŠ </li>
<li>Booleanï¼Œtrue ä¸º 1ï¼Œfalse ä¸º 0</li>
</ul>
<p>æ¯æ¬¡æ‰§è¡Œä»»åŠ¡å‰å…ˆæŸ¥è¯¢æ˜¯å¦å­˜åœ¨ hashCode ï¼Œå­˜åœ¨çš„è¯åœ¨å¯¹é“¾è¡¨ä¸­æ¯ä¸€é¡¹è¿›è¡Œæ·±æ¯”è¾ƒæŸ¥è¯¢</p>
<p>è¯¥ç®—æ³•çš„è¦ç‚¹åœ¨äºæ‰¾åˆ°ä¸€ä¸ªåˆç†çš„ hash ç®—æ³•ï¼Œå‡å°‘ hash å†²çªé¿å…æ·±æ¯”è¾ƒ</p>
<p>ä»£ç å®ç°ç•¥ã€‚</p>
<h2 id="ä¸Šå¤šçº¿ç¨‹"><a href="#ä¸Šå¤šçº¿ç¨‹" class="headerlink" title="ä¸Šå¤šçº¿ç¨‹"></a>ä¸Šå¤šçº¿ç¨‹</h2><p>ä¸ºé¿å…é˜»å¡ä¸»çº¿ç¨‹çš„äº‹ä»¶å¾ªç¯ï¼Œæˆ‘ä»¬å°†è€—æ—¶ä»»åŠ¡æ”¾åˆ°å…¶ä»–çº¿ç¨‹ä¸­è¿›è¡Œ</p>
<p>å…ˆä¸Šä¸€ç‰ˆï¼Œå†åˆ†ææ¼æ´</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;number&#125;</span> <span class="variable">capacity</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> LRUCache = <span class="function"><span class="keyword">function</span> (<span class="params">capacity</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.capacity = capacity</span><br><span class="line">  <span class="keyword">this</span>.map = <span class="keyword">new</span> <span class="built_in">Map</span>()</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;number&#125;</span> <span class="variable">key</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return <span class="type">&#123;number&#125;</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">LRUCache.prototype.get = <span class="function"><span class="keyword">function</span> (<span class="params">key</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!<span class="keyword">this</span>.map.has(key)) &#123;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> value = <span class="keyword">this</span>.map.get(key)</span><br><span class="line">    <span class="keyword">this</span>.map.delete(key)</span><br><span class="line">    <span class="keyword">this</span>.map.set(key, value)</span><br><span class="line">    <span class="keyword">return</span> value</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;number&#125;</span> </span>key </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;number&#125;</span> <span class="variable">value</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return <span class="type">&#123;void&#125;</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">LRUCache.prototype.set = <span class="function"><span class="keyword">function</span> (<span class="params">key, value</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!<span class="keyword">this</span>.map.has(key)) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.map.size &gt;= <span class="keyword">this</span>.capacity) &#123;</span><br><span class="line">      <span class="comment">// åˆ é™¤é¦–ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">      <span class="keyword">this</span>.map.delete(<span class="keyword">this</span>.map.keys().next().value)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>.map.set(key, value)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">this</span>.map.delete(key)</span><br><span class="line">    <span class="keyword">this</span>.map.set(key, value)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">replacer</span> (<span class="params">key, value</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> isObject = <span class="keyword">typeof</span> value === <span class="string">'object'</span> &amp;&amp; value !== <span class="literal">null</span> &amp;&amp; !<span class="built_in">Array</span>.isArray(value)</span><br><span class="line">  <span class="keyword">if</span> (!isObject) &#123;</span><br><span class="line">    <span class="keyword">return</span> value</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Object</span></span><br><span class="line">    .entries(value)</span><br><span class="line">    .sort(<span class="function">(<span class="params">[a], [b]</span>) =&gt;</span> +(a &gt; b) || +(a === b) - <span class="number">1</span>)</span><br><span class="line">    .reduce(<span class="function">(<span class="params">_sortedObj, [k, v]</span>) =&gt;</span> (&#123;</span><br><span class="line">      ..._sortedObj,</span><br><span class="line">      [k]: v</span><br><span class="line">    &#125;), &#123;&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ„å»º worker</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createWorker</span> (<span class="params">taskContent, taskName</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> text = <span class="string">`</span></span><br><span class="line"><span class="string">  <span class="subst">$&#123;taskContent&#125;</span></span></span><br><span class="line"><span class="string">  this.addEventListener('message', (msg) =&gt; &#123;</span></span><br><span class="line"><span class="string">    const result = this['<span class="subst">$&#123;taskName&#125;</span>'].apply(this,msg.data)</span></span><br><span class="line"><span class="string">    postMessage(result);</span></span><br><span class="line"><span class="string">  &#125;, false);</span></span><br><span class="line"><span class="string">  `</span></span><br><span class="line">  <span class="keyword">let</span> blob = <span class="keyword">new</span> Blob([text]);</span><br><span class="line">  <span class="keyword">let</span> url = <span class="built_in">window</span>.URL.createObjectURL(blob);</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> Worker(url);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">cache</span> (<span class="params">task</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// è®¾ç½®å®¹é‡</span></span><br><span class="line">  <span class="keyword">let</span> map = <span class="keyword">new</span> LRUCache(<span class="number">2</span>)</span><br><span class="line">  <span class="keyword">let</span> worker = createWorker(task.toString(), task.name)</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">...args</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.time(<span class="string">'task'</span>)</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> json = <span class="built_in">JSON</span>.stringify(args, replacer)</span><br><span class="line">        <span class="keyword">let</span> result = map.get(json)</span><br><span class="line">        <span class="keyword">if</span> (result !== <span class="keyword">void</span> <span class="number">0</span>) &#123;</span><br><span class="line">          resolve(result)</span><br><span class="line">          <span class="built_in">console</span>.timeEnd(<span class="string">'task'</span>)</span><br><span class="line">          <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        worker.onmessage = <span class="function">(<span class="params">evt</span>) =&gt;</span> &#123;</span><br><span class="line">          map.set(json, evt.data)</span><br><span class="line">          resolve(evt.data)</span><br><span class="line">          <span class="built_in">console</span>.timeEnd(<span class="string">'task'</span>)</span><br><span class="line">        &#125;;</span><br><span class="line">        worker.postMessage(args);</span><br><span class="line">      &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">        reject(error)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¨¡æ‹Ÿè€—æ—¶ä»»åŠ¡</span></span><br><span class="line"><span class="comment">// ä»…è€ƒè™‘å‡½æ•°å£°æ˜</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">taskA</span> (<span class="params">n, &#123; initialValue, incre &#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> result = initialValue</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">    result += incre</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> taskACache = cache(taskA)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">await</span> taskACache(<span class="number">1e+9</span>, &#123; <span class="attr">initialValue</span>: <span class="number">0</span>, <span class="attr">incre</span>: <span class="number">1</span> &#125;))</span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">await</span> taskACache(<span class="number">1e+9</span>, &#123; <span class="attr">incre</span>: <span class="number">1</span>, <span class="attr">initialValue</span>: <span class="number">0</span> &#125;))</span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">await</span> taskACache(<span class="number">1e+9</span>, &#123; <span class="attr">initialValue</span>: <span class="number">2</span>, <span class="attr">incre</span>: <span class="number">1</span> &#125;))</span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">await</span> taskACache(<span class="number">1e+9</span>, &#123; <span class="attr">initialValue</span>: <span class="number">2</span>, <span class="attr">incre</span>: <span class="number">1</span> &#125;))</span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">await</span> taskACache(<span class="number">1e+9</span>, &#123; <span class="attr">initialValue</span>: <span class="number">3</span>, <span class="attr">incre</span>: <span class="number">1</span> &#125;))</span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">await</span> taskACache(<span class="number">1e+9</span>, &#123; <span class="attr">initialValue</span>: <span class="number">0</span>, <span class="attr">incre</span>: <span class="number">1</span> &#125;))</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">task: 2196.513916015625ms</span></span><br><span class="line"><span class="comment">1000000000</span></span><br><span class="line"><span class="comment">task: 0.123046875ms</span></span><br><span class="line"><span class="comment">1000000000</span></span><br><span class="line"><span class="comment">task: 2287.091796875ms</span></span><br><span class="line"><span class="comment">1000000002</span></span><br><span class="line"><span class="comment">task: 0.10791015625ms</span></span><br><span class="line"><span class="comment">1000000002</span></span><br><span class="line"><span class="comment">task: 2272.23193359375ms</span></span><br><span class="line"><span class="comment">1000000003</span></span><br><span class="line"><span class="comment">task: 2178.444091796875ms</span></span><br><span class="line"><span class="comment">1000000000</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœä¸å•çº¿ç¨‹ä¸€è‡´ï¼Œä¸”ä¸é˜»å¡ä¸»çº¿ç¨‹</p>
<p>é‚£ä¹ˆï¼Œæœ‰ä»€ä¹ˆé—®é¢˜å—ï¼Ÿ</p>
<p>é¦–å…ˆï¼Œä¸ºäº†æ‹“å±•æ€§ï¼Œå°† task å†…å®¹ä¼ é€’åˆ° worker ä¸­ï¼Œè¿™é‡Œéœ€è¦è¦æ±‚ä¸ºå‡½æ•°å£°æ˜ï¼Œå¯¹äºå‡½æ•°è¡¨è¾¾å¼æˆ–é‡å†™ toString ç­‰æƒ…å†µæ— æ³•æ­£å¸¸å¤„ç†</p>
<p>å…¶æ¬¡ï¼Œè¿™é‡Œé€šè¿‡ await ä¿è¯äº† taskACache æŒ‰åºæ‰§è¡Œï¼Œå®é™…åœºæ™¯ä¸­å¯èƒ½å­˜åœ¨å¤šä¸ªåŒæ—¶æ‰§è¡Œçš„ worker ï¼Œä¸”è¿˜æœ‰å¯èƒ½æ˜¯å‚æ•°åˆ—è¡¨ä¸€æ ·çš„ï¼Œå¯¼è‡´ worker é‡å¤è®¡ç®—</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">taskACache(<span class="number">1e+9</span>, &#123; <span class="attr">initialValue</span>: <span class="number">0</span>, <span class="attr">incre</span>: <span class="number">1</span> &#125;)</span><br><span class="line">taskACache(<span class="number">1e+9</span>, &#123; <span class="attr">initialValue</span>: <span class="number">0</span>, <span class="attr">incre</span>: <span class="number">1</span> &#125;)</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">A  -&gt;f(1)ä¸åœ¨ç¼“å­˜-&gt;[   è®¡ç®—f(1)    ]-&gt;å°†f(1)æ”¾å…¥ç¼“å­˜</span></span><br><span class="line"><span class="comment">B  -----------&gt;f(1)ä¸åœ¨ç¼“å­˜-&gt;[   è®¡ç®—f(1)    ]-&gt;å°†f(1)æ”¾å…¥ç¼“å­˜</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p>å¯¹äºé—®é¢˜1æ— éå°±æ˜¯åšä¸‹å…¼å®¹ï¼Œæˆ–è€…ç›´æ¥çº¦å®šä»…æ”¯æŒå‡½æ•°å£°æ˜ï¼Œå†æˆ–è€…å°† <code>self.postMessage</code> æ”¾ç½®åœ¨ä»»åŠ¡æ–¹æ³•ä¸­ï¼Œè¿™ä¸ªæ— å…³ç´§è¦ï¼Œé‡ç‚¹æ˜¯é—®é¢˜2ï¼Œå¦‚ä½•å¤„ç†ï¼Ÿ</p>
<p>å‚è€ƒ Java FutureTask çš„åšæ³•ï¼Œå³</p>
<blockquote>
<p>FutureTask è¡¨ç¤ºä¸€ä¸ªè®¡ç®—çš„è¿‡ç¨‹ï¼Œå¯èƒ½å·²ç»è®¡ç®—å®Œæˆï¼Œä¹Ÿå¯èƒ½æ­£åœ¨è¿›è¡Œã€‚å¦‚æœæœ‰ç»“æœå¯ç”¨ï¼Œé‚£ä¹ˆ FutureTask.get å°†ç«‹å³è¿”å›ç»“æœï¼Œå¦åˆ™ä¼šä¸€ç›´å µå¡ï¼Œç›´åˆ°è®¡ç®—ç»“æœå‡ºæ¥å†å°†å…¶è¿”å›</p>
</blockquote>
<p>åœ¨ js ä¸­ç›¸åƒçš„å°±æ˜¯ Promise äº†</p>
<p>ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;number&#125;</span> <span class="variable">capacity</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> LRUCache = <span class="function"><span class="keyword">function</span> (<span class="params">capacity</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.capacity = capacity</span><br><span class="line">  <span class="keyword">this</span>.map = <span class="keyword">new</span> <span class="built_in">Map</span>()</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;number&#125;</span> <span class="variable">key</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return <span class="type">&#123;number&#125;</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">LRUCache.prototype.get = <span class="function"><span class="keyword">function</span> (<span class="params">key</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!<span class="keyword">this</span>.map.has(key)) &#123;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> value = <span class="keyword">this</span>.map.get(key)</span><br><span class="line">    <span class="keyword">this</span>.map.delete(key)</span><br><span class="line">    <span class="keyword">this</span>.map.set(key, value)</span><br><span class="line">    <span class="keyword">return</span> value</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;number&#125;</span> </span>key </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;number&#125;</span> <span class="variable">value</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return <span class="type">&#123;void&#125;</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">LRUCache.prototype.set = <span class="function"><span class="keyword">function</span> (<span class="params">key, value</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!<span class="keyword">this</span>.map.has(key)) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.map.size &gt;= <span class="keyword">this</span>.capacity) &#123;</span><br><span class="line">      <span class="comment">// åˆ é™¤é¦–ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">      <span class="keyword">this</span>.map.delete(<span class="keyword">this</span>.map.keys().next().value)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>.map.set(key, value)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">this</span>.map.delete(key)</span><br><span class="line">    <span class="keyword">this</span>.map.set(key, value)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">replacer</span> (<span class="params">key, value</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> isObject = <span class="keyword">typeof</span> value === <span class="string">'object'</span> &amp;&amp; value !== <span class="literal">null</span> &amp;&amp; !<span class="built_in">Array</span>.isArray(value)</span><br><span class="line">  <span class="keyword">if</span> (!isObject) &#123;</span><br><span class="line">    <span class="keyword">return</span> value</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Object</span></span><br><span class="line">    .entries(value)</span><br><span class="line">    .sort(<span class="function">(<span class="params">[a], [b]</span>) =&gt;</span> +(a &gt; b) || +(a === b) - <span class="number">1</span>)</span><br><span class="line">    .reduce(<span class="function">(<span class="params">_sortedObj, [k, v]</span>) =&gt;</span> (&#123;</span><br><span class="line">      ..._sortedObj,</span><br><span class="line">      [k]: v</span><br><span class="line">    &#125;), &#123;&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ„å»º worker</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createWorkerUrl</span> (<span class="params">taskContent, taskName</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> text = <span class="string">`</span></span><br><span class="line"><span class="string">  <span class="subst">$&#123;taskContent&#125;</span></span></span><br><span class="line"><span class="string">  this.addEventListener('message', (msg) =&gt; &#123;</span></span><br><span class="line"><span class="string">    const result = this['<span class="subst">$&#123;taskName&#125;</span>'].apply(this,msg.data)</span></span><br><span class="line"><span class="string">    postMessage(result);</span></span><br><span class="line"><span class="string">  &#125;, false);</span></span><br><span class="line"><span class="string">  `</span></span><br><span class="line">  <span class="keyword">let</span> blob = <span class="keyword">new</span> Blob([text]);</span><br><span class="line">  <span class="keyword">let</span> url = <span class="built_in">window</span>.URL.createObjectURL(blob);</span><br><span class="line">  <span class="keyword">return</span> url</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">cache</span> (<span class="params">task</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// è®¾ç½®å®¹é‡</span></span><br><span class="line">  <span class="keyword">let</span> map = <span class="keyword">new</span> LRUCache(<span class="number">2</span>)</span><br><span class="line">  <span class="keyword">const</span> url = createWorkerUrl(task.toString(), task.name)</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">...args</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> startTime = performance.now()</span><br><span class="line">    <span class="keyword">const</span> json = <span class="built_in">JSON</span>.stringify(args, replacer)</span><br><span class="line">    <span class="keyword">let</span> result = map.get(json)</span><br><span class="line">    <span class="keyword">if</span> (result !== <span class="keyword">void</span> <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'task: '</span>, performance.now() - startTime, <span class="string">'ms'</span>)</span><br><span class="line">      <span class="keyword">return</span> result</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> worker = <span class="keyword">new</span> Worker(url)</span><br><span class="line">    <span class="keyword">let</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        worker.onmessage = <span class="function">(<span class="params">evt</span>) =&gt;</span> &#123;</span><br><span class="line">          resolve(evt.data)</span><br><span class="line">          <span class="built_in">console</span>.log(<span class="string">'task: '</span>, performance.now() - startTime, <span class="string">'ms'</span>)</span><br><span class="line">        &#125;;</span><br><span class="line">        worker.postMessage(args);</span><br><span class="line">      &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">        reject(error)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    map.set(json, promise)</span><br><span class="line">    <span class="keyword">return</span> promise</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¨¡æ‹Ÿè€—æ—¶ä»»åŠ¡</span></span><br><span class="line"><span class="comment">// ä»…è€ƒè™‘å‡½æ•°å£°æ˜</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">taskA</span> (<span class="params">n, &#123; initialValue, incre &#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> result = initialValue</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">    result += incre</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> taskACache = cache(taskA)</span><br><span class="line"><span class="built_in">console</span>.log(taskACache(<span class="number">1e+9</span>, &#123; <span class="attr">initialValue</span>: <span class="number">0</span>, <span class="attr">incre</span>: <span class="number">1</span> &#125;).then(<span class="function"><span class="params">res</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">'&#123; initialValue: 0, incre: 1 &#125; =&gt; '</span>,res)))</span><br><span class="line"><span class="built_in">console</span>.log(taskACache(<span class="number">1e+9</span>, &#123; <span class="attr">incre</span>: <span class="number">1</span>, <span class="attr">initialValue</span>: <span class="number">0</span> &#125;).then(<span class="function"><span class="params">res</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">'&#123; incre: 1, initialValue: 0 &#125; =&gt; '</span>,res)))</span><br><span class="line"><span class="built_in">console</span>.log(taskACache(<span class="number">1e+9</span>, &#123; <span class="attr">initialValue</span>: <span class="number">2</span>, <span class="attr">incre</span>: <span class="number">1</span> &#125;).then(<span class="function"><span class="params">res</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">'&#123; initialValue: 2, incre: 1 &#125; =&gt; '</span>,res)))</span><br><span class="line"><span class="built_in">console</span>.log(taskACache(<span class="number">1e+9</span>, &#123; <span class="attr">initialValue</span>: <span class="number">2</span>, <span class="attr">incre</span>: <span class="number">1</span> &#125;).then(<span class="function"><span class="params">res</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">'&#123; initialValue: 2, incre: 1 &#125; =&gt; '</span>,res)))</span><br><span class="line"><span class="built_in">console</span>.log(taskACache(<span class="number">1e+9</span>, &#123; <span class="attr">initialValue</span>: <span class="number">3</span>, <span class="attr">incre</span>: <span class="number">1</span> &#125;).then(<span class="function"><span class="params">res</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">'&#123; initialValue: 3, incre: 1 &#125; =&gt; '</span>,res)))</span><br><span class="line"><span class="built_in">console</span>.log(taskACache(<span class="number">1e+9</span>, &#123; <span class="attr">initialValue</span>: <span class="number">0</span>, <span class="attr">incre</span>: <span class="number">1</span> &#125;).then(<span class="function"><span class="params">res</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">'&#123; initialValue: 0, incre: 1 &#125; =&gt; '</span>,res)))</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">PromiseÂ &#123;&lt;pending&gt;&#125;</span></span><br><span class="line"><span class="comment">task:  0.11500000255182385 ms</span></span><br><span class="line"><span class="comment">PromiseÂ &#123;&lt;pending&gt;&#125;</span></span><br><span class="line"><span class="comment">PromiseÂ &#123;&lt;pending&gt;&#125;</span></span><br><span class="line"><span class="comment">task:  0.1399999891873449 ms</span></span><br><span class="line"><span class="comment">PromiseÂ &#123;&lt;pending&gt;&#125;</span></span><br><span class="line"><span class="comment">PromiseÂ &#123;&lt;pending&gt;&#125;</span></span><br><span class="line"><span class="comment">PromiseÂ &#123;&lt;pending&gt;&#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">task:  3322.7050000132294 ms</span></span><br><span class="line"><span class="comment">&#123; initialValue: 0, incre: 1 &#125; =&gt;  1000000000</span></span><br><span class="line"><span class="comment">&#123; incre: 1, initialValue: 0 &#125; =&gt;  1000000000</span></span><br><span class="line"><span class="comment">task:  3370.5150000023423 ms</span></span><br><span class="line"><span class="comment">&#123; initialValue: 2, incre: 1 &#125; =&gt;  1000000002</span></span><br><span class="line"><span class="comment">&#123; initialValue: 2, incre: 1 &#125; =&gt;  1000000002</span></span><br><span class="line"><span class="comment">task:  3772.9699999908917 ms</span></span><br><span class="line"><span class="comment">&#123; initialValue: 0, incre: 1 &#125; =&gt;  1000000000</span></span><br><span class="line"><span class="comment">task:  4013.5900000022957 ms</span></span><br><span class="line"><span class="comment">&#123; initialValue: 3, incre: 1 &#125; =&gt;  1000000003</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p>ç¬¬äºŒä¸ªä»»åŠ¡å’Œç¬¬å››ä¸ªä»»åŠ¡å‘½ä¸­äº†ç¼“å­˜ï¼Œè¿”å›å·²ç¼“å­˜çš„ promise</p>
<p>å•ä¸ª task è€—æ—¶çœ‹ä¼¼å¢åŠ äº†ï¼Œè¿™æ˜¯ç”±äºå¹¶å‘æ‰§è¡Œ Worker å¯¼è‡´çš„ï¼Œæ•´ä½“è€—æ—¶åè€Œå‡å°‘äº†</p>
<h3 id="å…¶ä»–æ³¨æ„ç‚¹"><a href="#å…¶ä»–æ³¨æ„ç‚¹" class="headerlink" title="å…¶ä»–æ³¨æ„ç‚¹"></a>å…¶ä»–æ³¨æ„ç‚¹</h3><p>ç”±äº js ä¸»çº¿ç¨‹æ˜¯å•çº¿ç¨‹ï¼Œå› æ­¤ä¸ç”¨è€ƒè™‘å…ˆæ£€æŸ¥ç¼“å­˜å†æ‰§è¡Œè¿™ä¸€éåŸå­æ€§æ“ä½œ</p>
<h2 id="æ‹“å±•é˜…è¯»"><a href="#æ‹“å±•é˜…è¯»" class="headerlink" title="æ‹“å±•é˜…è¯»"></a>æ‹“å±•é˜…è¯»</h2><ol>
<li><a href="http://www.ruanyifeng.com/blog/2018/07/web-worker.html" target="_blank" rel="noopener">Web Worker ä½¿ç”¨æ•™ç¨‹</a></li>
<li><a href="https://www.hongweipeng.com/index.php/archives/707/" target="_blank" rel="noopener">åŠ¨æ‰‹å†™ä¸€ä¸ªå¹¶å‘ç¼“å­˜æ¡†æ¶ å†ç¨‹</a></li>
</ol>
<hr>
<p>åŸæ–‡åœ°å€ï¼š <a href="https://github.com/francecil/leetcode/issues/38" target="_blank" rel="noopener">https://github.com/francecil/leetcode/issues/38</a></p>
]]></content>
      <categories>
        <category>å¤§å‰ç«¯</category>
      </categories>
      <tags>
        <tag>ECMAScript</tag>
        <tag>WebWorker</tag>
      </tags>
  </entry>
  <entry>
    <title>å‰ç«¯ä¸¤å¹´åŠé¢ç»æµæ°´è´¦</title>
    <url>/2020/03/19/2020/%E5%89%8D%E7%AB%AF%E4%B8%A4%E5%B9%B4%E5%8D%8A%E9%9D%A2%E7%BB%8F%E6%B5%81%E6%B0%B4%E8%B4%A6/</url>
    <content><![CDATA[<h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>å…ˆç®€å•ä»‹ç»ä¸‹æœ¬äººçš„æƒ…å†µï¼Œ2017å¹´æ¯•ä¸šäºç¦å·å¤§å­¦ï¼Œç„¶ååœ¨å¦é—¨ä¸€å®¶ CDN å…¬å¸ä»»èŒå‰ç«¯å¼€å‘å·¥ç¨‹å¸ˆï¼Œå¤§æ¦‚2å¹´åŠçš„å‰ç«¯å¼€å‘ç»éªŒã€‚</p>
<p>æ¥è§¦è¿‡åç«¯ç§»åŠ¨ç«¯ï¼Œç›®å‰ä¸»æ–¹å‘æ˜¯å‰ç«¯ã€‚å‚ä¸çš„é¡¹ç›®åŸºæœ¬éƒ½æ˜¯ toB ï¼Œä¸»è¦åˆ†ä¸ºæµåª’ä½“ï¼Œå¯è§†åŒ–ï¼Œå‰ç«¯ä¼˜åŒ–ï¼Œportalå¹³å°ç­‰å‡ ä¸ªæ–¹å‘ã€‚</p>
<p>åœ¨å¼€æºé¡¹ç›®æ–¹é¢ï¼Œå®ç°äº†ä¸€ä¸ªåŸºäº antd3 çš„å‰ç«¯é•¿åˆ—è¡¨ç›¸å…³ç»„ä»¶åº“ï¼ˆç°åœ¨å·²ä¸ç»´æŠ¤ï¼Œå¯ç›´æ¥ä½¿ç”¨ antd4</p>
<p>æœ€è¿‘åœ¨ç ”ç©¶çš„æŠ€æœ¯æœ‰ï¼šwebassemblyï¼Œwebgl</p>
<p>åºŸè¯ä¸å¤šè¯´ï¼Œä¸‹é¢è¿›å…¥æ­£é¢˜ ~</p>
<a id="more"></a>

<h2 id="é¢è¯•æ€»ç»“ä¸å»ºè®®"><a href="#é¢è¯•æ€»ç»“ä¸å»ºè®®" class="headerlink" title="é¢è¯•æ€»ç»“ä¸å»ºè®®"></a>é¢è¯•æ€»ç»“ä¸å»ºè®®</h2><p>å…ˆè¯´è¿™ä¸ªï¼Œæ¯”è¾ƒé‡è¦ã€‚</p>
<p>19å¹´åº•çš„å‡ ä¸ªé¢è¯•æ²¡åšå¥½å‡†å¤‡ï¼Œå¯¹è‡ªå·±è¿‡äºè‡ªä¿¡ï¼Œç›´æ¥æ‹¿å¤§å‚åˆ·é¢ç»ï¼Œç°åœ¨æƒ³æƒ³æ˜¯çœŸçš„è ¢ã€‚ã€‚</p>
<p>å»ºè®®å¤§å®¶å…ˆæ‰¾æœ‹å‹å¸®å¿™é¢è¯•ï¼Œç„¶åå¯ä»¥å…ˆæŠ•ä¸€äº›ä¸ä¼šå»çš„å‚åˆ·åˆ·ç»éªŒã€‚</p>
<p>ç”±äºå¤§å‚çš„é¢è¯•æµç¨‹æ¯”è¾ƒä¹…ï¼Œå¦‚æœæœ‰æµç¨‹è¾ƒå¿«çš„å¤‡èƒå…¬å¸çš„è¯ï¼Œå»ºè®®åœ¨å¤§å‚é¢è¯•çš„æœ«å°¾é˜¶æ®µå†æŠ•ï¼Œå¦åˆ™å¤šä¸ª hr å‚¬ç€ç»™ç­”å¤å¾ˆéš¾å—ã€‚</p>
<p>æŠ€æœ¯é¢çš„è¯ï¼Œå¤§éƒ¨åˆ†é—®é¢˜ç½‘ä¸Šéƒ½å¯ä»¥æ‰¾åˆ°ï¼Œä¸è¿‡æœ‰äº›é¢è¯•å®˜ä¼šå±‚å±‚é€’è¿›ï¼ŒèƒŒçš„è¿˜æ˜¯ç†è§£çš„ä¸€è¯•å°±çŸ¥é“</p>
<p>ç„¶åè¦æ³¨æ„éæŠ€æœ¯é¢˜ç›®ä¹Ÿå¾ˆé‡è¦ï¼Œéœ€è¦å¥½å¥½å‡†å¤‡ï¼ŒåŒ…æ‹¬ä¸”ä¸é™äºï¼š</p>
<ul>
<li>è‡ªæˆ‘ä»‹ç»ï¼ˆhrç‰ˆæœ¬å’ŒæŠ€é¢ç‰ˆæœ¬ï¼‰</li>
<li>ç¦»èŒåŸå› </li>
<li>æœªæ¥è§„åˆ’</li>
<li>ä¸ºä»€ä¹ˆä½ å¸Œæœ›æ¥æˆ‘ä»¬å…¬å¸å·¥ä½œ?</li>
<li>ä½ å¸Œæœ›é€šè¿‡è¿™ä»½å·¥ä½œè·å¾—ä»€ä¹ˆ?</li>
<li>è¯´è¯´ä¼˜ç¼ºç‚¹ï¼Œç”¨å‡ ä¸ªè¯æè¿°è‡ªå·±</li>
<li>è¿˜æœ‰ä»€ä¹ˆå…¶ä»–é—®é¢˜</li>
<li>ä¸ºä»€ä¹ˆé€‰æ‹©å‰ç«¯</li>
<li>å¹³æ—¶çš„å­¦ä¹ æ–¹å¼</li>
<li>å’ŒåŸåŒäº‹çš„æ¯”è¾ƒ</li>
<li>é¡¹ç›®å¼€å‘æµç¨‹ï¼Œç®¡ç†æµç¨‹</li>
</ul>
<p>æœ‰å‡ ä¸ªå¤§å‚å°±æ˜¯å› ä¸ºéæŠ€æœ¯é—®é¢˜æ²¡æœ‰å‡†å¤‡ï¼Œå›ç­”çš„æ—¶å€™è¡¨è¿°å¾ˆä¹±ï¼Œæœ€ç»ˆç»¼åˆä¸‹æŒ‚äº†ã€‚ã€‚</p>
<p>js æ‰‹å†™é¢˜å’Œç®—æ³•é¢˜çš„è¯å¯ä»¥å‚è€ƒè¿™ä¸ª<a href="https://github.com/francecil/leetcode/issues?q=is%3Aissue+is%3Aclosed" target="_blank" rel="noopener">é¡¹ç›®</a>ï¼Œè¿™æ˜¯æˆ‘åšè¿‡çš„é¢˜çš„ä¸€äº›è®°å½•</p>
<p>ç”±äºç–«æƒ…åŸå› ä¸­é—´åœäº†ä¸€æ®µæ—¶é—´æ²¡æœ‰é¢è¯•ï¼ŒåŠ ä¸Šç­‰å¾… offer çš„æ—¶é—´ï¼Œä»å¼€å§‹é¢è¯•åˆ°æœ€ç»ˆç¡®è®¤ offer å‰åä¹Ÿç»å†äº†ä¸‰ä¸ªæœˆçš„æ—¶é—´ã€‚åº†å¹¸çš„æ˜¯ï¼Œæœ€åæ‹¿åˆ°äº†æ»¡æ„çš„ offerã€‚</p>
<p>ä¸‹é¢å°±ä»¥é¢è¯•çš„é¡ºåºæ¥è¿›è¡Œæè¿°ï¼Œé¢è¯•æ—¶æ²¡æœ‰å½•éŸ³ï¼Œé¢˜ç›®éƒ½æ˜¯äº‹åè¿›è¡Œå›å¿†ï¼Œå†™çš„ä¸å…¨ï¼Œæœ‰äº›é‡å¤çš„é¢˜ç›®å¯èƒ½ä¸å†è®°å½•ã€‚</p>
<h2 id="é˜¿é‡Œ-ä¾›åº”é“¾å¹³å°"><a href="#é˜¿é‡Œ-ä¾›åº”é“¾å¹³å°" class="headerlink" title="é˜¿é‡Œ-ä¾›åº”é“¾å¹³å°"></a>é˜¿é‡Œ-ä¾›åº”é“¾å¹³å°</h2><p>é¢è¯•é˜¿é‡Œçš„å¥‘æœºæ˜¯æœ‰ä¸ªå¤§ä½¬é€šè¿‡åšå®¢æ‰¾åˆ°äº†æˆ‘çš„é‚®ç®±ï¼Œè¯´å¸®æˆ‘å†…æ¨ï¼Œæ­£å¥½å‡†å¤‡æ‰¾å·¥ä½œï¼Œäºæ˜¯å°±å¼€å§‹äº†é¢è¯•ä¹‹æ—…ï¼Œå…¶å®é‚£æ—¶å€™è¿˜æ²¡å‡†å¤‡å¥½ã€‚ã€‚</p>
<h3 id="ä¸€é¢-19-12-16"><a href="#ä¸€é¢-19-12-16" class="headerlink" title="ä¸€é¢ 19/12/16"></a>ä¸€é¢ 19/12/16</h3><ul>
<li><p>è®²ä¸€ä¸ªæœ€æœ‰éš¾åº¦çš„é¡¹ç›®</p>
<ul>
<li>è¿½é—®ï¼šæœ‰å“ªäº›åŠŸèƒ½ï¼Œè´Ÿè´£ä»€ä¹ˆæ¨¡å—</li>
<li>è¿½é—®ï¼šåšäº†å“ªäº›ä½“éªŒä¼˜åŒ–</li>
<li>è¿½é—®ï¼špv å¤šå°‘</li>
<li>è¿½é—®ï¼šé¦–å±åŠ è½½æ—¶é•¿</li>
</ul>
</li>
<li><p>vue å’Œ react çš„åŒºåˆ«</p>
<blockquote>
<p>è€ƒå¯Ÿçš„æ˜¯åŸç†ä¸Šçš„ä¸åŒï¼Œåƒä¸‡ä¸è¦è®²ç”¨æ³•ã€‚æ ¸å¿ƒåŒºåˆ«æ˜¯æ•°æ®æ›´æ–°è§¦å‘é¡µé¢é‡æ¸²æŸ“çš„æ–¹å¼ä¸ä¸€æ ·ã€‚vue é‡‡ç”¨çš„æ˜¯æ•°æ®æ‹¦æˆªå’Œä¾èµ–è¿½è¸ªï¼Œæ•°æ®å˜åŒ–å°±ä¼šè§¦å‘ç›¸åº”çš„æ›´æ–°ï¼›react é€šè¿‡apiå»å˜æ›´æ•°æ®å¹¶è¿›è¡Œå±€éƒ¨æ›´æ–°ï¼Œå› ä¸ºå¯¹æ•°æ®å˜åŒ–æ— æ„ŸçŸ¥ï¼Œå› æ­¤å¯èƒ½éœ€è¦å¯¹å­ç»„ä»¶ä¹Ÿè¿›è¡Œ renderï¼Œä¸ç„¶å­ç»„ä»¶ä¸çŸ¥é“æ˜¯å¦åº”è¯¥é‡æ–°render</p>
</blockquote>
</li>
<li><p>è™šæ‹Ÿdomç”¨æ¥è§£å†³ä»€ä¹ˆé—®é¢˜ï¼Œæ€§èƒ½å’Œè®¾è®¡ä¸¤æ–¹é¢å›ç­”</p>
<blockquote>
<p>å…¶å®é¢è¯•å®˜æƒ³è€ƒå¯Ÿçš„æ˜¯ç»„ä»¶å’Œåº•å±‚å…ƒç´ çš„æŠ½ç¦»è¿™ç‚¹ï¼Œæ€§èƒ½çš„è¯çœ‹ä¸šåŠ¡ä»£ç ä¸ä¸€å®šè™šæ‹Ÿ dom å°±æ¯”è¾ƒä¼˜</p>
</blockquote>
</li>
<li><p>react hooks è§£å†³äº†ä»€ä¹ˆé—®é¢˜</p>
<blockquote>
<p>çŠ¶æ€é€»è¾‘éš¾ä»¥å¤ç”¨ï¼›ç”Ÿå‘½å‘¨æœŸä¸­çš„é€»è¾‘ä»£ç éš¾ä»¥ç»´æŠ¤ï¼›this æŒ‡å‘é—®é¢˜</p>
</blockquote>
</li>
</ul>
<ul>
<li><p>è®²è®² vue åŸç†</p>
<blockquote>
<p>æ¨¡æ¿è§£æï¼Œå“åº”å¼ï¼Œæ¸²æŸ“</p>
</blockquote>
<ul>
<li>è¿½é—®ï¼šæ¨¡æ¿è§£æè¿‡ç¨‹ï¼Œæ ¸å¿ƒæ˜¯ä»€ä¹ˆ<blockquote>
<p>å½“æ—¶æ²¡ç†è§£é—®é¢˜è¦é—®ä»€ä¹ˆï¼Œæˆ‘çŒœåº”è¯¥æ˜¯è¦é—® vdom-&gt;diff-&gt;patch</p>
</blockquote>
</li>
</ul>
</li>
<li><p>ä»è¾“å…¥ url åˆ°é¡µé¢æ¸²æŸ“çš„è¿‡ç¨‹</p>
<blockquote>
<p>å‚çœ‹ <a href="https://gahing.top/2019/12/14/2019Q4/HTML%E6%96%87%E6%A1%A3%E7%9A%84%E5%8A%A0%E8%BD%BD%E8%BF%87%E7%A8%8B/">ä»è¾“å…¥urlåæµè§ˆå™¨å‘ç”Ÿäº†ä»€ä¹ˆ</a></p>
</blockquote>
<ul>
<li>è¿½é—®ï¼šå“ªäº›åœ°æ–¹å¯ä»¥åšä¼˜åŒ–ï¼Œåšä¸ªå½’ç±»</li>
</ul>
</li>
<li><p>csrf</p>
<ul>
<li>è¿½é—®ï¼šä¸æ˜¯è¯´ cookie éš”ç¦»çš„ä¹ˆï¼Œä¸ºä»€ä¹ˆå…¶ä»–é¡µé¢å‘è¯·æ±‚ä¼šå¸¦ä¸Š<blockquote>
<p>å‚çœ‹ <a href="https://gahing.top/2020/03/08/2020/%E9%9D%A2%E8%AF%95%E5%AE%98%E9%97%AE%EF%BC%9A%E4%BB%80%E4%B9%88%E6%98%AF%20canvas%20%E6%B1%A1%E6%9F%93/">é¢è¯•å®˜é—®ï¼šä»€ä¹ˆæ˜¯ canvas æ±¡æŸ“</a></p>
</blockquote>
</li>
</ul>
</li>
<li><p>settimeout ï¼Œpromiseï¼Œasync/await åŒºåˆ«</p>
<blockquote>
<p>å®ä»»åŠ¡ï¼Œå¾®ä»»åŠ¡ï¼Œåç¨‹</p>
</blockquote>
<ul>
<li>è¿½é—®ï¼šäº‹ä»¶å¾ªç¯æœ‰å“ªäº›ä»»åŠ¡æº<blockquote>
<p>ç½‘ç»œï¼Œå®šæ—¶å™¨ï¼Œhistoryï¼Œç”¨æˆ·äº¤äº’äº‹ä»¶ï¼ŒDOM manipulation</p>
</blockquote>
</li>
<li>è¿½é—®ï¼šä»¥ä»€ä¹ˆä¼˜å…ˆçº§å–ä»»åŠ¡æº<blockquote>
<p>3/4æ¦‚ç‡æ‹¿äº¤äº’ä»»åŠ¡æºï¼Œé¿å…äº¤äº’å µå¡</p>
</blockquote>
</li>
</ul>
</li>
<li><p>åç«¯é¡¹ç›®ï¼Œç”¨çš„ä»€ä¹ˆæ¡†æ¶</p>
<ul>
<li>express çš„ä¸­é—´ä»¶åŸç†<blockquote>
<p>æœ¬è´¨å°±æ˜¯å›è°ƒé˜Ÿåˆ—ï¼Œnext æ‰§è¡Œ</p>
</blockquote>
</li>
<li>egg</li>
</ul>
</li>
</ul>
<h3 id="äºŒé¢-19-12-26"><a href="#äºŒé¢-19-12-26" class="headerlink" title="äºŒé¢ 19/12/26"></a>äºŒé¢ 19/12/26</h3><ul>
<li>é¡¹ç›®å’Œä¸šåŠ¡çš„ç›¸å…³é—®é¢˜</li>
<li>ä¸¤é“ js æ‰‹å†™é¢˜</li>
</ul>
<p>å¯èƒ½æ˜¯é¡¹ç›®ç»å†å’ŒæŠ€èƒ½ä¸å²—ä½è¦æ±‚ä¸åŒ¹é…ï¼Œåœ¨ 28 å·æ”¶åˆ°äº†æ‹’ä¿¡ï¼Œç®€å†è¿›å…¥äº†äººæ‰æ± ..</p>
<h2 id="å­—èŠ‚-ä»Šæ—¥å¤´æ¡"><a href="#å­—èŠ‚-ä»Šæ—¥å¤´æ¡" class="headerlink" title="å­—èŠ‚-ä»Šæ—¥å¤´æ¡"></a>å­—èŠ‚-ä»Šæ—¥å¤´æ¡</h2><p>å¤´æ¡æ˜¯æ²¡åšå¥½å‡†å¤‡å°±å»é¢çš„ï¼Œç»“æœå¾ˆå·®</p>
<h3 id="ä¸€é¢-19-12-23"><a href="#ä¸€é¢-19-12-23" class="headerlink" title="ä¸€é¢ 19/12/23"></a>ä¸€é¢ 19/12/23</h3><ul>
<li>èŠé¡¹ç›®</li>
<li>vue/react çš„ç›¸å…³é—®é¢˜</li>
<li>ã€ç¬”è¯•ã€‘å†™ä¸ªç»§æ‰¿</li>
<li>è®²è®²åŸå‹é“¾<blockquote>
<p>å‚çœ‹ <a href="https://gahing.top/2019/12/31/2019Q4/%E9%87%8D%E5%AD%A6%20JS%20%E5%8E%9F%E5%9E%8B%E9%93%BE/">é‡å­¦ JS åŸå‹é“¾</a></p>
</blockquote>
</li>
<li>è®²è®²æ¨¡å—åŒ–</li>
<li>webpack ä¸­ loader å’Œ plugin çš„åŒºåˆ«</li>
<li>class çš„ super åšäº†ä»€ä¹ˆ</li>
</ul>
<h2 id="ç¾å›¢-ä¼å¹³"><a href="#ç¾å›¢-ä¼å¹³" class="headerlink" title="ç¾å›¢-ä¼å¹³"></a>ç¾å›¢-ä¼å¹³</h2><h3 id="ä¸€é¢-19-12-26"><a href="#ä¸€é¢-19-12-26" class="headerlink" title="ä¸€é¢ 19/12/26"></a>ä¸€é¢ 19/12/26</h3><ul>
<li>åŸºæœ¬æ˜¯è®²é¡¹ç›®<ul>
<li>é•¿åˆ—è¡¨ä¸ºä½•ä¸åšèŠ‚æµ<blockquote>
<p>å‚çœ‹ <a href="https://gahing.top/2020/01/07/2020/%E4%B8%BA%E4%BB%80%E4%B9%88%E4%B8%8D%E7%94%A8rAF%E8%BF%9B%E8%A1%8C%E6%BB%9A%E5%8A%A8%E8%8A%82%E6%B5%81/">ä¸ºä»€ä¹ˆä¸ç”¨rAFè¿›è¡Œæ»šåŠ¨èŠ‚æµ</a></p>
</blockquote>
</li>
</ul>
</li>
<li>åŒåŸŸè¯·æ±‚çš„å¹¶å‘æ•°é™åˆ¶çš„åŸå› <blockquote>
<p>çº¿ç¨‹åˆ‡æ¢æŸè€—ï¼Œç«¯å£å ç”¨é™åˆ¶</p>
</blockquote>
</li>
<li>vuex è§£å†³ä»€ä¹ˆé—®é¢˜</li>
<li>cdn åŠ é€ŸåŸç†</li>
<li>ç»„å†…å¼€å‘æµç¨‹ï¼Œå¦‚ä½•æé«˜ä»£ç è´¨é‡</li>
</ul>
<h3 id="äºŒé¢-19-12-17"><a href="#äºŒé¢-19-12-17" class="headerlink" title="äºŒé¢ 19/12/17"></a>äºŒé¢ 19/12/17</h3><ul>
<li>js å†…å­˜æ¨¡å‹</li>
<li>è®²è®²é—­åŒ…</li>
<li>è®²è®²åŸå‹é“¾</li>
<li>è®²è®²å˜é‡æå‡</li>
<li>vue å’Œ react çš„åŒºåˆ«</li>
<li>http2 çš„ç‰¹ç‚¹</li>
<li>https åŸç†</li>
<li>è®²è®²ç¼“å­˜</li>
<li>è®²è®²åŒå‘ç»‘å®š</li>
<li>è®²è®²jsçš„çº¿ç¨‹</li>
<li>å¼€æ”¾é¢˜ï¼šjs æ˜¯ä¸€é—¨é¢å‘å¯¹è±¡çš„è¯­è¨€ä¹ˆï¼Ÿ</li>
<li>è®²è®²é¡¹ç›®ä¸­ç”¨åˆ°çš„è®¾è®¡æ¨¡å¼</li>
<li>æœ€è¿‘å…³æ³¨çš„æ–°æŠ€æœ¯</li>
<li>é¡¹ç›®ä¸Šçš„é—®é¢˜</li>
<li>ã€ç¬”è¯•ã€‘è½¬é©¼å³°</li>
</ul>
<h2 id="shopee"><a href="#shopee" class="headerlink" title="shopee"></a>shopee</h2><p>ä¸€å¼€å§‹ä»¥ä¸ºæ˜¯å°å…¬å¸ï¼Œæƒ³æ‹¿æ¥åˆ·é¢ç»ï¼Œåé¢æ‰å‘ç°è¿™ä¸ªå…¬å¸æŒºä¸é”™çš„ã€‚</p>
<p>æœ¬æ¬¡é¢è¯•åº”è¯¥æ˜¯æœ€åä¸€æ¬¡æ²¡æœ‰å‡†å¤‡çš„é¢è¯•</p>
<h3 id="ä¸€é¢-2020-12-30"><a href="#ä¸€é¢-2020-12-30" class="headerlink" title="ä¸€é¢ 2020/12/30"></a>ä¸€é¢ 2020/12/30</h3><ul>
<li>ã€ç¬”è¯•ã€‘æ¨¡æ‹Ÿ instanceOf</li>
<li>è®²è®²åŸå‹</li>
<li>è®²è®²ä¸­é—´äººæ”»å‡»</li>
</ul>
<h2 id="ringcenter"><a href="#ringcenter" class="headerlink" title="ringcenter"></a>ringcenter</h2><p>å…ˆåšäº†å‡ é“ç¬”è¯•é¢˜ï¼Œä¸»è¦è€ƒè™‘ es6è¯­æ³•å’Œä»£ç é£æ ¼ï¼Œæˆ‘é¢è¯•çš„éƒ¨é—¨å¬è¯´åªæœ‰ä¸€è½®æŠ€æœ¯é¢ï¼Œæ‰€ä»¥å‰åèŠäº†å¿«ä¸¤ä¸ªå°æ—¶</p>
<h3 id="ä¸€é¢-2020-1-2"><a href="#ä¸€é¢-2020-1-2" class="headerlink" title="ä¸€é¢ 2020/1/2"></a>ä¸€é¢ 2020/1/2</h3><ul>
<li>react ç›¸å…³é—®é¢˜</li>
<li>css åŸºçº¿</li>
<li>css ç›’æ¨¡å‹ åµŒå¥—å—å…ƒç´ æœ€ç»ˆ marginTop çš„å€¼</li>
<li>vue å’Œ react çš„æ¯”è¾ƒ</li>
<li>https ä»…ç”¨éå¯¹ç§°åŠ å¯†çš„å¯è¡Œæ€§</li>
<li>è¯æ³•ç¯å¢ƒ</li>
<li>äº‹ä»¶å¾ªç¯ï¼Œå›è°ƒç”±å“ªä¸ªçº¿ç¨‹å¤„ç†</li>
<li>ç¼–ç¨‹ä¹ æƒ¯ç›¸å…³</li>
<li>ä»£ç æ€§èƒ½ç›¸å…³</li>
</ul>
<p>css æ²¡æ€ä¹ˆå‡†å¤‡ï¼Œå›ç­”é”™äº†ï¼Œæœ€åæŒ‚æ‰</p>
<h2 id="é˜¿é‡Œ-æ”¿åŠ¡ä¸­å°"><a href="#é˜¿é‡Œ-æ”¿åŠ¡ä¸­å°" class="headerlink" title="é˜¿é‡Œ-æ”¿åŠ¡ä¸­å°"></a>é˜¿é‡Œ-æ”¿åŠ¡ä¸­å°</h2><p>æ¢äº†ä¸€ä¸ªéƒ¨é—¨æŠ•é€’ï¼Œä¸è¿‡éƒ¨é—¨ä¹‹é—´æ˜¯ä¼šäº¤æµçš„ã€‚ä¸è¦ä»¥ä¸ºå‰ä¸€ä¸ªéƒ¨é—¨æŒ‚æ‰å¯¹ä¸‹ä¸€ä¸ªéƒ¨é—¨æ²¡æœ‰å½±å“ã€‚ã€‚</p>
<p>ä¸è¿‡å¥½åƒå‰ä¸€ä¸ªéƒ¨é—¨å¯¹æˆ‘çš„è¯„ä»·è¿˜è¡Œ</p>
<h3 id="ä¸€é¢-2020-1-3"><a href="#ä¸€é¢-2020-1-3" class="headerlink" title="ä¸€é¢ 2020/1/3"></a>ä¸€é¢ 2020/1/3</h3><ul>
<li>æŸä¸ªåˆ—è¡¨ç»„ä»¶æœ‰å¤§é‡ dom èŠ‚ç‚¹ï¼Œå¦‚ä½•ä¼˜åŒ–</li>
<li>è™šæ‹Ÿ dom</li>
<li>301 å’Œ 302 çš„ä½¿ç”¨åœºæ™¯</li>
</ul>
<h3 id="ç¬”è¯•-2020-1-7"><a href="#ç¬”è¯•-2020-1-7" class="headerlink" title="ç¬”è¯• 2020/1/7"></a>ç¬”è¯• 2020/1/7</h3><p>åšäº†ä¸‰é“ç¬”è¯•é¢˜ï¼šå»é‡ï¼Œæ¨¡æ‹Ÿ renderï¼Œç»§æ‰¿</p>
<h3 id="äºŒé¢-2020-1-8"><a href="#äºŒé¢-2020-1-8" class="headerlink" title="äºŒé¢ 2020/1/8"></a>äºŒé¢ 2020/1/8</h3><ul>
<li>ä¸»è¦æ˜¯é—®é¡¹ç›®</li>
<li>çŠ¶æ€ç </li>
<li>PUT å’Œ POST çš„åŒºåˆ«<blockquote>
<p>å¹‚ç­‰æ€§</p>
</blockquote>
</li>
</ul>
<p>æœ€åèŠå¤©çš„æ—¶å€™ï¼Œé¢è¯•å®˜è¯´å·²ç»è®¤å¯æˆ‘çš„æŠ€æœ¯äº†ï¼Œè®©æˆ‘å¥½å¥½å‡†å¤‡åé¢çš„é¢è¯•ï¼Œå¦å¤–è®©æˆ‘æ³¨æ„ä¸‹è¡¨ç¤ºæ–¹å¼å’ŒæŠ€å·§ã€‚é‚£æ—¶å€™è¿˜ä»¥ä¸ºç¨³äº†ã€‚ã€‚</p>
<h3 id="ä¸‰é¢-2020-1-16"><a href="#ä¸‰é¢-2020-1-16" class="headerlink" title="ä¸‰é¢ 2020/1/16"></a>ä¸‰é¢ 2020/1/16</h3><ul>
<li>æŠ€æœ¯æˆé•¿ç›¸å…³</li>
<li>å’Œå…¶ä»–åŒäº‹çš„æ¯”è¾ƒ</li>
<li>å­¦ä¹ å’Œå·¥ä½œ</li>
<li>å¦‚ä½•å­¦ä¹ </li>
<li>å½¢å®¹è‡ªå·±</li>
</ul>
<p>åº”è¯¥æ˜¯å¹³å°çš„è´Ÿè´£äººé¢è¯•ï¼Œéƒ½æ˜¯éæŠ€æœ¯æ€§é—®é¢˜ï¼Œæœ‰äº›é¢˜ç›®æ²¡æœ‰å‡†å¤‡ç»“æœå›ç­”çš„å¾ˆå·®ã€‚ã€‚</p>
<h3 id="äº¤å‰é¢-2020-1-17"><a href="#äº¤å‰é¢-2020-1-17" class="headerlink" title="äº¤å‰é¢ 2020/1/17"></a>äº¤å‰é¢ 2020/1/17</h3><p>éš”å¤©å°±æ”¶åˆ°äº†å››é¢çš„é€šçŸ¥ï¼Œå¦‚æœè¿™é¢è¿‡äº†åº”è¯¥å°±ç¨³äº†ã€‚ã€‚</p>
<p>ç»“æœä¸Šæ¥å°±æ˜¯ react ç›¸å…³é—®é¢˜ï¼Œ ç”±äºæˆ‘ react äº†è§£çš„ä¸æ˜¯é‚£ä¹ˆæ·±å…¥ï¼Œå¾ˆå¤šå›ç­”ä¸ä¸Šæ¥ï¼Œæˆ‘åªå¥½å¯¹é¢è¯•å®˜è‡ªå·±ç†Ÿæ‚‰çš„ vue ï¼Œå¸Œæœ›å¾€ vue æ–¹é¢é ã€‚åé¢é¢è¯•å®˜å°±æ²¡æœ‰ç»§ç»­é—®äº†ï¼Œä¸»è¦èŠé¡¹ç›®è¿™å—ã€‚</p>
<p>é¢è¯•å®Œä¹‹åæ„Ÿè§‰å‡‰äº†ï¼Œç”±äºæ²¡æœ‰æ”¶åˆ°æ‹’ä¿¡ï¼Œä½†æ˜¯å†…å¿ƒåˆå­˜åœ¨ç€ä¸€ç‚¹å°å¸Œæœ›ã€‚</p>
<p>åé¢å°±æ˜¯è¿‡å¹´äº†ï¼Œboss ä¸Šé—®å†…æ¨çš„é‚£ä¸ªäººä¹Ÿæ²¡æœ‰å›å¤ï¼Œç›´åˆ°2æœˆåˆåˆæœ‰æ–°çš„éƒ¨é—¨ä»ç®€å†æ± æŠŠæˆ‘æèµ·æ¥ï¼Œæˆ‘æ‰çŸ¥é“æŒ‚äº†ã€‚</p>
<p>è¿™é‡Œå»ºè®®å¯ä»¥åŠ ä¸€ä¸‹é¢è¯•å®˜çš„å¾®ä¿¡ï¼ˆå¦‚æœå¯¹æ–¹åŒæ„çš„è¯ï¼‰ï¼Œå¯ä»¥äº†è§£åé¦ˆï¼Œäº¤ä¸ªæœ‹å‹</p>
<h2 id="ç¾å›¢æ°‘å®¿"><a href="#ç¾å›¢æ°‘å®¿" class="headerlink" title="ç¾å›¢æ°‘å®¿"></a>ç¾å›¢æ°‘å®¿</h2><h3 id="ä¸€é¢-2020-1-7"><a href="#ä¸€é¢-2020-1-7" class="headerlink" title="ä¸€é¢ 2020/1/7"></a>ä¸€é¢ 2020/1/7</h3><ul>
<li>é¡¹ç›®ç›¸å…³</li>
<li>ã€ç¬”è¯•ã€‘æ‰¾åˆ°å­—ç¬¦ä¸²ä¸­å‡ºç°æ¬¡æ•°æœ€å¤šçš„å­—æ¯</li>
<li>java æ€ä¹ˆå®ç°å•ä¾‹<blockquote>
<p>é¥¿æ±‰ï¼Œæ‡’æ±‰</p>
</blockquote>
</li>
<li>ä¸ºä»€ä¹ˆ js ä¸­æ²¡æœ‰å•ä¾‹<blockquote>
<p>å•çº¿ç¨‹</p>
</blockquote>
</li>
</ul>
<h3 id="ç¾å›¢æ°‘å®¿-äºŒé¢-2020-1-7"><a href="#ç¾å›¢æ°‘å®¿-äºŒé¢-2020-1-7" class="headerlink" title="ç¾å›¢æ°‘å®¿ äºŒé¢ 2020/1/7"></a>ç¾å›¢æ°‘å®¿ äºŒé¢ 2020/1/7</h3><p>æŠ€æœ¯æˆé•¿æ–¹é¢</p>
<p>åœ¨â€œä¸ºä»€ä¹ˆç¦»èŒâ€è¿™ä¸ªé—®é¢˜ä¸Šèµ°è¿œäº†ã€‚ã€‚</p>
<h2 id="è…¾è®¯æ–‡æ¡£"><a href="#è…¾è®¯æ–‡æ¡£" class="headerlink" title="è…¾è®¯æ–‡æ¡£"></a>è…¾è®¯æ–‡æ¡£</h2><h3 id="ä¸€é¢-2020-1-9"><a href="#ä¸€é¢-2020-1-9" class="headerlink" title="ä¸€é¢ 2020/1/9"></a>ä¸€é¢ 2020/1/9</h3><ul>
<li>æœåŠ¡ç«¯æ¸²æŸ“åŸç†</li>
<li>ã€ç¬”è¯•é¢˜ã€‘26è¿›åˆ¶<blockquote>
<p><a href="https://github.com/francecil/leetcode/issues/29" target="_blank" rel="noopener">å®ç°26è¿›åˆ¶</a></p>
</blockquote>
</li>
<li>http åè®®</li>
<li>chrome å¼€ä¹…äº†å¡é¡¿çš„åŸå› </li>
</ul>
<p>ç¬”è¯•é¢˜æ²¡æœ‰å®Œç¾å†™å‡ºæ¥ï¼ŒåŠ ä¹‹ä¹‹å‰æ²¡å‡†å¤‡é¢è¯•çš„å¦ä¸€ä¸ªéƒ¨é—¨å¯¹æˆ‘çš„è¯„ä»·è¾ƒå·®ï¼Œç»¼åˆä¸‹æŒ‚æ‰äº†ã€‚<br>å†æ¬¡æç¤ºï¼Œå…¶ä»–éƒ¨é—¨çš„é¢è¯•åé¦ˆä¼šå½±å“æœ¬éƒ¨é—¨çš„é¢è¯•æˆç»©ã€‚</p>
<h2 id="å¹´å‰é˜¶æ®µæ€»ç»“"><a href="#å¹´å‰é˜¶æ®µæ€»ç»“" class="headerlink" title="å¹´å‰é˜¶æ®µæ€»ç»“"></a>å¹´å‰é˜¶æ®µæ€»ç»“</h2><p>å¹´å‰çš„é¢è¯•å¤§æ¦‚å°±æ˜¯è¿™æ ·ï¼Œå¾ˆæƒ¨ï¼Œä¸€ä¸ª offer éƒ½æ²¡æœ‰ã€‚</p>
<p>æ‰€ä»¥å»ºè®®åšå¥½å‡†å¤‡å†å¼€å§‹é¢è¯•</p>
<p>å—ç–«æƒ…å½±å“ï¼Œåœ¨å®¶é‡Œå‘†äº†ä¸€ä¸ªæœˆã€‚é‚£æ—¶å€™ç–«æƒ…æ¯”è¾ƒææ€–ï¼Œæ‰“ç®—ç›´æ¥æ‰¾å¦é—¨çš„å…¬å¸äº†</p>
<h2 id="äº¿è”"><a href="#äº¿è”" class="headerlink" title="äº¿è”"></a>äº¿è”</h2><h3 id="ä¸€é¢-2020-2-25"><a href="#ä¸€é¢-2020-2-25" class="headerlink" title="ä¸€é¢ 2020/2/25"></a>ä¸€é¢ 2020/2/25</h3><ul>
<li>æ•°æ®ç»“æ„ï¼š hash è¡¨ï¼ˆçº¢é»‘æ ‘ï¼Œæ‰©å®¹ï¼Œhashç®—æ³•ï¼‰ï¼ŒLinkedList</li>
<li>vue å’Œ react åœ¨ dom diff ä¸Šçš„å·®åˆ«</li>
<li>v8 çš„åˆ†ä»£åƒåœ¾å›æ”¶</li>
</ul>
<h3 id="äºŒé¢-2020-2-26"><a href="#äºŒé¢-2020-2-26" class="headerlink" title="äºŒé¢ 2020/2/26"></a>äºŒé¢ 2020/2/26</h3><ul>
<li>åç«¯æ•°æ®å¤ªå¤§ï¼Œé•¿åˆ—è¡¨ç™½å±è¾ƒä¹…å¦‚ä½•è§£å†³<blockquote>
<p> é˜²æŠ–+loading</p>
</blockquote>
</li>
</ul>
<h2 id="å­—èŠ‚è·³åŠ¨-è¥¿ç“œè§†é¢‘"><a href="#å­—èŠ‚è·³åŠ¨-è¥¿ç“œè§†é¢‘" class="headerlink" title="å­—èŠ‚è·³åŠ¨-è¥¿ç“œè§†é¢‘"></a>å­—èŠ‚è·³åŠ¨-è¥¿ç“œè§†é¢‘</h2><p>å‘ç°å­—èŠ‚åœ¨å¦é—¨ä¹Ÿæœ‰å›¢é˜Ÿï¼Œäºæ˜¯æ‹œæ‰˜äº†å­¦å¼Ÿå¸®æˆ‘å†…æ¨ï¼Œæ•´ä¸ªè¿‡ç¨‹è¿˜æ˜¯æ¯”è¾ƒé¡ºåˆ©çš„</p>
<h3 id="ä¸€ã€äºŒé¢-2020-2-26"><a href="#ä¸€ã€äºŒé¢-2020-2-26" class="headerlink" title="ä¸€ã€äºŒé¢ 2020/2/26"></a>ä¸€ã€äºŒé¢ 2020/2/26</h3><ul>
<li>åŒæºç­–ç•¥ï¼Œä¸ºä»€ä¹ˆä¼šæœ‰è·¨åŸŸé™åˆ¶ï¼Ÿ</li>
<li>ã€ç¬”è¯•ã€‘fetch å¢åŠ è¶…æ—¶åŠŸèƒ½</li>
<li>ã€ç¬”è¯•ã€‘éé€’å½’äºŒå‰æ ‘å‰åºéå†</li>
<li>ã€ç¬”è¯•ã€‘å–å€¼ 1~100 çš„å…ƒç´ ï¼Œè¿›è¡Œæ’åºï¼ˆè®¡æ•°æ’åº&amp;å¿«æ’ï¼‰</li>
<li>å¤§æ•°æ®çš„å›¾è¡¨ä¼˜åŒ–</li>
</ul>
<p>ä¸¤ä¸ªé¢è¯•æ˜¯ä¸€èµ·çš„ï¼Œæ€»å…±å¤§æ¦‚2ä¸ªå¤šå°æ—¶ï¼Œåé¢èƒ½è®°ä½çš„é¢˜ç›®ä¹Ÿä¸å¤šäº†ã€‚</p>
<h3 id="ä¸‰é¢-2020-3-3"><a href="#ä¸‰é¢-2020-3-3" class="headerlink" title="ä¸‰é¢ 2020/3/3"></a>ä¸‰é¢ 2020/3/3</h3><p>å…ˆæ˜¯é—®äº†ä¹‹å‰é¢å¤´æ¡ä¸ºä»€ä¹ˆä¼šæŒ‚ï¼Œç„¶åæŠŠä¸€äº›é—®é¢˜é‡é—®äº†ä¸€é</p>
<ul>
<li>react æ‰¹é‡æ›´æ–°åŸç†</li>
<li>react fiber</li>
<li>react hooks</li>
<li>vue3 çš„æ”¹è¿›</li>
<li>websocket åè®®ï¼Œè½®è¯¢ï¼Œé•¿è¿æ¥</li>
<li>canvas,svg å¯¹æ¯”ï¼Œcanvas è½¬å›¾ç‰‡ï¼Œcanvas æ±¡æŸ“</li>
<li>æµåª’ä½“ç›¸å…³</li>
<li>JSBridge</li>
<li>h5 å¼€å‘ç›¸å…³</li>
</ul>
<h2 id="æœ€å"><a href="#æœ€å" class="headerlink" title="æœ€å"></a>æœ€å</h2><p>å¤©é“é…¬å‹¤ï¼Œä¸å›å…±å‹‰~</p>
<p>å¸Œæœ›æœ¬æ–‡èƒ½ç»™æ‚¨å¸¦æ¥ä¸€ç‚¹ç‚¹å¸®åŠ©</p>
]]></content>
      <categories>
        <category>éšç¬”</category>
      </categories>
      <tags>
        <tag>é¢ç»</tag>
      </tags>
  </entry>
  <entry>
    <title>WebGL çº¹ç†</title>
    <url>/2020/03/18/WebGL/WebGL%20%E7%BA%B9%E7%90%86/</url>
    <content><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>å¯¹ä¸€ä¸ªå‡ ä½•å›¾å½¢è¿›è¡Œè´´å›¾ï¼Œæ‰€è´´çš„å›¾å°±å«<strong>çº¹ç†</strong>(texture)ï¼Œæˆ–<strong>çº¹ç†å›¾åƒ</strong>(texture image)</p>
<p>è´´å›¾çš„è¿‡ç¨‹å«åš<strong>çº¹ç†æ˜ å°„</strong></p>
<p>ç»„æˆçº¹ç†å›¾åƒçš„åƒç´ æˆä¸º <strong>çº¹ç´ </strong>(texels, texture elements) </p>
<p>å…‰æ …åŒ–æ—¶æ¯ä¸ªç‰‡å…ƒä¼šæ¶‚ä¸Šçº¹ç´ </p>
<p>çº¹ç†å’Œå…‰ç…§ä¸€æ ·ï¼Œéƒ½æ˜¯ä½œç”¨äºä¸–ç•Œåæ ‡ç³»çš„ï¼Œä¸å—æŠ•å½±å’Œè§†å›¾çŸ©é˜µçš„å½±å“</p>
<a id="more"></a>

<p>ä¸‹é¢è¯´è¯´çº¹ç†æ˜ å°„çš„å…·ä½“è¿‡ç¨‹</p>
<h1 id="çº¹ç†æ˜ å°„"><a href="#çº¹ç†æ˜ å°„" class="headerlink" title="çº¹ç†æ˜ å°„"></a>çº¹ç†æ˜ å°„</h1><p>ä¸»è¦åˆ†ä¸º 4 æ­¥ï¼š</p>
<ol>
<li>åˆå§‹åŒ–çº¹ç†ä¿¡æ¯</li>
<li>åŠ è½½çº¹ç†å›¾åƒ</li>
<li>é…ç½®å¹¶ä½¿ç”¨çº¹ç†</li>
<li>ç€è‰²å™¨å¤„ç†</li>
</ol>
<h2 id="1-åˆå§‹åŒ–çº¹ç†ä¿¡æ¯"><a href="#1-åˆå§‹åŒ–çº¹ç†ä¿¡æ¯" class="headerlink" title="1. åˆå§‹åŒ–çº¹ç†ä¿¡æ¯"></a>1. åˆå§‹åŒ–çº¹ç†ä¿¡æ¯</h2><p>è¿™ä¸€æ­¥ä¸»è¦æ˜¯è®¾ç½®çº¹ç†åæ ‡ï¼Œé€šè¿‡ buffer ç»‘å®šå±æ€§</p>
<p>é¦–å…ˆéœ€è¦ç¡®å®šçº¹ç†çš„åæ ‡ç³»ï¼Œé‡‡ç”¨ s-t åæ ‡ç³»ï¼Œè§ä¸‹å›¾æŸ¥çœ‹æ˜ å°„å…³ç³»</p>
<p><img src="https://upload-images.jianshu.io/upload_images/9277731-fda445428710a7b7.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="texture_coord"></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">initVertexBuffers</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">const</span> verticesTexCoords = <span class="keyword">new</span> <span class="built_in">Float32Array</span>([</span><br><span class="line">    <span class="comment">// é¡¶ç‚¹åæ ‡,    çº¹ç†åæ ‡</span></span><br><span class="line">    <span class="number">-0.5</span>,  <span class="number">0.5</span>,   <span class="number">0.0</span>, <span class="number">1.0</span>,</span><br><span class="line">    <span class="number">-0.5</span>, <span class="number">-0.5</span>,   <span class="number">0.0</span>, <span class="number">0.0</span>,</span><br><span class="line">     <span class="number">0.5</span>,  <span class="number">0.5</span>,   <span class="number">1.0</span>, <span class="number">1.0</span>,</span><br><span class="line">     <span class="number">0.5</span>, <span class="number">-0.5</span>,   <span class="number">1.0</span>, <span class="number">0.0</span>,</span><br><span class="line">  ]);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// ... çœç•¥é¡¶ç‚¹åæ ‡çš„å¤„ç†</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> FSIZE = verticesTexCoords.BYTES_PER_ELEMENT;</span><br><span class="line">  <span class="keyword">var</span> a_TexCoord = gl.getAttribLocation(program, <span class="string">"a_texCoord"</span>);</span><br><span class="line">  <span class="keyword">var</span> texcoordBuffer = gl.createBuffer();</span><br><span class="line">  gl.bindBuffer(gl.ARRAY_BUFFER, texcoordBuffer);</span><br><span class="line">  gl.bufferData(gl.ARRAY_BUFFER, verticesTexCoords, gl.STATIC_DRAW);</span><br><span class="line">  <span class="comment">// æ¯æ¬¡è¿­ä»£è¿è¡Œè¿åŠ¨ 4 FSIZE å†…å­˜åˆ°ä¸‹ä¸€ä¸ªæ•°æ®å¼€å§‹ç‚¹</span></span><br><span class="line">  <span class="comment">// åˆå§‹è¯»å–çš„åç§»é‡ä¸º 2 FSIZE</span></span><br><span class="line">  gl.vertexAttribPointer(a_TexCoord, <span class="number">2</span>, gl.FLOAT, <span class="literal">false</span>, FSIZE * <span class="number">4</span>, FSIZE * <span class="number">2</span>);</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-åŠ è½½çº¹ç†å›¾åƒ"><a href="#2-åŠ è½½çº¹ç†å›¾åƒ" class="headerlink" title="2. åŠ è½½çº¹ç†å›¾åƒ"></a>2. åŠ è½½çº¹ç†å›¾åƒ</h2><p>åŠ è½½çš„çº¹ç†å›¾åƒä¸èƒ½å¯¹ canvas é€ æˆæ±¡æŸ“ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯¹çº¹ç†çš„åŠ è½½åŒæ ·éœ€è¦éµå¾ªè·¨åŸŸè®¿é—®è§„åˆ™</p>
<blockquote>
<p>å…·ä½“åŸå› è¯·çœ‹ <a href="https://juejin.im/post/5e64f811e51d4526e807fefa" target="_blank" rel="noopener">é¢è¯•å®˜é—®ï¼šä»€ä¹ˆæ˜¯ canvas æ±¡æŸ“</a></p>
</blockquote>
<p>æœ¬æ–‡é‡‡ç”¨çš„çº¹ç†å›¾ç‰‡åœ°å€ä¸º <code>https://webglfundamentals.org/webgl/resources/leaves.jpg</code></p>
<p>ä¸ºäº†è¿›è¡Œè·¨åŸŸè®¿é—®ï¼Œè¿˜éœ€è¦è®¾ç½® <code>crossOrigin = &quot;Anonymous&quot;</code></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">loadImage</span> (<span class="params">url, callback</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> img = <span class="keyword">new</span> Image();</span><br><span class="line">  img.crossOrigin = <span class="string">"Anonymous"</span></span><br><span class="line">  img.src = url;</span><br><span class="line">  img.onload = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    callback(img)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">loadImage(<span class="string">"https://webglfundamentals.org/webgl/resources/leaves.jpg"</span>, (img) =&gt; &#123;</span><br><span class="line">  <span class="comment">// å¯¹ img è¿›è¡Œä¸‹ä¸€æ­¥å¤„ç†</span></span><br><span class="line">  loadTexture(img)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>





<h2 id="3-é…ç½®å¹¶ä½¿ç”¨çº¹ç†"><a href="#3-é…ç½®å¹¶ä½¿ç”¨çº¹ç†" class="headerlink" title="3. é…ç½®å¹¶ä½¿ç”¨çº¹ç†"></a>3. é…ç½®å¹¶ä½¿ç”¨çº¹ç†</h2><h3 id="å¤„ç†å›¾åƒï¼ˆå¯é€‰ï¼‰"><a href="#å¤„ç†å›¾åƒï¼ˆå¯é€‰ï¼‰" class="headerlink" title="å¤„ç†å›¾åƒï¼ˆå¯é€‰ï¼‰"></a>å¤„ç†å›¾åƒï¼ˆå¯é€‰ï¼‰</h3><p>æœ‰ä»¥ä¸‹ç”¨æ³•</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å¯¹å›¾åƒè¿›è¡Œ Y è½´åè½¬ï¼Œç¬¬äºŒä¸ªå‚æ•°æœª 0 å€¼è¡¨ç¤º true ï¼Œä¸‹åŒ</span></span><br><span class="line">gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, <span class="number">1</span>);</span><br><span class="line"><span class="comment">// å¯¹å›¾åƒçš„ RGB æ¯ä¸ªåˆ†é‡éƒ½ä¹˜ä»¥ A</span></span><br><span class="line">gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, <span class="number">1</span>);</span><br></pre></td></tr></table></figure>

<h3 id="åˆ›å»ºçº¹ç†å¯¹è±¡"><a href="#åˆ›å»ºçº¹ç†å¯¹è±¡" class="headerlink" title="åˆ›å»ºçº¹ç†å¯¹è±¡"></a>åˆ›å»ºçº¹ç†å¯¹è±¡</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> texture = gl.createTexture();</span><br></pre></td></tr></table></figure>

<h3 id="æ¿€æ´»å¹¶ç»‘å®šçº¹ç†å•å…ƒ"><a href="#æ¿€æ´»å¹¶ç»‘å®šçº¹ç†å•å…ƒ" class="headerlink" title="æ¿€æ´»å¹¶ç»‘å®šçº¹ç†å•å…ƒ"></a>æ¿€æ´»å¹¶ç»‘å®šçº¹ç†å•å…ƒ</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// é»˜è®¤ç»‘å®šåˆ° 0 å·å•å…ƒï¼Œå¦‚æœåªæœ‰ä¸€å¼ çº¹ç†ï¼Œæ— éœ€è¿›è¡Œ activeTexture</span></span><br><span class="line">gl.activeTexture(gl.TEXTURE0);</span><br><span class="line">gl.bindTexture(gl.TEXTURE_2D, texture);</span><br></pre></td></tr></table></figure>
<p><code>gl.TEXTURE_2D</code> è¡¨ç¤ºäºŒç»´çº¹ç†ï¼Œ<code>gl.TEXTURE_CUBE_MAP</code> ä¸ºç«‹æ–¹ä½“çº¹ç†ï¼Œåé¢ä¼šæåˆ°</p>
<h3 id="é…ç½®çº¹ç†å¯¹è±¡å‚æ•°"><a href="#é…ç½®çº¹ç†å¯¹è±¡å‚æ•°" class="headerlink" title="é…ç½®çº¹ç†å¯¹è±¡å‚æ•°"></a>é…ç½®çº¹ç†å¯¹è±¡å‚æ•°</h3><p>åˆ©ç”¨ texParameter è®¾ç½®çº¹ç†å›¾åƒæ˜ å°„åˆ°å›¾å½¢ä¸Šçš„å…·ä½“æ–¹å¼ï¼ŒåŒ…æ‹¬æ”¾å¤§ã€ç¼©å°ã€æ°´å¹³å¡«å……ã€å‚ç›´å¡«å……</p>
<p>å…·ä½“ç”¨æ³•è¯¦è§ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/WebGLRenderingContext/texParameter" target="_blank" rel="noopener">texParameter</a></p>
<p>ä¸¾ä¾‹</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ä½¿ç”¨ LINEAR ç¼©å°çº¹ç†å›¾åƒ</span></span><br><span class="line">gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);</span><br></pre></td></tr></table></figure>

<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœçº¹ç†å®½é«˜æœ‰ä¸€ä¸ªé 2 çš„å¹‚ï¼Œåˆ™æ˜¾ç¤ºçº¹ç†å¤±è´¥ï¼Œé€šå¸¸è¿›è¡Œä»¥ä¸‹å¤„ç†</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ£€æŸ¥æ¯ä¸ªç»´åº¦æ˜¯å¦æ˜¯ 2 çš„å¹‚</span></span><br><span class="line"><span class="keyword">if</span> (isPowerOf2(image.width) &amp;&amp; isPowerOf2(image.height)) &#123;</span><br><span class="line">  <span class="comment">// æ˜¯ 2 çš„å¹‚ï¼Œä¸€èˆ¬ç”¨è´´å›¾</span></span><br><span class="line">  gl.generateMipmap(gl.TEXTURE_2D);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="comment">// ä¸æ˜¯ 2 çš„å¹‚ï¼Œå…³é—­è´´å›¾å¹¶è®¾ç½®åŒ…è£¹æ¨¡å¼ï¼ˆä¸éœ€è¦é‡å¤ï¼‰ä¸ºåˆ°è¾¹ç¼˜</span></span><br><span class="line">  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);</span><br><span class="line">  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);</span><br><span class="line">  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="é…ç½®çº¹ç†å›¾åƒ"><a href="#é…ç½®çº¹ç†å›¾åƒ" class="headerlink" title="é…ç½®çº¹ç†å›¾åƒ"></a>é…ç½®çº¹ç†å›¾åƒ</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">gl.texImage2D(gl.TEXTURE_2D, <span class="number">0</span>, gl.RGB, gl.RGB, gl.UNSIGNED_BYTE, image);</span><br></pre></td></tr></table></figure>

<p>æ›´å¤šç”¨æ³•è¯¦è§ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/WebGLRenderingContext/texImage2D" target="_blank" rel="noopener">WebGLRenderingContext.texImage2D()</a></p>
<h3 id="å°†çº¹ç†å•å…ƒä¼ é€’ç»™ç‰‡æ®µç€è‰²å™¨"><a href="#å°†çº¹ç†å•å…ƒä¼ é€’ç»™ç‰‡æ®µç€è‰²å™¨" class="headerlink" title="å°†çº¹ç†å•å…ƒä¼ é€’ç»™ç‰‡æ®µç€è‰²å™¨"></a>å°†çº¹ç†å•å…ƒä¼ é€’ç»™ç‰‡æ®µç€è‰²å™¨</h3><p>è·å–å–æ ·å™¨ç´¢å¼•ï¼Œå–æ ·å™¨ç”¨äºä»çº¹ç†å›¾åƒä¸­è·å–çº¹ç´ ï¼ˆè¯¥æ­¥éª¤ä¹Ÿå¯ä»¥åœ¨åˆå§‹åŒ–æ—¶è¿›è¡Œï¼‰</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> u_Sampler = gl.getUniformLocation(program, <span class="string">'u_Sampler'</span>);</span><br></pre></td></tr></table></figure>
<p>ä¸ºå–æ ·å™¨æŒ‡å®šçº¹ç†å•å…ƒ(gl.TEXTUREn)ç¼–å·ï¼ŒGL æœ€å¤šå¯åŒæ—¶æ³¨å†Œ 32 å¼ çº¹ç†</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æœªæŒ‡å®š u_Sampler çš„å€¼æ—¶é»˜è®¤è®¾ç½®ä¸º 0</span></span><br><span class="line"><span class="comment">// å› æ­¤å•å¼ çº¹ç†ä¹Ÿå¯ä»¥ä¸è¿›è¡Œ u_Sampler çš„èµ‹å€¼</span></span><br><span class="line">gl.uniform1i(u_Sampler, <span class="number">0</span>);</span><br></pre></td></tr></table></figure>

<h2 id="4-ç€è‰²å™¨å¤„ç†"><a href="#4-ç€è‰²å™¨å¤„ç†" class="headerlink" title="4. ç€è‰²å™¨å¤„ç†"></a>4. ç€è‰²å™¨å¤„ç†</h2><p>æ‰§è¡Œç»˜åˆ¶æ—¶ï¼Œç€è‰²å™¨çš„è¿è¡Œè¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<p>é¦–å…ˆæ˜¯é¡¶ç‚¹ç€è‰²å™¨å‘ç‰‡æ®µç€è‰²å™¨ä¼ è¾“çº¹ç†åæ ‡ï¼Œè¯¥çº¹ç†åæ ‡æ˜¯å¯å˜é‡ï¼Œåœ¨ç‰‡æ®µç€è‰²å™¨ä¸­ä¼šè¿›è¡Œæ’å€¼</p>
<p>ç„¶ååœ¨ç‰‡æ®µç€è‰²å™¨ä¸­è·å–çº¹ç´ ï¼Œå¹¶å°†å…¶é¢œè‰²èµ‹äºˆç‰‡å…ƒ</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> VSHADER_SOURCE = <span class="string">`</span></span><br><span class="line"><span class="string">  attribute vec4 a_Position;</span></span><br><span class="line"><span class="string">  attribute vec2 a_TexCoord;</span></span><br><span class="line"><span class="string">  varying vec2 v_TexCoord;</span></span><br><span class="line"><span class="string">  void main() &#123;</span></span><br><span class="line"><span class="string">    gl_Position = a_Position;</span></span><br><span class="line"><span class="string">    v_TexCoord = a_TexCoord;</span></span><br><span class="line"><span class="string">  &#125;`</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Fragment shader program</span></span><br><span class="line"><span class="keyword">var</span> FSHADER_SOURCE = <span class="string">`</span></span><br><span class="line"><span class="string">  precision mediump float;</span></span><br><span class="line"><span class="string">  uniform sampler2D u_Sampler;</span></span><br><span class="line"><span class="string">  // çº¹ç†åæ ‡æ’å€¼</span></span><br><span class="line"><span class="string">  varying vec2 v_TexCoord;</span></span><br><span class="line"><span class="string">  void main() &#123;</span></span><br><span class="line"><span class="string">    // è·å–çº¹ç´ </span></span><br><span class="line"><span class="string">    gl_FragColor = texture2D(u_Sampler, v_TexCoord);</span></span><br><span class="line"><span class="string">  &#125;`</span></span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­é‡‡ç”¨äº† GLSL ES å†…ç½®å‡½æ•° texture2D æ¥æŠ½å–çº¹ç´ </p>
<h2 id="å®ä¾‹"><a href="#å®ä¾‹" class="headerlink" title="å®ä¾‹"></a>å®ä¾‹</h2><p>ç»˜åˆ¶ä¸€ä¸ª 400x400 çš„æ­£æ–¹å½¢ï¼Œå¹¶å°† 240x180 çš„å›¾åƒä½œä¸ºçº¹ç†æ¸²æŸ“åœ¨ä¸Šé¢ï¼Œé‡‡ç”¨åŒ…è£¹æ¨¡å¼</p>
<p>å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">HTML</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">canvas</span> <span class="attr">id</span>=<span class="string">"canvas"</span> <span class="attr">width</span>=<span class="string">"400"</span> <span class="attr">height</span>=<span class="string">"400"</span>&gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="actionscript">    <span class="comment">// å·¥å…·æ–¹æ³•</span></span></span><br><span class="line"><span class="actionscript">    <span class="function"><span class="keyword">function</span> <span class="title">isPowerOf2</span><span class="params">(value)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">      <span class="keyword">return</span> (value &amp; (value - <span class="number">1</span>)) === <span class="number">0</span>;</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="actionscript">    <span class="function"><span class="keyword">function</span> <span class="title">createShader</span><span class="params">(gl, type, source)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">      <span class="keyword">var</span> shader = gl.createShader(type); <span class="comment">// åˆ›å»ºç€è‰²å™¨å¯¹è±¡</span></span></span><br><span class="line"><span class="actionscript">      gl.shaderSource(shader, source); <span class="comment">// æä¾›æ•°æ®æº</span></span></span><br><span class="line"><span class="actionscript">      gl.compileShader(shader); <span class="comment">// ç¼–è¯‘ -&gt; ç”Ÿæˆç€è‰²å™¨</span></span></span><br><span class="line"><span class="actionscript">      <span class="keyword">var</span> success = gl.getShaderParameter(shader, gl.COMPILE_STATUS);</span></span><br><span class="line">      if (success) &#123;</span><br><span class="line"><span class="actionscript">        <span class="keyword">return</span> shader;</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(gl.getShaderInfoLog(shader));</span></span><br><span class="line">      gl.deleteShader(shader);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="actionscript">    <span class="comment">// åˆ›å»ºç€è‰²å™¨ç¨‹åº</span></span></span><br><span class="line"><span class="actionscript">    <span class="function"><span class="keyword">function</span> <span class="title">createProgramFromSources</span><span class="params">(gl, vertexShader, fragmentShader)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">      <span class="keyword">var</span> program = gl.createProgram();</span></span><br><span class="line">      gl.attachShader(program, vertexShader);</span><br><span class="line">      gl.attachShader(program, fragmentShader);</span><br><span class="line">      gl.linkProgram(program);</span><br><span class="line"><span class="actionscript">      <span class="keyword">var</span> success = gl.getProgramParameter(program, gl.LINK_STATUS);</span></span><br><span class="line">      if (success) &#123;</span><br><span class="line"><span class="actionscript">        <span class="keyword">return</span> program;</span></span><br><span class="line">      &#125;</span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(gl.getProgramInfoLog(program));</span></span><br><span class="line">      gl.deleteProgram(program);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="actionscript">    <span class="comment">// åˆå§‹åŒ–é¡¶ç‚¹å’Œçº¹ç†æ•°æ®ï¼Œå¹¶ç»‘å®š buffer</span></span></span><br><span class="line"><span class="actionscript">    <span class="function"><span class="keyword">function</span> <span class="title">initVertexBuffers</span><span class="params">(gl, program)</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">var</span> verticesTexCoords = <span class="keyword">new</span> <span class="built_in">Float32Array</span>([</span></span><br><span class="line"><span class="actionscript">        <span class="comment">// é¡¶ç‚¹åæ ‡, çº¹ç†åæ ‡</span></span></span><br><span class="line">        -1.0, 1.0, 0.0, 1.0,</span><br><span class="line">        -1.0, -1.0, 0.0, 0.0,</span><br><span class="line">        1.0, 1.0, 1.0, 1.0,</span><br><span class="line">        1.0, -1.0, 1.0, 0.0,</span><br><span class="line">      ]);</span><br><span class="line"><span class="actionscript">      <span class="keyword">var</span> n = <span class="number">4</span>; <span class="comment">// The number of vertices</span></span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">      <span class="comment">// ä¸º WebGL æŒ‡å®šç€è‰²ç¨‹åº</span></span></span><br><span class="line">      gl.useProgram(program);</span><br><span class="line"></span><br><span class="line"><span class="actionscript">      <span class="comment">// Create the buffer object</span></span></span><br><span class="line"><span class="actionscript">      <span class="keyword">var</span> vertexTexCoordBuffer = gl.createBuffer();</span></span><br><span class="line">      if (!vertexTexCoordBuffer) &#123;</span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(<span class="string">'Failed to create the buffer object'</span>);</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">return</span> <span class="number">-1</span>;</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      gl.bindBuffer(gl.ARRAY_BUFFER, vertexTexCoordBuffer);</span><br><span class="line">      gl.bufferData(gl.ARRAY_BUFFER, verticesTexCoords, gl.STATIC_DRAW);</span><br><span class="line"></span><br><span class="line"><span class="actionscript">      <span class="keyword">var</span> FSIZE = verticesTexCoords.BYTES_PER_ELEMENT;</span></span><br><span class="line"><span class="actionscript">      <span class="keyword">var</span> a_Position = gl.getAttribLocation(program, <span class="string">'a_Position'</span>);</span></span><br><span class="line">      if (a_Position &lt; 0) &#123;</span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(<span class="string">'Failed to get the storage location of a_Position'</span>);</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">return</span> <span class="number">-1</span>;</span></span><br><span class="line">      &#125;</span><br><span class="line"><span class="actionscript">      gl.vertexAttribPointer(a_Position, <span class="number">2</span>, gl.FLOAT, <span class="literal">false</span>, FSIZE * <span class="number">4</span>, <span class="number">0</span>);</span></span><br><span class="line">      gl.enableVertexAttribArray(a_Position);</span><br><span class="line"></span><br><span class="line"><span class="actionscript">      <span class="keyword">var</span> a_TexCoord = gl.getAttribLocation(program, <span class="string">'a_TexCoord'</span>);</span></span><br><span class="line">      if (a_TexCoord &lt; 0) &#123;</span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(<span class="string">'Failed to get the storage location of a_TexCoord'</span>);</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">return</span> <span class="number">-1</span>;</span></span><br><span class="line">      &#125;</span><br><span class="line"><span class="actionscript">      gl.vertexAttribPointer(a_TexCoord, <span class="number">2</span>, gl.FLOAT, <span class="literal">false</span>, FSIZE * <span class="number">4</span>, FSIZE * <span class="number">2</span>);</span></span><br><span class="line">      gl.enableVertexAttribArray(a_TexCoord);</span><br><span class="line"><span class="actionscript">      <span class="keyword">return</span> n;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="actionscript">    <span class="comment">// åˆå§‹åŒ–çº¹ç†ï¼ŒåŠ è½½å›¾åƒ</span></span></span><br><span class="line"><span class="actionscript">    <span class="function"><span class="keyword">function</span> <span class="title">initTextures</span><span class="params">(gl, program, url, callback)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">      <span class="keyword">var</span> texture = gl.createTexture();   <span class="comment">// Create a texture object</span></span></span><br><span class="line">      if (!texture) &#123;</span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(<span class="string">'Failed to create the texture object'</span>);</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">return</span> <span class="literal">false</span>;</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"><span class="actionscript">      <span class="comment">// Get the storage location of u_Sampler</span></span></span><br><span class="line"><span class="actionscript">      <span class="keyword">var</span> u_Sampler = gl.getUniformLocation(program, <span class="string">'u_Sampler'</span>);</span></span><br><span class="line">      if (!u_Sampler) &#123;</span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(<span class="string">'Failed to get the storage location of u_Sampler'</span>);</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">return</span> <span class="literal">false</span>;</span></span><br><span class="line">      &#125;</span><br><span class="line"><span class="javascript">      <span class="keyword">let</span> image = <span class="keyword">new</span> Image();</span></span><br><span class="line"><span class="actionscript">      image.crossOrigin = <span class="string">"Anonymous"</span></span></span><br><span class="line">      image.src = url;</span><br><span class="line"><span class="javascript">      image.onload = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span></span><br><span class="line">        callback(image, texture, u_Sampler)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="actionscript">    <span class="comment">// é…ç½®å¹¶ä½¿ç”¨çº¹ç†</span></span></span><br><span class="line"><span class="actionscript">    <span class="function"><span class="keyword">function</span> <span class="title">loadTexture</span><span class="params">(gl, image, texture, u_Sampler, n)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">      gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, <span class="number">1</span>); <span class="comment">// Flip the image's y axis</span></span></span><br><span class="line">      gl.activeTexture(gl.TEXTURE0);</span><br><span class="line">      gl.bindTexture(gl.TEXTURE_2D, texture);</span><br><span class="line"></span><br><span class="line">      if (isPowerOf2(image.width) &amp;&amp; isPowerOf2(image.height)) &#123;</span><br><span class="line"><span class="actionscript">        <span class="comment">// æ˜¯ 2 çš„å¹‚ï¼Œä¸€èˆ¬ç”¨è´´å›¾</span></span></span><br><span class="line">        gl.generateMipmap(gl.TEXTURE_2D);</span><br><span class="line"><span class="actionscript">      &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="actionscript">        <span class="comment">// ä¸æ˜¯ 2 çš„å¹‚ï¼Œå…³é—­è´´å›¾å¹¶è®¾ç½®åŒ…è£¹æ¨¡å¼ï¼ˆä¸éœ€è¦é‡å¤ï¼‰ä¸ºåˆ°è¾¹ç¼˜</span></span></span><br><span class="line">        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);</span><br><span class="line">        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);</span><br><span class="line">        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);</span><br><span class="line">      &#125;</span><br><span class="line"><span class="actionscript">      <span class="comment">// Set the texture image</span></span></span><br><span class="line">      gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGB, gl.RGB, gl.UNSIGNED_BYTE, image);</span><br><span class="line"></span><br><span class="line"><span class="actionscript">      <span class="comment">// Set the texture unit 0 to the sampler</span></span></span><br><span class="line">      gl.uniform1i(u_Sampler, 0);</span><br><span class="line"></span><br><span class="line"><span class="actionscript">      gl.clear(gl.COLOR_BUFFER_BIT);   <span class="comment">// Clear &lt;canvas&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">      gl.drawArrays(gl.TRIANGLE_STRIP, <span class="number">0</span>, n); <span class="comment">// Draw the rectangle</span></span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="actionscript">    <span class="function"><span class="keyword">function</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">      <span class="comment">// Get A WebGL context</span></span></span><br><span class="line"><span class="actionscript">      <span class="comment">/** @type &#123;HTMLCanvasElement&#125; */</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">var</span> canvas = <span class="built_in">document</span>.getElementById(<span class="string">"canvas"</span>);</span></span><br><span class="line"><span class="actionscript">      <span class="keyword">var</span> gl = canvas.getContext(<span class="string">"webgl"</span>);</span></span><br><span class="line">      if (!gl) &#123;</span><br><span class="line"><span class="actionscript">        <span class="keyword">return</span>;</span></span><br><span class="line">      &#125;</span><br><span class="line"><span class="actionscript">      <span class="keyword">const</span> VSHADER_SOURCE = `</span></span><br><span class="line">        attribute vec4 a_Position;</span><br><span class="line">        attribute vec2 a_TexCoord;</span><br><span class="line">        varying vec2 v_TexCoord;</span><br><span class="line"><span class="actionscript">        <span class="keyword">void</span> main() &#123;</span></span><br><span class="line">          gl_Position = a_Position;</span><br><span class="line">          v_TexCoord = a_TexCoord;</span><br><span class="line">        &#125;`</span><br><span class="line"></span><br><span class="line"><span class="actionscript">      <span class="comment">// Fragment shader program</span></span></span><br><span class="line"><span class="actionscript">      <span class="keyword">const</span> FSHADER_SOURCE = `</span></span><br><span class="line">        precision mediump float;</span><br><span class="line">        uniform sampler2D u_Sampler;</span><br><span class="line"><span class="actionscript">        <span class="comment">// çº¹ç†åæ ‡æ’å€¼</span></span></span><br><span class="line">        varying vec2 v_TexCoord;</span><br><span class="line"><span class="actionscript">        <span class="keyword">void</span> main() &#123;</span></span><br><span class="line"><span class="actionscript">          <span class="comment">// è·å–çº¹ç´ </span></span></span><br><span class="line">          gl_FragColor = texture2D(u_Sampler, v_TexCoord);</span><br><span class="line">        &#125;`</span><br><span class="line"><span class="actionscript">      <span class="keyword">var</span> vertexShader = createShader(gl, gl.VERTEX_SHADER, VSHADER_SOURCE);</span></span><br><span class="line"><span class="actionscript">      <span class="keyword">var</span> fragmentShader = createShader(gl, gl.FRAGMENT_SHADER, FSHADER_SOURCE);</span></span><br><span class="line"><span class="actionscript">      <span class="keyword">var</span> program = createProgramFromSources(gl, vertexShader, fragmentShader)</span></span><br><span class="line">      if (!program) &#123;</span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(<span class="string">'Failed to intialize shaders.'</span>);</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">return</span>;</span></span><br><span class="line">      &#125;</span><br><span class="line"><span class="actionscript">      <span class="keyword">var</span> n = initVertexBuffers(gl, program);</span></span><br><span class="line">      if (n &lt; 0) &#123;</span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(<span class="string">'Failed to set the vertex information'</span>);</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">return</span>;</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      gl.clearColor(0.0, 0.0, 0.0, 1.0);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="actionscript">      initTextures(gl, program, <span class="string">"https://webglfundamentals.org/webgl/resources/leaves.jpg"</span>, (image, texture, u_Sampler) =&gt; &#123;</span></span><br><span class="line"><span class="actionscript">        <span class="comment">// å¯¹ image è¿›è¡Œä¸‹ä¸€æ­¥å¤„ç†</span></span></span><br><span class="line">        loadTexture(gl, image, texture, u_Sampler, n)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    main();</span><br><span class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æ•ˆæœä»¥åŠåŸå›¾</p>
<p><img src="https://upload-images.jianshu.io/upload_images/9277731-79378db006dfc180.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="leaves-canvas.jpg"></p>
<p><img src="https://upload-images.jianshu.io/upload_images/9277731-44fac941dee56f32.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="leaves.jpg"></p>
<h1 id="åŠ è½½å¤šä¸ªçº¹ç†"><a href="#åŠ è½½å¤šä¸ªçº¹ç†" class="headerlink" title="åŠ è½½å¤šä¸ªçº¹ç†"></a>åŠ è½½å¤šä¸ªçº¹ç†</h1><p>æœ‰äº›åœºæ™¯éœ€è¦åŠ è½½å¤šä¸ªçº¹ç†ï¼Œå¹¶å…±åŒä½œç”¨äºåŒä¸€ä¸ªç‰‡å…ƒ</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">precision mediump <span class="keyword">float</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// our textures</span></span><br><span class="line">uniform sampler2D u_image0;</span><br><span class="line">uniform sampler2D u_image1;</span><br><span class="line"></span><br><span class="line"><span class="comment">// the texCoords passed in from the vertex shader.</span></span><br><span class="line">varying vec2 v_texCoord;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   vec4 color0 = texture2D(u_image0, v_texCoord);</span><br><span class="line">   vec4 color1 = texture2D(u_image1, v_texCoord);</span><br><span class="line">   gl_FragColor = color0 * color1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å’Œå¤„ç†å•ä¸ªçº¹ç†ç±»ä¼¼ï¼Œæˆ‘ä»¬éœ€è¦ä¸ºæ¯ä¸ªçº¹ç†å•å…ƒè¿›è¡Œé…ç½®ï¼Œè®¾ç½®çº¹ç†å•å…ƒå¯¹åº”çš„çº¹ç†</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è®¾ç½®æ¯ä¸ªçº¹ç†å•å…ƒå¯¹åº”ä¸€ä¸ªçº¹ç†</span></span><br><span class="line">gl.activeTexture(gl.TEXTURE0);</span><br><span class="line">gl.bindTexture(gl.TEXTURE_2D, textures[<span class="number">0</span>]);</span><br><span class="line">gl.activeTexture(gl.TEXTURE1);</span><br><span class="line">gl.bindTexture(gl.TEXTURE_2D, textures[<span class="number">1</span>]);</span><br></pre></td></tr></table></figure>

<p>é™äºç¯‡å¹…ï¼Œè¯¦ç»†ä¾‹å­å¯ä»¥å‚è€ƒ <a href="https://webglfundamentals.org/webgl/lessons/zh_cn/webgl-2-textures.html" target="_blank" rel="noopener">WebGL ä½¿ç”¨å¤šä¸ªçº¹ç†</a></p>
<h1 id="åˆ†æ¬¡ç»˜åˆ¶"><a href="#åˆ†æ¬¡ç»˜åˆ¶" class="headerlink" title="åˆ†æ¬¡ç»˜åˆ¶"></a>åˆ†æ¬¡ç»˜åˆ¶</h1><p>çº¹ç†èµ„æºé€šå¸¸ä¸ºç½‘ç»œèµ„æºï¼Œå¦‚æœéœ€è¦ç­‰æ‰€æœ‰çº¹ç†éƒ½åŠ è½½å®Œæ¯•æ‰å¼€å§‹ç»˜åˆ¶ï¼Œç”¨æˆ·éœ€è¦ç­‰å¾…éå¸¸ä¹…çš„æ—¶é—´æ‰èƒ½çœ‹åˆ°æ¸²æŸ“çš„æ¨¡å‹ï¼Œæœ‰æ—¶å€™åˆ†æ¬¡ç»˜åˆ¶æ˜¯ä¸€ä¸ªæ›´å¥½çš„é€‰æ‹©</p>
<p>å®ç°çš„æ–¹å¼ä¹Ÿå¾ˆç®€å•ï¼Œæˆ‘ä»¬å¢åŠ ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œé€šè¿‡çº¹ç†åŠ è½½çŠ¶æ€ç¡®å®šæ˜¯å¦ç»˜åˆ¶çº¹ç†</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> FSHADER_SOURCE = <span class="string">`</span></span><br><span class="line"><span class="string">  precision mediump float;</span></span><br><span class="line"><span class="string">  uniform bool textureLoaded;</span></span><br><span class="line"><span class="string">  uniform sampler2D u_Sampler;</span></span><br><span class="line"><span class="string">  // çº¹ç†åæ ‡æ’å€¼</span></span><br><span class="line"><span class="string">  varying vec2 v_TexCoord;</span></span><br><span class="line"><span class="string">  void main() &#123;</span></span><br><span class="line"><span class="string">    if(textureLoaded)&#123;</span></span><br><span class="line"><span class="string">      // è·å–çº¹ç´ </span></span><br><span class="line"><span class="string">      gl_FragColor = texture2D(u_Sampler, v_TexCoord);</span></span><br><span class="line"><span class="string">    &#125; else &#123;</span></span><br><span class="line"><span class="string">      // ä½¿ç”¨é»˜è®¤é¢œè‰²ï¼Œè¿™é‡Œä¹Ÿå¯ä»¥ä½¿ç”¨é¢œè‰²å¯å˜é‡</span></span><br><span class="line"><span class="string">      gl_FragColor = vec4(1, 0, 0.5, 1);</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;`</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">render</span>(<span class="params">gl, program, state, n</span>) </span>&#123;</span><br><span class="line">  gl.uniform1i(gl.getUniformLocation(program, <span class="string">'textureLoaded'</span>), state)</span><br><span class="line">  gl.clear(gl.COLOR_BUFFER_BIT);   <span class="comment">// Clear &lt;canvas&gt;</span></span><br><span class="line">  gl.drawArrays(gl.TRIANGLE_STRIP, <span class="number">0</span>, n); <span class="comment">// Draw the rectangle</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆå§‹æ‰§è¡Œ</span></span><br><span class="line">render(gl, program, <span class="literal">false</span>, n)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å›¾ç‰‡åŠ è½½å®Œå†æ¬¡æ‰§è¡Œ</span></span><br><span class="line">render(gl, program, <span class="literal">true</span>, n)</span><br></pre></td></tr></table></figure>

<p>ä¸è¿‡è¿™ç§æ–¹æ³•æ§åˆ¶å°ä¸€å¼€å§‹ä¼šè¾“å‡ºè­¦å‘Š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">RENDER WARNING: there is no texture bound to the unit 0</span><br></pre></td></tr></table></figure>

<p>ä¸çŸ¥é“è¿˜æœ‰å…¶ä»–æ–¹å¼æ²¡ï¼Œæ¬¢è¿æ¢è®¨~</p>
<h1 id="ç«‹æ–¹ä½“çº¹ç†-gl-TEXTURE-CUBE-MAP"><a href="#ç«‹æ–¹ä½“çº¹ç†-gl-TEXTURE-CUBE-MAP" class="headerlink" title="ç«‹æ–¹ä½“çº¹ç†(gl.TEXTURE_CUBE_MAP)"></a>ç«‹æ–¹ä½“çº¹ç†(gl.TEXTURE_CUBE_MAP)</h1><p>ç«‹æ–¹ä½“çº¹ç†å¹¶ä¸æ˜¯è¯´å•ä¸€çº¹ç†å›¾åƒæ˜¯ç«‹ä½“çš„ï¼ˆæƒ³æƒ³ä¹ŸçŸ¥é“ä¸æ˜¯ï¼Œå›¾åƒåªèƒ½æ˜¯äºŒç»´çš„ï¼‰ï¼Œè€Œæ˜¯è¯´å°†å¤šä¸ªé¢çš„çº¹ç†å…±åŒç»„æˆä¸€ä¸ªç«‹æ–¹ä½“</p>
<p>ç‰‡æ®µç€è‰²å™¨é€šè¿‡æ³•å‘é‡å»è·å–çº¹ç´ </p>
<p>é¦–å…ˆä¸ºç«‹æ–¹ä½“çš„æ¯ä¸ªé¢é…ç½®çº¹ç†å›¾åƒ</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">gl.texImage2D(target, level, internalFormat, format, type, img[i]);</span><br><span class="line"><span class="comment">// target çš„å–å€¼æœ‰</span></span><br><span class="line">gl.TEXTURE_CUBE_MAP_POSITIVE_X</span><br><span class="line">gl.TEXTURE_CUBE_MAP_NEGATIVE_X</span><br><span class="line">gl.TEXTURE_CUBE_MAP_POSITIVE_Y</span><br><span class="line">gl.TEXTURE_CUBE_MAP_NEGATIVE_Y</span><br><span class="line">gl.TEXTURE_CUBE_MAP_POSITIVE_Z</span><br><span class="line">gl.TEXTURE_CUBE_MAP_NEGATIVE_Z</span><br></pre></td></tr></table></figure>


<p>ç‰‡æ®µç€è‰²å™¨ä¸­ï¼Œæ ¹æ®æ¯ä¸ªç‰‡å…ƒå¯¹åº”çš„æ³•å‘é‡ï¼ˆå¯å˜é‡ï¼‰ç¡®å®šåº”è¯¥ä½¿ç”¨çš„é¢</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">gl_FragColor = textureCube(u_texture, normalize(v_normal));</span><br></pre></td></tr></table></figure>

<p>å†…éƒ¨é€šè¿‡ç‰‡å…ƒåƒç´ åæ ‡è‡ªå·±å»ç¡®å®šçº¹ç†å›¾åƒçš„çº¹ç´ </p>
<p>å¸¸ç”¨æ¥åš <a href="https://webglfundamentals.org/webgl/lessons/zh_cn/webgl-environment-maps.html" target="_blank" rel="noopener">ç¯å¢ƒè´´å›¾</a></p>
<p>æœ¬æ–‡ä¸åšæ‹“å±•ï¼Œæ›´å¤šä¿¡æ¯è¯·å‚è€ƒ <a href="https://webglfundamentals.org/webgl/lessons/zh_cn/webgl-cube-maps.html" target="_blank" rel="noopener">WebGL ç«‹æ–¹ä½“è´´å›¾</a></p>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>æœ¬æ–‡æ¢è®¨äº†ç»˜åˆ¶çº¹ç†çš„åŸºæœ¬æµç¨‹ï¼Œå¹¶ç®€å•æåŠå¤šçº¹ç†çš„å¤„ç†ä»¥åŠç«‹æ–¹ä½“çº¹ç†çš„æ¦‚å¿µï¼Œæœ€åç»™å‡ºäº†ä¸€äº›ä¾‹å­çš„é“¾æ¥ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥ç‚¹å‡»æŸ¥çœ‹</p>
]]></content>
      <categories>
        <category>å¤§å‰ç«¯</category>
      </categories>
      <tags>
        <tag>WebGL</tag>
      </tags>
  </entry>
  <entry>
    <title>WebGL å…‰ç…§</title>
    <url>/2020/03/17/WebGL/WebGL%20%E5%85%89%E7%85%A7/</url>
    <content><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>æœ¬æ–‡æ¥è°ˆè°ˆ WebGL çš„å…‰ç…§</p>
<a id="more"></a>

<h1 id="å…‰æºç±»å‹"><a href="#å…‰æºç±»å‹" class="headerlink" title="å…‰æºç±»å‹"></a>å…‰æºç±»å‹</h1><p>ä¸»è¦åˆ†ä¸ºä»¥ä¸‹å‡ ç§ï¼š</p>
<ul>
<li><p>å¹³è¡Œå…‰</p>
<p>ä¹Ÿå«æ–¹å‘å…‰ã€‚<br>æ— é™è¿œå¤„ï¼ˆæ¯”å¦‚å¤ªé˜³ï¼‰å‘å‡ºçš„å¹³è¡Œå…‰ã€‚<br>ç”¨ä¸€ä¸ªæ–¹å‘å’Œä¸€ä¸ªé¢œè‰²ï¼ˆåŒ…å«å…‰ç…§å¼ºåº¦ï¼Œä¸‹åŒï¼‰æ¥å®šä¹‰</p>
</li>
<li><p>ç‚¹å…‰æº</p>
<p>ä¸€ä¸ªç‚¹å‘å‘¨å›´æ‰€æœ‰æ–¹å‘å‘å‡ºçš„å…‰ï¼Œæ¯”å¦‚ç¯æ³¡ã€‚<br>éœ€è¦æŒ‡å®šå…‰æºçš„ä½ç½®å’Œé¢œè‰²</p>
</li>
<li><p>ç¯å¢ƒå…‰</p>
<p>åˆç§°é—´æ¥å…‰ï¼Œåªå‰ä¸¤ç§ç±»å‹çš„å…‰æºå‘å‡ºåç»è¿‡å¢™å£ç­‰å…¶ä»–ç‰©ä½“åå°„åçš„å…‰ã€‚<br>å¯ä»¥ç†è§£ä¸ºç™½å¤©çš„å®¤å†…ï¼Œå¹¶æ²¡æœ‰æ„ŸçŸ¥å¤ªé˜³å…‰çº¿ç›´å°„ï¼Œä½†ä»çœ‹å¾—æ¸…ç‰©ä½“ã€‚<br>ç¯å¢ƒå…‰ç”±å„ä¸ªè§’åº¦ç…§å°„ç‰©ä½“ï¼Œå…‰ç…§å¼ºåº¦éƒ½æ˜¯ä¸€è‡´çš„ã€‚<br>åªéœ€æŒ‡å®šé¢œè‰²ã€‚</p>
</li>
<li><p>èšç¯å…‰</p>
<p>åœ¨ç‚¹å…‰æºçš„åŸºç¡€ä¸Šï¼Œé™å®šäº†ç…§å°„æ–¹å‘å’Œç…§å°„èŒƒå›´</p>
</li>
</ul>
<h1 id="åå°„ç±»å‹"><a href="#åå°„ç±»å‹" class="headerlink" title="åå°„ç±»å‹"></a>åå°„ç±»å‹</h1><p>å…¥å°„å…‰çš„ä¿¡æ¯ï¼ˆæ–¹å‘ã€é¢œè‰²ï¼‰ä»¥åŠç‰©ä½“è¡¨é¢ä¿¡æ¯ï¼ˆç‰©ä½“åŸºåº•è‰²å’Œåå°„ç‰¹æ€§ï¼‰å†³å®šäº†åå°„å…‰çš„æ–¹å‘å’Œé¢œè‰²</p>
<blockquote>
<p>ä¸€èˆ¬æˆ‘ä»¬åªè®¡ç®—åå°„å…‰çš„é¢œè‰²å³å¯</p>
</blockquote>
<p>åå°„çš„æ–¹å¼ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§ï¼š</p>
<h2 id="æ¼«åå°„"><a href="#æ¼«åå°„" class="headerlink" title="æ¼«åå°„"></a>æ¼«åå°„</h2><p>å…‰çº¿ç…§å°„åœ¨ç‰©ä½“ç²—ç³™çš„è¡¨é¢ä¼šæ— åºåœ°å‘å››å‘¨åå°„çš„ç°è±¡ï¼Œæ˜¯è‡ªç„¶ç•Œæ›´åŠ æ™®éå­˜åœ¨çš„åå°„å‹æ€ã€‚</p>
<p>æ‰€ä»¥æ¼«åå°„åœ¨å„ä¸ªæ–¹å‘ä¸Šæ˜¯å‡åŒ€çš„ï¼Œä»»ä½•è§’åº¦çœ‹å¼ºåº¦å‡ç›¸ç­‰</p>
<p>å¯ä»¥å¾—åˆ°ä»¥ä¸‹å¼å­</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;æ¼«åå°„å…‰é¢œè‰²&gt; = <span class="xml"><span class="tag">&lt;<span class="name">å…¥å°„å…‰é¢œè‰²</span>&gt;</span> x <span class="tag">&lt;<span class="name">è¡¨é¢åŸºåº•è‰²</span>&gt;</span> x cosÎ¸</span></span><br><span class="line"></span><br><span class="line"><span class="xml">// Î¸ ä¸ºå…¥å°„å…‰ä¸è¡¨é¢å½¢æˆçš„å…¥å°„è§’ï¼Œåˆ©ç”¨å‘é‡ç‚¹ç§¯å…¬å¼ï¼Œæœ‰</span></span><br><span class="line"></span><br><span class="line"><span class="xml">cosÎ¸ = <span class="tag">&lt;<span class="name">å…¥å°„å…‰æ–¹å‘</span>&gt;</span> Â· <span class="tag">&lt;<span class="name">æ³•çº¿æ–¹å‘</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>æ³•å‘é‡å°±æ˜¯æè¿°é¢çš„æœå‘çš„å•ä½å‘é‡ï¼Œè€Œæ³•çº¿æ–¹å‘å°±æ˜¯æ³•å‘é‡çš„æ–¹å‘</p>
<p>å¦‚å›¾ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/9277731-3459f160e960d56b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æ³•çº¿æ–¹å‘"></p>
<p>å¯¹äºç«‹æ–¹ä½“æ¥è¯´ï¼Œæ¯ä¸ªé¡¶ç‚¹å¯¹åº”ä¸‰ä¸ªæ³•å‘é‡ï¼Œå°±åƒä¹‹å‰æ¯ä¸ªé¡¶ç‚¹å¯¹åº”ä¸‰ä¸ªé¢çš„é¢œè‰²ä¸€æ ·ã€‚</p>
<p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç”¨å››ä¸ªç‚¹ï¼ˆä½¿ç”¨ç´¢å¼•ï¼Œå¦åˆ™éœ€è¦6ä¸ªç‚¹ï¼‰æ¥ç¡®å®šä¸€ä¸ªé¢çš„æ³•å‘é‡ï¼ˆæ ¹æ®å³æ‰‹å®šåˆ™ï¼‰</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Create a cube</span></span><br><span class="line"><span class="comment">//    v6----- v5</span></span><br><span class="line"><span class="comment">//   /|      /|</span></span><br><span class="line"><span class="comment">//  v1------v0|</span></span><br><span class="line"><span class="comment">//  | |     | |</span></span><br><span class="line"><span class="comment">//  | |v7---|-|v4</span></span><br><span class="line"><span class="comment">//  |/      |/</span></span><br><span class="line"><span class="comment">//  v2------v3</span></span><br><span class="line"><span class="comment">// Coordinates</span></span><br><span class="line"><span class="keyword">var</span> vertices = <span class="keyword">new</span> <span class="built_in">Float32Array</span>([</span><br><span class="line">  <span class="number">1.0</span>, <span class="number">1.0</span>, <span class="number">1.0</span>, <span class="number">-1.0</span>, <span class="number">1.0</span>, <span class="number">1.0</span>, <span class="number">-1.0</span>, <span class="number">-1.0</span>, <span class="number">1.0</span>, <span class="number">1.0</span>, <span class="number">-1.0</span>, <span class="number">1.0</span>, <span class="comment">// v0-v1-v2-v3 front</span></span><br><span class="line">  <span class="number">1.0</span>, <span class="number">1.0</span>, <span class="number">1.0</span>, <span class="number">1.0</span>, <span class="number">-1.0</span>, <span class="number">1.0</span>, <span class="number">1.0</span>, <span class="number">-1.0</span>, <span class="number">-1.0</span>, <span class="number">1.0</span>, <span class="number">1.0</span>, <span class="number">-1.0</span>, <span class="comment">// v0-v3-v4-v5 right</span></span><br><span class="line">  <span class="number">1.0</span>, <span class="number">1.0</span>, <span class="number">1.0</span>, <span class="number">1.0</span>, <span class="number">1.0</span>, <span class="number">-1.0</span>, <span class="number">-1.0</span>, <span class="number">1.0</span>, <span class="number">-1.0</span>, <span class="number">-1.0</span>, <span class="number">1.0</span>, <span class="number">1.0</span>, <span class="comment">// v0-v5-v6-v1 up</span></span><br><span class="line">  <span class="number">-1.0</span>, <span class="number">1.0</span>, <span class="number">1.0</span>, <span class="number">-1.0</span>, <span class="number">1.0</span>, <span class="number">-1.0</span>, <span class="number">-1.0</span>, <span class="number">-1.0</span>, <span class="number">-1.0</span>, <span class="number">-1.0</span>, <span class="number">-1.0</span>, <span class="number">1.0</span>, <span class="comment">// v1-v6-v7-v2 left</span></span><br><span class="line">  <span class="number">-1.0</span>, <span class="number">-1.0</span>, <span class="number">-1.0</span>, <span class="number">1.0</span>, <span class="number">-1.0</span>, <span class="number">-1.0</span>, <span class="number">1.0</span>, <span class="number">-1.0</span>, <span class="number">1.0</span>, <span class="number">-1.0</span>, <span class="number">-1.0</span>, <span class="number">1.0</span>, <span class="comment">// v7-v4-v3-v2 down</span></span><br><span class="line">  <span class="number">1.0</span>, <span class="number">-1.0</span>, <span class="number">-1.0</span>, <span class="number">-1.0</span>, <span class="number">-1.0</span>, <span class="number">-1.0</span>, <span class="number">-1.0</span>, <span class="number">1.0</span>, <span class="number">-1.0</span>, <span class="number">1.0</span>, <span class="number">1.0</span>, <span class="number">-1.0</span>  <span class="comment">// v4-v7-v6-v5 back</span></span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Colors</span></span><br><span class="line"><span class="keyword">var</span> colors = <span class="keyword">new</span> <span class="built_in">Float32Array</span>([</span><br><span class="line">  <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>,     <span class="comment">// v0-v1-v2-v3 front</span></span><br><span class="line">  <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>,     <span class="comment">// v0-v3-v4-v5 right</span></span><br><span class="line">  <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>,     <span class="comment">// v0-v5-v6-v1 up</span></span><br><span class="line">  <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>,     <span class="comment">// v1-v6-v7-v2 left</span></span><br><span class="line">  <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>,     <span class="comment">// v7-v4-v3-v2 down</span></span><br><span class="line">  <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>ã€€    <span class="comment">// v4-v7-v6-v5 back</span></span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Normal</span></span><br><span class="line"><span class="keyword">var</span> normals = <span class="keyword">new</span> <span class="built_in">Float32Array</span>([</span><br><span class="line">  <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">1.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">1.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">1.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">1.0</span>,  <span class="comment">// v0-v1-v2-v3 front</span></span><br><span class="line">  <span class="number">1.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">1.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">1.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">1.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>,  <span class="comment">// v0-v3-v4-v5 right</span></span><br><span class="line">  <span class="number">0.0</span>, <span class="number">1.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">1.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">1.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">1.0</span>, <span class="number">0.0</span>,  <span class="comment">// v0-v5-v6-v1 up</span></span><br><span class="line">  <span class="number">-1.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">-1.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">-1.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">-1.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>,  <span class="comment">// v1-v6-v7-v2 left</span></span><br><span class="line">  <span class="number">0.0</span>, <span class="number">-1.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">-1.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">-1.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">-1.0</span>, <span class="number">0.0</span>,  <span class="comment">// v7-v4-v3-v2 down</span></span><br><span class="line">  <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">-1.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">-1.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">-1.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">-1.0</span>   <span class="comment">// v4-v7-v6-v5 back</span></span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Indices of the vertices</span></span><br><span class="line"><span class="keyword">var</span> indices = <span class="keyword">new</span> <span class="built_in">Uint8Array</span>([</span><br><span class="line">  <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">3</span>,    <span class="comment">// front</span></span><br><span class="line">  <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">7</span>,    <span class="comment">// right</span></span><br><span class="line">  <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">11</span>,    <span class="comment">// up</span></span><br><span class="line">  <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">12</span>, <span class="number">14</span>, <span class="number">15</span>,    <span class="comment">// left</span></span><br><span class="line">  <span class="number">16</span>, <span class="number">17</span>, <span class="number">18</span>, <span class="number">16</span>, <span class="number">18</span>, <span class="number">19</span>,    <span class="comment">// down</span></span><br><span class="line">  <span class="number">20</span>, <span class="number">21</span>, <span class="number">22</span>, <span class="number">20</span>, <span class="number">22</span>, <span class="number">23</span>     <span class="comment">// back</span></span><br><span class="line">]);</span><br></pre></td></tr></table></figure>

<p>é’ˆå¯¹å…¥å°„å…‰æ–¹å‘ï¼Œå¹³è¡Œå…‰çš„æ–¹å‘æ€»æ˜¯å›ºå®šçš„ï¼Œè€Œç‚¹å…‰æºåˆ™ä¸æ¯ä¸ªç‚¹çš„ä½ç½®æœ‰å…³ï¼Œæˆ‘ä»¬åˆ†å¼€è®¨è®º</p>
<ul>
<li>å¹³è¡Œå…‰é’ˆå¯¹é¡¶ç‚¹å¤„ç†</li>
<li>ç‚¹å…‰æºé’ˆå¯¹åƒç´ ç‚¹å¤„ç†</li>
</ul>
<p><strong>æ³¨æ„ï¼š</strong> </p>
<ol>
<li>æœ¬å°èŠ‚æš‚ä¸è€ƒè™‘æ¨¡å‹çŸ©é˜µï¼Œåœ¨ä¸‹ä¸€èŠ‚ <a href="#è¿åŠ¨ç‰©ä½“çš„å…‰ç…§æ•ˆæœ">è¿åŠ¨ç‰©ä½“çš„å…‰ç…§æ•ˆæœ</a> ä¼šæåˆ°ã€‚</li>
<li>ç”±äºèšå…‰ç¯ç”¨çš„æ¯”è¾ƒå°‘ï¼Œæœ¬æ–‡ä¸æ¶‰åŠï¼Œå¯ä»¥çœ‹æ–‡æœ«çš„å‚è€ƒèµ„æ–™</li>
</ol>
<h3 id="å¹³è¡Œå…‰çš„å¤„ç†"><a href="#å¹³è¡Œå…‰çš„å¤„ç†" class="headerlink" title="å¹³è¡Œå…‰çš„å¤„ç†"></a>å¹³è¡Œå…‰çš„å¤„ç†</h3><p>æˆ‘ä»¬åœ¨é¡¶ç‚¹ç€è‰²å™¨ä¸­è®¡ç®—æ¯ä¸ªé¡¶ç‚¹çš„åå°„å…‰é¢œè‰²</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// é¡¶ç‚¹ç€è‰²å™¨</span></span><br><span class="line"><span class="keyword">var</span> VSHADER_SOURCE = <span class="string">`</span></span><br><span class="line"><span class="string">  attribute vec4 a_Position;</span></span><br><span class="line"><span class="string">  attribute vec4 a_Color;</span></span><br><span class="line"><span class="string">  // æ³•å‘é‡</span></span><br><span class="line"><span class="string">  attribute vec4 a_Normal;</span></span><br><span class="line"><span class="string">  uniform mat4 u_MvpMatrix;</span></span><br><span class="line"><span class="string">  // å…‰çº¿é¢œè‰²</span></span><br><span class="line"><span class="string">  uniform vec3 u_LightColor;</span></span><br><span class="line"><span class="string">  // å…‰çº¿æ–¹å‘ï¼ˆå½’ä¸€åŒ–çš„ä¸–ç•Œåæ ‡ï¼‰</span></span><br><span class="line"><span class="string">  uniform vec3 u_LightDirection;</span></span><br><span class="line"><span class="string">  varying vec4 v_Color;</span></span><br><span class="line"><span class="string">  void main() &#123;</span></span><br><span class="line"><span class="string">    gl_Position = u_MvpMatrix * a_Position;</span></span><br><span class="line"><span class="string">    // å¯¹æ³•å‘é‡è¿›è¡Œå½’ä¸€åŒ–</span></span><br><span class="line"><span class="string">    vec3 normal = normalize(a_Normal.xyz);</span></span><br><span class="line"><span class="string">    // è®¡ç®—å…‰çº¿æ–¹å‘å’Œæ³•å‘é‡çš„ç‚¹ç§¯</span></span><br><span class="line"><span class="string">    float nDotL = max(dot(u_LightDirection, normal), 0.0);</span></span><br><span class="line"><span class="string">    // è®¡ç®—æ¼«åå°„å…‰çš„é¢œè‰²</span></span><br><span class="line"><span class="string">    vec3 diffuse = u_LightColor * a_Color.rgb * nDotL;</span></span><br><span class="line"><span class="string">    v_Color = vec4(diffuse, a_Color.a);</span></span><br><span class="line"><span class="string">  &#125;`</span></span><br><span class="line"><span class="comment">// ç‰‡æ®µç€è‰²å™¨</span></span><br><span class="line"><span class="keyword">var</span> FSHADER_SOURCE = <span class="string">`</span></span><br><span class="line"><span class="string">  precision mediump float;</span></span><br><span class="line"><span class="string">  varying vec4 v_Color;</span></span><br><span class="line"><span class="string">  void main() &#123;</span></span><br><span class="line"><span class="string">    gl_FragColor = v_Color;</span></span><br><span class="line"><span class="string">  &#125;`</span></span><br></pre></td></tr></table></figure>

<p>è®¾ç½® <code>(0.5, 3.0, 4.0)</code> æ–¹å‘ï¼ˆä¸–ç•Œåæ ‡ç³»ï¼‰çš„å¹³è¡Œç™½å…‰ <code>(1.0, 1.0, 1.0)</code></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è®¾ç½®å…‰çº¿é¢œè‰²</span></span><br><span class="line">gl.uniform3f(u_LightColor, <span class="number">1.0</span>, <span class="number">1.0</span>, <span class="number">1.0</span>);</span><br><span class="line"><span class="comment">// è®¾ç½®å½’ä¸€åŒ–çš„ä¸–ç•Œåæ ‡çš„å…‰çº¿æ–¹å‘</span></span><br><span class="line"><span class="keyword">let</span> direction = normalize([<span class="number">0.5</span>, <span class="number">3.0</span>, <span class="number">4.0</span>])</span><br><span class="line"><span class="built_in">console</span>.log(direction) <span class="comment">// [0.1,0.6,0.8]</span></span><br><span class="line">gl.uniform3fv(u_LightDirection, direction);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¾ç½®æŠ•å½±çŸ©é˜µå’Œè§†å›¾çŸ©é˜µï¼Œä¸å½±å“å…‰ç…§</span></span><br><span class="line"><span class="keyword">var</span> mvpMatrix = <span class="keyword">new</span> Matrix4();</span><br><span class="line">mvpMatrix.setPerspective(<span class="number">30</span>, canvas.width / canvas.height, <span class="number">1</span>, <span class="number">100</span>);</span><br><span class="line">mvpMatrix.lookAt(<span class="number">3</span>, <span class="number">3</span>, <span class="number">7</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>);</span><br></pre></td></tr></table></figure>

<p>æ•ˆæœå¦‚ä¸‹</p>
<p><img src="https://upload-images.jianshu.io/upload_images/9277731-549399fb1e087eb3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="LightedCube"></p>
<h3 id="ç‚¹å…‰æºçš„å¤„ç†"><a href="#ç‚¹å…‰æºçš„å¤„ç†" class="headerlink" title="ç‚¹å…‰æºçš„å¤„ç†"></a>ç‚¹å…‰æºçš„å¤„ç†</h3><p>æ ¹æ®ç‰©ä½“ä¸­å…¥å°„ç‚¹ä½ç½®ä¸ç‚¹å…‰æºä½ç½®å¾—åˆ°å…¥å°„å…‰æ–¹å‘</p>
<p>ä¸å¹³è¡Œå…‰ä¸åŒçš„æ˜¯ï¼Œéœ€è¦å¯¹æ¯ä¸ªç‚¹ï¼ˆåœ¨ç‰‡æ®µç€è‰²å™¨ä¸­å¤„ç†ï¼‰è®¡ç®—å…‰ç…§æ•ˆæœï¼Œè€Œä¸æ˜¯å¯¹é¡¶ç‚¹</p>
<blockquote>
<p>å¦‚æœé‡‡ç”¨é¡¶ç‚¹è®¡ç®—ï¼Œä¸­é—´åƒç´ è¿›è¡Œå†…æ’ä¼šå¯¼è‡´å…‰ç…§æœ‰ä¸€äº›çº¿æ¡</p>
</blockquote>
<p><img src="https://upload-images.jianshu.io/upload_images/9277731-503bfeab93860b3a.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="pointLight.jpg"></p>
<p>æ ¹æ®å…¬å¼</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;æ¼«åå°„å…‰é¢œè‰²&gt; = <span class="xml"><span class="tag">&lt;<span class="name">å…¥å°„å…‰é¢œè‰²</span>&gt;</span> x <span class="tag">&lt;<span class="name">è¡¨é¢åŸºåº•è‰²</span>&gt;</span> x (<span class="tag">&lt;<span class="name">å…¥å°„å…‰æ–¹å‘</span>&gt;</span> Â· <span class="tag">&lt;<span class="name">æ³•çº¿æ–¹å‘</span>&gt;</span>)</span></span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å°†é¡¶ç‚¹ï¼Œæ³•å‘é‡æ”¾å…¥ç‰‡æ®µç€è‰²å™¨ä¸­å¤„ç†</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// é¡¶ç‚¹ç€è‰²å™¨</span></span><br><span class="line"><span class="keyword">var</span> VSHADER_SOURCE = <span class="string">`</span></span><br><span class="line"><span class="string">  attribute vec4 a_Position;</span></span><br><span class="line"><span class="string">  attribute vec4 a_Color;</span></span><br><span class="line"><span class="string">  attribute vec4 a_Normal;</span></span><br><span class="line"><span class="string">  uniform mat4 u_MvpMatrix;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  varying vec4 v_Color;</span></span><br><span class="line"><span class="string">  varying vec3 v_Normal;</span></span><br><span class="line"><span class="string">  varying vec3 v_Position;</span></span><br><span class="line"><span class="string">  void main() &#123;</span></span><br><span class="line"><span class="string">    gl_Position = u_MvpMatrix * a_Position;</span></span><br><span class="line"><span class="string">    v_Position = a_Position.xyz;</span></span><br><span class="line"><span class="string">    v_Normal = a_Normal.xyz;</span></span><br><span class="line"><span class="string">    v_Color = a_Color;</span></span><br><span class="line"><span class="string">  &#125;`</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ç‰‡æ®µç€è‰²å™¨</span></span><br><span class="line"><span class="keyword">var</span> FSHADER_SOURCE = <span class="string">`</span></span><br><span class="line"><span class="string">  precision mediump float;</span></span><br><span class="line"><span class="string">  // Light color</span></span><br><span class="line"><span class="string">  uniform vec3 u_LightColor;</span></span><br><span class="line"><span class="string">  uniform vec3 u_LightPosition;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  varying vec3 v_Normal;</span></span><br><span class="line"><span class="string">  varying vec3 v_Position;</span></span><br><span class="line"><span class="string">  varying vec4 v_Color;</span></span><br><span class="line"><span class="string">  void main() &#123;</span></span><br><span class="line"><span class="string">    // å¯¹æ³•çº¿è¿›è¡Œå½’ä¸€åŒ–ï¼Œå› ä¸ºå†…æ’åé•¿åº¦ä¸ä¸€å®šæ˜¯ 1.0</span></span><br><span class="line"><span class="string">    vec3 normal = normalize(v_Normal);</span></span><br><span class="line"><span class="string">    // è®¡ç®—å…‰çº¿æ–¹å‘å¹¶å½’ä¸€åŒ–</span></span><br><span class="line"><span class="string">    vec3 lightDirection = normalize(u_LightPosition - v_Position);</span></span><br><span class="line"><span class="string">    // è®¡ç®—å…‰çº¿æ–¹å‘ä¸æ³•å‘é‡çš„ç‚¹ç§¯</span></span><br><span class="line"><span class="string">    float nDotL = max(dot(lightDirection, normal), 0.0);</span></span><br><span class="line"><span class="string">    // è®¡ç®—æ¼«åå°„é¢œè‰²</span></span><br><span class="line"><span class="string">    vec3 diffuse = u_LightColor * v_Color.rgb * nDotL;</span></span><br><span class="line"><span class="string">    gl_FragColor = vec4(diffuse, v_Color.a);</span></span><br><span class="line"><span class="string">  &#125;`</span></span><br></pre></td></tr></table></figure>


<p>è®¾ç½® <code>(2.2, 2.2, 2.0)</code> ä½ç½®ï¼ˆä¸–ç•Œåæ ‡ç³»ï¼‰çš„ç‚¹å…‰æº <code>(1.0, 1.0, 1.0)</code></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è®¾ç½®ç‚¹å…‰æºé¢œè‰²</span></span><br><span class="line">gl.uniform3f(u_LightColor, <span class="number">1.0</span>, <span class="number">1.0</span>, <span class="number">1.0</span>);</span><br><span class="line"><span class="comment">// è®¾ç½®ç‚¹å…‰æºä½ç½®ï¼ˆä¸–ç•Œåæ ‡ç³»ï¼‰</span></span><br><span class="line">gl.uniform3f(u_LightPosition, <span class="number">2.2</span>, <span class="number">2.2</span>, <span class="number">2.0</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¾ç½®æŠ•å½±çŸ©é˜µå’Œè§†å›¾çŸ©é˜µï¼Œä¸å½±å“å…‰ç…§</span></span><br><span class="line"><span class="keyword">var</span> mvpMatrix = <span class="keyword">new</span> Matrix4();</span><br><span class="line">mvpMatrix.setPerspective(<span class="number">30</span>, canvas.width / canvas.height, <span class="number">1</span>, <span class="number">100</span>);</span><br><span class="line">mvpMatrix.lookAt(<span class="number">3</span>, <span class="number">3</span>, <span class="number">7</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>);</span><br></pre></td></tr></table></figure>

<p>æ•ˆæœå¦‚ä¸‹</p>
<p><img src="https://upload-images.jianshu.io/upload_images/9277731-67ea797e41fbe700.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="PointLightedCube.png"></p>
<h2 id="ç¯å¢ƒåå°„"><a href="#ç¯å¢ƒåå°„" class="headerlink" title="ç¯å¢ƒåå°„"></a>ç¯å¢ƒåå°„</h2><p>ç¯å¢ƒåå°„é’ˆå¯¹çš„æ˜¯ç¯å¢ƒå…‰</p>
<p>ç¯å¢ƒå…‰ä¸å…‰æºæ–¹å‘æ— å…³ï¼Œåœ¨åœºæ™¯ä¸­æ˜¯å‡åŒ€åˆ†å¸ƒçš„ï¼Œå¯¹æ‰€æœ‰ç‰©ä½“éƒ½æœ‰æ•ˆ</p>
<p>åœ¨ç¨‹åºä¸­ï¼Œç¯å¢ƒå…‰æ˜¯<strong>ç›´æ¥å®šä¹‰</strong>çš„ï¼Œè€Œä¸æ˜¯é€šè¿‡å…¶ä»–å…‰æºç”Ÿæˆçš„ã€‚</p>
<p>æ‰€ä»¥å¯ä»¥è°ƒèŠ‚ç¯å¢ƒå…‰çš„é¢œè‰²å¾—åˆ°æˆ‘ä»¬æƒ³è¦çš„æ•ˆæœï¼Œé€šå¸¸å¼ºåº¦è¾ƒå¼±</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;ç¯å¢ƒåå°„å…‰é¢œè‰²&gt; &#x3D; &lt;å…¥å°„å…‰é¢œè‰²&gt; x &lt;è¡¨é¢åŸºåº•è‰²&gt;</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢å…¬å¼ä¸­çš„å…¥å°„å…‰é¢œè‰²å°±æ˜¯æˆ‘ä»¬å®šä¹‰çš„ç¯å¢ƒå…‰é¢œè‰²</p>
<p>å‡è®¾ç¯å¢ƒå…‰ä¸ºå¼±ç™½å…‰ <code>(0.2,0.2,0.2)</code> ï¼Œç‰©ä½“è¡¨é¢åŸºåº•è‰²ä¸ºçº¢è‰² <code>(1.0,0.0,0.0)</code>ï¼Œç”±ç¯å¢ƒå…‰äº§ç”Ÿçš„åå°„å…‰é¢œè‰²ä¸ºæš—çº¢è‰² <code>(0.2,0.0,0.0)</code></p>
<p>è¿™é‡Œä»…åº”ç”¨ç¯å¢ƒå…‰ï¼Œå¾—åˆ°å¦‚ä¸‹çš„æ•ˆæœ</p>
<p><img src="https://upload-images.jianshu.io/upload_images/9277731-db1dd03510ec18d6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ambientCube"></p>
<p>å…¶å®å°±æ˜¯æ‰€æœ‰é¡¶ç‚¹çš„ rgb åˆ†é‡ä¹˜ä»¥ç¯å¢ƒå…‰ rgb åˆ†é‡</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">vec3 ambient = u_AmbientLight * a_Color.rgb;</span><br><span class="line">v_Color = vec4(ambient, a_Color.a);</span><br></pre></td></tr></table></figure>

<h2 id="é•œé¢åå°„"><a href="#é•œé¢åå°„" class="headerlink" title="é•œé¢åå°„"></a>é•œé¢åå°„</h2><p>å…‰çº¿ç…§å°„åˆ°ç‰©ä½“è¡¨é¢ï¼Œéƒ¨åˆ†è¢«å¸æ”¶ï¼Œéƒ¨åˆ†è¿›è¡Œåå°„ã€‚åå°„è§’ä¸å…¥å°„è§’ä¸€è‡´</p>
<p><img src="https://upload-images.jianshu.io/upload_images/9277731-a3e02351e219ffd1.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å¼•è‡ª csdn"></p>
<p>åªæœ‰ç›¸æœºä½äºåå°„å…‰çš„åŒºåŸŸï¼Œå…‰çº¿æ‰ä¼šå¯è§</p>
<p><img src="https://upload-images.jianshu.io/upload_images/9277731-e69f8549ce1223fd.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å¼•è‡ª csdn"></p>
<p>é•œé¢åå°„ç”¨çš„æ¯”è¾ƒå°‘ï¼Œæœ¬æ–‡å°±ä¸è®¨è®ºäº†ã€‚</p>
<h2 id="åå°„å åŠ "><a href="#åå°„å åŠ " class="headerlink" title="åå°„å åŠ "></a>åå°„å åŠ </h2><p>åœ¨æ¸²æŸ“æ¨¡å‹æ—¶å¯ä»¥å¯¹å‡ ç§åå°„è¿›è¡Œå åŠ ï¼Œè®¾ç½®ä¸€å®šæ¯”ä¾‹ç­‰ç­‰ï¼Œå¾—åˆ°æƒ³è¦çš„æ•ˆæœï¼Œæ¯”å¦‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;è¡¨é¢çš„åå°„å…‰é¢œè‰²&gt; &#x3D; &lt;æ¼«åå°„å…‰é¢œè‰²&gt; + &lt;ç¯å¢ƒåå°„å…‰é¢œè‰²&gt;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬åº”ç”¨ <code>(0.2,0.2,0.2)</code> çš„ç¯å¢ƒå…‰ï¼Œå¹¶è®¾ç½® <code>(0.5, 3.0, 4.0)</code> æ–¹å‘ï¼ˆä¸–ç•Œåæ ‡ç³»ï¼‰çš„å¹³è¡Œç™½å…‰ <code>(1.0, 1.0, 1.0)</code></p>
<blockquote>
<p>ç™½å…‰ä»¥å·¦ä¸‹å‰æ–¹å‘ç…§å‘ç«‹æ–¹ä½“ \</p>
</blockquote>
<p>æ ¸å¿ƒä»£ç ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">vec3 diffuse = u_DiffuseLight * a_Color.rgb * nDotL;</span><br><span class="line">vec3 ambient = u_AmbientLight * a_Color.rgb;</span><br><span class="line"><span class="comment">// æœ€ç»ˆåå°„å…‰é¢œè‰²ä¸ºæ¼«åå°„å’Œç¯å¢ƒåå°„çš„å åŠ </span></span><br><span class="line">v_Color = vec4(diffuse + ambient, a_Color.a);</span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°å¦‚ä¸‹æ•ˆæœ</p>
<p><img src="https://upload-images.jianshu.io/upload_images/9277731-6d3b97538de36428.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="LightedCube_ambient"></p>
<p>å¦‚æœæ˜¯ä¸Šé¢ç‚¹å…‰æºçš„ä¾‹å­ä¹Ÿåº”ç”¨ç¯å¢ƒå…‰çš„è¯</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">vec3 diffuse = u_LightColor * v_Color.rgb * nDotL;</span><br><span class="line">vec3 ambient = u_AmbientLight * v_Color.rgb;</span><br><span class="line">gl_FragColor = vec4(diffuse + ambient, v_Color.a);</span><br></pre></td></tr></table></figure>
<p>æ•ˆæœå¦‚ä¸‹</p>
<p><img src="https://upload-images.jianshu.io/upload_images/9277731-a1a535ffee8ce334.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="PointLightedCube_ambient.png"></p>
<p>ç‚¹å…‰æº+ç¯å¢ƒå…‰çš„ç»„åˆæ¯”è¾ƒå¸¸ç”¨</p>
<h1 id="è¿åŠ¨ç‰©ä½“çš„å…‰ç…§æ•ˆæœ"><a href="#è¿åŠ¨ç‰©ä½“çš„å…‰ç…§æ•ˆæœ" class="headerlink" title="è¿åŠ¨ç‰©ä½“çš„å…‰ç…§æ•ˆæœ"></a>è¿åŠ¨ç‰©ä½“çš„å…‰ç…§æ•ˆæœ</h1><p>ä¸Šæ–‡ä¸ºäº†ç®€å•ï¼Œä¸€ç›´æ²¡æœ‰æåˆ°æ¨¡å‹çŸ©é˜µï¼Œå³å¯¹ç‰©ä½“è¿›è¡Œå¹³ç§»ã€æ—‹è½¬ã€ç¼©æ”¾</p>
<p>æ‰€ä»¥å±€éƒ¨ç©ºé—´åæ ‡ç³»å’Œä¸–ç•Œåæ ‡ç³»æ˜¯ä¸€è‡´çš„</p>
<p>ç‰©ä½“åº”ç”¨äº†æ¨¡å‹çŸ©é˜µåï¼Œä¸¤ä¸ªåæ ‡ç³»ä¸ä¸€è‡´äº†ï¼Œé‚£å…‰ç…§åˆè¯¥å¦‚ä½•è®¡ç®—ï¼Ÿ</p>
<p>æˆ‘ä»¬éœ€å¯¹æ³•å‘é‡è¿›è¡Œå˜æ¢ï¼Œç”¨æ³•å‘é‡ä¹˜ä»¥æ¨¡å‹çŸ©é˜µçš„é€†è½¬ç½®çŸ©é˜µå³å¯</p>
<blockquote>
<p>é€†è½¬ç½®çŸ©é˜µè¡¨ç¤ºå¯¹çŸ©é˜µå…ˆæ±‚é€†å†è½¬ç½®</p>
</blockquote>
<p>è¿™æ ·å¾—åˆ°çš„å°±æ˜¯æ³•å‘é‡åœ¨ä¸–ç•Œç©ºé—´çš„è¡¨ç¤ºï¼Œç›¸å…³è¯æ˜å¯ä»¥æŸ¥çœ‹ <a href="https://zhuanlan.zhihu.com/p/72734738" target="_blank" rel="noopener">æ¸²æŸ“ç®¡çº¿ä¸­çš„æ³•çº¿å˜æ¢çŸ©é˜µ</a></p>
<p>å¯¹äºç‚¹å…‰æºçš„åœºæ™¯ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å¯¹é¡¶ç‚¹åº”ç”¨æ¨¡å‹çŸ©é˜µå†ä¼ å…¥ç‰‡æ®µç€è‰²å™¨</p>
<p>å°†ä¸Šä¸€èŠ‚ <em>ç‚¹å…‰æº+ç¯å¢ƒå…‰</em> çš„ä¾‹å­è¿›è¡Œå°æ”¹é€ ï¼Œåº”ç”¨æ¨¡å‹çŸ©é˜µ</p>
<p>æ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// é¡¶ç‚¹ç€è‰²å™¨</span></span><br><span class="line"><span class="keyword">var</span> VSHADER_SOURCE = <span class="string">`</span></span><br><span class="line"><span class="string">  attribute vec4 a_Position;</span></span><br><span class="line"><span class="string">  attribute vec4 a_Color;</span></span><br><span class="line"><span class="string">  attribute vec4 a_Normal;</span></span><br><span class="line"><span class="string">  uniform mat4 u_MvpMatrix;</span></span><br><span class="line"><span class="string">  // æ¨¡å‹çŸ©é˜µ</span></span><br><span class="line"><span class="string">  uniform mat4 u_ModelMatrix;</span></span><br><span class="line"><span class="string">  // ç”¨æ¥å˜æ¢æ³•å‘é‡çš„çŸ©é˜µï¼ˆæ¨¡å‹çŸ©é˜µçš„é€†è½¬ç½®çŸ©é˜µï¼‰</span></span><br><span class="line"><span class="string">  uniform mat4 u_NormalMatrix;  </span></span><br><span class="line"><span class="string">  varying vec4 v_Color;</span></span><br><span class="line"><span class="string">  varying vec3 v_Normal;</span></span><br><span class="line"><span class="string">  varying vec3 v_Position;</span></span><br><span class="line"><span class="string">  void main() &#123;</span></span><br><span class="line"><span class="string">    gl_Position = u_MvpMatrix * a_Position;</span></span><br><span class="line"><span class="string">     // è®¡ç®—é¡¶ç‚¹çš„ä¸–ç•Œåæ ‡</span></span><br><span class="line"><span class="string">    v_Position = vec3(u_ModelMatrix * a_Position);</span></span><br><span class="line"><span class="string">    // å¾—åˆ°å˜æ¢åçš„æ³•å‘é‡</span></span><br><span class="line"><span class="string">    v_Normal = normalize(vec3(u_NormalMatrix * a_Normal));</span></span><br><span class="line"><span class="string">    v_Color = a_Color;</span></span><br><span class="line"><span class="string">  &#125;`</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ç‰‡æ®µç€è‰²å™¨</span></span><br><span class="line"><span class="keyword">var</span> FSHADER_SOURCE = <span class="string">`</span></span><br><span class="line"><span class="string">  precision mediump float;</span></span><br><span class="line"><span class="string">  // Light color</span></span><br><span class="line"><span class="string">  uniform vec3 u_LightColor;</span></span><br><span class="line"><span class="string">  // Position of the light source</span></span><br><span class="line"><span class="string">  uniform vec3 u_LightPosition;</span></span><br><span class="line"><span class="string">  // Ambient light color</span></span><br><span class="line"><span class="string">  uniform vec3 u_AmbientLight;</span></span><br><span class="line"><span class="string">  varying vec3 v_Normal;</span></span><br><span class="line"><span class="string">  varying vec3 v_Position;</span></span><br><span class="line"><span class="string">  varying vec4 v_Color;</span></span><br><span class="line"><span class="string">  void main() &#123;</span></span><br><span class="line"><span class="string">    // å¯¹æ³•çº¿è¿›è¡Œå½’ä¸€åŒ–ï¼Œå› ä¸ºå†…æ’åé•¿åº¦ä¸ä¸€å®šæ˜¯ 1.0</span></span><br><span class="line"><span class="string">    vec3 normal = normalize(v_Normal);</span></span><br><span class="line"><span class="string">    // è®¡ç®—å…‰çº¿æ–¹å‘å¹¶å½’ä¸€åŒ–</span></span><br><span class="line"><span class="string">    vec3 lightDirection = normalize(u_LightPosition - v_Position);</span></span><br><span class="line"><span class="string">    // è®¡ç®—å…‰çº¿æ–¹å‘ä¸æ³•å‘é‡çš„ç‚¹ç§¯</span></span><br><span class="line"><span class="string">    float nDotL = max(dot(lightDirection, normal), 0.0);</span></span><br><span class="line"><span class="string">    // è®¡ç®—æ¼«åå°„å’Œç¯å¢ƒåå°„çš„æœ€ç»ˆé¢œè‰²</span></span><br><span class="line"><span class="string">    vec3 diffuse = u_LightColor * v_Color.rgb * nDotL;</span></span><br><span class="line"><span class="string">    vec3 ambient = u_AmbientLight * v_Color.rgb;</span></span><br><span class="line"><span class="string">    gl_FragColor = vec4(diffuse + ambient, v_Color.a);</span></span><br><span class="line"><span class="string">  &#125;`</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// çœç•¥éƒ¨åˆ†ä»£ç </span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¾ç½®ç‚¹å…‰æºé¢œè‰²</span></span><br><span class="line">gl.uniform3f(u_LightColor, <span class="number">1.0</span>, <span class="number">1.0</span>, <span class="number">1.0</span>);</span><br><span class="line"><span class="comment">// è®¾ç½®ç‚¹å…‰æºä½ç½®ï¼ˆä¸–ç•Œåæ ‡ç³»ï¼‰</span></span><br><span class="line">gl.uniform3f(u_LightPosition, <span class="number">2.3</span>, <span class="number">4.0</span>, <span class="number">3.5</span>);</span><br><span class="line"><span class="comment">// è®¾ç½®ç¯å¢ƒå…‰</span></span><br><span class="line">gl.uniform3f(u_AmbientLight, <span class="number">0.2</span>, <span class="number">0.2</span>, <span class="number">0.2</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¨¡å‹çŸ©é˜µ</span></span><br><span class="line"><span class="keyword">var</span> modelMatrix = <span class="keyword">new</span> Matrix4();</span><br><span class="line"><span class="comment">// æ¨¡å‹ã€è§†å›¾ã€æŠ•å½± åˆæˆåçš„çŸ©é˜µ</span></span><br><span class="line"><span class="keyword">var</span> mvpMatrix = <span class="keyword">new</span> Matrix4();</span><br><span class="line"><span class="comment">// ç”¨æ¥å˜æ¢æ³•å‘é‡çš„çŸ©é˜µï¼ˆæ¨¡å‹çŸ©é˜µçš„é€†è½¬ç½®çŸ©é˜µï¼‰</span></span><br><span class="line"><span class="keyword">var</span> normalMatrix = <span class="keyword">new</span> Matrix4();</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¾ç½®æ¨¡å‹çŸ©é˜µ</span></span><br><span class="line">modelMatrix.setRotate(<span class="number">90</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">mvpMatrix.setPerspective(<span class="number">30</span>, canvas.width / canvas.height, <span class="number">1</span>, <span class="number">100</span>);</span><br><span class="line">mvpMatrix.lookAt(<span class="number">6</span>, <span class="number">6</span>, <span class="number">14</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">mvpMatrix.multiply(modelMatrix);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¡ç®—æ¨¡å‹çŸ©é˜µçš„é€†è½¬ç½®çŸ©é˜µ</span></span><br><span class="line">normalMatrix.setInverseOf(modelMatrix);</span><br><span class="line">normalMatrix.transpose();</span><br></pre></td></tr></table></figure>




<p>æ•ˆæœå¦‚ä¸‹ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/9277731-5eaaf2a790c7d40e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="modelLightCube"></p>
<p>çŸ©é˜µæ“ä½œç›¸å…³ä»£ç ï¼ˆæ¥æºäºã€ŠWebGL ç¼–ç¨‹æŒ‡å—ã€‹ï¼‰:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * çŸ©é˜µè½¬ç½®</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return <span class="variable">this</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">Matrix4.prototype.transpose = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> e, t;</span><br><span class="line"></span><br><span class="line">  e = <span class="keyword">this</span>.elements;</span><br><span class="line"></span><br><span class="line">  t = e[ <span class="number">1</span>];  e[ <span class="number">1</span>] = e[ <span class="number">4</span>];  e[ <span class="number">4</span>] = t;</span><br><span class="line">  t = e[ <span class="number">2</span>];  e[ <span class="number">2</span>] = e[ <span class="number">8</span>];  e[ <span class="number">8</span>] = t;</span><br><span class="line">  t = e[ <span class="number">3</span>];  e[ <span class="number">3</span>] = e[<span class="number">12</span>];  e[<span class="number">12</span>] = t;</span><br><span class="line">  t = e[ <span class="number">6</span>];  e[ <span class="number">6</span>] = e[ <span class="number">9</span>];  e[ <span class="number">9</span>] = t;</span><br><span class="line">  t = e[ <span class="number">7</span>];  e[ <span class="number">7</span>] = e[<span class="number">13</span>];  e[<span class="number">13</span>] = t;</span><br><span class="line">  t = e[<span class="number">11</span>];  e[<span class="number">11</span>] = e[<span class="number">14</span>];  e[<span class="number">14</span>] = t;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * çŸ©é˜µæ±‚é€†</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>other The source matrix</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return <span class="variable">this</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">Matrix4.prototype.setInverseOf = <span class="function"><span class="keyword">function</span>(<span class="params">other</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> i, s, d, inv, det;</span><br><span class="line"></span><br><span class="line">  s = other.elements;</span><br><span class="line">  d = <span class="keyword">this</span>.elements;</span><br><span class="line">  inv = <span class="keyword">new</span> <span class="built_in">Float32Array</span>(<span class="number">16</span>);</span><br><span class="line"></span><br><span class="line">  inv[<span class="number">0</span>]  =   s[<span class="number">5</span>]*s[<span class="number">10</span>]*s[<span class="number">15</span>] - s[<span class="number">5</span>] *s[<span class="number">11</span>]*s[<span class="number">14</span>] - s[<span class="number">9</span>] *s[<span class="number">6</span>]*s[<span class="number">15</span>]</span><br><span class="line">            + s[<span class="number">9</span>]*s[<span class="number">7</span>] *s[<span class="number">14</span>] + s[<span class="number">13</span>]*s[<span class="number">6</span>] *s[<span class="number">11</span>] - s[<span class="number">13</span>]*s[<span class="number">7</span>]*s[<span class="number">10</span>];</span><br><span class="line">  inv[<span class="number">4</span>]  = - s[<span class="number">4</span>]*s[<span class="number">10</span>]*s[<span class="number">15</span>] + s[<span class="number">4</span>] *s[<span class="number">11</span>]*s[<span class="number">14</span>] + s[<span class="number">8</span>] *s[<span class="number">6</span>]*s[<span class="number">15</span>]</span><br><span class="line">            - s[<span class="number">8</span>]*s[<span class="number">7</span>] *s[<span class="number">14</span>] - s[<span class="number">12</span>]*s[<span class="number">6</span>] *s[<span class="number">11</span>] + s[<span class="number">12</span>]*s[<span class="number">7</span>]*s[<span class="number">10</span>];</span><br><span class="line">  inv[<span class="number">8</span>]  =   s[<span class="number">4</span>]*s[<span class="number">9</span>] *s[<span class="number">15</span>] - s[<span class="number">4</span>] *s[<span class="number">11</span>]*s[<span class="number">13</span>] - s[<span class="number">8</span>] *s[<span class="number">5</span>]*s[<span class="number">15</span>]</span><br><span class="line">            + s[<span class="number">8</span>]*s[<span class="number">7</span>] *s[<span class="number">13</span>] + s[<span class="number">12</span>]*s[<span class="number">5</span>] *s[<span class="number">11</span>] - s[<span class="number">12</span>]*s[<span class="number">7</span>]*s[<span class="number">9</span>];</span><br><span class="line">  inv[<span class="number">12</span>] = - s[<span class="number">4</span>]*s[<span class="number">9</span>] *s[<span class="number">14</span>] + s[<span class="number">4</span>] *s[<span class="number">10</span>]*s[<span class="number">13</span>] + s[<span class="number">8</span>] *s[<span class="number">5</span>]*s[<span class="number">14</span>]</span><br><span class="line">            - s[<span class="number">8</span>]*s[<span class="number">6</span>] *s[<span class="number">13</span>] - s[<span class="number">12</span>]*s[<span class="number">5</span>] *s[<span class="number">10</span>] + s[<span class="number">12</span>]*s[<span class="number">6</span>]*s[<span class="number">9</span>];</span><br><span class="line"></span><br><span class="line">  inv[<span class="number">1</span>]  = - s[<span class="number">1</span>]*s[<span class="number">10</span>]*s[<span class="number">15</span>] + s[<span class="number">1</span>] *s[<span class="number">11</span>]*s[<span class="number">14</span>] + s[<span class="number">9</span>] *s[<span class="number">2</span>]*s[<span class="number">15</span>]</span><br><span class="line">            - s[<span class="number">9</span>]*s[<span class="number">3</span>] *s[<span class="number">14</span>] - s[<span class="number">13</span>]*s[<span class="number">2</span>] *s[<span class="number">11</span>] + s[<span class="number">13</span>]*s[<span class="number">3</span>]*s[<span class="number">10</span>];</span><br><span class="line">  inv[<span class="number">5</span>]  =   s[<span class="number">0</span>]*s[<span class="number">10</span>]*s[<span class="number">15</span>] - s[<span class="number">0</span>] *s[<span class="number">11</span>]*s[<span class="number">14</span>] - s[<span class="number">8</span>] *s[<span class="number">2</span>]*s[<span class="number">15</span>]</span><br><span class="line">            + s[<span class="number">8</span>]*s[<span class="number">3</span>] *s[<span class="number">14</span>] + s[<span class="number">12</span>]*s[<span class="number">2</span>] *s[<span class="number">11</span>] - s[<span class="number">12</span>]*s[<span class="number">3</span>]*s[<span class="number">10</span>];</span><br><span class="line">  inv[<span class="number">9</span>]  = - s[<span class="number">0</span>]*s[<span class="number">9</span>] *s[<span class="number">15</span>] + s[<span class="number">0</span>] *s[<span class="number">11</span>]*s[<span class="number">13</span>] + s[<span class="number">8</span>] *s[<span class="number">1</span>]*s[<span class="number">15</span>]</span><br><span class="line">            - s[<span class="number">8</span>]*s[<span class="number">3</span>] *s[<span class="number">13</span>] - s[<span class="number">12</span>]*s[<span class="number">1</span>] *s[<span class="number">11</span>] + s[<span class="number">12</span>]*s[<span class="number">3</span>]*s[<span class="number">9</span>];</span><br><span class="line">  inv[<span class="number">13</span>] =   s[<span class="number">0</span>]*s[<span class="number">9</span>] *s[<span class="number">14</span>] - s[<span class="number">0</span>] *s[<span class="number">10</span>]*s[<span class="number">13</span>] - s[<span class="number">8</span>] *s[<span class="number">1</span>]*s[<span class="number">14</span>]</span><br><span class="line">            + s[<span class="number">8</span>]*s[<span class="number">2</span>] *s[<span class="number">13</span>] + s[<span class="number">12</span>]*s[<span class="number">1</span>] *s[<span class="number">10</span>] - s[<span class="number">12</span>]*s[<span class="number">2</span>]*s[<span class="number">9</span>];</span><br><span class="line"></span><br><span class="line">  inv[<span class="number">2</span>]  =   s[<span class="number">1</span>]*s[<span class="number">6</span>]*s[<span class="number">15</span>] - s[<span class="number">1</span>] *s[<span class="number">7</span>]*s[<span class="number">14</span>] - s[<span class="number">5</span>] *s[<span class="number">2</span>]*s[<span class="number">15</span>]</span><br><span class="line">            + s[<span class="number">5</span>]*s[<span class="number">3</span>]*s[<span class="number">14</span>] + s[<span class="number">13</span>]*s[<span class="number">2</span>]*s[<span class="number">7</span>]  - s[<span class="number">13</span>]*s[<span class="number">3</span>]*s[<span class="number">6</span>];</span><br><span class="line">  inv[<span class="number">6</span>]  = - s[<span class="number">0</span>]*s[<span class="number">6</span>]*s[<span class="number">15</span>] + s[<span class="number">0</span>] *s[<span class="number">7</span>]*s[<span class="number">14</span>] + s[<span class="number">4</span>] *s[<span class="number">2</span>]*s[<span class="number">15</span>]</span><br><span class="line">            - s[<span class="number">4</span>]*s[<span class="number">3</span>]*s[<span class="number">14</span>] - s[<span class="number">12</span>]*s[<span class="number">2</span>]*s[<span class="number">7</span>]  + s[<span class="number">12</span>]*s[<span class="number">3</span>]*s[<span class="number">6</span>];</span><br><span class="line">  inv[<span class="number">10</span>] =   s[<span class="number">0</span>]*s[<span class="number">5</span>]*s[<span class="number">15</span>] - s[<span class="number">0</span>] *s[<span class="number">7</span>]*s[<span class="number">13</span>] - s[<span class="number">4</span>] *s[<span class="number">1</span>]*s[<span class="number">15</span>]</span><br><span class="line">            + s[<span class="number">4</span>]*s[<span class="number">3</span>]*s[<span class="number">13</span>] + s[<span class="number">12</span>]*s[<span class="number">1</span>]*s[<span class="number">7</span>]  - s[<span class="number">12</span>]*s[<span class="number">3</span>]*s[<span class="number">5</span>];</span><br><span class="line">  inv[<span class="number">14</span>] = - s[<span class="number">0</span>]*s[<span class="number">5</span>]*s[<span class="number">14</span>] + s[<span class="number">0</span>] *s[<span class="number">6</span>]*s[<span class="number">13</span>] + s[<span class="number">4</span>] *s[<span class="number">1</span>]*s[<span class="number">14</span>]</span><br><span class="line">            - s[<span class="number">4</span>]*s[<span class="number">2</span>]*s[<span class="number">13</span>] - s[<span class="number">12</span>]*s[<span class="number">1</span>]*s[<span class="number">6</span>]  + s[<span class="number">12</span>]*s[<span class="number">2</span>]*s[<span class="number">5</span>];</span><br><span class="line"></span><br><span class="line">  inv[<span class="number">3</span>]  = - s[<span class="number">1</span>]*s[<span class="number">6</span>]*s[<span class="number">11</span>] + s[<span class="number">1</span>]*s[<span class="number">7</span>]*s[<span class="number">10</span>] + s[<span class="number">5</span>]*s[<span class="number">2</span>]*s[<span class="number">11</span>]</span><br><span class="line">            - s[<span class="number">5</span>]*s[<span class="number">3</span>]*s[<span class="number">10</span>] - s[<span class="number">9</span>]*s[<span class="number">2</span>]*s[<span class="number">7</span>]  + s[<span class="number">9</span>]*s[<span class="number">3</span>]*s[<span class="number">6</span>];</span><br><span class="line">  inv[<span class="number">7</span>]  =   s[<span class="number">0</span>]*s[<span class="number">6</span>]*s[<span class="number">11</span>] - s[<span class="number">0</span>]*s[<span class="number">7</span>]*s[<span class="number">10</span>] - s[<span class="number">4</span>]*s[<span class="number">2</span>]*s[<span class="number">11</span>]</span><br><span class="line">            + s[<span class="number">4</span>]*s[<span class="number">3</span>]*s[<span class="number">10</span>] + s[<span class="number">8</span>]*s[<span class="number">2</span>]*s[<span class="number">7</span>]  - s[<span class="number">8</span>]*s[<span class="number">3</span>]*s[<span class="number">6</span>];</span><br><span class="line">  inv[<span class="number">11</span>] = - s[<span class="number">0</span>]*s[<span class="number">5</span>]*s[<span class="number">11</span>] + s[<span class="number">0</span>]*s[<span class="number">7</span>]*s[<span class="number">9</span>]  + s[<span class="number">4</span>]*s[<span class="number">1</span>]*s[<span class="number">11</span>]</span><br><span class="line">            - s[<span class="number">4</span>]*s[<span class="number">3</span>]*s[<span class="number">9</span>]  - s[<span class="number">8</span>]*s[<span class="number">1</span>]*s[<span class="number">7</span>]  + s[<span class="number">8</span>]*s[<span class="number">3</span>]*s[<span class="number">5</span>];</span><br><span class="line">  inv[<span class="number">15</span>] =   s[<span class="number">0</span>]*s[<span class="number">5</span>]*s[<span class="number">10</span>] - s[<span class="number">0</span>]*s[<span class="number">6</span>]*s[<span class="number">9</span>]  - s[<span class="number">4</span>]*s[<span class="number">1</span>]*s[<span class="number">10</span>]</span><br><span class="line">            + s[<span class="number">4</span>]*s[<span class="number">2</span>]*s[<span class="number">9</span>]  + s[<span class="number">8</span>]*s[<span class="number">1</span>]*s[<span class="number">6</span>]  - s[<span class="number">8</span>]*s[<span class="number">2</span>]*s[<span class="number">5</span>];</span><br><span class="line"></span><br><span class="line">  det = s[<span class="number">0</span>]*inv[<span class="number">0</span>] + s[<span class="number">1</span>]*inv[<span class="number">4</span>] + s[<span class="number">2</span>]*inv[<span class="number">8</span>] + s[<span class="number">3</span>]*inv[<span class="number">12</span>];</span><br><span class="line">  <span class="keyword">if</span> (det === <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  det = <span class="number">1</span> / det;</span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++) &#123;</span><br><span class="line">    d[i] = inv[i] * det;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>å…‰ç…§æ•ˆæœæ˜¯åœ¨ä¸–ç•Œåæ ‡ç³»ä¸Šè®¡ç®—çš„</p>
<p>é€šè¿‡åº”ç”¨å…‰ç…§æ•ˆæœï¼Œå¯ä»¥è®©åœºæ™¯å˜å¾—æ›´çœŸå®</p>
<p>æœ‰äº†å…‰ç…§ï¼Œé‚£ä¹ˆè¿˜æœ‰é˜´å½±ï¼Œåé¢çš„æ–‡ç« æˆ‘ä»¬å°†è¿›è¡Œæ¢è®¨~</p>
<h1 id="å‚è€ƒæ–‡æ¡£"><a href="#å‚è€ƒæ–‡æ¡£" class="headerlink" title="å‚è€ƒæ–‡æ¡£"></a>å‚è€ƒæ–‡æ¡£</h1><ol>
<li>ã€ŠWebGL ç¼–ç¨‹æŒ‡å—ã€‹</li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/WebGL_API/Tutorial/Lighting_in_WebGL" target="_blank" rel="noopener">MDN-Lighting in WebGL</a></li>
<li><a href="https://webglfundamentals.org/webgl/lessons/zh_cn/webgl-3d-lighting-spot.html" target="_blank" rel="noopener">WebGL ä¸‰ç»´èšå…‰ç¯</a></li>
<li><a href="https://zh.wikipedia.org/wiki/Phong%E8%91%97%E8%89%B2%E6%B3%95" target="_blank" rel="noopener">Phongç€è‰²æ³•</a></li>
</ol>
]]></content>
      <categories>
        <category>å¤§å‰ç«¯</category>
      </categories>
      <tags>
        <tag>WebGL</tag>
      </tags>
  </entry>
  <entry>
    <title>æ·±å…¥ Immutable åŸç†</title>
    <url>/2020/03/16/2020/%E6%B7%B1%E5%85%A5%20Immutable%20%E5%8E%9F%E7%90%86/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æ¨èæ–‡ç« ã€‚ã€‚<a href="https://juejin.im/post/5ba4a6b75188255ca1537b19" target="_blank" rel="noopener">æ·±å…¥æ¢ç©¶immutable.jsçš„å®ç°æœºåˆ¶ï¼ˆäºŒï¼‰</a></p>
<p>å†™çš„å¾ˆæ˜ç™½äº†ï¼Œæœ¬æ–‡ç®€å•åšä¸ªè®°å½•</p>
<a id="more"></a>

<h2 id="åŸºæœ¬æ•°æ®ç»“æ„"><a href="#åŸºæœ¬æ•°æ®ç»“æ„" class="headerlink" title="åŸºæœ¬æ•°æ®ç»“æ„"></a>åŸºæœ¬æ•°æ®ç»“æ„</h2><h3 id="Trie"><a href="#Trie" class="headerlink" title="Trie"></a><a href="https://en.wikipedia.org/wiki/Trie" target="_blank" rel="noopener">Trie</a></h3><p>å‰ç¼€æ ‘ï¼Œåˆç§°å­—å…¸æ ‘</p>
<p>å¯ä»¥å…±ç”¨èŠ‚ç‚¹</p>
<h3 id="Vector-trie"><a href="#Vector-trie" class="headerlink" title="Vector trie"></a>Vector trie</h3><p>Trie æ²¡æœ‰ä¿®æ”¹èƒ½åŠ›ï¼Œå¼•å…¥ Vector Head è¿›è¡Œç»“æ„å…±äº«</p>
<p><img src="https://user-gold-cdn.xitu.io/2018/9/14/165d635ebb85e04d?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt=""></p>
<p>æ¯æ¬¡ä¿®æ”¹æ“ä½œçš„æ—¶å€™ï¼Œ æˆ‘ä»¬å¤åˆ¶ä»æ ¹åˆ°å¶å­èŠ‚ç‚¹çš„è·¯å¾„è€Œä¸æ˜¯ç›´æ¥ä¿®æ”¹å®ƒä»¬ï¼Œè¿™æ ·ä»ä¸¤ä¸ªæ ¹æˆ‘ä»¬å°±å¯ä»¥è®¿é—®åˆ°å¯¹æ•°æ®ä¸åŒæ—¶åˆ»çš„ä¸¤ä¸ªå¿«ç…§ã€‚</p>
<p><img src="https://pic4.zhimg.com/v2-2b4c801a7b40eefcd4ee6767fb984fdf_b.webp" alt=""></p>
<h3 id="Hash-array-mapped-trie"><a href="#Hash-array-mapped-trie" class="headerlink" title="Hash array mapped trie"></a><a href="https://en.wikipedia.org/wiki/Hash_array_mapped_trie" target="_blank" rel="noopener">Hash array mapped trie</a></h3><p>å– 2^5 ä½œä¸ºæ ‘å®½ã€‚ æ›´æ–°å’ŒæŸ¥è¯¢çš„è€ƒé‡</p>
<p>Vector trie ä¼šå‡ºç°ç©ºå€¼ï¼Œå°†å ç”¨ç©ºé—´ï¼Œæˆ‘ä»¬éœ€è¦é‡‡ç”¨æ–°çš„æ•°æ®æœºæ„</p>
<h4 id="1-å‹ç¼©æ ‘å®½"><a href="#1-å‹ç¼©æ ‘å®½" class="headerlink" title="1. å‹ç¼©æ ‘å®½"></a>1. å‹ç¼©æ ‘å®½</h4><p>4 bit çš„ mask å­èŠ‚ç‚¹é•¿åº¦ä¸º4</p>
<p>ä¾‹ mask 1001 ,è¡¨ç¤º 01 11 æœ‰å€¼</p>
<p>åˆ©ç”¨ mask è¿›è¡Œä½è¿ç®— <a href="https://en.wikipedia.org/wiki/Hamming_weight" target="_blank" rel="noopener">Hamming weight</a></p>
<blockquote>
<p>n è¡¨ç¤ºç¬¬å‡ ä¸ªå‰ç¼€ ï¼Œ ç»Ÿè®¡ mask ä¸Šä»æœ€ä½ä½ è‡³ç¬¬ n ä½ 1 å‡ºç°çš„æ¬¡æ•°ï¼Œå³å‰ç¼€åœ¨å‹ç¼©æ•°ç»„ä¸­çš„ç´¢å¼•</p>
</blockquote>
<p>ä¸é‡‡ç”¨é«˜ä½è¿˜æœ‰ä¸€ä¸ªåŸå› æ˜¯ mask çš„ä½æ•°ä¸å›ºå®š</p>
<p>å¢åŠ å±æ€§çš„è¯ï¼Œä¼šè°ƒæ•´æ•°ç»„çš„èŠ‚ç‚¹é¡ºåºï¼Œå¹¶é‡æ–°è®¡ç®— mask ï¼ˆæˆ–æ“ä½œï¼‰</p>
<h4 id="2-å‹ç¼©æ ‘é«˜"><a href="#2-å‹ç¼©æ ‘é«˜" class="headerlink" title="2. å‹ç¼©æ ‘é«˜"></a>2. å‹ç¼©æ ‘é«˜</h4><p>å•é“¾çš„è¯ï¼Œå»é™¤ä¸­é—´èŠ‚ç‚¹ã€‚</p>
<p>å¦‚æœæ–°å¢èŠ‚ç‚¹ï¼Œéœ€è¦å¢åŠ ä¸­é—´èŠ‚ç‚¹ï¼Œå…¶å®å°±æ˜¯è¿˜åŸä¹‹å‰è¢«å»é™¤çš„ä¸­é—´èŠ‚ç‚¹</p>
<p>æœ€ç»ˆä¿æŒå•é“¾åªæœ‰ä¸€çº§å³å¯</p>
<h4 id="3-trie-ä¼˜åŒ–"><a href="#3-trie-ä¼˜åŒ–" class="headerlink" title="3. trie ä¼˜åŒ–"></a>3. trie ä¼˜åŒ–</h4><p>è®°å½•å½“å‰ trie çš„é«˜åº¦</p>
<p>é’ˆå¯¹ List push çš„ä¼˜åŒ– â€“ tail èŠ‚ç‚¹</p>
<h2 id="è¦ç‚¹"><a href="#è¦ç‚¹" class="headerlink" title="è¦ç‚¹"></a>è¦ç‚¹</h2><h3 id="hash-å†²çª"><a href="#hash-å†²çª" class="headerlink" title="hash å†²çª"></a>hash å†²çª</h3><p>ä¿æŒåœ¨ä¸€ä¸ªçº¿æ€§æ•°ç»„ä¸­ï¼Œç”±äºå†²çªæ¦‚ç‡ä¸é«˜ï¼Œä¸å†å¼•å…¥å¤æ‚çš„æ•°æ®ç»“æ„</p>
<h3 id="ä¸ºä½•æ¯”-Object-assign-å¥½"><a href="#ä¸ºä½•æ¯”-Object-assign-å¥½" class="headerlink" title="ä¸ºä½•æ¯” Object.assign å¥½"></a>ä¸ºä½•æ¯” Object.assign å¥½</h3><p>åè€…è¿˜ä¼šå†æ¬¡åšä¸ªå¼•ç”¨è¿æ¥ï¼Œå¯¹äºå¤§æ•°æ®å¯¹è±¡ï¼Œå¼•ç”¨è¿æ¥ä¹Ÿæ˜¯æœ‰è€—æ—¶çš„</p>
<p>å¦‚æœæ˜¯åŸºæœ¬ç±»å‹ï¼Œè¿˜ä¼šé‡æ–°èµ‹å€¼ï¼Œä¹Ÿæœ‰è€—æ—¶</p>
<p>è€Œ immutable ä¹Ÿä¼šå¯¹æœªå˜åŠ¨èŠ‚ç‚¹åšå¼•ç”¨é“¾æ¥ï¼Œä½†æ˜¯ç”±äºè®¾ç½®äº† 32 çš„å®½åº¦ï¼Œå¯ä»¥å‡å°‘å¾ˆå¤šå¼•ç”¨</p>
<h2 id="å±•æœ›"><a href="#å±•æœ›" class="headerlink" title="å±•æœ›"></a>å±•æœ›</h2><h3 id="åˆ©ç”¨-proxy-é‡å†™-immutable"><a href="#åˆ©ç”¨-proxy-é‡å†™-immutable" class="headerlink" title="åˆ©ç”¨ proxy é‡å†™ immutable"></a>åˆ©ç”¨ proxy é‡å†™ immutable</h3><p>åœ¨çœ‹è¿‡ seamless-immutable çš„ç”¨æ³•ï¼Œæ˜¯å¦å¯ä»¥ç”¨ Proxy è®©ç”¨æ³•æ›´æ¥è¿‘åŸç”Ÿï¼Ÿ</p>
<p>å¤šä¸ªå±æ€§èµ‹å€¼çš„è¯å¯ä»¥å…ˆå¼€å¯æŸä¸ªæ ‡è®°</p>
<h2 id="æ‹“å±•é˜…è¯»"><a href="#æ‹“å±•é˜…è¯»" class="headerlink" title="æ‹“å±•é˜…è¯»"></a>æ‹“å±•é˜…è¯»</h2><ol>
<li><a href="https://github.com/dt-fe/weekly/issues/14" target="_blank" rel="noopener">Immutable ç»“æ„å…±äº«æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/27133830" target="_blank" rel="noopener">ç²¾è¯» Immutable ç»“æ„å…±äº«</a></li>
<li><a href="https://io-meter.com/2016/09/03/Functional-Go-persist-datastructure-intro/" target="_blank" rel="noopener">Functional Go: æŒä¹…åŒ–æ•°æ®ç»“æ„ç®€ä»‹</a></li>
<li><a href="https://medium.com/@dtinth/immutable-js-persistent-data-structures-and-structural-sharing-6d163fbd73d2" target="_blank" rel="noopener">Immutable.js, persistent data structures and structural sharing</a></li>
<li><a href="https://www.slideshare.net/mohitthatte/a-deep-dive-into-clojures-data-structures-euroclojure-2015" target="_blank" rel="noopener">PPT: A deep dive into Clojureâ€™s data structures - EuroClojure 2015</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/20295971" target="_blank" rel="noopener">Immutable è¯¦è§£åŠ React ä¸­å®è·µ</a></li>
<li><a href="https://idea.popcount.org/2012-07-25-introduction-to-hamt/" target="_blank" rel="noopener">Introduction to HAMT</a></li>
<li>ã€èã€‘<a href="https://juejin.im/post/5ba4a6b75188255ca1537b19" target="_blank" rel="noopener">æ·±å…¥æ¢ç©¶immutable.jsçš„å®ç°æœºåˆ¶ï¼ˆäºŒï¼‰</a></li>
</ol>
]]></content>
      <categories>
        <category>å¤§å‰ç«¯</category>
      </categories>
      <tags>
        <tag>éšç¬”</tag>
      </tags>
  </entry>
  <entry>
    <title>æµ…è°ˆ Canvas æ€§èƒ½åˆ†æä¸æ¸²æŸ“ä¼˜åŒ–</title>
    <url>/2020/03/16/2020/%E6%B5%85%E8%B0%88%20Canvas%20%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90%E4%B8%8E%E6%B8%B2%E6%9F%93%E4%BC%98%E5%8C%96/</url>
    <content><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>æ¥ä¸Šæ–‡ <a href="https://juejin.im/post/5e64f811e51d4526e807fefa" target="_blank" rel="noopener">é¢è¯•å®˜é—®ï¼šä»€ä¹ˆæ˜¯ canvas æ±¡æŸ“</a></p>
<p>æœ¬æ–‡ä»…è®¨è®º Canvas 2D</p>
<a id="more"></a>

<p>ç½‘ä¸Šè¿™ç±»çš„æ–‡ç« å·²ç»å¾ˆå¤šäº†ï¼Œæœ¬æ–‡ä»…ä»…æ˜¯ä¸€ä¸ªè®°å½•ä¸æ€»ç»“ã€‚</p>
<p>æ¨èæ–‡æœ«çš„æ‹“å±•é˜…è¯»</p>
<h1 id="æ€§èƒ½åˆ†æ"><a href="#æ€§èƒ½åˆ†æ" class="headerlink" title="æ€§èƒ½åˆ†æ"></a>æ€§èƒ½åˆ†æ</h1><p><a href="https://html.spec.whatwg.org/multipage/canvas.html#the-canvas-element" target="_blank" rel="noopener">Canvas è§„èŒƒ</a></p>
<p>æ¸²æŸ“ä¹Ÿæ˜¯åœ¨ UI Render ä¸­è¿›è¡Œ</p>
<p>context æ˜¯ä¸€ä¸ªçŠ¶æ€æ ˆ</p>
<p>çŠ¶æ€åŒ…æ‹¬</p>
<ul>
<li>å½“å‰åº”ç”¨çš„å˜å½¢</li>
<li>strokeStyle, fillStyle, globalAlpha, lineWidth, lineCap, lineJoin, miterLimit, shadowOffsetX, shadowOffsetY, shadowBlur, shadowColor, globalCompositeOperation çš„å€¼</li>
<li>å½“å‰çš„è£åˆ‡è·¯å¾„ï¼ˆclipping pathï¼‰</li>
</ul>
<h1 id="ä¼˜åŒ–ç­–ç•¥"><a href="#ä¼˜åŒ–ç­–ç•¥" class="headerlink" title="ä¼˜åŒ–ç­–ç•¥"></a>ä¼˜åŒ–ç­–ç•¥</h1><h2 id="åˆ†å±‚ç»˜åˆ¶"><a href="#åˆ†å±‚ç»˜åˆ¶" class="headerlink" title="åˆ†å±‚ç»˜åˆ¶"></a>åˆ†å±‚ç»˜åˆ¶</h2><p>å•ä¸€æ¸…é™¤ç­–ç•¥ï¼Œé€‚åˆåŒå±‚ç‰©ä½“çŸ©å½¢æ¡†ä¸é‡å çš„æƒ…å†µ</p>
<p>å¦‚æœåŒå±‚2ä¸ªç‰©ä½“é‡å ï¼Œä¸Šä¸€ç­–ç•¥åœ¨æ¸…é™¤æ—¶ä¼šæ¸…æ‰å¦ä¸€ç‰©ä½“çš„éƒ¨åˆ†åƒç´ ã€‚</p>
<p>æ­¤æ—¶åº”è¯¥åˆ¤æ–­ä¸¤è€…æ˜¯å¦é‡å ï¼Œè‹¥é‡å ä¸¤è€…åˆå¹¶å¾—åˆ°ä¸€ä¸ªè„çŸ©å½¢ï¼Œæ¸…ç©ºè„çŸ©å½¢ï¼Œå¹¶é‡ç»˜ä¸¤ä¸ªç‰©ä½“</p>
<p>æ›´å…·ä½“çš„ç»†èŠ‚å¯ä»¥æŸ¥çœ‹ <a href="https://www.ibm.com/developerworks/cn/web/wa-canvashtml5layering/index.html" target="_blank" rel="noopener">åˆ©ç”¨åˆ†å±‚ä¼˜åŒ– HTML5 ç”»å¸ƒæ¸²æŸ“</a></p>
<h2 id="é€šè¿‡è®¡ç®—é¿å…æ— æ•ˆç»˜åˆ¶"><a href="#é€šè¿‡è®¡ç®—é¿å…æ— æ•ˆç»˜åˆ¶" class="headerlink" title="é€šè¿‡è®¡ç®—é¿å…æ— æ•ˆç»˜åˆ¶"></a>é€šè¿‡è®¡ç®—é¿å…æ— æ•ˆç»˜åˆ¶</h2><p>é€šè¿‡è®¡ç®—åˆ¤æ–­æ‰€ç»˜åˆ¶å…ƒç´ å¯è§ä¸å¦ï¼Œæ˜¯å¦éœ€è¦ç»˜åˆ¶</p>
<p>è®¡ç®—æ€§èƒ½ä¸æ¸²æŸ“æ€§èƒ½çš„å¹³è¡¡</p>
<h2 id="ç¦»å±ç»˜åˆ¶"><a href="#ç¦»å±ç»˜åˆ¶" class="headerlink" title="ç¦»å±ç»˜åˆ¶"></a>ç¦»å±ç»˜åˆ¶</h2><p>å°†å¸¸ç”¨å›¾åƒç»˜åˆ¶åœ¨å¦ä¸€ä¸ª canvas ä¸­</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åœ¨ç¦»å± canvas ä¸Šç»˜åˆ¶</span></span><br><span class="line"><span class="keyword">var</span> canvasOffscreen = <span class="built_in">document</span>.createElement(<span class="string">'canvas'</span>);</span><br><span class="line">canvasOffscreen.width = dw;</span><br><span class="line">canvasOffscreen.height = dh;</span><br><span class="line">canvasOffscreen.getContext(<span class="string">'2d'</span>).drawImage(image, sx, sy, sw, sh, dx, dy, dw, dh);</span><br><span class="line"></span><br><span class="line"><span class="comment">// åœ¨ç»˜åˆ¶æ¯ä¸€å¸§çš„æ—¶å€™ï¼Œç»˜åˆ¶è¿™ä¸ªå›¾å½¢</span></span><br><span class="line">context.drawImage(canvasOffscreen, x, y);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>æ‘˜è‡ª ã€ŠCanvas æœ€ä½³å®è·µï¼ˆæ€§èƒ½ç¯‡ï¼‰ã€‹</p>
</blockquote>
<p>è¿˜å¯ä»¥å€ŸåŠ© worker è¿›è¡Œä¼˜åŒ–</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// main.js</span></span><br><span class="line"><span class="keyword">const</span> offscreenCanvas = <span class="built_in">document</span>.getElementById(<span class="string">"c"</span>).transferControlToOffscreen();</span><br><span class="line">worker.postMessage(offscreenCanvas, [offscreenCanvas]);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// worker.js </span></span><br><span class="line"><span class="keyword">let</span> ctx, pos = <span class="number">0</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">draw</span>(<span class="params">dt</span>) </span>&#123;</span><br><span class="line">  ctx.clearRect(<span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">100</span>);</span><br><span class="line">  ctx.fillRect(pos, <span class="number">0</span>, <span class="number">10</span>, <span class="number">10</span>);</span><br><span class="line">  pos += <span class="number">10</span> * dt;</span><br><span class="line">  requestAnimationFrame(draw);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">self.onmessage = <span class="function"><span class="keyword">function</span>(<span class="params">ev</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> transferredCanvas = ev.data;</span><br><span class="line">  ctx = transferredCanvas.getContext(<span class="string">"2d"</span>);</span><br><span class="line">  draw();</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>å¼•è‡ª <a href="https://html.spec.whatwg.org/multipage/imagebitmap-and-animations.html#animation-frames" target="_blank" rel="noopener">https://html.spec.whatwg.org/multipage/imagebitmap-and-animations.html#animation-frames</a></p>
</blockquote>
<h2 id="åˆç†ä½¿ç”¨-API"><a href="#åˆç†ä½¿ç”¨-API" class="headerlink" title="åˆç†ä½¿ç”¨ API"></a>åˆç†ä½¿ç”¨ API</h2><p>å‡å°‘è€—æ—¶ api çš„ä½¿ç”¨</p>
<p>å‡å°‘æ”¹å˜ context çš„çŠ¶æ€</p>
<p>é¿å…éæ³•èµ‹å€¼</p>
<h2 id="å¯äº¤äº’ç”»å¸ƒ"><a href="#å¯äº¤äº’ç”»å¸ƒ" class="headerlink" title="å¯äº¤äº’ç”»å¸ƒ"></a>å¯äº¤äº’ç”»å¸ƒ</h2><h3 id="åˆ¤æ–­ç‚¹çš„ä½ç½®"><a href="#åˆ¤æ–­ç‚¹çš„ä½ç½®" class="headerlink" title="åˆ¤æ–­ç‚¹çš„ä½ç½®"></a>åˆ¤æ–­ç‚¹çš„ä½ç½®</h3><p><code>ctx.isPointInPath</code></p>
<p>ä½¿ç”¨ isPointinPath æ–¹æ³•æ£€æŸ¥æŸç‚¹æ˜¯å¦åœ¨å½“å‰è·¯å¾„ path (Path2D) å†…</p>
<p>ä½†å¾ˆå¤šæƒ…å†µä¸‹æˆ‘ä»¬æ²¡æœ‰ä¿å­˜è¿™ä¸ª path ï¼Œæ­¤æ—¶è‡ªå·±é‡‡ç”¨å°„çº¿æ³•è®¡ç®—åˆ¤æ–­</p>
<h3 id="è·å–ç‚¹å‡»åŒºåŸŸ"><a href="#è·å–ç‚¹å‡»åŒºåŸŸ" class="headerlink" title="è·å–ç‚¹å‡»åŒºåŸŸ"></a>è·å–ç‚¹å‡»åŒºåŸŸ</h3><p>addHitRegion</p>
<p>æœ‰å…¼å®¹æ€§é—®é¢˜ï¼Œ Safari ç­‰ä¸æ”¯æŒ</p>
<h3 id="é¿å…ä½¿ç”¨-canvas-å®ç°æ–‡æœ¬ç¼–è¾‘æ§ä»¶"><a href="#é¿å…ä½¿ç”¨-canvas-å®ç°æ–‡æœ¬ç¼–è¾‘æ§ä»¶" class="headerlink" title="é¿å…ä½¿ç”¨ canvas å®ç°æ–‡æœ¬ç¼–è¾‘æ§ä»¶"></a>é¿å…ä½¿ç”¨ canvas å®ç°æ–‡æœ¬ç¼–è¾‘æ§ä»¶</h3><p>è¿™ä¸ªä¸ç”¨è¯´äº†ï¼Œ canvas éš¾ä»¥å®ç°</p>
<p>å‚ç…§ <a href="https://html.spec.whatwg.org/multipage/canvas.html#best-practices" target="_blank" rel="noopener">Best practices</a></p>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><ol>
<li>å°†æ¸²æŸ“å¼€é”€è½¬å«åˆ°è®¡ç®—å¼€é”€</li>
<li>åˆ©ç”¨åˆ†å±‚æ¸²æŸ“å¤æ‚åœºæ™¯</li>
<li>å›ºå®šå†…å®¹é‡‡ç”¨ç¦»å±æ¸²æŸ“</li>
<li>åˆç†ä½¿ç”¨ API å¹¶ç®¡ç†çŠ¶æ€</li>
</ol>
<h1 id="æ‹“å±•é˜…è¯»"><a href="#æ‹“å±•é˜…è¯»" class="headerlink" title="æ‹“å±•é˜…è¯»"></a>æ‹“å±•é˜…è¯»</h1><ul>
<li><a href="https://www.ibm.com/developerworks/cn/web/wa-canvashtml5layering/index.html" target="_blank" rel="noopener">åˆ©ç”¨åˆ†å±‚ä¼˜åŒ– HTML5 ç”»å¸ƒæ¸²æŸ“</a></li>
<li><a href="https://fed.taobao.org/blog/taofed/do71ct/canvas-performance/" target="_blank" rel="noopener">Canvas æœ€ä½³å®è·µï¼ˆæ€§èƒ½ç¯‡ï¼‰</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Canvas_API/Tutorial/Optimizing_canvas" target="_blank" rel="noopener">canvasçš„ä¼˜åŒ–</a></li>
</ul>
]]></content>
      <categories>
        <category>å¤§å‰ç«¯</category>
      </categories>
      <tags>
        <tag>Canvas</tag>
      </tags>
  </entry>
  <entry>
    <title>WebGL çŸ©é˜µå¤„ç†</title>
    <url>/2020/03/11/WebGL/WebGL%20%E7%9F%A9%E9%98%B5%E5%A4%84%E7%90%86/</url>
    <content><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>é€šè¿‡æœ¬æ–‡ï¼Œå¯ä»¥äº†è§£ WebGL ä¸­å¹³ç§»ã€æ—‹è½¬ã€ç¼©æ”¾ã€è§†è§’çš„çŸ©é˜µè¿ç®—ï¼Œæœ€ç»ˆå®ç°ä¸€ä¸ªç«‹æ–¹ä½“å˜æ¢çš„æ•ˆæœ</p>
<a id="more"></a>

<h1 id="æ„å»ºç«‹æ–¹ä½“"><a href="#æ„å»ºç«‹æ–¹ä½“" class="headerlink" title="æ„å»ºç«‹æ–¹ä½“"></a>æ„å»ºç«‹æ–¹ä½“</h1><p>å…ˆç»˜åˆ¶ä¸€ä¸ªåŸºç¡€çš„ç«‹æ–¹ä½“</p>
<p>é‡‡ç”¨å³æ‰‹å®šç†ç¡®å®šç¬›å¡å°”åæ ‡ç³»çš„ä½ç½®ï¼Œè§ä¸‹å›¾å³è¾¹</p>
<p><img src="https://upload-images.jianshu.io/upload_images/9277731-54d1c3d28a49ec09.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>æ‰€ä»¥æˆ‘ä»¬çš„ç«‹æ–¹ä½“é¡¶ç‚¹åæ ‡ä¸º</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">[</span><br><span class="line">  v0,v1,v2,</span><br><span class="line">  v0,v2,v3,</span><br><span class="line">  v0,v3,v4</span><br><span class="line">  ...</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>æ¯ä¸ªé¢éœ€è¦6ä¸ªé¡¶ç‚¹ï¼Œä¸€å…±éœ€è¦ä¼ å…¥ 36 ä¸ªé¡¶ç‚¹</p>
<p>æ¯ä¸ªé¢éƒ½è¦ç‹¬ç«‹æ¸²æŸ“ä¸€ä¸ªé¢œè‰²çš„è¯ï¼Œé¢œè‰²å¯å˜é‡å¯¹åº”æ¯ä¸ªé¡¶ç‚¹ï¼Œæ•…è¿™é‡Œä¹Ÿéœ€è¦ä¼ å…¥ 6 * 6 ä¸ª vec4 ç±»å‹çš„é¢œè‰²å€¼</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">[</span><br><span class="line">  c0,c1,c2,</span><br><span class="line">  c0,c2,c3,</span><br><span class="line">  c0,c3,c4</span><br><span class="line">  ...</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<blockquote>
<p>è¿™é‡Œæ˜¯ä¸æ˜¯åœ¨æƒ³ç«‹æ–¹ä½“æœ¬æ¥æ‰ 8 ä¸ªç‚¹ï¼Œæˆ‘ä»¬è¿™é‡Œå´ä¼ äº† 36ä¸ªç‚¹ã€‚</p>
</blockquote>
<p>å¯ä»¥åˆ©ç”¨ drawElements å‡å°‘<strong>å®šä¹‰</strong>çš„é¡¶ç‚¹ä¸ªæ•°</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Create a cube</span></span><br><span class="line"><span class="comment">//    v6----- v5</span></span><br><span class="line"><span class="comment">//   /|      /|</span></span><br><span class="line"><span class="comment">//  v1------v0|</span></span><br><span class="line"><span class="comment">//  | |     | |</span></span><br><span class="line"><span class="comment">//  | |v7---|-|v4</span></span><br><span class="line"><span class="comment">//  |/      |/</span></span><br><span class="line"><span class="comment">//  v2------v3</span></span><br><span class="line"><span class="keyword">var</span> vertices = <span class="keyword">new</span> <span class="built_in">Float32Array</span>([   <span class="comment">// Vertex coordinates</span></span><br><span class="line">   <span class="number">1.0</span>, <span class="number">1.0</span>, <span class="number">1.0</span>,  <span class="number">-1.0</span>, <span class="number">1.0</span>, <span class="number">1.0</span>,  <span class="number">-1.0</span>,<span class="number">-1.0</span>, <span class="number">1.0</span>,   <span class="number">1.0</span>,<span class="number">-1.0</span>, <span class="number">1.0</span>,  <span class="comment">// v0-v1-v2-v3 front</span></span><br><span class="line">   <span class="number">1.0</span>, <span class="number">1.0</span>, <span class="number">1.0</span>,   <span class="number">1.0</span>,<span class="number">-1.0</span>, <span class="number">1.0</span>,   <span class="number">1.0</span>,<span class="number">-1.0</span>,<span class="number">-1.0</span>,   <span class="number">1.0</span>, <span class="number">1.0</span>,<span class="number">-1.0</span>,  <span class="comment">// v0-v3-v4-v5 right</span></span><br><span class="line">   <span class="number">1.0</span>, <span class="number">1.0</span>, <span class="number">1.0</span>,   <span class="number">1.0</span>, <span class="number">1.0</span>,<span class="number">-1.0</span>,  <span class="number">-1.0</span>, <span class="number">1.0</span>,<span class="number">-1.0</span>,  <span class="number">-1.0</span>, <span class="number">1.0</span>, <span class="number">1.0</span>,  <span class="comment">// v0-v5-v6-v1 up</span></span><br><span class="line">  <span class="number">-1.0</span>, <span class="number">1.0</span>, <span class="number">1.0</span>,  <span class="number">-1.0</span>, <span class="number">1.0</span>,<span class="number">-1.0</span>,  <span class="number">-1.0</span>,<span class="number">-1.0</span>,<span class="number">-1.0</span>,  <span class="number">-1.0</span>,<span class="number">-1.0</span>, <span class="number">1.0</span>,  <span class="comment">// v1-v6-v7-v2 left</span></span><br><span class="line">  <span class="number">-1.0</span>,<span class="number">-1.0</span>,<span class="number">-1.0</span>,   <span class="number">1.0</span>,<span class="number">-1.0</span>,<span class="number">-1.0</span>,   <span class="number">1.0</span>,<span class="number">-1.0</span>, <span class="number">1.0</span>,  <span class="number">-1.0</span>,<span class="number">-1.0</span>, <span class="number">1.0</span>,  <span class="comment">// v7-v4-v3-v2 down</span></span><br><span class="line">   <span class="number">1.0</span>,<span class="number">-1.0</span>,<span class="number">-1.0</span>,  <span class="number">-1.0</span>,<span class="number">-1.0</span>,<span class="number">-1.0</span>,  <span class="number">-1.0</span>, <span class="number">1.0</span>,<span class="number">-1.0</span>,   <span class="number">1.0</span>, <span class="number">1.0</span>,<span class="number">-1.0</span>   <span class="comment">// v4-v7-v6-v5 back</span></span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> colors = <span class="keyword">new</span> <span class="built_in">Float32Array</span>([     <span class="comment">// Colors</span></span><br><span class="line">  <span class="number">0.4</span>, <span class="number">0.4</span>, <span class="number">1.0</span>,  <span class="number">0.4</span>, <span class="number">0.4</span>, <span class="number">1.0</span>,  <span class="number">0.4</span>, <span class="number">0.4</span>, <span class="number">1.0</span>,  <span class="number">0.4</span>, <span class="number">0.4</span>, <span class="number">1.0</span>,  <span class="comment">// v0-v1-v2-v3 front(blue)</span></span><br><span class="line">  <span class="number">0.4</span>, <span class="number">1.0</span>, <span class="number">0.4</span>,  <span class="number">0.4</span>, <span class="number">1.0</span>, <span class="number">0.4</span>,  <span class="number">0.4</span>, <span class="number">1.0</span>, <span class="number">0.4</span>,  <span class="number">0.4</span>, <span class="number">1.0</span>, <span class="number">0.4</span>,  <span class="comment">// v0-v3-v4-v5 right(green)</span></span><br><span class="line">  <span class="number">1.0</span>, <span class="number">0.4</span>, <span class="number">0.4</span>,  <span class="number">1.0</span>, <span class="number">0.4</span>, <span class="number">0.4</span>,  <span class="number">1.0</span>, <span class="number">0.4</span>, <span class="number">0.4</span>,  <span class="number">1.0</span>, <span class="number">0.4</span>, <span class="number">0.4</span>,  <span class="comment">// v0-v5-v6-v1 up(red)</span></span><br><span class="line">  <span class="number">1.0</span>, <span class="number">1.0</span>, <span class="number">0.4</span>,  <span class="number">1.0</span>, <span class="number">1.0</span>, <span class="number">0.4</span>,  <span class="number">1.0</span>, <span class="number">1.0</span>, <span class="number">0.4</span>,  <span class="number">1.0</span>, <span class="number">1.0</span>, <span class="number">0.4</span>,  <span class="comment">// v1-v6-v7-v2 left</span></span><br><span class="line">  <span class="number">1.0</span>, <span class="number">1.0</span>, <span class="number">1.0</span>,  <span class="number">1.0</span>, <span class="number">1.0</span>, <span class="number">1.0</span>,  <span class="number">1.0</span>, <span class="number">1.0</span>, <span class="number">1.0</span>,  <span class="number">1.0</span>, <span class="number">1.0</span>, <span class="number">1.0</span>,  <span class="comment">// v7-v4-v3-v2 down</span></span><br><span class="line">  <span class="number">0.4</span>, <span class="number">1.0</span>, <span class="number">1.0</span>,  <span class="number">0.4</span>, <span class="number">1.0</span>, <span class="number">1.0</span>,  <span class="number">0.4</span>, <span class="number">1.0</span>, <span class="number">1.0</span>,  <span class="number">0.4</span>, <span class="number">1.0</span>, <span class="number">1.0</span>   <span class="comment">// v4-v7-v6-v5 back</span></span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> indices = <span class="keyword">new</span> <span class="built_in">Uint8Array</span>([       <span class="comment">// Indices of the vertices</span></span><br><span class="line">   <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>,   <span class="number">0</span>, <span class="number">2</span>, <span class="number">3</span>,    <span class="comment">// front</span></span><br><span class="line">   <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>,   <span class="number">4</span>, <span class="number">6</span>, <span class="number">7</span>,    <span class="comment">// right</span></span><br><span class="line">   <span class="number">8</span>, <span class="number">9</span>,<span class="number">10</span>,   <span class="number">8</span>,<span class="number">10</span>,<span class="number">11</span>,    <span class="comment">// up</span></span><br><span class="line">  <span class="number">12</span>,<span class="number">13</span>,<span class="number">14</span>,  <span class="number">12</span>,<span class="number">14</span>,<span class="number">15</span>,    <span class="comment">// left</span></span><br><span class="line">  <span class="number">16</span>,<span class="number">17</span>,<span class="number">18</span>,  <span class="number">16</span>,<span class="number">18</span>,<span class="number">19</span>,    <span class="comment">// down</span></span><br><span class="line">  <span class="number">20</span>,<span class="number">21</span>,<span class="number">22</span>,  <span class="number">20</span>,<span class="number">22</span>,<span class="number">23</span>     <span class="comment">// back</span></span><br><span class="line">]);</span><br><span class="line"><span class="comment">// è®¾ç½® buffer ä¸ç»‘å®š</span></span><br><span class="line"></span><br><span class="line">gl.drawElements(gl.TRIANGLES, indices.length, gl.UNSIGNED_BYTE, <span class="number">0</span>);</span><br></pre></td></tr></table></figure>

<p>è‹¥åªé‡‡ç”¨ 8 ä¸ªé¡¶ç‚¹å‘¢ï¼Ÿ</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">  <span class="comment">// Create a cube</span></span><br><span class="line">  <span class="comment">//    v6----- v5</span></span><br><span class="line">  <span class="comment">//   /|      /|</span></span><br><span class="line">  <span class="comment">//  v1------v0|</span></span><br><span class="line">  <span class="comment">//  | |     | |</span></span><br><span class="line">  <span class="comment">//  | |v7---|-|v4</span></span><br><span class="line">  <span class="comment">//  |/      |/</span></span><br><span class="line">  <span class="comment">//  v2------v3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> vertices = <span class="keyword">new</span> <span class="built_in">Float32Array</span>([</span><br><span class="line">  <span class="comment">// v0-v1-v2-v3 front</span></span><br><span class="line">  <span class="number">1.0</span>, <span class="number">1.0</span>, <span class="number">1.0</span>,  <span class="number">-1.0</span>, <span class="number">1.0</span>, <span class="number">1.0</span>,  <span class="number">-1.0</span>,<span class="number">-1.0</span>, <span class="number">1.0</span>,   <span class="number">1.0</span>,<span class="number">-1.0</span>, <span class="number">1.0</span>,    </span><br><span class="line">  <span class="comment">// v4-v7-v6-v5 back</span></span><br><span class="line">  <span class="number">1.0</span>,<span class="number">-1.0</span>,<span class="number">-1.0</span>,  <span class="number">-1.0</span>,<span class="number">-1.0</span>,<span class="number">-1.0</span>,  <span class="number">-1.0</span>, <span class="number">1.0</span>,<span class="number">-1.0</span>,   <span class="number">1.0</span>, <span class="number">1.0</span>,<span class="number">-1.0</span>     </span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// colors ä¸å˜</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰ç»˜åˆ¶æ—¶é¡¶ç‚¹çš„ç´¢å¼•</span></span><br><span class="line"><span class="keyword">var</span> indices = <span class="keyword">new</span> <span class="built_in">Uint8Array</span>([</span><br><span class="line">  <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>,   <span class="number">0</span>, <span class="number">2</span>, <span class="number">3</span>,    <span class="comment">// front</span></span><br><span class="line">  <span class="number">0</span>, <span class="number">3</span>, <span class="number">4</span>,   <span class="number">0</span>, <span class="number">4</span>, <span class="number">7</span>,    <span class="comment">// right</span></span><br><span class="line">  <span class="number">0</span>, <span class="number">7</span>, <span class="number">6</span>,   <span class="number">0</span>, <span class="number">6</span>, <span class="number">1</span>,    <span class="comment">// up</span></span><br><span class="line">  <span class="number">1</span>, <span class="number">6</span>, <span class="number">5</span>,   <span class="number">1</span>, <span class="number">5</span>, <span class="number">2</span>,    <span class="comment">// left</span></span><br><span class="line">  <span class="number">6</span>, <span class="number">4</span>, <span class="number">3</span>,   <span class="number">6</span>, <span class="number">3</span>, <span class="number">3</span>,    <span class="comment">// down</span></span><br><span class="line">  <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>,   <span class="number">4</span>, <span class="number">6</span>, <span class="number">7</span>     <span class="comment">// back</span></span><br><span class="line">]);</span><br></pre></td></tr></table></figure>

<p>ä¼šå‘ç°è¯¥ç«‹æ–¹ä½“åªæœ‰ä¸¤ä¸ªé¢œè‰² blue å’Œ green ä»¥åŠé¢œè‰²æ’å€¼</p>
<p>è¿™æ˜¯ç”±äºå…±ç”¨é¡¶ç‚¹å¯¼è‡´çš„ï¼Œæ‰€ä»¥å¦‚æœåŒä¸€é¡¶ç‚¹æœ‰å‚ä¸å¤šæ¬¡ä¸åŒå¤šä¸ªé¢œè‰²ç‰‡å…ƒå¤„ç†çš„è¯ï¼Œä¸èƒ½å…±ç”¨ã€‚</p>
<p>ç€è‰²å™¨ä»£ç </p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> vertexShaderSource = <span class="string">`</span></span><br><span class="line"><span class="string">  attribute vec4 aVertexPosition;</span></span><br><span class="line"><span class="string">  attribute vec4 aVertexColor;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  varying lowp vec4 vColor;</span></span><br><span class="line"><span class="string">  void main(void) &#123;</span></span><br><span class="line"><span class="string">    gl_Position = aVertexPosition;</span></span><br><span class="line"><span class="string">    vColor = aVertexColor;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">`</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> fragmentShaderSource = <span class="string">`</span></span><br><span class="line"><span class="string">  varying lowp vec4 vColor;</span></span><br><span class="line"><span class="string">  void main(void) &#123;</span></span><br><span class="line"><span class="string">    gl_FragColor = vColor;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">`</span></span><br></pre></td></tr></table></figure>

<p>æœ€åæ¸²æŸ“å‡ºæ¥çš„è¯ï¼Œæˆ‘ä»¬åªèƒ½çœ‹åˆ°èƒŒé¢ä¸€é¢</p>
<p>è¿™æ˜¯ç”±äºè§†è§’çš„åŸå› ï¼Œä¸‹æ–‡å°†æè¿°å¦‚ä½•è¿›è¡ŒçŸ©é˜µå˜æ¢</p>
<h1 id="çŸ©é˜µè¿ç®—"><a href="#çŸ©é˜µè¿ç®—" class="headerlink" title="çŸ©é˜µè¿ç®—"></a>çŸ©é˜µè¿ç®—</h1><p>ä¸»è¦åˆ†ä¸ºæ¨¡å‹çŸ©é˜µ(moel)ã€è§†å›¾çŸ©é˜µ(view)ã€æŠ•å½±çŸ©é˜µ(projection)</p>
<p>å…¶ä¸­<strong>æ¨¡å‹çŸ©é˜µ</strong>è¡¨ç¤ºå¯¹è§‚å¯Ÿç›®æ ‡çš„ç»„åˆå˜æ¢ï¼ŒåŒ…æ‹¬æ—‹è½¬ã€å¹³ç§»ã€ç¼©æ”¾</p>
<p>å…ˆå®šä¹‰ä¸€äº›å·¥å…·å‡½æ•°</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆ›å»º4é˜¶å•ä½çŸ©é˜µ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createMat4</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> out = <span class="keyword">new</span> <span class="built_in">Float32Array</span>(<span class="number">16</span>);</span><br><span class="line">  out[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">  out[<span class="number">5</span>] = <span class="number">1</span>;</span><br><span class="line">  out[<span class="number">10</span>] = <span class="number">1</span>;</span><br><span class="line">  out[<span class="number">15</span>] = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">return</span> out;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è·å–çŸ©é˜µ a ä¹˜ çŸ©é˜µ b çš„ç»“æœçŸ©é˜µ</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Mat4&#125;</span> </span>a </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Mat4&#125;</span> </span>b </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">multiply</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> out = <span class="keyword">new</span> <span class="built_in">Float32Array</span>(<span class="number">16</span>);</span><br><span class="line">  <span class="keyword">var</span> a00 = a[<span class="number">0</span>],</span><br><span class="line">      a01 = a[<span class="number">1</span>],</span><br><span class="line">      a02 = a[<span class="number">2</span>],</span><br><span class="line">      a03 = a[<span class="number">3</span>];</span><br><span class="line">  <span class="keyword">var</span> a10 = a[<span class="number">4</span>],</span><br><span class="line">      a11 = a[<span class="number">5</span>],</span><br><span class="line">      a12 = a[<span class="number">6</span>],</span><br><span class="line">      a13 = a[<span class="number">7</span>];</span><br><span class="line">  <span class="keyword">var</span> a20 = a[<span class="number">8</span>],</span><br><span class="line">      a21 = a[<span class="number">9</span>],</span><br><span class="line">      a22 = a[<span class="number">10</span>],</span><br><span class="line">      a23 = a[<span class="number">11</span>];</span><br><span class="line">  <span class="keyword">var</span> a30 = a[<span class="number">12</span>],</span><br><span class="line">      a31 = a[<span class="number">13</span>],</span><br><span class="line">      a32 = a[<span class="number">14</span>],</span><br><span class="line">      a33 = a[<span class="number">15</span>];</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Cache only the current line of the second matrix</span></span><br><span class="line">  <span class="keyword">var</span> b0 = b[<span class="number">0</span>],</span><br><span class="line">      b1 = b[<span class="number">1</span>],</span><br><span class="line">      b2 = b[<span class="number">2</span>],</span><br><span class="line">      b3 = b[<span class="number">3</span>];</span><br><span class="line">  out[<span class="number">0</span>] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;</span><br><span class="line">  out[<span class="number">1</span>] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;</span><br><span class="line">  out[<span class="number">2</span>] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;</span><br><span class="line">  out[<span class="number">3</span>] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;</span><br><span class="line"></span><br><span class="line">  b0 = b[<span class="number">4</span>];b1 = b[<span class="number">5</span>];b2 = b[<span class="number">6</span>];b3 = b[<span class="number">7</span>];</span><br><span class="line">  out[<span class="number">4</span>] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;</span><br><span class="line">  out[<span class="number">5</span>] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;</span><br><span class="line">  out[<span class="number">6</span>] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;</span><br><span class="line">  out[<span class="number">7</span>] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;</span><br><span class="line"></span><br><span class="line">  b0 = b[<span class="number">8</span>];b1 = b[<span class="number">9</span>];b2 = b[<span class="number">10</span>];b3 = b[<span class="number">11</span>];</span><br><span class="line">  out[<span class="number">8</span>] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;</span><br><span class="line">  out[<span class="number">9</span>] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;</span><br><span class="line">  out[<span class="number">10</span>] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;</span><br><span class="line">  out[<span class="number">11</span>] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;</span><br><span class="line"></span><br><span class="line">  b0 = b[<span class="number">12</span>];b1 = b[<span class="number">13</span>];b2 = b[<span class="number">14</span>];b3 = b[<span class="number">15</span>];</span><br><span class="line">  out[<span class="number">12</span>] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;</span><br><span class="line">  out[<span class="number">13</span>] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;</span><br><span class="line">  out[<span class="number">14</span>] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;</span><br><span class="line">  out[<span class="number">15</span>] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;</span><br><span class="line">  <span class="keyword">return</span> out;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="æ—‹è½¬"><a href="#æ—‹è½¬" class="headerlink" title="æ—‹è½¬"></a>æ—‹è½¬</h2><p>ç»• z è½´æ—‹è½¬ï¼Œä¿®æ”¹çš„æ˜¯ x,y çš„åæ ‡ï¼Œå¯ä»¥ç†è§£ä¸ºæ¯ä¸ª xy å¹³é¢éƒ½åœ¨ç»• xy è½´åŸç‚¹æ—‹è½¬</p>
<p>b ä¸ºé€†æ—¶é’ˆæ—‹è½¬çš„å¼§åº¦</p>
<blockquote>
<p>ä½ å¯èƒ½ä¼šçœ‹åˆ°æœ‰äº›æ•™ç¨‹ä¸­çš„è¿ç®—çŸ©é˜µä¸å¤ªä¸€æ ·ï¼Œé‚£å°±æ˜¯ b å–çš„é¡ºæ—¶é’ˆæ—‹è½¬å¼§åº¦ã€‚å› ä¸º <code>sin-b = -sinb; cos-b = cos b</code></p>
</blockquote>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// x' = x cosb - y sinb</span></span><br><span class="line"><span class="comment">// y' = x sinb + y cosb</span></span><br><span class="line"><span class="comment">// z' = z</span></span><br><span class="line">attribute vec4 a_Position;</span><br><span class="line">uniform <span class="keyword">float</span> u_CosB,u_SinB;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  gl_Position.x = a_Position.x * u_CosB - a_Position.y * u_SinB;</span><br><span class="line">  gl_Position.y = a_Position.x * u_SinB + a_Position.y * u_CosB;</span><br><span class="line">  gl_Position.z = a_Position.z;</span><br><span class="line">  gl_Position.w = <span class="number">1.0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åŒ–ä¸ºçŸ©é˜µè¿ç®—ä¸º(è¿™é‡Œè¡¥é½ä¸º4é˜¶çŸ©é˜µæ˜¯ä¸ºäº†æ–¹ä¾¿åé¢åŒé˜¶çŸ©é˜µçš„è¿ç®—)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[ x&#39; ]   [ cosb -sinb 0  0 ]   [ x ]    [ x * cosb - y * sinb ]</span><br><span class="line">[ y&#39; ] &#x3D; [ sinb  cosb 0  0 ] x [ y ] &#x3D;  [ x * sinb + y * cosb ]</span><br><span class="line">[ z&#39; ]   [   0    0   1  0 ]   [ z ]    [          z          ]</span><br><span class="line">[ 1  ]   [   0    0   0  1 ]   [ 1 ]    [          1          ]</span><br></pre></td></tr></table></figure>

<p>é‡‡ç”¨çš„è¿™ä¸ªçŸ©é˜µç§°ä¸ºæ—‹è½¬çŸ©é˜µ</p>
<p>ç±»ä¼¼çš„ï¼Œç»• x è½´æ—‹è½¬çš„è¯ï¼Œåˆ©ç”¨å³æ‰‹å®šç†ï¼ˆç¿»è½¬åæ ‡ç³»ï¼Œxè½´æŒ‡å‘è‡ªå·±ï¼‰ï¼Œç›¸æ¯”ç»•zè½´ï¼Œå…¶å® z ç›¸å½“äºåˆšåˆšçš„ y ï¼Œy ç›¸å½“äº x ï¼Œæ•…æ—‹è½¬çŸ©é˜µä¸º</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[ x&#39; ]   [  1   0    0   0 ]   [ x ]    [         x           ]</span><br><span class="line">[ y&#39; ] &#x3D; [  0 cosb -sinb 0 ] x [ y ] &#x3D;  [ y * cosb - z * sinb ]</span><br><span class="line">[ z&#39; ]   [  0 sinb  cosb 0 ]   [ z ]    [ y * sinb + z * cosb ]</span><br><span class="line">[ 1  ]   [  0   0    0   1 ]   [ 1 ]    [          1          ]</span><br></pre></td></tr></table></figure>

<p>ç»• y è½´æ—‹è½¬çš„è¯ï¼Œæ—‹è½¬çŸ©é˜µä¸º</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[ x&#39; ]   [  cosb 0  sinb 0 ]   [ x ]    [ x * cosb + z * sinb ]</span><br><span class="line">[ y&#39; ] &#x3D; [   0   1   0   0 ] x [ y ] &#x3D;  [        y            ]</span><br><span class="line">[ z&#39; ]   [ -sinb 0  cosb 0 ]   [ z ]    [ z * cosb - x * sinb ]</span><br><span class="line">[ 1  ]   [   0   0   0   1 ]   [ 1 ]    [          1          ]</span><br></pre></td></tr></table></figure>


<p>é¡¶ç‚¹ç€è‰²å™¨ä¸­ä¿®æ”¹å¦‚ä¸‹å³å¯</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">attribute vec4 a_Position;</span><br><span class="line">uniform mat4 u_xformMatrix;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  gl_Position = u_xformMatrix * a_Position;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å·¥å…·å‡½æ•°å¦‚ä¸‹</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æŒ‰ x è½´æ—‹è½¬çš„å˜æ¢çŸ©é˜µ</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Number&#125;</span> </span>angleInRadians é€†æ—¶é’ˆæ—‹è½¬çš„å¼§åº¦</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">rotateX</span> (<span class="params">angleInRadians</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> c = <span class="built_in">Math</span>.cos(angleInRadians);</span><br><span class="line">  <span class="keyword">let</span> s = <span class="built_in">Math</span>.sin(angleInRadians);</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Float32Array</span>([</span><br><span class="line">    <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">    <span class="number">0</span>, c, -s, <span class="number">0</span>,</span><br><span class="line">    <span class="number">0</span>, s, c, <span class="number">0</span>,</span><br><span class="line">    <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>,</span><br><span class="line">  ]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æŒ‰ y è½´æ—‹è½¬çš„å˜æ¢çŸ©é˜µ</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Number&#125;</span> </span>angleInRadians é€†æ—¶é’ˆæ—‹è½¬çš„å¼§åº¦</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">rotateY</span> (<span class="params">angleInRadians</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> c = <span class="built_in">Math</span>.cos(angleInRadians);</span><br><span class="line">  <span class="keyword">let</span> s = <span class="built_in">Math</span>.sin(angleInRadians);</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Float32Array</span>([</span><br><span class="line">    c, <span class="number">0</span>, s, <span class="number">0</span>,</span><br><span class="line">    <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">    -s, <span class="number">0</span>, c, <span class="number">0</span>,</span><br><span class="line">    <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>,</span><br><span class="line">  ]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æŒ‰ z è½´æ—‹è½¬çš„å˜æ¢çŸ©é˜µ</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Number&#125;</span> </span>angleInRadians é€†æ—¶é’ˆæ—‹è½¬çš„å¼§åº¦</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">rotateZ</span> (<span class="params">angleInRadians</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> c = <span class="built_in">Math</span>.cos(angleInRadians);</span><br><span class="line">  <span class="keyword">let</span> s = <span class="built_in">Math</span>.sin(angleInRadians);</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Float32Array</span>([</span><br><span class="line">    c, -s, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">    s, c, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">    <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>,</span><br><span class="line">    <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>,</span><br><span class="line">  ]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="å¹³ç§»"><a href="#å¹³ç§»" class="headerlink" title="å¹³ç§»"></a>å¹³ç§»</h2><figure class="highlight c"><table><tr><td class="code"><pre><span class="line">attribute vec4 a_Position;</span><br><span class="line">uniform vec4 u_Translation;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  gl_Position = a_Position + u_Translation;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸¤ä¸ª vec4 åˆ†é‡ç›¸åŠ å³å¯ï¼Œæ³¨æ„ç¬¬äºŒä¸ªåˆ†é‡ u_Translation çš„ w ä¸º 0</p>
<p>åˆ©ç”¨çŸ©é˜µçš„è¯åˆ™å˜ä¸º</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[ x&#39; ]   [ 1 0 0 Tx ]   [ x ]    [ x + Tx ]</span><br><span class="line">[ y&#39; ] &#x3D; [ 0 1 0 Ty ] x [ y ] &#x3D;  [ y + Ty ]</span><br><span class="line">[ z&#39; ]   [ 0 0 1 Tz ]   [ z ]    [ z + Tz ]</span><br><span class="line">[ 1  ]   [ 0 0 0 1  ]   [ 1 ]    [   1    ]</span><br></pre></td></tr></table></figure>

<p>è¯¥çŸ©é˜µç§°ä¸ºå¹³ç§»çŸ©é˜µ</p>
<p>çŸ©é˜µåœ¨ js ä¸­åˆ©ç”¨ç±»å‹åŒ–æ•°ç»„ï¼Œå¹¶é‡‡ç”¨åˆ—ä¸»åºè¡¨ç¤ºï¼Œæ¯”å¦‚ä¸Šé¢è¿™ä¸ªå¹³ç§»çŸ©é˜µåœ¨ js ä¸­è¡¨ç¤ºä¸º</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="built_in">Float32Array</span>([</span><br><span class="line">  <span class="number">1.0</span>,<span class="number">0.0</span>,<span class="number">0.0</span>,<span class="number">0.0</span>,</span><br><span class="line">  <span class="number">0.0</span>,<span class="number">1.0</span>,<span class="number">0.0</span>,<span class="number">0.0</span>,</span><br><span class="line">  <span class="number">0.0</span>,<span class="number">0.0</span>,<span class="number">1.0</span>,<span class="number">0.0</span>,</span><br><span class="line">  Tx, Ty, Tz, <span class="number">1.0</span></span><br><span class="line">])</span><br></pre></td></tr></table></figure>

<p>å·¥å…·å‡½æ•°å¦‚ä¸‹</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç”Ÿæˆå¹³ç§»çŸ©é˜µ</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Number&#125;</span> </span>tx x è½´æ–¹å‘çš„åç§»é‡</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Number&#125;</span> </span>ty y è½´æ–¹å‘çš„åç§»é‡</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Number&#125;</span> </span>tz z è½´æ–¹å‘çš„åç§»é‡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">translation</span> (<span class="params">tx, ty, tz</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Float32Array</span>([</span><br><span class="line">    <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">    <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">    <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>,</span><br><span class="line">    tx, ty, tz, <span class="number">1</span>,</span><br><span class="line">  ]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ç¼©æ”¾"><a href="#ç¼©æ”¾" class="headerlink" title="ç¼©æ”¾"></a>ç¼©æ”¾</h2><p>x,y,z æŒ‰ä¸‰ä¸ªæ–¹å‘è¿›è¡Œç¼©æ”¾ï¼Œç¼©æ”¾å› å­åˆ†åˆ«ä¸º Sx,Sy,Sz </p>
<p>å¯¹åº”çš„ç¼©æ”¾çŸ©é˜µä¸º</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[ x&#39; ]   [ Sx 0  0 0 ]   [ x ]    [ x * Sx ]</span><br><span class="line">[ y&#39; ] &#x3D; [ 0  Sy 0 0 ] x [ y ] &#x3D;  [ y * Sy ]</span><br><span class="line">[ z&#39; ]   [ 0  0 Sz 0 ]   [ z ]    [ z * Sz ]</span><br><span class="line">[ 1  ]   [ 0  0  0 1 ]   [ 1 ]    [   1    ]</span><br></pre></td></tr></table></figure>
<p>å·¥å…·å‡½æ•°å¦‚ä¸‹</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç”Ÿæˆç¼©æ”¾çŸ©é˜µ</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Number&#125;</span> </span>sx x è½´æ–¹å‘çš„ç¼©æ”¾å€¼</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Number&#125;</span> </span>sy y è½´æ–¹å‘çš„ç¼©æ”¾å€¼</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Number&#125;</span> </span>sz z è½´æ–¹å‘çš„ç¼©æ”¾å€¼</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">scaling</span> (<span class="params">sx, sy, sz</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Float32Array</span>([</span><br><span class="line">    sx, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">    <span class="number">0</span>, sy, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">    <span class="number">0</span>, <span class="number">0</span>, sz, <span class="number">0</span>,</span><br><span class="line">    <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>,</span><br><span class="line">  ]);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="è§†å›¾"><a href="#è§†å›¾" class="headerlink" title="è§†å›¾"></a>è§†å›¾</h2><p>åœ¨ä¸‰ç»´ç©ºé—´ä¸­ï¼Œè§†è§’ä¹Ÿæ˜¯ä¸€ä¸ªé‡è¦çš„è¦ç´ ï¼Œå†³å®šæˆ‘ä»¬ä»¥å“ªä¸ªæ–¹å‘è§‚å¯Ÿç›®æ ‡</p>
<p><img src="https://upload-images.jianshu.io/upload_images/9277731-8de1b2a4d7385949.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å¼•è‡ªã€Šäº¤äº’å¼è®¡ç®—æœºå›¾å½¢å­¦ã€‹"></p>
<p>è§†è§’ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼š</p>
<ul>
<li>è§†ç‚¹ï¼šè§†çº¿èµ·ç‚¹ï¼Œè§‚å¯Ÿè€…ï¼ˆç›¸æœºï¼‰æ‰€åœ¨ä½ç½®ï¼Œ(eyeX,eyeY,eyeZ)</li>
<li>è§‚å¯Ÿç›®æ ‡ç‚¹ï¼šè¢«è§‚å¯Ÿç›®æ ‡ç‚¹ï¼Œè§†ç‚¹é€è¿‡è§‚å¯Ÿç›®æ ‡ç‚¹å½¢æˆè§†çº¿ï¼Œ(atX,atY,atZ)</li>
<li>ä¸Šæ–¹å‘ï¼šæœ€ç»ˆç»˜åˆ¶åœ¨å±å¹•ä¸­çš„å½±åƒçš„å‘ä¸Šæ–¹å‘ã€‚ç”±äºè§‚å¯Ÿè€…å¯èƒ½ä»¥è§†çº¿ä¸ºè½´æ—‹è½¬ï¼Œæ•…è¿˜éœ€è¦ä¸Šæ–¹å‘å›ºå®šè§†è§’ã€‚å‘é‡ (upX,upY,upZ)</li>
</ul>
<p>é»˜è®¤è§†è§’ä¸º z è½´è´ŸåŠè½´ï¼Œå³æŒ‡å‘å±å¹•å†…éƒ¨ã€‚å…¶ä¸­</p>
<ul>
<li>è§†ç‚¹ï¼šä½äºåæ ‡åŸç‚¹ (0,0,0)</li>
<li>è§‚å¯Ÿç›®æ ‡ç‚¹: è§†çº¿ä¸ºZè½´è´Ÿæ–¹å‘ï¼Œå› æ­¤è§‚å¯Ÿç›®æ ‡ç‚¹ä¸º <code>(0,0,z) z &lt; 0</code></li>
<li>ä¸Šæ–¹å‘ï¼šY è½´æ­£æ–¹å‘ (0,1,0)</li>
</ul>
<p>ä¸‰è€…çš„ä¿¡æ¯æ„æˆä¸€ä¸ªè§†å›¾çŸ©é˜µï¼Œç”¨äºä¸–ç•Œç©ºé—´åˆ°è§†å›¾ç©ºé—´çš„è½¬æ¢ï¼Œé‚£è§†å›¾çŸ©é˜µå¦‚ä½•ç¡®å®šï¼Ÿ</p>
<h3 id="ä¸€ã€-æ„å»ºç›¸æœºç©ºé—´åæ ‡ç³»"><a href="#ä¸€ã€-æ„å»ºç›¸æœºç©ºé—´åæ ‡ç³»" class="headerlink" title="ä¸€ã€ æ„å»ºç›¸æœºç©ºé—´åæ ‡ç³»"></a>ä¸€ã€ æ„å»ºç›¸æœºç©ºé—´åæ ‡ç³»</h3><ol>
<li><p>æ ¹æ® at å’Œ eye ä¸¤ç‚¹ç¡®å®šè§†çº¿ forward åŸºå‘é‡</p>
<p> é¦–å…ˆè®¡ç®—è§†çº¿æ–¹å‘ <code>forwrad =(at-eye)</code> <br> å¹¶å½’ä¸€åŒ– <code>forward=forward/|forwrad|</code></p>
</li>
</ol>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">fx = centerX - eyeX;</span><br><span class="line">fy = centerY - eyeY;</span><br><span class="line">fz = centerZ - eyeZ;</span><br><span class="line"></span><br><span class="line">rlf = <span class="number">1</span> / <span class="built_in">Math</span>.sqrt(fx*fx + fy*fy + fz*fz);</span><br><span class="line">fx *= rlf;</span><br><span class="line">fy *= rlf;</span><br><span class="line">fz *= rlf;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><p>æ ¹æ® up å‘é‡å’Œ forward ç¡®å®šç›¸æœºçš„ side åŸºå‘é‡\</p>
<p> æ–¹å‘æ ¹æ®å³æ‰‹å®šåˆ™ç¡®å®šï¼Œå‚ç›´äºä¸¤ä¸ªå‘é‡æ„å»ºçš„é¢</p>
<p> å½’ä¸€åŒ– up å‘é‡ï¼š <code>up=up/|up|</code>ï¼›å‰ç§¯ï¼š<code>side=cross(forward,up)</code> æˆ–è€…<br> å‰ç§¯ï¼š<code>side=cross(forward,up)</code>ï¼›å½’ä¸€åŒ– side å‘é‡ï¼š <code>side=side/|side|</code>ï¼›</p>
</li>
</ol>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">sx = fy * upZ - fz * upY;</span><br><span class="line">sy = fz * upX - fx * upZ;</span><br><span class="line">sz = fx * upY - fy * upX;</span><br><span class="line"></span><br><span class="line">rls = <span class="number">1</span> / <span class="built_in">Math</span>.sqrt(sx*sx + sy*sy + sz*sz);</span><br><span class="line">sx *= rls;</span><br><span class="line">sy *= rls;</span><br><span class="line">sz *= rls;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><p>æ ¹æ® forward å’Œ side è®¡ç®— up å‘é‡</p>
<p> å‰ç§¯ï¼š<code>up = cross(side,forward)</code></p>
<p> æ­¤ up å‘é‡å‚ç›´äº forward å’Œ side æ„æˆçš„å¹³é¢</p>
</li>
</ol>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">ux = sy * fz - sz * fy;</span><br><span class="line">uy = sz * fx - sx * fz;</span><br><span class="line">uz = sx * fy - sy * fx;</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·ï¼Œ eye ä½ç½®ä»¥åŠ forwardã€sideã€up ä¸‰ä¸ªåŸºå‘é‡æ„å»ºæˆä¸€ä¸ªæ–°çš„åæ ‡ç³»</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ªåæ ‡ç³»æ˜¯å·¦æ‰‹åæ ‡ç³»ï¼Œåœ¨å®é™…ä½¿ç”¨ä¸­éœ€è¦å¯¹ forward è¿›è¡Œç¿»è½¬</p>
<blockquote>
<p>side å¯¹åº” x, up å¯¹åº” y, -forward å¯¹åº” z</p>
</blockquote>
<p>åˆ©ç”¨ eye å’Œ sideã€upã€-forward æ¥æ„æˆä¸€ä¸ªå³æ‰‹åæ ‡ç³»</p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬å°†è¿›è¡Œåæ ‡è½¬æ¢ï¼Œè®¡ç®—ä¸–ç•Œåæ ‡ç³»ä¸­çš„ç‰©ä½“åœ¨ç›¸æœºåæ ‡ç³»ä¸‹çš„åæ ‡</p>
<h3 id="äºŒã€åˆ©ç”¨æ—‹è½¬å’Œå¹³ç§»çŸ©é˜µæ±‚é€†çŸ©é˜µ"><a href="#äºŒã€åˆ©ç”¨æ—‹è½¬å’Œå¹³ç§»çŸ©é˜µæ±‚é€†çŸ©é˜µ" class="headerlink" title="äºŒã€åˆ©ç”¨æ—‹è½¬å’Œå¹³ç§»çŸ©é˜µæ±‚é€†çŸ©é˜µ"></a>äºŒã€åˆ©ç”¨æ—‹è½¬å’Œå¹³ç§»çŸ©é˜µæ±‚é€†çŸ©é˜µ</h3><p>å°†ä¸–ç•Œåæ ‡ç³»æ—‹è½¬+å¹³ç§»è‡³ç›¸æœºåæ ‡ç³»é‡åˆï¼Œæ—‹è½¬ R å’Œå¹³ç§» T æ„æˆç»„åˆçŸ©é˜µ <code>M=T*R</code> </p>
<p>è¯¥å˜æ¢çŸ©é˜µå°†ç›¸æœºåæ ‡ç³»ä¸­åæ ‡å˜æ¢åˆ°ä¸–ç•Œåæ ‡ç³»</p>
<p>ç›¸å¯¹åº”çš„ï¼Œè§†å›¾çŸ©é˜µ(ä¸–ç•Œåæ ‡ç³»è½¬æ¢åˆ°ç›¸æœºåæ ‡ç³») <code>view = Mï¹£Â¹</code></p>
<blockquote>
<p>ä¸–ç•Œåæ ‡ç³»ä¸­çš„é¡¶ç‚¹é€šè¿‡ M æ˜ å°„åˆ°ç›¸æœºåæ ‡ç³»ï¼Œæ ¹æ®ç›¸å¯¹è¿åŠ¨ï¼Œè¯¥é¡¶ç‚¹åœ¨ç›¸æœºåæ ‡ç³»ä¸­å®é™…ä¸º view * åŸé¡¶ç‚¹ä½ç½®</p>
</blockquote>
<p>å¹³ç§»çŸ©é˜µ T</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[ 0 0 0 eyeX ]</span><br><span class="line">[ 0 0 0 eyeY ]</span><br><span class="line">[ 0 0 0 eyeZ ]</span><br><span class="line">[ 0 0 0   1  ]</span><br></pre></td></tr></table></figure>

<p>å·²çŸ¥</p>
<p><code>x(1,0,0),y(0,1,0),z(0,0,1)</code> ä¸ºä¸–ç•Œåæ ‡ç³»çš„åŸº<br><code>u(sx,sy,sz),v(ux,uy,uz),n(-fx,-fy,-fz)</code> ä¸ºç›¸æœºåæ ‡ç³»çš„åŸº</p>
<p>æ±‚ç›¸æœºåæ ‡ç³»ä¸­é¡¶ç‚¹å˜æ¢åˆ°ä¸–ç•Œåæ ‡ç³»çš„å˜æ¢çŸ©é˜µ R</p>
<p>è§£ï¼š</p>
<p>æ ¹æ®<a href="https://baike.baidu.com/item/%E5%9F%BA%E5%8F%98%E6%8D%A2" target="_blank" rel="noopener">å®šç†</a> </p>
<p>è‹¥ <code>(u,v,n) = (x,y,z) * C</code><br>åˆ™çŸ©é˜µ C ä¸ºä»åŸº <code>(x,y,z)</code> åˆ°åŸº <code>(u,v,n)</code> çš„è¿‡æ¸¡çŸ©é˜µ</p>
<p>è®¾å‘é‡ç©ºé—´ä¸­æŸä¸ªå‘é‡çš„åæ ‡åœ¨åŸº <code>(x,y,z)</code> å’ŒåŸº <code>(u,v,n)</code> ä¸‹åˆ†åˆ«è¡¨ç¤ºä¸º Xã€Yï¼Œ<br>æ ¹æ®åæ ‡å˜æ¢å…¬å¼æœ‰ <code>X = C * Y</code></p>
<p>æ•…æ‰€æ±‚ C æ­£å¥½ä¸ºç›¸æœºåæ ‡ç³»é¡¶ç‚¹åˆ°ä¸–ç•Œåæ ‡ç³»é¡¶ç‚¹çš„å˜æ¢çŸ©é˜µ R</p>
<blockquote>
<p>t è¡¨ç¤ºè½¬ç½®çŸ©é˜µï¼Œä¸‹åŒ</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">u &#x3D; (sx,sy,sz)t &#x3D; sx * x + sy * y + sz * z</span><br><span class="line">v &#x3D; (ux,uy,uz)t &#x3D; ux * x + uy * y + uz * z</span><br><span class="line">n &#x3D; (-fx,-fy,-fz)t &#x3D; -fx * x - fy * y - fz * z</span><br><span class="line"></span><br><span class="line">(u,v,n) </span><br><span class="line">&#x3D; (x,y,z) * R</span><br><span class="line">&#x3D; (x,y,z) * ( (sx,sy,sz)t ,(ux,uy,uz)t, (-fx,-fy,-fz)t )</span><br></pre></td></tr></table></figure>


<p>æ•…æ—‹è½¬çŸ©é˜µ R ä¸º</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[ sx ux -fx 0 ]</span><br><span class="line">[ sy uy -fy 0 ]</span><br><span class="line">[ sz uz -fz 0 ]</span><br><span class="line">[ 0  0   0  1 ]</span><br></pre></td></tr></table></figure>


<p>æœ€ç»ˆæ‰€æ±‚çŸ©é˜µ view = <code>(T * R)ï¹£Â¹</code> = <code>Rï¹£Â¹ * Tï¹£Â¹</code> = <code>Rt * Tï¹£Â¹</code></p>
<blockquote>
<p>æ—‹è½¬çŸ©é˜µä¸ºæ­£äº¤çŸ©é˜µï¼Œå…¶é€†çŸ©é˜µç­‰äºå®ƒçš„è½¬ç½®çŸ©é˜µ</p>
</blockquote>
<p>æ•…</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">view &#x3D; </span><br><span class="line">[  sx  sy  sz 0 ]   [ 1 0 0 -eyeX ]</span><br><span class="line">[  ux  uy  uz 0 ] x [ 0 1 0 -eyeY ]</span><br><span class="line">[ -fx -fy -fz 0 ]   [ 0 0 1 -eyeZ ]</span><br><span class="line">[  0   0   0  1 ]   [ 0 0 0    1  ]</span><br></pre></td></tr></table></figure>


<p>â€œæ”¹å˜è§‚å¯Ÿè€…çš„çŠ¶æ€â€ ä¸ â€œå¯¹æ•´ä¸ªä¸–ç•Œè¿›è¡Œå˜æ¢â€ æœ¬è´¨æ˜¯ä¸€æ ·çš„ï¼Œè¿ç”¨å“ªä¸ªçŸ©é˜µå°±çœ‹å˜åŠ¨å“ªä¸ªä¸»ä½“æ›´æ–¹ä¾¿</p>
<p>å°†è§†å›¾çŸ©é˜µä¹˜ä»¥é¡¶ç‚¹åæ ‡å°†å¾—åˆ°æ–°çš„è§†å›¾</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">attribute vec4 a_Position;</span><br><span class="line">uniform mat4 u_ViewMatrix;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  gl_Position = u_ViewMatrix * a_Position;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å·¥å…·å‡½æ•°å¦‚ä¸‹</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">setLookAt</span> (<span class="params">eyeX, eyeY, eyeZ, centerX, centerY, centerZ, upX, upY, upZ</span>) </span>&#123;</span><br><span class="line">  fx, fy, fz, rlf, sx, sy, sz, rls, ux, uy, uz;</span><br><span class="line"></span><br><span class="line">  fx = centerX - eyeX;</span><br><span class="line">  fy = centerY - eyeY;</span><br><span class="line">  fz = centerZ - eyeZ;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Normalize f.</span></span><br><span class="line">  rlf = <span class="number">1</span> / <span class="built_in">Math</span>.sqrt(fx * fx + fy * fy + fz * fz);</span><br><span class="line">  fx *= rlf;</span><br><span class="line">  fy *= rlf;</span><br><span class="line">  fz *= rlf;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Calculate cross product of f and up.</span></span><br><span class="line">  sx = fy * upZ - fz * upY;</span><br><span class="line">  sy = fz * upX - fx * upZ;</span><br><span class="line">  sz = fx * upY - fy * upX;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Normalize s.</span></span><br><span class="line">  rls = <span class="number">1</span> / <span class="built_in">Math</span>.sqrt(sx * sx + sy * sy + sz * sz);</span><br><span class="line">  sx *= rls;</span><br><span class="line">  sy *= rls;</span><br><span class="line">  sz *= rls;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Calculate cross product of s and f.</span></span><br><span class="line">  ux = sy * fz - sz * fy;</span><br><span class="line">  uy = sz * fx - sx * fz;</span><br><span class="line">  uz = sx * fy - sy * fx;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> Rt = <span class="keyword">new</span> <span class="built_in">Float32Array</span>(<span class="number">16</span>);</span><br><span class="line">  Rt[<span class="number">0</span>] = sx;</span><br><span class="line">  Rt[<span class="number">1</span>] = ux;</span><br><span class="line">  Rt[<span class="number">2</span>] = -fx;</span><br><span class="line">  Rt[<span class="number">3</span>] = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  Rt[<span class="number">4</span>] = sy;</span><br><span class="line">  Rt[<span class="number">5</span>] = uy;</span><br><span class="line">  Rt[<span class="number">6</span>] = -fy;</span><br><span class="line">  Rt[<span class="number">7</span>] = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  Rt[<span class="number">8</span>] = sz;</span><br><span class="line">  Rt[<span class="number">9</span>] = uz;</span><br><span class="line">  Rt[<span class="number">10</span>] = -fz;</span><br><span class="line">  Rt[<span class="number">11</span>] = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  Rt[<span class="number">12</span>] = <span class="number">0</span>;</span><br><span class="line">  Rt[<span class="number">13</span>] = <span class="number">0</span>;</span><br><span class="line">  Rt[<span class="number">14</span>] = <span class="number">0</span>;</span><br><span class="line">  Rt[<span class="number">15</span>] = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">var</span> inverseT = multiply(translation(-eyeX, -eyeY, -eyeZ), createMat4())</span><br><span class="line">  <span class="keyword">return</span> multiply(Rt, inverseT)</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="æŠ•å½±"><a href="#æŠ•å½±" class="headerlink" title="æŠ•å½±"></a>æŠ•å½±</h2><p>å½“ä»ä¸åŒè§†å›¾è¿›è¡Œè§‚å¯Ÿæ—¶ï¼Œä¼šå‘ç°éƒ¨åˆ†è¢«è£å‰ªï¼Œè¿™æ˜¯ç”±äº WebGL åªæ˜¾ç¤ºå¯è§†èŒƒå›´çš„åŒºåŸŸ</p>
<p>æˆ‘ä»¬å¯ä»¥ç§»åŠ¨ç›¸æœºä½ç½®ä½¿å¾—çœ‹åˆ°æ›´å¤šçš„ç©ºé—´</p>
<p>æœ‰ä¸¤ç±»å¯è§†ç©ºé—´ï¼š</p>
<ul>
<li>é•¿æ–¹ä½“å¯è§†ç©ºé—´ï¼Œç”±æ­£å°„æŠ•å½±äº§ç”Ÿ</li>
<li>é‡‘å­—å¡”å¯è§†ç©ºé—´ï¼Œç”±é€è§†æŠ•å½±äº§ç”Ÿ</li>
</ul>
<h3 id="æ­£è§†æŠ•å½±"><a href="#æ­£è§†æŠ•å½±" class="headerlink" title="æ­£è§†æŠ•å½±"></a>æ­£è§†æŠ•å½±</h3><p><img src="https://upload-images.jianshu.io/upload_images/9277731-9e33cdbd1dc4b60a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Ortho"></p>
<p>ç›¸å½“äºå¯¹åŸ canvas ç›’å­è¿›è¡Œé•¿æ–¹ä½“è£å‰ªï¼Œå†åšç¼©æ”¾</p>
<p>ç”¨åˆ°çš„å‚æ•°æœ‰ï¼šleft, right, bottom, top, near, far</p>
<p><img src="https://upload-images.jianshu.io/upload_images/9277731-fda5271027fe6be2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="OrthoMatrix"></p>
<p>å·¥å…·å‡½æ•°</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è®¾ç½®æ­£å°„æŠ•å½±çŸ©é˜µ </span></span><br><span class="line"><span class="comment"> * ä»¥ä¸‹æ˜¯ç«‹æ–¹ä½“è£æˆªé¢çš„åæ ‡</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Number&#125;</span> </span>left </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Number&#125;</span> </span>right </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Number&#125;</span> </span>bottom </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Number&#125;</span> </span>top </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Number&#125;</span> </span>near </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Number&#125;</span> </span>far </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">setOrtho</span> (<span class="params">left, right, bottom, top, near, far</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> rw, rh, rd;</span><br><span class="line"></span><br><span class="line">  rw = <span class="number">1</span> / (right - left);</span><br><span class="line">  rh = <span class="number">1</span> / (top - bottom);</span><br><span class="line">  rd = <span class="number">1</span> / (far - near);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> out = <span class="keyword">new</span> <span class="built_in">Float32Array</span>(<span class="number">16</span>);</span><br><span class="line"></span><br><span class="line">  out[<span class="number">0</span>] = <span class="number">2</span> * rw;</span><br><span class="line">  out[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">  out[<span class="number">2</span>] = <span class="number">0</span>;</span><br><span class="line">  out[<span class="number">3</span>] = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  out[<span class="number">4</span>] = <span class="number">0</span>;</span><br><span class="line">  out[<span class="number">5</span>] = <span class="number">2</span> * rh;</span><br><span class="line">  out[<span class="number">6</span>] = <span class="number">0</span>;</span><br><span class="line">  out[<span class="number">7</span>] = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  out[<span class="number">8</span>] = <span class="number">0</span>;</span><br><span class="line">  out[<span class="number">9</span>] = <span class="number">0</span>;</span><br><span class="line">  out[<span class="number">10</span>] = <span class="number">-2</span> * rd;</span><br><span class="line">  out[<span class="number">11</span>] = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  out[<span class="number">12</span>] = -(right + left) * rw;</span><br><span class="line">  out[<span class="number">13</span>] = -(top + bottom) * rh;</span><br><span class="line">  out[<span class="number">14</span>] = -(far + near) * rd;</span><br><span class="line">  out[<span class="number">15</span>] = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> out;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="é€è§†æŠ•å½±-Perspective"><a href="#é€è§†æŠ•å½±-Perspective" class="headerlink" title="é€è§†æŠ•å½±(Perspective)"></a>é€è§†æŠ•å½±(Perspective)</h3><p>æ•ˆæœå°±æ˜¯è®©è¿œå¤„çš„ç‰©ä½“çœ‹èµ·æ¥æ›´å°ï¼Œä½¿åœºæ™¯æ›´æœ‰æ·±åº¦æ„Ÿï¼Œæ¥è¿‘çœŸå®ä¸–ç•Œ</p>
<p><img src="https://upload-images.jianshu.io/upload_images/9277731-77e59e5324d3f74f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Perspective"></p>
<p>ç›¸ç­‰äºå¯¹æ‰€æœ‰è£å‰ªé¢è¿›è¡Œç¼©æ”¾+å¹³ç§»</p>
<p>ç”¨åˆ°çš„å‚æ•°æœ‰ï¼š </p>
<ul>
<li>fov å‚ç›´è§†è§’</li>
<li>aspect è¿‘è£å‰ªé¢çš„å®½é«˜æ¯”</li>
<li>near,far è¿‘è£å‰ªé¢ä¸è¿œè£å‰ªé¢çš„ä½ç½®</li>
</ul>
<p>å¯¹åº”çš„çŸ©é˜µä¸º</p>
<p><img src="https://upload-images.jianshu.io/upload_images/9277731-b4129ca838cbf69e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="PerspectiveMatrix"></p>
<p>å·¥å…·å‡½æ•°å¦‚ä¸‹</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è®¾ç½®é€è§†æŠ•å½±çŸ©é˜µ </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>fovy å‚ç›´è§†è§’</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>aspect è¿‘è£å‰ªé¢çš„å®½é«˜æ¯”</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>near è¿‘è£å‰ªé¢ä½ç½®</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>far è¿œè£å‰ªé¢</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">setPerspective</span> (<span class="params">fovy, aspect, near, far</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> rd, s, ct;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (near === far || aspect === <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="string">'null frustum'</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (near &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="string">'near &lt;= 0'</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (far &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="string">'far &lt;= 0'</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  fovy = <span class="built_in">Math</span>.PI * fovy / <span class="number">180</span> / <span class="number">2</span>;</span><br><span class="line">  s = <span class="built_in">Math</span>.sin(fovy);</span><br><span class="line">  <span class="keyword">if</span> (s === <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="string">'null frustum'</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  rd = <span class="number">1</span> / (far - near);</span><br><span class="line">  ct = <span class="built_in">Math</span>.cos(fovy) / s;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> out = <span class="keyword">new</span> <span class="built_in">Float32Array</span>(<span class="number">16</span>);</span><br><span class="line"></span><br><span class="line">  out[<span class="number">0</span>]  = ct / aspect;</span><br><span class="line">  out[<span class="number">1</span>]  = <span class="number">0</span>;</span><br><span class="line">  out[<span class="number">2</span>]  = <span class="number">0</span>;</span><br><span class="line">  out[<span class="number">3</span>]  = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  out[<span class="number">4</span>]  = <span class="number">0</span>;</span><br><span class="line">  out[<span class="number">5</span>]  = ct;</span><br><span class="line">  out[<span class="number">6</span>]  = <span class="number">0</span>;</span><br><span class="line">  out[<span class="number">7</span>]  = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  out[<span class="number">8</span>]  = <span class="number">0</span>;</span><br><span class="line">  out[<span class="number">9</span>]  = <span class="number">0</span>;</span><br><span class="line">  out[<span class="number">10</span>] = -(far + near) * rd;</span><br><span class="line">  out[<span class="number">11</span>] = <span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line">  out[<span class="number">12</span>] = <span class="number">0</span>;</span><br><span class="line">  out[<span class="number">13</span>] = <span class="number">0</span>;</span><br><span class="line">  out[<span class="number">14</span>] = <span class="number">-2</span> * near * far * rd;</span><br><span class="line">  out[<span class="number">15</span>] = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> out;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>


<h2 id="å¤åˆå˜æ¢"><a href="#å¤åˆå˜æ¢" class="headerlink" title="å¤åˆå˜æ¢"></a>å¤åˆå˜æ¢</h2><p>å®ç°å…ˆå¹³ç§»å†æ—‹è½¬çš„å˜æ¢</p>
<p>çŸ©é˜µä¹˜æ³•æ»¡è¶³ç»“åˆå¾‹ï¼Œä¸”è‡ªå³å‘å·¦è®¡ç®—</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;â€œå¹³ç§»åæ—‹è½¬â€åæ ‡&gt; &#x3D; &lt;æ—‹è½¬çŸ©é˜µ&gt; x (&lt;å¹³ç§»çŸ©é˜µ&gt; x &lt;åŸå§‹åæ ‡&gt;)</span><br><span class="line">&#x3D; (&lt;æ—‹è½¬çŸ©é˜µ&gt; x &lt;å¹³ç§»çŸ©é˜µ&gt;) x &lt;åŸå§‹åæ ‡&gt;</span><br><span class="line">&#x3D; (â€œå¹³ç§»åæ—‹è½¬â€çŸ©é˜µ) x &lt;åŸå§‹åæ ‡&gt;</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢ <code>â€œå¹³ç§»åæ—‹è½¬â€çŸ©é˜µ</code> å°±æ˜¯ä¸€ä¸ªå¤åˆå˜æ¢çŸ©é˜µï¼Œå°±å«æ¨¡å‹çŸ©é˜µ</p>
<p>é€šå¸¸æˆ‘ä»¬è¿˜ä¼šè¿ç”¨è§†å›¾çŸ©é˜µå’ŒæŠ•å½±çŸ©é˜µï¼Œå³</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">gl_Position = u_ProjectionMatrix  * u_ViewMatrix * u_ModelMatrix * a_Position;</span><br></pre></td></tr></table></figure>


<h2 id="æ³¨æ„ç‚¹"><a href="#æ³¨æ„ç‚¹" class="headerlink" title="æ³¨æ„ç‚¹"></a>æ³¨æ„ç‚¹</h2><p>WebGL æ²¡æœ‰æä¾›è‡ªå¸¦çš„çŸ©é˜µè¿ç®—æ–¹æ³•ï¼Œæ‰€ä»¥æ—¥å¸¸å¼€å‘ä¸­åº”è¯¥å°è£…ä¸€å¥—è‡ªå·±çš„çŸ©é˜µè¿ç®—åº“ï¼Œæˆ–è€…ä½¿ç”¨å¼€æºé¡¹ç›®</p>
<p>å®ç°åŠ¨ç”»æ—¶åˆ©ç”¨ rAF API ,å¹¶é€šè¿‡æ¸²æŸ“æ—¶é—´å·®åˆ¤æ–­åŠ¨ç”»æ‰€è¿›è¡Œçš„ç¨‹åº¦</p>
<p>WebGL æŒ‰ç…§é¡¶ç‚¹åœ¨ç¼“å†²åŒºçš„ä½ç½®æ¥è¿›è¡Œç»˜åˆ¶çš„ï¼Œä¸ä¼šè€ƒè™‘è¿œè¿‘ï¼Œå¯¼è‡´è¿œå¤„çš„å›¾åƒä¼šç»˜åˆ¶åœ¨è¿‘å¤„å›¾åƒä¸Šé¢ã€‚æ­¤æ—¶å¯ä»¥å¼€å¯éšè—é¢æ¶ˆé™¤åŠŸèƒ½ã€‚è¿™æ ·ç‰‡æ®µç€è‰²å™¨åœ¨ç»˜åˆ¶å®Œåä¼šè¿›è¡Œæ·±åº¦æ£€æµ‹å¹¶å°†ç»“æœç¼“å­˜åœ¨æ·±åº¦ç¼“å†²åŒº</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å¼€å¯éšè—é¢æ¶ˆé™¤åŠŸèƒ½</span></span><br><span class="line">gl.enable(gl.DEPTH_TEST);</span><br><span class="line"><span class="comment">// åœ¨ç»˜åˆ¶å‰æ¸…é™¤é¢œè‰²ç¼“å†²åŒºä»¥åŠæ·±åº¦ç¼“å†²åŒº</span></span><br><span class="line">gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);</span><br></pre></td></tr></table></figure>

<p>å½“ä¸¤ä¸ªå›¾å…ƒæ·±åº¦æ¥è¿‘æ—¶ï¼Œä¼šäº§ç”Ÿæ·±åº¦å†²çªï¼Œæ­¤æ—¶å¯ä»¥é‡‡ç”¨å¤šè¾¹å½¢åç§»æœºåˆ¶è§£å†³</p>
<blockquote>
<p>åŸç†è¯·å‚è€ƒå…¶ä»–æ–‡çŒ®</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å¯ç”¨å¤šè¾¹å½¢åç§»</span></span><br><span class="line">gl.enable(gl.POLYGON_OFFSET_FILL);</span><br><span class="line"><span class="comment">// ç»˜åˆ¶ä¸‰è§’å½¢1</span></span><br><span class="line">gl.drawArrays(gl.TRIANGLES, <span class="number">0</span>, n/<span class="number">2</span>); </span><br><span class="line"><span class="comment">// è®¾ç½®å¤šè¾¹å½¢åç§»</span></span><br><span class="line">gl.polygonOffset(<span class="number">1.0</span>, <span class="number">1.0</span>); </span><br><span class="line"><span class="comment">// ç»˜åˆ¶ä¸‰è§’å½¢2</span></span><br><span class="line">gl.drawArrays(gl.TRIANGLES, n/<span class="number">2</span>, n/<span class="number">2</span>);</span><br></pre></td></tr></table></figure>

<h1 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h1><p>é‡‡ç”¨æœ€å¼€å§‹å®šä¹‰çš„é¡¶ç‚¹æ•°æ®ï¼Œå¹¶è¿›è¡Œä»¥ä¸‹çŸ©é˜µå˜æ¢</p>
<p>è®¾ç½®é€è§†æŠ•å½±</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">setPerspective(<span class="number">30</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">100</span>)</span><br></pre></td></tr></table></figure>
<p>è®¾ç½®è§†è§’</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">lookAt(<span class="number">3</span>, <span class="number">3</span>, <span class="number">7</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>);</span><br></pre></td></tr></table></figure>

<p>æœ€ç»ˆæ•ˆæœ</p>
<p><img src="https://upload-images.jianshu.io/upload_images/9277731-7d3ac250d5321f85.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="cube-demo"></p>
<h1 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h1><ol>
<li><a href="https://blog.csdn.net/weixin_37683659/article/details/79830278" target="_blank" rel="noopener">è§†å›¾çŸ©é˜µæ¨å¯¼è¿‡ç¨‹</a></li>
<li>ã€ŠWebGLç¼–ç¨‹æŒ‡å—ã€‹</li>
</ol>
]]></content>
      <categories>
        <category>å¤§å‰ç«¯</category>
      </categories>
      <tags>
        <tag>WebGL</tag>
      </tags>
  </entry>
  <entry>
    <title>é¢è¯•å®˜é—®ï¼šä»€ä¹ˆæ˜¯ canvas æ±¡æŸ“</title>
    <url>/2020/03/08/2020/%E9%9D%A2%E8%AF%95%E5%AE%98%E9%97%AE%EF%BC%9A%E4%BB%80%E4%B9%88%E6%98%AF%20canvas%20%E6%B1%A1%E6%9F%93/</url>
    <content><![CDATA[<p>è¿™æ˜¯æœ€è¿‘é¢è¯• bd æ—¶é¢è¯•å®˜é—®çš„ä¸€ä¸ªé—®é¢˜ï¼Œå½“æ—¶æ²¡æœ‰å›ç­”ä¸Šæ¥ã€‚</p>
<p>æœ¬ç¯‡å°±ä»¥é—®ç­”çš„å½¢å¼æ¥è®²è§£è¿™é¢˜ã€‚å½“ç„¶ä»¥ä¸‹å†…å®¹çº¯å±è™šæ„ï¼Œåªæ˜¯ä¸ºäº†è¯´æ˜å¤§å‚é¢è¯•æ˜¯ä¸€ç¯æ‰£ä¸€ç¯çš„ã€‚æˆ–è®¸å½“ä½ æˆä¸ºé¢è¯•å®˜æ—¶ä¹Ÿå¯ä»¥é‡‡ç”¨è¿™ç§å½¢å¼ã€‚</p>
<a id="more"></a>

<hr>
<p>â€œæˆ‘çœ‹ä½ ç®€å†ä¸Šè¯´ä½¿ç”¨è¿‡ canvas ï¼Œèƒ½è¯´è¯´ä»€ä¹ˆæ˜¯ canvas æ±¡æŸ“ä¹ˆï¼Ÿâ€<br>â€œå°†ä¸€å¼ è·¨åŸŸçš„å›¾ç‰‡ç»˜åˆ¶åˆ° canvas ä¸Šï¼Œè¿™ä¸ª canvas å°±æ˜¯è¢«æ±¡æŸ“çš„ï¼Œæ­¤æ—¶æ— æ³•è¯»å–è¯¥ canvas çš„æ•°æ®ã€‚â€</p>
<p>â€œé‚£ä½ èƒ½è¯´è¯´æµè§ˆå™¨ä¸ºä»€ä¹ˆè¦åšè¿™ä¸ªé™åˆ¶ï¼Ÿâ€<br>â€œä¸ºäº†ç”¨æˆ·çš„å®‰å…¨ã€‚â€ ç”±äºä¹‹å‰æ²¡æœ‰æ€è€ƒè¿‡ï¼Œåˆä¸æƒ³æ‰¿è®¤ä¸ä¼šï¼Œæˆ‘éšå£ä¸€è¯´ã€‚</p>
<p>â€œèƒ½å…·ä½“è®²è®²ä¹ˆï¼Ÿâ€ é¢è¯•å®˜ä¼¼ä¹è¯»å‡ºäº†æˆ‘è¨€è¯­ä¸­çš„çŠ¹è±«ã€‚<br>â€œå—¯ã€‚ã€‚ã€‚è®©æˆ‘æƒ³æƒ³ã€‚â€ å…ˆç¨³ä½ï¼Œå‡è£…ä¸æ…Œï¼Œå…¶å®å†…å¿ƒæ…Œå¾—ä¸€pã€‚<br>â€œè¿™ä¸ªæ˜¯åŒæºç­–ç•¥çš„é™åˆ¶ã€‚åº”è¯¥æ˜¯ä¸ºäº†é¿å…ç¬¬ä¸‰æ–¹ç½‘ç«™è¯»å–å…¶ä»–ç½‘ç«™çš„å›¾ç‰‡æ•°æ®ï¼Œé¿å…ç”¨æˆ·éšç§æ³„éœ²ã€‚æ¯”å¦‚å·²çŸ¥æŸä¸ªéšç§å›¾ç‰‡çš„ urlï¼Œè¿›å…¥ç¬¬ä¸‰æ–¹ç½‘ç«™åï¼Œå¯ä»¥è¯·æ±‚åˆ°è¯¥å›¾ç‰‡ï¼Œå¦‚æœä¸åšæ•°æ®è¯»å–é™åˆ¶çš„è¯ï¼Œè¯¥æ•°æ®å°†è¢«ä¼ é€åˆ°ç½‘ç«™åå°è¿›è€Œå¯¼è‡´ä¿¡æ¯æ³„éœ²ã€‚â€</p>
<p>â€œå¾ˆå¥½ã€‚é‚£å¦‚æœæ˜¯æˆ‘ä»¬è‡ªå·±çš„ç½‘ç«™è¦ç”¨ï¼Œæœ‰ä»€ä¹ˆè§£å†³æ–¹æ¡ˆï¼Ÿâ€<br>â€œå—¯ï¼Œè¿™ä¸ªè¦çœ‹èƒ½å¦æ§åˆ¶å›¾ç‰‡çš„å“åº”äº†ã€‚å¦‚æœå¯ä»¥æ§åˆ¶çš„è¯ï¼Œåˆ©ç”¨ cors è·¨åŸŸï¼Œå¹¶åœ¨å›¾ç‰‡è¯·æ±‚å‘èµ·æ—¶å¢åŠ  <code>crossOrigin = &quot;Anonymous&quot;</code> è®¾ç½®ï¼›å¦åˆ™åªèƒ½è‡ªå·±çš„ç½‘ç«™åšä¸ªä»£ç†ï¼Œè®©ç½‘ç«™ä¸å›¾ç‰‡åŒæºã€‚â€</p>
<p>â€œä½ åˆšåˆšæœ‰æåˆ°åŒæºï¼Œé‚£ä½ è¯´è¯´ä¸ºä»€ä¹ˆæµè§ˆå™¨ä¼šæœ‰åŒæºç­–ç•¥ï¼Ÿâ€<br>â€œä¸ºäº†é™åˆ¶å…¶ä»–æºæ–‡æ¡£æˆ–è„šæœ¬ä¸å½“å‰æºçš„èµ„æºè¿›è¡Œäº¤äº’ã€‚ä¸»è¦æœ‰ä¸¤ä¸ªåœ°æ–¹ï¼šä¸€ä¸ªæ˜¯ iframe èŠ‚ç‚¹è®¿é—®æ§åˆ¶ï¼Œå¦‚æœæ²¡æœ‰åŒæºç­–ç•¥é™åˆ¶çš„è¯ï¼Œiframe å¯ä»¥éšæ„è®¿é—®å…¶ä»–éåŒæº iframe çš„ dom èŠ‚ç‚¹ï¼Œå¦‚é’“é±¼ç½‘ç«™åµŒå¥—äº†ä¸€ä¸ªé“¶è¡Œç½‘ç«™çš„ iframe ï¼Œä»å¤–éƒ¨å°±å¯ä»¥è¯»å–åˆ°å†…éƒ¨å¯†ç è¾“å…¥æ¡†çš„å€¼ã€‚å¦ä¸€ä¸ªæ˜¯ http å“åº”æ§åˆ¶ï¼Œå¦‚æœæ²¡æœ‰åŒæºç­–ç•¥é™åˆ¶çš„è¯ï¼Œåœ¨ç¬¬ä¸‰æ–¹ç½‘ç«™ç›´æ¥å¯¹å…¶ä»–ç½‘ç«™å‘èµ·è¯·æ±‚ï¼Œå¯ä»¥è¯»å–åˆ°å“åº”ï¼Œè¿™æ ·å°±å¯ä»¥è·å–ç”¨æˆ·çš„ä¸ªäººä¿¡æ¯ï¼Œé€ æˆéšç§æ³„éœ²ã€‚â€</p>
<p>â€œå¾ˆå¥½ï¼Œä½ åˆšåˆšè¯´åˆ°å“åº”æ§åˆ¶ï¼Œé‚£è¯·æ±‚æ˜¯æˆåŠŸçš„ä¹ˆï¼Ÿâ€<br>â€œåˆ©ç”¨ img/form ç­‰æ”¯æŒè·¨åŸŸçš„æ ‡ç­¾ï¼Œè¯·æ±‚ä¼šè‡ªåŠ¨å¸¦ä¸Š cookieï¼Œæ²¡æœ‰é¢å¤–å¤„ç†çš„è¯è¯·æ±‚æ˜¯æˆåŠŸçš„ï¼Œè¿™ä¹Ÿå°±æ˜¯æ‰€è°“çš„ csrf æ”»å‡»ã€‚è€Œå¦‚æœæ˜¯ ajax ï¼Œä¸ä¼šå¸¦ä¸Š cookie ï¼Œéœ€è¦é‰´æƒçš„è¯·æ±‚ä¹Ÿå°±ç›´æ¥å¤±è´¥ã€‚æ³¨æ„åŒæºç­–ç•¥åªæ˜¯å¯¹ç»ˆç«¯è¿›è¡Œä¿¡æ¯é˜²æŠ¤ï¼Œåªæ‹¦æˆªå“åº”ï¼Œä¸æ‹¦æˆªè¯·æ±‚ã€‚â€</p>
<p>â€œä¸ºä»€ä¹ˆæµè§ˆå™¨ä¸ç›´æ¥æ‹¦æˆªéåŒæºè¯·æ±‚ï¼Ÿâ€<br>â€œæµè§ˆå™¨å¾—é€šè¿‡å“åº”æ‰çŸ¥é“è¦ä¸è¦æ‹¦æˆªï¼Œå¦‚æœç›´æ¥æ‹¦æˆªè¯·æ±‚äº†ï¼Œæƒ³ç”¨ cors åšè·¨åŸŸè¯·æ±‚å°±åšä¸äº†äº†ã€‚â€</p>
<p>â€¦ä¸­é—´åˆç©¿æ’äº† csrf ç­‰å„ç§å‰ç«¯å®‰å…¨çš„é—®é¢˜ã€‚</p>
<p>â€œå›åˆ° canvasï¼Œæœ€åå†é—®ä¸€ä¸ªé—®é¢˜ï¼Œè¯´è¯´ canvas æ€§èƒ½åˆ†æå’Œå¸¸è§çš„æ¸²æŸ“ä¼˜åŒ–ç­–ç•¥ï¼Ÿâ€<br>â€œä¸å¤ªäº†è§£ã€‚ã€‚â€<br>â€œå¥½å§ï¼Œæˆ‘ä»¬ä¸‹ä¸€ç¯‡æ–‡ç« è§ã€‚â€</p>
<hr>
<p>å¦‚æœ‰é”™è¯¯ï¼Œæ¬¢è¿æŒ‡æ­£</p>
]]></content>
      <categories>
        <category>å¤§å‰ç«¯</category>
      </categories>
      <tags>
        <tag>Canvas</tag>
      </tags>
  </entry>
  <entry>
    <title>WebGL åˆæ¢</title>
    <url>/2020/03/05/WebGL/WebGL%20%E5%88%9D%E6%8E%A2/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æœ¬ç¯‡å°†ä»‹ç»å¸¸ç”¨çš„æ¦‚å¿µåŠå·¥ä½œæµç¨‹ï¼Œè¾¾åˆ°å¿«é€Ÿå…¥é—¨çš„æ•ˆæœ</p>
<a id="more"></a>

<h2 id="ç¨‹åºè¿è¡Œæµç¨‹"><a href="#ç¨‹åºè¿è¡Œæµç¨‹" class="headerlink" title="ç¨‹åºè¿è¡Œæµç¨‹"></a>ç¨‹åºè¿è¡Œæµç¨‹</h2><p>å…ˆç®€å•æè¿°ä¸€ä¸‹ç¼–å†™ WebGL ç¨‹åºçš„æµç¨‹</p>
<p>åˆå§‹åŒ–é˜¶æ®µ</p>
<ul>
<li>åˆ›å»ºæ‰€æœ‰ç€è‰²å™¨å’Œç¨‹åºå¹¶å¯»æ‰¾å‚æ•°ä½ç½®</li>
<li>åˆ›å»ºç¼“å†²å¹¶ä¸Šä¼ é¡¶ç‚¹æ•°æ®</li>
<li>åˆ›å»ºçº¹ç†å¹¶ä¸Šä¼ çº¹ç†æ•°æ®</li>
</ul>
<p>æ¸²æŸ“é˜¶æ®µ</p>
<ul>
<li>æ¸…ç©ºå¹¶è®¾ç½®è§†å›¾å’Œå…¶ä»–å…¨å±€çŠ¶æ€ï¼ˆå¼€å¯æ·±åº¦æ£€æµ‹ï¼Œå‰”é™¤ç­‰ç­‰ï¼‰</li>
<li>å¯¹äºæƒ³è¦ç»˜åˆ¶çš„æ¯ä¸ªç‰©ä½“<ul>
<li>è°ƒç”¨ gl.useProgram ä½¿ç”¨éœ€è¦çš„ç¨‹åº</li>
<li>è®¾ç½®ç‰©ä½“çš„å±æ€§å˜é‡<ul>
<li>ä¸ºæ¯ä¸ªå±æ€§è°ƒç”¨ gl.bindBuffer, gl.vertexAttribPointer, gl.enableVertexAttribArray</li>
</ul>
</li>
<li>è®¾ç½®ç‰©ä½“çš„å…¨å±€å˜é‡<ul>
<li>ä¸ºæ¯ä¸ªå…¨å±€å˜é‡è°ƒç”¨ gl.uniformXXX</li>
<li>è°ƒç”¨ gl.activeTexture å’Œ gl.bindTexture è®¾ç½®çº¹ç†åˆ°çº¹ç†å•å…ƒ</li>
</ul>
</li>
<li>è°ƒç”¨ gl.drawArrays æˆ– gl.drawElements</li>
</ul>
</li>
</ul>
<ol>
<li>ç¼–å†™é¡¶ç‚¹ç€è‰²å™¨ï¼Œè¯¥ç€è‰²å™¨ç”¨äºè·å–é¡¶ç‚¹ä½ç½®ï¼Œè¿›è€Œç”Ÿæˆç‚¹ï¼Œ çº¿å’Œä¸‰è§’å½¢åœ¨å†…çš„ä¸€äº›å›¾å…ƒ</li>
<li>ç¼–å†™ç‰‡æ®µç€è‰²å™¨ï¼Œè¯¥ç€è‰²å™¨å°†å¯¹å›¾å…ƒè¿›è¡Œå…‰æ …åŒ–å¤„ç†ï¼Œå¾—åˆ°ç»˜åˆ¶å›¾å…ƒä¸­æ¯ä¸ªåƒç´ çš„é¢œè‰²å€¼</li>
<li>å¯¹ä¸¤ä¸ªç€è‰²å™¨è¿›è¡Œç¼–è¯‘å¾—åˆ°ç€è‰²å™¨å¯¹è±¡</li>
<li>å°†ä¸¤ä¸ªç€è‰²å™¨å¯¹è±¡é“¾æ¥åˆ°åŒä¸€ç€è‰²ç¨‹åº</li>
<li>è·å–å±æ€§å€¼ä½ç½®</li>
<li>ç»‘å®šç¼“å†²å¹¶å­˜å…¥æ•°æ®ã€‚ä»¥ä¸Šä¸ºåˆå§‹åŒ–é˜¶æ®µï¼Œä¹‹åè¿›è¡Œå¾ªç¯æ¸²æŸ“é˜¶æ®µã€‚</li>
<li>è®¾ç½® WebGL è£å‰ªç©ºé—´ä¸ Canvas ç”»å¸ƒå°ºå¯¸é—´çš„æ˜ å°„</li>
<li>ä¸º WebGL æŒ‡å®šç€è‰²ç¨‹åº</li>
<li>ä»ä¹‹å‰å‡†å¤‡çš„ç¼“å†²ä¸­è·å–æ•°æ®ï¼Œå¹¶èµ‹å€¼ç»™ç€è‰²å™¨ä¸­çš„å±æ€§ï¼ˆéœ€è¦æŒ‡å®šå±æ€§å€¼ä½ç½®ä»¥åŠè¯»å–æ•°æ®æ–¹å¼ï¼‰</li>
<li>æŒ‡å®šç»˜åˆ¶çš„å›¾å…ƒç±»å‹ï¼Œè¿è¡Œå¤šæ¬¡é¡¶ç‚¹ç€è‰²å™¨ï¼Œå¾—åˆ°å›¾å…ƒï¼Œå¹¶åˆ©ç”¨ç‰‡æ®µç€è‰²å™¨è¿›è¡Œå›¾å…ƒç»˜åˆ¶</li>
</ol>
<h2 id="å·¥ä½œåŸç†"><a href="#å·¥ä½œåŸç†" class="headerlink" title="å·¥ä½œåŸç†"></a>å·¥ä½œåŸç†</h2><p>è¿è¡Œæ¬¡æ•°è¡¨ç¤ºé¡¶ç‚¹ç€è‰²å™¨çš„æ‰§è¡Œæ¬¡æ•°ï¼Œæ¯æ¬¡ç”Ÿæˆçš„é¡¶ç‚¹å­˜å‚¨åœ¨ gl_Position ä¸­</p>
<p><img src="https://webglfundamentals.org/webgl/lessons/resources/vertex-shader-anim.gif" alt=""></p>
<h2 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h2><h3 id="GLSL"><a href="#GLSL" class="headerlink" title="GLSL"></a>GLSL</h3><p>ç€è‰²å™¨è¯­è¨€ï¼Œå†…å»ºçš„æ•°æ®ç±»å‹æœ‰ï¼š</p>
<ul>
<li><p>vec2, vec3å’Œ vec4åˆ†åˆ«ä»£è¡¨ä¸¤ä¸ªå€¼ï¼Œä¸‰ä¸ªå€¼å’Œå››ä¸ªå€¼ï¼Œå¯ä»¥ç†è§£ä¸ºåˆ—çŸ©é˜µ</p>
</li>
<li><p>mat2, mat3 å’Œ mat4 åˆ†åˆ«ä»£è¡¨ 2x2, 3x3 å’Œ 4x4 çŸ©é˜µ</p>
</li>
</ul>
<p>è¿˜å¯ä»¥ä½¿ç”¨æ•°ç»„å’Œç»“æ„ä½“</p>
<p>åˆ†é‡é€‰æ‹©å™¨</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">v.x å’Œ v.s ä»¥åŠ v.r ï¼Œ v[0] è¡¨è¾¾çš„æ˜¯åŒä¸€ä¸ªåˆ†é‡ã€‚</span><br><span class="line">v.y å’Œ v.t ä»¥åŠ v.g ï¼Œ v[1] è¡¨è¾¾çš„æ˜¯åŒä¸€ä¸ªåˆ†é‡ã€‚</span><br><span class="line">v.z å’Œ v.p ä»¥åŠ v.b ï¼Œ v[2] è¡¨è¾¾çš„æ˜¯åŒä¸€ä¸ªåˆ†é‡ã€‚</span><br><span class="line">v.w å’Œ v.q ä»¥åŠ v.a ï¼Œ v[3] è¡¨è¾¾çš„æ˜¯åŒä¸€ä¸ªåˆ†é‡ã€‚</span><br></pre></td></tr></table></figure>

<p><code>v.yyyy</code> ç­‰ä»·äº <code>vec4(v.y, v.y, v.y, v.y)</code></p>
<p>å¤šä¸ªå±æ€§ï¼Œå¦‚ä½•ä» buffer è¯»å–æ•°æ®ï¼Ÿ</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> vertexShaderSource = <span class="string">`</span></span><br><span class="line"><span class="string">  attribute vec2 a_position;</span></span><br><span class="line"><span class="string">  attribute vec2 a_offset;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  void main() &#123;</span></span><br><span class="line"><span class="string">    gl_Position = vec4(a_position + a_offset, 0, 1);</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">`</span></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥åˆ†æ¬¡è®¾ç½® buffer</p>
<blockquote>
<p>æ¯æ¬¡æ‰§è¡Œ bufferData ä¸Šä¸€æ¬¡çš„ buffer å°†è¢«æ¸…ç©º</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> positionAttributeLocation = gl.getAttribLocation(program, <span class="string">"a_position"</span>);</span><br><span class="line"><span class="keyword">var</span> offsetAttributeLocation = gl.getAttribLocation(program, <span class="string">"a_offset"</span>);</span><br><span class="line"></span><br><span class="line">gl.enableVertexAttribArray(positionAttributeLocation);</span><br><span class="line"><span class="keyword">var</span> positionBuffer = gl.createBuffer();</span><br><span class="line">gl.bindBuffer(gl.ARRAY_BUFFER, positionBuffer);</span><br><span class="line"><span class="keyword">var</span> positions = [</span><br><span class="line">  <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">  <span class="number">0</span>, <span class="number">0.5</span>,</span><br><span class="line">  <span class="number">0.7</span>, <span class="number">0</span>,</span><br><span class="line">];</span><br><span class="line">gl.bufferData(gl.ARRAY_BUFFER, <span class="keyword">new</span> <span class="built_in">Float32Array</span>(positions), gl.STATIC_DRAW);</span><br><span class="line"><span class="keyword">var</span> size = <span class="number">2</span>;          <span class="comment">// æ¯æ¬¡è¿­ä»£è¿è¡Œæå–ä¸¤ä¸ªå•ä½æ•°æ®</span></span><br><span class="line"><span class="keyword">var</span> type = gl.FLOAT;   <span class="comment">// æ¯ä¸ªå•ä½çš„æ•°æ®ç±»å‹æ˜¯32ä½æµ®ç‚¹å‹</span></span><br><span class="line"><span class="keyword">var</span> normalize = <span class="literal">false</span>; <span class="comment">// ä¸éœ€è¦å½’ä¸€åŒ–æ•°æ®</span></span><br><span class="line"><span class="keyword">var</span> stride = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">var</span> offset = <span class="number">0</span>;</span><br><span class="line">gl.vertexAttribPointer(positionAttributeLocation, size, type, normalize, stride, offset);</span><br><span class="line"></span><br><span class="line">gl.enableVertexAttribArray(offsetAttributeLocation);</span><br><span class="line"><span class="keyword">var</span> offsetBuffer = gl.createBuffer();</span><br><span class="line">gl.bindBuffer(gl.ARRAY_BUFFER, offsetBuffer);</span><br><span class="line"><span class="keyword">var</span> offsets = [</span><br><span class="line">  <span class="number">0.1</span>, <span class="number">0.1</span>,</span><br><span class="line">  <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">  <span class="number">0</span>, <span class="number">0.1</span>,</span><br><span class="line">];</span><br><span class="line">gl.bufferData(gl.ARRAY_BUFFER, <span class="keyword">new</span> <span class="built_in">Float32Array</span>(offsets), gl.STATIC_DRAW);</span><br><span class="line">gl.vertexAttribPointer(offsetAttributeLocation, size, type, normalize, stride, offset);</span><br></pre></td></tr></table></figure>

<p>æˆ–è€…ä¸€æ¬¡è®¾ç½® buffer æ¯æ¬¡æŒ‡å®š buffer åç§»é‡ offset</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> buffer = gl.createBuffer();</span><br><span class="line">gl.bindBuffer(gl.ARRAY_BUFFER, buffer);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> buffer = [</span><br><span class="line">  <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">  <span class="number">0</span>, <span class="number">0.5</span>,</span><br><span class="line">  <span class="number">0.7</span>, <span class="number">0</span>,</span><br><span class="line">  <span class="number">0.1</span>, <span class="number">0.1</span>,</span><br><span class="line">  <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">  <span class="number">0</span>, <span class="number">0.1</span>,</span><br><span class="line">];</span><br><span class="line">gl.bufferData(gl.ARRAY_BUFFER, <span class="keyword">new</span> <span class="built_in">Float32Array</span>(buffer), gl.STATIC_DRAW);</span><br><span class="line"></span><br><span class="line">gl.enableVertexAttribArray(positionAttributeLocation);</span><br><span class="line"><span class="keyword">var</span> size = <span class="number">2</span>;          <span class="comment">// æ¯æ¬¡è¿­ä»£è¿è¡Œæå–ä¸¤ä¸ªå•ä½æ•°æ®</span></span><br><span class="line"><span class="keyword">var</span> type = gl.FLOAT;   <span class="comment">// æ¯ä¸ªå•ä½çš„æ•°æ®ç±»å‹æ˜¯32ä½æµ®ç‚¹å‹</span></span><br><span class="line"><span class="keyword">var</span> normalize = <span class="literal">false</span>; <span class="comment">// ä¸éœ€è¦å½’ä¸€åŒ–æ•°æ®</span></span><br><span class="line"><span class="keyword">var</span> stride = <span class="number">0</span>;        <span class="comment">// 0 = ç§»åŠ¨å•ä½æ•°é‡ * æ¯ä¸ªå•ä½å ç”¨å†…å­˜ï¼ˆsizeof(type)ï¼‰</span></span><br><span class="line"><span class="keyword">var</span> offset = <span class="number">0</span>;        <span class="comment">// ä»ç¼“å†²èµ·å§‹ä½ç½®å¼€å§‹è¯»å–</span></span><br><span class="line">gl.vertexAttribPointer(positionAttributeLocation, size, type, normalize, stride, offset);</span><br><span class="line">gl.enableVertexAttribArray(offsetAttributeLocation);</span><br><span class="line"><span class="keyword">var</span> size = <span class="number">2</span>;          <span class="comment">// æ¯æ¬¡è¿­ä»£è¿è¡Œæå–ä¸¤ä¸ªå•ä½æ•°æ®</span></span><br><span class="line"><span class="keyword">var</span> type = gl.FLOAT;   <span class="comment">// æ¯ä¸ªå•ä½çš„æ•°æ®ç±»å‹æ˜¯32ä½æµ®ç‚¹å‹</span></span><br><span class="line"><span class="keyword">var</span> normalize = <span class="literal">false</span>; <span class="comment">// ä¸éœ€è¦å½’ä¸€åŒ–æ•°æ®</span></span><br><span class="line"><span class="keyword">var</span> stride = <span class="number">0</span>;        <span class="comment">// 0 = ç§»åŠ¨å•ä½æ•°é‡ * æ¯ä¸ªå•ä½å ç”¨å†…å­˜ï¼ˆsizeof(type)ï¼‰</span></span><br><span class="line"><span class="keyword">var</span> offset = <span class="number">3</span>*<span class="number">2</span>*<span class="number">4</span>;        <span class="comment">// ä»ç¼“å†²ç¬¬ä¸‰ç»„å¼€å§‹è¯»å–</span></span><br><span class="line">gl.vertexAttribPointer(offsetAttributeLocation, size, type, normalize, stride, offset);</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼Œå¦‚æœæ˜¯ä¸¤ä¸ª vec4 å˜é‡ç›¸åŠ ï¼Œå¦‚ <code>[1,1,0,1]+[0,1,0,1]=[1,2,0,2]</code> ç­‰ä»·äº <code>[0.5,1,0,1]</code></p>
<p>å¦‚æœæƒ³è¦å¾—åˆ° <code>[1,2,0,1]</code>ï¼Œå¯ä»¥æ‰‹åŠ¨è®¾ç½® vec4 å˜é‡çš„ w ä¸º 1 ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">vec4 tmp = a_position + a_offset;</span><br><span class="line">tmp.w = <span class="number">1.0</span>;</span><br><span class="line">gl_Position = tmp;</span><br></pre></td></tr></table></figure>

<h3 id="æ•°æ®"><a href="#æ•°æ®" class="headerlink" title="æ•°æ®"></a>æ•°æ®</h3><p>å±æ€§(attribute)å’Œç¼“å†²(buffer)</p>
<blockquote>
<p>ç€è‰²å™¨è¿è¡Œæ—¶å±æ€§å°†ä»ç¼“å†²ä¸­æŒ‰æŒ‡å®šè§„åˆ™è¯»å–å€¼</p>
</blockquote>
<p>å…¨å±€å˜é‡ uniform</p>
<blockquote>
<p>è¿è¡Œè¿‡ç¨‹ä¸­å…¨å±€æœ‰æ•ˆ</p>
</blockquote>
<p>çº¹ç† texture</p>
<blockquote>
<p>å€ŸåŠ©å…¨å±€å˜é‡ï¼Œé€šè¿‡ texture2D æ–¹æ³•æå–çº¹ç†ä¿¡æ¯å¹¶èµ‹å€¼ç»™ gl_FragColorã€‚éœ€è¦æŒ‡å®šçº¹ç†æ‰€ç»‘å®šçš„å›¾å…ƒ</p>
</blockquote>
<p>å¯å˜é‡ varying</p>
<blockquote>
<p>ä¸€ç§é¡¶ç‚¹ç€è‰²å™¨ç»™ç‰‡æ–­ç€è‰²å™¨ä¼ å€¼çš„æ–¹å¼ã€‚<br>ä¾ç…§æ¸²æŸ“çš„å›¾å…ƒæ˜¯ç‚¹ï¼Œ çº¿è¿˜æ˜¯ä¸‰è§’å½¢ï¼Œé¡¶ç‚¹ç€è‰²å™¨ä¸­è®¾ç½®çš„å¯å˜é‡ä¼šåœ¨ç‰‡æ–­ç€è‰²å™¨è¿è¡Œä¸­è·å–ä¸åŒçš„æ’å€¼ã€‚<br>ä½¿ç”¨æ–¹æ³•ä¸ºä¸¤ä¸ªç€è‰²å™¨å®šä¹‰ä¸€ä¸ªåŒåå˜é‡ã€‚</p>
</blockquote>
<h3 id="ç€è‰²å™¨"><a href="#ç€è‰²å™¨" class="headerlink" title="ç€è‰²å™¨"></a>ç€è‰²å™¨</h3><h4 id="é¡¶ç‚¹ç€è‰²å™¨"><a href="#é¡¶ç‚¹ç€è‰²å™¨" class="headerlink" title="é¡¶ç‚¹ç€è‰²å™¨"></a>é¡¶ç‚¹ç€è‰²å™¨</h4><p>æ¯ä¸ªé¡¶ç‚¹è°ƒç”¨ä¸€æ¬¡é¡¶ç‚¹ç€è‰²å™¨ï¼Œæ¯æ¬¡è°ƒç”¨éƒ½éœ€è¦è®¾ç½®ä¸€ä¸ªç‰¹æ®Šçš„å…¨å±€å˜é‡gl_Positionï¼Œ è¯¥å˜é‡çš„å€¼å°±æ˜¯è£å‡ç©ºé—´åæ ‡å€¼ã€‚</p>
<p>æ‰€éœ€æ•°æ®è·å–æ–¹å¼ï¼š</p>
<ul>
<li>Attributes å±æ€§</li>
<li>Uniforms å…¨å±€å˜é‡</li>
<li>Textures çº¹ç†</li>
</ul>
<h4 id="ç‰‡æ®µç€è‰²å™¨"><a href="#ç‰‡æ®µç€è‰²å™¨" class="headerlink" title="ç‰‡æ®µç€è‰²å™¨"></a>ç‰‡æ®µç€è‰²å™¨</h4><p><strong>æ¯ä¸ªåƒç´ </strong>éƒ½å°†è°ƒç”¨ä¸€æ¬¡ç‰‡æ–­ç€è‰²å™¨ï¼Œæ¯æ¬¡è°ƒç”¨éœ€è¦ä»ä½ è®¾ç½®çš„ç‰¹æ®Šå…¨å±€å˜é‡gl_FragColorä¸­è·å–é¢œè‰²ä¿¡æ¯ã€‚</p>
<p>æ ¹æ®ç‰‡å…ƒç±»å‹ï¼Œå¯å˜é‡ä¼šåœ¨ç‰‡æ–­ç€è‰²å™¨è¿è¡Œä¸­è·å–ä¸åŒçš„æ’å€¼ã€‚</p>
<p>æ‰€ä»¥å¦‚æœè®¾ç½®é¢œè‰²ä¸ºå¯å˜é‡ï¼Œè¿è¡Œè¿‡ç¨‹ä¸­ä¸­é—´åƒç´ çš„é¢œè‰²ä¼šæ ¹æ®ä½ç½®æ¯”ä¾‹è·å–æ’å€¼</p>
<p>æ‰€éœ€æ•°æ®è·å–æ–¹å¼ï¼š</p>
<ul>
<li>Uniforms å…¨å±€å˜é‡</li>
<li>Textures çº¹ç†</li>
<li>Varyings å¯å˜é‡ </li>
</ul>
<h2 id="hello-world-demo"><a href="#hello-world-demo" class="headerlink" title="hello world demo"></a>hello world demo</h2><p>æ ¹æ®ä¸Šæ–‡çš„<strong>ç¨‹åºè¿è¡Œæµç¨‹</strong>ï¼Œå®ç°ä¸€ä¸ªç®€å•çš„ demo</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">HTML</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line">    canvas &#123;</span><br><span class="line">      width: 100vw;</span><br><span class="line">      height: 100vh;</span><br><span class="line">      display: block;</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">canvas</span> <span class="attr">id</span>=<span class="string">"canvas"</span>&gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="actionscript">    <span class="function"><span class="keyword">function</span> <span class="title">createShader</span><span class="params">(gl, type, source)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">      <span class="keyword">var</span> shader = gl.createShader(type); <span class="comment">// åˆ›å»ºç€è‰²å™¨å¯¹è±¡</span></span></span><br><span class="line"><span class="actionscript">      gl.shaderSource(shader, source); <span class="comment">// æä¾›æ•°æ®æº</span></span></span><br><span class="line"><span class="actionscript">      gl.compileShader(shader); <span class="comment">// ç¼–è¯‘ -&gt; ç”Ÿæˆç€è‰²å™¨</span></span></span><br><span class="line"><span class="actionscript">      <span class="keyword">var</span> success = gl.getShaderParameter(shader, gl.COMPILE_STATUS);</span></span><br><span class="line">      if (success) &#123;</span><br><span class="line"><span class="actionscript">        <span class="keyword">return</span> shader;</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(gl.getShaderInfoLog(shader));</span></span><br><span class="line">      gl.deleteShader(shader);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="actionscript">    <span class="function"><span class="keyword">function</span> <span class="title">createProgram</span><span class="params">(gl, vertexShader, fragmentShader)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">      <span class="keyword">var</span> program = gl.createProgram();</span></span><br><span class="line">      gl.attachShader(program, vertexShader);</span><br><span class="line">      gl.attachShader(program, fragmentShader);</span><br><span class="line">      gl.linkProgram(program);</span><br><span class="line"><span class="actionscript">      <span class="keyword">var</span> success = gl.getProgramParameter(program, gl.LINK_STATUS);</span></span><br><span class="line">      if (success) &#123;</span><br><span class="line"><span class="actionscript">        <span class="keyword">return</span> program;</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(gl.getProgramInfoLog(program));</span></span><br><span class="line">      gl.deleteProgram(program);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="actionscript">    <span class="function"><span class="keyword">function</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">      <span class="comment">// Get A WebGL context</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">var</span> canvas = <span class="built_in">document</span>.getElementById(<span class="string">"canvas"</span>);</span></span><br><span class="line"><span class="actionscript">      <span class="keyword">var</span> gl = canvas.getContext(<span class="string">"webgl"</span>);</span></span><br><span class="line">      if (!gl) &#123;</span><br><span class="line"><span class="actionscript">        <span class="keyword">return</span>;</span></span><br><span class="line">      &#125;</span><br><span class="line"><span class="actionscript">      <span class="comment">// æ­¥éª¤1~2ï¼Œç¼–å†™é¡¶ç‚¹ç€è‰²å™¨å’Œç‰‡æ®µç€è‰²å™¨</span></span></span><br><span class="line"><span class="actionscript">      <span class="keyword">var</span> vertexShaderSource = `</span></span><br><span class="line"><span class="actionscript">      <span class="comment">// attribute å°†ä» buffer ä¸­è·å–æ•°æ®</span></span></span><br><span class="line">      attribute vec4 a_position;</span><br><span class="line"></span><br><span class="line"><span class="actionscript">      <span class="comment">// æ‰€æœ‰ç€è‰²å™¨éƒ½æœ‰ä¸€ä¸ª main æ–¹æ³•</span></span></span><br><span class="line"><span class="actionscript">      <span class="keyword">void</span> main() &#123;</span></span><br><span class="line"><span class="actionscript">        <span class="comment">// gl_Position æ˜¯ä¸€ä¸ªé¡¶ç‚¹ç€è‰²å™¨ä¸»è¦è®¾ç½®çš„å˜é‡</span></span></span><br><span class="line">        gl_Position = a_position;</span><br><span class="line">      &#125;</span><br><span class="line">      `</span><br><span class="line"></span><br><span class="line"><span class="actionscript">      <span class="keyword">var</span> fragmentShaderSource = `</span></span><br><span class="line"><span class="actionscript">      <span class="comment">// ç‰‡æ–­ç€è‰²å™¨æ²¡æœ‰é»˜è®¤ç²¾åº¦ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è®¾ç½®ä¸€ä¸ªç²¾åº¦</span></span></span><br><span class="line"><span class="actionscript">      <span class="comment">// mediumpæ˜¯ä¸€ä¸ªä¸é”™çš„é»˜è®¤å€¼ï¼Œä»£è¡¨â€œmedium precisionâ€ï¼ˆä¸­ç­‰ç²¾åº¦ï¼‰</span></span></span><br><span class="line">      precision mediump float;</span><br><span class="line"></span><br><span class="line"><span class="actionscript">      <span class="keyword">void</span> main() &#123;</span></span><br><span class="line"><span class="actionscript">        <span class="comment">// gl_FragColoræ˜¯ä¸€ä¸ªç‰‡æ–­ç€è‰²å™¨ä¸»è¦è®¾ç½®çš„å˜é‡</span></span></span><br><span class="line"><span class="actionscript">        <span class="comment">// æœ¬ä¾‹ä¸­æˆ‘ä»¬ç›´æ¥æŒ‡å®šé¢œè‰²å±æ€§ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å…¶ä»–æ–¹å¼èµ‹å€¼</span></span></span><br><span class="line">        gl_FragColor = vec4(1, 0, 0.5, 1);</span><br><span class="line">      &#125;</span><br><span class="line">      `</span><br><span class="line"></span><br><span class="line"><span class="actionscript">      <span class="comment">// æ­¥éª¤3ï¼šå¯¹ä¸¤ä¸ªç€è‰²å™¨è¿›è¡Œç¼–è¯‘å¾—åˆ°ç€è‰²å™¨å¯¹è±¡</span></span></span><br><span class="line"><span class="actionscript">      <span class="keyword">var</span> vertexShader = createShader(gl, gl.VERTEX_SHADER, vertexShaderSource);</span></span><br><span class="line"><span class="actionscript">      <span class="keyword">var</span> fragmentShader = createShader(gl, gl.FRAGMENT_SHADER, fragmentShaderSource);</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">      <span class="comment">// æ­¥éª¤4ï¼šå°†ä¸¤ä¸ªç€è‰²å™¨å¯¹è±¡é“¾æ¥åˆ°åŒä¸€ç€è‰²ç¨‹åº</span></span></span><br><span class="line"><span class="actionscript">      <span class="keyword">var</span> program = createProgram(gl, vertexShader, fragmentShader);</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">      <span class="comment">// æ­¥éª¤5ï¼šè·å–å±æ€§å€¼ä½ç½®</span></span></span><br><span class="line"><span class="actionscript">      <span class="keyword">var</span> positionAttributeLocation = gl.getAttribLocation(program, <span class="string">"a_position"</span>);</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">      <span class="comment">// æ­¥éª¤6ï¼šç»‘å®šç¼“å†²å¹¶å­˜å…¥æ•°æ®</span></span></span><br><span class="line"><span class="actionscript">      <span class="keyword">var</span> positionBuffer = gl.createBuffer();</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">      <span class="comment">// ç»‘å®šç‚¹ä¸º ARRAY_BUFFER</span></span></span><br><span class="line">      gl.bindBuffer(gl.ARRAY_BUFFER, positionBuffer);</span><br><span class="line"></span><br><span class="line"><span class="actionscript">      <span class="keyword">var</span> positions = [</span></span><br><span class="line">        0, 0,</span><br><span class="line">        0, 0.5,</span><br><span class="line">        0.7, 0,</span><br><span class="line">      ];</span><br><span class="line"><span class="javascript">      gl.bufferData(gl.ARRAY_BUFFER, <span class="keyword">new</span> <span class="built_in">Float32Array</span>(positions), gl.STATIC_DRAW);</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="actionscript">      <span class="comment">// è¿›è¡Œæ¸²æŸ“é˜¶æ®µçš„ä»£ç å¤„ç†</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="actionscript">      <span class="comment">// æ­¥éª¤7ï¼šè®¾ç½® WebGL è£å‰ªç©ºé—´ä¸ Canvas ç”»å¸ƒå°ºå¯¸é—´çš„æ˜ å°„</span></span></span><br><span class="line">      gl.viewport(0, 0, gl.canvas.width, gl.canvas.height);</span><br><span class="line"></span><br><span class="line"><span class="actionscript">      <span class="comment">// æ¸…é™¤ç”»æ¿</span></span></span><br><span class="line">      gl.clearColor(0, 0, 0, 0);</span><br><span class="line">      gl.clear(gl.COLOR_BUFFER_BIT);</span><br><span class="line"></span><br><span class="line"><span class="actionscript">      <span class="comment">// æ­¥éª¤8ï¼šä¸º WebGL æŒ‡å®šç€è‰²ç¨‹åº</span></span></span><br><span class="line">      gl.useProgram(program);</span><br><span class="line"></span><br><span class="line"><span class="actionscript">      <span class="comment">// å¯ç”¨é¡¶ç‚¹ç€è‰²å™¨å±æ€§</span></span></span><br><span class="line">      gl.enableVertexAttribArray(positionAttributeLocation);</span><br><span class="line"></span><br><span class="line"><span class="actionscript">      <span class="comment">// æ­¥éª¤9ï¼šä»ä¹‹å‰å‡†å¤‡çš„ç¼“å†²ä¸­è·å–æ•°æ®ï¼Œå¹¶èµ‹å€¼ç»™ç€è‰²å™¨ä¸­çš„å±æ€§</span></span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">      <span class="comment">// å‘Šè¯‰å±æ€§æ€ä¹ˆä»positionBufferä¸­è¯»å–æ•°æ® (ARRAY_BUFFER)</span></span></span><br><span class="line"><span class="actionscript">      <span class="keyword">var</span> size = <span class="number">2</span>;          <span class="comment">// æ¯æ¬¡è¿­ä»£è¿è¡Œæå–ä¸¤ä¸ªå•ä½æ•°æ®</span></span></span><br><span class="line"><span class="actionscript">      <span class="keyword">var</span> type = gl.FLOAT;   <span class="comment">// æ¯ä¸ªå•ä½çš„æ•°æ®ç±»å‹æ˜¯32ä½æµ®ç‚¹å‹</span></span></span><br><span class="line"><span class="actionscript">      <span class="keyword">var</span> normalize = <span class="literal">false</span>; <span class="comment">// ä¸éœ€è¦å½’ä¸€åŒ–æ•°æ®</span></span></span><br><span class="line"><span class="actionscript">      <span class="keyword">var</span> stride = <span class="number">0</span>;        <span class="comment">// 0 = ç§»åŠ¨å•ä½æ•°é‡ * æ¯ä¸ªå•ä½å ç”¨å†…å­˜ï¼ˆsizeof(type)ï¼‰</span></span></span><br><span class="line"><span class="actionscript">      <span class="comment">// æ¯æ¬¡è¿­ä»£è¿è¡Œè¿åŠ¨å¤šå°‘å†…å­˜åˆ°ä¸‹ä¸€ä¸ªæ•°æ®å¼€å§‹ç‚¹</span></span></span><br><span class="line"><span class="actionscript">      <span class="keyword">var</span> offset = <span class="number">0</span>;        <span class="comment">// ä»ç¼“å†²èµ·å§‹ä½ç½®å¼€å§‹è¯»å–</span></span></span><br><span class="line">      gl.vertexAttribPointer(</span><br><span class="line">        positionAttributeLocation, size, type, normalize, stride, offset);</span><br><span class="line"></span><br><span class="line"><span class="actionscript">      <span class="comment">// æ­¥éª¤10ï¼šæŒ‡å®šç»˜åˆ¶çš„å›¾å…ƒç±»å‹ï¼Œè¿è¡Œå¤šæ¬¡é¡¶ç‚¹ç€è‰²å™¨ï¼Œå¾—åˆ°å›¾å…ƒï¼Œå¹¶åˆ©ç”¨ç‰‡æ®µç€è‰²å™¨è¿›è¡Œå›¾å…ƒç»˜åˆ¶</span></span></span><br><span class="line"><span class="actionscript">      <span class="keyword">var</span> primitiveType = gl.TRIANGLES;</span></span><br><span class="line"><span class="actionscript">      <span class="keyword">var</span> offset = <span class="number">0</span>;</span></span><br><span class="line"><span class="actionscript">      <span class="keyword">var</span> count = <span class="number">3</span>;</span></span><br><span class="line">      gl.drawArrays(primitiveType, offset, count);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    main();</span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°é¡µé¢ä¸­æ¸²æŸ“äº†ä¸€ä¸ªä¸‰è§’å½¢ï¼Œå¹¶ä¸”è¾¹ç¼˜å¸¦æœ‰ä¸€äº›é”¯é½¿ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p>
<p>è¿™äº›é”¯é½¿ä¸é¡¶ç‚¹æ•°æ®è½¬ä¸ºç‰‡æ®µçš„æ–¹å¼æœ‰å…³ï¼Œä¹‹åçš„æ–‡ç« ä¼šæåˆ°æŠ—é”¯é½¿çš„æ–¹æ³•ã€‚</p>
<h2 id="æ‹“å±•é˜…è¯»"><a href="#æ‹“å±•é˜…è¯»" class="headerlink" title="æ‹“å±•é˜…è¯»"></a>æ‹“å±•é˜…è¯»</h2><ol>
<li><a href="https://webglfundamentals.org/webgl/lessons/zh_cn/" target="_blank" rel="noopener">WebGL ç†è®ºåŸºç¡€</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/WebGL_API/Tutorial" target="_blank" rel="noopener">WebGL æ•™ç¨‹</a></li>
</ol>
]]></content>
      <categories>
        <category>å¤§å‰ç«¯</category>
      </categories>
      <tags>
        <tag>WebGL</tag>
      </tags>
  </entry>
  <entry>
    <title>å‰ç«¯é¡¹ç›®ä¸­å¸¸ç”¨çš„ä½æ“ä½œæŠ€å·§</title>
    <url>/2020/02/16/2020/%E5%89%8D%E7%AB%AF%E9%A1%B9%E7%9B%AE%E4%B8%AD%E5%B8%B8%E7%94%A8%E7%9A%84%E4%BD%8D%E6%93%8D%E4%BD%9C%E6%8A%80%E5%B7%A7/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å¤§éƒ¨åˆ†ä¾‹å­å¼•ç”¨è‡ª <a href="https://graphics.stanford.edu/~seander/bithacks.html" target="_blank" rel="noopener">Bit Twiddling Hacks</a></p>
<p>ä¸€äº›ä½æ“ä½œä¼˜åŒ–çš„æŠ€å·§åœ¨ js ä¸­ä¸ä¸€å®šèƒ½å¾—åˆ°ä½“ç°ï¼Œæœ¬æ–‡ä»…å±•ç¤ºä¸€äº›è‡ªå·±åœ¨å‰ç«¯é¡¹ç›®ä¸­ç”¨è¿‡ä¸”è¾ƒå¸¸ç”¨çš„ä¾‹å­</p>
<p>æŸäº›ä¾‹å­æ¯”å¦‚äº¤æ¢ï¼Œè®¡ç®—å¥‡å¶ï¼Œè®¡ç®—æœ€å€¼çš„ï¼Œä½¿ç”¨ä½æ“ä½œæå‡ä¸å¤§ï¼Œä½†å¯è¯»æ€§å˜å·®äº†ï¼Œæœ¬æ–‡ä¸åšè®°å½•</p>
<a id="more"></a>

<h2 id="1-æ£€æµ‹ä¸¤ä¸ªæ•´æ•°æ˜¯å¦å¼‚å·"><a href="#1-æ£€æµ‹ä¸¤ä¸ªæ•´æ•°æ˜¯å¦å¼‚å·" class="headerlink" title="1. æ£€æµ‹ä¸¤ä¸ªæ•´æ•°æ˜¯å¦å¼‚å·"></a>1. æ£€æµ‹ä¸¤ä¸ªæ•´æ•°æ˜¯å¦å¼‚å·</h2><p>æœ¬å¤„ä¾‹å­ä¸­ï¼Œ0 ä¸æ­£æ•°ç›¸å½“</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> isOppositeSign = <span class="function">(<span class="params">x, y</span>) =&gt;</span> (x ^ y) &lt; <span class="number">0</span></span><br><span class="line">isOppositeSign(<span class="number">1</span>, <span class="number">-2</span>)  <span class="comment">// true</span></span><br><span class="line">isOppositeSign(<span class="number">1</span>, <span class="number">2</span>)   <span class="comment">// false</span></span><br><span class="line">isOppositeSign(<span class="number">-0</span>, <span class="number">-1</span>) <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<h2 id="2-åˆ¤æ–­ä¸€ä¸ªæ•´æ•°æ˜¯å¦ä¸º-2-çš„å¹‚"><a href="#2-åˆ¤æ–­ä¸€ä¸ªæ•´æ•°æ˜¯å¦ä¸º-2-çš„å¹‚" class="headerlink" title="2. åˆ¤æ–­ä¸€ä¸ªæ•´æ•°æ˜¯å¦ä¸º 2 çš„å¹‚"></a>2. åˆ¤æ–­ä¸€ä¸ªæ•´æ•°æ˜¯å¦ä¸º 2 çš„å¹‚</h2><p>æ³¨æ„ 0 ä¸æ˜¯ 2 çš„å¹‚ï¼ŒåŠ ä¸Š <code>!!num</code> åˆ¤æ–­</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> isPowerOf2 = <span class="function">(<span class="params">num</span>) =&gt;</span> !!num &amp;&amp; (num &amp; (num - <span class="number">1</span>)) === <span class="number">0</span></span><br><span class="line">isPowerOf2 (<span class="number">0</span>) <span class="comment">// false</span></span><br><span class="line">isPowerOf2 (<span class="number">1</span>) <span class="comment">// true</span></span><br><span class="line">isPowerOf2 (<span class="number">3</span>) <span class="comment">// false</span></span><br></pre></td></tr></table></figure>

<h2 id="3-è®¡ç®—æ— ç¬¦å·æ•´æ•°çš„æ¯”ç‰¹ä½ä¸­æœ‰å¤šå°‘ä¸ª-1"><a href="#3-è®¡ç®—æ— ç¬¦å·æ•´æ•°çš„æ¯”ç‰¹ä½ä¸­æœ‰å¤šå°‘ä¸ª-1" class="headerlink" title="3. è®¡ç®—æ— ç¬¦å·æ•´æ•°çš„æ¯”ç‰¹ä½ä¸­æœ‰å¤šå°‘ä¸ª 1"></a>3. è®¡ç®—æ— ç¬¦å·æ•´æ•°çš„æ¯”ç‰¹ä½ä¸­æœ‰å¤šå°‘ä¸ª 1</h2><p>å¸¸ç”¨äºç»Ÿè®¡ä¸€ç»„å¼€å…³ä¸­çŠ¶æ€ä¸ºå¼€çš„ä¸ªæ•°</p>
<h3 id="åŸå§‹æ–¹æ³•"><a href="#åŸå§‹æ–¹æ³•" class="headerlink" title="åŸå§‹æ–¹æ³•"></a>åŸå§‹æ–¹æ³•</h3><p>å¯¹ num ä¸æ–­å³ç§»ï¼Œæ¯æ¬¡åˆ¤æ–­æœ€åä¸€ä½æ˜¯å¦ä¸º1ï¼Œå¾ªç¯æ¬¡æ•°ä¸º num çš„æ¯”ç‰¹ä½ä¸ªæ•°</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> countBits = <span class="function">(<span class="params">num</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> res = <span class="number">0</span></span><br><span class="line">  <span class="keyword">for</span> (; num; num &gt;&gt;= <span class="number">1</span>) &#123;</span><br><span class="line">    res += num &amp; <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> res</span><br><span class="line">&#125;</span><br><span class="line">countBits (<span class="number">4</span>) <span class="comment">// 1</span></span><br></pre></td></tr></table></figure>

<h3 id="Brian-Kernighanâ€™s-way"><a href="#Brian-Kernighanâ€™s-way" class="headerlink" title="Brian Kernighanâ€™s way"></a>Brian Kernighanâ€™s way</h3><p>æ¯æ¬¡æ¸…é™¤ä¸€ä¸ªæœ€ä½çš„ 1 çš„æ¯”ç‰¹ä½ï¼Œå¾ªç¯æ¬¡æ•°ä¸ num çš„æ¯”ç‰¹ä½æœ‰å¤šå°‘ä¸ª 1 ç›¸å…³</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> countBits = <span class="function">(<span class="params">num</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> c = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (; num; c++) &#123;</span><br><span class="line">    num &amp;= num - <span class="number">1</span>; <span class="comment">// æ¸…é™¤æœ€ä½æ¯”ç‰¹ä½</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> c</span><br><span class="line">&#125;</span><br><span class="line">countBits (<span class="number">5</span>) <span class="comment">// 2</span></span><br></pre></td></tr></table></figure>

<h2 id="4-è·å–æœ€é«˜ä½-1-æ‰€åœ¨ä½ç½®"><a href="#4-è·å–æœ€é«˜ä½-1-æ‰€åœ¨ä½ç½®" class="headerlink" title="4. è·å–æœ€é«˜ä½ 1 æ‰€åœ¨ä½ç½®"></a>4. è·å–æœ€é«˜ä½ 1 æ‰€åœ¨ä½ç½®</h2><p>å¾—åˆ°ä¸€ä¸ªç´¢å¼•å€¼</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> getHighest1BitIndex = <span class="function">(<span class="params">num</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> c = <span class="number">-1</span></span><br><span class="line">  <span class="keyword">while</span> (num) &#123;</span><br><span class="line">    num &gt;&gt;= <span class="number">1</span></span><br><span class="line">    c++</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> c</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åŒæ—¶å¯ä»¥ç”¨æ¥è®¡ç®—ä¸€ä¸ªæ•´æ•°ä»¥ 2 ä¸ºåº•çš„å¯¹æ•°ï¼Œå…¶ä»–æ‹“å±•åº”ç”¨ï¼š</p>
<h3 id="è·å–æŸä¸ªèŒƒå›´å†…æœ€å¤§çš„-2-çš„å¹‚"><a href="#è·å–æŸä¸ªèŒƒå›´å†…æœ€å¤§çš„-2-çš„å¹‚" class="headerlink" title="è·å–æŸä¸ªèŒƒå›´å†…æœ€å¤§çš„ 2 çš„å¹‚"></a>è·å–æŸä¸ªèŒƒå›´å†…æœ€å¤§çš„ 2 çš„å¹‚</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> hignBit = <span class="function">(<span class="params">num</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> index = getHighest1BitIndex(num)</span><br><span class="line">  <span class="keyword">return</span> <span class="number">1</span> &lt;&lt; index</span><br><span class="line">&#125;</span><br><span class="line">hignBit(<span class="number">14</span>) <span class="comment">// 8</span></span><br><span class="line">hignBit(<span class="number">8</span>) <span class="comment">// 8</span></span><br></pre></td></tr></table></figure>

<p>å¦ä¸€ç§è§£æ³•</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> hignBit = <span class="function">(<span class="params">num</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> res;</span><br><span class="line">  <span class="keyword">while</span> (num) &#123;</span><br><span class="line">    res = num</span><br><span class="line">    num = num &amp; (num - <span class="number">1</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> res</span><br><span class="line">&#125;</span><br><span class="line">hignBit(<span class="number">14</span>) <span class="comment">// 8</span></span><br><span class="line">hignBit(<span class="number">8</span>) <span class="comment">// 8</span></span><br></pre></td></tr></table></figure>

<h2 id="5-è·å–æœ€ä½ä½-1-æ‰€åœ¨ä½ç½®"><a href="#5-è·å–æœ€ä½ä½-1-æ‰€åœ¨ä½ç½®" class="headerlink" title="5. è·å–æœ€ä½ä½ 1 æ‰€åœ¨ä½ç½®"></a>5. è·å–æœ€ä½ä½ 1 æ‰€åœ¨ä½ç½®</h2><p>åˆ©ç”¨ <code>n &amp; -n</code> ï¼ˆåˆç§° lowbit å‡½æ•°ï¼‰å¾—åˆ°æœ€ä½ä½ 1 å½¢æˆçš„æ•°ï¼Œç„¶åä¸æ–­å³ç§»å¾—åˆ°ç´¢å¼•å€¼</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> lowBit = <span class="function">(<span class="params">num</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> num &amp; -num</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> getLowest1BitIndex = <span class="function">(<span class="params">num</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> n = lowBit(num)</span><br><span class="line">  <span class="comment">// return getHighest1BitIndex(n)</span></span><br><span class="line">  <span class="keyword">let</span> c = <span class="number">-1</span></span><br><span class="line">  <span class="keyword">while</span> (n) &#123;</span><br><span class="line">    n &gt;&gt;= <span class="number">1</span></span><br><span class="line">    c++</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> c</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ ‘çŠ¶æ•°ç»„ä¸­ç»å¸¸ç”¨åˆ° lowbit</p>
<h2 id="6-è·å–æŸä¸ªä½ç½®çš„æ¯”ç‰¹ä½"><a href="#6-è·å–æŸä¸ªä½ç½®çš„æ¯”ç‰¹ä½" class="headerlink" title="6. è·å–æŸä¸ªä½ç½®çš„æ¯”ç‰¹ä½"></a>6. è·å–æŸä¸ªä½ç½®çš„æ¯”ç‰¹ä½</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> getBit = <span class="function">(<span class="params">num, i=<span class="number">0</span></span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// i ä» 0 å¼€å§‹</span></span><br><span class="line">  <span class="keyword">return</span> (num &gt;&gt; i) &amp; <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line">getBit(<span class="number">5</span>,<span class="number">1</span>)</span><br></pre></td></tr></table></figure>

<h2 id="7-åˆ¤æ–­ä¸¤ä¸ªä½ç½®çš„æ¯”ç‰¹ä½æ˜¯å¦ä¸€è‡´"><a href="#7-åˆ¤æ–­ä¸¤ä¸ªä½ç½®çš„æ¯”ç‰¹ä½æ˜¯å¦ä¸€è‡´" class="headerlink" title="7. åˆ¤æ–­ä¸¤ä¸ªä½ç½®çš„æ¯”ç‰¹ä½æ˜¯å¦ä¸€è‡´"></a>7. åˆ¤æ–­ä¸¤ä¸ªä½ç½®çš„æ¯”ç‰¹ä½æ˜¯å¦ä¸€è‡´</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> getBit = <span class="function">(<span class="params">num, i = <span class="number">0</span></span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (num &gt;&gt; i) &amp; <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> judgeSameBit = <span class="function">(<span class="params">num, i, j</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// const lo = getBit(num, i)</span></span><br><span class="line">  <span class="comment">// const hi = getBit(num, j)</span></span><br><span class="line">  <span class="comment">// return !(lo ^ hi)</span></span><br><span class="line">  <span class="keyword">return</span> !(((num &gt;&gt; i) ^ (num &gt;&gt; j)) &amp; <span class="number">1</span>)</span><br><span class="line">&#125;</span><br><span class="line">judgeSameBit(<span class="number">6</span>, <span class="number">0</span>, <span class="number">2</span>) <span class="comment">// false</span></span><br><span class="line">judgeSameBit(<span class="number">6</span>, <span class="number">1</span>, <span class="number">2</span>) <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<h2 id="8-äº¤æ¢æ¯”ç‰¹ä½"><a href="#8-äº¤æ¢æ¯”ç‰¹ä½" class="headerlink" title="8. äº¤æ¢æ¯”ç‰¹ä½"></a>8. äº¤æ¢æ¯”ç‰¹ä½</h2><h3 id="äº¤æ¢å•ä¸ªæ¯”ç‰¹ä½"><a href="#äº¤æ¢å•ä¸ªæ¯”ç‰¹ä½" class="headerlink" title="äº¤æ¢å•ä¸ªæ¯”ç‰¹ä½"></a>äº¤æ¢å•ä¸ªæ¯”ç‰¹ä½</h3><p>åŸå§‹åºåˆ—ä¸º S, å°†ç¬¬ i ä¸ª(ä»å³å¾€å·¦æ•°ï¼Œèµ·å§‹ç´¢å¼•ä¸º0) ä¸ ç¬¬ j ä¸ªæ¯”ç‰¹ä½è¿›è¡Œäº¤æ¢</p>
<p>å…ˆåˆ¤æ–­ä¸¤ä¸ªä½ç½®æ¯”ç‰¹ä½æ˜¯å¦ä¸€è‡´ï¼Œå¾—åˆ°ä¸€ä¸ªå¼‚æˆ–çš„ç»“æœ x</p>
<p>å°†æ‰€æœ‰ä½ç½®ç½® 0ï¼Œiã€j ç½®ä¸º x : <code>(x &lt;&lt; i) | (x &lt;&lt; j)</code> ï¼Œå¾—åˆ°ç»“æœ res</p>
<p>æœ€åå°†åŸå§‹åºåˆ—ä¸ res è¿›è¡Œå¼‚æˆ–ï¼Œå³å¯å®ç°äº¤æ¢æ¯”ç‰¹ä½çš„æ•ˆæœ</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> swapBit = <span class="function">(<span class="params">num, i, j</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> x = ((num &gt;&gt; i) ^ (num &gt;&gt; j)) &amp; <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">return</span> num ^ ((x &lt;&lt; i) | (x &lt;&lt; j));</span><br><span class="line">&#125;</span><br><span class="line">swapBit(<span class="number">4</span>, <span class="number">0</span>, <span class="number">2</span>) <span class="comment">//1</span></span><br></pre></td></tr></table></figure>


<h3 id="äº¤æ¢æŒ‡å®šé•¿åº¦çš„æ¯”ç‰¹ä½"><a href="#äº¤æ¢æŒ‡å®šé•¿åº¦çš„æ¯”ç‰¹ä½" class="headerlink" title="äº¤æ¢æŒ‡å®šé•¿åº¦çš„æ¯”ç‰¹ä½"></a>äº¤æ¢æŒ‡å®šé•¿åº¦çš„æ¯”ç‰¹ä½</h3><p>åŸå§‹åºåˆ—ä¸º S, å°†ç¬¬ i ä½(ä»å³å¾€å·¦æ•°ï¼Œèµ·å§‹ç´¢å¼•ä¸º0)å¼€å§‹ï¼Œé•¿åº¦ä¸º len çš„åºåˆ—ä¸ ç¬¬ j ä½å¼€å§‹ï¼Œé•¿åº¦ä¸º len çš„åºåˆ—è¿›è¡Œäº¤æ¢</p>
<p>ä¸¾ä¾‹ï¼ŒS = <code>00010111</code> i=0 j=4 len=3 äº¤æ¢åå¾—åˆ° <code>01110001</code></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> swapIndividualBits = <span class="function">(<span class="params">num, i, j, len</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> x = ((num &gt;&gt; i) ^ (num &gt;&gt; j)) &amp; ((<span class="number">1</span> &lt;&lt; len) - <span class="number">1</span>);</span><br><span class="line">  <span class="keyword">return</span> num ^ ((x &lt;&lt; i) | (x &lt;&lt; j));</span><br><span class="line">&#125;</span><br><span class="line">swapIndividualBits (<span class="number">23</span>,<span class="number">0</span>,<span class="number">4</span>,<span class="number">3</span>) <span class="comment">//113 23=&gt;0010111(2) 113=&gt;01110001(2)</span></span><br></pre></td></tr></table></figure>

<p>å¸¸ç”¨äºç§»åŠ¨ä¸€ç»„å¼€å…³çš„ä½ç½®</p>
<h2 id="9-åè½¬æ¯”ç‰¹åºåˆ—"><a href="#9-åè½¬æ¯”ç‰¹åºåˆ—" class="headerlink" title="9. åè½¬æ¯”ç‰¹åºåˆ—"></a>9. åè½¬æ¯”ç‰¹åºåˆ—</h2><p>ç”±äº js ä¸­ä¸èƒ½æŒ‡å®šä¸€ä¸ªæ•°å­—ç±»å‹çš„å­˜å‚¨å¤§å°ï¼Œè¿™é‡Œéœ€è¦æ‰‹åŠ¨æŒ‡å®šä¸€å…±æœ‰å¤šå°‘æ¯”ç‰¹ä½</p>
<h3 id="åŸå§‹æ–¹æ³•-1"><a href="#åŸå§‹æ–¹æ³•-1" class="headerlink" title="åŸå§‹æ–¹æ³•"></a>åŸå§‹æ–¹æ³•</h3><p>å¤´å°¾ä¸¤ä¸¤äº¤æ¢ <code>O(n)</code></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> swapBit = <span class="function">(<span class="params">num, i, j</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> x = ((num &gt;&gt; i) ^ (num &gt;&gt; j)) &amp; <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">return</span> num ^ ((x &lt;&lt; i) | (x &lt;&lt; j));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> reverseBits = <span class="function">(<span class="params">num, n = <span class="number">8</span></span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> len = n &gt;&gt; <span class="number">1</span></span><br><span class="line">  <span class="keyword">let</span> res = num</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">    res = swapBit(res, i, n - i - <span class="number">1</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> res</span><br><span class="line">&#125;</span><br><span class="line">reverseBits(<span class="number">111</span>) <span class="comment">// 246  due to 01101111 =&gt; (0)11110110</span></span><br></pre></td></tr></table></figure>

<h3 id="åˆ†æ²»æ³•"><a href="#åˆ†æ²»æ³•" class="headerlink" title="åˆ†æ²»æ³•"></a>åˆ†æ²»æ³•</h3><p>ä»…é€‚ç”¨äºå›ºå®šå­—èŠ‚ï¼Œåœ¨ js ä¸­ä¸å¤ªé€‚ç”¨</p>
<h2 id="10-æŸ¥æ‰¾æ•°å­—"><a href="#10-æŸ¥æ‰¾æ•°å­—" class="headerlink" title="10. æŸ¥æ‰¾æ•°å­—"></a>10. æŸ¥æ‰¾æ•°å­—</h2><h3 id="ä»…ä¸€ä¸ªå…ƒç´ å‡ºç°ä¸€æ¬¡ï¼Œå…¶ä½™å…ƒç´ å‡ºç°2æ¬¡"><a href="#ä»…ä¸€ä¸ªå…ƒç´ å‡ºç°ä¸€æ¬¡ï¼Œå…¶ä½™å…ƒç´ å‡ºç°2æ¬¡" class="headerlink" title="ä»…ä¸€ä¸ªå…ƒç´ å‡ºç°ä¸€æ¬¡ï¼Œå…¶ä½™å…ƒç´ å‡ºç°2æ¬¡"></a>ä»…ä¸€ä¸ªå…ƒç´ å‡ºç°ä¸€æ¬¡ï¼Œå…¶ä½™å…ƒç´ å‡ºç°2æ¬¡</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> singleNumber = <span class="function"><span class="keyword">function</span>(<span class="params">nums</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> nums.reduce(<span class="function">(<span class="params">pre,cur</span>)=&gt;</span>pre^cur)  </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="ä»…ä¸€ä¸ªå…ƒç´ å‡ºç°ä¸€æ¬¡ï¼Œå…¶ä½™å…ƒç´ å‡ºç°-k-æ¬¡"><a href="#ä»…ä¸€ä¸ªå…ƒç´ å‡ºç°ä¸€æ¬¡ï¼Œå…¶ä½™å…ƒç´ å‡ºç°-k-æ¬¡" class="headerlink" title="ä»…ä¸€ä¸ªå…ƒç´ å‡ºç°ä¸€æ¬¡ï¼Œå…¶ä½™å…ƒç´ å‡ºç° k æ¬¡"></a>ä»…ä¸€ä¸ªå…ƒç´ å‡ºç°ä¸€æ¬¡ï¼Œå…¶ä½™å…ƒç´ å‡ºç° k æ¬¡</h3><p>æ€è·¯è§ <a href="https://github.com/francecil/leetcode/issues/12" target="_blank" rel="noopener">leetcode-137. åªå‡ºç°ä¸€æ¬¡çš„æ•°å­— II</a></p>
<p>ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> singleNumber = <span class="function"><span class="keyword">function</span> (<span class="params">nums, k=<span class="number">3</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (nums.length === <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> nums[<span class="number">0</span>]</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> base = <span class="number">1</span></span><br><span class="line">  <span class="keyword">let</span> res = <span class="number">0</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">32</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">let</span> cnk = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> j = <span class="number">0</span>; j &lt; nums.length; j++) &#123;</span><br><span class="line">      cnk += nums[j] &amp; base ? <span class="number">1</span> : <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (cnk % <span class="number">3</span> !== <span class="number">0</span>) &#123;</span><br><span class="line">      res |= base</span><br><span class="line">    &#125;</span><br><span class="line">    base &lt;&lt;= <span class="number">1</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> res</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="æ°å¥½æœ‰ä¸¤ä¸ªå…ƒç´ åªå‡ºç°ä¸€æ¬¡ï¼Œå…¶ä½™æ‰€æœ‰å…ƒç´ å‡å‡ºç°ä¸¤æ¬¡"><a href="#æ°å¥½æœ‰ä¸¤ä¸ªå…ƒç´ åªå‡ºç°ä¸€æ¬¡ï¼Œå…¶ä½™æ‰€æœ‰å…ƒç´ å‡å‡ºç°ä¸¤æ¬¡" class="headerlink" title="æ°å¥½æœ‰ä¸¤ä¸ªå…ƒç´ åªå‡ºç°ä¸€æ¬¡ï¼Œå…¶ä½™æ‰€æœ‰å…ƒç´ å‡å‡ºç°ä¸¤æ¬¡"></a>æ°å¥½æœ‰ä¸¤ä¸ªå…ƒç´ åªå‡ºç°ä¸€æ¬¡ï¼Œå…¶ä½™æ‰€æœ‰å…ƒç´ å‡å‡ºç°ä¸¤æ¬¡</h3><p>æ€è·¯è§ <a href="https://github.com/francecil/leetcode/issues/13" target="_blank" rel="noopener">leetcode-260. åªå‡ºç°ä¸€æ¬¡çš„æ•°å­— III</a></p>
<p>ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> singleNumber = <span class="function"><span class="keyword">function</span> (<span class="params">nums</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (nums.length === <span class="number">2</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> nums</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> res = nums.reduce(<span class="function">(<span class="params">a, b</span>) =&gt;</span> a ^ b)</span><br><span class="line">  <span class="comment">// å–æœ€ä½é0ä½ï¼Œä¸¤ä¸ªæ•°åœ¨è¯¥ä½ä¸Š ä¸€ä¸ªä¸º0 ä¸€ä¸ªä¸º1ï¼Œ  </span></span><br><span class="line">  <span class="comment">// è¿›è¡Œ æ•°ç»„åˆ’åˆ† è¯¥ä½ä¸º1çš„ä¸€ç»„ï¼Œè¯¥ä½ä¸º0çš„ä¸€ç»„</span></span><br><span class="line">  <span class="keyword">let</span> tmp = res &amp; -res</span><br><span class="line">  <span class="keyword">let</span> res1 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">let</span> res2 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; nums.length; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (nums[i] &amp; tmp) &#123;</span><br><span class="line">      res1 ^= nums[i]</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      res2 ^= nums[i]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> [res1, res2]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<hr>
<p>æœªå®Œå¾…ç»­â€¦</p>
<h2 id="æ‹“å±•é˜…è¯»"><a href="#æ‹“å±•é˜…è¯»" class="headerlink" title="æ‹“å±•é˜…è¯»"></a>æ‹“å±•é˜…è¯»</h2><ol>
<li><a href="https://graphics.stanford.edu/~seander/bithacks.html" target="_blank" rel="noopener">Bit Twiddling Hacks</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/37014715" target="_blank" rel="noopener">Bit Hacksï¼šå…³äºä¸€åˆ‡ä½æ“ä½œçš„é­”æ³•ï¼ˆä¸Šï¼‰</a></li>
</ol>
]]></content>
      <categories>
        <category>å¤§å‰ç«¯</category>
      </categories>
      <tags>
        <tag>ä½è¿ç®—</tag>
        <tag>JavaScript</tag>
      </tags>
  </entry>
  <entry>
    <title>åŸºäº opencv.js å®ç°å›¾åƒå†…çŸ©å½¢ç‰©å“çš„è‡ªåŠ¨æå–</title>
    <url>/2020/01/17/2020/%E5%9F%BA%E4%BA%8E%20opencv.js%20%E5%AE%9E%E7%8E%B0%E5%9B%BE%E5%83%8F%E5%86%85%E7%9F%A9%E5%BD%A2%E7%89%A9%E5%93%81%E7%9A%84%E8%87%AA%E5%8A%A8%E6%8F%90%E5%8F%96/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å¤§å­¦çš„æ—¶å€™ç ”ç©¶äº†ä¸€æ®µæ—¶é—´çš„ OpenCV ï¼Œå½“æ—¶åšäº†ä¸€ä¸ªè¿™æ ·çš„å°å·¥å…· <a href="https://github.com/francecil/RunFace" target="_blank" rel="noopener">RunFace</a>ï¼š</p>
<a id="more"></a>

<p>æœ‰ä¸¤å¼ ç…§ç‰‡ï¼Œç¬¬ä¸€å¼ ç…§ç‰‡å¸¦ç™½çº¸ï¼Œé€šè¿‡åˆæˆä¼šå°†ç¬¬äºŒå¼ ç…§ç‰‡è½¬æ¢åˆ°ç¬¬ä¸€å¼ ç…§ç‰‡çš„ç™½çº¸å¤„</p>
<p><img src="https://upload-images.jianshu.io/upload_images/9277731-f4c330edac89029a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ç‰©å“æ›¿æ¢"></p>
<p>æ­£å¥½æœ€è¿‘çœ‹åˆ° OpenCV åœ¨å‰ç«¯æœ‰å¯¹åº”çš„å®ç°åº“ï¼Œå°±æƒ³ç€åšä¸ªçº¯å‰ç«¯ç‰ˆæœ¬ï¼Œè¿™æ¬¡æˆ‘ä»¬å®ç°åå‘æ•ˆæœï¼Œå°†åˆæˆå›¾ä¸­çš„çŸ©å½¢å›¾åƒæå–å‡ºæ¥</p>
<p><img src="https://upload-images.jianshu.io/upload_images/9277731-a65795c8ec1f9735.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="rectangle-extract"></p>
<p>å·²å¼€æºï¼Œè¯¦è§ <a href="https://github.com/francecil/rectangle-extract-opencvjs" target="_blank" rel="noopener">rectangle-extract-opencvjs</a> </p>
<p><a href="https://francecil.github.io/rectangle-extract-opencvjs/" target="_blank" rel="noopener">åœ¨çº¿åœ°å€</a></p>
<p>ä¸»è¦çš„åº”ç”¨åœºæ™¯æœ‰ï¼šå»é™¤èº«ä»½è¯ç…§èƒŒæ™¯å¾—åˆ°æ‰«æä»¶</p>
<blockquote>
<p>å½“ç„¶ï¼Œè¿™äº›ç”¨ ps å¾ˆå®¹æ˜“å®ç°</p>
</blockquote>
<h2 id="å®ç°è¦ç‚¹"><a href="#å®ç°è¦ç‚¹" class="headerlink" title="å®ç°è¦ç‚¹"></a>å®ç°è¦ç‚¹</h2><h3 id="ä¸€ã€ç”Ÿæˆ-opencv-js"><a href="#ä¸€ã€ç”Ÿæˆ-opencv-js" class="headerlink" title="ä¸€ã€ç”Ÿæˆ opencv.js"></a>ä¸€ã€ç”Ÿæˆ opencv.js</h3><p>å¯ä»¥é€‰æ‹©è‡ªå·±ç¼–è¯‘ï¼Œç”¨çš„æ˜¯ LLVM é‚£å¥—å·¥å…·é“¾</p>
<p>è¯¦è§ <a href="https://docs.opencv.org/4.2.0/d4/da1/tutorial_js_setup.html" target="_blank" rel="noopener">Build OpenCV.js</a></p>
<p>æˆ‘æ˜¯ç›´æ¥ç”¨çš„ç°æˆçš„ js æ–‡ä»¶ï¼Œå¤§æ¦‚ 8M </p>
<p>æœ‰ä¸ªç–‘é—®ï¼Œè‡ªå·±ç¼–è¯‘çš„è¯ä¸çŸ¥æ˜¯å¦å¯ä»¥é€‰æ‹©ä»…ç¼–è¯‘æŸäº›æ¨¡å—ï¼Œè¿™æ ·ç”Ÿæˆçš„åŒ…å°±æ¯”è¾ƒå°äº†</p>
<h3 id="äºŒã€ç®—æ³•æµç¨‹"><a href="#äºŒã€ç®—æ³•æµç¨‹" class="headerlink" title="äºŒã€ç®—æ³•æµç¨‹"></a>äºŒã€ç®—æ³•æµç¨‹</h3><p><img src="https://upload-images.jianshu.io/upload_images/9277731-7f8c188b0b79fbdf.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="çŸ©å½¢æŠ½ç¦»æµç¨‹å›¾"></p>
<p>æˆ‘ä»¬ä»¥ä¸‹é¢åŸå›¾ä¸ºä¾‹</p>
<p><img src="https://user-gold-cdn.xitu.io/2020/1/21/16fc6b8a3bef2cb0?w=1334&h=1000&f=jpeg&s=156315" alt="åŸå›¾"></p>
<h4 id="é¢„å¤„ç†"><a href="#é¢„å¤„ç†" class="headerlink" title="é¢„å¤„ç†"></a>é¢„å¤„ç†</h4><p>åˆ†ä¸ºå°ºå¯¸è°ƒæ•´å’Œæ»¤æ³¢</p>
<p>å°ºå¯¸è°ƒæ•´æ˜¯å°†å›¾ç‰‡å®½é«˜ç­‰æ¯”ä¾‹ç¼©å°åˆ° 200px ä»¥å†…ï¼Œç›®çš„æ˜¯ä¸ºäº†æé«˜å¤„ç†æ•ˆç‡ï¼Œä¸”è®©æ»¤æ³¢æ•ˆæœæ›´å¥½</p>
<p>æ»¤æ³¢çš„ä½œç”¨æ˜¯ä¿è¾¹ï¼ˆè¾¹ç¼˜é”åŒ–ï¼‰å»å™ªï¼ˆå»é™¤çº¹ç†ï¼‰ï¼Œæ–¹ä¾¿åç»­ç›®æ ‡å›¾åƒçš„æå–</p>
<p>æ»¤æ³¢å¯ä»¥ç”¨ åŒè¾¹æ»¤æ³¢ æˆ–è€… meanshift æ»¤æ³¢</p>
<p><img src="https://upload-images.jianshu.io/upload_images/9277731-996a1fdd15be6a67.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é¢„å¤„ç†"></p>
<h4 id="æå–å‰æ™¯å›¾"><a href="#æå–å‰æ™¯å›¾" class="headerlink" title="æå–å‰æ™¯å›¾"></a>æå–å‰æ™¯å›¾</h4><p>åœ¨å½“å‰åº”ç”¨åœºæ™¯ï¼Œç›®æ ‡çŸ©å½¢å›¾åƒå æ¯”è¾ƒå¤§ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥å–ä¸­ç‚¹è¿›è¡Œæ¼«æ°´å¡«å……</p>
<p>å³é€šè¿‡åº”ç”¨ floodFill ç®—æ³•å¾—åˆ°ç°åº¦å›¾</p>
<p><img src="https://upload-images.jianshu.io/upload_images/9277731-b168ca6699ab95a5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æ¼«æ°´å¡«å……"></p>
<p>åº”ç”¨ä¸­å€¼æ»¤æ³¢å»å™ª</p>
<p><img src="https://upload-images.jianshu.io/upload_images/9277731-38ac88389cd3472e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ä¸­å€¼å»å™ª"></p>
<p>è¿™æ ·æˆ‘ä»¬å°±å¾—åˆ°ä¸€ä¸ªäºŒå€¼å›¾åƒäº†</p>
<p>åç»­è€ƒè™‘æ›´é€šç”¨çš„åœºæ™¯ï¼Œå¯ä»¥å¼•å…¥ç”¨æˆ·äº¤äº’ï¼šä»¥ç”¨æˆ·è§¦ç¢°ç‚¹è¿›è¡Œæ¼«æ°´å¡«å……</p>
<h4 id="ç›´çº¿æ£€æµ‹"><a href="#ç›´çº¿æ£€æµ‹" class="headerlink" title="ç›´çº¿æ£€æµ‹"></a>ç›´çº¿æ£€æµ‹</h4><p>å…ˆåˆ©ç”¨ Canny ç®—å­è¿›è¡Œè¾¹ç¼˜æ£€æµ‹</p>
<p><img src="https://upload-images.jianshu.io/upload_images/9277731-367c71d9b042722b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="è¾¹ç¼˜æ£€æµ‹"></p>
<p>ç„¶åé€šè¿‡ HoughLines å˜æ¢å¾—åˆ°ç›´çº¿</p>
<p><img src="https://upload-images.jianshu.io/upload_images/9277731-31257448062a25fa.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ç›´çº¿æ£€æµ‹"></p>
<p>è¿™é‡Œä¸é€‰ç”¨ HoughLinesP æ£€æµ‹çº¿æ®µï¼Œä¸»è¦åŸå› æ˜¯å¾—åˆ°çš„çº¿æ®µéƒ½æ˜¯çŸ­çº¿æ®µä¸”æ–¹å‘å˜åŒ–è¾ƒå¤§ï¼Œä¸åˆ©äºåç»­çš„è®¡ç®—ï¼›è¿˜æœ‰ä¸€ä¸ªåŸå› æ˜¯ä¸èƒ½å¤„ç†å›¾åƒéƒ¨åˆ†ç¼ºå¤±çš„æƒ…å†µ</p>
<p>å½“ç„¶è¿™é‡Œçš„åœºæ™¯ä¹Ÿä¸éœ€è¦è€ƒè™‘ç›®æ ‡å›¾åƒéƒ¨åˆ†ç¼ºå¤±çš„æƒ…å†µã€‚</p>
<h4 id="é¡¶ç‚¹åæ ‡è®¡ç®—"><a href="#é¡¶ç‚¹åæ ‡è®¡ç®—" class="headerlink" title="é¡¶ç‚¹åæ ‡è®¡ç®—"></a>é¡¶ç‚¹åæ ‡è®¡ç®—</h4><p>è®¡ç®—æ‰€æœ‰ç›´çº¿çš„äº¤ç‚¹</p>
<p>è¿‡æ»¤æ‰åæ ‡ä¸åœ¨èŒƒå›´çš„</p>
<p><img src="https://upload-images.jianshu.io/upload_images/9277731-8142299b4497fc4f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="äº¤ç‚¹.png"></p>
<p>æœ¬æ¥æ‰“ç®—æ‰“ç®—é€šè¿‡ kmeans è¿›è¡Œèšç±»ï¼Œå‘ç° opencv è‡ªå¸¦çš„ä¸å¤ªå¥½ç”¨(ä¹Ÿå¯èƒ½æ˜¯æˆ‘å§¿åŠ¿ä¸å¯¹)</p>
<p>å–å·§ï¼Œå…ˆè®¡ç®—ä¸­ç‚¹ï¼Œç„¶åæ ¹æ®æåæ ‡å¯¹æ‰€æœ‰äº¤ç‚¹è¿›è¡Œæ’åºï¼Œæ¬§å¼è·ç¦»åœ¨ä¸€å®šèŒƒå›´å†…çš„å±äºåŒä¸€ç±»</p>
<p>æˆ‘ä»¬å¾—åˆ°äº†å¤šä¸ªèšç±»ï¼Œå–å…ƒç´ æœ€å¤šçš„å››ä¸ªåˆ†ç±»ï¼Œå¹¶å¾—åˆ°å››ä¸ªå‡å€¼åæ ‡</p>
<p>æœ€åä»¥å·¦ä¸Šè§’ï¼ˆæ¨ªçºµåæ ‡å‡å°äºä¸­ç‚¹ï¼‰ä¸ºç¬¬ä¸€ä¸ªç‚¹ï¼Œè¿›è¡Œé¡ºæ—¶é’ˆæ’åº</p>
<h4 id="çŸ©é˜µå˜æ¢"><a href="#çŸ©é˜µå˜æ¢" class="headerlink" title="çŸ©é˜µå˜æ¢"></a>çŸ©é˜µå˜æ¢</h4><p>å°†åŸå›¾çš„å››ä¸ªåæ ‡å˜æ¢åˆ°ç›®æ ‡å›¾ç‰‡çš„å››ä¸ªæ–°çš„ç‚¹</p>
<p>è¿™é‡Œå­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯æ–°çš„ç›®æ ‡å›¾ç‰‡çš„å®½é«˜åº”è¯¥æ˜¯å¤šå°‘ï¼Œè¿™é‡Œæˆ‘ä»¬ç›´æ¥å–åŸå›¾çš„å®½é«˜</p>
<p>åç»­æœ‰æ—¶é—´çš„è¯å†ç ”ç©¶ä¸‹è‡ªåŠ¨è¯†åˆ«ç›®æ ‡å›¾å®½é«˜çš„ç®—æ³•</p>
<p>æœ€åå†æ¨ªçºµç¼©æ”¾ä¸€åŠï¼ˆå‹ç¼©ï¼‰ï¼Œå¾—åˆ°æœ€åçš„ç»“æœ</p>
<p><img src="https://upload-images.jianshu.io/upload_images/9277731-a1ebc28e8965fd62.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ç»“æœ"></p>
<h3 id="ä¸‰ã€ç•Œé¢å¸ƒå±€"><a href="#ä¸‰ã€ç•Œé¢å¸ƒå±€" class="headerlink" title="ä¸‰ã€ç•Œé¢å¸ƒå±€"></a>ä¸‰ã€ç•Œé¢å¸ƒå±€</h3><p>å€Ÿé‰´äº†è¯¥æ–‡ç« çš„ä»£ç  <a href="https://blog.theodo.com/2019/02/computer-vision-web-opencv-js/" target="_blank" rel="noopener">[OpenCV Web] Should You Use OpenCV JS?</a> </p>
<p>ç”¨çš„ bootstrap è¿›è¡Œå¸ƒå±€</p>
<h3 id="å››ã€ä»£ç å®ç°"><a href="#å››ã€ä»£ç å®ç°" class="headerlink" title="å››ã€ä»£ç å®ç°"></a>å››ã€ä»£ç å®ç°</h3><p>æ¥å£çš„ä½¿ç”¨æ–¹å¼åŸºæœ¬ä¸Šå’Œå…¶ä»–è¯­è¨€ç›¸åŒ</p>
<p>ä¸æ¸…æ¥šçš„è¯å¯ä»¥æŸ¥çœ‹ <a href="https://docs.opencv.org/4.2.0/" target="_blank" rel="noopener">api æ–‡æ¡£</a></p>
<p>æˆ–è€…å…ˆç©ç©è¿™äº›<a href="https://docs.opencv.org/4.2.0/d2/df0/tutorial_js_table_of_contents_imgproc.html" target="_blank" rel="noopener">å›¾åƒå¤„ç†ç›¸å…³demo</a> </p>
<p>æ€»çš„æ¥è¯´ï¼Œæ–‡æ¡£è¾ƒä¸ºåŒ®ä¹ï¼Œå¾ˆå¤šæ¥å£æ²¡æœ‰è¯´æ˜ï¼Œåªèƒ½é€šè¿‡å…¶ä»–è¯­è¨€çš„ api è¿›è¡Œç±»æ¨</p>
<p>ä»£ç å¦‚ä¸‹ï¼Œæ›´å¤šçš„è¯·æŸ¥çœ‹ github ä»“åº“</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> g_nLowDifference = <span class="number">35</span></span><br><span class="line"><span class="keyword">const</span> g_nUpDifference = <span class="number">35</span>; <span class="comment">//è´Ÿå·®æœ€å¤§å€¼ã€æ­£å·®æœ€å¤§å€¼ </span></span><br><span class="line"><span class="keyword">const</span> UNCAL_THETA = <span class="number">0.5</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Line</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(rho, theta) &#123;</span><br><span class="line">    <span class="keyword">this</span>.rho = rho</span><br><span class="line">    <span class="keyword">this</span>.theta = theta</span><br><span class="line">    <span class="keyword">let</span> a = <span class="built_in">Math</span>.cos(theta);</span><br><span class="line">    <span class="keyword">let</span> b = <span class="built_in">Math</span>.sin(theta);</span><br><span class="line">    <span class="keyword">let</span> x0 = a * rho;</span><br><span class="line">    <span class="keyword">let</span> y0 = b * rho;</span><br><span class="line">    <span class="keyword">this</span>.startPoint = &#123; <span class="attr">x</span>: x0 - <span class="number">400</span> * b, <span class="attr">y</span>: y0 + <span class="number">400</span> * a &#125;;</span><br><span class="line">    <span class="keyword">this</span>.endPoint = &#123; <span class="attr">x</span>: x0 + <span class="number">400</span> * b, <span class="attr">y</span>: y0 - <span class="number">400</span> * a &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Object&#125;</span> <span class="variable">srcMat</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">itemExtract</span> (<span class="params">srcMat, name</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> scale = getScale(<span class="built_in">Math</span>.max(srcMat.rows, srcMat.cols))</span><br><span class="line">  <span class="keyword">let</span> preMat = preProcess(srcMat, scale)</span><br><span class="line">  <span class="keyword">let</span> grayMat = getSegmentImage(preMat)</span><br><span class="line">  <span class="keyword">let</span> lines = getLinesWithDetect(grayMat)</span><br><span class="line">  <span class="keyword">let</span> points = getFourVertex(lines, scale, &#123; <span class="attr">height</span>: srcMat.rows, <span class="attr">width</span>: srcMat.cols &#125;)</span><br><span class="line">  <span class="keyword">let</span> result = getResultWithMap(srcMat, points)</span><br><span class="line">  cv.imshow(name, result);</span><br><span class="line">  preMat.delete()</span><br><span class="line">  grayMat.delete()</span><br><span class="line">  srcMat.delete()</span><br><span class="line">  result.delete()</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è·å–ç¼©æ”¾æ¯”ä¾‹</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>len </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getScale</span> (<span class="params">len</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> scale = <span class="number">1</span></span><br><span class="line">  <span class="keyword">while</span> (len &gt; <span class="number">200</span>) &#123;</span><br><span class="line">    scale /= <span class="number">2</span></span><br><span class="line">    len &gt;&gt;= <span class="number">1</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> scale</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é¢„å¤„ç†</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>src </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">preProcess</span> (<span class="params">src, scale</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> smallMat = resize(src, scale)</span><br><span class="line">  <span class="keyword">let</span> result = filter(smallMat)</span><br><span class="line">  smallMat.delete()</span><br><span class="line">  <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è°ƒæ•´è‡³æŒ‡å®šå®½é«˜</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>src </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>scale ç¼©æ”¾æ¯”ä¾‹ </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">resize</span> (<span class="params">src, scale = <span class="number">1</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> smallMat = <span class="keyword">new</span> cv.Mat();</span><br><span class="line">  <span class="keyword">let</span> dsize = <span class="keyword">new</span> cv.Size(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">  cv.resize(src, smallMat, dsize, scale, scale, cv.INTER_AREA)</span><br><span class="line">  <span class="keyword">return</span> smallMat</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ»¤æ³¢ï¼šä¿è¾¹å»å™ª</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>mat </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span> (<span class="params">src</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> dst = <span class="keyword">new</span> cv.Mat();</span><br><span class="line">  cv.cvtColor(src, src, cv.COLOR_RGBA2RGB, <span class="number">0</span>);</span><br><span class="line">  <span class="comment">// åŒè¾¹æ»¤æ³¢</span></span><br><span class="line">  cv.bilateralFilter(src, dst, <span class="number">9</span>, <span class="number">75</span>, <span class="number">75</span>, cv.BORDER_DEFAULT);</span><br><span class="line">  <span class="keyword">return</span> dst</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é€šè¿‡åˆ†å‰²å›¾åƒè·å–å‰æ™¯ç°åº¦å›¾</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>src </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getSegmentImage</span> (<span class="params">src</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> mask = <span class="keyword">new</span> cv.Mat(src.rows + <span class="number">2</span>, src.cols + <span class="number">2</span>, cv.CV_8U, [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>])</span><br><span class="line">  <span class="keyword">const</span> seed = <span class="keyword">new</span> cv.Point(src.cols &gt;&gt; <span class="number">1</span>, src.rows &gt;&gt; <span class="number">1</span>)</span><br><span class="line">  <span class="keyword">let</span> flags = <span class="number">4</span> + (<span class="number">255</span> &lt;&lt; <span class="number">8</span>) + cv.FLOODFILL_FIXED_RANGE</span><br><span class="line">  <span class="keyword">let</span> ccomp = <span class="keyword">new</span> cv.Rect()</span><br><span class="line">  <span class="keyword">let</span> newVal = <span class="keyword">new</span> cv.Scalar(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>)</span><br><span class="line">  <span class="comment">// é€‰å–ä¸­ç‚¹ï¼Œé‡‡ç”¨floodFillæ¼«æ°´å¡«å……</span></span><br><span class="line">  cv.threshold(mask, mask, <span class="number">1</span>, <span class="number">128</span>, cv.THRESH_BINARY);</span><br><span class="line">  cv.floodFill(src, mask, seed, newVal, ccomp, <span class="keyword">new</span> cv.Scalar(g_nLowDifference, g_nLowDifference, g_nLowDifference), <span class="keyword">new</span> cv.Scalar(g_nUpDifference, g_nUpDifference, g_nUpDifference), flags);</span><br><span class="line">  <span class="comment">// å†æ¬¡æ‰§è¡Œä¸€æ¬¡æ»¤æ³¢å»é™¤å™ªç‚¹</span></span><br><span class="line">  cv.medianBlur(mask, mask, <span class="number">9</span>);</span><br><span class="line">  <span class="keyword">return</span> mask</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getLinesFromData32F</span> (<span class="params">data32F</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> lines = []</span><br><span class="line">  <span class="keyword">let</span> len = data32F.length / <span class="number">2</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; len; ++i) &#123;</span><br><span class="line">    <span class="keyword">let</span> rho = data32F[i * <span class="number">2</span>];</span><br><span class="line">    <span class="keyword">let</span> theta = data32F[i * <span class="number">2</span> + <span class="number">1</span>];</span><br><span class="line">    lines.push(<span class="keyword">new</span> Line(rho, theta))</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> lines</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç›´çº¿æ£€æµ‹</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>mat </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getLinesWithDetect</span> (<span class="params">src</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> dst = cv.Mat.zeros(src.rows, src.cols, cv.CV_8UC3);</span><br><span class="line">  <span class="keyword">let</span> lines = <span class="keyword">new</span> cv.Mat();</span><br><span class="line">  <span class="comment">// Canny ç®—å­è¿›è¡Œè¾¹ç¼˜æ£€æµ‹</span></span><br><span class="line">  cv.Canny(src, src, <span class="number">50</span>, <span class="number">200</span>, <span class="number">3</span>);</span><br><span class="line">  cv.HoughLines(src, lines, <span class="number">1</span>, <span class="built_in">Math</span>.PI / <span class="number">180</span>,</span><br><span class="line">    <span class="number">30</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="built_in">Math</span>.PI);</span><br><span class="line">  <span class="comment">// draw lines</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; lines.rows; ++i) &#123;</span><br><span class="line">    <span class="keyword">let</span> rho = lines.data32F[i * <span class="number">2</span>];</span><br><span class="line">    <span class="keyword">let</span> theta = lines.data32F[i * <span class="number">2</span> + <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">let</span> a = <span class="built_in">Math</span>.cos(theta);</span><br><span class="line">    <span class="keyword">let</span> b = <span class="built_in">Math</span>.sin(theta);</span><br><span class="line">    <span class="keyword">let</span> x0 = a * rho;</span><br><span class="line">    <span class="keyword">let</span> y0 = b * rho;</span><br><span class="line">    <span class="keyword">let</span> startPoint = &#123; <span class="attr">x</span>: x0 - <span class="number">400</span> * b, <span class="attr">y</span>: y0 + <span class="number">400</span> * a &#125;;</span><br><span class="line">    <span class="keyword">let</span> endPoint = &#123; <span class="attr">x</span>: x0 + <span class="number">400</span> * b, <span class="attr">y</span>: y0 - <span class="number">400</span> * a &#125;;</span><br><span class="line">    cv.line(dst, startPoint, endPoint, [<span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>]);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> lineArray = getLinesFromData32F(lines.data32F)</span><br><span class="line">  <span class="comment">// drawLineMat(src.rows, src.cols, lineArray)</span></span><br><span class="line">  <span class="keyword">return</span> lineArray</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è®¡ç®—ä¸¤ç›´çº¿é—´çš„äº¤ç‚¹</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>l1 </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>l2 </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getIntersection</span> (<span class="params">l1, l2</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//è§’åº¦å·®å¤ªå° ä¸ç®—ï¼Œ</span></span><br><span class="line">  <span class="keyword">let</span> minTheta = <span class="built_in">Math</span>.min(l1.theta, l2.theta)</span><br><span class="line">  <span class="keyword">let</span> maxTheta = <span class="built_in">Math</span>.max(l1.theta, l2.theta)</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">Math</span>.abs(l1.theta - l2.theta) &lt; UNCAL_THETA || <span class="built_in">Math</span>.abs(minTheta + <span class="built_in">Math</span>.PI - maxTheta) &lt; UNCAL_THETA) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//è®¡ç®—ä¸¤æ¡ç›´çº¿çš„äº¤ç‚¹</span></span><br><span class="line">  <span class="keyword">let</span> intersection;</span><br><span class="line">  <span class="comment">//y = a * x + b;</span></span><br><span class="line">  <span class="keyword">let</span> a1 = <span class="built_in">Math</span>.abs(l1.startPoint.x - l1.endPoint.x) &lt; <span class="built_in">Number</span>.EPSILON ? <span class="number">0</span> : (l1.startPoint.y - l1.endPoint.y) / (l1.startPoint.x - l1.endPoint.x);</span><br><span class="line">  <span class="keyword">let</span> b1 = l1.startPoint.y - a1 * (l1.startPoint.x);</span><br><span class="line">  <span class="keyword">let</span> a2 = <span class="built_in">Math</span>.abs((l2.startPoint.x - l2.endPoint.x)) &lt; <span class="built_in">Number</span>.EPSILON ? <span class="number">0</span> : (l2.startPoint.y - l2.endPoint.y) / (l2.startPoint.x - l2.endPoint.x);</span><br><span class="line">  <span class="keyword">let</span> b2 = l2.startPoint.y - a2 * (l2.startPoint.x);</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">Math</span>.abs(a2 - a1) &gt; <span class="built_in">Number</span>.EPSILON) &#123;</span><br><span class="line">    <span class="keyword">let</span> x = (b1 - b2) / (a2 - a1)</span><br><span class="line">    <span class="keyword">let</span> y = a1 * x + b1</span><br><span class="line">    intersection = &#123; x, y &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> intersection</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è®¡ç®—æ‰€æœ‰äº¤ç‚¹</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>lines </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getAllIntersections</span> (<span class="params">lines</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> points = []</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; lines.length; i++) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> j = i + <span class="number">1</span>; j &lt; lines.length; j++) &#123;</span><br><span class="line">      <span class="keyword">let</span> point = getIntersection(lines[i], lines[j])</span><br><span class="line">      <span class="keyword">if</span> (point) &#123;</span><br><span class="line">        points.push(point)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> points</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * èšç±»å–å‡å€¼</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>points </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>param1 </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getClusterPoints</span> (<span class="params">points, &#123; width, height &#125;</span>) </span>&#123;</span><br><span class="line">  points.sort(<span class="function">(<span class="params">p1, p2</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (p1.x !== p2.x) &#123;</span><br><span class="line">      <span class="keyword">return</span> p1.x - p2.x</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> p1.y - p2.y</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">const</span> distance = <span class="built_in">Math</span>.max(<span class="number">40</span>, (width + height) / <span class="number">20</span>)</span><br><span class="line">  <span class="keyword">const</span> isNear = <span class="function">(<span class="params">p1, p2</span>) =&gt;</span> <span class="built_in">Math</span>.abs(p1.x - p2.x) + <span class="built_in">Math</span>.abs(p1.y - p2.y) &lt; distance</span><br><span class="line">  <span class="keyword">let</span> clusters = [[points[<span class="number">0</span>]]]</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">1</span>; i &lt; points.length; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (isNear(points[i], points[i - <span class="number">1</span>])) &#123;</span><br><span class="line">      clusters[clusters.length - <span class="number">1</span>].push(points[i])</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      clusters.push([points[i]])</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// é™¤å»é‡æœ€å°‘çš„ï¼Œä»…ä¿ç•™å››ä¸ªèšç±»</span></span><br><span class="line">  clusters = clusters.sort(<span class="function">(<span class="params">c1, c2</span>) =&gt;</span> c2.length - c1.length).slice(<span class="number">0</span>, <span class="number">4</span>)</span><br><span class="line">  <span class="keyword">const</span> result = clusters.map(<span class="function"><span class="params">cluster</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> x = ~~<span class="function">(<span class="params">cluster.reduce((sum, cur</span>) =&gt;</span> sum + cur.x, <span class="number">0</span>) / cluster.length)</span><br><span class="line">    <span class="keyword">const</span> y = ~~<span class="function">(<span class="params">cluster.reduce((sum, cur</span>) =&gt;</span> sum + cur.y, <span class="number">0</span>) / cluster.length)</span><br><span class="line">    <span class="keyword">return</span> &#123; x, y &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é¡ºæ—¶é’ˆæ’åºï¼Œä»¥ä¸­å¿ƒç‚¹å·¦ä¸Šè§’ä¸ºç¬¬ä¸€ä¸ªç‚¹</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>points </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getSortedVertex</span> (<span class="params">points</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> center = &#123;</span><br><span class="line">    x: points.reduce(<span class="function">(<span class="params">sum, p</span>) =&gt;</span> sum + p.x, <span class="number">0</span>) / <span class="number">4</span>,</span><br><span class="line">    y: points.reduce(<span class="function">(<span class="params">sum, p</span>) =&gt;</span> sum + p.y, <span class="number">0</span>) / <span class="number">4</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> sortedPoints = []</span><br><span class="line">  sortedPoints.push(points.find(<span class="function"><span class="params">p</span> =&gt;</span> p.x &lt; center.x &amp;&amp; p.y &lt; center.y))</span><br><span class="line">  sortedPoints.push(points.find(<span class="function"><span class="params">p</span> =&gt;</span> p.x &gt; center.x &amp;&amp; p.y &lt; center.y))</span><br><span class="line">  sortedPoints.push(points.find(<span class="function"><span class="params">p</span> =&gt;</span> p.x &gt; center.x &amp;&amp; p.y &gt; center.y))</span><br><span class="line">  sortedPoints.push(points.find(<span class="function"><span class="params">p</span> =&gt;</span> p.x &lt; center.x &amp;&amp; p.y &gt; center.y))</span><br><span class="line">  <span class="keyword">return</span> sortedPoints</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ ¹æ®èšç±»è·å¾—å››ä¸ªé¡¶ç‚¹çš„åæ ‡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getFourVertex</span> (<span class="params">lines, scale, &#123; width, height &#125;</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ç¼©æ”¾ + è¿‡æ»¤</span></span><br><span class="line">  <span class="keyword">let</span> allPoints = getAllIntersections(lines).map(<span class="function"><span class="params">point</span> =&gt;</span> (&#123;</span><br><span class="line">    x: ~~(point.x / scale), <span class="attr">y</span>: ~~(point.y / scale)</span><br><span class="line">  &#125;)).filter(<span class="function">(<span class="params">&#123; x, y &#125;</span>) =&gt;</span> !(x &lt; <span class="number">0</span> || x &gt; width || y &lt; <span class="number">0</span> || y &gt; height))</span><br><span class="line">  <span class="keyword">const</span> points = getClusterPoints(allPoints, &#123; width, height &#125;)</span><br><span class="line">  <span class="keyword">const</span> sortedPoints = getSortedVertex(points)</span><br><span class="line">  <span class="keyword">return</span> sortedPoints</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æŠ å›¾ï¼Œæ˜ å°„</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>src </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>points </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getResultWithMap</span> (<span class="params">src, points</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> array = []</span><br><span class="line">  points.forEach(<span class="function"><span class="params">point</span> =&gt;</span> &#123;</span><br><span class="line">    array.push(point.x)</span><br><span class="line">    array.push(point.y)</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="built_in">console</span>.log(points, array)</span><br><span class="line">  <span class="keyword">let</span> dst = <span class="keyword">new</span> cv.Mat();</span><br><span class="line">  <span class="keyword">let</span> dsize = <span class="keyword">new</span> cv.Size(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">  <span class="keyword">let</span> dstWidth = src.cols</span><br><span class="line">  <span class="keyword">let</span> dstHeight = src.rows</span><br><span class="line">  <span class="keyword">let</span> srcTri = cv.matFromArray(<span class="number">4</span>, <span class="number">1</span>, cv.CV_32FC2, array);</span><br><span class="line">  <span class="keyword">let</span> dstTri = cv.matFromArray(<span class="number">4</span>, <span class="number">1</span>, cv.CV_32FC2, [<span class="number">0</span>, <span class="number">0</span>, dstWidth, <span class="number">0</span>, dstWidth, dstHeight, <span class="number">0</span>, dstHeight]);</span><br><span class="line">  <span class="keyword">let</span> M = cv.getPerspectiveTransform(srcTri, dstTri);</span><br><span class="line">  cv.warpPerspective(src, dst, M, dsize);</span><br><span class="line">  <span class="keyword">let</span> resizeDst = resize(dst, <span class="number">0.5</span>)</span><br><span class="line">  M.delete(); srcTri.delete(); dstTri.delete(); dst.delete()</span><br><span class="line">  <span class="keyword">return</span> resizeDst</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">drawLineMat</span> (<span class="params">rows, cols, lines</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> dst = cv.Mat.zeros(rows, cols, cv.CV_8UC3);</span><br><span class="line">  <span class="keyword">let</span> color = <span class="keyword">new</span> cv.Scalar(<span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> line <span class="keyword">of</span> lines) &#123;</span><br><span class="line">    cv.line(dst, line.startPoint, line.endPoint, color);</span><br><span class="line">  &#125;</span><br><span class="line">  cv.imshow(<span class="string">"canvasOutput"</span>, dst);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>æ³¨æ„ï¼š</strong> ä½¿ç”¨å®Œçš„ Mat å¯¹è±¡è®°å¾—æ‰‹åŠ¨æ¸…ç©ºï¼Œå¦åˆ™ä¼šè€—å°½ WebAssembly çš„å†…å­˜</p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>é€šè¿‡ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œæ¥è§¦äº† opencv.js çš„ä½¿ç”¨</p>
<p>opencv æä¾›äº†å¾ˆå¤šæ¥å£ï¼Œä½¿å¾—åœ¨å‰ç«¯è¿›è¡Œå›¾åƒå¤„ç†å˜å¾—å¾ˆæ–¹ä¾¿ï¼Œæœªæ¥æˆ–è®¸æœ‰æ›´å¤šçš„åº”ç”¨åœºæ™¯</p>
<h2 id="æœªæ¥å±•æœ›"><a href="#æœªæ¥å±•æœ›" class="headerlink" title="æœªæ¥å±•æœ›"></a>æœªæ¥å±•æœ›</h2><p>æ€§èƒ½ä¸Šï¼šå°è¯•ä½¿ç”¨ AssemblyScript ç¼–å†™ç›¸å…³çš„ç®—æ³•æ¨¡å—ï¼Œç”Ÿæˆ wasm å¹¶æ›¿æ¢æ‰è¿™ä¸ª 8M çš„ opencv.js æ–‡ä»¶</p>
<p>åŠŸèƒ½ä¸Šï¼šå¢åŠ è§¦æ§äº¤äº’ï¼Œæ›´æ™ºèƒ½çš„è¯†åˆ«ç›®æ ‡çŸ©å½¢ï¼›ç›®æ ‡å›¾ç‰‡å®½é«˜æ ¡æ­£ï¼›</p>
<p>ç¼–ç ä¸Šï¼šå€Ÿé‰´ä¸­é—´ä»¶çš„æ€æƒ³è¿›è¡Œé‡æ„</p>
<p>åç»­ä¼˜åŒ–å®Œå†å†™ä¸€ç¯‡æ–‡ç« </p>
<p>ä¹Ÿæ¬¢è¿è¯•ç”¨ï¼Œä»¥åŠæ pr</p>
<h2 id="å‚è€ƒæ–‡æ¡£"><a href="#å‚è€ƒæ–‡æ¡£" class="headerlink" title="å‚è€ƒæ–‡æ¡£"></a>å‚è€ƒæ–‡æ¡£</h2><ol>
<li><a href="https://docs.opencv.org/4.2.0/d5/d10/tutorial_js_root.html" target="_blank" rel="noopener">å®˜æ–¹ demo</a></li>
<li><a href="https://www.cnblogs.com/frombeijingwithlove/p/4226489.html" target="_blank" rel="noopener">åˆ©ç”¨OpenCVæ£€æµ‹å›¾åƒä¸­çš„é•¿æ–¹å½¢ç”»å¸ƒæˆ–çº¸å¼ å¹¶æå–å›¾åƒå†…å®¹</a></li>
<li><a href="https://answers.opencv.org/question/206557/how-can-you-use-k-means-clustering-to-posterize-an-image-using-opencv-javascript/" target="_blank" rel="noopener">How can you use K-Means clustering to posterize an image using opencv javascript?</a></li>
</ol>
]]></content>
      <categories>
        <category>å¤§å‰ç«¯</category>
      </categories>
      <tags>
        <tag>OpenCV</tag>
      </tags>
  </entry>
  <entry>
    <title>WebAssembly åˆæ¢</title>
    <url>/2020/01/10/WebAssembly/WebAssembly%20%E5%88%9D%E6%8E%A2/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æœ¬æ–‡æ˜¯å¯¹ WebAssembly æŠ€æœ¯ä½“ç³»çš„æ¦‚æ‹¬</p>
<a id="more"></a>

<p>ç›¸åº”çš„æŠ€æœ¯ä¸ä¼šæ·±å…¥è®²è§£ï¼Œå°†åœ¨ä»¥åçš„æ–‡ç« è®²åˆ°</p>
<h2 id="äºŒè¿›åˆ¶è¡¨ç¤ºä¸æ–‡æœ¬è¡¨ç¤º"><a href="#äºŒè¿›åˆ¶è¡¨ç¤ºä¸æ–‡æœ¬è¡¨ç¤º" class="headerlink" title="äºŒè¿›åˆ¶è¡¨ç¤ºä¸æ–‡æœ¬è¡¨ç¤º"></a>äºŒè¿›åˆ¶è¡¨ç¤ºä¸æ–‡æœ¬è¡¨ç¤º</h2><p>å…¶å®å°±æ˜¯ç¼–ç è§£ææ—¶ç»™äº†ä¸ªçº¦å®šï¼ŒæŸä¸ªå­—èŠ‚ä»£è¡¨äº†æŸä¸ªå«ä¹‰ï¼Œè¿™æ ·é€šè¿‡æœ‰é™çš„å­—èŠ‚å°±å¯ä»¥è¿›è¡Œå¤æ‚çš„è¡¨ç¤º</p>
<p>wat çš„å†…å®¹ä¸ºæ–‡æœ¬</p>
<p>wasm çš„å†…å®¹ä¸ºäºŒè¿›åˆ¶</p>
<p><a href="https://github.com/WebAssembly/wabt" target="_blank" rel="noopener">https://github.com/WebAssembly/wabt</a> æä¾›äº†æ–‡ä»¶åœ¨çº¿è½¬æ¢çš„å·¥å…·</p>
<p>å¯¹äº Uint8Array ï¼Œè‡ªå·±ä¹Ÿå†™äº†ä¸€ä¸ªè„šæœ¬ï¼Œç”¨äºè½¬æ¢ä¸ºæ–‡æœ¬</p>
<h2 id="ä¸-asm-js-çš„å…³ç³»"><a href="#ä¸-asm-js-çš„å…³ç³»" class="headerlink" title="ä¸ asm.js çš„å…³ç³»"></a>ä¸ asm.js çš„å…³ç³»</h2><p>asm.js æ˜¯ç«ç‹æçš„ï¼Œå†™æ³•ä¸Šè¿˜æ˜¯ js çš„å†™æ³•ï¼Œåªä¸è¿‡é€šè¿‡æŸäº›æŠ€æœ¯è®©å¼•æ“èƒ½å¤Ÿç¡®å®šå˜é‡ç±»å‹ï¼Œå°‘äº†æŸäº›ç¯èŠ‚</p>
<h2 id="å†…å­˜æ¨¡å‹"><a href="#å†…å­˜æ¨¡å‹" class="headerlink" title="å†…å­˜æ¨¡å‹"></a>å†…å­˜æ¨¡å‹</h2><p>é»˜è®¤åªæœ‰æ•´å‹å’Œæµ®ç‚¹ç±»å‹ï¼Œå…¶ä»–ç±»å‹éœ€è¦é€šè¿‡å¼€è¾Ÿå†…å­˜ä½¿ç”¨</p>
<h2 id="å…¶ä»–è¯­è¨€è½¬-wasm"><a href="#å…¶ä»–è¯­è¨€è½¬-wasm" class="headerlink" title="å…¶ä»–è¯­è¨€è½¬ wasm"></a>å…¶ä»–è¯­è¨€è½¬ wasm</h2><p>llvm å·¥å…·è½¬æ¢</p>
<p>ç†è®ºä¸Šæ¥è¯´ï¼Œæ‰€æœ‰å¼ºç±»å‹è¯­è¨€éƒ½å¯ä»¥æ”¯æ’‘è½¬æˆ wasm</p>
<p>å¯¹äºå‰ç«¯eræ¥è¯´ï¼Œç”¨tsæ˜¯æˆæœ¬è¾ƒä½çš„ä¸€ç§ï¼Œç›¸åº”çš„æŠ€æœ¯ä¸ºï¼š assemblyScript</p>
<h2 id="æ‹“å±•é˜…è¯»"><a href="#æ‹“å±•é˜…è¯»" class="headerlink" title="æ‹“å±•é˜…è¯»"></a>æ‹“å±•é˜…è¯»</h2><p><a href="https://www.cnblogs.com/jixiaohua/category/1404779.html" target="_blank" rel="noopener">https://www.cnblogs.com/jixiaohua/category/1404779.html</a></p>
<p>MDN</p>
]]></content>
      <categories>
        <category>å¤§å‰ç«¯</category>
      </categories>
      <tags>
        <tag>WebAssembly</tag>
      </tags>
  </entry>
  <entry>
    <title>å¦‚ä½•è§£å†³é•¿åˆ—è¡¨çš„æ»šåŠ¨ç™½å±é—®é¢˜</title>
    <url>/2020/01/09/2020/%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3%E9%95%BF%E5%88%97%E8%A1%A8%E7%9A%84%E6%BB%9A%E5%8A%A8%E7%99%BD%E5%B1%8F%E9%97%AE%E9%A2%98/</url>
    <content><![CDATA[<h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>ä¹‹å‰æåˆ°è¿‡å®ç°é•¿åˆ—è¡¨çš„æ–¹å¼ï¼šç›‘å¬ scroll äº‹ä»¶ï¼Œåœ¨å›è°ƒä¸­è®¡ç®—æ¸²æŸ“èµ·æ­¢é¡¹å¹¶æ’å…¥ dom æ ‘ï¼Œå³åªæ¸²æŸ“å¯è§†åŒºåŸŸ</p>
<p>å®ç°ä¸­å‘ç°ï¼Œæœ‰äº›æƒ…å†µä¸‹å¯èƒ½ä¼šå‡ºç°çŸ­æš‚çš„ç™½å±ç°è±¡</p>
<p>æœ¬æ–‡å°±æ¥è°ˆè°ˆç™½å±æˆå› å’Œè§£å†³æ–¹æ¡ˆ</p>
<a id="more"></a>

<h2 id="ç™½å±æˆå› "><a href="#ç™½å±æˆå› " class="headerlink" title="ç™½å±æˆå› "></a>ç™½å±æˆå› </h2><p>é€ æˆæ»šå±æœ‰3ç§æ–¹å¼</p>
<ul>
<li>è¾“å…¥äº‹ä»¶ï¼Œå¦‚é¼ æ ‡æ»šè½®ï¼Œé”®ç›˜æ–¹å‘é”®</li>
<li>æ‹–åŠ¨æ»šåŠ¨æ¡</li>
<li>ä»£ç æ§åˆ¶ scrollTop</li>
</ul>
<p>æ¯ç§æ–¹å¼ï¼Œæµè§ˆå™¨çš„å†…éƒ¨å¤„ç†éƒ½æ˜¯ä¸ä¸€æ ·çš„</p>
<h3 id="è¾“å…¥äº‹ä»¶æ»šåŠ¨"><a href="#è¾“å…¥äº‹ä»¶æ»šåŠ¨" class="headerlink" title="è¾“å…¥äº‹ä»¶æ»šåŠ¨"></a>è¾“å…¥äº‹ä»¶æ»šåŠ¨</h3><p>å…ˆè¯´äº¤äº’äº‹ä»¶ï¼Œä»¥é¼ æ ‡æ»šè½®(mousewheel)ä¸ºä¾‹</p>
<p>å¤§éƒ¨åˆ†æµè§ˆå™¨é‡‡ç”¨çš„æ˜¯å¼‚æ­¥æ»šåŠ¨æ¨¡å‹ã€‚åœ¨è¯¥æ¨¡å‹ä¸­ï¼Œè§†è§‰æ»šåŠ¨ä½ç½®åœ¨åˆæˆå™¨çº¿ç¨‹ä¸­æ›´æ–°ï¼Œå¹¶åœ¨ scroll å›è°ƒæ‰§è¡Œå‰å¯è§</p>
<p><img src="https://2r4s9p1yi1fa2jd7j43zph8r-wpengine.netdna-ssl.com/files/2016/02/apz.png" alt="Smoother scrolling in Firefox 46 with APZ"></p>
<p>å†…éƒ¨æ‰§è¡Œé¡ºåºå¦‚ä¸‹ï¼š</p>
<ol>
<li>ç›¸å…³çº¿ç¨‹æ•è·åˆ°æ»šè½®æ“ä½œ</li>
<li>é€šçŸ¥åˆæˆå™¨çº¿ç¨‹å»æ»šåŠ¨æ–‡æ¡£ï¼ŒåŒ…æ‹¬æ›´æ–°æ»šåŠ¨æ¡ä½ç½®</li>
<li>ã€äº‹ä»¶å¾ªç¯1ã€‘æ‰§è¡Œæ»šè½®äº‹ä»¶å›è°ƒ</li>
<li>ã€äº‹ä»¶å¾ªç¯1ã€‘æ‰§è¡Œ UI Renderï¼Œè§¦å‘ scroll äº‹ä»¶</li>
<li>ã€äº‹ä»¶å¾ªç¯2ã€‘æ‰§è¡Œ scroll äº‹ä»¶å›è°ƒ</li>
</ol>
<p>åœ¨æ‰§è¡Œæ»šè½®äº‹ä»¶å›è°ƒçš„æ—¶å€™ï¼Œå¯èƒ½æ–‡æ¡£ä½ç½®å·²ç»æ›´æ–°å®Œæ¯•</p>
<p>å› æ­¤ï¼Œå½“ scroll äº‹ä»¶å›è°ƒæ‰§è¡Œå¤ªä¹…ï¼Œå°±ä¼šå‡ºç°æ–‡æ¡£å·²ç»æ»šåŠ¨äº†ï¼Œä½†æ˜¯æ–°çš„å¯è§†åŒºåŸŸåˆ—è¡¨è¿˜æœªè®¡ç®—å‡ºæ¥å¹¶æ›´æ–°åˆ°é¡µé¢ä¸Šï¼Œç™½å±å°±æ­¤äº§ç”Ÿ</p>
<p>æˆ‘ä»¬å¯ä»¥ç¦ç”¨æµè§ˆå™¨çš„å¼‚æ­¥æ»šåŠ¨ä¼˜åŒ–ï¼Œå³å°†æ»šåŠ¨æ–‡æ¡£æ“ä½œæ”¾åˆ°ã€äº‹ä»¶å¾ªç¯1ã€‘çš„ UI Render é˜¶æ®µå»åš</p>
<blockquote>
<p>é€šè¿‡ passive=false æ¥å®ç°<br>ä¹Ÿå°±æ˜¯è¯´æ»šåŠ¨æ–‡æ¡£éœ€è¦ä¸ä¸»çº¿ç¨‹äº¤äº’</p>
</blockquote>
<p>å¦‚æœå°†åŸ scroll äº‹ä»¶çš„å¤„ç†æ”¾åˆ°æ»šè½®äº‹ä»¶ä¸­å¤„ç†çš„è¯ï¼Œ scrollTop æ‹¿åˆ°çš„æ˜¯ä¹‹å‰çš„å€¼ï¼ˆpassive=falseï¼Œæµè§ˆå™¨å¹¶ä¸çŸ¥é“æ˜¯å¦è¦æ»šåŠ¨ï¼Œä¼šä¸ä¼šè¢« prventDefault ï¼‰ã€‚æ‰€ä»¥äº‹ä»¶å›è°ƒä¿æŒä¸å˜</p>
<p>è¿™æ ·ä¸‹æ¥ï¼Œä¸‹ä¸€æ¬¡çš„æ»šåŠ¨æ–‡æ¡£å¿…é¡»ç­‰å¾…æœ¬æ¬¡ scroll äº‹ä»¶å›è°ƒæ‰§è¡Œå®Œæ¯•ï¼Œ<strong>å‡ç¼“</strong>äº†ç™½å±ç°è±¡ï¼Œç›¸åº”çš„ï¼Œé¡µé¢ä¹Ÿæ˜¾å¾—æ²¡é‚£ä¹ˆæµç•…</p>
<p>äºæ˜¯å†…éƒ¨æ‰§è¡Œé¡ºä¾¿å˜æˆå¦‚ä¸‹ï¼š</p>
<ol>
<li>ç›¸å…³çº¿ç¨‹æ•è·åˆ°æ»šè½®æ“ä½œ</li>
<li>ã€äº‹ä»¶å¾ªç¯1ã€‘æ‰§è¡Œæ»šè½®äº‹ä»¶å›è°ƒ</li>
<li>ã€äº‹ä»¶å¾ªç¯1ã€‘æ‰§è¡Œ UI Renderï¼Œè§¦å‘ scroll äº‹ä»¶ï¼Œé€šçŸ¥åˆæˆå™¨çº¿ç¨‹å»æ»šåŠ¨æ–‡æ¡£ï¼ŒåŒ…æ‹¬æ›´æ–°æ»šåŠ¨æ¡ä½ç½®</li>
<li>ã€äº‹ä»¶å¾ªç¯2ã€‘æ‰§è¡Œ scroll äº‹ä»¶å›è°ƒ</li>
</ol>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">document</span>.addEventListener(<span class="string">"scroll"</span>,<span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">window</span>.scrollY)</span><br><span class="line">  <span class="keyword">let</span> start = performance.now()</span><br><span class="line">  <span class="comment">// æ¨¡æ‹Ÿè€—æ—¶ä»»åŠ¡</span></span><br><span class="line">  <span class="keyword">while</span>( performance.now() - start &lt;<span class="number">100</span>)&#123;&#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">document</span>.addEventListener(<span class="string">"mousewheel"</span>,<span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</span><br><span class="line">&#125;,&#123; <span class="attr">passive</span>: <span class="literal">false</span> &#125;)</span><br></pre></td></tr></table></figure>

<p>ä¸è¿‡ç«ç‹ä¸­è®¾ç½® <code>passive: false</code> æ²¡æœ‰æ•ˆæœï¼Œæµè§ˆå™¨çš„å¼‚æ­¥æ»šåŠ¨ä¼˜åŒ–æ— æ³•ç¦ç”¨</p>
<p>è¯¦æƒ…çœ‹ <a href="https://developer.mozilla.org/zh-CN/docs/Mozilla/Performance/Scroll-linked_effects" target="_blank" rel="noopener">Scroll-linked_effects</a></p>
<h3 id="æ‹–åŠ¨æ»šåŠ¨æ¡"><a href="#æ‹–åŠ¨æ»šåŠ¨æ¡" class="headerlink" title="æ‹–åŠ¨æ»šåŠ¨æ¡"></a>æ‹–åŠ¨æ»šåŠ¨æ¡</h3><p>ä¸æ»šè½®äº‹ä»¶æœ‰äº›è®¸ä¸åŒï¼Œchrome çš„æ‹–åŠ¨æ»šåŠ¨æ¡æ²¡æœ‰å¼‚æ­¥æ»šåŠ¨ä¼˜åŒ–</p>
<p>å…¶æ‰§è¡Œé¡ºåºå¦‚ä¸‹ï¼š</p>
<ol>
<li>ç›¸å…³çº¿ç¨‹æ•è·åˆ°æ»šåŠ¨æ¡è¢«æ‹–åŠ¨</li>
<li>ã€äº‹ä»¶å¾ªç¯1ã€‘æ‰§è¡Œ scroll äº‹ä»¶å›è°ƒ</li>
<li>ã€äº‹ä»¶å¾ªç¯1ã€‘æ‰§è¡Œ UI Renderï¼Œé€šçŸ¥åˆæˆå™¨çº¿ç¨‹å»æ»šåŠ¨æ–‡æ¡£ï¼ŒåŒ…æ‹¬æ›´æ–°æ»šåŠ¨æ¡ä½ç½®</li>
</ol>
<p>æ•ˆæœå°±æ˜¯å¡ä¸€ä¸‹ï¼Œæ»šä¸€ä¸‹ï¼Œæ»šè¿‡å»çš„æ—¶å€™å·²ç»æ–°çš„åˆ—è¡¨å·²ç»ç»˜åˆ¶å®Œæ¯•äº†ï¼Œé‚£ä¹ˆæ˜¯ä¸ä¼šæœ‰ç™½å±é—®é¢˜çš„</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">document</span>.addEventListener(<span class="string">"scroll"</span>,<span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">window</span>.scrollY)</span><br><span class="line">  <span class="keyword">let</span> start = performance.now()</span><br><span class="line">  <span class="comment">// æ¨¡æ‹Ÿè€—æ—¶ä»»åŠ¡</span></span><br><span class="line">  <span class="keyword">while</span>( performance.now() - start &lt;<span class="number">100</span>)&#123;&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯ Firefox åšäº†æ»šåŠ¨ä¼˜åŒ–ï¼Œä¸”ä¸èƒ½ç¦ç”¨</p>
<p>å¯¼è‡´ scroll å›è°ƒä¼šåœ¨æ»šå±åæ‰§è¡Œï¼Œå’Œä¸Šé¢è¾“å…¥äº‹ä»¶æ•ˆæœä¸€è‡´ï¼Œäºæ˜¯å°±å‡ºç°äº†ç™½å±</p>
<h3 id="ä»£ç æ§åˆ¶"><a href="#ä»£ç æ§åˆ¶" class="headerlink" title="ä»£ç æ§åˆ¶"></a>ä»£ç æ§åˆ¶</h3><p>é€šè¿‡ <code>dom.scrollTop=xxx</code> è¿›è¡Œè‡ªåŠ¨æ»šåŠ¨</p>
<p>ä¸€èˆ¬æ˜¯ç”¨æ¥å›æ»šåˆ—è¡¨æ˜¾ç¤ºæŸä¸€é¡¹çš„</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">document</span>.addEventListener(<span class="string">"scroll"</span>,<span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">window</span>.scrollY)</span><br><span class="line">  <span class="keyword">let</span> start = performance.now()</span><br><span class="line">  <span class="comment">// æ¨¡æ‹Ÿè€—æ—¶ä»»åŠ¡</span></span><br><span class="line">  <span class="keyword">while</span>( performance.now() - start &lt;<span class="number">1000</span>)&#123;&#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">document</span>.scrollingElement.scrollTop=<span class="number">100</span></span><br></pre></td></tr></table></figure>

<p>å‘ç° chrome å’Œ Firefox æ­¤æ—¶çš„æ‰§è¡Œæ•ˆæœéƒ½ä¸€æ ·ï¼Œéƒ½æ˜¯å…ˆæ‰§è¡Œ scroll å›è°ƒå†æ»šåŠ¨æ–‡æ¡£ï¼Œæ²¡æœ‰ä»€ä¹ˆå¼‚æ­¥æ»šåŠ¨ä¼˜åŒ–äº†ã€‚</p>
<p>è¿™ç§æƒ…å†µä¸‹éƒ½ä¸ä¼šå‡ºç°ç™½å±</p>
<h2 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h2><p>å¯ä»¥çœ‹åˆ°ï¼Œchrome çš„è¯åªæœ‰è¾“å…¥äº‹ä»¶å¯èƒ½å¯¼è‡´ç™½å±ï¼Œä¸”å¯ä»¥é€šè¿‡ç¦ç”¨æ»šåŠ¨ä¼˜åŒ–æ¥å‡ç¼“</p>
<p>è€Œ Firefox åœ¨è¾“å…¥äº‹ä»¶å’Œæ‹–åŠ¨æ»šåŠ¨æ¡çš„æƒ…å†µéƒ½ä¼šå‡ºç°ç™½å±ï¼Œä¸”åŸºæœ¬ä¸èƒ½è§£å†³</p>
<p>å› æ­¤ï¼Œæˆ‘ä»¬åªèƒ½æé«˜ scroll å›è°ƒäº‹ä»¶çš„æ‰§è¡Œæ•ˆç‡ï¼Œæ¥å‡ç¼“ç™½å±çš„æ—¶é•¿</p>
<p>ç›®å‰æœ‰ä¸¤ä¸ªæ–¹å‘</p>
<ol>
<li>ç®—æ³•ä¼˜åŒ–</li>
<li>å ä½å¡«å……ï¼Œé€šè¿‡é˜²æŠ–ç­‰æ»šåŠ¨ç»“æŸå†è®¡ç®—</li>
</ol>
<h3 id="ç®—æ³•ä¼˜åŒ–"><a href="#ç®—æ³•ä¼˜åŒ–" class="headerlink" title="ç®—æ³•ä¼˜åŒ–"></a>ç®—æ³•ä¼˜åŒ–</h3><p>å…·ä½“å¯ä»¥å‚è€ƒæˆ‘å†™çš„ <a href="https://juejin.im/post/5dea86f7f265da33a8758820" target="_blank" rel="noopener">å‰ç«¯é•¿åˆ—è¡¨åŸç†åŠä¼˜åŒ–</a> ä¸€æ–‡</p>
<p>æœ‰ä¸¤ç§ç­–ç•¥ï¼šä¸€ç§æ˜¯å¯å˜æ»šåŠ¨æ¡æ€»é«˜åº¦é‡‡ç”¨æ ‘çŠ¶æ•°ç»„ä¼˜åŒ–ï¼›ä¸€ç§æ˜¯å›ºå®šæ»šåŠ¨æ¡é«˜åº¦ï¼Œé€šè¿‡å®šä½é¡¹ç­‰å‡ ä½•å…³ç³»ç®—å‡º</p>
<h3 id="é¢„å¡«å……-é˜²æŠ–"><a href="#é¢„å¡«å……-é˜²æŠ–" class="headerlink" title="é¢„å¡«å……+é˜²æŠ–"></a>é¢„å¡«å……+é˜²æŠ–</h3><p>åœ¨ scroll å›è°ƒä¸­å…ˆåšå¡«å……ï¼Œå¹¶å¯¹è®¡ç®—å…·ä½“åˆ—è¡¨æ“ä½œåšé˜²æŠ–</p>
<p>æ•ˆæœä¸Šå¯èƒ½ä¸å¤ªå¥½ï¼Œæ¯”è¾ƒé€‚åˆåˆ—è¡¨é¡¹å¸¦ç½‘ç»œè¯·æ±‚çš„æƒ…å†µï¼Œå¯ä»¥å‡å°‘æ— æ•ˆçš„ç½‘ç»œè¯·æ±‚</p>
<h2 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h2><p>å› ä¸ºå¾ˆå¤šéƒ½æ˜¯æµè§ˆå™¨è‡ªèº«çš„ä¼˜åŒ–ï¼Œä¸åœ¨è§„èŒƒèŒƒå›´å†…ï¼Œæœ¬æ–‡è¾ƒå¤šç»“è®ºæ˜¯é€šè¿‡æ‹“å±•é˜…è¯»å’Œå®éªŒç»“æœå¾—å‡ºï¼Œä¸ä¿è¯æ­£ç¡®ã€‚</p>
<p>æ¬¢è¿æŒ‡æ­£~</p>
<h2 id="2020-02-12-è¡¥å……"><a href="#2020-02-12-è¡¥å……" class="headerlink" title="2020/02/12 è¡¥å……"></a>2020/02/12 è¡¥å……</h2><p>scroll å›è°ƒçš„æ‰§è¡Œä¸æ˜¯åœ¨ä¸‹ä¸€è½®äº‹ä»¶å¾ªç¯ä¸­æ‰§è¡Œçš„ï¼Œè€Œæ˜¯åœ¨ä¸Šä¸€è½®çš„ UI Render ä¸­æ‰§è¡Œçš„</p>
<h2 id="æ‹“å±•é˜…è¯»"><a href="#æ‹“å±•é˜…è¯»" class="headerlink" title="æ‹“å±•é˜…è¯»"></a>æ‹“å±•é˜…è¯»</h2><ol>
<li><a href="https://hacks.mozilla.org/2016/02/smoother-scrolling-in-firefox-46-with-apz/" target="_blank" rel="noopener">https://hacks.mozilla.org/2016/02/smoother-scrolling-in-firefox-46-with-apz/</a></li>
<li><a href="https://developers.google.com/web/updates/2018/09/inside-browser-part4" target="_blank" rel="noopener">https://developers.google.com/web/updates/2018/09/inside-browser-part4</a></li>
</ol>
]]></content>
      <categories>
        <category>å¤§å‰ç«¯</category>
      </categories>
      <tags>
        <tag>HTML</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¸ºä»€ä¹ˆä¸ç”¨rAFè¿›è¡Œæ»šåŠ¨èŠ‚æµ</title>
    <url>/2020/01/07/2020/%E4%B8%BA%E4%BB%80%E4%B9%88%E4%B8%8D%E7%94%A8rAF%E8%BF%9B%E8%A1%8C%E6%BB%9A%E5%8A%A8%E8%8A%82%E6%B5%81/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ä¹‹å‰å†™äº†ä¸€ç¯‡é•¿åˆ—è¡¨å®ç°çš„åˆ†äº« â€“ <a href="https://juejin.im/post/5dea86f7f265da33a8758820" target="_blank" rel="noopener">ã€Œå‰ç«¯é•¿åˆ—è¡¨ã€å¼€æºåº“è§£æåŠæœ€ä½³å®è·µ</a></p>
<p>ç„¶åé¢è¯•è¢«é—®åˆ°çš„æœ€å¤šçš„é—®é¢˜å°±æ˜¯ï¼šæœ‰æ²¡æœ‰åšèŠ‚æµ</p>
<p>å½“æ—¶çš„å›ç­”æ˜¯æ²¡æœ‰ï¼Œä½†æ˜¯åˆè¯´ä¸å‡ºä¸€ä¸ªç³»ç»Ÿçš„å›ç­”</p>
<p>æœ¬æ–‡å°±æ¥è¯´è¯´ä¸ºä»€ä¹ˆé•¿åˆ—è¡¨ä¸éœ€è¦åšèŠ‚æµï¼Œä»¥åŠä»€ä¹ˆæƒ…å†µä¸‹æ»šåŠ¨éœ€è¦åšèŠ‚æµ</p>
<a id="more"></a>

<h2 id="èƒŒæ™¯çŸ¥è¯†ä¹‹äº‹ä»¶å¾ªç¯"><a href="#èƒŒæ™¯çŸ¥è¯†ä¹‹äº‹ä»¶å¾ªç¯" class="headerlink" title="èƒŒæ™¯çŸ¥è¯†ä¹‹äº‹ä»¶å¾ªç¯"></a>èƒŒæ™¯çŸ¥è¯†ä¹‹äº‹ä»¶å¾ªç¯</h2><p>è¯¦è§<a href="https://html.spec.whatwg.org/multipage/webappapis.html#event-loops" target="_blank" rel="noopener">HTMLè§„èŒƒ</a></p>
<p>è¿™é‡ŒåªæŒ‘ä¸æœ¬æ–‡ç›¸å…³çš„è®²</p>
<p>åœ¨äº‹ä»¶å¾ªç¯ä¸­å®šä¹‰äº†å¾ˆå¤šä»»åŠ¡æºï¼Œæ¯”å¦‚é¼ æ ‡é”®ç›˜ç­‰è¾“å…¥æ“ä½œçš„ç”¨æˆ·äº¤äº’ä»»åŠ¡æº</p>
<p>ä¸€æ¬¡ç‚¹å‡»æ“ä½œï¼Œå…¶å®åŒ…å«å¤šä¸ªè¾“å…¥æ“ä½œï¼ˆmousedown,mouseup,clickï¼‰ï¼Œéƒ½æ·»åŠ åˆ°ç›¸åŒçš„ä»»åŠ¡æºé˜Ÿåˆ—ä¸­ï¼Œè¿›è€Œäº§ç”Ÿå¤šè½®çš„äº‹ä»¶å¾ªç¯ï¼Œå…¶è¡¨ç°å°±æ˜¯æ‰§è¡Œç›¸å…³å…ƒç´ çš„äº‹ä»¶å›è°ƒï¼ˆå®ä»»åŠ¡ï¼‰</p>
<p>å®ä»»åŠ¡æ‰§è¡Œåï¼Œåé¢å°±æ˜¯å¾®ä»»åŠ¡é˜Ÿåˆ—å’Œæ›´æ–°æ¸²æŸ“é˜¶æ®µ</p>
<p>æ¯è½®äº‹ä»¶å¾ªç¯å¯èƒ½æ˜¯éå¸¸å¿«çš„ï¼Œæ¯ç§’æ‰§è¡Œäº‹ä»¶å¾ªç¯çš„æ¬¡æ•°å¯èƒ½å¤§äº60æ¬¡</p>
<p>å—ç¡¬ä»¶åˆ·æ–°ç‡å½±å“ï¼Œæˆ‘ä»¬åªè¦ä¿è¯ fps è¾¾åˆ°æœ€å¤§ç¡¬ä»¶åˆ·æ–°ç‡(æ¯”å¦‚60)å³å¯ï¼Œå› æ­¤ä¸éœ€è¦æ¯è½®äº‹ä»¶å¾ªç¯éƒ½æ›´æ–°æ¸²æŸ“</p>
<h2 id="è¾“å…¥äº‹ä»¶ä¸æ»šåŠ¨äº‹ä»¶çš„æ‰§è¡Œæ—¶æœº"><a href="#è¾“å…¥äº‹ä»¶ä¸æ»šåŠ¨äº‹ä»¶çš„æ‰§è¡Œæ—¶æœº" class="headerlink" title="è¾“å…¥äº‹ä»¶ä¸æ»šåŠ¨äº‹ä»¶çš„æ‰§è¡Œæ—¶æœº"></a>è¾“å…¥äº‹ä»¶ä¸æ»šåŠ¨äº‹ä»¶çš„æ‰§è¡Œæ—¶æœº</h2><p>å¯¹äºè¾“å…¥äº‹ä»¶ï¼Œå…¶æ‰§è¡Œæ—¶æœºä¸ºæ¯è½®äº‹ä»¶å¾ªç¯çš„ä»»åŠ¡æ‰§è¡Œé˜¶æ®µï¼Œè¿™ä¸ªäº‹ä»¶æ˜¯ä¸å—åˆ·æ–°ç‡å½±å“çš„ï¼Œæ¯ç§’çš„æ‰§è¡Œæ¬¡æ•°å¯èƒ½å¤šäº60æ¬¡</p>
<p>ä¸ºä»€ä¹ˆè°ˆè¿™ä¸ªå‘¢ï¼Œå› ä¸ºè¿™ä¸ªä¸æ»šåŠ¨äº‹ä»¶(scroll)å›è°ƒçš„æ‰§è¡Œæ—¶æœºä¸ä¸€è‡´</p>
<p>æŒ‰ç…§ HTML è§„èŒƒï¼Œæ»šåŠ¨äº‹ä»¶å›è°ƒåœ¨ UI Render é˜¶æ®µçš„æŸä¸ªæ­¥éª¤ä¸­è¿›è¡Œï¼Œè€Œä¸æ˜¯å•ç‹¬çš„ä¸€ä¸ªä»»åŠ¡æº</p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œæ»šåŠ¨äº‹ä»¶å›è°ƒå—æ¸²æŸ“æ—¶æœºå½±å“ï¼Œä»…æ‰§è¡Œæ›´æ–°æ¸²æŸ“æ—¶æ‰æ‰§è¡Œè¯¥å›è°ƒã€‚</p>
<p>æ¢å¥è¯è¯´ï¼Œè¯¥äº‹ä»¶è‡ªå¸¦èŠ‚æµã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­éªŒè¯ä¸‹è¾“å…¥äº‹ä»¶å’Œæ›´æ–°æ¸²æŸ“çš„æ‰§è¡Œæ—¶æœº</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">document</span>.addEventListener(<span class="string">"mousemove"</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">let</span> start = performance.now()</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"mousemove:"</span>,start)</span><br><span class="line">  requestAnimationFrame(<span class="function"><span class="keyword">function</span>(<span class="params">t</span>)</span>&#123;<span class="built_in">console</span>.log(<span class="string">"ui render:"</span>,start,t)&#125;)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// ç»“æœå°±æ˜¯å¯èƒ½è¾“å‡ºå‡ è½® mousemove ç„¶åæ‰§è¡Œä¸€æ¬¡ ui render -- æ¸…ç©º rAF å›è°ƒé˜Ÿåˆ—(è¾“å‡ºå¤šæ¬¡ ui render)</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">mousemove: 4091.025000088848</span></span><br><span class="line"><span class="comment">ui render: 4091.025000088848 4077.594</span></span><br><span class="line"><span class="comment">mousemove: 4098.845000029542</span></span><br><span class="line"><span class="comment">ui render: 4098.845000029542 4094.278</span></span><br><span class="line"><span class="comment">mousemove: 4110.160000040196</span></span><br><span class="line"><span class="comment">mousemove: 4115.5349999899045</span></span><br><span class="line"><span class="comment">ui render: 4110.160000040196 4110.962</span></span><br><span class="line"><span class="comment">ui render: 4115.5349999899045 4110.962</span></span><br><span class="line"><span class="comment">mousemove: 4123.810000019148</span></span><br><span class="line"><span class="comment">mousemove: 4130.160000058822</span></span><br><span class="line"><span class="comment">ui render: 4123.810000019148 4127.719</span></span><br><span class="line"><span class="comment">ui render: 4130.160000058822 4127.719</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p>è¯´æ˜æ›´æ–°æ¸²æŸ“æœ‰ä¸€å®šçš„é—´éš”ï¼Œè‡³å°‘æ˜¯ 1/60 çš„é—´éš”ï¼Œè€Œè¾“å…¥ä»»åŠ¡æ²¡æœ‰æ­¤é™åˆ¶</p>
<p>æ‰€ä»¥ï¼Œä»¥ä¸‹ä»£ç æ˜¯æ²¡æœ‰æ•ˆæœçš„ï¼Œå› ä¸ºè¯¥å›è°ƒå·²ç»è‡ªå¸¦èŠ‚æµäº†</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">document</span>.addEventListener(<span class="string">"scroll"</span>,<span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</span><br><span class="line">  requestAnimationFrame(<span class="function"><span class="keyword">function</span>(<span class="params">t</span>)</span>&#123;</span><br><span class="line">    <span class="comment">//æ‰§è¡Œscrollå…·ä½“é€»è¾‘</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="ä»€ä¹ˆæ—¶å€™æ»šåŠ¨éœ€è¦åšèŠ‚æµ"><a href="#ä»€ä¹ˆæ—¶å€™æ»šåŠ¨éœ€è¦åšèŠ‚æµ" class="headerlink" title="ä»€ä¹ˆæ—¶å€™æ»šåŠ¨éœ€è¦åšèŠ‚æµ"></a>ä»€ä¹ˆæ—¶å€™æ»šåŠ¨éœ€è¦åšèŠ‚æµ</h2><p>åˆ©ç”¨èŠ‚æµå¯ä»¥å‡å°‘å›è°ƒçš„æ‰§è¡Œæ¬¡æ•°ï¼Œä½¿å¾—å›ºå®šæ—¶é—´å‘¨æœŸå†…åªæ‰§è¡Œä¸€æ¬¡</p>
<p>åˆšæ‰æåˆ°ï¼Œæ»šåŠ¨äº‹ä»¶è‡ªå¸¦èŠ‚æµï¼ŒèŠ‚æµçš„æ—¶é—´å‘¨æœŸæ˜¯ä¸æ¸²æŸ“æ—¶æœºç›¸å…³</p>
<p>åˆ¤æ–­æ˜¯å¦éœ€è¦é¢å¤–çš„èŠ‚æµçš„å…³é”®æ˜¯ï¼šå½“å‰çš„èŠ‚æµè§„åˆ™ï¼Œæ˜¯å¦å¤§éƒ¨åˆ†å›è°ƒçš„æ‰§è¡Œéƒ½èƒ½è®©ç”¨æˆ·å—ç›Š</p>
<p>å¦‚æœæ˜¯åŠ¨ç”»æ•ˆæœï¼Œå®æ—¶ç»˜åˆ¶çš„ç•Œé¢ç­‰ï¼Œåˆ™ä¸éœ€è¦é¢å¤–çš„èŠ‚æµäº†ã€‚</p>
<p>ä»¥é•¿åˆ—è¡¨ä¸ºä¾‹ï¼Œæ¯æ¬¡æ‰§è¡Œæ»šåŠ¨å›è°ƒï¼Œä¼šè®¡ç®—æ–°çš„æ¸²æŸ“åˆ—è¡¨é¡¹åŠæ»šåŠ¨åç§»ä½ç½®ã€‚å¦‚æœåº”ç”¨æ›´å¤§æ—¶é—´å‘¨æœŸçš„èŠ‚æµï¼Œä¼šå‡ºç°æŸä¸€å¸§å‡ºç°æ»šåŠ¨ä½†ç•Œé¢æ²¡æœ‰æ›´æ–°çš„æƒ…å†µï¼Œè®©ç”¨æˆ·æ„Ÿè§‰äº§ç”Ÿå¡é¡¿ã€‚</p>
<p>è€Œå…¶ä»–æ¯”è¾ƒå¤æ‚çš„ä¸šåŠ¡é€»è¾‘ï¼Œä¸èƒ½åœ¨çŸ­æ—¶é—´å†…å¾—åˆ°åé¦ˆçš„ï¼Œåˆ™éœ€è¦é¢å¤–è¿›è¡ŒèŠ‚æµ</p>
<p>ä»¥æ»šåŠ¨æ‡’åŠ è½½å›¾ç‰‡ä¸ºä¾‹</p>
<p>ç”±äºæ¯ç§’çš„æ»šåŠ¨å›è°ƒçš„æ‰§è¡Œæ¬¡æ•°å¯èƒ½è¾¾åˆ°60æ¬¡ï¼Œè€Œæ¯æ¬¡æ‰§è¡Œéƒ½éœ€è¦å»è·å–å½“å‰å¤„äºè§†åŒºçš„å ä½å›¾å¹¶å‘èµ·å›¾ç‰‡è¯·æ±‚</p>
<p>è€Œè¿™å¤§éƒ¨åˆ†å›è°ƒçš„æ‰§è¡Œï¼Œç”¨æˆ·æ˜¯ä¸èƒ½å—ç›Šçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æé«˜èŠ‚æµçš„æ—¶é—´å‘¨æœŸï¼Œæ¯”å¦‚ 500ms è¿™æ ·</p>
<h2 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h2><p>æ»šåŠ¨äº‹ä»¶å·²è‡ªå¸¦èŠ‚æµï¼Œåªæœ‰ä¸€äº›ç‰¹å®šçš„ä¸šåŠ¡é€»è¾‘æ‰éœ€è¦é¢å¤–è¿›è¡Œæ›´é«˜æ—¶é—´å‘¨æœŸçš„èŠ‚æµ</p>
<h2 id="æ‹“å±•é˜…è¯»"><a href="#æ‹“å±•é˜…è¯»" class="headerlink" title="æ‹“å±•é˜…è¯»"></a>æ‹“å±•é˜…è¯»</h2><ol>
<li><a href="https://stackoverflow.com/questions/41740082/scroll-events-requestanimationframe-vs-requestidlecallback-vs-passive-event-lis" target="_blank" rel="noopener">scroll events: requestAnimationFrame VS requestIdleCallback VS passive event listeners</a></li>
</ol>
]]></content>
      <categories>
        <category>å¤§å‰ç«¯</category>
      </categories>
      <tags>
        <tag>é•¿åˆ—è¡¨</tag>
      </tags>
  </entry>
  <entry>
    <title>HTTPçŠ¶æ€ç </title>
    <url>/2020/01/02/Web%E6%8A%80%E6%9C%AF/HTTP%E7%8A%B6%E6%80%81%E7%A0%81/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ä»…è®°å½•ä¸€äº›å¯èƒ½è¯¯ç”¨çš„çŠ¶æ€ç </p>
<a id="more"></a>

<h2 id="3xx"><a href="#3xx" class="headerlink" title="3xx"></a>3xx</h2><h3 id="301"><a href="#301" class="headerlink" title="301"></a>301</h3><p>æ°¸ä¹…é‡å®šå‘ï¼ˆä¸‹æ¬¡å†è®¿é—®åŸé“¾æ¥ï¼Œæµè§ˆå™¨ä¼šç›´æ¥è®¿é—®é‡å®šå‘åçš„é“¾æ¥ï¼‰</p>
<p>ä¸€èˆ¬ç”¨åˆ°çš„åœºæ™¯å°±æ˜¯</p>
<ul>
<li>åŸåŸŸåä¸ç»´æŠ¤äº†</li>
<li>http è½¬ https</li>
</ul>
<h3 id="302-303-307"><a href="#302-303-307" class="headerlink" title="302 303 307"></a>302 303 307</h3><p>ä¸´æ—¶é‡å®šå‘ï¼Œå¤§éƒ¨åˆ†é‡å®šå‘éƒ½é‡‡ç”¨çš„ä¸´æ—¶çš„</p>
<p>http1.0 ä¸­åªæœ‰ 302</p>
<p>åœ¨ http1.1 ä¸­ç»†åˆ†ä¸º 303 307 </p>
<p>æµè§ˆå™¨ä¼šæ ¹æ®çŠ¶æ€ç åšä¸åŒçš„æ“ä½œ</p>
<p>åŸè¯·æ±‚æ˜¯ get/head è¯·æ±‚çš„è¯æ²¡æœ‰åŒºåˆ«</p>
<p>é get/head è¯·æ±‚çš„è¯å°±ä¼šæœ‰åŒºåˆ«</p>
<p>è§„èŒƒè¦æ±‚ 302 é‡å®šå‘æ—¶è¯·æ±‚æ–¹æ³•å’Œè¯·æ±‚ä¸»ä½“ä¸å˜ï¼Œä½†æ˜¯ä¸æ˜¯æ‰€æœ‰æµè§ˆå™¨éƒ½éµå®ˆï¼Œæ‰€ä»¥è¿™æ˜¯ä¸å¯é¢„æµ‹çš„</p>
<p>303 æ˜ç¡®è¯´æ˜é get/head è¯·æ±‚ä¼šè½¬ä¸º get è¯·æ±‚</p>
<blockquote>
<p>é€šå¸¸ä½œä¸º PUT æˆ– POST æ“ä½œçš„è¿”å›ç»“æœ</p>
</blockquote>
<p>307 æ˜ç¡®è¯´æ˜è¯·æ±‚æ–¹æ³•å’Œè¯·æ±‚ä¸»ä½“ä¸å˜</p>
<p>æœ‰äº›æ–‡ç« è¯´ get è¯·æ±‚ä¸ä¼šè‡ªåŠ¨å¸¦ä¸Šè¯·æ±‚å‚æ•°ï¼Œå…¶å®æ˜¯ location å“åº”ç æ§åˆ¶çš„ï¼ŒæœåŠ¡ç«¯æ˜¯å¯ä»¥æ§åˆ¶çš„ï¼Œæ§åˆ¶ä¸äº†çš„åªæœ‰ request body</p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status</a></p>
<p><a href="https://www.56way.com/p/98.html" target="_blank" rel="noopener">https://www.56way.com/p/98.html</a></p>
<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status/307" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status/307</a></p>
]]></content>
      <categories>
        <category>Web</category>
      </categories>
      <tags>
        <tag>HTTP</tag>
      </tags>
  </entry>
  <entry>
    <title>æµ…è°ˆAngularçš„è„æ£€æŸ¥æœºåˆ¶</title>
    <url>/2019/12/31/2019Q4/%E6%B5%85%E8%B0%88Angular%E7%9A%84%E8%84%8F%E6%A3%80%E6%9F%A5%E6%9C%BA%E5%88%B6/</url>
    <content><![CDATA[<p>æ²¡æœ‰å­¦è¿‡ Angularï¼Œåªæ˜¯å’Œæœ‹å‹é—²èŠçš„æ—¶å€™è°ˆåˆ°è¿™ä¸ªï¼Œæœ¬ç¯‡ä½œä¸ºä¸€ä¸ªè®°å½•ï¼Œè°ˆè°ˆæˆ‘ç†è§£çš„è„æ£€æŸ¥</p>
<a id="more"></a>

<p>angular ä¸ä¼šå»ç›‘å¬æ•°æ®å˜åŠ¨ï¼Œè€Œæ˜¯å½“äº‹ä»¶è§¦å‘ï¼ˆæ¨¡æ¿ç»‘å®š/ä¸»åŠ¨è§¦å‘ï¼‰æ—¶ï¼Œæ›´æ–°æ•°æ®ï¼Œæœ€åä¼šæ‰§è¡Œä¸€ä¸ªé‡æ¸²æŸ“çš„æ“ä½œ</p>
<p>æ‰€ä»¥è¿™ä¸€å¥—æœºåˆ¶å¾ˆç®€å•ï¼Œè§¦å‘äº†ä¼šæ”¹å˜åº”ç”¨ç¨‹åºçŠ¶æ€çš„å‡½æ•°ï¼Œä¼šè§¦å‘æ¨¡æ¿é‡æ¸²æŸ“ï¼Œä¸€èˆ¬æœ‰è¿™å‡ ç§æ´»åŠ¨ï¼š</p>
<ol>
<li>äº‹ä»¶ï¼šclick,change</li>
<li>xhr:è¿œç¨‹æ•°æ®è·å–</li>
<li>å®šæ—¶å™¨</li>
</ol>
<p>å½“ç„¶ ç”±äºæ²¡å­¦è¿‡ï¼Œä¸çŸ¥é“ç†è§£å¯¹ä¸å¯¹</p>
<hr>
<p>200318 æ›´æ–°ï¼š</p>
<p>ä¸Šè¿°å‡ ç§è¡Œä¸ºï¼Œéƒ½æ˜¯ä¸€ä¸ªå®ä»»åŠ¡ï¼Œangular å¯¹è¿™äº› api è¿›è¡Œäº†å°è£…ã€‚</p>
<p>åœ¨è¿™ä¸ªå®ä»»åŠ¡ç»“æŸä¹‹åï¼Œä¼šæ‰§è¡Œæ•°æ®çš„æ‰¹é‡æ›´æ–°ï¼Œå¹¶é‡æ–°ç¼–è¯‘æ¨¡æ¿ç”Ÿæˆè™šæ‹Ÿ dom æ ‘ï¼Œåé¢çš„ diff å°±å’Œ react ç±»ä¼¼äº†</p>
<p>åé¢çš„æ­¥éª¤ï¼Œå¯èƒ½æ˜¯åƒ vue/react é‚£æ ·åœ¨å¾®ä»»åŠ¡ä¸­è¿›è¡Œï¼Œä¹Ÿå¯èƒ½å°±æ˜¯åœ¨å®ä»»åŠ¡æœ«å°¾è¿›è¡Œã€‚å…·ä½“æ–¹æ¡ˆæ²¡æœ‰ç ”ç©¶</p>
]]></content>
      <categories>
        <category>å¤§å‰ç«¯</category>
      </categories>
      <tags>
        <tag>Angular</tag>
      </tags>
  </entry>
  <entry>
    <title>é‡å­¦ JS åŸå‹é“¾</title>
    <url>/2019/12/31/2019Q4/%E9%87%8D%E5%AD%A6%20JS%20%E5%8E%9F%E5%9E%8B%E9%93%BE/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ä¸è€ƒè™‘ç®­å¤´å‡½æ•°ç­‰ç‰¹å¼‚å‡½æ•°ï¼Œæœ¬æ–‡æ‰€è¯´çš„å‡½æ•°éƒ½æ˜¯æŒ‡çš„æ„é€ å‡½æ•°</p>
<p>ä¹‹å‰å¯¹åŸå‹ï¼ŒåŸå‹é“¾ï¼Œæ„é€ å‡½æ•°ç­‰éƒ½æ˜¯é›¶é›¶æ•£æ•£çš„çŸ¥è¯†ç¢ç‰‡ï¼Œè¿™æ¬¡å†™ä¸ªæ–‡ç« è®°å½•ä¸€ä¸‹</p>
<a id="more"></a>

<h2 id="åŸå‹å¯¹è±¡-prototype"><a href="#åŸå‹å¯¹è±¡-prototype" class="headerlink" title="åŸå‹å¯¹è±¡ prototype"></a>åŸå‹å¯¹è±¡ prototype</h2><p>åˆ›å»ºä¸€ä¸ªå‡½æ•° F æ—¶ï¼Œä¼šè‡ªåŠ¨ä¸ºè¯¥å‡½æ•° F åˆ›å»ºä¸€ä¸ª prototype å±æ€§ï¼ŒæŒ‡å‘ä¸€ä¸ªåŸå‹å¯¹è±¡ F.prototype</p>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå‡½æ•° F çš„åŸå‹å¯¹è±¡ F.prototype ä¼šè‡ªåŠ¨è·å¾—ä¸€ä¸ª constructor ï¼ˆæ„é€ å‡½æ•°ï¼‰å±æ€§ï¼Œå¹¶æŒ‡å‘ F </p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">F.prototype.constructor === F <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<p>è€ŒåŸå‹å¯¹è±¡ä¹Ÿæ˜¯å¯¹è±¡ï¼Œå¯ä»¥å¯¹å…¶æ·»åŠ å±æ€§å’Œæ–¹æ³•</p>
<h2 id="proto"><a href="#proto" class="headerlink" title="__proto__"></a>__proto__</h2><p>æ¯ä¸ªå¯¹è±¡éƒ½æœ‰ä¸€ä¸ª <code>__proto__</code> å±æ€§ï¼Œ<strong>æŒ‡å‘ç”Ÿæˆè¯¥å¯¹è±¡çš„æ„é€ å‡½æ•°çš„åŸå‹å¯¹è±¡</strong></p>
<p>å¦‚ F.prototype åŸå‹å¯¹è±¡æ˜¯ Object çš„ä¸€ä¸ªå®ä¾‹ï¼Œ <code>__proto__</code> æŒ‡å‘ <code>Object.prototype</code></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">F.prototype.__proto__ === <span class="built_in">Object</span>.prototype <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<p>Object.prototype è¿™ä¸ªåŸå‹å¯¹è±¡ä¹Ÿæ˜¯å¯¹è±¡ï¼Œé‚£ä¹ˆå…¶ <code>__proto__</code> æŒ‡å‘å“ªï¼Ÿå…¶å®æŒ‡å‘çš„æ˜¯ null</p>
<p>Object.prototype ä¸ºä¸‡ç‰©èµ·æº</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Object</span>.prototype.__proto__ === <span class="literal">null</span> <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<p>å½“å®ä¾‹åŒ– F å¾—åˆ°å¯¹è±¡ f æ—¶,f çš„ <code>__proto__</code> å±æ€§æŒ‡å‘ F çš„åŸå‹å¯¹è±¡ F.prototype</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> f = <span class="keyword">new</span> F()</span><br><span class="line">f.__proto__ === F.prototype <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªæŒ‡å‘å†åˆ›å»ºåå°±ç¡®å®šäº†ï¼Œåç»­ä¿®æ”¹ F çš„åŸå‹å¯¹è±¡æŒ‡å‘ä¹Ÿæ²¡æœ‰å½±å“</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">F</span>(<span class="params"></span>)</span>&#123;&#125;</span><br><span class="line"><span class="keyword">const</span> f1 = <span class="keyword">new</span> F</span><br><span class="line">F.prototype = &#123;&#125;</span><br><span class="line"><span class="keyword">const</span> f2 = <span class="keyword">new</span> F</span><br><span class="line"><span class="comment">// æŒ‡å‘ä¸ä¸€è‡´</span></span><br><span class="line">f1.__proto__ !== f2.__proto__ <span class="comment">// true</span></span><br><span class="line"><span class="comment">// æ–°çš„åŸå‹å¯¹è±¡ &#123;&#125; æ²¡æœ‰æ„é€ å‡½æ•°ï¼Œå¯ä»¥ä¸ºå…¶èµ‹å€¼</span></span><br><span class="line">F.prototype.constructor !== F <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<h2 id="åŸå‹é“¾"><a href="#åŸå‹é“¾" class="headerlink" title="åŸå‹é“¾"></a>åŸå‹é“¾</h2><p>ä¸Šè¿°çš„å…³ç³»ï¼Œé€šè¿‡åŸå‹ä¸²æ¥èµ·æ¥ï¼Œå¯ä»¥å¾—åˆ°ä¸‹é¢è¿™ä¸ªå›¾</p>
<p><img src="https://upload-images.jianshu.io/upload_images/9277731-efe713a1eb340c2d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image"></p>
<p>å¦‚æœé—®ä»€ä¹ˆæ˜¯åŸå‹ï¼Œå°±è¿™ä¹ˆå›ç­”ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">æ¯ä¸ªæ„é€ å‡½æ•°æœ‰ä¸ªåŸå‹å¯¹è±¡</span><br><span class="line">æ¯ä¸ªå®ä¾‹å¯¹è±¡æœ‰ä¸ª __proto__ å±æ€§ï¼ŒæŒ‡å‘è¯¥å®ä¾‹çš„æ„é€ å‡½æ•°çš„åŸå‹å¯¹è±¡</span><br></pre></td></tr></table></figure>

<p>å¯¹å¯¹è±¡å±æ€§æˆ–æ–¹æ³•çš„è®¿é—®ï¼Œé‡‡ç”¨çš„æ˜¯åŸå‹é“¾æœç´¢ï¼Œå…ˆæœç´¢å¯¹è±¡å®ä¾‹ f è‡ªèº«ï¼Œæ²¡æ‰¾åˆ°çš„è¯ï¼Œæœç´¢åŸå‹å¯¹è±¡ï¼Œå†æ²¡æ‰¾åˆ°ï¼Œæœç´ è¯¥åŸå‹å¯¹è±¡çš„åŸå‹å¯¹è±¡ï¼Œç›´åˆ°ä¸å­˜åœ¨åŸå‹å¯¹è±¡</p>
<p>æ¯”å¦‚è®¿é—® <code>f.name</code> å°†æŒ‰ä»¥ä¸‹é¡ºåºæœç´¢å€¼</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">f.name</span><br><span class="line">f.__proto__.name / F.prototype.name</span><br><span class="line">f.__proto__.__proto__.name / <span class="built_in">Object</span>.prototype.name</span><br></pre></td></tr></table></figure>

<p>åˆ¤æ–­å®ä¾‹ f ä¸­æ˜¯å¦å«æœ‰ name å±æ€§ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹æ³•</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">f.hasOwnProperty(<span class="string">"name"</span>)</span><br></pre></td></tr></table></figure>
<p>åˆ¤æ–­åŸå‹ä¸­æ˜¯å¦å«æœ‰ name å±æ€§ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹æ³•</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">!f.hasOwnProperty(<span class="string">"name"</span>) &amp;&amp; <span class="string">"name"</span> <span class="keyword">in</span> f</span><br></pre></td></tr></table></figure>

<h2 id="ç»§æ‰¿"><a href="#ç»§æ‰¿" class="headerlink" title="ç»§æ‰¿"></a>ç»§æ‰¿</h2><h3 id="class"><a href="#class" class="headerlink" title="class"></a>class</h3><p>åœ¨ es6 ä¸­ï¼Œæˆ‘ä»¬æ˜¯è¿™æ ·åšçš„</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Engineer</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(name)&#123;</span><br><span class="line">    <span class="keyword">this</span>.name = name</span><br><span class="line">    <span class="keyword">this</span>.skills = [<span class="string">'linux'</span>,<span class="string">'network'</span>,<span class="string">'os'</span>]</span><br><span class="line">  &#125;</span><br><span class="line">  coding()&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;<span class="keyword">this</span>.name&#125;</span> æ­£åœ¨ç¼–ç `</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FeEngineer</span> <span class="keyword">extends</span> <span class="title">Engineer</span></span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(name)&#123;</span><br><span class="line">    <span class="keyword">super</span>(name)</span><br><span class="line">    <span class="keyword">this</span>.skills.push(<span class="string">'web'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  croping()&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;<span class="keyword">this</span>.name&#125;</span> æ­£åœ¨åˆ‡å›¾`</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ¯ä¸ª Engineer éƒ½æœ‰ä¸€å¥—åŸºç¡€æŠ€èƒ½ skills å’Œä¸€ä¸ªç¼–ç æ–¹æ³• coding</p>
<p>FeEngineer ç»§æ‰¿äº† Engineer çš„åŸºç¡€æŠ€èƒ½å’Œç¼–ç æ–¹æ³•ï¼Œå¹¶æ·»åŠ äº†è‡ªå·±çš„æŠ€èƒ½</p>
<p>å®ä¾‹åŒ–ä¸€ä¸ª FeEngineer çœ‹ä¸‹æ•ˆæœ</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> fe = <span class="keyword">new</span> FeEngineer(<span class="string">"gahing"</span>)</span><br><span class="line"><span class="built_in">console</span>.log(fe)</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">  name: "gahing",</span></span><br><span class="line"><span class="comment">  skills: ["linux", "network", "os", "web"],</span></span><br><span class="line"><span class="comment">  __proto__: Engineer &#123;</span></span><br><span class="line"><span class="comment">    constructor: class FeEngineer,</span></span><br><span class="line"><span class="comment">    croping: Æ’ croping(),</span></span><br><span class="line"><span class="comment">    __proto__: Object &#123;</span></span><br><span class="line"><span class="comment">      coding: Æ’ coding()</span></span><br><span class="line"><span class="comment">      constructor: class Engineer</span></span><br><span class="line"><span class="comment">      __proto__: Object</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">  &#125;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">Engineer.prototype.constructor === Engineer <span class="comment">// true</span></span><br><span class="line">fe.__proto__ === FeEngineer.prototype <span class="comment">// true</span></span><br></pre></td></tr></table></figure>



<p>ç„¶åè¯´è¯´å®ä¾‹åŒ– FeEngineer æ‰§è¡Œçš„è¿‡ç¨‹</p>
<p>å­ç±»ä¸­çš„æ„é€ å‡½æ•°å¿…é¡»è°ƒç”¨ super ï¼ŒåŸå› åœ¨äº js æ˜¯è¿™æ ·å¤„ç†çš„ï¼š</p>
<ul>
<li>å®ä¾‹åŒ–ä¸€ä¸ªæ™®é€šçš„æ„é€ å‡½æ•°æ—¶ï¼Œä¼šåˆ›å»ºä¸€ä¸ªç©ºå¯¹è±¡ä½œä¸º this ï¼Œç„¶åç»§ç»­è¿è¡Œ</li>
<li>è€Œå®ä¾‹åŒ–ä¸€ä¸ªæ´¾ç”Ÿï¼ˆå­ç±»ï¼‰çš„æ„é€ å‡½æ•°æ—¶ï¼Œéœ€è¦åˆ©ç”¨çˆ¶æ„é€ å‡½æ•°æ¥å®Œæˆä¸Šé¢è¿™ä»¶äº‹ â€“ æ‰§è¡Œ <code>super(...)</code>ã€‚äºæ˜¯ï¼Œçˆ¶æ„é€ å‡½æ•°åˆ›å»ºäº†ä¸€ä¸ªç©ºå¯¹è±¡ä½œä¸º thisï¼Œç„¶åç»§ç»­è¿è¡Œçˆ¶æ„é€ å‡½æ•°çš„ä»£ç ã€‚è€Œååˆ©ç”¨è¯¥ this å¯¹è±¡ç»§ç»­æ‰§è¡Œå­ç±»çš„æ„é€ å‡½æ•°ä¸­çš„ä»£ç </li>
</ul>
<p>æ³¨æ„åˆ›å»º this çš„ä½ç½®ï¼Œæ‰€ä»¥ä¸‹é¢ä»£ç æ˜¯ä¼šæŠ¥é”™çš„ã€‚</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Super</span></span>&#123;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Sub</span> <span class="keyword">extends</span> <span class="title">Super</span></span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>()&#123;</span><br><span class="line">    <span class="keyword">this</span>.name = <span class="string">"1"</span></span><br><span class="line">    <span class="keyword">super</span>()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">new</span> Sub() <span class="comment">// Uncaught ReferenceError: Must call super constructor in derived class before accessing 'this' or returning from derived constructor</span></span><br></pre></td></tr></table></figure>
<p>æç¤º this çš„è®¿é—®å¿…é¡»åœ¨æ‰§è¡Œ super ä¹‹åï¼Œæ‰€ä»¥å’Œç­‰ç­‰è¦è°ˆåˆ°çš„<em>å€Ÿç”¨æ„é€ å‡½æ•°æ³•</em>è¿˜æ˜¯æœ‰ç‚¹ä¸ä¸€æ ·çš„ï¼Œè¿™é‡Œå…ˆç®€å•çš„ä¸Šä¸ªç»„åˆç»§æ‰¿çš„ä»£ç </p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Super</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.age = <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Sub</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.name = <span class="string">"test"</span></span><br><span class="line">  Super.call(<span class="keyword">this</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">new</span> Sub() <span class="comment">// &#123;age:1,name:"test"&#125;</span></span><br></pre></td></tr></table></figure>



<p>ä¸‹é¢æˆ‘ä»¬çœ‹çœ‹ç”¨ es5 æ€ä¹ˆå®ç°ä¸Šé¢çš„æ•ˆæœ</p>
<h3 id="åŸå‹é“¾ç»§æ‰¿æ³•"><a href="#åŸå‹é“¾ç»§æ‰¿æ³•" class="headerlink" title="åŸå‹é“¾ç»§æ‰¿æ³•"></a>åŸå‹é“¾ç»§æ‰¿æ³•</h3><p>åˆ›å»ºæ„é€ å‡½æ•°æ—¶ï¼ŒåŸå‹å¯¹è±¡ä¼šè‡ªåŠ¨åˆ›å»ºï¼Œä¹Ÿå¯ä»¥å°†å…¶æŒ‡å‘å…¶ä»–å¯¹è±¡ï¼Œå®ç°åŸå‹é“¾ç»§æ‰¿</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Engineer</span> (<span class="params">name</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.name = name</span><br><span class="line">  <span class="keyword">this</span>.skills = [<span class="string">'linux'</span>,<span class="string">'network'</span>,<span class="string">'os'</span>]</span><br><span class="line">&#125;</span><br><span class="line">Engineer.prototype.coding = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;<span class="keyword">this</span>.name&#125;</span> æ­£åœ¨ç¼–ç `</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">FeEngineer</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> engineer = <span class="keyword">new</span> Engineer(<span class="string">"gahing"</span>)</span><br><span class="line">FeEngineer.prototype = engineer</span><br><span class="line">FeEngineer.prototype.croping = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;<span class="keyword">this</span>.name&#125;</span> æ­£åœ¨åˆ‡å›¾`</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·å®ä¾‹åŒ– FeEngineer åï¼Œè¯¥å¯¹è±¡å°±èƒ½è®¿é—®çˆ¶ç±»å¯¹è±¡çš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³•äº†</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> fe = <span class="keyword">new</span> FeEngineer(<span class="string">'gahing'</span>)</span><br><span class="line"><span class="built_in">console</span>.log(fe)</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">FeEngineer &#123;</span></span><br><span class="line"><span class="comment">  __proto__: Engineer</span></span><br><span class="line"><span class="comment">    croping: Æ’ ()</span></span><br><span class="line"><span class="comment">    name: "gahing"</span></span><br><span class="line"><span class="comment">    skills: (3) ["linux", "network", "os"]</span></span><br><span class="line"><span class="comment">    __proto__: Object</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p>ä½†æ˜¯çœ‹åˆ°æ²¡æœ‰ï¼Œ <code>__proto__</code> æŠŠ fe å®ä¾‹å’ŒåŸå‹å¯¹è±¡ engineer è¿æ¥èµ·æ¥äº†ï¼Œ</p>
<p>ä¿®æ”¹ fe çš„å±æ€§å’Œæ–¹æ³•å¯èƒ½ä¼šæ”¹åŠ¨åˆ° engineer</p>
<p>å¦‚ä¸Šé¢çš„ä¾‹å­ï¼Œæœ¬æ¥ engineer æ˜¯æ²¡æœ‰ croping æ–¹æ³•çš„ï¼Œåé¢å´å› ä¸ºè¦ç»™ fe æ·»åŠ åŸå‹æ–¹æ³•ï¼Œå¯¼è‡´ engineer ä¹Ÿæœ‰è¿™ä¸ªæ–¹æ³•</p>
<h3 id="å€Ÿç”¨æ„é€ å‡½æ•°æ³•"><a href="#å€Ÿç”¨æ„é€ å‡½æ•°æ³•" class="headerlink" title="å€Ÿç”¨æ„é€ å‡½æ•°æ³•"></a>å€Ÿç”¨æ„é€ å‡½æ•°æ³•</h3><p>ç”±äºä¸ç”¨åŸå‹ç»§æ‰¿ï¼Œéœ€è¦æŠŠçˆ¶ç±»çš„åŸå‹æ–¹æ³•è½¬åˆ°å®ä¾‹æ–¹æ³•</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Engineer</span> (<span class="params">name</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.name = name</span><br><span class="line">  <span class="keyword">this</span>.skills = [<span class="string">'linux'</span>,<span class="string">'network'</span>,<span class="string">'os'</span>]</span><br><span class="line">  <span class="keyword">this</span>.coding = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;<span class="keyword">this</span>.name&#125;</span> æ­£åœ¨ç¼–ç `</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">FeEngineer</span>(<span class="params">name</span>)</span>&#123;</span><br><span class="line">  Engineer.call(<span class="keyword">this</span>,name)</span><br><span class="line">  <span class="keyword">this</span>.skills.push(<span class="string">'web'</span>)</span><br><span class="line">&#125;</span><br><span class="line">FeEngineer.prototype.croping = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;<span class="keyword">this</span>.name&#125;</span> æ­£åœ¨åˆ‡å›¾`</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·å®ä¾‹åŒ– FeEngineer åï¼Œè¯¥å¯¹è±¡å°±æ‹¥æœ‰äº†çˆ¶ç±»å¯¹è±¡çš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³•äº†</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> fe = <span class="keyword">new</span> FeEngineer(<span class="string">'gahing'</span>)</span><br><span class="line"><span class="built_in">console</span>.log(fe)</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">FeEngineer &#123;</span></span><br><span class="line"><span class="comment">  coding: Æ’ ()</span></span><br><span class="line"><span class="comment">  name: "gahing"</span></span><br><span class="line"><span class="comment">  skills: (4) ["linux", "network", "os", "web"]</span></span><br><span class="line"><span class="comment">  __proto__:</span></span><br><span class="line"><span class="comment">    croping: Æ’ ()</span></span><br><span class="line"><span class="comment">    constructor: Æ’ FeEngineer(name)</span></span><br><span class="line"><span class="comment">    __proto__: Object</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯è¿™æ ·ä¼šäº§ç”Ÿä¸€ä¸ªé—®é¢˜ï¼Œ FeEngineer å®ä¾‹çš„ coding æ–¹æ³•å’Œ Engineer å®ä¾‹çš„ coding æ–¹æ³•ä¸ä¸€æ ·ï¼Œå¹¶ä¸”æ¯ä¸ª FeEngineer å®ä¾‹çš„ coding æ–¹æ³•ä¹Ÿä¸ä¸€æ ·</p>
<p>å› ä¸ºè¯¥æ–¹æ³•æ˜¯æ¯æ¬¡å®ä¾‹åŒ–çš„æ—¶å€™ç”Ÿæˆçš„ï¼Œæ‰€ä»¥ä¹Ÿéå¸¸å å†…å­˜</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> engineer = <span class="keyword">new</span> Engineer()</span><br><span class="line"><span class="keyword">var</span> fe = <span class="keyword">new</span> FeEngineer()</span><br><span class="line">fe.coding === engineer.coding <span class="comment">//false</span></span><br></pre></td></tr></table></figure>



<h3 id="ç»„åˆç»§æ‰¿æ³•"><a href="#ç»„åˆç»§æ‰¿æ³•" class="headerlink" title="ç»„åˆç»§æ‰¿æ³•"></a>ç»„åˆç»§æ‰¿æ³•</h3><p>å€ŸåŠ©<em>åŸå‹é“¾ç»§æ‰¿æ³•<em>å®ç°åŸå‹æ–¹æ³•çš„ç»§æ‰¿ï¼Œå€ŸåŠ©</em>å€Ÿç”¨æ„é€ å‡½æ•°æ³•</em> å®ç°çˆ¶ç±»å®ä¾‹å±æ€§å’Œæ–¹æ³•çš„ç»§æ‰¿</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Engineer</span> (<span class="params">name</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.name = name</span><br><span class="line">  <span class="keyword">this</span>.skills = [<span class="string">'linux'</span>,<span class="string">'network'</span>,<span class="string">'os'</span>]</span><br><span class="line">&#125;</span><br><span class="line">Engineer.prototype.coding = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;<span class="keyword">this</span>.name&#125;</span> æ­£åœ¨ç¼–ç `</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">FeEngineer</span>(<span class="params">name</span>)</span>&#123;</span><br><span class="line">  Engineer.call(<span class="keyword">this</span>,name)</span><br><span class="line">  <span class="keyword">this</span>.skills.push(<span class="string">'web'</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> engineer = <span class="keyword">new</span> Engineer(<span class="string">"gahing"</span>)</span><br><span class="line">FeEngineer.prototype = engineer</span><br><span class="line">FeEngineer.prototype.croping = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;<span class="keyword">this</span>.name&#125;</span> æ­£åœ¨åˆ‡å›¾`</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·å®ä¾‹åŒ– FeEngineer åï¼Œè¯¥å¯¹è±¡å°±æ‹¥æœ‰äº†çˆ¶ç±»å¯¹è±¡çš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³•äº†</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> fe = <span class="keyword">new</span> FeEngineer(<span class="string">'gahing'</span>)</span><br><span class="line"><span class="built_in">console</span>.log(fe)</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">FeEngineer &#123;</span></span><br><span class="line"><span class="comment">  name: "gahing"</span></span><br><span class="line"><span class="comment">  skills: (4) ["linux", "network", "os", "web"]</span></span><br><span class="line"><span class="comment">  __proto__: Engineer</span></span><br><span class="line"><span class="comment">    croping: Æ’ ()</span></span><br><span class="line"><span class="comment">    name: "gahing"</span></span><br><span class="line"><span class="comment">    skills: (3) ["linux", "network", "os"]</span></span><br><span class="line"><span class="comment">    __proto__: Object</span></span><br><span class="line"><span class="comment">      coding: Æ’ ()</span></span><br><span class="line"><span class="comment">      constructor: Æ’ Engineer(name)</span></span><br><span class="line"><span class="comment">      __proto__: Object</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p>çˆ¶ç±»å®ä¾‹å±æ€§å’Œæ–¹æ³•è¢« fe ç»§æ‰¿äº†ï¼Œä¸”çˆ¶ç±»çš„çš„æ–¹æ³•è¿˜æ˜¯æŒ‚åœ¨çˆ¶ç±»çš„åŸå‹å¯¹è±¡ä¸Š</p>
<p>ä½†æ˜¯ç”±äºçˆ¶ç±»å®ä¾‹ engineer è¢«æŒ‚è½½åˆ° fe çš„åŸå‹å¯¹è±¡ä¸Šï¼Œä¿®æ”¹ fe çš„å±æ€§å’Œæ–¹æ³•å¯èƒ½ä¼šæ”¹åŠ¨åˆ° engineer</p>
<p>åŒæ—¶ï¼Œçˆ¶ç±»æ„é€ å‡½æ•°è¢«è°ƒç”¨äº†ä¸¤æ¬¡ï¼Œfe çš„åŸå‹å¯¹è±¡ engineer å¤šäº†ä¸€äº›ä¸å¿…è¦çš„å®ä¾‹å±æ€§å’Œæ–¹æ³•</p>
<h3 id="å¯„ç”Ÿç»„åˆå¼ç»§æ‰¿"><a href="#å¯„ç”Ÿç»„åˆå¼ç»§æ‰¿" class="headerlink" title="å¯„ç”Ÿç»„åˆå¼ç»§æ‰¿"></a>å¯„ç”Ÿç»„åˆå¼ç»§æ‰¿</h3><p>å…¶å®åªè¦çˆ¶ç±»æ„é€ å‡½æ•° Engineer ä¸­çš„ä¸œè¥¿ä¸è¢«æŒ‚è½½åˆ°å­ç±»å®ä¾‹å¯¹è±¡ fe çš„åŸå‹å¯¹è±¡ä¸Šï¼Œå°±å¯ä»¥å®ç°æˆ‘ä»¬è¦çš„æ•ˆæœ</p>
<p>å†ä¸Šä¸€æ¬¡ es6 æ‰§è¡Œåçš„æ•ˆæœ</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">  name: "gahing",</span></span><br><span class="line"><span class="comment">  skills: ["linux", "network", "os", "web"],</span></span><br><span class="line"><span class="comment">  __proto__: Engineer &#123;</span></span><br><span class="line"><span class="comment">    constructor: class FeEngineer,</span></span><br><span class="line"><span class="comment">    croping: Æ’ croping(),</span></span><br><span class="line"><span class="comment">    __proto__: Object &#123;</span></span><br><span class="line"><span class="comment">      coding: Æ’ coding()</span></span><br><span class="line"><span class="comment">      constructor: class Engineer</span></span><br><span class="line"><span class="comment">      __proto__: Object</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">  &#125;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p>æ€è·¯å°±æ˜¯å°†å­ç±»å®ä¾‹å¯¹è±¡ fe çš„åŸå‹å¯¹è±¡æŒ‡å‘ä¸€ä¸ªç©ºå¯¹è±¡ï¼Œè¯¥ç©ºå¯¹è±¡çš„æ„é€ å‡½æ•°çš„åŸå‹å¯¹è±¡æŒ‡å‘çˆ¶ç±»æ„é€ å‡½æ•° Engineer çš„åŸå‹å¯¹è±¡</p>
<p>ç„¶åè°ƒæ•´ä¸‹ç»„åˆç»§æ‰¿çš„ä»£ç ï¼Œå˜æˆå¦‚ä¸‹</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»º Engineer çš„ä¸€ä¸ªå‰¯æœ¬ï¼ŒåŒºåˆ«åœ¨äºæ²¡æœ‰ä»»ä½•å®ä¾‹å±æ€§</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Temp</span>(<span class="params"></span>)</span>&#123;&#125;</span><br><span class="line">Temp.prototype = Engineer.prototype</span><br><span class="line"><span class="keyword">const</span> temp = <span class="keyword">new</span> Temp() </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Engineer</span> (<span class="params">name</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.name = name</span><br><span class="line">  <span class="keyword">this</span>.skills = [<span class="string">'linux'</span>,<span class="string">'network'</span>,<span class="string">'os'</span>]</span><br><span class="line">&#125;</span><br><span class="line">Engineer.prototype.coding = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;<span class="keyword">this</span>.name&#125;</span> æ­£åœ¨ç¼–ç `</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">FeEngineer</span>(<span class="params">name</span>)</span>&#123;</span><br><span class="line">  Engineer.call(<span class="keyword">this</span>,name)</span><br><span class="line">  <span class="keyword">this</span>.skills.push(<span class="string">'web'</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æŒ‡å‘ temp</span></span><br><span class="line">FeEngineer.prototype = temp</span><br><span class="line">FeEngineer.prototype.croping = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;<span class="keyword">this</span>.name&#125;</span> æ­£åœ¨åˆ‡å›¾`</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å®ä¾‹åŒ– FeEngineer çœ‹ä¸‹æ•ˆæœ</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> fe = <span class="keyword">new</span> FeEngineer(<span class="string">'gahing'</span>)</span><br><span class="line">fe.__proto__.constructor === FeEngineer <span class="comment">// false</span></span><br><span class="line"><span class="built_in">console</span>.log(fe)</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">FeEngineer &#123;</span></span><br><span class="line"><span class="comment">  name: "gahing"</span></span><br><span class="line"><span class="comment">  skills: (4) ["linux", "network", "os", "web"]</span></span><br><span class="line"><span class="comment">  __proto__: Engineer &#123;</span></span><br><span class="line"><span class="comment">    croping: Æ’ ()</span></span><br><span class="line"><span class="comment">    __proto__: &#123;</span></span><br><span class="line"><span class="comment">      coding: Æ’ ()</span></span><br><span class="line"><span class="comment">      constructor: Æ’ Engineer(name)</span></span><br><span class="line"><span class="comment">      __proto__: Object</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">  &#125;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p>ç”±äºå®ä¾‹åŒ– Temp æ—¶ä¸ä¼šäº§ç”Ÿå¤šä½™çš„å±æ€§å’Œæ–¹æ³•ï¼Œå› æ­¤è¿™ç§åšæ³•åŸºæœ¬èƒ½è¾¾åˆ°æ•ˆæœ</p>
<p>å‰©ä¸‹çš„å°±æ˜¯ä¸€äº›æ„é€ å™¨æ–¹æ³•çš„è°ƒæ•´</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// fe çš„åŸå‹å¯¹è±¡çš„æ„é€ å™¨æ–¹æ³•åº”è¯¥æŒ‡å‘ FeEngineer ï¼Œå¹¶ä¸”æ˜¯ä¸å¯ä¿®æ”¹çš„</span></span><br><span class="line"><span class="built_in">Object</span>.defineProperty(temp,<span class="string">'constructor'</span>,&#123;</span><br><span class="line">  enumerable: <span class="literal">false</span>,</span><br><span class="line">  value: FeEngineer</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>ç»¼åˆä¸€ä¸‹ï¼Œå¾—åˆ°å¦‚ä¸‹çš„å¯„ç”Ÿç»„åˆå¼ç»§æ‰¿çš„ä»£ç </p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Temp</span>(<span class="params"></span>)</span>&#123;&#125;</span><br><span class="line">Temp.prototype = Engineer.prototype</span><br><span class="line"><span class="keyword">const</span> temp = <span class="keyword">new</span> Temp() </span><br><span class="line"><span class="built_in">Object</span>.defineProperty(temp,<span class="string">'constructor'</span>,&#123;</span><br><span class="line">  enumerable: <span class="literal">false</span>,</span><br><span class="line">  value: FeEngineer</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Engineer</span> (<span class="params">name</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.name = name</span><br><span class="line">  <span class="keyword">this</span>.skills = [<span class="string">'linux'</span>,<span class="string">'network'</span>,<span class="string">'os'</span>]</span><br><span class="line">&#125;</span><br><span class="line">Engineer.prototype.coding = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;<span class="keyword">this</span>.name&#125;</span> æ­£åœ¨ç¼–ç `</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">FeEngineer</span>(<span class="params">name</span>)</span>&#123;</span><br><span class="line">  Engineer.call(<span class="keyword">this</span>,name)</span><br><span class="line">  <span class="keyword">this</span>.skills.push(<span class="string">'web'</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æŒ‡å‘ temp</span></span><br><span class="line">FeEngineer.prototype = temp</span><br><span class="line">FeEngineer.prototype.croping = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;<span class="keyword">this</span>.name&#125;</span> æ­£åœ¨åˆ‡å›¾`</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å†çœ‹ä¸‹æ•ˆæœ</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> fe = <span class="keyword">new</span> FeEngineer(<span class="string">'gahing'</span>)</span><br><span class="line">fe.__proto__.constructor === FeEngineer <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(fe)</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">FeEngineer </span></span><br><span class="line"><span class="comment">  name: "gahing"</span></span><br><span class="line"><span class="comment">  skills: (4) ["linux", "network", "os", "web"]</span></span><br><span class="line"><span class="comment">  __proto__: Engineer</span></span><br><span class="line"><span class="comment">    croping: Æ’ ()</span></span><br><span class="line"><span class="comment">    constructor: Æ’ FeEngineer(name)</span></span><br><span class="line"><span class="comment">    __proto__:</span></span><br><span class="line"><span class="comment">      coding: Æ’ ()</span></span><br><span class="line"><span class="comment">      constructor: Æ’ Engineer(name)</span></span><br><span class="line"><span class="comment">      __proto__: Object</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p>æœ€åï¼Œæˆ‘ä»¬å¸Œæœ›æŠŠ Temp ç›¸å…³çš„ä»£ç åšä¸ªå°è£…,å®ç° SubClass å’Œ SuperClass ä¹‹é—´çš„å¯„ç”Ÿç»„åˆå¼ç»§æ‰¿</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createTemp</span>(<span class="params">SuperClass</span>)</span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">Temp</span>(<span class="params"></span>)</span>&#123;&#125;</span><br><span class="line">  Temp.prototype = SuperClass.prototype</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> Temp() </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createTemp2</span>(<span class="params">SuperClass</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">let</span> obj = &#123;&#125;</span><br><span class="line">  obj.__proto__ = SuperClass.prototype</span><br><span class="line">  <span class="keyword">return</span> obj</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">inheritPrototype</span> (<span class="params">SubClass, SuperClass</span>)</span>&#123;</span><br><span class="line">  <span class="comment">// ä¹Ÿå¯ä»¥ç›´æ¥ç”¨ Object.create(SuperClass.prototype)</span></span><br><span class="line">  <span class="comment">// å³ SuperClass.prototype æŒ‡å‘åˆ›å»º temp çš„æ„é€ å‡½æ•°çš„åŸå‹å¯¹è±¡</span></span><br><span class="line">  <span class="comment">// temp.__proto__ === SuperClass.prototype</span></span><br><span class="line">  <span class="comment">// è¿™é‡Œä¹Ÿå¯ä»¥é‡‡ç”¨ createTemp2</span></span><br><span class="line">  <span class="keyword">const</span> temp = createTemp(SuperClass)</span><br><span class="line">  <span class="built_in">Object</span>.defineProperty(temp,<span class="string">'constructor'</span>,&#123;</span><br><span class="line">    enumerable: <span class="literal">false</span>,</span><br><span class="line">    value: SubClass</span><br><span class="line">  &#125;)</span><br><span class="line">  SubClass.prototype = temp</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥ä¸Šé¢çš„ä»£ç åˆå¯ä»¥å†™æˆ</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Engineer</span> (<span class="params">name</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.name = name</span><br><span class="line">  <span class="keyword">this</span>.skills = [<span class="string">'linux'</span>,<span class="string">'network'</span>,<span class="string">'os'</span>]</span><br><span class="line">&#125;</span><br><span class="line">Engineer.prototype.coding = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;<span class="keyword">this</span>.name&#125;</span> æ­£åœ¨ç¼–ç `</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">FeEngineer</span>(<span class="params">name</span>)</span>&#123;</span><br><span class="line">  Engineer.call(<span class="keyword">this</span>,name)</span><br><span class="line">  <span class="keyword">this</span>.skills.push(<span class="string">'web'</span>)</span><br><span class="line">&#125;</span><br><span class="line">inheritPrototype(FeEngineer,Engineer)</span><br><span class="line">FeEngineer.prototype.croping = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;<span class="keyword">this</span>.name&#125;</span> æ­£åœ¨åˆ‡å›¾`</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ol>
<li><a href="https://segmentfault.com/a/1190000015565616" target="_blank" rel="noopener">ES6 Class ç»§æ‰¿ä¸ super</a></li>
<li><a href="https://chuchencheng.com/2019/05/27/%E5%9B%9E%E5%BF%86%E6%9D%80%EF%BC%9AJavaScript%E7%9A%84%E7%BB%A7%E6%89%BF/" target="_blank" rel="noopener">å›å¿†æ€ï¼šJavaScriptçš„ç»§æ‰¿</a></li>
</ol>
]]></content>
      <categories>
        <category>å¤§å‰ç«¯</category>
      </categories>
      <tags>
        <tag>ECMAScript</tag>
      </tags>
  </entry>
  <entry>
    <title>æµè§ˆå™¨ç¼“å­˜</title>
    <url>/2019/12/29/Web%E6%8A%80%E6%9C%AF/%E6%B5%8F%E8%A7%88%E5%99%A8%E7%BC%93%E5%AD%98/</url>
    <content><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>Web ç¼“å­˜åˆ†ä¸ºæµè§ˆå™¨ç¼“å­˜å’ŒæœåŠ¡ç«¯ç¼“å­˜ï¼Œæœ¬æ–‡ä¸»è¦æè¿°çš„æ˜¯æµè§ˆå™¨ç¼“å­˜ä¸­çš„ HTTP ç¼“å­˜</p>
<a id="more"></a>

<h1 id="æŸ¥çœ‹ç¼“å­˜æ–‡ä»¶"><a href="#æŸ¥çœ‹ç¼“å­˜æ–‡ä»¶" class="headerlink" title="æŸ¥çœ‹ç¼“å­˜æ–‡ä»¶"></a>æŸ¥çœ‹ç¼“å­˜æ–‡ä»¶</h1><p>chrome å¯ä»¥é€šè¿‡ <code>chrome://view-http-cache</code> æŸ¥çœ‹æµè§ˆå™¨çš„ç¼“å­˜æ–‡ä»¶</p>
<blockquote>
<p>chrome 66 åå°±ç”¨ä¸äº†äº†</p>
</blockquote>
<p>pc ä¸Šçš„å®é™…å­˜å‚¨ä½ç½®</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">\User\&#123;user&#125;\AppData\Local\google\Chrome\User Data\Default\Cache\index çš„æ–‡ä»¶å†…å®¹</span><br></pre></td></tr></table></figure>

<p>ç«ç‹å¯ä»¥é€šè¿‡ <code>about:cache</code> æŸ¥çœ‹ç¼“å­˜æ–‡ä»¶åˆ—è¡¨</p>
<p>è¿›å…¥ç¼“å­˜æ–‡ä»¶è¯¦æƒ…é¡µï¼Œå¯ä»¥çœ‹åˆ°ç¼“å­˜æ–‡ä»¶å†…å®¹ç”±ä¸‰éƒ¨åˆ†ç»„æˆ</p>
<ul>
<li>èµ„æºè¯·æ±‚åœ°å€</li>
<li>å“åº”å¤´</li>
<li>åŸæ–‡ä»¶çš„äºŒè¿›åˆ¶å†…å®¹</li>
</ul>
<p>è€Œå®é™…çš„ç¼“å­˜æ–‡ä»¶ä¹Ÿæ˜¯åŒ…å«è¿™äº›éƒ¨åˆ†çš„ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ ChromeCacheView å·¥å…·æŸ¥çœ‹å†…éƒ¨å†…å®¹</p>
<p>é€šè¿‡ä¸‹é¢å‡ ä¸ªé—®é¢˜æ¥å­¦ä¹  pc ä¸Šæµè§ˆå™¨ç¼“å­˜å¦‚ä½•è®¾è®¡çš„</p>
<ul>
<li><p>æ˜¯ä¸æ˜¯åº”è¯¥æœ‰ä¸€ä¸ªåˆ—è¡¨æ–‡ä»¶è®°å½•æ‰€æœ‰ç¼“å­˜æ–‡ä»¶çš„åŸºæœ¬ä¿¡æ¯ï¼Ÿ</p>
</li>
<li><p>ä¸èƒ½ç›´æ¥æ‹¿åˆ°ç¼“å­˜æºæ–‡ä»¶ï¼Œæ¯æ¬¡å‘½ä¸­ç¼“å­˜éƒ½éœ€è¦è§£ç æ–‡ä»¶ï¼Ÿ</p>
</li>
<li><p>ä»å¦‚æœåˆ äº†ç¼“å­˜æ–‡ä»¶ï¼Œæ˜¯åˆ äº†ä»€ä¹ˆä¸œè¥¿ï¼Ÿåˆ—è¡¨æ–‡ä»¶å†…å®¹ä¼šç›¸åº”çš„ä¿®æ”¹ä¸ï¼Ÿ</p>
</li>
<li><p>ä¸ä¼šå‡ºç°åˆ—è¡¨æ–‡ä»¶å†…å®¹è¿˜åœ¨ä½†æ˜¯å¯¹åº”ç¼“å­˜åŸæ–‡ä»¶è¢«åˆ é™¤çš„æƒ…å†µï¼Ÿ</p>
</li>
</ul>
<p>TODO</p>
<h1 id="å¼ºç¼“å­˜"><a href="#å¼ºç¼“å­˜" class="headerlink" title="å¼ºç¼“å­˜"></a>å¼ºç¼“å­˜</h1><h2 id="Cache-Control-å“åº”å¤´"><a href="#Cache-Control-å“åº”å¤´" class="headerlink" title="Cache-Control å“åº”å¤´"></a>Cache-Control å“åº”å¤´</h2><p>ä¼˜å…ˆçº§æ¯” <code>Expires</code> é«˜ï¼Œä¸”ç”¨çš„æ˜¯ç›¸å¯¹æ—¶é—´ï¼Œä¸éœ€è¦æ‹…å¿ƒå®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯æ—¶é—´ä¸ä¸€è‡´å¸¦æ¥çš„ç¼“å­˜å¤±æ•ˆé—®é¢˜</p>
<h3 id="max-age"><a href="#max-age" class="headerlink" title="max-age"></a>max-age</h3><p>æŒ‡å®šç¼“å­˜çš„æœ‰æ•ˆæœŸ</p>
<h3 id="s-maxage"><a href="#s-maxage" class="headerlink" title="s-maxage"></a>s-maxage</h3><p>æŒ‡å®šä»£ç†ç¼“å­˜ï¼ˆå¦‚cdnç¼“å­˜ï¼‰çš„æœ‰æ•ˆæœŸï¼Œä¼˜å…ˆçº§æ¯” max-age é«˜</p>
<h3 id="no-cache"><a href="#no-cache" class="headerlink" title="no-cache"></a>no-cache</h3><p>ä¸ä½¿ç”¨æœ¬åœ°ç¼“å­˜å’Œä»£ç†ç¼“å­˜</p>
<h3 id="no-store"><a href="#no-store" class="headerlink" title="no-store"></a>no-store</h3><p>ç¦ç”¨ç¼“å­˜</p>
<h3 id="public"><a href="#public" class="headerlink" title="public"></a>public</h3><p>å¯ä»¥è¢«æ‰€æœ‰ç”¨æˆ·ç¼“å­˜ï¼ŒåŒ…æ‹¬ç»ˆç«¯ç”¨æˆ·ä»¥åŠ CDN ç­‰ä¸­é—´ä»£ç†æœåŠ¡å™¨</p>
<p>é»˜è®¤å€¼</p>
<h3 id="private"><a href="#private" class="headerlink" title="private"></a>private</h3><p>ä»…èƒ½è¢«ç»ˆç«¯ç”¨æˆ·ç¼“å­˜</p>
<h2 id="Expires-å“åº”å¤´"><a href="#Expires-å“åº”å¤´" class="headerlink" title="Expires å“åº”å¤´"></a>Expires å“åº”å¤´</h2><p>è¡¨ç¤ºèµ„æºè¿‡æœŸæ—¶é—´ï¼Œä»¥æœåŠ¡ç«¯æ—¶é—´ä¸ºå‡†</p>
<h1 id="åå•†ç¼“å­˜"><a href="#åå•†ç¼“å­˜" class="headerlink" title="åå•†ç¼“å­˜"></a>åå•†ç¼“å­˜</h1><h2 id="Last-modified-å“åº”å¤´"><a href="#Last-modified-å“åº”å¤´" class="headerlink" title="Last-modified å“åº”å¤´"></a>Last-modified å“åº”å¤´</h2><p>è¡¨ç¤ºæœåŠ¡ç«¯æ–‡ä»¶çš„æœ€åä¿®æ”¹æ—¶é—´</p>
<p>å½“ç¼“å­˜è¿‡æœŸæ—¶ï¼Œå†æ¬¡å‘èµ·è¯·æ±‚ï¼Œä¼šå¸¦ä¸ª <code>If-Modified-Since</code> è¯·æ±‚å¤´ï¼Œå…¶å€¼ä¸ºä¹‹å‰è¿”å›çš„ <code>Last-modified</code> å“åº”å¤´çš„å€¼</p>
<p>æœåŠ¡ç«¯ä¼šå»æŸ¥è¯¢åœ¨è¯¥æ—¶é—´ç‚¹åæ–‡ä»¶æ˜¯å¦è¢«ä¿®æ”¹ï¼Œè‹¥è¢«ä¿®æ”¹ï¼Œè¿”å›æ–°çš„èµ„æº, 200 å“åº”ä»¥åŠ <code>Last-modified</code> çš„æ–°å€¼ï¼›å¦åˆ™è¿”å› 304 å“åº”ï¼Œæ ¹æ® Cache-Control æˆ– Expires é‡æ–°è®¾ç½®è¿‡æœŸæ—¶é—´</p>
<h2 id="ETag-å“åº”å¤´"><a href="#ETag-å“åº”å¤´" class="headerlink" title="ETag å“åº”å¤´"></a>ETag å“åº”å¤´</h2><p>ç”±äº <code>Last-modified</code> åªç²¾ç¡®åˆ°ç§’ï¼Œä¸”å¦‚æœå†…å®¹æ²¡å˜ä½†æ˜¯æœ€åä¿®æ”¹æ—¶é—´å˜äº†ï¼Œè¿˜æ˜¯ä¼šå½“æ–°èµ„æºè¯·æ±‚</p>
<p>äºæ˜¯ http1.1 åŠ äº†ä¸€ä¸ª <code>ETag</code> å“åº”å¤´</p>
<p>å…¶å€¼ä¸ºæ ¹æ®æ–‡ä»¶å†…å®¹ç”Ÿæˆçš„ hash</p>
<p>å½“ç¼“å­˜è¿‡æœŸæ—¶ï¼Œå†æ¬¡å‘èµ·è¯·æ±‚ï¼Œä¼šå¸¦ä¸Š <code>If-None-Match</code> è¯·æ±‚å¤´ï¼Œå…¶å€¼ä¸ºä¹‹å‰è¿”å›çš„ <code>ETag</code> å“åº”å¤´çš„å€¼</p>
<p>æœåŠ¡å™¨ä¼šå»è¯¥å€¼å’ŒæœåŠ¡å™¨æ–‡ä»¶çš„ hash è¿›è¡Œæ¯”å¯¹ï¼Œè‹¥ä¸åŒï¼Œè¿”å›æ–°çš„èµ„æºå’Œ 200 å“åº”ä»¥åŠ <code>ETag</code> çš„æ–°å€¼ï¼›å¦åˆ™è¿”å› 304 å“åº”ï¼Œæ ¹æ® Cache-Control æˆ– Expires é‡æ–°è®¾ç½®è¿‡æœŸæ—¶é—´</p>
<p><strong>ä¼˜å…ˆçº§æ¯” <code>Last-modified</code> é«˜</strong></p>
<p>å½“ä¸¤ä¸ªåŒæ—¶å­˜åœ¨æ—¶ï¼Œå…ˆåˆ¤æ–­ ETag ï¼Œå¦‚æœ hash å€¼æ²¡æœ‰å˜åŒ–ï¼Œå†å»åˆ¤æ–­ <code>Last-modified</code> ï¼Œæœ€ç»ˆå†³å®šæ˜¯å¦è¿”å› 304</p>
<h1 id="æ€»æµç¨‹"><a href="#æ€»æµç¨‹" class="headerlink" title="æ€»æµç¨‹"></a>æ€»æµç¨‹</h1><p>å€Ÿç”¨ [æµ…è°ˆ Web ç¼“å­˜] ä¸­çš„å›¾</p>
<p><img src="http://www.alloyteam.com/wp-content/uploads/2016/03/%E5%9B%BE%E7%89%8761.png" alt="alloyteam"></p>
<h1 id="ç”¨æˆ·è¡Œä¸º"><a href="#ç”¨æˆ·è¡Œä¸º" class="headerlink" title="ç”¨æˆ·è¡Œä¸º"></a>ç”¨æˆ·è¡Œä¸º</h1><table>
<thead>
<tr>
<th>ç”¨æˆ·æ“ä½œ</th>
<th>å¼ºç¼“å­˜</th>
<th>åå•†ç¼“å­˜</th>
</tr>
</thead>
<tbody><tr>
<td>å‰è¿›åé€€</td>
<td>æœ‰æ•ˆ</td>
<td>æœ‰æ•ˆ</td>
</tr>
<tr>
<td>åœ°å€æ å›è½¦</td>
<td>?</td>
<td>æœ‰æ•ˆ</td>
</tr>
<tr>
<td>æŒ‰åˆ·æ–°æŒ‰é’®</td>
<td>æ— æ•ˆ</td>
<td>æœ‰æ•ˆ</td>
</tr>
<tr>
<td>F5</td>
<td>æ— æ•ˆ</td>
<td>æœ‰æ•ˆ</td>
</tr>
<tr>
<td>ctrl + F5</td>
<td>æ— æ•ˆ</td>
<td>æ— æ•ˆ</td>
</tr>
<tr>
<td>Disable cache</td>
<td>æ— æ•ˆ</td>
<td>æ— æ•ˆ</td>
</tr>
</tbody></table>
<p>å‰å››ç§é’ˆå¯¹çš„æ˜¯æ–‡æ¡£è¯·æ±‚ï¼Œåä¸¤è€…é’ˆå¯¹çš„æ˜¯æ‰€æœ‰èµ„æºçš„è¯·æ±‚</p>
<p>å¼ºç¼“å­˜å¤±æ•ˆçš„åŸå› åœ¨äºæµè§ˆå™¨ä¼šåœ¨è¯·æ±‚ä¸­å¸¦ä¸Š<code>cache-control: max-age=0</code></p>
<p>åå•†ç¼“å­˜å¤±æ•ˆçš„åŸå› åœ¨äºæœ¬è¯¥å¸¦ä¸Š <code>If-Modified-Since</code> æˆ– <code>If-None-Match</code> è¯·æ±‚å¤´ï¼Œä½†æ˜¯æµè§ˆå™¨æ²¡æœ‰å¸¦ä¸Šï¼Œå¹¶å¸¦ä¸Šä»¥ä¸‹ä¸¤ä¸ªè¯·æ±‚å¤´é¿å…å¼ºç¼“å­˜ï¼Œå› æ­¤ä¼šé‡æ–°åŠ è½½èµ„æº</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Cache-Control: no-cache</span><br><span class="line">Pragma: no-cache</span><br></pre></td></tr></table></figure>

<p>å‰è¿›åé€€æ˜¯æµè§ˆå™¨ç›´æ¥æ‹¿ç¼“å­˜é¡µé¢ï¼Œå³ä½¿å¼ºç¼“å­˜å·²ç»è¿‡æœŸï¼Œæ‰€ä»¥å³ä½¿æ–­ç½‘äº†ï¼Œåé€€è¿˜æ˜¯èƒ½è®¿é—®åŸæ¥é¡µé¢æ–‡æ¡£ï¼Œå‚è€ƒè‡ªï¼š<a href="https://www.w3.org/Protocols/rfc2616/rfc2616-sec13.html#sec13.13" target="_blank" rel="noopener">https://www.w3.org/Protocols/rfc2616/rfc2616-sec13.html#sec13.13</a></p>
<blockquote>
<p>ä¼šå‘ç°æ­¤æ—¶ç½‘ç»œè¯·æ±‚å¤´æ˜¾ç¤º Provisional headers are shown</p>
</blockquote>
<p>åœ°å€æ å›è½¦ä¹‹æ‰€ä»¥ä¸å›ºå®šï¼Œåœ¨äºå½“å‰æ–‡æ¡£é“¾æ¥ä¸è¦å›è½¦çš„é“¾æ¥æ˜¯å¦ç›¸åŒã€‚å¦‚æœç›¸åŒï¼Œæµè§ˆå™¨ä¼šè®¤ä¸ºè¿™æ˜¯æ‰“ç®— f5 åˆ·æ–°ï¼Œå¼ºç¼“å­˜æ— æ•ˆï¼Œå¦åˆ™å¼ºç¼“å­˜æœ‰æ•ˆ</p>
<p>æœ€åä¸¤ç§çš„åŒºåˆ«åœ¨äºï¼Œå‰è€…ä¼šèµ°å†…å­˜ç¼“å­˜ï¼ˆç›¸åŒè¯·æ±‚å‘½ä¸­å†…å­˜ç¼“å­˜ï¼Œä¸ä¼šå†å‘ä¸€æ¡è¯·æ±‚ï¼‰ï¼Œåè€…ä»€ä¹ˆç¼“å­˜éƒ½ä¸èµ°ï¼›</p>
<blockquote>
<p>æ”¾å…¥å†…å­˜ç¼“å­˜çš„æ˜¯é¡µé¢æ‰«æåŠ è½½çš„ï¼Œè„šæ­¥å¼‚æ­¥è¯·æ±‚çš„ä¸æ”¾å†…å­˜ä¸­ï¼ˆæ²¡åšå®Œæ•´çš„æµ‹è¯•ï¼Œä¸ç¡®å®šï¼‰</p>
</blockquote>
<h1 id="å¸¸è§é—®é¢˜"><a href="#å¸¸è§é—®é¢˜" class="headerlink" title="å¸¸è§é—®é¢˜"></a>å¸¸è§é—®é¢˜</h1><h2 id="è¯·æ±‚å¤´å‡ºç°-Provisional-headers-are-shown-çš„åŸå› "><a href="#è¯·æ±‚å¤´å‡ºç°-Provisional-headers-are-shown-çš„åŸå› " class="headerlink" title="è¯·æ±‚å¤´å‡ºç° Provisional headers are shown çš„åŸå› "></a>è¯·æ±‚å¤´å‡ºç° Provisional headers are shown çš„åŸå› </h2><ol>
<li>æ’ä»¶æ‹¦æˆª</li>
<li>å‘½ä¸­æœ¬åœ°ç¼“å­˜</li>
<li>æœåŠ¡å™¨è¶…æ—¶</li>
<li><strong>è·¨åŸŸæ‹¦æˆª</strong>ï¼Œæœ€ç»å¸¸å‡ºç°çš„æƒ…å†µï¼ŒéåŒæºçš„èµ„æºè¯·æ±‚éƒ½ä¼šæ˜¾ç¤ºè¿™ä¸ª</li>
</ol>
<h2 id="å“åº”å¤´æœªè®¾ç½®-cache-control-å’Œ-expires-è¿˜ä¼šå‘½ä¸­å¼ºç¼“å­˜ä¹ˆï¼Ÿ"><a href="#å“åº”å¤´æœªè®¾ç½®-cache-control-å’Œ-expires-è¿˜ä¼šå‘½ä¸­å¼ºç¼“å­˜ä¹ˆï¼Ÿ" class="headerlink" title="å“åº”å¤´æœªè®¾ç½® cache-control å’Œ expires è¿˜ä¼šå‘½ä¸­å¼ºç¼“å­˜ä¹ˆï¼Ÿ"></a>å“åº”å¤´æœªè®¾ç½® cache-control å’Œ expires è¿˜ä¼šå‘½ä¸­å¼ºç¼“å­˜ä¹ˆï¼Ÿ</h2><p>å¯¹äºå‰è¿›åé€€çš„åœºæ™¯æ¥è¯´ï¼Œæœ‰æ²¡æœ‰è¿™äº›å“åº”å¤´ï¼Œéƒ½ä¼šå‘½ä¸­å¼ºç¼“å­˜</p>
<p>å…¶ä»–åœºæ™¯åˆ™ä¸ä¼šå‘½ä¸­</p>
<h2 id="å¦‚ä½•è®¾ç½®æ‰èƒ½ä¸ç¼“å­˜èµ„æº"><a href="#å¦‚ä½•è®¾ç½®æ‰èƒ½ä¸ç¼“å­˜èµ„æº" class="headerlink" title="å¦‚ä½•è®¾ç½®æ‰èƒ½ä¸ç¼“å­˜èµ„æº"></a>å¦‚ä½•è®¾ç½®æ‰èƒ½ä¸ç¼“å­˜èµ„æº</h2><h2 id="é€šè¿‡-Expires-åˆ¤æ–­ç¼“å­˜è¿‡æœŸï¼Œè€Œæœ¬åœ°æ—¶é—´æ¯”æœåŠ¡å™¨æ—¶é—´å¿«çš„è¯ï¼Œä¼šå‡ºç°ä»€ä¹ˆé—®é¢˜ï¼Ÿ"><a href="#é€šè¿‡-Expires-åˆ¤æ–­ç¼“å­˜è¿‡æœŸï¼Œè€Œæœ¬åœ°æ—¶é—´æ¯”æœåŠ¡å™¨æ—¶é—´å¿«çš„è¯ï¼Œä¼šå‡ºç°ä»€ä¹ˆé—®é¢˜ï¼Ÿ" class="headerlink" title="é€šè¿‡ Expires åˆ¤æ–­ç¼“å­˜è¿‡æœŸï¼Œè€Œæœ¬åœ°æ—¶é—´æ¯”æœåŠ¡å™¨æ—¶é—´å¿«çš„è¯ï¼Œä¼šå‡ºç°ä»€ä¹ˆé—®é¢˜ï¼Ÿ"></a>é€šè¿‡ Expires åˆ¤æ–­ç¼“å­˜è¿‡æœŸï¼Œè€Œæœ¬åœ°æ—¶é—´æ¯”æœåŠ¡å™¨æ—¶é—´å¿«çš„è¯ï¼Œä¼šå‡ºç°ä»€ä¹ˆé—®é¢˜ï¼Ÿ</h2><p>å¦‚æœé€šè¿‡ Expires åˆ¤æ–­ç¼“å­˜è¿‡æœŸï¼Œè€Œæœ¬åœ°æ—¶é—´åˆæ¯”æœåŠ¡ç«¯å¿«èµ„æºæœ‰æ•ˆæœŸä»¥ä¸Šï¼Œå°±ä¼šå‡ºç°å§‹ç»ˆä¸èƒ½å‘½ä¸­å¼ºç¼“å­˜çš„æƒ…å†µ</p>
<h1 id="æµè§ˆå™¨ç¼“å­˜ä¸­çš„å…¶ä»–ç¼“å­˜"><a href="#æµè§ˆå™¨ç¼“å­˜ä¸­çš„å…¶ä»–ç¼“å­˜" class="headerlink" title="æµè§ˆå™¨ç¼“å­˜ä¸­çš„å…¶ä»–ç¼“å­˜"></a>æµè§ˆå™¨ç¼“å­˜ä¸­çš„å…¶ä»–ç¼“å­˜</h1><p>è¯»å–æŸä¸ª url çš„èµ„æºï¼ŒæŒ‰ç…§ä¸‹é¢çš„è¿‡ç¨‹ </p>
<p>ï¼ˆéœ€è¦åšä¸ªè¯•éªŒï¼‰</p>
<p>å†…å­˜ç¼“å­˜</p>
<blockquote>
<p>preload é¢„åŠ è½½çš„èµ„æºä¼šå­˜å‚¨åœ¨æ­¤å¤„<br>å½“å‰é¡µé¢å·²ç»åŠ è½½è¿‡çš„èµ„æºä¼šæ”¾åœ¨å†…å­˜ä¸­ï¼Œæ–¹ä¾¿è¯»å–<br>ä½†æ³¨æ„ä¸€ç‚¹ï¼Œå¦‚æœèµ„æºè®¾ç½®äº† no-store ï¼Œå‰é¢å³ä½¿åŠ è½½è¿‡è¿™ä¸ªèµ„æºï¼Œè¿˜æ˜¯ä¼šç»§ç»­åŠ è½½ï¼ˆå¾…ç¡®å®šï¼‰</p>
</blockquote>
<p>Service Worker ç¼“å­˜</p>
<blockquote>
<p>æœ‰ä¸€å¥—è‡ªå·±çš„ç¼“å­˜APIï¼Œæ›´åŠ å¯æ§ï¼Œä¸å—æµè§ˆå™¨å½±å“</p>
</blockquote>
<p>HTTP ç¼“å­˜</p>
<blockquote>
<p>ä¸Šæ–‡æåˆ°çš„é‚£ä¸ªï¼Œæ ¹æ®è¯·æ±‚å“åº”ç­‰å¤´éƒ¨ä¿¡æ¯ç¡®å®šæ˜¯å¦èµ°ç¼“å­˜</p>
</blockquote>
<p>HTTP2 Push ç¼“å­˜</p>
<blockquote>
<p>æœ‰ä¸€å®šçš„æ—¶æ•ˆï¼Œchromium ä¸­æ˜¯äº”åˆ†é’Ÿ<br>åœ¨å‘½ä¸­ç¼“å­˜åï¼Œå¯èƒ½ä¼šåœ¨ HTTP ç¼“å­˜ä¸­å¢åŠ æ‹·è´ä»¥åŠå†…å­˜ç¼“å­˜å¢åŠ å¼•ç”¨</p>
</blockquote>
<h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><ol>
<li><a href="http://www.alloyteam.com/2016/03/discussion-on-web-caching/" target="_blank" rel="noopener">æµ…è°ˆ Web ç¼“å­˜</a></li>
<li><a href="https://www.cnblogs.com/wonyun/p/5524617.html" target="_blank" rel="noopener">httpåå•†ç¼“å­˜VSå¼ºç¼“å­˜</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Cache-Control" target="_blank" rel="noopener">Cache-Control</a></li>
<li><a href="https://juejin.im/post/5aa5ddd4f265da23906ba592" target="_blank" rel="noopener">ã€è¯‘ã€‘å…³äºå››ç§ç¼“å­˜çš„æ•…äº‹</a></li>
</ol>
]]></content>
      <categories>
        <category>å¤§å‰ç«¯</category>
      </categories>
      <tags>
        <tag>ç¼“å­˜</tag>
      </tags>
  </entry>
  <entry>
    <title>ä»è¾“å…¥urlåæµè§ˆå™¨å‘ç”Ÿäº†ä»€ä¹ˆ</title>
    <url>/2019/12/14/2019Q4/HTML%E6%96%87%E6%A1%A3%E7%9A%84%E5%8A%A0%E8%BD%BD%E8%BF%87%E7%A8%8B/</url>
    <content><![CDATA[<h2 id="é¢è¯•ç­”é¢˜æ¨¡æ¿"><a href="#é¢è¯•ç­”é¢˜æ¨¡æ¿" class="headerlink" title="é¢è¯•ç­”é¢˜æ¨¡æ¿"></a>é¢è¯•ç­”é¢˜æ¨¡æ¿</h2><p>è¿™é‡Œä»¥ chrome ä¸ºä¾‹ï¼Œåœ¨è¿›ç¨‹çº¿ç¨‹æ–¹é¢çš„æè¿°ä¸ä¸€å®šæ˜¯å‡†ç¡®çš„ï¼ˆæ¯•ç«Ÿæ²¡æœ‰çœ‹è¿‡æºç ï¼‰</p>
<p>é¦–å…ˆåˆ†ä¸ºæµè§ˆå™¨è¿›ç¨‹å’Œæ¸²æŸ“è¿›ç¨‹</p>
<p>æµè§ˆå™¨uiæ§ä»¶ï¼Œç½‘ç»œä»¥åŠå­˜å‚¨ç­‰äº¤ç»™æµè§ˆå™¨è¿›ç¨‹å»åš</p>
<p>ä»£ç æ‰§è¡Œï¼Œé¡µé¢æ¸²æŸ“éƒ½æ˜¯é€šè¿‡æ¸²æŸ“è¿›ç¨‹å»åš</p>
<a id="more"></a>

<p>æµè§ˆå™¨è¿›ç¨‹çš„uiçº¿ç¨‹å¤„ç†ç”¨æˆ·è¾“å…¥ï¼Œå¯èƒ½ä¼šè°ƒç”¨ç½‘ç»œçº¿ç¨‹å»æå‰åš dns è§£æã€‚</p>
<p>æŒ‰å›è½¦åï¼Œå…ˆé€šè¿‡å­˜å‚¨çº¿ç¨‹å»æŸ¥æœ‰æ²¡æœ‰ç¼“å­˜ï¼Œæˆ–è€…æ˜¯ä¸æ˜¯ 301 é‡å®šå‘ï¼Œä¹‹åç½‘ç»œçº¿ç¨‹å‘èµ· url è¯·æ±‚</p>
<p>è¿™ä¸ªè¿‡ç¨‹æ¶‰åŠ dns è§£æï¼Œtcpå»ºè”ï¼Œhttpè¯·æ±‚å‘èµ·ï¼Œhttps çš„è¯å…ˆè¿›è¡Œ tlså»ºè”</p>
<p>å“åº”è¿”å›çš„æ—¶å€™ï¼Œå…ˆè§£æå“åº”å¤´ï¼Œå¦‚æœæ˜¯é‡å®šå‘åˆ™é‡æ–°å‘èµ·è¯·æ±‚ï¼Œç»§ç»­å‰é¢çš„è¿‡ç¨‹</p>
<p>ç„¶åå¤„ç†å“åº”æ•°æ®ï¼Œé€šè¿‡ content-type åˆ¤æ–­èµ„æºç±»å‹ï¼Œä¸åŒèµ„æºæœ‰ä¸åŒå¤„ç†ï¼Œè¿™é‡Œä»¥ html ä¸ºä¾‹</p>
<p>æ­¤æ—¶å¯åŠ¨ä¸€ä¸ªæ–°çš„æ¸²æŸ“è¿›ç¨‹ï¼Œæµè§ˆå™¨è¿›ç¨‹å°†å“åº”å†…å®¹å‘å¾€æ¸²æŸ“è¿›ç¨‹ï¼Œç›´åˆ°æ¸²æŸ“è¿›ç¨‹è¿”å›æ¸²æŸ“ç¡®è®¤çš„æ¶ˆæ¯ï¼Œå¯¼èˆªè¿‡ç¨‹ç»“æŸï¼Œæ­¤æ—¶ä¼šè°ƒç”¨uiçº¿ç¨‹å»æ›´æ–°å¯¼èˆªæ çŠ¶æ€<br>ï¼ˆä¸ä¸€å®šå¯åŠ¨æ–°çš„æ¸²æŸ“è¿›ç¨‹ï¼Œæœ‰ä¸ªä»€ä¹ˆæµè§ˆä¸Šä¸‹æ–‡æ¦‚å¿µï¼Œå¯èƒ½å¤ç”¨ï¼‰</p>
<p>æ¸²æŸ“è¿›ç¨‹å†…éƒ¨ä¼šåˆ›å»ºæµè§ˆä¸Šä¸‹æ–‡å¯¹è±¡å’Œ Document å¯¹è±¡ï¼Œå¹¶å¼€å§‹äº‹ä»¶å¾ªç¯ï¼Œé¦–å…ˆå‘èµ·ä¸€ä¸ª html è§£æçš„ä»»åŠ¡</p>
<p>è¿™ä¸ªè¿‡ç¨‹ä¼šè¿›è¡Œæµè§£æï¼Œä»¤ç‰ŒåŒ–ï¼Œç”ŸæˆdomèŠ‚ç‚¹ï¼Œæ„å»ºdomæ ‘</p>
<p>å‘ç°èµ„æºçš„è¯é€šè¿‡æµè§ˆå™¨è¿›ç¨‹çš„ç½‘ç»œçº¿ç¨‹å»è·å–èµ„æºï¼Œèµ„æºä¼šæ’ä¼˜å…ˆçº§ï¼ˆå…·ä½“å¿˜äº†ï¼‰</p>
<p>åŒæ—¶è¿˜ä¼šè¿›è¡Œæ ·å¼æ ‘çš„æ„å»º</p>
<p>é‡åˆ°åŒæ­¥è„šæœ¬æ—¶ï¼Œæš‚åœhtmlè§£æä»»åŠ¡ï¼Œå°†åŒæ­¥è„šæœ¬ä½œä¸ºä»»åŠ¡æ’å…¥äº‹ä»¶å¾ªç¯ï¼ˆåŒæ­¥ä»£ç æ‰§è¡Œå®Œæ¯•è¿˜ä¼šå»æ¸…ç©ºå¾®ä»»åŠ¡é˜Ÿåˆ—ï¼‰<br>ï¼ˆæ³¨æ„ï¼Œæ­¤æ—¶å¯èƒ½ä¼šè¿›è¡Œé¢„æ‰«ææŸ¥è¯¢åé¢çš„èµ„æºï¼Œå¹¶è¿›è¡Œæå‰åŠ è½½ã€‚è¿™é‡Œæœ‰ä¸€å¥—å¤æ‚çš„å¤„ç†æœºåˆ¶ï¼Œä¸å…·ä½“åˆ†æäº†ã€‚ï¼‰</p>
<p>åŒæ­¥ä»£ç ä¸­å¯èƒ½è¿˜ä¼šè§¦å‘å›æµå’Œé‡ç»˜</p>
<p>äº‹ä»¶å¾ªç¯ç»§ç»­ï¼Œå†æ¬¡æ‰§è¡Œ html è§£æä»»åŠ¡ï¼ˆè¿™è¾¹è§„èŒƒæ²¡æœ‰è¯¦ç»†å®šä¹‰ï¼Œå¯èƒ½æœ‰çš„æ¸²æŸ“å¼•æ“æ˜¯å…¶ä»–ä»»åŠ¡å¦‚ç½‘ç»œä»»åŠ¡æºå…ˆæ‰§è¡Œï¼‰</p>
<p>html è§£æä»»åŠ¡ç»“æŸï¼Œè§¦å‘domcontentloadå›è°ƒï¼Œè¿›è¡Œ ui render</p>
<p>æ­¤æ—¶ dom æ ‘å’Œæ ·å¼æ ‘ä¼šåˆæˆå¸ƒå±€æ ‘</p>
<p>éå†å¸ƒå±€æ ‘åˆ›å»ºå±‚æ ‘ï¼ˆæ¯”å¦‚é€šè¿‡ css3 æŸäº›å±æ€§åˆ›å»ºå•ç‹¬å±‚ï¼‰ï¼Œæ¯å±‚å•ç‹¬æ¸²æŸ“ï¼Œç„¶åäº¤ç”±åˆæˆå™¨çº¿ç¨‹è¿›è¡Œåˆå¹¶ï¼Œæœ€åæ˜¾ç¤ºåœ¨é¡µé¢ä¸Š</p>
]]></content>
      <categories>
        <category>å¤§å‰ç«¯</category>
      </categories>
      <tags>
        <tag>HTML</tag>
      </tags>
  </entry>
  <entry>
    <title>é€šè¯» HTML Standard</title>
    <url>/2019/12/11/2019Q4/%E9%80%9A%E8%AF%BB%20HTML%20Standard/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><pre><code>åªæœ‰æŒæ¡äº† N-1 å±‚çš„åŸç†ï¼Œæ‰èƒ½ç²¾é€šç¬¬ N å±‚çš„æŠ½è±¡
                                   -- ä½šå</code></pre><a id="more"></a>
<p>è§†å·¥ä½œç±»å‹è€Œå®šï¼Œæœ‰æ—¶å€™æƒ³æŒæ¡ N-1 å±‚çš„åŸç†ï¼Œå¯èƒ½è¿˜éœ€è¦äº†è§£ N-2,N-3 â€¦</p>
<p>äºå‰ç«¯ç¨‹åºå‘˜è€Œè¨€ï¼Œç¬¬ N å±‚çš„æŠ½è±¡å³ HTML/CSS/JS è¯­æ³•ï¼ŒN+1 å±‚æ˜¯å„ç§å‰ç«¯æ¡†æ¶ï¼ŒN-1 å±‚æ˜¯è¯­æ³•çš„å†…éƒ¨å®ç°å’Œæµè§ˆå™¨çš„å·¥ä½œåŸç†ï¼ŒN-2 å±‚å¯èƒ½å°±æ˜¯æ¸²æŸ“å¼•æ“ï¼ŒJS å¼•æ“ï¼ŒJS Runtimeçš„å®ç°ã€‚</p>
<p>ä½ è§è¿‡æ²¡æœ‰æŒæ¡ HTML/CSS/JS å´ç²¾é€š React æ¡†æ¶çš„äººä¹ˆï¼Ÿ</p>
<p>æœ¬æ–‡åªè°ˆ HTML ï¼Œè¦æƒ³çœŸæ­£çš„ç²¾é€š HTML ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“ HTML çš„å†…éƒ¨å®ç°ï¼Œé€šè¯» HTML è§„èŒƒæ˜¯æœ€æœ‰æ•ˆçš„æ–¹æ³•ä¹‹ä¸€</p>
<p>é€šè¿‡æœ¬æ–‡ï¼Œæˆ‘ä»¬æƒ³è¦è¾¾åˆ°çš„ç›®çš„æœ‰ï¼š</p>
<ol>
<li>äº†è§£ Web å¹³å°çš„æŠ€æœ¯ä½“ç³»ä»¥åŠå¦‚ä½•æŸ¥æ‰¾ç›¸å…³è§„èŒƒ</li>
<li>äº†è§£ HTML è§„èŒƒçš„æ•´ä½“ç»“æ„ï¼Œæ—¥åç¢°åˆ°ç–‘éš¾æ‚ç—‡å¯ä»¥å¿«é€Ÿæ’æŸ¥åŸå› </li>
</ol>
<p>PS: æœ¬æ–‡æè¿°ä¸­çš„ â€œæ ‡å‡†â€ å’Œ â€œè§„èŒƒâ€ æŒ‡çš„æ˜¯åŒä¸€ä¸œè¥¿</p>
<p>PS2: ä¸ºä»€ä¹ˆè¦çœ‹ HTML è§„èŒƒï¼Ÿé€šå¸¸ API æ–‡æ¡£åªå‘Šè¯‰äº†æˆ‘ä»¬è¦è¿™ä¹ˆåšï¼Œå´æ²¡å‘Šè¯‰æˆ‘ä»¬ä¸ºä»€ä¹ˆä¸èƒ½è¿™æ ·åšï¼Œé€šè¿‡çœ‹è§„èŒƒï¼Œæˆ‘ä»¬èƒ½å¯¹ API ç†è§£æ›´åŠ æ·±åˆ»</p>
<h2 id="æŸ¥æ‰¾è§„èŒƒ"><a href="#æŸ¥æ‰¾è§„èŒƒ" class="headerlink" title="æŸ¥æ‰¾è§„èŒƒ"></a>æŸ¥æ‰¾è§„èŒƒ</h2><p>é¦–å…ˆæ˜ç¡®ä¸€ç‚¹ï¼Œ <a href="https://developer.mozilla.org/" target="_blank" rel="noopener">MDN</a> ä¸æ˜¯è§„èŒƒæ–‡æ¡£ï¼Œç¡®åˆ‡çš„è¯´æ³•æ˜¯æŒ‡å—å’Œå¼€å‘æ•™ç¨‹ï¼Œæ˜¯å¯¹è§„èŒƒçš„äºŒæ¬¡è§£è¯»ã€‚<br>ç›¸æ¯”è§„èŒƒï¼ŒMDN åœ¨è¡Œæ–‡æ ¼å¼å’Œä¸“ä¸šæœ¯è¯­çš„è¿ç”¨ä¸Šæ›´å®¹æ˜“è®©å‰ç«¯å¼€å‘è€…æ¥å—ã€‚å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼ŒMDN å·²èƒ½å¤Ÿè§£å†³é—®é¢˜ã€‚å½“å‘ç° MDN ä¸Šçš„è§£é‡Šä¸å¤Ÿæ¸…æ™°æ—¶ï¼Œè¿™æ—¶å€™å°±å¯ä»¥å»çœ‹è§„èŒƒäº†ã€‚ä¸€èˆ¬è¿™ç§æƒ…å†µï¼Œéƒ½æ˜¯æ¯”è¾ƒæ·±å…¥åº•å±‚çš„é—®é¢˜ï¼Œæ¯•ç«Ÿï¼Œè§„èŒƒæ˜¯ç”¨æ¥ç»™æµè§ˆå™¨å¼€å‘è€…çœ‹çš„ã€‚</p>
<p>Web å¹³å°çš„æµè§ˆå™¨ç›¸å…³æŠ€æœ¯ä¼—å¤šï¼Œç”±ä¸åŒçš„ç»„ç»‡æ¥ç¡®å®šè§„èŒƒã€‚<br>æ—©åœ¨ä¹‹å‰ï¼Œå…³äº HTML å’Œ DOM æ ‡å‡†ï¼Œ <a href="https://www.w3.org/" target="_blank" rel="noopener">W3C</a> å’Œ <a href="https://html.spec.whatwg.org/multipage/" target="_blank" rel="noopener">WHATWG</a> éƒ½æœ‰å„ç§çš„è§„èŒƒï¼Œè¿™ä¸¥é‡é˜»ç¢äº† HTML çš„å‘å±•ã€‚</p>
<blockquote>
<p>W3C å¸Œæœ›å‘å¸ƒä¸€ä¸ª finished ç‰ˆæœ¬çš„ HTML5ï¼Œè€Œ WHATWG æƒ³è¦ä¸æ–­ç»´æŠ¤è¯¥è§„èŒƒè€Œä¸æ˜¯å°†å·²çŸ¥é—®é¢˜å†»ç»“åœ¨æŸä¸ªç‰ˆæœ¬</p>
</blockquote>
<p>ä¸è¿‡å¦‚ä»Šä¸¤ä¸ªç»„ç»‡å·²<a href="https://www.w3.org/blog/news/archives/7753" target="_blank" rel="noopener">è¾¾æˆä¸€è‡´</a>ï¼ŒHTML å’Œ DOM æ ‡å‡†ç”± WHATWG ç»´æŠ¤ã€‚</p>
<p>å…³äºä¸€é¡¹æŠ€æœ¯ï¼Œå¦‚ä½•ç¡®å®šå¯¹åº”çš„è§„èŒƒå¹¶æ‰¾åˆ°è§„èŒƒæ–‡æ¡£ï¼Œè¿™é‡Œæ¨èä¸€ä¸ªç½‘ç«™ï¼š<a href="https://platform.html5.org/" target="_blank" rel="noopener">The Web platform: Browser technologies</a> ã€‚<br>å…¶åˆ—ä¸¾äº† Web å¹³å°çš„æµè§ˆå™¨ç›¸å…³æŠ€æœ¯çš„æ ‡å‡†æ–‡æ¡£å’Œåè®®è§„èŒƒåœ°å€ï¼ŒåŒ…æ‹¬ä»¥ä¸‹å‡ å¤§æ¨¡å—ï¼š</p>
<ol>
<li>HTML,DOM,ECMAScriptç­‰æ ¸å¿ƒæ¨¡å—</li>
<li>CSS</li>
<li>Canvas,SVG ç­‰å›¾å½¢æ¨¡å—</li>
<li>å¤šåª’ä½“</li>
<li>å¹³å°äº¤äº’ï¼Œäº‹ä»¶åŠæ¶ˆæ¯ä¼ é€’</li>
<li>æ–‡ä»¶å’Œå­˜å‚¨</li>
<li>å®æ—¶é€šä¿¡æ¨¡å—</li>
<li>Web Components</li>
<li>HTML é¢å¤–æ”¶å½•æ¨¡å—ï¼Œå¦‚ Drag and drop</li>
<li>æ€§èƒ½ä¼˜åŒ–ä¸åˆ†æ</li>
<li>å®‰å…¨å’Œéšç§</li>
<li>å…¶ä»–æ ¸å¿ƒå¹³å°é¢å¤–æ”¶å½•æ¨¡å—ï¼Œå¦‚ Mutation observers</li>
<li>HTTP,Cookies ç­‰åŸºç¡€æ¨¡å—</li>
<li>å„ç§å…¶ä»–çš„â€¦</li>
</ol>
<p><img src="https://upload-images.jianshu.io/upload_images/9277731-e96debd8fc6b0bda.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="The Web Platform Browser technologies.png"></p>
<p>é¡µé¢ä¸Šç”¨å›¾æ ‡æŒ‡å‡ºäº†å„ä¸ªæŠ€æœ¯è§„èŒƒçš„åˆ¶å®šç»„ç»‡ï¼Œä»¥åŠåœ¨ caniuse å’Œ MDN ä¸­çš„åœ°å€ï¼ŒåŒæ—¶ç»™å‡ºäº†è¯¥é¡¹æŠ€æœ¯çš„ä½¿ç”¨å»ºè®®â€“ç†è§£ä½¿ç”¨/è°¨æ…ä½¿ç”¨</p>
<p>ç»†å¿ƒçš„åŒå­¦å¯ä»¥å‘ç°ï¼Œ<code>WebSocket API</code> ç­‰æŠ€æœ¯å’Œ HTML éƒ½æ˜¯å®šä¹‰åœ¨åŒä¸€è§„èŒƒæ–‡æ¡£ <a href="https://html.spec.whatwg.org/multipage/" target="_blank" rel="noopener">https://html.spec.whatwg.org/multipage/</a> ä¸­ï¼Œè¿™ä¸ªåæ–‡ä¼šè¯´åŸå› </p>
<h2 id="å½“æˆ‘ä»¬è°ˆåˆ°-HTML-è§„èŒƒçš„æ—¶å€™ï¼Œæˆ‘ä»¬åœ¨è¯´ä»€ä¹ˆï¼Ÿ"><a href="#å½“æˆ‘ä»¬è°ˆåˆ°-HTML-è§„èŒƒçš„æ—¶å€™ï¼Œæˆ‘ä»¬åœ¨è¯´ä»€ä¹ˆï¼Ÿ" class="headerlink" title="å½“æˆ‘ä»¬è°ˆåˆ° HTML è§„èŒƒçš„æ—¶å€™ï¼Œæˆ‘ä»¬åœ¨è¯´ä»€ä¹ˆï¼Ÿ"></a>å½“æˆ‘ä»¬è°ˆåˆ° HTML è§„èŒƒçš„æ—¶å€™ï¼Œæˆ‘ä»¬åœ¨è¯´ä»€ä¹ˆï¼Ÿ</h2><p>æˆ‘ä»¬çŸ¥é“ html æ˜¯ä¸€ç§è¶…æ–‡æœ¬æ ‡è®°è¯­è¨€ï¼Œæ‰€ä»¥ HTML è§„èŒƒæŒ‡çš„æ˜¯ htmlï¼ˆåŒ…æ‹¬æ–‡æ¡£ï¼Œå…ƒç´ å’Œè¯­æ³•ï¼‰ çš„ç¼–ç è§„èŒƒï¼Ÿ</p>
<p>ä¸æ˜¯ï¼Œ HTML è§„èŒƒ != HTML ç¼–ç è§„èŒƒ ã€‚HTML è§„èŒƒæ˜¯å¯¹åŒ…æ‹¬ html è¯­è¨€åœ¨å†…çš„å¤šç§æŠ€æœ¯çš„è§„èŒƒå®šä¹‰ï¼Œæ˜¯æµè§ˆå™¨å¼€å‘è€…å¿…é¡»éµå¾ªçš„æ ‡å‡†ï¼Œå¹¶æä¾›ä¸Šå±‚æ¥å£ä¾›é¡µé¢å¼€å‘è€…ä½¿ç”¨ã€‚</p>
<h2 id="HTML-è§„èŒƒæ˜¯ä»€ä¹ˆ"><a href="#HTML-è§„èŒƒæ˜¯ä»€ä¹ˆ" class="headerlink" title="HTML è§„èŒƒæ˜¯ä»€ä¹ˆ"></a>HTML è§„èŒƒæ˜¯ä»€ä¹ˆ</h2><blockquote>
<p>The HTML Standard is a kitchen sink full of technologies for the web. It includes the core markup language for the web, HTML, as well as numerous APIs like Web Sockets, Web Workers, localStorage, etc.</p>
</blockquote>
<p>HTML è§„èŒƒæ˜¯å¤šç§ Web æŠ€æœ¯çš„é›†åˆã€‚å®ƒåŒ…æ‹¬ç”¨äº Web çš„æ ¸å¿ƒæ ‡è®°è¯­è¨€ HTML ä»¥åŠ Web Sockets, Web Workers, localStorage ç­‰ä¼—å¤šAPIã€‚ç›¸å¯¹äºå…¶ä»–è§„èŒƒï¼Œå®ƒåœ¨ Web å¹³å°çš„æŠ€æœ¯è§„èŒƒä¸­çš„ä½ç½®æ€»ç»“å¦‚ä¸‹ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/9277731-9ae0f5bbf0919398.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h3 id="ä»€ä¹ˆæ˜¯-HTML5-ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯-HTML5-ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ HTML5 ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ HTML5 ï¼Ÿ</h3><p>ç‹­ä¹‰ä¸Šæ¥è¯´ï¼Œ HTML5 å®šä¹‰ HTML æ ‡å‡†çš„æœ€æ–°çš„ç‰ˆæœ¬ï¼Œå› æ­¤æœ¬æ–‡ä¹Ÿå¯ä»¥è¯´æ˜¯ HTML5 æ ‡å‡†</p>
<p>å¹¿ä¹‰ä¸Šæ¥è¯´ï¼Œ HTML5 æ³›æŒ‡ç°ä»£ Web æŠ€æœ¯ï¼ŒåŒ…æ‹¬æœ¬æ–‡æ‰€å®šä¹‰çš„æ ‡å‡†å¤–ï¼Œè¿˜æœ‰å…¶ä»–å¦‚ <code>Notifications API</code>, <code>WebRTC</code> ç­‰ç­‰</p>
<p>ç›¸å…³çš„è¿˜æœ‰ h5 è¿™ä¸ªåè¯ï¼Œåœ¨å›½å†…åå‘äºæŒ‡ä»£ç§»åŠ¨ç«¯çš„ web é¡µé¢çš„è§£å†³æ–¹æ¡ˆ</p>
<h2 id="æ•´ä½“ç»“æ„"><a href="#æ•´ä½“ç»“æ„" class="headerlink" title="æ•´ä½“ç»“æ„"></a>æ•´ä½“ç»“æ„</h2><p>æœ¬èŠ‚ä»‹ç» HTML è§„èŒƒçš„æ•´ä½“ç»“æ„ã€‚</p>
<p>å¯¹äºæ¯ä¸€å°èŠ‚ï¼Œä¼šå…ˆä»‹ç»ä¸»ä½“å†…å®¹ï¼Œç„¶ååˆ—å‡ºç›¸å…³æŠ€æœ¯ç‚¹æ–¹ä¾¿ä»¥åæŸ¥æ‰¾ï¼Œå¯èƒ½è¿˜ä¼šç»™å‡ºæ³¨æ„äº‹é¡¹</p>
<p>å…ˆä¸Šç›®å½•ï¼š</p>
<ol>
<li>æ¦‚è¿°</li>
<li>é€šç”¨åŸºç¡€ç»“æ„</li>
<li>HTML æ–‡æ¡£çš„è¯­ä¹‰ã€ç»“æ„åŠAPI</li>
<li>HTML å…ƒç´ </li>
<li>Microdata</li>
<li>ç”¨æˆ·äº¤äº’</li>
<li>é¡µé¢åŠ è½½</li>
<li>Web åº”ç”¨ API</li>
<li>é€šä¿¡</li>
<li>Web workers</li>
<li>Web å­˜å‚¨</li>
<li>HTML è¯­æ³•</li>
<li>XML è¯­æ³•</li>
<li>æ¸²æŸ“</li>
<li>åºŸå¼ƒçš„ç‰¹æ€§</li>
<li>IANA æ³¨æ„äº‹é¡¹</li>
</ol>
<p>éœ€è¦é‡ç‚¹çœ‹çš„æœ‰ï¼š7,8</p>
<h3 id="1-æ¦‚è¿°"><a href="#1-æ¦‚è¿°" class="headerlink" title="1. æ¦‚è¿°"></a>1. æ¦‚è¿°</h3><p>ä»‹ç»æœ¬è§„èŒƒçš„ç»“æ„ï¼Œæä¾›é˜…è¯»è¯´æ˜åŠæ’ç‰ˆã€‚</p>
<p>ç®€å•ä»‹ç»äº†è·¨ç«™é€šä¿¡å’Œhtmlçš„ç¼–å†™ä»¥åŠå¸¸è§çš„è¯­æ³•é”™è¯¯</p>
<p>æä¾›äº†ç”¨äºå‘ç° HTML é”™è¯¯çš„å·¥å…· â€“ <a href="https://whatwg.org/validator/" target="_blank" rel="noopener">HTML Conformance Checkers</a> </p>
<h3 id="2-é€šç”¨åŸºç¡€ç»“æ„"><a href="#2-é€šç”¨åŸºç¡€ç»“æ„" class="headerlink" title="2. é€šç”¨åŸºç¡€ç»“æ„"></a>2. é€šç”¨åŸºç¡€ç»“æ„</h3><p>æä¾›äº†æœ¯è¯­è¯´æ˜å’Œä¾èµ–çš„å®šä¹‰</p>
<blockquote>
<p>è§„åˆ™ä¸­ä¾èµ–çš„å…¶ä»–è§„èŒƒçš„å®šä¹‰éƒ½ä¼šåœ¨æœ¬èŠ‚åšä¸ªæ¦‚è¦æè¿°</p>
</blockquote>
<p><code>case-sensitive</code> è¡¨ç¤ºåŒºåˆ†å¤§å°å†™çš„å­—ç¬¦ä¸²æ¯”è¾ƒ</p>
<p>å®šä¹‰äº†ç­–ç•¥æ§åˆ¶åŠŸèƒ½ï¼Œå¦‚ autoplay, document-domain</p>
<p>å®šä¹‰äº†å¸¸è§çš„ microsyntaxes ï¼Œä¸€äº›è¯­æ³•ç±»å‹çš„é—®é¢˜å¯ä»¥çœ‹è¿™é‡Œ</p>
<blockquote>
<p>HTML ä¸­æœ‰å¾ˆå¤šåœ°æ–¹æ¥å—ç‰¹å®šçš„æ•°æ®ç±»å‹ï¼Œå¦‚æ—¥æœŸå’Œæ•°å­—ï¼Œæœ¬èŠ‚æè¿°äº†å¯¹åº”ç±»å‹å†…å®¹åº”ç¬¦åˆçš„æ ‡å‡†ï¼Œä»¥åŠå¦‚ä½•è§£æ</p>
</blockquote>
<p>å®šä¹‰äº† URL ï¼Œæè¿°äº†è§£æè¿‡ç¨‹ï¼Œä»¥åŠ base URLs å˜åŠ¨åçš„æ•ˆæœ</p>
<blockquote>
<p>ä»…è¡¨å±‚ä»‹ç»ï¼Œå…·ä½“çš„éœ€è¦è°ƒæ•´è‡³ URL è§„èŒƒä¸­æŸ¥çœ‹</p>
</blockquote>
<p>å®šä¹‰äº†èµ„æºè·å–ï¼ŒåŒ…æ‹¬åŒ/è·¨åŸŸç±»å‹å®šä¹‰ï¼Œèµ„æºç±»å‹ç¡®å®šï¼Œmeta å…ƒç´ å­—ç¬¦ç¼–ç æå–è¿‡ç¨‹ï¼ŒCORS è®¾ç½®å±æ€§ï¼Œreferrer å±æ€§ï¼Œnonce å±æ€§</p>
<p>å®šä¹‰äº†é€šç”¨ DOM æ¥å£ï¼ŒåŒ…æ‹¬ IDL å±æ€§è·å–å’Œè®¾ç½®ï¼ŒHTMLCollection ç­‰é›†åˆæ¥å£ï¼ŒDOMStringList æ¥å£ï¼ŒDocument çš„åƒåœ¾å›æ”¶</p>
<p>å®šä¹‰äº†ç»“æ„åŒ–æ•°æ®ï¼ŒåŒ…æ‹¬å¯åºåˆ—åŒ–å¯¹è±¡å’Œå¯ä¼ è¾“å¯¹è±¡ç­‰</p>
<blockquote>
<p>è¿™ä¸€å°èŠ‚å±äºæ¯”è¾ƒåº•å±‚äº†</p>
</blockquote>
<h3 id="3-HTML-æ–‡æ¡£çš„è¯­ä¹‰ã€ç»“æ„åŠAPI"><a href="#3-HTML-æ–‡æ¡£çš„è¯­ä¹‰ã€ç»“æ„åŠAPI" class="headerlink" title="3. HTML æ–‡æ¡£çš„è¯­ä¹‰ã€ç»“æ„åŠAPI"></a>3. HTML æ–‡æ¡£çš„è¯­ä¹‰ã€ç»“æ„åŠAPI</h3><p>ä»‹ç»äº† HTML æ–‡æ¡£çš„ç”Ÿå‘½å‘¨æœŸï¼Œä¸€ä¸ª HTML æ–‡æ¡£è¡¨ç°ä¸ºä¸€ä¸ª Document å¯¹è±¡ï¼Œå…¶ä¸Šæœ‰å„ç§å±æ€§å¦‚å…ƒæ•°æ®ç®¡ç†ï¼ŒDOM æ ‘è®¿é—®å™¨ï¼ŒåŠ¨æ€æ ‡è®°æ’å…¥ï¼Œç”¨æˆ·äº¤äº’åŠ onreadystatechange </p>
<p>å…³äº Document, HTML æ ‡å‡†åœ¨ DOM æ ‡å‡†ä¹‹ä¸Šè¿›è¡Œäº†æ‹“å±•</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">enum DocumentReadyState &#123; <span class="string">"loading"</span>, <span class="string">"interactive"</span>, <span class="string">"complete"</span> &#125;;</span><br><span class="line">typedef (HTMLScriptElement or SVGScriptElement) HTMLOrSVGScriptElement;</span><br><span class="line"></span><br><span class="line">[OverrideBuiltins]</span><br><span class="line">partial interface Document &#123;</span><br><span class="line">  <span class="comment">// resource metadata management èµ„æºå…ƒæ•°æ®ç®¡ç†</span></span><br><span class="line">  [PutForwards=href, Unforgeable] readonly attribute Location? location;</span><br><span class="line">  attribute USVString domain;</span><br><span class="line">  readonly attribute USVString referrer;</span><br><span class="line">  attribute USVString cookie;</span><br><span class="line">  readonly attribute DOMString lastModified;</span><br><span class="line">  readonly attribute DocumentReadyState readyState;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// DOM tree accessors DOM æ ‘è®¿é—®å™¨</span></span><br><span class="line">  getter object (DOMString name);</span><br><span class="line">  [CEReactions] attribute DOMString title;</span><br><span class="line">  [CEReactions] attribute DOMString dir;</span><br><span class="line">  [CEReactions] attribute HTMLElement? body;</span><br><span class="line">  readonly attribute HTMLHeadElement? head;</span><br><span class="line">  [SameObject] readonly attribute HTMLCollection images;</span><br><span class="line">  [SameObject] readonly attribute HTMLCollection embeds;</span><br><span class="line">  [SameObject] readonly attribute HTMLCollection plugins;</span><br><span class="line">  [SameObject] readonly attribute HTMLCollection links;</span><br><span class="line">  [SameObject] readonly attribute HTMLCollection forms;</span><br><span class="line">  [SameObject] readonly attribute HTMLCollection scripts;</span><br><span class="line">  NodeList getElementsByName(DOMString elementName);</span><br><span class="line">  readonly attribute HTMLOrSVGScriptElement? currentScript; <span class="comment">// classic scripts in a document tree only</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// dynamic markup insertion åŠ¨æ€æ ‡è®°æ’å…¥</span></span><br><span class="line">  [CEReactions] Document open(optional DOMString unused1, optional DOMString unused2); <span class="comment">// both arguments are ignored</span></span><br><span class="line">  WindowProxy? open(USVString url, DOMString name, DOMString features);</span><br><span class="line">  [CEReactions] <span class="keyword">void</span> close();</span><br><span class="line">  [CEReactions] <span class="keyword">void</span> write(DOMString... text);</span><br><span class="line">  [CEReactions] <span class="keyword">void</span> writeln(DOMString... text);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// user interaction ç”¨æˆ·äº¤äº’</span></span><br><span class="line">  readonly attribute WindowProxy? defaultView;</span><br><span class="line">  boolean hasFocus();</span><br><span class="line">  [CEReactions] attribute DOMString designMode;</span><br><span class="line">  [CEReactions] boolean execCommand(DOMString commandId, optional boolean showUI = <span class="literal">false</span>, optional DOMString value = <span class="string">""</span>);</span><br><span class="line">  boolean queryCommandEnabled(DOMString commandId);</span><br><span class="line">  boolean queryCommandIndeterm(DOMString commandId);</span><br><span class="line">  boolean queryCommandState(DOMString commandId);</span><br><span class="line">  boolean queryCommandSupported(DOMString commandId);</span><br><span class="line">  DOMString queryCommandValue(DOMString commandId);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// special event handler IDL attributes that only apply to Document objects</span></span><br><span class="line">  <span class="comment">// åªé€‚ç”¨äº Document å¯¹è±¡çš„ç‰¹æ®Šäº‹ä»¶å¤„ç†å™¨ IDL å±æ€§</span></span><br><span class="line">  [LenientThis] attribute EventHandler onreadystatechange;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// also has obsolete members</span></span><br><span class="line">&#125;;</span><br><span class="line">Document includes GlobalEventHandlers;</span><br><span class="line">Document includes DocumentAndElementEventHandlers;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>é€šè¿‡äº†è§£è¿™ä¸ªï¼Œæˆ‘ä»¬èƒ½æ›´æ¸…æ¥šçš„çŸ¥é“æ–‡æ¡£çš„ç»„æˆï¼Œå¯¹ document å±æ€§æœ‰ç–‘é—®çš„éƒ½å¯ä»¥çœ‹æœ¬èŠ‚</p>
</blockquote>
<p>ä»‹ç»äº† HTML å…ƒç´ ï¼Œè§„åˆ™ä»…è¡¨ç¤ºå«ä¹‰ï¼Œä¸æ¶‰åŠå‘ˆç°ï¼Œ<strong>å› æ­¤å„ä¸ªæµè§ˆå™¨å‘ˆç°å‡ºæ¥çš„ç‰¹å®šå…ƒç´ æ•ˆæœå¯èƒ½ä¸ä¸€æ ·ã€‚</strong></p>
<p>HTML å…ƒç´ çš„åŸºæœ¬æ¥å£</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">[Exposed=Window]</span><br><span class="line">interface HTMLElement : Element &#123;</span><br><span class="line">  [HTMLConstructor] <span class="keyword">constructor</span>();</span><br><span class="line"></span><br><span class="line">  // metadata attributes å…ƒæ•°æ®å±æ€§</span><br><span class="line">  [CEReactions] attribute DOMString title;</span><br><span class="line">  [CEReactions] attribute DOMString lang;</span><br><span class="line">  [CEReactions] attribute boolean translate;</span><br><span class="line">  [CEReactions] attribute DOMString dir;</span><br><span class="line"></span><br><span class="line">  // user interaction ç”¨æˆ·äº¤äº’</span><br><span class="line">  [CEReactions] attribute boolean hidden;</span><br><span class="line">  void click();</span><br><span class="line">  [CEReactions] attribute DOMString accessKey;</span><br><span class="line">  readonly attribute DOMString accessKeyLabel;</span><br><span class="line">  [CEReactions] attribute boolean draggable;</span><br><span class="line">  [CEReactions] attribute boolean spellcheck;</span><br><span class="line">  [CEReactions] attribute DOMString autocapitalize;</span><br><span class="line"></span><br><span class="line">  [CEReactions] attribute [TreatNullAs=EmptyString] DOMString innerText;</span><br><span class="line"></span><br><span class="line">  ElementInternals attachInternals();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">HTMLElement includes GlobalEventHandlers;</span><br><span class="line">HTMLElement includes DocumentAndElementEventHandlers;</span><br><span class="line">HTMLElement includes ElementContentEditable;</span><br><span class="line">HTMLElement includes HTMLOrSVGElement;</span><br><span class="line"></span><br><span class="line">[Exposed=Window]</span><br><span class="line">interface HTMLUnknownElement : HTMLElement &#123;</span><br><span class="line">  <span class="comment">// Note: intentionally no [HTMLConstructor]</span></span><br><span class="line">  <span class="comment">// æ³¨æ„ï¼šæœ‰æ„æ²¡æœ‰ [HTMLConstructor]</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>ä»‹ç»äº† HTML å‘½åç©ºé—´ä¸­åç§°ä¸º name çš„å…ƒç´ çš„å…ƒç´ æ¥å£çš„ç¡®è®¤è§„åˆ™</p>
<blockquote>
<p>ä¸¾ä¾‹ï¼š xmp å…ƒç´ åŸå‹æ˜¯ä»€ä¹ˆï¼Ÿ ç­”æ¡ˆæ˜¯ HTMLPreElement ï¼ˆç»§æ‰¿è‡ª HTMLElement ï¼‰</p>
</blockquote>
<p>ä»‹ç»äº†å…ƒç´ æ„é€ å™¨ç”¨äºå®ç°è‡ªå®šä¹‰å…ƒç´ </p>
<p>å®šä¹‰äº†å†…å®¹æ¨¡å‹ï¼Œå³æ¯ä¸ª HTML å…ƒç´ çš„å†…å®¹ï¼ˆå…¶ DOM ä¸­çš„å­èŠ‚ç‚¹ï¼‰å¿…é¡»ç¬¦åˆå†…å®¹æ¨¡å‹çš„è¦æ±‚</p>
<blockquote>
<p>ä¸¾ä¾‹ <code>&lt;p&gt;&lt;object&gt;&lt;param&gt;&lt;ins&gt;&lt;map&gt;&lt;a href=&quot;/&quot;&gt;Apples&lt;/a&gt;&lt;/map&gt;&lt;/ins&gt;&lt;/object&gt;&lt;/p&gt;</code> <br>ä¸ºäº†æ£€æŸ¥ a å…ƒç´ ä¸­æ˜¯å¦å…è®¸ â€œApplesâ€ï¼Œè¦æ£€æŸ¥å†…å®¹æ¨¡å‹ã€‚ a å…ƒç´ çš„å†…å®¹æ¨¡å‹æ˜¯é€æ˜çš„ï¼Œmap å…ƒç´ ä¹Ÿæ˜¯ï¼Œ ins å…ƒç´ ä¹Ÿæ˜¯ï¼Œobject å…ƒç´ ä¸­ ins å…ƒç´ æ‰€åœ¨çš„éƒ¨åˆ†ä¹Ÿæ˜¯ã€‚ object å…ƒç´ ä½äº p å…ƒç´ ä¸­ï¼Œåè€…çš„å†…å®¹æ¨¡å‹æ˜¯ çŸ­è¯­å†…å®¹ã€‚ å› æ­¤ â€œApplesâ€ æ˜¯å…è®¸çš„ï¼Œå› ä¸ºæ–‡æœ¬æ˜¯çŸ­è¯­å†…å®¹ã€‚</p>
</blockquote>
<p>ä»‹ç»äº†é€šç”¨å±æ€§ï¼Œæ‰€æœ‰ HTML å…ƒç´ éƒ½å¯ä»¥ä½¿ç”¨ï¼Œå¦‚ <code>contenteditable,style,title,dir,lang</code></p>
<p>ä»‹ç»äº† <code>innerText</code> çš„æ‰§è¡Œæ­¥éª¤</p>
<h3 id="4-HTML-å…ƒç´ "><a href="#4-HTML-å…ƒç´ " class="headerlink" title="4. HTML å…ƒç´ "></a>4. HTML å…ƒç´ </h3><p>æ¯ä¸ªå…ƒç´ éƒ½æœ‰ä¸€ä¸ªé¢„å®šä¹‰çš„å«ä¹‰ï¼Œæœ¬ç« ä¾¿è§£é‡Šäº†è¿™äº›å«ä¹‰ã€‚ ä¹Ÿç»™å‡ºäº†ä½œè€…ä½¿ç”¨è¿™äº›å…ƒç´ çš„è§„åˆ™ï¼Œä»¥åŠç”¨æˆ·ä»£ç†å¤„ç†è¿™äº›å…ƒç´ çš„è¦æ±‚ã€‚ è¿™é‡ŒåŒ…å«äº†å¤§é‡çš„ HTML ç‹¬æœ‰çš„ç‰¹æ€§ï¼Œä¾‹å¦‚è§†é¢‘æ’­æ”¾å’Œå‰¯æ ‡é¢˜ï¼Œè¡¨å•æ§ä»¶å’Œè¡¨å•æäº¤ï¼Œ ä»¥åŠåä¸º HTML canvas çš„ 2D å›¾å½¢ APIã€‚</p>
<blockquote>
<p>æœ‰å…·ä½“å…ƒç´ ä½¿ç”¨ä¸Šçš„ç–‘é—®å¯ä»¥åœ¨æœ¬ç« ä¸­æŸ¥æ‰¾</p>
</blockquote>
<h3 id="5-Microdata"><a href="#5-Microdata" class="headerlink" title="5. Microdata"></a>5. Microdata</h3><p>æœ¬æ ‡å‡†ä»‹ç»äº†ä¸ºæ–‡æ¡£å¢åŠ æœºå™¨å¯è¯»æ³¨è§£çš„æœºåˆ¶ï¼Œè¿™æ ·å·¥å…·å¯ä»¥ä»æ–‡æ¡£ä¸­æŠ½å–é”®å€¼å¯¹çš„æ ‘ã€‚<br>è¿™éƒ¨åˆ†æ–‡æ¡£æè¿°äº†è¯¥æœºåˆ¶å’Œç”¨äºå°† HTML æ–‡æ¡£è½¬æ¢ä¸ºå…¶ä»–æ ¼å¼çš„ä¸€äº›ç®—æ³•ã€‚ è¿™éƒ¨åˆ†è¿˜ä¸ºè”ç³»ä¿¡æ¯ã€æ—¥å†äº‹ä»¶å’Œè®¸å¯åè®®å®šä¹‰äº†ä¸€äº›ç¤ºä¾‹çš„å¾®æ•°æ®è¯æ±‡ã€‚</p>
<blockquote>
<p>itemscope ä¸Šçš„ä½¿ç”¨æœ‰ç–‘é—®ï¼Œå…ˆçœ‹ MDN å†çœ‹æœ¬ç« </p>
</blockquote>
<h3 id="6-ç”¨æˆ·äº¤äº’"><a href="#6-ç”¨æˆ·äº¤äº’" class="headerlink" title="6. ç”¨æˆ·äº¤äº’"></a>6. ç”¨æˆ·äº¤äº’</h3><p>HTML Document å¯ä»¥æä¾›ä¸€äº›ç”¨æˆ·ä¸å†…å®¹äº¤äº’ä»¥åŠç”¨æˆ·ä¿®æ”¹å†…å®¹çš„æœºåˆ¶ï¼Œåœ¨æœ¬ç« ä¸­ç»™å‡ºäº†è¿™äº›æœºåˆ¶çš„æè¿°ã€‚ </p>
<p>æä¾›äº† hidden å±æ€§çš„æè¿°</p>
<blockquote>
<p>display: block å¯ä»¥è¦†ç›– hidden çš„æ•ˆæœ</p>
</blockquote>
<p>æè¿°äº†æƒ°æ€§å­æ ‘çš„æ¦‚å¿µ</p>
<blockquote>
<p>ä¸¾ä¸ªå¸¸è§çš„ä¾‹å­ï¼Œåœ¨Aå…ƒç´ ä¸­ mouseDown ç„¶åç§»åŠ¨åˆ° B å…ƒç´ ä¸Šå¹¶ mouseUp ,mouseMove å’Œ click äº‹ä»¶æ˜¯åœ¨Aå…ƒç´ ä¸Šè§¦å‘ï¼ŒB æ˜¯æƒ°æ€§çš„</p>
</blockquote>
<p>æè¿°äº†ç„¦ç‚¹çš„å·¥ä½œæœºåˆ¶</p>
<blockquote>
<p>è¿™é‡Œçš„å¤„ç†æŒºå¤æ‚çš„</p>
</blockquote>
<p>æè¿°äº†ç”¨äºæ¿€æ´»å…ƒç´ çš„æŒ‡å®šå¿«æ·é”® â€“ accesskey </p>
<p>æè¿°äº†å¯ç¼–è¾‘å…ƒç´ çš„ç›¸å…³æ¥å£å’Œ APIï¼šcontenteditable, designMode, execCommand, inputmode</p>
<p>æè¿°äº†å…ƒç´ æ‹–æ‹½çš„ç›¸å…³æ¥å£å’Œå¤„ç†è¿‡ç¨‹ï¼Œå…¶ä¸­éƒ¨åˆ†ç« èŠ‚æ˜¯éè§„èŒƒçš„ï¼Œæ‰€ä»¥æµè§ˆå™¨é—´çš„å®ç°ä¼šæœ‰å·®å¼‚</p>
<h3 id="7-é¡µé¢åŠ è½½"><a href="#7-é¡µé¢åŠ è½½" class="headerlink" title="7. é¡µé¢åŠ è½½"></a><strong>7. é¡µé¢åŠ è½½</strong></h3><p>è¿™éƒ¨åˆ†å®šä¹‰äº†å¾ˆå¤šå½±å“å¤„ç†å¤šé¡µé¢ç¯å¢ƒçš„ç‰¹æ€§ã€‚è¦æ·±å…¥ç†è§£<strong>æµè§ˆå™¨çš„è¿è¡Œè¿‡ç¨‹</strong>ï¼Œæœ¬ç« èŠ‚éœ€è¦ç»†è¯»ã€‚</p>
<p>æè¿°äº†æµè§ˆä¸Šä¸‹æ–‡çš„å®šä¹‰å’Œåˆ†ç±»ï¼ŒåŒ…æ‹¬åµŒå¥—æµè§ˆä¸Šä¸‹æ–‡ï¼ˆiframeï¼‰å’Œè¾…åŠ©æµè§ˆä¸Šä¸‹æ–‡ï¼ˆwindow.openerï¼‰</p>
<p>æè¿°äº† Window, WindowProxy, å’Œ Location å¯¹è±¡çš„å®‰å…¨åŸºç¡€è®¾æ–½</p>
<blockquote>
<p>è¿™é‡Œä»‹ç»äº† window.open ç­‰æ–¹æ³•çš„æ‰§è¡Œæœºåˆ¶</p>
</blockquote>
<p>ä»‹ç»äº† Origin çš„å®šä¹‰å’ŒåŒæºåˆ¤æ–­ç®—æ³•ï¼Œä»¥åŠ <code>document.domain</code> èµ‹å€¼æè¿°</p>
<p>ä»‹ç»äº†æ²™ç›’æœºåˆ¶ï¼ˆsandboxingï¼‰</p>
<p>ä»‹ç»äº†ä¼šè¯å†å²å’Œå¯¼èˆªæ¥å£ï¼š history å’Œ location</p>
<p>æè¿°äº†æµè§ˆä¸Šä¸‹æ–‡å¯¼èˆªå’Œé¡µé¢åŠ è½½å¤„ç†æ¨¡å‹</p>
<p>æè¿°äº†ç¦»çº¿åº”ç”¨ç¼“å­˜ã€‚</p>
<h3 id="8-Web-åº”ç”¨-API"><a href="#8-Web-åº”ç”¨-API" class="headerlink" title="8. Web åº”ç”¨ API"></a><strong>8. Web åº”ç”¨ API</strong></h3><p>è¿™éƒ¨åˆ†ä»‹ç»äº† HTML åº”ç”¨è„šæœ¬çš„åŸºæœ¬ç‰¹æ€§ã€‚ä¹Ÿæ˜¯éœ€è¦é‡ç‚¹ç»†è¯»çš„ç« èŠ‚</p>
<p>ä»‹ç»äº†è„šæœ¬,åŒ…æ‹¬ <code>javascript: URL</code> ï¼Œå¯ç”¨ç¦ç”¨è„šæœ¬ï¼Œè„šæœ¬å¤„ç†æ¨¡å‹ï¼Œ<strong>Event Loops</strong> å’Œæµè§ˆå™¨äº‹ä»¶</p>
<blockquote>
<p>Event Loops ä¸€èŠ‚è¿˜è®²è¿°äº†å’Œ<a href="https://html.spec.whatwg.org/#update-the-rendering" target="_blank" rel="noopener">æ¸²æŸ“å¼•æ“çš„äº¤äº’</a></p>
</blockquote>
<p>ä»‹ç»äº† WindowOrWorkerGlobalScope mixinï¼Œæè¿°äº†å…¨å±€å¯¹è±¡ä¸Šå…¬å¼€çš„ API</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">typedef (DOMString or <span class="built_in">Function</span>) TimerHandler;</span><br><span class="line"></span><br><span class="line">interface mixin WindowOrWorkerGlobalScope &#123;</span><br><span class="line">  [Replaceable] readonly attribute USVString origin;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// base64 å·¥å…·æ–¹æ³•</span></span><br><span class="line">  DOMString btoa(DOMString data);</span><br><span class="line">  ByteString atob(DOMString data);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// timers</span></span><br><span class="line">  long setTimeout(TimerHandler handler, optional long timeout = <span class="number">0</span>, any... arguments);</span><br><span class="line">  <span class="keyword">void</span> clearTimeout(optional long handle = <span class="number">0</span>);</span><br><span class="line">  long setInterval(TimerHandler handler, optional long timeout = <span class="number">0</span>, any... arguments);</span><br><span class="line">  <span class="keyword">void</span> clearInterval(optional long handle = <span class="number">0</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// microtask queuing</span></span><br><span class="line">  <span class="keyword">void</span> queueMicrotask(VoidFunction callback);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ImageBitmap</span></span><br><span class="line">  <span class="built_in">Promise</span>&lt;ImageBitmap&gt; createImageBitmap(ImageBitmapSource image, optional ImageBitmapOptions options);</span><br><span class="line">  <span class="built_in">Promise</span>&lt;ImageBitmap&gt; createImageBitmap(ImageBitmapSource image, long sx, long sy, long sw, long sh, optional ImageBitmapOptions options);</span><br><span class="line">&#125;;</span><br><span class="line">Window includes WindowOrWorkerGlobalScope;</span><br><span class="line">WorkerGlobalScope includes WindowOrWorkerGlobalScope;</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­ä»‹ç»äº† Base64 å·¥å…·æ–¹æ³• , Timers æ‰§è¡Œè¿‡ç¨‹ï¼Œmicrotask å’Œ ImageBitmap å¤„ç†</p>
<p>ä»‹ç»äº†åŠ¨æ€æ ‡è®°æ’å…¥</p>
<blockquote>
<p>ä¸‡æ¶çš„ document.write</p>
</blockquote>
<p>ä»‹ç»äº†ç”¨æˆ·æç¤ºçª—å£æ–¹æ³•ï¼š alert,confirm,prompt çš„å†…éƒ¨å¤„ç†å’Œ print æ‰“å°æœºæç¤ºæ–¹æ³•</p>
<blockquote>
<p>å¯ä»¥äº†è§£è¿™äº›æ–¹æ³•æ‰§è¡Œæ—¶å†äº‹ä»¶å¾ªç¯ä¸­çš„å¤„ç†æ˜¯æ€æ ·çš„</p>
</blockquote>
<p>ä»‹ç»äº†ç³»ç»ŸçŠ¶æ€å’ŒåŠŸèƒ½ Navigator ,æè¿°äº†åŸºæœ¬åŠŸèƒ½æ¥å£å’Œè‡ªå®šä¹‰æ–¹æ¡ˆå¤„ç†ç¨‹åº</p>
<blockquote>
<p> å› æ­¤æµè§ˆå™¨å¯ä»¥é€šè¿‡è‡ªå®šä¹‰æ–¹æ¡ˆå¤„ç†ç¨‹åºæ‹“å±•åŠŸèƒ½ï¼Œå¦‚ geo , gamepads</p>
</blockquote>
<p>æœ€åä»‹ç»äº†åŠ¨ç”»å¸§ï¼Œå®šä¹‰äº† requestAnimationFrame å’Œ  cancelAnimationFrame</p>
<h3 id="9-é€šä¿¡-API"><a href="#9-é€šä¿¡-API" class="headerlink" title="9. é€šä¿¡ API"></a>9. é€šä¿¡ API</h3><p>è¿™éƒ¨åˆ†æè¿°äº† HTML ç¼–å†™çš„åº”ç”¨å¯ç”¨æ¥ä¸åŒä¸€å®¢æˆ·ç«¯ä¸­çš„ï¼Œä¸åŒåŸŸåçš„å…¶ä»–åº”ç”¨é€šä¿¡çš„ä¸€äº›æœºåˆ¶ã€‚ ä¹Ÿä»‹ç»äº†ä¸€ä¸ªæœåŠ¡å™¨æ¨é€äº‹ä»¶æµæœºåˆ¶ï¼Œç§°ä¸º Server Sent Events æˆ– EventSource, ä»¥åŠä¸€ä¸ªä¸ºè„šæœ¬æä¾›çš„åŒå‘å…¨åŒå·¥å¥—æ¥å­—åè®®ï¼Œç§°ä¸º Web Socketsã€‚</p>
<p>é¦–å…ˆä»‹ç»äº†ç»§æ‰¿è‡ª Event çš„ MessageEvent æ¥å£ï¼Œæœ¬ç« ä»‹ç»çš„äº‹ä»¶æ¶ˆæ¯éƒ½æ˜¯åŸºäº MessageEvent æ¥å£</p>
<p>ä»‹ç»äº†æœåŠ¡å™¨å‘é€çš„äº‹ä»¶ï¼Œå¼•å…¥äº† EventSource æ¥å£å®šä¹‰å’Œå®ç°</p>
<p>ä»‹ç»äº† Web sockets  çš„ç»„æˆå’Œå†…éƒ¨å¤„ç†</p>
<p>å¼•å…¥äº† postMessage è·¨æ–‡æ¡£é€šä¿¡ï¼Œç”¨æ¥è§£å†³éåŒæºæ–‡æ¡£é—´é€šä¿¡é—®é¢˜ï¼Œä¸”ä¸ä¼šé€ æˆè·¨ç«™è„šæœ¬æ”»å‡»</p>
<p>ä»‹ç»äº† MessageChannel é€šé“ç”¨æ¥å®ç°ä¸åŒæµè§ˆä¸Šä¸‹æ–‡ä¹‹é—´ä»£ç é€šä¿¡</p>
<p>æœ€åä»‹ç»äº†å‘å…¶ä»–æµè§ˆä¸Šä¸‹æ–‡å¹¿æ’­çš„æ–¹æ¡ˆ BroadcastChannel</p>
<h3 id="10-Web-workers"><a href="#10-Web-workers" class="headerlink" title="10. Web workers"></a>10. Web workers</h3><p>è¿™éƒ¨åˆ†å®šä¹‰äº† JavaScript åå°çº¿ç¨‹çš„ APIã€‚</p>
<p>æè¿°äº†ä¸€äº›ä½¿ç”¨åœºæ™¯ï¼Œå¦‚æ•°å­—å¯†é›†å‹è®¡ç®—ï¼Œå…±äº« worker </p>
<p>æè¿°äº†ä½œç”¨åŸŸå’Œäº‹ä»¶å¾ªç¯</p>
<p>æè¿°äº†å¯ç”¨çš„ API</p>
<h3 id="11-Web-storage"><a href="#11-Web-storage" class="headerlink" title="11. Web storage"></a>11. Web storage</h3><p>è¿™éƒ¨åˆ†å®šä¹‰äº†ä¸€ä¸ªåŸºäºé”®å€¼å¯¹çš„å®¢æˆ·ç«¯å­˜å‚¨æœºåˆ¶ã€‚</p>
<p>å®šä¹‰äº†æˆ‘ä»¬å¸¸ç”¨çš„ API: localStorage å’Œ sessionStorage ä»¥åŠ storage äº‹ä»¶</p>
<blockquote>
<p>ä¸¤è€…çš„åŒºåˆ«æ˜¯ sessionStorage åœ¨æµè§ˆå™¨å…³é—­åå†…å®¹ä¼šæ¶ˆå¤±</p>
</blockquote>
<p>æè¿°äº† storage çš„å¯ç”¨ç£ç›˜ç©ºé—´ï¼Œä¸è¿‡æ ‡å‡†æ²¡æœ‰ç»™å‡ºå…·ä½“å€¼ï¼Œåªæ˜¯å»ºè®®æ¯ä¸ªåŸŸ 5M çš„é™åˆ¶ï¼ˆæœªå‹ç¼©å‰ï¼‰</p>
<p>æè¿°äº† storage çš„éšç§å’Œå®‰å…¨é—®é¢˜</p>
<h3 id="12-HTML-è¯­æ³•"><a href="#12-HTML-è¯­æ³•" class="headerlink" title="12. HTML è¯­æ³•"></a>12. HTML è¯­æ³•</h3><p>æœ¬ç« æè¿°æœ‰ HTML MIME type æ ‡æ³¨çš„èµ„æºçš„è¯­æ³•è§„åˆ™</p>
<p>ä»‹ç»äº†æ–‡æ¡£çš„ç»„æˆéƒ¨åˆ†ï¼ŒåŒ…æ‹¬ DOCTYPE å’Œ Elements ç±»å‹ã€‚æè¿°äº†æ ‡ç­¾å’Œå±æ€§çš„è§£æè§„åˆ™</p>
<p>æè¿°äº† HTML æ–‡æ¡£è§£æçš„å¤„ç†æ¨¡å‹ï¼ŒåŒ…æ‹¬é”™è¯¯å¤„ç†ï¼Œè¾“å…¥å­—èŠ‚æµï¼Œè§£æçŠ¶æ€ï¼ŒTokenization å’Œæ ‘ç»“æ„ç­‰</p>
<img width="300" src="https://whatwg-cn.github.io/html/images/parsing-model-overview.svg"/>

<p>ä»å›¾ä¸­ä¹Ÿå¯çœ‹å‡º html è§£æå’Œè„šæœ¬æ‰§è¡Œçš„å…³ç³»</p>
<blockquote>
<p>è„šæœ¬æ‰§è¡Œä¼šé˜»å¡ DOM çš„è§£æï¼Œè¯•æƒ³ä¸‹ï¼Œä¸é˜»å¡çš„è¯ï¼Œè„šæœ¬ä¸­ä¿®æ”¹äº† DOM é‚£è¿˜å¾—è°ƒæ•´åŸæ¥æ„å»ºçš„ DOM æ ‘</p>
</blockquote>
<p>æè¿°äº† HTML ç‰‡æ®µçš„åºåˆ—åŒ–å’Œè§£æ</p>
<h3 id="13-XML-è¯­æ³•"><a href="#13-XML-è¯­æ³•" class="headerlink" title="13. XML è¯­æ³•"></a>13. XML è¯­æ³•</h3><p>æœ¬ç« æè¿° XML èµ„æºçš„è¯­æ³•è§„åˆ™ï¼Œä¸»è¦æ˜¯æè¿° XML æ–‡æ¡£çš„è§£æï¼Œä»¥åŠ XML ç‰‡æ®µçš„åºåˆ—åŒ–å’Œè§£æ</p>
<h3 id="14-æ¸²æŸ“"><a href="#14-æ¸²æŸ“" class="headerlink" title="14. æ¸²æŸ“"></a>14. æ¸²æŸ“</h3><p>è¿™éƒ¨åˆ†å®šä¹‰äº† Web æµè§ˆå™¨é»˜è®¤çš„æ¸²æŸ“è§„åˆ™ã€‚</p>
<p>æ³¨æ„ï¼Œæœ¬ç« ä»…æ˜¯å»ºè®®ï¼Œæ²¡æœ‰è¦æ±‚æµè§ˆå™¨å¿…é¡»è¿™æ ·å®ç°</p>
<blockquote>
<p>å› æ­¤ï¼Œå„ç§æ¸²æŸ“å¼•æ“çš„æ•ˆæœä¸ä¸€æ ·æ˜¯æŒ‰è§„èŒƒæ¥</p>
</blockquote>
<p>æœ¬ç« æ›´å¤šçš„æ˜¯è®²å…ƒç´ çš„é¢„æœŸæ¸²æŸ“æ•ˆæœï¼Œæ¸²æŸ“å¼•æ“æœºåˆ¶è¯·çœ‹ Event Loops ä¸€èŠ‚</p>
<h3 id="15-åºŸå¼ƒçš„ç‰¹æ€§"><a href="#15-åºŸå¼ƒçš„ç‰¹æ€§" class="headerlink" title="15. åºŸå¼ƒçš„ç‰¹æ€§"></a>15. åºŸå¼ƒçš„ç‰¹æ€§</h3><p>åŒ…æ‹¬ä¸‰éƒ¨åˆ†</p>
<ol>
<li>è¿‡æ—¶ä½†ä»å¯ç”¨çš„ç‰¹å¾ï¼Œå¦‚åœ¨ img ä¸ŠæŒ‡å®š border å±æ€§</li>
<li>ä¸å¯ç”¨çš„ç‰¹å¾ï¼Œå¦‚ä½¿ç”¨ applet å…ƒç´ ï¼ˆåº”è¯¥ç”¨ embed ä»£æ›¿ï¼‰</li>
<li>ä¸€äº›å…ƒç´ ï¼ŒAPI åº”è¯¥å®ç°çš„æ¥å£</li>
</ol>
<p>è¿™éƒ¨åˆ†å†…å®¹æ¯”è¾ƒé’ˆå¯¹æµè§ˆå™¨å¼€å‘è€…</p>
<h3 id="16-IANA-considerations"><a href="#16-IANA-considerations" class="headerlink" title="16. IANA considerations"></a>16. IANA considerations</h3><p>æœ¬ç« ä¸»è¦æè¿°ä½¿ç”¨èµ„æºç±»å‹å’Œåè®®æ—¶çš„ä¸€äº›æ³¨æ„äº‹é¡¹</p>
<h2 id="é—®é¢˜è®°å½•"><a href="#é—®é¢˜è®°å½•" class="headerlink" title="é—®é¢˜è®°å½•"></a>é—®é¢˜è®°å½•</h2><h3 id="Q1-é¡µé¢è·³è½¬å’Œå¯¼èˆªçš„ä»£ç æ‰§è¡Œé—®é¢˜"><a href="#Q1-é¡µé¢è·³è½¬å’Œå¯¼èˆªçš„ä»£ç æ‰§è¡Œé—®é¢˜" class="headerlink" title="Q1. é¡µé¢è·³è½¬å’Œå¯¼èˆªçš„ä»£ç æ‰§è¡Œé—®é¢˜"></a>Q1. é¡µé¢è·³è½¬å’Œå¯¼èˆªçš„ä»£ç æ‰§è¡Œé—®é¢˜</h3><p>ä¸‹é¢ä»£ç åˆ†åˆ«è¾“å‡ºä»€ä¹ˆï¼Œä¸ºä»€ä¹ˆï¼Ÿè¯·ä»æµè§ˆä¸Šä¸‹æ–‡å’Œäº‹ä»¶å¾ªç¯ç­‰è§’åº¦åˆ†æã€‚</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">onClick1</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="built_in">window</span>.open(<span class="string">'https://www.baidu.com'</span>)</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"onClick1"</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">onClick21</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  location.href = <span class="string">"https://www.baidu.com"</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"onClick21"</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">onClick22</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  location.href = <span class="string">"https://www.baidu.com"</span></span><br><span class="line">  <span class="comment">// 3s</span></span><br><span class="line">  <span class="keyword">let</span> start = +<span class="keyword">new</span> <span class="built_in">Date</span></span><br><span class="line">  <span class="keyword">while</span>(+<span class="keyword">new</span> <span class="built_in">Date</span> - start&lt; <span class="number">3</span>*<span class="number">1000</span>)&#123;&#125;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"onClick22"</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">onClick23</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="comment">// æœªèƒ½åŠ è½½æˆåŠŸçš„ç½‘ç«™</span></span><br><span class="line">  location.href = <span class="string">"https://sssss"</span></span><br><span class="line">  <span class="comment">// 3s</span></span><br><span class="line">  <span class="keyword">let</span> start = +<span class="keyword">new</span> <span class="built_in">Date</span></span><br><span class="line">  <span class="keyword">while</span>(+<span class="keyword">new</span> <span class="built_in">Date</span> - start&lt; <span class="number">3</span>*<span class="number">1000</span>)&#123;&#125;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"onClick23"</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">onClick3</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  history.back()</span><br><span class="line">  <span class="comment">// 3s</span></span><br><span class="line">  <span class="keyword">let</span> start = +<span class="keyword">new</span> <span class="built_in">Date</span></span><br><span class="line">  <span class="keyword">while</span>(+<span class="keyword">new</span> <span class="built_in">Date</span> - start&lt; <span class="number">3</span>*<span class="number">1000</span>)&#123;&#125;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"onClick3"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<details>
  <summary>Answer</summary>

<p>onClick21 onClick23 onClick3 ä¼šè¾“å‡º</p>
<p>ä»…ä»¥ chrome çš„å®ç°ä¸ºä¾‹ï¼Œæ¯ä¸ªæ ‡ç­¾é¡µéƒ½æ˜¯ç‹¬ç«‹çš„ç”¨æˆ·ä»£ç†ï¼ˆuser agentï¼‰</p>
<p>é¦–å…ˆï¼Œé¡µé¢ A å­˜åœ¨ç€ï¼ˆè‡³å°‘ï¼‰ä¸€ä¸ªæµè§ˆä¸Šä¸‹æ–‡ï¼Œå¹¶å¯¹åº”ç€ä¸€ä¸ª Event Loop </p>
<blockquote>
<p>è€ƒè™‘åµŒå¥—æµè§ˆä¸Šä¸‹æ–‡å’Œè¾…åŠ©æµè§ˆä¸Šä¸‹æ–‡ï¼Œæ‰€ä»¥è¿™è¾¹ç”¨çš„æ˜¯<strong>è‡³å°‘</strong></p>
</blockquote>
<p>é¡µé¢ A ä¸­æ‰§è¡Œäº†æŸæ®µåŒæ­¥ä»£ç ï¼ˆä¸€ä¸ªTaskï¼‰ï¼Œåœ¨å…¶ä¸­è°ƒç”¨äº† <a href="https://html.spec.whatwg.org/#apis-for-creating-and-navigating-browsing-contexts-by-name" target="_blank" rel="noopener">window.open</a> æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ˜¯ç«‹å³æ‰§è¡Œçš„</p>
<blockquote>
<p>å†…éƒ¨åšäº†å¾ˆå¤šå¤„ç†ï¼Œå¯ä»¥ç‚¹é“¾æ¥çœ‹çœ‹</p>
</blockquote>
<p>æ‰§è¡Œå®Œæ¯• ï¼Œæ­¤æ—¶ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„æµè§ˆä¸Šä¸‹æ–‡ä»¥åŠå¯¹åº”çš„ Event Loop </p>
<blockquote>
<p>å¦‚æœ é¡µé¢ A é‡‡ç”¨ opener å‚æ•°æ‰“å¼€çš„é¡µé¢ Bï¼Œåˆ™é¡µé¢ B è¿˜æœ‰ä¸€ä¸ªè¾…åŠ©æµè§ˆä¸Šä¸‹æ–‡ï¼ŒæŒ‡å‘é¡µé¢ A çš„æµè§ˆä¸Šä¸‹æ–‡ï¼Œå…±ç”¨åŒä¸€ä¸ª Event loopï¼Ÿï¼Ÿ</p>
</blockquote>
<p>å¦‚æœè¦åŠ è½½çš„æ–‡æ¡£æ˜¯ html ï¼Œé¡µé¢ B çš„ç”¨æˆ·ä»£ç†ä¼šæ’ä¸€ä¸ª Task åˆ›å»º Document å¯¹è±¡ï¼Œæ ‡è®°ä¸º HTML æ–‡æ¡£ï¼Œå…¶åè¯»å–å’Œè§£ææ–‡æ¡£ã€‚</p>
<p>location è·³è½¬</p>
<p>location æ˜¯åŒæ­¥æ‰§è¡Œçš„ï¼Œåå°çº¿ç¨‹ç­‰è§£æå®Œæ–‡æ¡£å°±ä¼šè·³è½¬ï¼Œä¸ä¼šç­‰åé¢çš„åŒæ­¥ä»£ç ã€‚é€šå¸¸æˆ‘ä»¬åé¢çš„åŒæ­¥ä»£ç å¾ˆå¿«æ‰§è¡Œï¼Œæ‰€ä»¥ä¼šè¯¯ä»¥ä¸º location æ˜¯å¼‚æ­¥æ‰§è¡Œçš„</p>
<p>è¯¦è§ <a href="https://stackoverflow.com/questions/37521172/is-javascript-location-href-call-is-asynchronous" target="_blank" rel="noopener">stackoverflow</a> å’Œ <a href="https://www.zhihu.com/question/42268360/answer/207444712" target="_blank" rel="noopener">è®¾ç½®location.hrefï¼Œä¸ºä»€ä¹ˆä¸ä¼šç«‹å³è·³è½¬? - çŸ¥ä¹</a></p>
<blockquote>
<p>PS: è¿˜æ²¡è¯¦ç»†çœ‹è§„èŒƒï¼Œä¸çŸ¥é“æ˜¯ä¸æ˜¯è¿™æ ·å¤„ç†</p>
</blockquote>
<p>history è·³è½¬æ˜¯ä¸€ä¸ª Taskï¼Œå› æ­¤å®ƒä¼šåœ¨æœ¬æ¬¡åŒæ­¥ä»£ç æ‰§è¡Œå®Œæ¯•åæ‰æ‰§è¡Œ</p>
<blockquote>
<p>è¿™ä¸ªçœ‹è¿è¡Œæ—¶ç¯å¢ƒå®ç°ï¼Œå¯èƒ½å…¶ä»–ä»»åŠ¡è¿˜ä¼šå…ˆä¸è¯¥ Task å‰æ‰§è¡Œ</p>
</blockquote>
<p>æ€»ç»“ï¼š <code>window.open</code> å’Œ <code>location.href</code> ä¸å±äº Web API çš„èŒƒç•´ï¼Œä¹Ÿå°±ä¸èµ° event loop é‚£ä¸€å¥—</p>
</details>

<p>æœªå®Œå¾…ç»­â€¦</p>
]]></content>
      <categories>
        <category>å¤§å‰ç«¯</category>
      </categories>
      <tags>
        <tag>HTML</tag>
      </tags>
  </entry>
  <entry>
    <title>å‰ç«¯é•¿åˆ—è¡¨åŸç†åŠä¼˜åŒ–</title>
    <url>/2019/12/10/2019Q4/%E5%89%8D%E7%AB%AF%E9%95%BF%E5%88%97%E8%A1%A8%E5%8E%9F%E7%90%86%E5%8F%8A%E4%BC%98%E5%8C%96/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>é•¿åˆ—è¡¨ä¸€èˆ¬ä¹Ÿå«è™šæ‹Ÿåˆ—è¡¨ï¼Œæ˜¯ä¸€ç§å¤§æ•°æ®é‡ä¸‹åªæ¸²æŸ“å¯è§èŠ‚ç‚¹é¿å…é¡µé¢å¡é¡¿çš„ä¼˜åŒ–æ–¹æ¡ˆ</p>
<blockquote>
<p>é•¿åˆ—è¡¨ä¹Ÿæœ‰æ—¶é—´åˆ†ç‰‡çš„åšæ³•ï¼Œæ¯”è¾ƒå°‘ç”¨ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥çœ‹ <a href="https://juejin.im/post/5d76f469f265da039a28aff7" target="_blank" rel="noopener">é«˜æ€§èƒ½æ¸²æŸ“åä¸‡æ¡æ•°æ®(æ—¶é—´åˆ†ç‰‡)</a></p>
</blockquote>
<p>å‰ç«¯æ¯”è¾ƒæœ‰åçš„æœ‰ä¸¤ä¸ªé¡¹ç›®ï¼š</p>
<ul>
<li>react-window</li>
<li>vue-virtual-scroller</li>
</ul>
<p>ä»¥åŠ Ant Design 4 çš„ <a href="https://github.com/react-component/virtual-list" target="_blank" rel="noopener">virtual-list</a> </p>
<p>æœ¬æ–‡å°†å¯¹è¿™äº›å¼€æºåº“è¿›è¡Œå‰–æï¼Œåˆ†æå®ç°åŸç†ï¼Œå¹¶è¿›è¡Œå„ä¸ªæŒ‡æ ‡çš„è¯„ä¼°ï¼Œæœ€ç»ˆå®ç°ä¸€ä¸ªé«˜å¯ç”¨çš„é•¿åˆ—è¡¨ç»„ä»¶</p>
<a id="more"></a>

<p>ä¸»è¦è¯„ä¼°ä»¥ä¸‹å‡ ç‚¹ï¼š</p>
<ol>
<li>æ¸²æŸ“ï¼šå›æµï¼Œ æ¸²æŸ“ç­–ç•¥ç­‰</li>
<li>è®¡ç®—ï¼šèµ·æ­¢é¡¹å’Œåç§»ä½ç½®çš„è®¡ç®—ï¼Œæ€»é«˜åº¦çš„è®¡ç®—</li>
<li>åŠŸèƒ½ï¼šè‡ªé€‚åº”é«˜åº¦ï¼Œå…¶ä»–</li>
<li>å¥å£®ï¼šæ˜¯å¦å­˜åœ¨é¼ æ ‡ä¸æ»šåŠ¨æ¡ä¸åŒæ­¥çš„ bugï¼ˆè®¡ç®—æ—¶æ€»é«˜åº¦å¢åŠ äº†ï¼Œåˆ™æ»šåŠ¨æ¡ä¼šç›¸å¯¹é¼ æ ‡å‘ä¸Šï¼‰</li>
</ol>
<p>ç„¶åè¯´ä¸‹çœ‹æºç çš„ç­–ç•¥ï¼Œä¸»è¦çœ‹è¿™å‡ ç‚¹ï¼š</p>
<ol>
<li>dom ç»“æ„</li>
<li>æŸ¥æ‰¾èµ·å§‹ä½ç½®</li>
<li>è®¡ç®—åç§»è·ç¦»</li>
<li>è®¡ç®—æ€»é«˜åº¦</li>
</ol>
<h2 id="é•¿åˆ—è¡¨å…¥é—¨"><a href="#é•¿åˆ—è¡¨å…¥é—¨" class="headerlink" title="é•¿åˆ—è¡¨å…¥é—¨"></a>é•¿åˆ—è¡¨å…¥é—¨</h2><p>å¦‚æœè¿˜ä¸æ¸…æ¥šé•¿åˆ—è¡¨æ˜¯ä»€ä¹ˆï¼Œå¯ä»¥å…ˆçœ‹ä¸‹è¿™ç¯‡æ–‡ç« <a href="https://juejin.im/post/5db684ddf265da4d495c40e5" target="_blank" rel="noopener">ã€Œå‰ç«¯è¿›é˜¶ã€é«˜æ€§èƒ½æ¸²æŸ“åä¸‡æ¡æ•°æ®(è™šæ‹Ÿåˆ—è¡¨)</a></p>
<p>ä¸€å¼ å›¾å¿«é€Ÿå…¥é—¨</p>
<p><img src="https://user-gold-cdn.xitu.io/2019/10/29/16e1519a393dee2c?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt=""></p>
<p>ä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹å…¶ä»–å¼€æºåº“éƒ½æ€ä¹ˆåšçš„</p>
<h2 id="vue-virtual-scroller"><a href="#vue-virtual-scroller" class="headerlink" title="vue-virtual-scroller"></a>vue-virtual-scroller</h2><p><a href="https://github.com/Akryum/vue-virtual-scroller" target="_blank" rel="noopener">é¡¹ç›®åœ°å€</a></p>
<p>åŠŸèƒ½ï¼š æ”¯æŒè‡ªé€‚åº”é«˜åº¦ï¼Œæ¨ªå‘æ»šåŠ¨ï¼Œå›¾ç‰‡è‡ªé€‚åº”é«˜åº¦</p>
<h3 id="æ¸²æŸ“"><a href="#æ¸²æŸ“" class="headerlink" title="æ¸²æŸ“"></a>æ¸²æŸ“</h3><p>dom ç»“æ„å¦‚ä¸‹</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- position: relative;overflow-y: auto; --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"vue-recycle-scroller"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"vue-recycle-scroller__item-wrapper"</span> <span class="attr">:style</span>=<span class="string">"&#123; 'minHeight': totalSize + 'px' &#125;"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span></span></span><br><span class="line"><span class="tag">        <span class="attr">v-for</span>=<span class="string">"view of pool"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">:key</span>=<span class="string">"view.nr.id"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">:style</span>=<span class="string">"&#123; transform: `translateY($&#123;view.position&#125;px)` &#125;"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">"vue-recycle-scroller__item-view"</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">slot</span></span></span><br><span class="line"><span class="tag">          <span class="attr">:item</span>=<span class="string">"view.item"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">:index</span>=<span class="string">"view.nr.index"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">:active</span>=<span class="string">"view.nr.used"</span></span></span><br><span class="line"><span class="tag">        /&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä¸€ä¸ªç›¸å¯¹å®šä½çš„åˆ—è¡¨ï¼Œç”± <code>min-height</code> æ’‘å¼€ wrapper ä»¥äº§ç”Ÿæ»šåŠ¨æ¡</p>
<p>æ¯ä¸ªåˆ—è¡¨é¡¹è¿›è¡Œå¹³ç§»(translateY),è¿™ä¸ªåç§»å€¼ä¸ºè¯¥é¡¹åœ¨åˆ—è¡¨ä¸­çš„é«˜åº¦ç´¯åŠ å€¼</p>
<p>è¿˜æœ‰ä¸€äº› <code>-9999px</code> çš„ä¸å¯è§å…ƒç´ ï¼Œè¿™äº›å…¶å®æ˜¯ç¼“å­˜æ± åˆ—è¡¨é¡¹ï¼Œè¿™ä¸ªåœ¨ <strong>èŠ‚ç‚¹å›æ”¶å¤ç”¨</strong> ä¸€èŠ‚ä¼šè®²åˆ°</p>
<p>åˆ—è¡¨é¡¹æ•°æ®ç»“æ„ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">listItem = &#123;</span><br><span class="line">  <span class="comment">// æ•°æ®é¡¹å†…å®¹</span></span><br><span class="line">  item:<span class="built_in">Object</span>,</span><br><span class="line">  <span class="comment">// éå“åº”å¼æ•°æ®</span></span><br><span class="line">  nr:&#123;</span><br><span class="line">    id,<span class="comment">// å”¯ä¸€æ ‡è¯†</span></span><br><span class="line">    index,<span class="comment">// æ•°æ®é¡¹ä¸­çš„ç´¢å¼•</span></span><br><span class="line">    used: <span class="built_in">Boolean</span>,<span class="comment">// æ˜¯å¦å·²ç”¨æ¥æ˜¾ç¤ºåœ¨å¯è§†åŒºåŸŸ</span></span><br><span class="line">    key,<span class="comment">// æ•°æ®é¡¹ä¸­çš„key</span></span><br><span class="line">    type,<span class="comment">// åœ¨å¯¹åº”ç±»å‹çš„ç¼“å†²æ± ä¸­å­˜å–</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// translateY å€¼</span></span><br><span class="line">  position: <span class="built_in">Number</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸ä¼šäº§ç”Ÿå›æµï¼ˆéè‡ªé€‚åº”é«˜åº¦çš„æƒ…å†µï¼‰</p>
<p>æµè§ˆå™¨<strong>æ¸²æŸ“é€Ÿåº¦å¿«</strong>ï¼šè¿›è¡Œæ»šåŠ¨æ—¶äº§ç”Ÿå˜åŒ–çš„åˆ—è¡¨é¡¹ä¼šå°½å¯èƒ½çš„ä½¿ç”¨ç¼“å­˜æ± å…ƒç´ å¹¶ä¿®æ”¹ translateY ï¼Œå…¶ä»–æ²¡æœ‰å˜åŠ¨çš„åˆ—è¡¨é¡¹åœ¨domç»“æ„ä¸­çš„ä½ç½®ä¸å˜</p>
<h3 id="è®¡ç®—"><a href="#è®¡ç®—" class="headerlink" title="è®¡ç®—"></a>è®¡ç®—</h3><p>æœ‰ä¸‰ç§åœºæ™¯</p>
<h4 id="â‘ -ä½¿ç”¨é»˜è®¤é«˜åº¦"><a href="#â‘ -ä½¿ç”¨é»˜è®¤é«˜åº¦" class="headerlink" title="â‘  ä½¿ç”¨é»˜è®¤é«˜åº¦"></a>â‘  ä½¿ç”¨é»˜è®¤é«˜åº¦</h4><p>æœ€ç®€å•çš„æƒ…å†µï¼Œéœ€è¦è®¾ç½® itemSize</p>
<p>èµ·å§‹é¡¹ç´¢å¼•å¯ä»¥é€šè¿‡ <code>~~(scrollTop / itemSize)</code> å¾—åˆ°</p>
<p>åˆ—è¡¨æ€»é«˜åº¦ = <code>itemSize * itemCount</code></p>
<h4 id="â‘¡-å®šä¹‰é«˜åº¦å­—æ®µ"><a href="#â‘¡-å®šä¹‰é«˜åº¦å­—æ®µ" class="headerlink" title="â‘¡ å®šä¹‰é«˜åº¦å­—æ®µ"></a>â‘¡ å®šä¹‰é«˜åº¦å­—æ®µ</h4><p>itemSize è®¾ä¸º nullï¼Œé€šè¿‡æ•°æ®é¡¹ä¸­çš„ height å­—æ®µå®šä¹‰æ¯ä¸ªåˆ—è¡¨é¡¹çš„é«˜åº¦</p>
<p>ç”±äºæ‰€æœ‰åˆ—è¡¨é¡¹é«˜åº¦æ˜¯ç¡®å®šçš„ï¼Œä¸€å¼€å§‹ä¼šè®¡ç®—æ¯ä¸€é¡¹çš„é«˜åº¦å’Œåç§»å€¼ </p>
<blockquote>
<p>O(n) æ—¶é—´å¤æ‚åº¦</p>
</blockquote>
<p>åŒæ—¶ç¡®å®šäº†åˆ—è¡¨æ€»é«˜åº¦ï¼Œå›ºå®šä¸º <code>æœ€åä¸€é¡¹çš„åç§»å€¼+é«˜åº¦</code></p>
<p>å½“è¿›è¡Œæ»šåŠ¨æ—¶ï¼Œç”±äºæ¯ä¸€é¡¹çš„åç§»ä½ç½®æ˜¯ç¡®å®šçš„ï¼Œåˆ™æŸ¥æ‰¾èµ·å§‹é¡¹ç´¢å¼•å¯ä»¥é‡‡ç”¨äºŒåˆ†æ³•</p>
<blockquote>
<p>O(logn) æ—¶é—´å¤æ‚åº¦</p>
</blockquote>
<h4 id="â‘¢-è‡ªé€‚åº”é«˜åº¦"><a href="#â‘¢-è‡ªé€‚åº”é«˜åº¦" class="headerlink" title="â‘¢ è‡ªé€‚åº”é«˜åº¦"></a>â‘¢ è‡ªé€‚åº”é«˜åº¦</h4><p>éœ€è¦é…ç½®æ•°æ®é¡¹æœ€å°é«˜åº¦ï¼Œå¹¶æ ¹æ®è¿™ä¸ªå€¼åˆå§‹åŒ–æ¯ä¸ªæ•°æ®é¡¹çš„é«˜åº¦å’Œåç§»å€¼ â€“ sizes</p>
<blockquote>
<p>O(n) æ—¶é—´å¤æ‚åº¦</p>
</blockquote>
<p>åˆ—è¡¨æ€»é«˜åº¦ä¸º <code>æœ€åä¸€é¡¹çš„åç§»å€¼+é«˜åº¦</code></p>
<p>sizes è®¡ç®—</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>, l = items.length; i &lt; l; i++) &#123;</span><br><span class="line">  current = items[i][field] || minItemSize</span><br><span class="line">  accumulator += current</span><br><span class="line">  sizes[i] = &#123; accumulator, <span class="attr">size</span>: current &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿›è¡Œæ»šåŠ¨ï¼Œé€šè¿‡äºŒåˆ† sizes å¾—åˆ°èµ·å§‹é¡¹ç´¢å¼•ï¼Œç»“æŸé¡¹ç´¢å¼•ä¸ºèµ·å§‹é¡¹ç´¢å¼•åŠ ä¸Š <code>å¯è§†é«˜åº¦/æœ€å°åˆ—é«˜</code></p>
<blockquote>
<p>O(logn) æ—¶é—´å¤æ‚åº¦</p>
</blockquote>
<p>ä¹‹åè¿›è¡ŒèŠ‚ç‚¹æ¸²æŸ“ï¼Œæ¸²æŸ“å®Œæ¯•æ—¶è·å–å®é™…é«˜åº¦ï¼Œå¹¶é‡æ–°è®¡ç®— sizes ä»¥åŠåˆ—è¡¨æ€»é«˜åº¦</p>
<blockquote>
<p>O(n) æ—¶é—´å¤æ‚åº¦</p>
</blockquote>
<p>æ€»ä½“æ¥è¯´ï¼Œæ€§èƒ½è¾ƒå·®ï¼Œæœ‰ä¼˜åŒ–çš„ç©ºé—´</p>
<h3 id="ã€å–ç‚¹ã€‘èŠ‚ç‚¹å›æ”¶ä¸å¤ç”¨"><a href="#ã€å–ç‚¹ã€‘èŠ‚ç‚¹å›æ”¶ä¸å¤ç”¨" class="headerlink" title="ã€å–ç‚¹ã€‘èŠ‚ç‚¹å›æ”¶ä¸å¤ç”¨"></a>ã€å–ç‚¹ã€‘èŠ‚ç‚¹å›æ”¶ä¸å¤ç”¨</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¿ç»­æ»šåŠ¨(continuous): å‰åä¸¤æ¬¡æŸ¥æ‰¾çš„æ•°æ®èŒƒå›´æœ‰é‡å ï¼Œæ¯”å¦‚ç¬¬ä¸€æ¬¡ä¸º 1~10 ç¬¬äºŒæ¬¡ä¸º 5~14 æˆ–è€…ç›¸å</span><br><span class="line">å·²ä½¿ç”¨çš„åˆ—è¡¨é¡¹(views): è®°å½•å·²ä½¿ç”¨é¡¹çš„ Map ï¼Œkey ä¸ºåˆ—è¡¨é¡¹çš„ key</span><br><span class="line">pool: é¡µé¢ä¸­æ‰€æœ‰æ¸²æŸ“çš„åˆ—è¡¨é¡¹ï¼ŒåŒ…æ‹¬æœªä½¿ç”¨çš„</span><br><span class="line">ç±»å‹-ç¼“å­˜æ±  Map (unusedViews): è®°å½•ç±»å‹å’Œç¼“å­˜æ± çš„ Map</span><br><span class="line">ç¼“å­˜æ± (unusedPool): æŸç§ç±»å‹çš„ç¼“å­˜æ± ï¼Œå…¶ä¸­çš„åˆ—è¡¨é¡¹åœ¨é¡µé¢ä¸­åç§»ä½ç½®ä¸º -9999px</span><br></pre></td></tr></table></figure>
<p>ä¸¾ä¸ªè¿ç»­æ»šåŠ¨çš„ä¾‹å­ï¼š</p>
<ol>
<li>ä¸€å¼€å§‹æŸ¥åˆ° 1<del>10 æ”¾å…¥ views ä¸­ï¼Œè¿›è¡Œæ»šåŠ¨ï¼ŒæŸ¥åˆ° 5</del>14</li>
<li>å°† 1~4 æ”¾å…¥å¯¹åº”ç±»å‹çš„ unusedPool ä¸­ï¼Œè®¾ç½®æœªä½¿ç”¨ï¼Œå¹¶ä» views ä¸­åˆ é™¤</li>
<li>å°†åŸæ¥çš„ 5~10é¡¹ è®¾ç½®ä¸º å·²ä½¿ç”¨</li>
<li>æŸ¥åˆ° 11 æ—¶ï¼Œçœ‹ unusedPool ä¸­æœ‰æ²¡æœ‰å’Œ 11 åŒç±»å‹çš„ï¼Œæœ‰çš„è¯ pop å‡ºæ¥å¤ç”¨ï¼Œæ›¿æ¢ä¸‹å†…å®¹å’Œåç§»ä½ç½®ï¼Œæ²¡æœ‰çš„è¯æ–°å»ºä¸€ä¸ª viewï¼Œä¼šæ”¾å…¥ pool ä¸­</li>
</ol>
<p>å¯¹åº”çš„ï¼Œéè¿ç»­æ»šåŠ¨å®šä¹‰ä¸º <strong>å¿«é€Ÿæ»šåŠ¨</strong>ï¼Œåˆå§‹åŒ–ä¸€ä¸ªç©ºçš„ map â€“ unusedIndex, ä½œç”¨æ˜¯è®°å½•åŒç±»å‹çš„ unusedPool éœ€è¦ä»å“ªä¸ªç´¢å¼•å¼€å§‹å–å€¼ã€‚</p>
<p>å¦‚æœ unusedPool å­˜åœ¨å…ƒç´ ï¼Œæ‹¿æ¥å¤ç”¨ï¼›å¦‚æœåŒç±»å‹ pool è¢«ç”¨å…‰äº†ï¼ŒaddView</p>
<blockquote>
<p>æ„Ÿè§‰æ­¤å¤„ <code>v++</code> çš„å¤„ç†æœ‰ç‚¹é—®é¢˜ï¼Œæ²¡æœ‰æ·±ç©¶</p>
</blockquote>
<p>å’Œå®‰å“çš„åˆ—è¡¨æ»šåŠ¨ç±»ä¼¼ï¼ŒæŒ‰ç±»å‹è¿›è¡Œå›æ”¶ï¼Œæ–°æ‰¾åˆ°çš„åˆ—è¡¨é¡¹ä¼šå¤ç”¨ç¼“å­˜ä¸­åŒç±»å‹çš„ï¼Œå¯ä»¥å‡å°‘ layout æ—¶é—´</p>
<p>ç±»ä¼¼çš„è¿˜æœ‰ weex çš„ <a href="https://weex.apache.org/zh/docs/components/recycle-list.html" target="_blank" rel="noopener">recycle-list</a></p>
<h3 id="å¥å£®"><a href="#å¥å£®" class="headerlink" title="å¥å£®"></a>å¥å£®</h3><p>ç”±äºè¿›åº¦æ¡é«˜åº¦ä¼šå˜åŒ–ï¼Œå› æ­¤å­˜åœ¨é¼ æ ‡ä¸æ»šåŠ¨æ¡ä¸åŒæ­¥çš„ bug</p>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>åŠŸèƒ½ä¸°å¯Œï¼Œè‡ªé€‚åº”é«˜åº¦æ–¹é¢çš„å¤„ç†æ€§èƒ½ä¸è¡Œï¼ˆå°è¯•è€ƒè™‘prï¼‰ï¼Œé¡¹ç›®ç»“æ„è¾ƒå·®ä¸æ˜“ç»´æŠ¤</p>
<p>ä¸å»ºè®®ä½¿ç”¨</p>
<h2 id="react-window"><a href="#react-window" class="headerlink" title="react-window"></a>react-window</h2><p>æä¾›å››ç§ç»„ä»¶ï¼š </p>
<ul>
<li>FixedSizeList</li>
<li>FixedSizeGrid</li>
<li>VariableSizeList</li>
<li>VariableSizeGrid</li>
</ul>
<p>ä¸æ”¯æŒè‡ªé€‚åº”é«˜åº¦</p>
<p>grid ä¸åˆ†æäº†ï¼Œ FixedSizeList å°±æ˜¯æœ€ç®€å•çš„å›ºå®šé«˜åº¦çš„æƒ…æ™¯ï¼Œåšæ³•éƒ½ä¸€æ ·ï¼Œæˆ‘ä»¬ç›´æ¥åˆ†æ VariableSizeList</p>
<blockquote>
<p>å…ˆåä¸ªæ§½ï¼Œ react-window ä¸ºäº†å¤ç”¨ï¼Œä»£ç å°è£…äº†ä¸€å±‚åˆä¸€å±‚ï¼Œrender è¿˜æ˜¯ç”¨çš„ createElement â€¦ çœ‹æºç çš„æ—¶å€™å®åœ¨éš¾å—ï¼Œè€Œä¸”è¿˜æ˜¯ç”¨ flow å†™çš„ï¼Œç¼–è¾‘å™¨å„ç§æŠ¥é”™</p>
</blockquote>
<p>ä¸çŸ¥é“ä»€ä¹ˆåŸå› ï¼Œä¾èµ–å®‰è£…çš„æ—¶å€™ä¸€ç›´å¤±è´¥ï¼Œæœ¬åœ°æ²¡æœ‰å¯åŠ¨èµ·æ¥ï¼Œè¿™æ¬¡æ˜¯ç›´æ¥çœ‹çš„æºç </p>
<h3 id="æ¸²æŸ“-1"><a href="#æ¸²æŸ“-1" class="headerlink" title="æ¸²æŸ“"></a>æ¸²æŸ“</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"&#123;&#123;position: 'relative', height: `$&#123;height&#125;px`, overflow: 'auto'&#125;&#125;"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"&#123;&#123;height: `$&#123;totalSize&#125;px`, width: '100%'&#125;&#125;"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"position: absolute; left: 0px; top: 38px; height: 30px; width: 100%;"</span>&gt;</span></span><br><span class="line">      Row 1</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"position: absolute; left: 0px; top: 68px; height: 65px; width: 100%;"</span>&gt;</span></span><br><span class="line">      Row 2</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    ....</span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"position: absolute; left: 0px; top: 133px; height: 70px; width: 100%;"</span>&gt;</span></span><br><span class="line">      Row 3</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä¾ç„¶æ˜¯ç”¨ä¸€ä¸ª totalSize é«˜åº¦çš„å®¹å™¨å»äº§ç”Ÿè¿›åº¦æ¡ï¼Œæ¯ä¸ªåˆ—è¡¨é¡¹é€šè¿‡ç»å¯¹å®šä½è¿›è¡Œåç§»</p>
<p>è¿™é‡Œå…¶å®ç”¨ <code>transform: translateY</code> æ•ˆæœä¸€æ ·çš„ï¼Œå½“ç„¶æ¸²æŸ“ä¸Šçš„æ€§èƒ½å·®å¼‚æˆ‘å°±ä¸çŸ¥é“äº†</p>
<h3 id="è®¡ç®—-1"><a href="#è®¡ç®—-1" class="headerlink" title="è®¡ç®—"></a>è®¡ç®—</h3><p>å’Œè¿™ç¯‡æ–‡ç« çš„å®ç°ä¸€è‡´ â€“ <a href="https://zhuanlan.zhihu.com/p/34585166" target="_blank" rel="noopener">å†è°ˆå‰ç«¯è™šæ‹Ÿåˆ—è¡¨çš„å®ç°</a></p>
<blockquote>
<p>è²Œä¼¼å¯¹æŒ‡æ•°æœç´¢æœ‰è¯¯è§£ï¼Ÿ</p>
</blockquote>
<p>è®¾ lastMeasureItem ä¸ºå·²æµ‹é‡çš„æœ€è¿œå…ƒç´ ï¼Œ</p>
<p>lastMeasureItem.offset ä¸ºè¯¥å…ƒç´ çš„åç§»å€¼</p>
<p>lastMeasureItem.index ä¸ºè¯¥å…ƒç´ çš„ç´¢å¼•</p>
<p>åˆ—è¡¨æ€»é«˜åº¦ = lastMeasureItem.offset + æœªæµ‹é‡å…ƒç´  * é»˜è®¤é«˜åº¦</p>
<p>åˆæ¬¡æ»šåŠ¨ï¼Œä»ç¬¬0é¡¹å¼€å§‹æµ‹é‡å¹¶ç¼“å­˜å·²æ»šåŠ¨è¿‡çš„å…ƒç´ çš„åç§»å’Œç´¢å¼•ï¼Œæ›´æ–° lastMeasureItem</p>
<blockquote>
<p>O(n) æ—¶é—´å¤æ‚åº¦</p>
</blockquote>
<p>å½“æ»šåŠ¨åç§»å€¼å°äº <code>lastMeasureItem.offset</code> æ—¶ï¼Œè¡¨ç¤ºèµ·å§‹é¡¹åœ¨ 0~lastMeasureItem.index èŒƒå›´ä¹‹é—´ï¼Œç”±äºè¯¥èŒƒå›´æ‰€æœ‰åˆ—è¡¨é¡¹åç§»å€¼éƒ½è®¡ç®—è¿‡äº†ï¼Œæ­¤æ—¶é‡‡ç”¨äºŒåˆ†å³å¯å¿«é€Ÿå¾—åˆ°èµ·å§‹é¡¹ç´¢å¼•</p>
<blockquote>
<p>O(logn)</p>
</blockquote>
<p>å½“æ»šåŠ¨åç§»å€¼å°äº <code>lastMeasureItem.offset</code> æ—¶ï¼Œåˆ™ä»¥ <code>lastMeasureItem.index</code> å¼€å§‹æµ‹é‡å¹¶ç¼“å­˜å·²æ»šåŠ¨è¿‡çš„å…ƒç´ çš„åç§»å’Œç´¢å¼•ï¼Œæ›´æ–° lastMeasureItem</p>
<blockquote>
<p>O(n) æ—¶é—´å¤æ‚åº¦</p>
</blockquote>
<p>Watch è§‚å¯Ÿ lastMeasureItem.index ï¼Œè‹¥æ”¹å˜ï¼Œåˆ™åˆ—è¡¨æ€»é«˜åº¦è·Ÿç€å˜</p>
<p><a href="https://jsfiddle.net/furybean/teg2ur1b/1/" target="_blank" rel="noopener">åœ¨çº¿ Demo</a></p>
<p>æœ¬æ–¹æ¡ˆæœ‰ä¸¤ä¸ªç¼ºç‚¹ï¼š</p>
<ul>
<li>æ‹“å±•å·®ï¼Œåšä¸äº†è‡ªé€‚åº”é«˜åº¦</li>
<li>å‰é¢çš„æ»šåŠ¨è¾ƒè€—æ—¶é—´ï¼ŒæŠŠæ²¡ç”¨åˆ°çš„ä¹Ÿè®¡ç®—è¿›å»äº†</li>
</ul>
<h3 id="å¥å£®-1"><a href="#å¥å£®-1" class="headerlink" title="å¥å£®"></a>å¥å£®</h3><p>ç”±äºè¿›åº¦æ¡é«˜åº¦ä¼šå˜åŒ–ï¼Œå› æ­¤å­˜åœ¨é¼ æ ‡ä¸æ»šåŠ¨æ¡ä¸åŒæ­¥çš„ bug</p>
<h3 id="æ€»ç»“-1"><a href="#æ€»ç»“-1" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>ä¸æ”¯æŒè‡ªé€‚åº”é«˜åº¦ï¼Œæ€§èƒ½ä¸è¡Œï¼Œä¸æ˜¯ react é•¿åˆ—è¡¨çš„é¦–é€‰æ–¹æ¡ˆ</p>
<p>å¦‚æœæœ‰ç”¨åˆ° Grid çš„è¯å¯ä»¥ç”¨</p>
<h2 id="virtual-list"><a href="#virtual-list" class="headerlink" title="virtual-list"></a>virtual-list</h2><p><a href="https://github.com/react-component/virtual-list" target="_blank" rel="noopener">é¡¹ç›®åœ°å€</a></p>
<blockquote>
<p>ç›®å‰åˆ†æç»¼åˆè¯„åˆ†æœ€é«˜çš„ä¸€ä¸ª</p>
</blockquote>
<p>æ”¯æŒè‡ªé€‚åº”é«˜åº¦ï¼Œæ”¯æŒåŠ¨ç”»æ•ˆæœï¼Œæ”¯æŒæ»šåŠ¨ä½ç½®å¤åŸ</p>
<h3 id="æ¸²æŸ“-2"><a href="#æ¸²æŸ“-2" class="headerlink" title="æ¸²æŸ“"></a>æ¸²æŸ“</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- ç”¨æˆ·å¯è§çš„å®¹å™¨é«˜åº¦å¯èƒ½åªæœ‰ 300px --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span></span></span><br><span class="line"><span class="tag">  <span class="attr">class</span>=<span class="string">"container"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">style</span>=<span class="string">"width: 200px; height: 300px;"</span></span></span><br><span class="line"><span class="tag">  @<span class="attr">scroll.passive</span>=<span class="string">"handleScroll"</span></span></span><br><span class="line"><span class="tag">&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- æ€»çš„åˆ—è¡¨ div ï¼Œç”¨äºæ’‘èµ·åˆ—è¡¨çš„é«˜åº¦ --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span></span></span><br><span class="line"><span class="tag">    <span class="attr">class</span>=<span class="string">"total-list"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:style</span>=<span class="string">"&#123;</span></span></span><br><span class="line"><span class="tag"><span class="string">      height: `$&#123;itemHeight * data.length&#125;px`,</span></span></span><br><span class="line"><span class="tag"><span class="string">    &#125;"</span></span></span><br><span class="line"><span class="tag">  &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span></span></span><br><span class="line"><span class="tag">      <span class="attr">class</span>=<span class="string">"visible-list"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:style</span>=<span class="string">"&#123;</span></span></span><br><span class="line"><span class="tag"><span class="string">      transform: `translateY($&#123;topHeight&#125;px)`,</span></span></span><br><span class="line"><span class="tag"><span class="string">    &#125;"</span></span></span><br><span class="line"><span class="tag">    &gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span></span></span><br><span class="line"><span class="tag">        <span class="attr">v-for</span>=<span class="string">"item in visibleList"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">:key</span>=<span class="string">"item.id"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">"visible-list-item"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">:style</span>=<span class="string">"&#123;</span></span></span><br><span class="line"><span class="tag"><span class="string">        height: `$&#123;itemHeight&#125;px`,</span></span></span><br><span class="line"><span class="tag"><span class="string">      &#125;"</span></span></span><br><span class="line"><span class="tag">      &gt;</span>&#123;&#123; item.value &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- æ­¤å¤„åªéœ€æ¸²æŸ“å¯è§åˆ—è¡¨å³å¯ï¼Œæ— éœ€æ¸²æŸ“å…¨éƒ¨æ•°æ® --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>å’Œä¸Šé¢çš„æ–¹æ¡ˆä¸ä¸€æ ·ï¼Œè¿™é‡Œæ˜¯åˆ›å»ºäº†ä¸€ä¸ª total-list çš„å®¹å™¨ï¼Œç›´æ¥å¯¹è¿™ä¸ªå®¹å™¨è¿›è¡Œ translateY åç§»</p>
<h3 id="è®¡ç®—-2"><a href="#è®¡ç®—-2" class="headerlink" title="è®¡ç®—"></a>è®¡ç®—</h3><p>æ€»é«˜åº¦å§‹ç»ˆå›ºå®šï¼Œç­‰äº <code>åˆ—è¡¨é¡¹ä¸ªæ•°(itemCount) * åˆ—è¡¨é¡¹æœ€å°é«˜åº¦(itemHeight)</code></p>
<p>å¤„ç†é€»è¾‘å¦‚ä¸‹ï¼š</p>
<ol>
<li>æ»šåŠ¨ï¼Œç¡®å®šå®šä½é¡¹å’Œèµ·æ­¢é¡¹</li>
<li>æ¸²æŸ“èµ·æ­¢åˆ—è¡¨é¡¹</li>
<li>åˆ—è¡¨é¡¹æ¸²æŸ“å®Œæ¯•ï¼Œè®¡ç®—å¹¶è°ƒæ•´èµ·å§‹é¡¹åç§»ä½ç½®</li>
<li>è¿›è¡Œé‡æ¸²æŸ“</li>
</ol>
<blockquote>
<p>æ³¨æ„ï¼šæ­¤å¤„çš„æ¸²æŸ“è¡¨ç¤ºå¯¹ dom è¿›è¡Œæ“ä½œï¼Œä»å¤„äºå®ä»»åŠ¡ï¼Œè¿˜æœªåˆ°æµè§ˆå™¨å®é™…æ¸²æŸ“(UI Render)é˜¶æ®µ</p>
</blockquote>
<p><strong>æ ¸å¿ƒæ€æƒ³æ˜¯ä»»æ„é«˜åº¦çš„åˆ—è¡¨é¡¹éƒ½å æ®ç›¸åŒçš„æ»šåŠ¨æ¡èŒƒå›´</strong></p>
<h4 id="â‘ -ç¡®å®šå®šä½é¡¹å’Œèµ·æ­¢é¡¹"><a href="#â‘ -ç¡®å®šå®šä½é¡¹å’Œèµ·æ­¢é¡¹" class="headerlink" title="â‘  ç¡®å®šå®šä½é¡¹å’Œèµ·æ­¢é¡¹"></a>â‘  ç¡®å®šå®šä½é¡¹å’Œèµ·æ­¢é¡¹</h4><p>å®šä½é¡¹ä¸æ»šåŠ¨æ¡ä½ç½®å¯¹åº”ï¼Œå¯ä»¥ç†è§£ä¸ºæ»šåŠ¨æ¡æ°´å¹³æ–¹å‘æŒ‡å‘çš„é‚£ä¸ªåˆ—è¡¨é¡¹ã€‚</p>
<p>å½“æ»šåŠ¨æ¡ä¸º0æ—¶ï¼ŒæŒ‡å‘ç¬¬0é¡¹ï¼Œæ­¤æ—¶å®šä½é¡¹ä¸ºç¬¬0é¡¹</p>
<p>å½“æ»šåŠ¨æ¡å¤„äºæœ€å¤§å€¼æ—¶ï¼ŒæŒ‡å‘æœ€åä¸€é¡¹ï¼Œæ­¤æ—¶å®šä½é¡¹ä¸ºæœ€åä¸€é¡¹</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> itemCount = <span class="keyword">this</span>.data.length</span><br><span class="line"><span class="keyword">const</span> scrollTopMax = scrollHeight - clientHeight</span><br><span class="line"><span class="comment">/** è¿›åº¦æ¡æ»šåŠ¨ç™¾åˆ†æ¯” */</span></span><br><span class="line"><span class="keyword">const</span> scrollPtg = scrollTop / scrollTopMax</span><br><span class="line"><span class="comment">/** ç¡®å®šå®šä½é¡¹ */</span></span><br><span class="line"><span class="keyword">const</span> itemIndex = <span class="built_in">Math</span>.floor(scrollPtg * itemCount);</span><br><span class="line"><span class="comment">/** å¯è§åˆ—è¡¨é¡¹ä¸ªæ•° = å¯è§å®¹å™¨é«˜åº¦ / æ¯ä¸ªåˆ—è¡¨é¡¹é«˜åº¦ ï¼Œè®°å¾—å‘ä¸Šå–æ•´ */</span></span><br><span class="line"><span class="keyword">const</span> visibleCount = <span class="built_in">Math</span>.ceil(<span class="keyword">this</span>.$el.clientHeight / <span class="keyword">this</span>.itemHeight)</span><br><span class="line"><span class="comment">/** ç¡®å®šèµ·å§‹é¡¹å’Œç»“æŸé¡¹ */</span></span><br><span class="line"><span class="keyword">const</span> startIndex = <span class="built_in">Math</span>.max(<span class="number">0</span>, itemIndex - <span class="built_in">Math</span>.ceil(scrollPtg * visibleCount))</span><br><span class="line"><span class="keyword">const</span> endIndex = <span class="built_in">Math</span>.min(itemCount - <span class="number">1</span>, itemIndex + <span class="built_in">Math</span>.ceil((<span class="number">1</span> - scrollPtg) * visibleCount))</span><br></pre></td></tr></table></figure>


<h4 id="â‘¡-æ¸²æŸ“åˆ—è¡¨é¡¹"><a href="#â‘¡-æ¸²æŸ“åˆ—è¡¨é¡¹" class="headerlink" title="â‘¡ æ¸²æŸ“åˆ—è¡¨é¡¹"></a>â‘¡ æ¸²æŸ“åˆ—è¡¨é¡¹</h4><p>æ¸²æŸ“ startIndex ~ endIndex çš„åˆ—è¡¨é¡¹</p>
<h4 id="â‘¢-è°ƒæ•´-offset"><a href="#â‘¢-è°ƒæ•´-offset" class="headerlink" title="â‘¢ è°ƒæ•´ offset"></a>â‘¢ è°ƒæ•´ offset</h4><p>åœ¨åˆ—è¡¨é¡¹æ¸²æŸ“å®Œæ¯•åï¼Œè§¦å‘ update å›è°ƒ </p>
<p>è·å–å¹¶ç»Ÿè®¡ startIndex ~ itemIndex åˆ—è¡¨é¡¹çš„å®é™…æ€»é«˜åº¦ s2iHeight</p>
<p>è®¡ç®—èµ·å§‹é¡¹åç§»é«˜åº¦ startItemTop ,å¦‚ä¸‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> startItemTop = å®šä½é¡¹ç»å¯¹é«˜åº¦(itemAbsoluteTop) - èµ·å§‹é¡¹è‡³å®šä½é¡¹çš„é«˜åº¦(s2iHeight)</span><br><span class="line"><span class="keyword">const</span> itemAbsoluteTop = scrollTop + å®šä½é¡¹ç›¸å¯¹è§†å£é«˜åº¦(itemRelativeTop)</span><br><span class="line"><span class="keyword">const</span> itemRelativeTop = æ»šåŠ¨è¿‡çš„è§†å£é«˜åº¦(scrollPtg * clientHeight) - å®šä½é¡¹åç§»é«˜åº¦(itemOffsetPtg * itemHeight)</span><br></pre></td></tr></table></figure>

<p>å¦‚å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/9277731-629e103e1290b5c8.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h3 id="å¥å£®-2"><a href="#å¥å£®-2" class="headerlink" title="å¥å£®"></a>å¥å£®</h3><p><strong>ç”±äºæ€»é«˜åº¦å›ºå®šï¼Œä¸å­˜åœ¨é¼ æ ‡å’Œæ»šåŠ¨æ¡ä¸åŒæ­¥çš„é—®é¢˜</strong></p>
<h3 id="æ€»ç»“-2"><a href="#æ€»ç»“-2" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>æ€§èƒ½ä¼˜å¼‚ï¼Œé€šè¿‡å‡ ä¸ªæ•°å­¦å…¬å¼å³å¯ç¡®å®šèµ·æ­¢ä½ç½®ï¼ˆè¿˜æœ‰ä¼˜åŒ–çš„ç©ºé—´ï¼‰</p>
<p>è‹¥éœ€è¦è‡ªé€‚åº”é«˜åº¦ï¼Œåˆ™éœ€è¦è¿›è¡Œ2æ¬¡renderï¼Œå¦åˆ™ç¬¬ä¸€æ¬¡renderå³å¯è®¡ç®—åç§»ä½ç½®</p>
<p>ç›®å‰<strong>å”¯ä¸€</strong>ä¸€ç§ä¸äº§ç”Ÿé¼ æ ‡å’Œæ»šåŠ¨æ¡ä¸åŒæ­¥é—®é¢˜çš„æ–¹æ¡ˆ</p>
<p>æ‹“å±•æ€§å¼ºï¼Œæ¯•ç«Ÿåé¢æ˜¯ Ant Design 4 çš„æ ¸å¿ƒç»„ä»¶ä¹‹ä¸€</p>
<p>react é•¿åˆ—è¡¨é¦–é€‰æ–¹æ¡ˆ</p>
<p>vue å¯ä»¥å°è¯•é€ ä¸ªè½®å­</p>
<h2 id="å…¶ä»–å¤„ç†æ–¹æ¡ˆ"><a href="#å…¶ä»–å¤„ç†æ–¹æ¡ˆ" class="headerlink" title="å…¶ä»–å¤„ç†æ–¹æ¡ˆ"></a>å…¶ä»–å¤„ç†æ–¹æ¡ˆ</h2><p>æœ¬èŠ‚ä¸ºå…¶ä»–ä¸€äº›é•¿åˆ—è¡¨çš„å¤„ç†æ–¹æ¡ˆï¼Œä¸»è¦è¡¨ç°åœ¨èµ·å§‹é¡¹æŸ¥æ‰¾å’Œæ›´æ–°åˆ—è¡¨é«˜åº¦æ–¹é¢çš„ä¸åŒ</p>
<p>è¿™é‡Œæåˆ°çš„å‡ ç§æ–¹æ¡ˆï¼Œéƒ½ä¼šå‡ºç° <em>é¼ æ ‡å’Œæ»šåŠ¨æ¡ä¸åŒæ­¥</em> çš„é—®é¢˜</p>
<h3 id="â‘ -é¡ºåºæŸ¥æ‰¾ï¼Œå·®é‡æ›´æ–°æ€»é«˜åº¦"><a href="#â‘ -é¡ºåºæŸ¥æ‰¾ï¼Œå·®é‡æ›´æ–°æ€»é«˜åº¦" class="headerlink" title="â‘  é¡ºåºæŸ¥æ‰¾ï¼Œå·®é‡æ›´æ–°æ€»é«˜åº¦"></a>â‘  é¡ºåºæŸ¥æ‰¾ï¼Œå·®é‡æ›´æ–°æ€»é«˜åº¦</h3><blockquote>
<p>æ€§èƒ½è¾ƒå·®çš„ä¸€ç§æ–¹æ¡ˆ</p>
</blockquote>
<p>å®šä¹‰æ•°ç»„ itemHeightRecord è®°å½•åˆ—è¡¨é¡¹å®é™…é«˜åº¦ï¼Œå¯ä»¥æ˜¯è‡ªé€‚åº”è®¡ç®—å‡ºæ¥çš„é«˜åº¦ï¼Œä¹Ÿå¯ä»¥æ˜¯å®šä¹‰é«˜åº¦æ–¹æ³•è®¡ç®—å¾—åˆ°çš„é«˜åº¦</p>
<p>ä¸€å¼€å§‹ï¼Œåˆ—è¡¨æ€»é«˜åº¦ = åˆ—è¡¨é¡¹ä¸ªæ•° * é»˜è®¤é«˜åº¦</p>
<p>æŸ¥æ‰¾èµ·å§‹é¡¹ï¼Œç”±äºæ²¡æœ‰è®°å½•åç§»å€¼ï¼Œåªèƒ½é‡‡ç”¨é¡ºåºå åŠ çš„æ–¹å¼åˆ¤æ–­ï¼Œ itemHeightRecord ä¸­æœ‰å€¼çš„å–å€¼ï¼Œæ²¡å€¼çš„å–é»˜è®¤é«˜åº¦</p>
<blockquote>
<p>æ—¶é—´å¤æ‚åº¦ O(n) </p>
</blockquote>
<p>æ¸²æŸ“åˆ—è¡¨é¡¹ï¼Œå¹¶å°†å–å¾—çš„é«˜åº¦ä¸é»˜è®¤å€¼ä¹‹é—´çš„å·®æ›´æ–°åˆ° <em>åˆ—è¡¨æ€»é«˜åº¦</em> ä¸Šï¼Œå¹¶å¯¹ itemHeightRecord è¿›è¡Œèµ‹å€¼</p>
<p><em>ç¼ºç‚¹ï¼šæŸ¥æ‰¾èµ·å§‹é¡¹çš„æ•ˆç‡å¤ªä½</em></p>
<h3 id="â‘¡-äºŒåˆ†æŸ¥æ‰¾ï¼Œé¡ºåºæ›´æ–°åç§»å€¼"><a href="#â‘¡-äºŒåˆ†æŸ¥æ‰¾ï¼Œé¡ºåºæ›´æ–°åç§»å€¼" class="headerlink" title="â‘¡ äºŒåˆ†æŸ¥æ‰¾ï¼Œé¡ºåºæ›´æ–°åç§»å€¼"></a>â‘¡ äºŒåˆ†æŸ¥æ‰¾ï¼Œé¡ºåºæ›´æ–°åç§»å€¼</h3><p>æ€è·¯æ¥æºäº <a href="https://juejin.im/post/5db684ddf265da4d495c40e5" target="_blank" rel="noopener">ã€Œå‰ç«¯è¿›é˜¶ã€é«˜æ€§èƒ½æ¸²æŸ“åä¸‡æ¡æ•°æ®(è™šæ‹Ÿåˆ—è¡¨)</a> ï¼Œå¹¶å¯¹æ›´æ–°åç§»å€¼è¿›è¡Œä¼˜åŒ–</p>
<p>éœ€è¦é…ç½®æ•°æ®é¡¹æœ€å°é«˜åº¦ï¼Œå¹¶æ ¹æ®è¿™ä¸ªå€¼åˆå§‹åŒ–æ¯ä¸ªæ•°æ®é¡¹çš„é«˜åº¦å’Œåç§»å€¼ â€“ sizes</p>
<p>åˆ—è¡¨æ€»é«˜åº¦ = <code>sizes[length-1].offset + sizes[length-1].height</code></p>
<p>æŸ¥æ‰¾èµ·å§‹é¡¹ï¼Œæ ¹æ® sizes è¿›è¡ŒäºŒåˆ†</p>
<blockquote>
<p>æ—¶é—´å¤æ‚åº¦ O(logn)</p>
</blockquote>
<p>æ¸²æŸ“åˆ—è¡¨é¡¹(å‡è®¾æœ‰mé¡¹)ï¼Œå¹¶å°†å–å¾—çš„é«˜åº¦æ›¿æ¢ sizes ä¸­çš„ heightï¼Œå¹¶å°† height ä¸é»˜è®¤å€¼ä¹‹é—´çš„å·®æ›´æ–°åˆ°å…¶åæ¯ä¸€é¡¹çš„ offset </p>
<blockquote>
<p>æ—¶é—´å¤æ‚åº¦ O(n)</p>
</blockquote>
<p>ä¸ vue-virtual-scroller è‡ªé€‚åº”é«˜åº¦çš„å¤„ç†æ–¹å¼ç±»ä¼¼ï¼Œåªä¸è¿‡æˆ‘ä»¬ä»…éœ€è¦ä»èµ·å§‹é¡¹å¼€å§‹å¤„ç†</p>
<p><a href="https://codesandbox.io/s/virtuallist-3-i3h9v" target="_blank" rel="noopener">åœ¨çº¿ Demo</a></p>
<blockquote>
<p>å¼•ç”¨è‡ª ã€Œå‰ç«¯è¿›é˜¶ã€é«˜æ€§èƒ½æ¸²æŸ“åä¸‡æ¡æ•°æ®(è™šæ‹Ÿåˆ—è¡¨) ï¼Œæ›´æ–°åç§»å€¼é‚£è¾¹çš„æ—¶é—´å¤æ‚åº¦ä¸º O(n*m)</p>
</blockquote>
<p><em>ç¼ºç‚¹ï¼šæ›´æ–° sizes è¾ƒä¸ºè€—æ—¶</em></p>
<h3 id="â‘¢-æ ‘çŠ¶æ•°ç»„ä¼˜åŒ–æ›´æ–°åç§»å€¼"><a href="#â‘¢-æ ‘çŠ¶æ•°ç»„ä¼˜åŒ–æ›´æ–°åç§»å€¼" class="headerlink" title="â‘¢ æ ‘çŠ¶æ•°ç»„ä¼˜åŒ–æ›´æ–°åç§»å€¼"></a>â‘¢ æ ‘çŠ¶æ•°ç»„ä¼˜åŒ–æ›´æ–°åç§»å€¼</h3><p>è‡ªå·±æƒ³å‡ºæ¥çš„ä¸€ç§è§£å†³æ–¹æ¡ˆï¼Œèƒ½å¤Ÿè¾¾åˆ°æŸ¥è¯¢å’Œæ›´æ–°éƒ½æ˜¯ <code>O(logn)</code> æ—¶é—´å¤æ‚åº¦</p>
<p>åœ¨æœªçœ‹ <a href="https://github.com/react-component/virtual-list" target="_blank" rel="noopener">virtual-list</a> çš„æ–¹æ¡ˆå‰ï¼Œæˆ‘ä¸€åº¦ä»¥ä¸ºè¿™æ˜¯æœ€å¥½çš„æ–¹æ¡ˆ</p>
<blockquote>
<p>æ•ˆç‡ä¸Šä¸¤è€…å·®ä¸å¤šï¼Œä¸è¿‡æœ¬æ–¹æ¡ˆä¼šæœ‰ <em>é¼ æ ‡å’Œæ»šåŠ¨æ¡ä¸åŒæ­¥</em> çš„é—®é¢˜</p>
</blockquote>
<p>æˆ‘ä»¬å…ˆå»ºç«‹æ•°æ®æ¨¡å‹ï¼Œåˆ—è¡¨é¡¹çš„é«˜åº¦åˆ—è¡¨ä¸ºé•¿åº¦ä¸º len çš„æ­£æ•°æ•°ç»„ nums ï¼Œæœ‰ä¸¤ç§æ“ä½œï¼š</p>
<ol>
<li>æ›´æ–°æ•°ç»„ä¸­æŸé¡¹çš„å€¼</li>
<li>æ‰¾åˆ°ä¸€ä¸ªæœ€å°çš„ nï¼Œå‰ n é¡¹æ€»å’Œå¤§äºç­‰äºç›®æ ‡å€¼ target ï¼Œ 1&lt;= n &lt;= len</li>
</ol>
<p>å¾ˆæ˜æ˜¾è¿™æ˜¯ä¸€ä¸ªæ ‘çŠ¶æ•°ç»„æ¨¡æ¿é¢˜ï¼Œä¸¤ä¸ªæ“ä½œéƒ½æ˜¯ O(logn) çš„æ—¶é—´å¤æ‚åº¦ï¼Œæ¨¡æ¿å¯ä»¥å‚è€ƒæˆ‘å†™çš„ <a href="https://github.com/francecil/LearningWeb/blob/master/source/_posts/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E6%A0%91%E7%8A%B6%E6%95%B0%E7%BB%84/%E5%9F%BA%E7%A1%80%E6%A8%A1%E6%9D%BF.js" target="_blank" rel="noopener">BinaryIndexedTree</a></p>
<blockquote>
<p>å…³äºæ ‘çŠ¶æ•°ç»„åŸç†å¯ä»¥å‚è€ƒæ–‡ç«  â€“ <a href="http://hawstein.com/2012/11/15/binary-indexed-trees/" target="_blank" rel="noopener">æ ‘çŠ¶æ•°ç»„(Binary Indexed Trees)</a></p>
</blockquote>
<p>æä¾›äº†å‡ ä¸ªæ–¹æ³•</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">findGe</span>(<span class="params">target</span>) </span>&#123;&#125; <span class="comment">//æ‰¾åˆ°æœ€å°çš„ä¸€ä¸ªnï¼Œå…¶å‰né¡¹å’Œå¤§äºç­‰äº target</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">update</span> (<span class="params">i, val</span>) </span>&#123;&#125; <span class="comment">// ç¬¬ i é¡¹å¢åŠ å·®å€¼val, 1&lt;=i&lt;=len</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">prefixSum</span> (<span class="params">n = this.tree.length - <span class="number">1</span></span>) </span>&#123;&#125; <span class="comment">//è®¡ç®—å‰ n é¡¹çš„å’Œ , 1&lt;=n&lt;=len</span></span><br></pre></td></tr></table></figure>

<p>æŸ¥æ‰¾èµ·å§‹é¡¹å¯ä»¥é‡‡ç”¨ findGe, æŸ¥æ‰¾èµ·å§‹é¡¹åç§»ä½ç½®ä»¥åŠåˆ—è¡¨æ€»é«˜åº¦å¯ä»¥ç”¨ prefixSum, æ›´æ–°åç§»å€¼é‡‡ç”¨ update</p>
<p>æµ‹è¯•æ•ˆæœï¼š10W æ¡æ•°æ®æ»šåŠ¨æ—¶å¤„ç†çš„è®¡ç®—æ—¶é—´åœ¨ 1ms å·¦å³</p>
<p>æ„Ÿå…´è¶£çš„å¯ä»¥çœ‹æˆ‘çš„å¼€æºåº“ <a href="https://github.com/francecil/virtual-list-demo" target="_blank" rel="noopener">virtual-list-demo</a></p>
<h3 id="å›æµä¼˜åŒ–"><a href="#å›æµä¼˜åŒ–" class="headerlink" title="å›æµä¼˜åŒ–"></a>å›æµä¼˜åŒ–</h3><p>å¯è§†åŒºåŸŸçš„åˆ—è¡¨é«˜åº¦ï¼Œä¸€èˆ¬ä¸å˜ï¼Œæ²¡å¿…è¦æ¯æ¬¡éƒ½é€šè¿‡ <code>$el.clientHeight</code> è·å–ï¼ˆä¼šé€ æˆå›æµï¼‰ï¼Œåœ¨ resize æ—¶å†æ”¹å˜</p>
<p>å¦‚æœæ˜¯è‡ªé€‚åº”é«˜åº¦ï¼Œé‚£æœ¬æ“ä½œå¯æœ‰å¯æ— </p>
<h2 id="ç»¼åˆå®ç°"><a href="#ç»¼åˆå®ç°" class="headerlink" title="ç»¼åˆå®ç°"></a>ç»¼åˆå®ç°</h2><p>æœ¬æ¥æ‰“ç®—å•ç‹¬å†™ä¸€èŠ‚çš„ï¼Œæœ€åå†³å®šé‡‡ç”¨ virtual-list çš„è®¾è®¡æ–¹å¼</p>
<p>åˆ—è¡¨é¡¹é‡‡ç”¨ <code>Render Props</code> çš„å½¢å¼ï¼Œç”¨ cloneElement ç”Ÿæˆå®é™…åˆ—è¡¨é¡¹ã€‚</p>
<p>æ— è®ºæ˜¯è‡ªé€‚åº”é«˜åº¦è¿˜æ˜¯å›ºå®šé«˜åº¦ï¼Œéƒ½æ˜¯é€šè¿‡å‚æ•°é…ç½®ï¼Œå¯¹å¤–ä»…æä¾›ä¸€ä¸ªç»„ä»¶</p>
<h2 id="å±•æœ›"><a href="#å±•æœ›" class="headerlink" title="å±•æœ›"></a>å±•æœ›</h2><h3 id="æµè§ˆå™¨å…¼å®¹æ€§æµ‹è¯•"><a href="#æµè§ˆå™¨å…¼å®¹æ€§æµ‹è¯•" class="headerlink" title="æµè§ˆå™¨å…¼å®¹æ€§æµ‹è¯•"></a>æµè§ˆå™¨å…¼å®¹æ€§æµ‹è¯•</h3><p>ä¸ªäººæ–¹æ¡ˆä»…æµ‹è¯•äº† chrome ï¼Œè¿˜æ²¡æµ‹è¯•è¿‡å…¶ä»–æµè§ˆå™¨ï¼Œçœ‹å¼€æºåº“çš„æ—¶å€™æœ‰çœ‹åˆ°å…¶åšäº†ä¸€äº›å…¼å®¹å¤„ç†</p>
<p>æ¯”å¦‚ç«ç‹æ»šåŠ¨ç™½å±é—®é¢˜ï¼ŒSafari scrollTop å¯èƒ½ä¸ºè´Ÿçš„é—®é¢˜ï¼Œç§»åŠ¨ç«¯å¡é¡¿çš„é—®é¢˜</p>
<p>ç¯‡å¹…æœ‰é™ï¼Œè¿™äº›ä¸åœ¨æœ¬æ–‡çš„ç ”ç©¶èŒƒå›´ï¼Œå»ºè®®å°±æ˜¯ç”Ÿäº§ç¯å¢ƒå°½é‡ç”¨å¼€æºåº“</p>
<h3 id="å›¾ç‰‡è‡ªé€‚åº”é«˜åº¦"><a href="#å›¾ç‰‡è‡ªé€‚åº”é«˜åº¦" class="headerlink" title="å›¾ç‰‡è‡ªé€‚åº”é«˜åº¦"></a>å›¾ç‰‡è‡ªé€‚åº”é«˜åº¦</h3><p>è‹¥åˆ—è¡¨é¡¹é«˜åº¦æ˜¯ä¾èµ–äºå›¾ç‰‡é«˜åº¦çš„ï¼Œç”±äºå›¾ç‰‡åŠ è½½è¾ƒæ…¢ï¼Œåœ¨åˆæ¬¡æ¸²æŸ“ç»“æŸæ—¶ï¼ˆupdateç”Ÿå‘½å‘¨æœŸä¸­ï¼‰å¹¶è·å–ä¸åˆ°çœŸå®åˆ—è¡¨é«˜åº¦ï¼Œéœ€è¦ç­‰å¾…å›¾ç‰‡åŠ è½½å®Œæ¯•åè®¡ç®—</p>
<p>å…·ä½“åšæ³•å°±æ˜¯é‡‡ç”¨ ResizeObserver API ï¼Œä¸è¿‡è¿™ä¸ªå…¼å®¹æ€§æœ‰ç‚¹é—®é¢˜ï¼Œ</p>
<p>vue-virtual-scroller ä¸­å…¶å®æœ‰ç”¨åˆ°äº†ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥å‚è€ƒä¸€ä¸‹</p>
<h3 id="å“åº”é”®ç›˜äº‹ä»¶"><a href="#å“åº”é”®ç›˜äº‹ä»¶" class="headerlink" title="å“åº”é”®ç›˜äº‹ä»¶"></a>å“åº”é”®ç›˜äº‹ä»¶</h3><p>é€šè¿‡æ–¹å‘é”®åˆ‡æ¢åˆ—è¡¨é¡¹ï¼Œéœ€è¦æ‹¦æˆªé”®ç›˜é»˜è®¤äº‹ä»¶ï¼Œå¹¶èµ‹å€¼ scrollTop</p>
<p>è¿™ä¸ªæ›´å¤šçš„æ˜¯åŸºäºé•¿åˆ—è¡¨çš„ Select,Tree ä¸­ä¼šç”¨åˆ°ï¼Œåˆ°æ—¶å€™ç”¨åˆ°å†è¯´</p>
<hr>
<p><a href="https://github.com/francecil/LearningWeb/blob/master/source/_posts/2019Q4/%E5%89%8D%E7%AB%AF%E9%95%BF%E5%88%97%E8%A1%A8%E5%8E%9F%E7%90%86%E5%8F%8A%E4%BC%98%E5%8C%96.md" target="_blank" rel="noopener">åŸæ–‡åœ°å€</a>ï¼Œæ„Ÿå…´è¶£çš„ç»™ä¸ª star ~</p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ol>
<li><a href="https://github.com/ChuChencheng/virtual-list-demo" target="_blank" rel="noopener">virtual-list-demo</a></li>
<li><a href="https://juejin.im/post/5db684ddf265da4d495c40e5" target="_blank" rel="noopener">ã€Œå‰ç«¯è¿›é˜¶ã€é«˜æ€§èƒ½æ¸²æŸ“åä¸‡æ¡æ•°æ®(è™šæ‹Ÿåˆ—è¡¨)</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/34585166" target="_blank" rel="noopener">å†è°ˆå‰ç«¯è™šæ‹Ÿåˆ—è¡¨çš„å®ç°</a></li>
</ol>
]]></content>
      <categories>
        <category>å¤§å‰ç«¯</category>
      </categories>
      <tags>
        <tag>å‰ç«¯ä¼˜åŒ–</tag>
        <tag>é•¿åˆ—è¡¨</tag>
      </tags>
  </entry>
  <entry>
    <title>Promise then åŸç†åˆ†æ</title>
    <url>/2019/12/10/2019Q4/Promise%20then%20%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å…ˆè°ˆè§„èŒƒï¼Œå†åˆ†æ polyfill æºç ï¼Œæœ€åå®ä¾‹è§£æã€‚</p>
<a id="more"></a>

<h2 id="è§„èŒƒ"><a href="#è§„èŒƒ" class="headerlink" title="è§„èŒƒ"></a>è§„èŒƒ</h2><p>è§„èŒƒç›´æ¥å‚è€ƒè¿™è¾¹ï¼š<a href="http://www.ituring.com.cn/article/66566" target="_blank" rel="noopener">ã€ç¿»è¯‘ã€‘Promises/A+è§„èŒƒ</a></p>
<p><strong>è¿”å›å€¼è¿™éƒ¨åˆ†é‡è¦ä¸”æ˜“é”™ï¼Œè¿™é‡Œå•ç‹¬æå‡ºæ¥åˆ†æä¸‹</strong></p>
<p>é¦–å…ˆï¼Œthen æ–¹æ³•å¿…é¡»è¿”å›ä¸€ä¸ª promise å¯¹è±¡</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">promise2 = promise1.then(onFulfilled, onRejected);</span><br></pre></td></tr></table></figure>
<ul>
<li>å¦‚æœ onFulfilled æˆ–è€… onRejected è¿”å›ä¸€ä¸ªå€¼ x ï¼Œåˆ™è¿è¡Œä¸‹é¢çš„ <a href="#promise-solution-process"><strong>Promise è§£å†³è¿‡ç¨‹ï¼š<code>[[Resolve]](promise2, x)</code></strong></a></li>
<li>å¦‚æœ onFulfilled æˆ–è€… onRejected æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ e ï¼Œåˆ™ promise2 å¿…é¡»æ‹’ç»æ‰§è¡Œï¼Œå¹¶è¿”å›æ‹’å›  e</li>
<li>å¦‚æœ onFulfilled ä¸æ˜¯å‡½æ•°ä¸” promise1 æˆåŠŸæ‰§è¡Œï¼Œ promise2 å¿…é¡»æˆåŠŸæ‰§è¡Œå¹¶è¿”å›ç›¸åŒçš„å€¼<blockquote>
<p>e.g.: <code>promise1 = Promise.resolve(1);onFulfilled = 2;</code> <br>åˆ™ <code>promise2 = Promise {&lt;resolved&gt;: 1}</code></p>
</blockquote>
</li>
<li>å¦‚æœ onRejected ä¸æ˜¯å‡½æ•°ä¸” promise1 æ‹’ç»æ‰§è¡Œï¼Œ promise2 å¿…é¡»æ‹’ç»æ‰§è¡Œå¹¶è¿”å›ç›¸åŒçš„æ®å› <blockquote>
<p>e.g.: <code>promise1 = Promise.reject(1);onRejected = 2;</code> <br>åˆ™ <code>promise2 = Promise {&lt;rejected&gt;: 1}</code></p>
</blockquote>
</li>
<li>ä¸è®º promise1 è¢« reject è¿˜æ˜¯è¢« resolve æ—¶ promise2 éƒ½ä¼šè¢« resolveï¼Œåªæœ‰å‡ºç°å¼‚å¸¸æ—¶æ‰ä¼šè¢« rejectedã€‚<blockquote>
<p>e.g.: <code>promise1 = Promise.reject(1);onFulfilled =()=&gt;1; onRejected=()=&gt;2;</code><br>åˆ™ <code>promise2 = Promise {&lt;resolved&gt;: 2}</code>;</p>
<p>e.g.: <code>promise1 = Promise.resolve(1);onFulfilled =()=&gt;{throw new Error(&#39;test&#39;)}; onRejected=(e)=&gt;console.log(e);</code><br>åˆ™ <code>promise2 = Promise {&lt;rejected&gt;: Error: test</code></p>
</blockquote>
</li>
</ul>
<h3 id="Promise-è§£å†³è¿‡ç¨‹-Resolve-promise-x"><a href="#Promise-è§£å†³è¿‡ç¨‹-Resolve-promise-x" class="headerlink" title="Promise è§£å†³è¿‡ç¨‹ [[Resolve]](promise, x)"></a><span id="promise-solution-process"><strong>Promise è§£å†³è¿‡ç¨‹ <code>[[Resolve]](promise, x)</code></strong></span></h3><p>promise ä¸º then å›è°ƒçš„è¿”å›å€¼ï¼Œè¿è¡Œ <code>[[Resolve]](promise, x)</code> éœ€éµå¾ªä»¥ä¸‹æ­¥éª¤ï¼š</p>
<ul>
<li>x ä¸ promise ç›¸ç­‰<blockquote>
<p>å¦‚æœ promise å’Œ x æŒ‡å‘åŒä¸€å¯¹è±¡ï¼Œä»¥ TypeError ä¸ºæ®å› æ‹’ç»æ‰§è¡Œ promise <br>e.g.: <code>test = {};test = Promise.resolve().then(()=&gt;test)</code> <br><code>//Promise {&lt;rejected&gt;: TypeError: Chaining cycle detected for promise #&lt;Promise&gt;}</code></p>
</blockquote>
</li>
<li>x ä¸º Promise<blockquote>
<p>promise æ¥å—xçš„çŠ¶æ€ <br>e.g.: <code>promise2 = Promise.resolve().then(()=&gt;Promise.reject(1))</code> <br><code>//Promise {&lt;rejected&gt;: 1}</code></p>
</blockquote>
</li>
<li><strong>x ä¸ºå¯¹è±¡æˆ–å‡½æ•°</strong><ul>
<li>æŠŠ x.then èµ‹å€¼ç»™ thenã€‚ç”¨å¼•ç”¨ä¿æŒï¼Œé˜²æ­¢å…¶ä»–åœ°æ–¹åˆæ›´æ”¹äº†thençš„å€¼</li>
<li>å¦‚æœå– x.then çš„å€¼æ—¶æŠ›å‡ºé”™è¯¯ e ï¼Œåˆ™ä»¥ e ä¸ºæ®å› æ‹’ç» promise</li>
<li>å¦‚æœ then æ˜¯å‡½æ•°ï¼Œå°† x ä½œä¸ºå‡½æ•°çš„ä½œç”¨åŸŸ this è°ƒç”¨ä¹‹ã€‚ä¼ é€’ä¸¤ä¸ªå›è°ƒå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°å«åš resolvePromise ï¼Œç¬¬äºŒä¸ªå‚æ•°å«åš rejectPromise:<ul>
<li>å¦‚æœ resolvePromise ä»¥å€¼ y ä¸ºå‚æ•°è¢«è°ƒç”¨ï¼Œåˆ™è¿è¡Œ [[Resolve]](promise, y)<blockquote>
<p><code>Promise.resolve().then(()=&gt;({a:1,then:function (res,rej){res(this.a)}}))</code></p>
<p><code>//Promise {&lt;resolved&gt;: 1}</code></p>
</blockquote>
</li>
<li>å¦‚æœ rejectPromise ä»¥æ®å›  r ä¸ºå‚æ•°è¢«è°ƒç”¨ï¼Œåˆ™ä»¥æ®å›  r æ‹’ç» promise<blockquote>
<p><code>Promise.resolve().then(()=&gt;({a:1,then:function (res,rej){rej(this.a)}}))</code></p>
<p><code>//Promise {&lt;rejected&gt;: 1}</code></p>
</blockquote>
</li>
<li>å¦‚æœ resolvePromise å’Œ rejectPromise å‡è¢«è°ƒç”¨ï¼Œæˆ–è€…è¢«åŒä¸€å‚æ•°è°ƒç”¨äº†å¤šæ¬¡ï¼Œåˆ™ä¼˜å…ˆé‡‡ç”¨é¦–æ¬¡è°ƒç”¨å¹¶å¿½ç•¥å‰©ä¸‹çš„è°ƒç”¨</li>
<li>å¦‚æœè°ƒç”¨ then æ–¹æ³•æŠ›å‡ºäº†å¼‚å¸¸ eï¼š<ul>
<li>å¦‚æœ resolvePromise æˆ– rejectPromise å·²ç»è¢«è°ƒç”¨ï¼Œåˆ™å¿½ç•¥ä¹‹</li>
<li>å¦åˆ™ä»¥ e ä¸ºæ®å› æ‹’ç» promise</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>x ä¸ä¸ºå¯¹è±¡æˆ–å‡½æ•°<blockquote>
<p>ä»¥ x ä¸ºå‚æ•°æ‰§è¡Œ promise </p>
</blockquote>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">å¦‚æœä¸€ä¸ª promise è¢«ä¸€ä¸ªå¾ªç¯çš„ thenable é“¾ä¸­çš„å¯¹è±¡è§£å†³ï¼Œè€Œ [[Resolve]](promise, thenable) çš„é€’å½’æ€§è´¨åˆä½¿å¾—å…¶è¢«å†æ¬¡è°ƒç”¨ï¼Œæ ¹æ®ä¸Šè¿°çš„ç®—æ³•å°†ä¼šé™·å…¥æ— é™é€’å½’ä¹‹ä¸­ã€‚ç®—æ³•è™½ä¸å¼ºåˆ¶è¦æ±‚ï¼Œä½†ä¹Ÿé¼“åŠ±æ–½è€…æ£€æµ‹è¿™æ ·çš„é€’å½’æ˜¯å¦å­˜åœ¨ï¼Œè‹¥æ£€æµ‹åˆ°å­˜åœ¨åˆ™ä»¥ä¸€ä¸ªå¯è¯†åˆ«çš„ <span class="built_in">TypeError</span> ä¸ºæ®å› æ¥æ‹’ç» promise</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªç›®å‰è¿˜ä¸çŸ¥é“æ€ä¹ˆå†™æ‰èƒ½äº§ç”Ÿå¾ªç¯çš„ thenable é“¾ - -</p>
<h2 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h2><h3 id="then-æ“ä½œè§£æ"><a href="#then-æ“ä½œè§£æ" class="headerlink" title="then æ“ä½œè§£æ"></a>then æ“ä½œè§£æ</h3><p>å…¨å±€ç»´æŠ¤ä¸€ä¸ª microTask Queue ï¼Œæ¯ä¸ª promise è‡ªèº«ç»´æŠ¤ä¸€ä¸ª queue</p>
<p>å½“ promise æ‰§è¡Œ then æ–¹æ³•æ—¶ï¼š</p>
<ol>
<li>ä»¤ then æ–¹æ³•ä¸­çš„å›è°ƒä¸º resolverï¼Œä»¤ promise çš„å†…éƒ¨å€¼ä¸º outcome</li>
<li>åˆ›å»ºä¸€ä¸ª PENDING çŠ¶æ€çš„ Promise å¯¹è±¡ promise2</li>
<li>å¦‚æœ promise å¤„äº PENDING çŠ¶æ€ï¼Œå°† â€œæ‰§è¡Œ resolver ï¼Œæ”¹å˜ promise2 çŠ¶æ€â€ ä½œä¸ºé˜Ÿåˆ—é¡¹æ”¾å…¥è¯¥ promise å¯¹è±¡è‡ªèº«ç»´æŠ¤çš„ queue</li>
<li>å¦åˆ™å°† â€œæ‰§è¡Œ resolver ï¼Œæ”¹å˜ promise2 çŠ¶æ€â€ ä½œä¸º microTask æ”¾å…¥ microTask Queue</li>
<li>è¿”å› promise2</li>
</ol>
<p>å½“åŒæ­¥ä»£ç æ‰§è¡Œå®Œæ¯•ï¼Œå¼€å§‹æ‰§è¡Œ microTask Queue ä¸­çš„ä»»åŠ¡</p>
<p>æ‰§è¡Œ microTask ï¼š</p>
<ol>
<li>ä»¥ promise çš„å†…éƒ¨å€¼ outcome ä½œä¸ºå‚æ•°æ‰§è¡Œ resolver å¹¶å¾—åˆ°è¿”å›å€¼ returnValue</li>
<li>è‹¥å‡ºç°å¼‚å¸¸ï¼Œå°†å¼‚å¸¸èµ‹å€¼ç»™ returnValue </li>
<li>è‹¥æœªå‡ºç°å¼‚å¸¸ï¼Œå¯¹ returnValue åšäº›å¤„ç†ï¼Œè¿™é‡Œä¸ç»†è®²</li>
<li>ä¿®æ”¹ promise2 çš„çŠ¶æ€ä¸º FULFILLED/REJECTED ï¼Œå¹¶ä¿®æ”¹ promise2 çš„å†…éƒ¨å€¼ outcome ä¸º returnValue</li>
<li>è¯¥ promise2 ç»´æŠ¤çš„ queue ä¸­çš„é˜Ÿåˆ—é¡¹æ”¾å…¥ microTask Queue </li>
</ol>
<p>ä¸æ–­çš„æ‰§è¡Œ microTask ç›´åˆ° microTask Queue ä¸ºç©ºï¼Œä¸€è½® event loop ç»“æŸ</p>
<h2 id="æºç "><a href="#æºç " class="headerlink" title="æºç "></a>æºç </h2><p>å¯¹ <a href="https://github.com/calvinmetcalf/lie" target="_blank" rel="noopener">lie.js</a> (ä¸€ä¸ª Promise polyfill åº“) çš„ä»£ç åšä¸ªç²¾ç®€ï¼Œä»…è€ƒè™‘æ™®é€šçš„ then å›è°ƒå’Œ resolve æ–¹æ³•</p>
<p>ç„¶å microTask ä»»åŠ¡æ‰§è¡Œæ¥å£æˆ‘ä»¬ç›´æ¥ç”¨çš„ setTimeout ï¼Œä¸æ Mutation é‚£äº›å¹ºè›¾å­ï¼Œä»£ç å¦‚ä¸‹</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// immediate.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> scheduleDrain = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  setTimeout(nextTick, <span class="number">0</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> draining;</span><br><span class="line"><span class="keyword">var</span> queue = [];</span><br><span class="line"></span><br><span class="line"><span class="comment">// åœ¨åŒæ­¥ä»£ç  task æ‰§è¡Œä¹‹åï¼Œæ¨¡æ‹Ÿæ¸…ç©º microTask queue</span></span><br><span class="line"><span class="comment">// ç”±äºæ‰§è¡Œè¿‡ç¨‹ä¸­å¯èƒ½æœ‰æ–°çš„ microTask æ‰€ä»¥ç”¨äº†åŒå±‚å¾ªç¯</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">nextTick</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  draining = <span class="literal">true</span>;</span><br><span class="line">  <span class="keyword">var</span> i, oldQueue;</span><br><span class="line">  <span class="keyword">var</span> len = queue.length;</span><br><span class="line">  <span class="keyword">while</span> (len) &#123;</span><br><span class="line">    oldQueue = queue;</span><br><span class="line">    queue = [];</span><br><span class="line">    i = <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">while</span> (++i &lt; len) &#123;</span><br><span class="line">      oldQueue[i]();</span><br><span class="line">    &#125;</span><br><span class="line">    len = queue.length;</span><br><span class="line">  &#125;</span><br><span class="line">  draining = <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">immediate</span>(<span class="params">task</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (queue.push(task) === <span class="number">1</span> &amp;&amp; !draining) &#123;</span><br><span class="line">    scheduleDrain();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Promise ä»£ç å¦‚ä¸‹</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// promise.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// then æ–¹æ³•æ‰§è¡Œæ—¶ä½œä¸ºå‚æ•° resolver å®ä¾‹åŒ– Promise</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">INTERNAL</span> (<span class="params"></span>) </span>&#123; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> REJECTED = <span class="string">'REJECTED'</span>;</span><br><span class="line"><span class="keyword">const</span> FULFILLED = <span class="string">'FULFILLED'</span>;</span><br><span class="line"><span class="keyword">const</span> PENDING = <span class="string">'PENDING'</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Promise</span> (<span class="params">resolver</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> resolver !== <span class="string">'function'</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">'resolver must be a function'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">this</span>.state = PENDING;</span><br><span class="line">  <span class="keyword">this</span>.queue = [];</span><br><span class="line">  <span class="keyword">this</span>.outcome = <span class="keyword">void</span> <span class="number">0</span>;</span><br><span class="line">  <span class="comment">// å¤–éƒ¨é€šè¿‡ new å®ä¾‹åŒ–æ—¶æ‰§è¡Œ</span></span><br><span class="line">  <span class="keyword">if</span> (resolver !== INTERNAL) &#123;</span><br><span class="line">    safelyResolveThenable(<span class="keyword">this</span>, resolver);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">Promise</span>.prototype.then = <span class="function"><span class="keyword">function</span> (<span class="params">onFulfilled, onRejected</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ç‰¹æ®Šå‚æ•°çš„å¤„ç†</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> onFulfilled !== <span class="string">'function'</span> &amp;&amp; <span class="keyword">this</span>.state === FULFILLED ||</span><br><span class="line">    <span class="keyword">typeof</span> onRejected !== <span class="string">'function'</span> &amp;&amp; <span class="keyword">this</span>.state === REJECTED) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// åˆ›å»ºä¸€ä¸ª PENDING çŠ¶æ€çš„ promise</span></span><br><span class="line">  <span class="keyword">var</span> promise = <span class="keyword">new</span> <span class="keyword">this</span>.constructor(INTERNAL);</span><br><span class="line">  <span class="comment">// æ ¹æ®åŸ promise çŠ¶æ€è¿›è¡Œä¸åŒå¤„ç†</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">this</span>.state !== PENDING) &#123;</span><br><span class="line">    <span class="keyword">var</span> resolver = <span class="keyword">this</span>.state === FULFILLED ? onFulfilled : onRejected;</span><br><span class="line">    makeMicroTask(promise, resolver, <span class="keyword">this</span>.outcome);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">this</span>.queue.push(<span class="keyword">new</span> QueueItem(promise, onFulfilled, onRejected));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> promise;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">Promise</span>.resolve = <span class="function"><span class="keyword">function</span> (<span class="params">value</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (value <span class="keyword">instanceof</span> <span class="keyword">this</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> value;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> handleResolve(<span class="keyword">new</span> <span class="keyword">this</span>(INTERNAL), value);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// promsie å†…éƒ¨é˜Ÿåˆ—é¡¹</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">QueueItem</span> (<span class="params">promise, onFulfilled, onRejected</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.promise = promise;</span><br><span class="line">  <span class="comment">// ä»…è€ƒè™‘ functionç±»å‹çš„ onFulfilled</span></span><br><span class="line">  <span class="keyword">this</span>.onFulfilled = onFulfilled;</span><br><span class="line">  <span class="keyword">this</span>.callFulfilled = <span class="function"><span class="keyword">function</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">    makeMicroTask(<span class="keyword">this</span>.promise, <span class="keyword">this</span>.onFulfilled, value);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="comment">// æš‚ä¸å¤„ç† onRejected</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å°† handleResolve æ“ä½œæ”¾å…¥ microtask</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">makeMicroTask</span> (<span class="params">promise, func, value</span>) </span>&#123;</span><br><span class="line">  immediate(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    handleResolve(promise, func(value));</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ”¹å˜ promise çŠ¶æ€ï¼Œå¹¶é€šçŸ¥ queue ä¸­çš„ promise æ‰§è¡Œ makeMicroTask</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">handleResolve</span> (<span class="params">self, value</span>) </span>&#123;</span><br><span class="line">  self.state = FULFILLED;</span><br><span class="line">  self.outcome = value;</span><br><span class="line">  <span class="keyword">var</span> i = <span class="number">-1</span>;</span><br><span class="line">  <span class="keyword">var</span> len = self.queue.length;</span><br><span class="line">  <span class="keyword">while</span> (++i &lt; len) &#123;</span><br><span class="line">    self.queue[i].callFulfilled(value);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> self;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯¹ resolver æ–¹æ³•çš„ä¸¤ä¸ªå‚æ•°ï¼ˆresolve,rejectï¼‰è¿›è¡ŒåŒ…è£…</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">safelyResolveThenable</span> (<span class="params">self, thenable</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> called = <span class="literal">false</span>;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">onError</span> (<span class="params">value</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (called) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    called = <span class="literal">true</span>;</span><br><span class="line">    <span class="comment">// æš‚ä¸å¤„ç† reject</span></span><br><span class="line">    <span class="comment">// handlers.reject(self, value);</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">onSuccess</span> (<span class="params">value</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (called) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    called = <span class="literal">true</span>;</span><br><span class="line">    handleResolve(self, value);</span><br><span class="line">  &#125;</span><br><span class="line">  thenable(onSuccess, onError);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="å®ä¾‹åˆ†æ"><a href="#å®ä¾‹åˆ†æ" class="headerlink" title="å®ä¾‹åˆ†æ"></a>å®ä¾‹åˆ†æ</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">    resolve(<span class="number">3</span>);</span><br><span class="line">    <span class="built_in">Promise</span>.resolve().then(<span class="function"><span class="params">()</span>=&gt;</span> <span class="built_in">console</span>.log(<span class="number">4</span>))</span><br><span class="line">&#125;).then(<span class="function"><span class="params">num</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(num)</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="number">2</span>)</span><br></pre></td></tr></table></figure>

<details>
<summary>ç­”æ¡ˆ</summary>

<p>1243 </p>
</details>

<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Promise</span>.resolve().then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">  <span class="built_in">Promise</span>.resolve().then(<span class="function"><span class="params">()</span>=&gt;</span> <span class="built_in">console</span>.log(<span class="number">4</span>))</span><br><span class="line">&#125;).then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">3</span>)</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="number">2</span>)</span><br></pre></td></tr></table></figure>

<details>
<summary>ç­”æ¡ˆ</summary>

<p>2143 </p>
</details>

<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">r</span>) =&gt;</span> &#123;</span><br><span class="line">  r()</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">&#125;).then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">11</span>)</span><br><span class="line">&#125;).then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">12</span>)</span><br><span class="line">&#125;).then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">13</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">var</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">r</span>) =&gt;</span> &#123;</span><br><span class="line">  r()</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">2</span>);</span><br><span class="line">  <span class="keyword">let</span> promise = <span class="built_in">Promise</span>.resolve().then(<span class="function"><span class="params">()</span>=&gt;</span> <span class="built_in">console</span>.log(<span class="number">21</span>)).then(<span class="function"><span class="params">()</span>=&gt;</span> <span class="built_in">console</span>.log(<span class="number">22</span>)).then(<span class="function"><span class="params">()</span>=&gt;</span> <span class="built_in">console</span>.log(<span class="number">23</span>))</span><br><span class="line">  promise.then(<span class="function"><span class="params">()</span>=&gt;</span><span class="built_in">console</span>.log(<span class="number">29</span>))</span><br><span class="line">  <span class="built_in">Promise</span>.resolve().then(<span class="function"><span class="params">()</span>=&gt;</span> <span class="built_in">console</span>.log(<span class="number">24</span>)).then(<span class="function"><span class="params">()</span>=&gt;</span> <span class="built_in">console</span>.log(<span class="number">25</span>)).then(<span class="function"><span class="params">()</span>=&gt;</span> <span class="built_in">console</span>.log(<span class="number">26</span>))</span><br><span class="line">&#125;)</span><br><span class="line">promise.then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">27</span>)</span><br><span class="line">&#125;)</span><br><span class="line">promise.then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">28</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<details>
<summary>ç­”æ¡ˆ</summary>

<p>ã€1,2,11,21,24,27,28,12,22,25,13,23,26,29ã€‘</p>
</details>

<h2 id="å¦‚ä½•æµ‹è¯•"><a href="#å¦‚ä½•æµ‹è¯•" class="headerlink" title="å¦‚ä½•æµ‹è¯•"></a>å¦‚ä½•æµ‹è¯•</h2><p>å½“æˆ‘ä»¬çš„ polyfill å†™å®Œåï¼Œéœ€è¦æµ‹è¯•ä¸‹æ˜¯å¦ç¬¦åˆè§„èŒƒï¼Œæˆ‘ä»¬è‡ªå·±å†™æµ‹è¯•ç”¨ä¾‹è‚¯å®šæ˜¯ä¸å¯èƒ½çš„ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªæµ‹è¯•åº“<br><a href="https://github.com/promises-aplus/promises-tests" target="_blank" rel="noopener">promises-tests</a></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> tests = <span class="built_in">require</span>(<span class="string">"promises-aplus-tests"</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="built_in">Promise</span> = <span class="built_in">require</span>(<span class="string">"./index"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> deferred = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> resolve, reject;</span><br><span class="line">    <span class="keyword">const</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">_resolve, _reject</span>) </span>&#123;</span><br><span class="line">        resolve = _resolve;</span><br><span class="line">        reject = _reject;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        promise: promise,</span><br><span class="line">        resolve: resolve,</span><br><span class="line">        reject: reject</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> adapter = &#123;</span><br><span class="line">    deferred</span><br><span class="line">&#125;;</span><br><span class="line">tests.mocha(adapter);</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·å°±å¯ä»¥åšæµ‹è¯•äº†</p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ol>
<li><a href="https://juejin.im/post/5aa3f7b9f265da23766ae5ae" target="_blank" rel="noopener">ä»ä¸€é“Promiseæ‰§è¡Œé¡ºåºçš„é¢˜ç›®çœ‹Promiseå®ç°</a></li>
<li><a href="https://segmentfault.com/a/1190000020037919" target="_blank" rel="noopener">æ‰‹å†™ä¸€ä¸ªç¬¦åˆA+è§„èŒƒçš„Promise</a></li>
</ol>
]]></content>
      <categories>
        <category>å¤§å‰ç«¯</category>
      </categories>
      <tags>
        <tag>ECMAScript</tag>
      </tags>
  </entry>
  <entry>
    <title>Code Serveræ­å»ºæŒ‡å—</title>
    <url>/2019/12/10/2019Q4/Code%20Server%E6%90%AD%E5%BB%BA%E6%8C%87%E5%8D%97/</url>
    <content><![CDATA[<h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>æœ‰ä¸ªä¸ªäººé¡¹ç›®ï¼Œæ¯”å¦‚åšå®¢ã€å¼€æºé¡¹ç›®ï¼Œåœ¨å­¦æ ¡å®¿èˆç”µè„‘ä¸Šå†™ä¸€åŠï¼Œå›åˆ°å®¶æƒ³ç»§ç»­å†™ï¼Œæ€ä¹ˆåšåˆ°ï¼Ÿ</p>
<a id="more"></a>

<p>ä¸Šå¤æ—¶ä»£æˆ‘ä»¬å¯èƒ½ä¼šé‡‡ç”¨æ–‡æ¡£æ‹·è´ä¼ é€çš„æ–¹å¼ã€‚å¼Šç«¯å¤ªå¤šï¼š</p>
<ol>
<li>éƒ¨åˆ†æ”¹åŠ¨éœ€è¦ä¼ æ•´ä¸ªé¡¹ç›®ï¼Œå¤ªéº»çƒ¦</li>
<li>å®¶é‡Œè¿˜å¾—é…ç½®ä¸€æ ·çš„å¼€å‘ç¯å¢ƒ</li>
<li>æ‰‹æœºç­‰ç§»åŠ¨ç«¯æ— æ³•å¼€å‘</li>
</ol>
<p>åæ¥æœ‰äº† git ï¼Œæˆ‘ä»¬åªéœ€è¦æŠŠé¡¹ç›®ä¼ åˆ°å…¬ç½‘ä»“åº“ï¼Œé€šè¿‡ git æ“ä½œæ¥åŒæ­¥é¡¹ç›®ï¼Œä¸è¿‡è¿™ä¹Ÿä»…ä»…æ˜¯è§£å†³äº†ä¸Šé¢çš„é—®é¢˜1ï¼Œå…¶ä»–é—®é¢˜ä»å­˜åœ¨ï¼š</p>
<ol>
<li>ç¯å¢ƒé…ç½®</li>
<li>ç§»åŠ¨ç«¯æ— æ³•å¼€å‘</li>
</ol>
<p>ç”šè‡³è¿˜å¼•å…¥æ–°çš„é—®é¢˜ï¼š</p>
<ol>
<li>ä»£ç å†™ä¸€åŠï¼Œå°±æäº¤è¿œç¨‹ä»“åº“ï¼Œæ­¤æ—¶è¯¥æäº¤æ˜¯æœ‰é—®é¢˜çš„ï¼Œåé¢å›é€€å®¹æ˜“å‡ºé—®é¢˜</li>
</ol>
<p>æŠŠé—®é¢˜æ‹ä¸€æ‹ï¼Œä¸ºäº†è§£å†³å¤šåœ°å¼€å‘ç¯å¢ƒä¸€è‡´ï¼Œæˆ‘ä»¬éœ€è¦æŠŠé¡¹ç›®çš„å¼€å‘æ”¾åˆ°æœåŠ¡å™¨ä¸Šï¼Œè¿™æ ·åŒæ—¶è§£å†³äº†é¡¹ç›®åŒæ­¥çš„é—®é¢˜ï¼Œå› ä¸ºä¸éœ€è¦è¿›è¡ŒåŒæ­¥ã€‚</p>
<p>ä¸ºäº†å®ç°å¤šç«¯å¼€å‘ï¼Œæˆ‘ä»¬è‚¯å®šæ˜¯ç›´æ¥é€šè¿‡æµè§ˆå™¨æ“ä½œæœ€æ–¹ä¾¿ï¼Œè€Œä¸æ˜¯æ¯æ¬¡éƒ½å¾—å…ˆä¸‹è½½å·¥å…·è¿œç¨‹è¿æ¥åˆ°æœåŠ¡å™¨ã€‚</p>
<p>å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ª web ç‰ˆçš„ IDE ï¼Œæœ€å¥½æŠŠæƒé™æ§åˆ¶è¿™å—ä¹Ÿåšå¥½äº†ï¼Œé˜²æ­¢å®‰å…¨é—®é¢˜ã€‚</p>
<p>é‚£ä¹ˆæœ¬æ–‡çš„ä¸»è§’ Code Server å°±ç™»åœºäº†</p>
<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p><a href="https://github.com/cdr/code-server" target="_blank" rel="noopener">code-server</a> æ˜¯è¿è¡Œåœ¨è¿œç¨‹æœåŠ¡å™¨ä¸Šçš„ VS Code, é€šè¿‡æµè§ˆå™¨è¿›è¡Œè®¿é—®.</p>
<p>æ‹¥æœ‰ä»¥ä¸‹ç‰¹ç‚¹</p>
<ul>
<li>ä¸€è‡´çš„ç¯å¢ƒï¼šå¯ä»¥åœ¨å„ç§å¹³å°ä¸Šè¿›è¡Œç¼–ç å¹¶ä¸”å®æ—¶åŒæ­¥ã€‚</li>
<li>Server-poweredï¼šåˆ©ç”¨æœåŠ¡å™¨æ€§èƒ½åŠ é€Ÿæµ‹è¯•å’Œç¼–è¯‘ï¼›ä¸ªäººè®¾å¤‡çœç”µ</li>
</ul>
<p><img src="https://github.com/cdr/code-server/raw/master/doc/assets/ide.gif" alt="code-server"></p>
<h2 id="å¿«é€Ÿå¼€å§‹"><a href="#å¿«é€Ÿå¼€å§‹" class="headerlink" title="å¿«é€Ÿå¼€å§‹"></a>å¿«é€Ÿå¼€å§‹</h2><p>æˆ‘ä»¬é€šè¿‡ docker è¿›è¡Œé¡¹ç›®çš„å¯åŠ¨</p>
<ul>
<li>â‘  å®‰è£… docker å¹¶å¯åŠ¨<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ yum install docker-io â€“y</span><br><span class="line">$ systemctl start docker</span><br></pre></td></tr></table></figure></li>
<li>â‘¡ å¯åŠ¨ code server</li>
</ul>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker run -d -e PASSWORD=xxxx -p 8080:8080 codercom/code-server:v2</span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸Šçš„å‘½ä»¤ï¼Œå°†æ‹‰å–å½“å‰è¾ƒä¸ºç¨³å®šçš„ code-server v2 ç‰ˆæœ¬é•œåƒï¼Œå¹¶åŸºäºæ­¤æ„å»ºå¹¶å¯åŠ¨ä¸€ä¸ªå®¹å™¨</p>
<p><code>-d</code>ï¼š ä½¿ç”¨å®ˆæŠ¤æ€è¿è¡Œå®¹å™¨ï¼Œè¿™æ ·ç»ˆç«¯ä¸­æ–­å°±ä¸ä¼šç»ˆæ­¢é¡¹ç›® <br><code>-e PASSWORD=xxxx</code>ï¼š è¡¨ç¤ºè®¾ç½®ç¯å¢ƒå˜é‡ PASSWORD ä¸º xxxx ï¼Œæ„å»ºçš„æ—¶å€™ä¼šå°†è¯¥å‚æ•°ä¼ è¿›å…¥ã€‚å¦‚æœä¸ä¼ çš„è¯ï¼Œç³»ç»Ÿä¼šéšæœºç”Ÿæˆä¸€ä¸ªå¯†ç  <br><code>-p 8080:8080</code>ï¼š é»˜è®¤é…ç½®ã€‚ä½¿ç”¨æœåŠ¡å™¨çš„8080ç«¯å£æ˜ å°„è¯¥å®¹å™¨çš„8080ç«¯å£ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨æœ¬æœºçš„80ç«¯å£è¿›è¡Œæ˜ å°„\</p>
<ul>
<li>â‘¢ ä½¿ç”¨æµè§ˆå™¨è®¿é—®</li>
</ul>
<p>è®¿é—® <code>http://&lt;server_ip&gt;:8080</code> è¿›å…¥æˆ‘ä»¬çš„ç™»å½•ç•Œé¢ï¼Œè¾“å…¥å¯†ç  xxxx åå³å¯è¿›å…¥ç¼–è¾‘å™¨ç•Œé¢</p>
<p>ç•Œé¢å’Œ vscode ä¸€è‡´ï¼Œå¯ä»¥è¿›è¡Œæ„‰å¿«çš„ç¼–ç äº† ~</p>
<h2 id="æ•°æ®å­˜å‚¨"><a href="#æ•°æ®å­˜å‚¨" class="headerlink" title="æ•°æ®å­˜å‚¨"></a>æ•°æ®å­˜å‚¨</h2><p>ä½ å¯èƒ½ä¼šæœ‰è¿™æ ·çš„ç–‘é—®ï¼š</p>
<ol>
<li>æˆ‘ä»¬åˆ›å»ºçš„æ–‡ä»¶éƒ½å­˜åœ¨å“ªé‡Œ</li>
<li>å®¹å™¨åˆ é™¤åæ•°æ®ä¼šä¸ä¼šä¸è§äº†</li>
</ol>
<blockquote>
<p>å¦‚æœå¯¹ docker æ¯”è¾ƒäº†è§£çš„è¯å¯ä»¥è·³è¿‡æœ¬ç« </p>
</blockquote>
<p>ä» code-server çš„ <a href="https://github.com/cdr/code-server/blob/master/Dockerfile#L56" target="_blank" rel="noopener">Dockerfile</a> ä¸­å¯ä»¥çœ‹åˆ°ï¼Œ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">VOLUME [ &quot;&#x2F;home&#x2F;coder&#x2F;project&quot; ]</span><br></pre></td></tr></table></figure>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œ<code>/home/coder/project</code> ç›®å½•åœ¨è¿è¡Œæ—¶ä¼šè‡ªåŠ¨æŒ‚è½½ä¸ºåŒ¿åæ•°æ®å·ï¼Œå¾€è¯¥ç›®å½•ä¸­å†™å…¥çš„ä¿¡æ¯ä¸ä¼šè¿›å®¹å™¨å­˜å‚¨å±‚ã€‚</p>
<p>è¿™é‡Œä»‹ç»ä¸‹æ•°æ®å·ï¼š</p>
<p>æ•°æ®å·ç®€å•çš„è¯´å°±æ˜¯åœ¨ä¸»æœºä¸Šåˆ†é…äº†ä¸€ä¸ªç›®å½•ï¼Œå®¹å™¨å¯¹è¢«æŒ‚è½½è·¯å¾„æ–‡ä»¶çš„è®¿é—®å…¶å®å°±æ˜¯å¯¹è¯¥ç›®å½•æ–‡ä»¶çš„è®¿é—®ã€‚å…¶æ‹¥æœ‰ä»¥ä¸‹ç‰¹æ€§ï¼š</p>
<ul>
<li><code>æ•°æ®å·</code> ç”¨äºå®¹å™¨é—´çš„å…±äº«ã€‚ï¼ˆè¿™é‡Œä¸€èˆ¬æŒ‡çš„æ˜¯å‘½åæ•°æ®å·ï¼Œå› ä¸ºåŒ¿åå·åå­—æ˜¯éšæœºåˆ†é…çš„ï¼Œè€Œå…¶ä»–å®¹å™¨å¹¶ä¸æ¸…æ¥š</li>
<li>å¯¹ <code>æ•°æ®å·</code> çš„ä¿®æ”¹ç«‹é©¬ç”Ÿæ•ˆã€‚ï¼ˆä¿®æ”¹æ•°æ®å·ä¸­çš„å†…å®¹ï¼Œå®¹å™¨è®¿é—®åˆ°çš„ä¹Ÿæ˜¯ä¿®æ”¹åçš„</li>
<li>å¯¹ <code>æ•°æ®å·</code> çš„æ›´æ–°ï¼Œä¸ä¼šå½±å“é•œåƒã€‚ï¼ˆé•œåƒå’Œæ•°æ®å·ä¹‹é—´æ²¡æœ‰å…³è”</li>
<li>æ‰‹åŠ¨åˆ é™¤ <code>æ•°æ®å·</code> åï¼Œå¦‚æœè¯¥å®¹å™¨è¿˜åœ¨è¿è¡Œï¼Œé‚£ä¹ˆå®¹å™¨æ‰€æŒ‚è½½çš„ç›®å½•ä¼šå˜æˆä¸€ä¸ªç©ºç›®å½•ï¼Œä¸”æ— æ³•å¯¹å…¶è¿›è¡Œæ“ä½œ(åˆ é™¤ç›®å½•ï¼Œåˆ›å»ºæ–‡ä»¶)</li>
<li><code>æ•°æ®å·</code> é»˜è®¤ä¸€ç›´å­˜åœ¨ï¼Œå³ä½¿å®¹å™¨è¢«åˆ é™¤ã€‚</li>
</ul>
<p>ç›¸å…³å‘½ä»¤ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹æ‰€æœ‰æ•°æ®å·</span></span><br><span class="line">docker volume ls</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹å®¹å™¨çš„ä¿¡æ¯</span></span><br><span class="line">docker inspect &lt;container-name&gt;</span><br><span class="line"><span class="comment"># æ‰¾åˆ° Mounts ä¿¡æ¯ï¼Œå¦‚</span></span><br><span class="line"><span class="comment">#        "Mounts": [</span></span><br><span class="line"><span class="comment">#            &#123;</span></span><br><span class="line"><span class="comment">#                "Type": "volume",</span></span><br><span class="line"><span class="comment">#                "Name": "4dc8ad7ccc34b91b0beedf722072537cc545530f9b86de207305913614a82c0c",</span></span><br><span class="line"> <span class="comment">#               "Source": "/var/lib/docker/volumes/4dc8ad7ccc34b91b0beedf722072537cc545530f9b86de207305913614a82c0c/_data",</span></span><br><span class="line"><span class="comment">#                "Destination": "/home/coder/project",</span></span><br><span class="line"><span class="comment">#                "Driver": "local",</span></span><br><span class="line"><span class="comment">#                "Mode": "",</span></span><br><span class="line"><span class="comment">#                "RW": true,</span></span><br><span class="line"><span class="comment">#                "Propagation": ""</span></span><br><span class="line"><span class="comment">#            &#125;</span></span><br><span class="line"><span class="comment">#        ],</span></span><br><span class="line"><span class="comment"># å¯ä»¥çœ‹å‡ºæ¥å…¶å°†å®¹å™¨çš„ /home/coder/project ç›®å½•æŒ‚è½½äº†åŒ¿åæ•°æ®å·ï¼Œå¹¶åˆ†é…äº† 4dc8ad7ccc34b91b0beedf722072537cc545530f9b86de207305913614a82c0c è¿™ä¸ª nameï¼Œè¯¥æ•°æ®åˆ¸å…¶å®æ˜¯ä½äºä¸»æœºçš„ /var/lib/docker/volumes/&lt;volume_name&gt;/_data/ ç›®å½•ä¸‹</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹æŒ‡å®šæ•°æ®å·ï¼ˆå¯ä»¥æ˜¯å‘½åçš„ï¼Œä¹Ÿå¯ä»¥æ˜¯åŒ¿åçš„ï¼‰çš„ä¿¡æ¯ï¼Œ </span></span><br><span class="line"><span class="comment"># æ¯”å¦‚ my-vol å°±æ˜¯ä¸€ä¸ªå‘½åæ•°æ®å·ï¼Œåè€…å°±æ˜¯æŸä¸ªåŒ¿åæ•°æ®å·çš„ name</span></span><br><span class="line"><span class="comment"># docker volume inspect my-vol</span></span><br><span class="line">docker volume inspect 4dc8ad7ccc34b91b0beedf722072537cc545530f9b86de207305913614a82c0c</span><br><span class="line"><span class="comment"># å¤§è‡´è¾“å‡ºå¦‚ä¸‹ï¼š</span></span><br><span class="line"><span class="comment">#[</span></span><br><span class="line"><span class="comment">#    &#123;</span></span><br><span class="line"><span class="comment">#        "Driver": "local",</span></span><br><span class="line"><span class="comment">#        "Labels": null,</span></span><br><span class="line"><span class="comment">#        "Mountpoint": "/var/lib/docker/volumes/4dc8ad7ccc34b91b0beedf722072537cc545530f9b86de207305913614a82c0c/_data",</span></span><br><span class="line"><span class="comment">#        "Name": "4dc8ad7ccc34b91b0beedf722072537cc545530f9b86de207305913614a82c0c",</span></span><br><span class="line"><span class="comment">#        "Options": &#123;&#125;,</span></span><br><span class="line"><span class="comment">#        "Scope": "local"</span></span><br><span class="line"><span class="comment">#    &#125;</span></span><br><span class="line"><span class="comment">#]</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>æ•°æ®å·æ˜¯å¯ä»¥æŒ‡å®šå­˜å‚¨ä½ç½®ï¼ˆå³ Driver é…ç½®é¡¹ï¼‰ï¼Œé»˜è®¤ local ä¸ºå½“å‰ä¸»æœºï¼Œä¹Ÿå¯ä»¥æŒ‡å®šå…¶ä»–æœºå™¨ä½œä¸ºdriverï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥çœ‹ <a href="https://www.cnblogs.com/sparkdev/p/8504050.html" target="_blank" rel="noopener">Docker æ•°æ®å·ä¹‹è¿›é˜¶ç¯‡</a></p>
</blockquote>
<p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å›ç­”å‰é¢ä¸¤ä¸ªé—®é¢˜äº†ï¼š</p>
<p>æˆ‘ä»¬é¡¹ç›®ä¸­åˆ›å»ºçš„æ–‡ä»¶ï¼ˆ<code>/home/coder/project/</code> ç›®å½•ä¸‹åˆ›å»ºçš„ï¼‰ï¼Œæ˜¯å­˜åœ¨äºä¸»æœºç›®å½•çš„ï¼Œå¯ä»¥é€šè¿‡<code>docker inspect &lt;container-name&gt;</code> æŸ¥çœ‹ï¼Œä¸€èˆ¬æ˜¯åœ¨  <code>/var/lib/docker/volumes/&lt;volume_name&gt;/_data/</code> ç›®å½•ä¸‹</p>
<p>å®¹å™¨åˆ é™¤åæ•°æ®ä¸ä¼šä¸¢å¤±ï¼Œéƒ½è¿˜åœ¨åŒ¿åæ•°æ®å·ç›®å½•ä¸‹ã€‚</p>
<p>åªæ˜¯æœ‰ä¸ªé—®é¢˜ï¼Œå…¶ä»–å®¹å™¨ä¸çŸ¥é“è¿™ä¸ªåŒ¿åæ•°æ®å·çš„å­˜åœ¨</p>
<p>æ‰€ä»¥ä½ ä¼šå‘ç°ï¼Œä½ å†å¯åŠ¨ä¸€ä¸ªæ–°çš„å®¹å™¨ï¼Œå®ƒåˆåˆ›å»ºäº†ä¸€ä¸ªåŒ¿åæ•°æ®å·ï¼Œå¹¶ä¸”ä¸ä¼šæœ‰ä¸Šä¸ªåŒ¿åæ•°æ®å·ä¸­çš„æ•°æ®</p>
<p>è§£å†³æ–¹æ³•æœ‰ä¸¤ç§ï¼š</p>
<ol>
<li>ä½¿ç”¨å‘½åæ•°æ®å·</li>
<li>æŒ‚è½½ä¸»æœºç›®å½•</li>
</ol>
<p>å…ˆä»‹ç»åšæ³•ï¼Œå†è®¨è®ºåˆ©å¼Š</p>
<h3 id="ä½¿ç”¨å‘½åæ•°æ®å·"><a href="#ä½¿ç”¨å‘½åæ•°æ®å·" class="headerlink" title="ä½¿ç”¨å‘½åæ•°æ®å·"></a>ä½¿ç”¨å‘½åæ•°æ®å·</h3><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker run -d -e PASSWORD=xxxx -v coder_project:/home/coder/project  -p 8080:8080 codercom/code-server:v2</span><br></pre></td></tr></table></figure>
<p><code>-v coder_project:/home/coder/project</code> ï¼šæŒ‚è½½ coder_project æ•°æ®å·åˆ°å®¹å™¨çš„ <code>/home/coder/project</code> ç›®å½•ï¼Œå¦‚æœæ•°æ®å·ä¸å­˜åœ¨ï¼Œä¼šè¿›è¡Œåˆ›å»ºã€‚åŒæ—¶è¦†ç›–è¿™ä¸ªæŒ‚è½½è®¾ç½®ï¼š <code>VOLUME [ &quot;/home/coder/project&quot; ]</code></p>
<p>æˆ‘ä»¬åœ¨æµè§ˆå™¨ä¸­è®¿é—®è¯¥é¡¹ç›®ï¼Œå¹¶åœ¨ project ç›®å½•ä¸‹æ–°å¢å‡ ä¸ªæ–‡ä»¶ï¼Œç„¶åå…³é—­å®¹å™¨ã€‚æ­¤æ—¶å¼€å¯ä¸€ä¸ªæ–°çš„å®¹å™¨ï¼Œæ‰“å¼€æµè§ˆå™¨è¿›è¡Œè®¿é—®ï¼Œå¯ä»¥å‘ç° project ç›®å½•ä¸‹åŠ è½½äº†åˆšåˆšåˆ›å»ºçš„æ–‡ä»¶ã€‚</p>
<p>è¯´æ˜ç°åœ¨å¤šä¸ªå®¹å™¨éƒ½æ˜¯å»æ‹¿åŒä¸ªæ•°æ®å·ä¸Šçš„æ•°æ®</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å±•ç¤º coder_project æ•°æ®å·çš„è¯¦ç»†ä¿¡æ¯</span></span><br><span class="line"><span class="comment"># å¯ä»¥çœ‹åˆ°æ•°æ®å­˜æ”¾åœ¨ /var/lib/docker/volumes/coder_project/_data</span></span><br><span class="line">docker volume inspect coder_project</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯ä»¥çœ‹åˆ°æˆ‘ä»¬åˆšåˆšåˆ›å»ºçš„æ–‡ä»¶</span></span><br><span class="line"><span class="built_in">cd</span> /var/lib/docker/volumes/coder_project/_data &amp;&amp; ll</span><br></pre></td></tr></table></figure>

<p>ä¹Ÿå¯ä»¥ä½¿ç”¨ â€“mount æŒ‡ä»¤ï¼Œä¸Šé¢çš„ -v æŒ‡ä»¤ç›¸å½“äº</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">--mount source&#x3D;coder_project,destination&#x3D;&#x2F;home&#x2F;coder&#x2F;project</span><br></pre></td></tr></table></figure>
<blockquote>
<p>æ³¨æ„ï¼šDocker 17.06 ç‰ˆæœ¬ä¹‹åæ‰æ”¯æŒ â€“mount æŒ‡ä»¤</p>
</blockquote>
<p>å…³äºä¸¤ä¸ªæŒ‡ä»¤çš„åŒºåˆ«è¿˜å¯ä»¥çœ‹ <a href="https://docs.docker.com/storage/volumes/" target="_blank" rel="noopener">Use volumes</a></p>
<p>å½“ coder_project æ•°æ®å·ä¸å­˜åœ¨æ—¶ï¼Œä¼šæŠ¥é”™è€Œä¸æ˜¯è‡ªåŠ¨åˆ›å»º</p>
<h3 id="æŒ‚è½½ä¸»æœºç›®å½•"><a href="#æŒ‚è½½ä¸»æœºç›®å½•" class="headerlink" title="æŒ‚è½½ä¸»æœºç›®å½•"></a>æŒ‚è½½ä¸»æœºç›®å½•</h3><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker run -d -e PASSWORD=xxxx -v /usr/<span class="built_in">local</span>/coder/project:/home/coder/project  -p 8080:8080 codercom/code-server:v2</span><br></pre></td></tr></table></figure>

<p><code>-v /usr/local/coder/project:/home/coder/project</code> ï¼šæŒ‚è½½ ä¸»æœºçš„ <code>/usr/local/coder/project</code> ç›®å½•åˆ°å®¹å™¨çš„ <code>/home/coder/project</code> ç›®å½•ï¼Œå¦‚æœä¸»æœºç›®å½•ä¸å­˜åœ¨ï¼Œä¼šè¿›è¡Œåˆ›å»ºã€‚åŒæ—¶è¦†ç›–è¿™ä¸ªæŒ‚è½½è®¾ç½®ï¼š <code>VOLUME [ &quot;/home/coder/project&quot; ]</code></p>
<p>æˆ‘ä»¬åˆ›å»ºå‡ ä¸ªæ–‡ä»¶è¯•è¯•</p>
<blockquote>
<p>å¦‚æœå‘ç° Permission denied ï¼Œå¯èƒ½æ˜¯ selinux çš„é—®é¢˜æˆ–è€…ç”¨æˆ·ç›®å½•æƒé™çš„é—®é¢˜ï¼Œå¯ä»¥è‡ªè¡Œæœç´¢è§£å†³æ–¹æ¡ˆ</p>
</blockquote>
<p>å¯ä»¥å‘ç°ä¸»æœºç›®å½• <code>/usr/local/coder/project</code> ä¹Ÿä¼šæœ‰åˆšåˆšåˆ›å»ºçš„æ–‡ä»¶ï¼Œæˆ‘ä»¬å¾€ä¸»æœºç›®å½•åˆ›å»ºçš„æ–‡ä»¶ï¼Œå®¹å™¨ä¸­ä¹Ÿå¯ä»¥çœ‹åˆ°ã€‚</p>
<p>ä¹Ÿå¯ä»¥ä½¿ç”¨ â€“mount æŒ‡ä»¤ï¼Œä¸Šé¢çš„ -v æŒ‡ä»¤ç›¸å½“äº</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">--mount type&#x3D;bind,source&#x3D;&#x2F;usr&#x2F;local&#x2F;coder&#x2F;project,target&#x3D;&#x2F;home&#x2F;coder&#x2F;project</span><br></pre></td></tr></table></figure>
<p>type=bind è¡¨ç¤ºæŒ‚è½½ä¸»æœºç›®å½•ï¼Œé»˜è®¤ä¸º volume</p>
<p>å½“ ä¸»æœºç›®å½• ä¸å­˜åœ¨æ—¶ï¼Œä¼šæŠ¥é”™è€Œä¸æ˜¯è‡ªåŠ¨åˆ›å»º</p>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>æ•°æ®å·æ‹¥æœ‰æŒ‚è½½ä¸»æœºç›®å½•çš„ç‰¹ç‚¹å’Œä¼˜ç‚¹ï¼Œå¹¶ä¸”æ”¯æŒæŒ‚è½½åœ¨å…¶ä»–ä¸»æœºä¸Šï¼Œå¯¹æˆ‘ä»¬åç»­é›†ç¾¤åº”ç”¨æä¾›äº†å¯è¡Œæ€§ã€‚</p>
<p>ä¸ªäººæ›´åå‘äºé‡‡ç”¨æ•°æ®å·çš„æ–¹å¼ã€‚</p>
<p><strong>å› æ­¤ï¼Œæˆ‘ä»¬çš„å®¹å™¨å¯åŠ¨å‘½ä»¤å¦‚ä¸‹ï¼š</strong></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker run -d -e PASSWORD=xxxx -v coder_project:/home/coder/project  -p 8080:8080 codercom/code-server:v2</span><br></pre></td></tr></table></figure>


<h2 id="git-é…ç½®"><a href="#git-é…ç½®" class="headerlink" title="git é…ç½®"></a>git é…ç½®</h2><p>code server å†…ç½®äº† git æ’ä»¶äº†</p>
<p>æˆ‘ä»¬ new Terminalï¼Œclone ä¸€ä¸ªè‡ªå·±çš„é¡¹ç›®çœ‹çœ‹</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/francecil/LearningWeb.git</span><br></pre></td></tr></table></figure>
<p>ä¿®æ”¹æäº¤ï¼Œæ­¤æ—¶ä¼šæç¤ºè¯´ä½ æ²¡æœ‰é…ç½® git è´¦å·</p>
<p>æŒ‰è¯´æ˜çš„æŒ‡ç¤ºï¼Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git config --global user.email &quot;you@example.com&quot;</span><br><span class="line">git config --global user.name &quot;Your Name&quot;</span><br></pre></td></tr></table></figure>

<p>ç„¶åè¿›è¡Œ push ï¼ˆä½¿ç”¨å‘½ä»¤è¡Œ git push ï¼‰ï¼Œæ­¤æ—¶ä¼šæç¤ºè¾“å…¥è´¦å·å¯†ç ã€‚</p>
<p>è¾“å…¥å®Œåå³å¯æ¨é€æˆåŠŸã€‚</p>
<p>æ‰€ä»¥ git å…¶å®ä¹Ÿæ²¡æœ‰ä»€ä¹ˆéœ€è¦é…ç½®çš„</p>
<h2 id="æ’ä»¶å®‰è£…å’Œé…ç½®åŒæ­¥"><a href="#æ’ä»¶å®‰è£…å’Œé…ç½®åŒæ­¥" class="headerlink" title="æ’ä»¶å®‰è£…å’Œé…ç½®åŒæ­¥"></a>æ’ä»¶å®‰è£…å’Œé…ç½®åŒæ­¥</h2><p>ç›´æ¥åœ¨çº¿ä¸‹è½½ï¼Œå¾ˆå¤šæ’ä»¶éƒ½ä¸èƒ½ç”¨ï¼Œå¹¶ä¸” code server çš„æ’ä»¶å¸‚åœº å’Œ vs code çš„ä¸ä¸€æ ·ï¼Œè§ <a href="https://github.com/cdr/code-server#extensions" target="_blank" rel="noopener">https://github.com/cdr/code-server#extensions</a></p>
<p>æ‰€ä»¥æ¨èçš„æ–¹å¼æ˜¯ <code>Install from VSIX...</code></p>
<p>å¦‚ä½•å¿«é€Ÿç¦»çº¿å®‰è£…æ‹“å±•ï¼Œå¯ä»¥å‚è€ƒæˆ‘ä¹‹å‰å†™çš„æ–‡ç«  <a href="../2019Q3/vscodeé…ç½®åŒæ­¥åŠæ‹“å±•æ‰¹é‡ç¦»çº¿å®‰è£….md">vscodeé…ç½®åŒæ­¥åŠæ‹“å±•æ‰¹é‡ç¦»çº¿å®‰è£…</a></p>
<p>æ³¨æ„ï¼Œæ‹“å±•åº”è¯¥ä¸‹è½½åˆ°æ•°æ®å·ä¸­ï¼Œè¿™æ ·å®¹å™¨å°±å¯ä»¥è¿›è¡Œå…±äº«äº†</p>
<p>æœ‰äº†å‰æ–‡çš„ç»éªŒï¼Œæˆ‘ä»¬æ˜ç™½æ­¤æ—¶åº”è¯¥é‡‡ç”¨å‘½åæ•°æ®å·çš„æ–¹æ³•ã€‚</p>
<p>é‚£ä¹ˆç›®æ ‡å®¹å™¨ç›®å½•æ˜¯å“ªä¸ªå‘¢ï¼Œä»å®˜æ–¹çš„ä»‹ç»ä¸­å¾—çŸ¥</p>
<p>code server çš„é…ç½®å’Œæ‹“å±•å¤„åœ¨ <code>/home/coder/.local/share/code-server</code> ç›®å½•</p>
<p>ä¿®æ”¹ä¸‹æˆ‘ä»¬çš„å®¹å™¨è¿è¡Œå‘½ä»¤å¦‚ä¸‹</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker run -d -e PASSWORD=xxxx -v coder_project:/home/coder/project -v coder_config:/home/coder/.<span class="built_in">local</span>/share/code-server -p 8080:8080 codercom/code-server:v2</span><br></pre></td></tr></table></figure>

<p>æˆåŠŸè¿è¡Œï¼Ÿ ä¸ï¼Œæ­£å¸¸ä½ åº”è¯¥ä¼šå¾—åˆ°è¿™ä¸ªæŠ¥é”™(å¯ä»¥é€šè¿‡ docker logs &lt;å®¹å™¨å&gt;æŸ¥çœ‹)</p>
<blockquote>
<p>permission denied, mkdir â€˜/home/coder/.local/share/code-server/extensionsâ€™</p>
</blockquote>
<p><a href="https://github.com/cdr/code-server/issues/992" target="_blank" rel="noopener">issue</a> ä¸Šæœ‰è¿™ä¸ªçš„è®¨è®ºï¼Œå¥½åƒæ˜¯å› ä¸ºæƒé™é—®é¢˜</p>
<p>æœ‰ä¸ªè§£å†³æ–¹æ¡ˆï¼Œchmod è®¾ç½®è¯¥æ‰€æŒ‚è½½çš„ä¸»æœºç›®å½•æƒé™</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">chmod 777 -R &#x2F;var&#x2F;lib&#x2F;docker&#x2F;volumes&#x2F;coder_config&#x2F;_data</span><br></pre></td></tr></table></figure>

<p>ç„¶åé‡æ–°æ‰§è¡Œä¸Šé¢çš„å®¹å™¨è¿è¡Œå‘½ä»¤ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cd &#x2F;var&#x2F;lib&#x2F;docker&#x2F;volumes&#x2F;coder_config&#x2F;_data &amp;&amp; ll</span><br><span class="line"></span><br><span class="line">-rw-r--r-- 1 coder coder   75 Nov  1 19:31 coder.json</span><br><span class="line">drwxr-xr-x 2 coder coder 4096 Nov  1 19:30 extensions</span><br><span class="line">-rw-r--r-- 1 coder coder    0 Nov  1 19:31 heartbeat</span><br><span class="line">-rw-r--r-- 1 coder coder    2 Nov  1 19:31 languagepacks.json</span><br><span class="line">drwxr-xr-x 3 coder coder 4096 Nov  1 19:30 logs</span><br><span class="line">-rw-r--r-- 1 coder coder   36 Nov  1 19:30 machineid</span><br><span class="line">drwxr-xr-x 4 coder coder 4096 Nov  1 19:31 User</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°è‡ªåŠ¨åˆ›å»ºäº†å¾ˆå¤šæ–‡ä»¶ã€‚</p>
<p>å›åˆ°æ­£é¢˜ï¼Œæˆ‘ä»¬å®‰è£…çš„æ’ä»¶åº”è¯¥å°±æ˜¯æ”¾åœ¨ extensions ç›®å½•ä¸‹</p>
<p>æˆ‘ä»¬æ–°å»ºä¸ªç›®å½•ç”¨æ¥å­˜æ”¾ç¦»çº¿ä¸‹è½½çš„æ’ä»¶</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[xxx _data]# mkdir tmp</span><br></pre></td></tr></table></figure>

<p>ç„¶å <code>Install from VSIX...</code> çš„æ—¶å€™å°±ä»è¯¥ç›®å½•åŠ è½½å³å¯ï¼Œå®‰è£…æˆåŠŸåä¼šå­˜åœ¨äº extensions ä¸‹</p>
<p>åé¢æ–°å»ºçš„å®¹å™¨ç›´æ¥è¯»çš„ extensions ç›®å½•ï¼Œæ— éœ€å†æ¬¡å®‰è£…</p>
<h2 id="docker-compose-çš„ä½¿ç”¨"><a href="#docker-compose-çš„ä½¿ç”¨" class="headerlink" title="docker-compose çš„ä½¿ç”¨"></a>docker-compose çš„ä½¿ç”¨</h2><p>æ˜¯ä¸æ˜¯è§‰å¾— docker run çš„å‘½ä»¤å¤ªé•¿äº†ï¼Œè¿˜æœ‰å®¹å™¨æŒ‚äº†æ€ä¹ˆåŠã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥é‡‡ç”¨ docker-compose æŠ€æœ¯</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment">#å®‰è£…docker-compose</span></span><br><span class="line">curl -L https://github.com/docker/compose/releases/download/1.24.1/docker-compose-`uname -s`-`uname -m` &gt; /usr/<span class="built_in">local</span>/bin/docker-compose</span><br><span class="line">chmod +x /usr/<span class="built_in">local</span>/bin/docker-compose</span><br><span class="line"><span class="comment">#æŸ¥çœ‹å®‰è£…æƒ…å†µ</span></span><br><span class="line">docker-compose --version</span><br></pre></td></tr></table></figure>

<p>ç„¶åæ‰¾ä¸ªç›®å½•ï¼ˆå¦‚ <code>/usr/local/code-server</code>ï¼‰åˆ›å»º docker-compose.yml , å†…å®¹å¦‚ä¸‹</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">"2"</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">code-server:</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">code-server</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">codercom/code-server:v2</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">"8080:8080"</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">"coder_project:/home/coder/project"</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">"coder_config:/home/coder/.local/share/code-server"</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">PASSWORD:</span> <span class="string">"xxxx"</span></span><br><span class="line"><span class="attr">volumes:</span></span><br><span class="line">  <span class="attr">coder_project:</span></span><br><span class="line">    <span class="attr">external:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">coder_config:</span></span><br><span class="line">    <span class="attr">external:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>
<p>æ³¨æ„è¿™é‡Œé…ç½®äº† <code>restart: always</code> å½“å®¹å™¨æŒ‚æ‰,æˆ– docker å¯åŠ¨çš„æ—¶å€™ï¼Œ code-server ä¼šè¿›è¡Œå¯åŠ¨ï¼ˆé‡å¯ï¼‰</p>
<p>å‘½åæ•°æ®å·éœ€è¦åœ¨å¤–å±‚ä½¿ç”¨ volumes æŒ‡å®šã€‚è¿™é‡Œå¢åŠ  <code>external: true</code> é…ç½®è¡¨ç¤ºä½¿ç”¨å¤–éƒ¨å·²ç»å®šä¹‰çš„æ•°æ®å·ï¼Œä¸å­˜åœ¨åˆ™ä¼šæŠ¥é”™ï¼Œæç¤ºæˆ‘ä»¬éœ€è¦å…ˆç”¨ <code>docker volume create --name=coder_project</code> åˆ›å»º</p>
<p>é‚£ä¸é…ç½®çš„è¯å‘¢ï¼Œä¼šåˆ›å»ºæ•°æ®å·ï¼Œåä¸º code-server_coder_project å’Œ code-server_coder_config ï¼Œå³ <code>&lt;service-name&gt;_&lt;volume-name&gt;</code></p>
<p>å’Œæˆ‘ä»¬ä¹‹å‰å·²åˆ›å»ºçš„æ•°æ®å·ä¸ä¸€è‡´ï¼Œå¦å¤–è¿˜æœ‰å¯èƒ½å‡ºç°ä¹‹å‰çš„ Permission denied é—®é¢˜ã€‚å› æ­¤è¿™é‡Œç›´æ¥ç”¨çš„åŸæ•°æ®å·</p>
<p>ç„¶ååœ¨ docker-compose.yml åŒçº§ç›®å½•ä¸‹æ‰§è¡Œ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure>
<p>å³å¯å¯åŠ¨æœåŠ¡</p>
<h2 id="åŸŸåé…ç½®å’Œè½¬å‘"><a href="#åŸŸåé…ç½®å’Œè½¬å‘" class="headerlink" title="åŸŸåé…ç½®å’Œè½¬å‘"></a>åŸŸåé…ç½®å’Œè½¬å‘</h2><p>ç›®å‰ï¼Œæˆ‘ä»¬çš„é¡¹ç›®æ˜¯é€šè¿‡ ip è®¿é—®çš„ï¼Œå¤ªè¿‡éº»çƒ¦ï¼ˆæˆ‘æ˜¯ç»å¸¸è®°ä¸ä½</p>
<p>ä¹°åŸŸåå’Œé…ç½®dnsè§£æè¿™é‡Œå°±ç•¥è¿‡äº†ã€‚</p>
<p>ç°åœ¨çš„é—®é¢˜æ˜¯ï¼Œè®¿é—®åŸŸåæ€ä¹ˆè½¬å‘åˆ° 8080 ç«¯å£çš„é¡¹ç›®ä¸Šå»ï¼Ÿ</p>
<p>æ˜¾ç„¶ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡nginxè¿›è¡Œè½¬å‘ï¼Œä¸”nginxæ˜¯è·‘åœ¨80ç«¯å£ä¸Šçš„ã€‚</p>
<ul>
<li>å®‰è£… nginx<blockquote>
<p>yum install nginx</p>
</blockquote>
</li>
<li>ä¿®æ”¹é…ç½®<blockquote>
<p>vi /etc/nginx/nginx.conf <br>å¢åŠ å¦‚ä¸‹é…ç½®,å½“é‡‡ç”¨åŸŸå <code>code.test.com</code> è®¿é—®çš„æ—¶å€™ï¼Œä¼šè½¬å‘åˆ°æœ¬åœ° 8080 ç«¯å£çš„é¡¹ç›® <br>å› ä¸ºç”¨åˆ°äº† websocket ï¼Œæ‰€ä»¥è¿˜åŠ äº†ä¸€äº›å¤´éƒ¨è®¾ç½®</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen       80;</span><br><span class="line">    server_name  code.test.com;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">      proxy_pass http://127.0.0.1:8080;</span><br><span class="line">      proxy_set_header Host <span class="variable">$host</span>;</span><br><span class="line">      proxy_set_header Upgrade <span class="variable">$http_upgrade</span>;</span><br><span class="line">      proxy_set_header Connection upgrade;</span><br><span class="line">      proxy_set_header Accept-Encodeing gzip;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>å¯åŠ¨ nginx<blockquote>
<p>systemctl start nginx</p>
</blockquote>
</li>
</ul>
<p>æ­¤æ—¶ï¼Œæˆ‘ä»¬è®¿é—® <a href="http://code.test.com/" target="_blank" rel="noopener">http://code.test.com/</a> å³å¯è¿›å…¥æˆ‘ä»¬çš„ code server é¡¹ç›® ~</p>
<h2 id="ssl-é…ç½®"><a href="#ssl-é…ç½®" class="headerlink" title="ssl é…ç½®"></a>ssl é…ç½®</h2><p>ä¸ºäº†è®©æˆ‘ä»¬çš„é¡¹ç›®æ›´å®‰å…¨ï¼Œæ¯”å¦‚é˜²åŠ«æŒï¼Œæˆ‘ä»¬éœ€è¦é…ç½®ä¸Š ssl</p>
<p>é¦–å…ˆè¿›è¡Œsslè¯ä¹¦ç”³è¯·</p>
<h3 id="å…è´¹ç”³è¯·-ssl-è¯ä¹¦"><a href="#å…è´¹ç”³è¯·-ssl-è¯ä¹¦" class="headerlink" title="å…è´¹ç”³è¯· ssl è¯ä¹¦"></a>å…è´¹ç”³è¯· ssl è¯ä¹¦</h3><p><a href="https://common-buy.aliyun.com/?commodityCode=cas#/buy" target="_blank" rel="noopener">ç”³è¯·ç•Œé¢</a></p>
<p>åˆ‡æ¢åˆ°æœ€åçš„ å…è´¹å‹ DV SSLï¼Œç„¶å0å…ƒè´­ä¹°ï¼Œæ¥ç€æŒ‰æç¤ºç‚¹ç‚¹ç‚¹ï¼Œç„¶åç­‰å¾…å®¡æ ¸å°±å¯ä»¥äº†</p>
<p>ä¸€èˆ¬10åˆ†é’Ÿå°±å®¡æ ¸å®Œæ¯•</p>
<p>å¯ä»¥åœ¨ SSL è¯ä¹¦é¡µé¢æŸ¥çœ‹åˆ°çŠ¶æ€æ˜¾ç¤ºä¸º <code>å·²ç­¾å‘</code></p>
<blockquote>
<p>å¯ä»¥é€šè¿‡é¡¶éƒ¨æœç´¢æ æœ ssl å¿«é€Ÿæ‰¾åˆ°è¯¥é¡µé¢</p>
</blockquote>
<p>ç„¶åä¸‹è½½è¯ä¹¦ï¼Œå°†è¯ä¹¦ä¸Šä¼ åˆ°æœåŠ¡å™¨å³å¯ã€‚</p>
<h3 id="nginx-é…ç½®"><a href="#nginx-é…ç½®" class="headerlink" title="nginx é…ç½®"></a>nginx é…ç½®</h3><p>é˜¿é‡Œäº‘çš„æ–‡æ¡£å†™çš„å¾ˆè¯¦ç»†ï¼Œè¿™é‡Œä»¥ nginx ä¸ºä¾‹</p>
<ol>
<li>è§£å‹ä¸‹è½½çš„æ–‡ä»¶ï¼Œå¾—åˆ° .crt å’Œ .key æ–‡ä»¶ï¼Œæ¯”å¦‚ a.crt å’Œ a.key</li>
<li>è¿›å…¥æœåŠ¡å™¨çš„ nginx é…ç½®ç›®å½• /etc/nginx<blockquote>
<p>å¦‚æœæ˜¯è‡ªå·±ç¼–è¯‘ç”Ÿæˆçš„ nginx å°±ç”¨ <code>whereis nginx</code> å‘½ä»¤çœ‹ä¸‹å®‰è£…ç›®å½•åœ¨å“ªï¼Œå¦‚ /usr/local/nginx/</p>
</blockquote>
</li>
<li>åˆ›å»º cert ç›®å½•ï¼Œå°†è§£å‹åçš„ä¸¤ä¸ªæ–‡ä»¶æ”¾å…¥è¯¥ç›®å½•<blockquote>
<p>æˆ‘è¿™ä¸ªæ–°ä¹°çš„æœåŠ¡å™¨æ²¡æœ‰ rz å·¥å…·ï¼Œå¾—è¿›è¡Œå®‰è£…ï¼š <code>yum install -y lrzsz</code> <br>æˆ–è€…ä½¿ç”¨ xshell çš„æ–‡ä»¶ä¼ è¾“ sftp</p>
</blockquote>
</li>
<li>ç¼–è¾‘ nginx.conf æ–‡ä»¶ï¼Œæ‰¾åˆ° 443 ç›¸å…³çš„æ³¨é‡Š<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment">#    server &#123;</span></span><br><span class="line"><span class="comment">#        listen       443 ssl http2 default_server;</span></span><br><span class="line"><span class="comment">#        listen       [::]:443 ssl http2 default_server;</span></span><br><span class="line"><span class="comment">#        server_name  _;</span></span><br><span class="line"><span class="comment">#        root         /usr/share/nginx/html;</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#        ssl_certificate "/etc/pki/nginx/server.crt";</span></span><br><span class="line"><span class="comment">#        ssl_certificate_key "/etc/pki/nginx/private/server.key";</span></span><br><span class="line"><span class="comment">#        ssl_session_cache shared:SSL:1m;</span></span><br><span class="line"><span class="comment">#        ssl_session_timeout  10m;</span></span><br><span class="line"><span class="comment">#        ssl_ciphers HIGH:!aNULL:!MD5;</span></span><br><span class="line"><span class="comment">#        ssl_prefer_server_ciphers on;</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#        # Load configuration files for the default server block.</span></span><br><span class="line"><span class="comment">#        include /etc/nginx/default.d/*.conf;</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#        location / &#123;</span></span><br><span class="line"><span class="comment">#        &#125;</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#        error_page 404 /404.html;</span></span><br><span class="line"><span class="comment">#            location = /40x.html &#123;</span></span><br><span class="line"><span class="comment">#        &#125;</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#        error_page 500 502 503 504 /50x.html;</span></span><br><span class="line"><span class="comment">#            location = /50x.html &#123;</span></span><br><span class="line"><span class="comment">#        &#125;</span></span><br><span class="line"><span class="comment">#    &#125;</span></span><br></pre></td></tr></table></figure></li>
<li>é…ç½®æ›¿æ¢ä¸º<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">  listen 443;</span><br><span class="line">  server_name localhost;</span><br><span class="line">  ssl on;</span><br><span class="line">  root html;</span><br><span class="line">  index index.html index.htm;</span><br><span class="line">  ssl_certificate   cert/a.pem;</span><br><span class="line">  ssl_certificate_key  cert/a.key;</span><br><span class="line">  ssl_session_timeout 5m;</span><br><span class="line">  ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;</span><br><span class="line">  ssl_protocols TLSv1 TLSv1.1 TLSv1.2;</span><br><span class="line">  ssl_prefer_server_ciphers on;</span><br><span class="line">  location / &#123;</span><br><span class="line">    root html;</span><br><span class="line">    index index.html index.htm;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>é‡å¯ nginx é…ç½® <code>systemctl reload nginx</code></li>
</ol>
<p>ä¸Šé¢æ˜¯é€šç”¨æ­¥éª¤ï¼Œç”±äºæˆ‘ä»¬çš„ code server é¡¹ç›®æ”¾åœ¨8080ç«¯å£ï¼Œå› æ­¤æˆ‘çš„æœ€ç»ˆé…ç½®å¦‚ä¸‹ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">  listen 443;</span><br><span class="line">  <span class="comment"># è¿™é‡Œå†™ä¸Šä½ çš„åŸŸå</span></span><br><span class="line">  server_name code.test.com;</span><br><span class="line">  ssl on;</span><br><span class="line">  ssl_certificate   cert/a.pem;</span><br><span class="line">  ssl_certificate_key  cert/a.key;</span><br><span class="line">  ssl_session_timeout 5m;</span><br><span class="line">  ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;</span><br><span class="line">  ssl_protocols TLSv1 TLSv1.1 TLSv1.2;</span><br><span class="line">  ssl_prefer_server_ciphers on;</span><br><span class="line">  location / &#123;</span><br><span class="line">      proxy_pass http://127.0.0.1:8080;</span><br><span class="line">      proxy_set_header Host <span class="variable">$host</span>;</span><br><span class="line">      proxy_set_header Upgrade <span class="variable">$http_upgrade</span>;</span><br><span class="line">      proxy_set_header Connection upgrade;</span><br><span class="line">      proxy_set_header Accept-Encodeing gzip;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ­¤æ—¶æˆ‘ä»¬é€šè¿‡ <a href="https://code.test.com/" target="_blank" rel="noopener">https://code.test.com/</a> å°±å¯ä»¥è®¿é—®äº†</p>
]]></content>
      <categories>
        <category>éšç¬”</category>
      </categories>
      <tags>
        <tag>Docker</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¸ºä»€ä¹ˆ 0.._ ç­‰äº undefined</title>
    <url>/2019/10/10/2019Q4/%E4%B8%BA%E4%BB%80%E4%B9%88%200.._%20%E7%AD%89%E4%BA%8E%20undefined/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ä»Šå¤©çœ‹æ–‡ç«  <a href="https://github.com/lessfish/underscore-analysis/issues/1" target="_blank" rel="noopener">ä¸ºä»€ä¹ˆç”¨ã€Œvoid 0ã€ä»£æ›¿ã€Œundefinedã€</a> çš„æ—¶å€™ï¼Œ</p>
<p>ä½œè€…æåˆ°ï¼Œç”¨ <code>void 0</code> æ›¿ä»£ <code>undefined</code> çš„åŸå› å…¶ä¸­æœ‰ä¸€ç‚¹æ˜¯å‰è€…æ›´çŸ­ï¼Œæ›´çœç©ºé—´ã€‚</p>
<blockquote>
<p>å½“ç„¶æœ€ä¸»è¦çš„åŸå› è¿˜æ˜¯ undefined åœ¨å±€éƒ¨ä½œç”¨åŸŸä¸­å¯ä»¥è¢«é‡å†™</p>
</blockquote>
<p>ä¸‹é¢æœ‰äººå›å¤ <code>0.._</code> é•¿åº¦æ›´çŸ­ï¼Œç»“æœä¹Ÿæ˜¯ <code>undefined</code>ã€‚ åé¢è§£é‡Šè¯´æ˜¯ç›¸å½“äº <code>0[&#39;_&#39;]</code>ï¼Œä¸è¿‡æ²¡æœ‰æ›´æ·±å…¥çš„è®¨è®ºäº†ã€‚</p>
<p>å½“æ—¶å¿ƒä¸­äº§ç”Ÿäº†å‡ ä¸ªé—®é¢˜ï¼š</p>
<ol>
<li><code>0.._</code> æ˜¯å¦‚ä½•éšå¼è½¬æ¢æˆ <code>undefined</code> çš„</li>
<li>ä¸ºä½•ï¼ˆå‡ ä¹ï¼‰æ²¡æœ‰äººé‡‡ç”¨ <code>0.._</code> çš„å†™æ³•ä»£æ›¿ <code>void 0</code></li>
</ol>
<a id="more"></a>

<h2 id="0-çš„éšå¼è½¬æ¢"><a href="#0-çš„éšå¼è½¬æ¢" class="headerlink" title="0.._ çš„éšå¼è½¬æ¢"></a><code>0.._</code> çš„éšå¼è½¬æ¢</h2><h3 id="è¯æ³•åˆ†æ"><a href="#è¯æ³•åˆ†æ" class="headerlink" title="è¯æ³•åˆ†æ"></a>è¯æ³•åˆ†æ</h3><p>å¯¹äº10è¿›åˆ¶æ•°å­—æ¥è¯´ï¼Œåé¢æ¥ <code>.</code> æ“ä½œç¬¦ï¼Œjs å¼•æ“å¹¶ä¸çŸ¥é“è¯¥ <code>.</code> æ˜¯å°æ•°ç‚¹è¿˜æ˜¯è®¿é—®å±æ€§çš„ <code>.</code>ï¼Œå› æ­¤æœ‰å¦‚ä¸‹è§„å®šï¼š</p>
<p>å‰é¢çš„æ•°å­—ä¸º10è¿›åˆ¶ï¼Œå·²å¸¦å°æ•°ç‚¹çš„ï¼Œåˆ™è¯¥ <code>.</code> æ˜¯è®¿é—®å±æ€§ï¼Œå¦åˆ™å³ä¸ºå°æ•°ç‚¹ï¼›<br>è‹¥ä¸æ˜¯10è¿›åˆ¶ï¼Œåˆ™ <code>.</code> æ˜¯è®¿é—®å±æ€§</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="number">0.0</span>._ <span class="comment">// è¾“å‡º undefined  ç›¸å½“äº (0.0)._ </span></span><br><span class="line"><span class="number">0.</span>._ <span class="comment">// ç›¸å½“äº (0.)._</span></span><br><span class="line"><span class="number">00.</span>_ <span class="comment">// å‰é¢ä¸º 8è¿›åˆ¶</span></span><br><span class="line"><span class="literal">true</span>._ <span class="comment">// è¾“å‡º undefined</span></span><br><span class="line"><span class="number">0.</span>_ <span class="comment">// è¯­æ³•é”™è¯¯ .åé¢åº”è¯¥æ¥æ•°å­—</span></span><br><span class="line"></span><br><span class="line"><span class="meta">'use strict'</span>;</span><br><span class="line"><span class="number">00.</span>_ <span class="comment">// Uncaught SyntaxError: Octal literals are not allowed in strict mode. ä¸¥æ ¼æ¨¡å¼ä¸‹ä¸ä¼šè§£ææˆå…«è¿›åˆ¶</span></span><br></pre></td></tr></table></figure>

<p><strong>æ³¨</strong>ï¼šä»¥ä¸Šæ˜¯æµ‹è¯•å¾—å‡ºçš„ç»“è®ºï¼Œè§„èŒƒä¸­æ²¡æ‰¾åˆ°ã€‚</p>
<p>ä¸è¿‡æŒ‰ç¼–è¯‘åŸç†çš„çŸ¥è¯†ï¼Œå¼•æ“ä¼šå…ˆæ ¹æ® <a href="http://yanhaijing.com/es5/#65" target="_blank" rel="noopener">è¯æ³•è§£æ-æ•°å€¼å­—é¢é‡</a> æ‰¾åˆ° <code>0.</code> è¿™ä¸ªæ•°å€¼å­—é¢é‡è¯æ³•ï¼Œæ¥ç€æ‰è¿›è¡Œè¯­æ³•åˆ†æ</p>
<p>åŒæ—¶ <a href="http://yanhaijing.com/es5/#628" target="_blank" rel="noopener">é™„åŠ è¯­æ³•-æ•°å€¼å­—é¢é‡</a> ä¸­æåˆ°é strict æ¨¡å¼ä¸‹ NumericLiteral æ‰å…è®¸ OctalIntegerLiteral å…«è¿›åˆ¶çš„è¯æ³•</p>
<h3 id="è¯­æ³•åˆ†æ"><a href="#è¯­æ³•åˆ†æ" class="headerlink" title="è¯­æ³•åˆ†æ"></a>è¯­æ³•åˆ†æ</h3><p>æ¥ä¸‹æ¥å°±æ˜¯ <strong>ä¸ºä½•æ•°å€¼å­—é¢é‡èƒ½å¤Ÿè¿›è¡Œå±æ€§è®¿é—®</strong> çš„é—®é¢˜äº†ã€‚è¿™æ˜¯ä¸€ä¸ªå·¦å€¼è¡¨è¾¾å¼ã€‚</p>
<p><a href="http://yanhaijing.com/es5/#162" target="_blank" rel="noopener">å·¦å€¼è¡¨è¾¾å¼</a> è¯­æ³•,è¿™é‡Œåˆ—ä¸¾éƒ¨åˆ†</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">LeftHandSideExpression :</span><br><span class="line">NewExpression</span><br><span class="line">CallExpression</span><br><span class="line"></span><br><span class="line">CallExpression :</span><br><span class="line">MemberExpression Arguments</span><br><span class="line">CallExpression Arguments</span><br><span class="line">CallExpression [ Expression ]</span><br><span class="line">CallExpression . IdentifierName</span><br><span class="line"></span><br><span class="line">MemberExpression :</span><br><span class="line">PrimaryExpression</span><br><span class="line">FunctionExpression</span><br><span class="line">MemberExpression [ Expression ]</span><br><span class="line">MemberExpression . IdentifierName</span><br><span class="line">new MemberExpression Arguments</span><br></pre></td></tr></table></figure>

<p><a href="http://yanhaijing.com/es5/#162" target="_blank" rel="noopener">å·¦å€¼è¡¨è¾¾å¼-å±æ€§è®¿é—®</a> æœ‰ä¸¤è€…æ–¹å¼</p>
<ul>
<li>MemberExpression . IdentifierName</li>
<li>MemberExpression [ Expression ]</li>
</ul>
<p>å‰è€…ç­‰åŒäº <code>MemberExpression [ &lt;identifier-name-string&gt; ]</code></p>
<blockquote>
<p><code>&lt;identifier-name-string&gt;</code> æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²å­—é¢é‡ï¼Œå®ƒä¸ Unicode ç¼–ç åçš„ IdentifierName åŒ…å«ç›¸åŒçš„å­—ç¬¦åºåˆ—ã€‚</p>
</blockquote>
<p>å¯¹äº <code>MemberExpression [ Expression ]</code> è¡¨è¾¾å¼ï¼Œå…¶æ‰§è¡Œé¡ºåºå¦‚ä¸‹ï¼š </p>
<ol>
<li>ä»¤ baseReference ä¸ºè§£é‡Šæ‰§è¡Œ MemberExpression çš„ç»“æœ .</li>
<li>ä»¤ baseValue ä¸º <a href="http://yanhaijing.com/es5/#81" target="_blank" rel="noopener">GetValue</a>(baseReference).</li>
<li>ä»¤ propertyNameReference ä¸ºè§£é‡Šæ‰§è¡Œ Expression çš„ç»“æœ .</li>
<li>ä»¤ propertyNameValue ä¸º GetValue(propertyNameReference).</li>
<li>è°ƒç”¨ <a href="http://yanhaijing.com/es5/#114" target="_blank" rel="noopener">CheckObjectCoercible(baseValue)</a>. </li>
<li>ä»¤ propertyNameString ä¸º ToString(propertyNameValue).</li>
<li>å¦‚æœæ­£åœ¨æ‰§è¡Œä¸­çš„è¯­æ³•äº§ç”Ÿå¼åŒ…å«åœ¨ä¸¥æ ¼æ¨¡å¼ä»£ç å½“ä¸­ï¼Œä»¤ strict ä¸º true, å¦åˆ™ä»¤ strict ä¸º false.</li>
<li>è¿”å›ä¸€ä¸ª <a href="http://yanhaijing.com/es5/#80" target="_blank" rel="noopener">å¼•ç”¨ç±»å‹</a> çš„å€¼ã€‚è¯¥å¼•ç”¨ç±»å‹ï¼Œå…¶åŸº (base) å€¼ä¸º baseValue, å…¶å¼•ç”¨åç§°ï¼ˆreferenced nameï¼‰ä¸º propertyNameString, ä¸¥æ ¼æ¨¡å¼æ ‡è®°ä¸º strict.</li>
</ol>
<p>ä»¥ <code>0.._</code> ä¸ºä¾‹ï¼Œå…¶ç­‰åŒäº <code>0[&#39;_&#39;]</code>ï¼Œå³ <code>MemberExpression = 0,Expression = &#39;_&#39;</code>ï¼ŒæŒ‰ä»¥ä¸‹æ­¥éª¤è¿›è¡Œ</p>
<ol>
<li>baseReference = 0</li>
<li>baseValue = GetValue(baseReference) = 0</li>
<li>propertyNameReference = â€˜_â€™</li>
<li>propertyNameValue = GetValue(propertyNameReference) = â€˜_â€™</li>
<li>baseValue = ToObject(0) = new Number(0) // ç”Ÿæˆä¸€ä¸ªä¸´æ—¶åŒ…è£…å¯¹è±¡<blockquote>
<p>å³ <code>Number { __proto__: Number, [[PrimitiveValue]]: 0}</code></p>
</blockquote>
</li>
<li>propertyNameString = ToString(propertyNameValue) = â€˜_â€™</li>
<li>strict è®¾ç½®</li>
<li>ç”Ÿæˆå¼•ç”¨ï¼Œå…¶åŸºå€¼ä¸º <code>Number { __proto__: Number, [[PrimitiveValue]]: 0}</code>ï¼Œå¼•ç”¨åç§°ä¸º <code>_</code>ã€‚åœ¨è¯¥åŸºå€¼ï¼ˆåŠåŸå‹é“¾ï¼‰ä¸­è¿›è¡Œ<code>_</code>å±æ€§çš„å¯»æ‰¾ã€‚æœ€åæ²¡æœ‰æ‰¾åˆ°ï¼Œè¿”å› <code>undefined</code></li>
</ol>
<p>å…¶å®å…³é”®çš„å°±æ˜¯æ‰§è¡Œ <code>CheckObjectCoercible(0)</code> çš„æ—¶å€™è°ƒç”¨ <code>ToObject</code> è¿”å›äº†ä¸€ä¸ªä¸´æ—¶åŒ…è£…å¯¹è±¡</p>
<blockquote>
<p>è¿™ç‚¹è§„èŒƒè¯´çš„æœ‰ç‚¹æ¨¡ç³Šï¼Œåªè¯´äº† <strong>CheckObjectCoercible åœ¨å…¶å‚æ•°æ— æ³•ç”¨ ToObject è½¬æ¢æˆå¯¹è±¡çš„æƒ…å†µä¸‹æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸</strong>ï¼Œä½†æ˜¯æ²¡æœ‰è¯´ baseValue ä¼šè¿›è¡Œ ToObject è½¬æ¢ã€‚<br>åœ¨ <a href="https://www.zhihu.com/question/37117614/answer/70737896" target="_blank" rel="noopener">JSçš„åŸºæœ¬æ•°æ®ç±»å‹çš„ä¸´æ—¶åŒ…è£…ç±»å‹å¯¹è±¡çš„è§¦å‘æ¡ä»¶å’Œç”Ÿå‘½å‘¨æœŸæ˜¯å¤šä¹…? - è²˜åƒé¦é¦™çš„å›ç­” - çŸ¥ä¹</a> ä¸­æœ‰äººè¿›è¡Œäº†å›ç­”ã€‚</p>
</blockquote>
<h2 id="ä¸ºä½•ä¸ç”¨-0-ä»£æ›¿-void-0"><a href="#ä¸ºä½•ä¸ç”¨-0-ä»£æ›¿-void-0" class="headerlink" title="ä¸ºä½•ä¸ç”¨ 0.._ ä»£æ›¿ void 0"></a>ä¸ºä½•ä¸ç”¨ <code>0.._</code> ä»£æ›¿ <code>void 0</code></h2><p>æˆ‘ä»¬ä» å¯è¯»æ€§ã€æ€§èƒ½ã€æ­£ç¡®æ€§ ä¸‰ä¸ªæ–¹é¢åˆ†æ</p>
<h3 id="å¯è¯»æ€§"><a href="#å¯è¯»æ€§" class="headerlink" title="å¯è¯»æ€§"></a>å¯è¯»æ€§</h3><p>ä¸ <code>void 0</code> ç›¸æ¯”ï¼Œ<code>0.._</code> ä»…å‡å°‘äº†ä¸€ä¸ªå­—ç¬¦ï¼Œä½†æ˜¯è¯¥å†™æ³•å¤§å¤§å‡ä½äº†<strong>å¯è¯»æ€§</strong>ã€‚</p>
<p>å¯¹äºå‹ç¼©å·¥å…·æ¥è¯´ï¼Œä¸åœ¨ä¹å¯è¯»æ€§ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä»<strong>æ€§èƒ½</strong>è§’åº¦åˆ†æã€‚</p>
<h3 id="æ€§èƒ½"><a href="#æ€§èƒ½" class="headerlink" title="æ€§èƒ½"></a>æ€§èƒ½</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> COUNT = <span class="number">100000000</span></span><br><span class="line"><span class="keyword">var</span> tmp</span><br><span class="line"><span class="built_in">console</span>.time(<span class="string">"test1"</span>)</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> i=<span class="number">0</span>;i&lt;COUNT;i++)&#123;</span><br><span class="line">  <span class="keyword">if</span>(tmp === <span class="keyword">void</span> <span class="number">0</span>)&#123;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.timeEnd(<span class="string">"test1"</span>)</span><br><span class="line"><span class="comment">// test1: 61.760986328125ms</span></span><br><span class="line"><span class="built_in">console</span>.time(<span class="string">"test2"</span>)</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> i=<span class="number">0</span>;i&lt;COUNT;i++)&#123;</span><br><span class="line">  <span class="keyword">if</span>(tmp === <span class="number">0.</span>._)&#123;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.timeEnd(<span class="string">"test2"</span>)</span><br><span class="line"><span class="comment">// test2: 74.657958984375ms</span></span><br></pre></td></tr></table></figure>

<p><code>void 0</code> æ›´å¿«ä¸€ç‚¹ï¼Œä½†è¿™ä¸ªå½±å“ä¸å¤§ï¼Œå•æ¬¡æŒ‡ä»¤ä¹‹é—´çš„æ‰§è¡Œå·®å¼‚åœ¨å¾®ç§’ä¹‹å†…ã€‚</p>
<p>æœ€åå°±çœ‹ä¸¤è€…çš„å€¼æ˜¯ä¸æ˜¯æ­£ç¡®çš„ï¼Œå³ç»“æœæ°¸è¿œä¸º undefined</p>
<h3 id="æ­£ç¡®æ€§"><a href="#æ­£ç¡®æ€§" class="headerlink" title="æ­£ç¡®æ€§"></a>æ­£ç¡®æ€§</h3><p>å¯¹äº <code>void 0</code> ï¼Œvoid æ˜¯å…³é”®å­—ï¼Œä¸ä¼šè¢«å¤–éƒ¨æ”¹å˜ï¼Œå› æ­¤è¿”å›å€¼æ°¸è¿œè¿”å› undefined ï¼Œè§ <a href="http://yanhaijing.com/es5/#172" target="_blank" rel="noopener">void è¿ç®—ç¬¦</a></p>
<p>å¯¹äº <code>0.._</code>ï¼Œæˆ‘ä»¬ä¸Šé¢åˆ†æåˆ°ï¼Œåœ¨<code>åŸºå€¼</code>ä¸­è¿›è¡Œ<code>å¼•ç”¨åç§°</code>çš„æŸ¥æ‰¾æ—¶ï¼Œä¼šå¾€åŸå‹é“¾ä¸­æŸ¥æ‰¾ï¼Œå› æ­¤æ”¹å˜ Numberã€Object ç­‰çš„åŸå‹å±æ€§ï¼Œ<code>0.._</code> å€¼å°±ä¸ä¸€æ ·äº†</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="number">0.</span>._) <span class="comment">// undefined</span></span><br><span class="line"><span class="built_in">Object</span>.prototype._ = <span class="number">0</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="number">0.</span>._) <span class="comment">// 0</span></span><br><span class="line"><span class="built_in">Number</span>.prototype._ = <span class="number">1</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="number">0.</span>._) <span class="comment">// 1</span></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ï¼Œ <code>0.._</code> ç»“æœä¸æ˜¯å›ºå®šçš„ï¼Œå› æ­¤ä¸èƒ½ç”¨äºæ›¿æ¢ <code>void 0</code></p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ol>
<li><a href="http://yanhaijing.com/es5/" target="_blank" rel="noopener">es5 è§„èŒƒ_ä¸­æ–‡ç‰ˆ</a></li>
<li><a href="https://www.ecma-international.org/ecma-262/5.1/" target="_blank" rel="noopener">es5 è§„èŒƒ</a></li>
</ol>
<p>ps: ä¸­æ–‡ç‰ˆç¿»è¯‘æœ‰äº›åœ°æ–¹ä¸å¤Ÿå‡†ç¡®ï¼Œå¯ä»¥å…ˆçœ‹ä¸­æ–‡ç‰ˆäº†è§£å¤§æ¦‚ï¼Œå†åˆ°åŸç‰ˆä¸­è¯¦ç»†æŸ¥çœ‹</p>
]]></content>
      <categories>
        <category>å¤§å‰ç«¯</category>
      </categories>
      <tags>
        <tag>ECMAScript</tag>
      </tags>
  </entry>
  <entry>
    <title>V8æºç è§£æä¹‹Array.prototype.sort</title>
    <url>/2019/07/04/2019Q3/V8%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90%E4%B9%8BArray.prototype.sort/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å…ˆé—®ä¸ªé—®é¢˜ï¼Œä»¥ä¸‹ä»£ç è¾“å‡ºä»€ä¹ˆï¼Ÿ</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">[<span class="number">1</span>,<span class="number">2</span>,<span class="number">13</span>,<span class="number">14</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">17</span>,<span class="number">18</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">12</span>,<span class="number">31</span>,<span class="number">41</span>].sort(<span class="function"><span class="params">()</span>=&gt;</span><span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<a id="more"></a>

<p>èªæ˜çš„ä½ å¯ä»¥ä¼šè®¤ä¸ºï¼Œè¿™ä¸æ˜¯è¿”å›å…ƒç´ é¡ºåºä¸å˜çš„æ•°ç»„ä¹ˆï¼Ÿ</p>
<p>emmm æ­£å¸¸æ¥è¯´ï¼Œçš„ç¡®å¦‚æ­¤ï¼Œç„¶åæœ‰ä¸ªå°ä¼™ä¼´(chrome v59 ç¯å¢ƒ)é‡åˆ°ä¸€ä¸ªè¿™æ ·çš„é—®é¢˜</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">[<span class="number">1</span>,<span class="number">2</span>,<span class="number">13</span>,<span class="number">14</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">17</span>,<span class="number">18</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">12</span>,<span class="number">31</span>,<span class="number">41</span>].sort(<span class="function"><span class="params">()</span>=&gt;</span><span class="number">0</span>)</span><br><span class="line"><span class="comment">// [18,1,13,14,5,6,17,2,9,10,11,12,31,41]</span></span><br><span class="line">[<span class="number">1</span>,<span class="number">2</span>,<span class="number">13</span>,<span class="number">14</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">17</span>,<span class="number">18</span>,<span class="number">9</span>,<span class="number">10</span>].sort(<span class="function"><span class="params">()</span>=&gt;</span><span class="number">0</span>)</span><br><span class="line"><span class="comment">// [1,2,13,14,5,6,17,18,9,10]</span></span><br></pre></td></tr></table></figure>
<p>ç„¶åæˆ‘åœ¨è‡ªå·±ç”µè„‘ä¸Š( chrome v76 )æµ‹è¯•æ˜¯è¿™æ ·çš„ç»“æœ</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">[<span class="number">1</span>,<span class="number">2</span>,<span class="number">13</span>,<span class="number">14</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">17</span>,<span class="number">18</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">12</span>,<span class="number">31</span>,<span class="number">41</span>].sort(<span class="function"><span class="params">()</span>=&gt;</span><span class="number">0</span>)</span><br><span class="line"><span class="comment">// [1,2,13,14,5,6,17,18,9,10,11,12,31,41]</span></span><br><span class="line">[<span class="number">1</span>,<span class="number">2</span>,<span class="number">13</span>,<span class="number">14</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">17</span>,<span class="number">18</span>,<span class="number">9</span>,<span class="number">10</span>].sort(<span class="function"><span class="params">()</span>=&gt;</span><span class="number">0</span>)</span><br><span class="line"><span class="comment">// [1,2,13,14,5,6,17,18,9,10]</span></span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬çŸ¥é“ï¼Œç»™ä¸€ä¸ª sort çš„æ¯”è¾ƒå‡½æ•°ä¸­è¿”å›0ï¼Œè¡¨ç¤ºå½“å‰æ¯”è¾ƒçš„ä¸¤ä¸ªå…ƒç´ ç›¸ç­‰</p>
<p>ç…§ç†è¯´ï¼Œ<code>sort(()=&gt;0)</code> åæ•°ç»„çš„å…ƒç´ é¡ºåºæ˜¯ä¸å˜çš„ï¼Œå’Œæˆ‘çš„æµ‹è¯•æ•ˆæœä¸€è‡´ï¼Œ</p>
<p>é‚£ä¸ºä»€ä¹ˆåœ¨ ä½ç‰ˆæœ¬çš„ chrome ä¸Šï¼Œä¸åŒé•¿åº¦çš„æ•°ç»„è¿ç”¨ <code>sort(()=&gt;0)</code> åæ•ˆæœä¸ä¸€æ ·å‘¢ï¼Ÿ</p>
<p>æœ¬æ–‡å°±æ¥åšä¸ªè§£æã€‚é€šè¿‡æœ¬æ–‡ï¼Œä½ å¯ä»¥äº†è§£åˆ°ï¼š</p>
<ul>
<li>Array.prototype.sort çš„å®ç°ç»†èŠ‚ä¸é—ç•™é—®é¢˜</li>
<li>å¦‚ä½•çœ‹ JS æºç </li>
</ul>
<h2 id="å®šä¹‰"><a href="#å®šä¹‰" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">arr.sort([compareFunction])</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œæˆ‘ä»¬å¼•ç”¨ MDN çš„ä¸€æ®µè¯ï¼š</p>
<blockquote>
<p>å¦‚æœ compareFunction(a, b) å°äº 0 ï¼Œé‚£ä¹ˆ a ä¼šè¢«æ’åˆ—åˆ° b ä¹‹å‰ï¼›</p>
<p>å¦‚æœ compareFunction(a, b) å¤§äº 0 ï¼Œ b ä¼šè¢«æ’åˆ—åˆ° a ä¹‹å‰ã€‚</p>
<p>å¦‚æœ compareFunction(a, b) ç­‰äº 0 ï¼Œ a å’Œ b çš„ç›¸å¯¹ä½ç½®ä¸å˜ã€‚å¤‡æ³¨ï¼š <a href="http://yanhaijing.com/es5/#353" target="_blank" rel="noopener">ECMAScript æ ‡å‡†</a>å¹¶ä¸ä¿è¯è¿™ä¸€è¡Œä¸ºï¼Œè€Œä¸”ä¹Ÿä¸æ˜¯æ‰€æœ‰æµè§ˆå™¨éƒ½ä¼šéµå®ˆï¼ˆä¾‹å¦‚ Mozilla åœ¨ 2003 å¹´ä¹‹å‰çš„ç‰ˆæœ¬ï¼‰</p>
</blockquote>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œæœ‰äº›æµè§ˆå™¨ä¸éµå¾ª <code>compareFunction(a, b) ç­‰äº 0æ—¶ï¼Œ a å’Œ b çš„ç›¸å¯¹ä½ç½®ä¸å˜</code> çš„è§„åˆ™</p>
<p>è¿™é‡Œæˆ‘ä»¬çœ‹å‡ºæ¥äº†ï¼Œchrome v59 å°±æ˜¯ä¸éµå¾ªè¯¥è§„åˆ™çš„ã€‚ ä½†æ˜¯æ•°ç»„é•¿åº¦è¾ƒå°æ—¶å¥½åƒåˆéµå¾ªäº†ï¼Ÿ</p>
<p>è¿™é‡Œæˆ‘ä»¬çŒœæµ‹ä¸åŒé•¿åº¦çš„æ•°ç»„ä¼šè¿ç”¨ä¸åŒçš„æ’åºç®—æ³•</p>
<p>åœ¨åˆ†ææºç ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆç®€å•æä¸‹ï¼Œä»€ä¹ˆæ˜¯ æ’å…¥æ’åº å’Œ å¿«é€Ÿæ’åº</p>
<h2 id="æ’åºç®—æ³•"><a href="#æ’åºç®—æ³•" class="headerlink" title="æ’åºç®—æ³•"></a>æ’åºç®—æ³•</h2><p>æˆ‘ä»¬å‡è®¾æ¯”è¾ƒå‡½æ•°ä¸º</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">comparefn = <span class="function">(<span class="params">a,b</span>)=&gt;</span> a-b</span><br></pre></td></tr></table></figure>

<h3 id="1-æ’å…¥æ’åº"><a href="#1-æ’å…¥æ’åº" class="headerlink" title="1. æ’å…¥æ’åº"></a>1. æ’å…¥æ’åº</h3><blockquote>
<p>éå†æ•°ç»„ï¼Œå°†æ¯ä¸ªå¾…æ’åºå…ƒç´ æ’å…¥åˆ°å‰é¢å·²æ’åºçš„é€‚å½“ä½ç½®</p>
</blockquote>
<p>æ’å…¥æ’åºåˆ†ä¸ºç›´æ¥æ’å…¥æ’åºã€äºŒåˆ†æŸ¥æ‰¾æ’å…¥æ’åºã€å¸Œå°”æ’åº</p>
<p>ç”±äº v8 ä¹Ÿåªæ˜¯ç”¨äº†ç›´æ¥æ’å…¥æ’åºï¼Œè¿™é‡Œæˆ‘ä»¬åªå®ç°å®ƒ,å…¶ä»–å‡ ç§ä¸è¿›è¡Œè®¨è®ºï¼Œæƒ³è¦äº†è§£çš„å¯ä»¥å‚è€ƒâ€“<a href="https://www.cnblogs.com/heyuquan/p/insert-sort.html" target="_blank" rel="noopener">ä¼˜åŒ–çš„ç›´æ¥æ’å…¥æ’åº</a></p>
<p><img src="https://upload-images.jianshu.io/upload_images/9277731-e6e3d03ebc90be7b.gif?imageMogr2/auto-orient/strip" alt="å¼•ç”¨è‡ª wikipedia"></p>
<p>å®ç°ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">InsertionSort</span>(<span class="params">array</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">1</span>; i &lt; array.legnth; i++) &#123;</span><br><span class="line">    <span class="keyword">let</span> element = array[i];</span><br><span class="line">    <span class="comment">// å°†å¾…æ’åºå…ƒç´ elementæ’å…¥å¯¹åº”ä½ç½®</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> j = i - <span class="number">1</span>; j &gt;= <span class="number">0</span>; j--) &#123;</span><br><span class="line">      <span class="keyword">let</span> tmp = array[j];</span><br><span class="line">      <span class="comment">// comparefn &gt; 0 è¡¨ç¤ºelementè¦æ’åœ¨tmpä¹‹å‰</span></span><br><span class="line">      <span class="keyword">if</span> (comparefn(tmp, element) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        a[j + <span class="number">1</span>] = tmp;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    a[j + <span class="number">1</span>] = element;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="2-å¿«é€Ÿæ’åº"><a href="#2-å¿«é€Ÿæ’åº" class="headerlink" title="2. å¿«é€Ÿæ’åº"></a>2. å¿«é€Ÿæ’åº</h3><blockquote>
<p>è®¾å®šä¸€ä¸ªåŸºå‡†ï¼Œåˆ©ç”¨è¯¥åŸºå‡†å€¼å¤§å°å°†æ•°ç»„åˆ†ä¸ºå·¦å³ä¸¤éƒ¨åˆ†</p>
<p>æ­¤æ—¶å·¦å³ä¸¤éƒ¨åˆ†å¯ä»¥ç‹¬ç«‹æ’åºï¼Œåˆ†åˆ«å¯¹å·¦å³ä¸¤éƒ¨åˆ†è¿›è¡Œä¸Šé¢çš„æ“ä½œ</p>
<p>é€’å½’å¤„ç†ï¼Œç›´è‡³æ•°ç»„æ’åºå®Œæˆ</p>
</blockquote>
<p>è€ƒè™‘åˆ°ç©ºé—´æ¶ˆè€—ï¼Œç°åœ¨çš„å¿«é€Ÿæ’åºä¸€èˆ¬éƒ½æ˜¯æŒ‡<code>åŸåœ°ç®—æ³•</code>çš„å¿«é€Ÿæ’åº</p>
<p>å…³äºåŸåœ°ç®—æ³•ï¼Œå‚çœ‹ <a href="https://en.wikipedia.org/wiki/In-place_algorithm" target="_blank" rel="noopener">https://en.wikipedia.org/wiki/In-place_algorithm</a></p>
<p>ä¸‹é¢æœ‰ä¸¤è€…å®ç°ï¼ŒåŸºå‡†å€¼å–å·¦è¾¹çš„æˆ–è€…å³è¾¹ï¼Œæ•ˆæœå·®ä¸å¤š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/9277731-fde423214816b518.gif?imageMogr2/auto-orient/strip" alt="å¼•ç”¨è‡ª wikipedia"></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">qsort</span>(<span class="params">array</span>)</span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">swap</span>(<span class="params">arr,i1,i2</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">let</span> tmp = arr[i1]</span><br><span class="line">    arr[i1] = arr[i2]</span><br><span class="line">    arr[i2] = tmp</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">partition</span>(<span class="params">arr, left, right</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">let</span> storeIndex = left <span class="comment">// å…¶å€¼ç­‰äºè¡¨ç¤ºå·²æ‰¾åˆ°çš„å°äºåŸºå‡†å€¼çš„å…ƒç´ ä¸ªæ•°</span></span><br><span class="line">    <span class="keyword">let</span> pivot = arr[right] <span class="comment">//åŸºå‡†</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i=left;i&lt;right;i++)&#123;</span><br><span class="line">      <span class="keyword">if</span>(arr[i]&lt;pivot)&#123;</span><br><span class="line">        swap(arr,storeIndex++,i)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    swap(arr,storeIndex,right)</span><br><span class="line">    <span class="keyword">return</span> storeIndex</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// åŸºå‡†åœ¨å·¦è¾¹</span></span><br><span class="line">  <span class="comment">// function partition(arr, left, right)&#123;</span></span><br><span class="line">  <span class="comment">//   let storeIndex = left</span></span><br><span class="line">  <span class="comment">//   let pivot = arr[left] //åŸºå‡†</span></span><br><span class="line">  <span class="comment">//   for(let i = left+1;i&lt;=right;i++)&#123;</span></span><br><span class="line">  <span class="comment">//     if(arr[i]&lt;pivot)&#123;</span></span><br><span class="line">  <span class="comment">//       swap(arr,++storeIndex,i)</span></span><br><span class="line">  <span class="comment">//     &#125;</span></span><br><span class="line">  <span class="comment">//   &#125;</span></span><br><span class="line">  <span class="comment">//   swap(arr,storeIndex,left)</span></span><br><span class="line">  <span class="comment">//   return storeIndex</span></span><br><span class="line">  <span class="comment">// &#125;</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">sort</span>(<span class="params">arr,left,right</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(left&lt;right)&#123;</span><br><span class="line">      <span class="keyword">let</span> storeIndex = partition(arr, left, right);</span><br><span class="line">      sort(arr, left, storeIndex - <span class="number">1</span>);</span><br><span class="line">      sort(arr, storeIndex + <span class="number">1</span>, right);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  sort(array, <span class="number">0</span>, array.length - <span class="number">1</span>);</span><br><span class="line">  <span class="keyword">return</span> array</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="v8-æºç åˆ†æ"><a href="#v8-æºç åˆ†æ" class="headerlink" title="v8 æºç åˆ†æ"></a>v8 æºç åˆ†æ</h2><p>ç†è§£äº†åŸºæœ¬çš„æ’åºç®—æ³•ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å¼€å§‹ç ”ç©¶æºç ã€‚</p>
<p>æ¯”è¾ƒ chrome v59 å’Œ chrome v76 çš„ v8 å®ç°å·®å¼‚åœ¨å“ª</p>
<h3 id="å¦‚ä½•æŸ¥æ‰¾å¯¹åº”chromeç‰ˆæœ¬çš„-v8-æºç "><a href="#å¦‚ä½•æŸ¥æ‰¾å¯¹åº”chromeç‰ˆæœ¬çš„-v8-æºç " class="headerlink" title="å¦‚ä½•æŸ¥æ‰¾å¯¹åº”chromeç‰ˆæœ¬çš„ v8 æºç "></a>å¦‚ä½•æŸ¥æ‰¾å¯¹åº”chromeç‰ˆæœ¬çš„ v8 æºç </h3><p>æ‰“å¼€<code>chrome://version/</code></p>
<p>ä¸Šé¢æ˜¾ç¤ºçš„ JavaScript å³æ˜¯ v8 çš„ç‰ˆæœ¬</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Google Chrome	76.0.3809.132 (æ­£å¼ç‰ˆæœ¬) ï¼ˆ64 ä½ï¼‰ (cohort: Stable)</span><br><span class="line">æ“ä½œç³»ç»Ÿ	Windows 10 OS Version 1809 (Build 17763.316)</span><br><span class="line">JavaScript	V8 7.6.303.29</span><br></pre></td></tr></table></figure>
<p>ä¹Ÿæ­£å¦‚ <a href="https://v8.dev/docs/version-numbers" target="_blank" rel="noopener">V8â€™s version numbering scheme</a> æ‰€è¿°</p>
<p><code>Chromium 76</code> å¯¹åº” v8 çš„ <code>7.6</code></p>
<p>æ¥ç€æˆ‘ä»¬ç›´æ¥å» <a href="https://github.com/v8/v8" target="_blank" rel="noopener">v8</a> æŸ¥çœ‹æºç ï¼Œè¿™é‡Œä¸»è¦çœ‹ä¸¤ä¸ªç‰ˆæœ¬çš„</p>
<h3 id="5-9-221"><a href="#5-9-221" class="headerlink" title="5.9.221"></a>5.9.221</h3><p>å¯¹åº”çš„æ’åºç®—æ³• <a href="https://github.com/v8/v8/blob/5.9.221/src/js/array.js#L709" target="_blank" rel="noopener">æºç åœ°å€</a></p>
<p><em>ç»“åˆæµ‹è¯•ç”¨ä¾‹çœ‹æ›´ä½³ <a href="https://github.com/v8/v8/blob/5.9.221/test/mjsunit/array-sort.js" target="_blank" rel="noopener">/test/mjsunit/array-sort</a></em></p>
<p>å¯ä»¥çœ‹å‡ºæ¥ï¼Œæ—©æœŸv8 æ’åºçš„å®ç°é€»è¾‘æ˜¯ç”¨jså†™çš„ï¼Œå¯¹åº”çš„å®ç°ä¸º ArraySort</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">utils.InstallFunctions(GlobalArray.prototype, DONT_ENUM, [</span><br><span class="line">  ...</span><br><span class="line">  <span class="string">"sort"</span>, getFunction(<span class="string">"sort"</span>, ArraySort),</span><br><span class="line">  ...</span><br><span class="line">])</span><br></pre></td></tr></table></figure>
<ul>
<li>ArraySort </li>
</ul>
<p>æ²¡æœ‰ä»€ä¹ˆæœ‰ç”¨ä»£ç ï¼Œç›´æ¥è¿›å…¥ InnerArraySort</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ArraySort</span>(<span class="params">comparefn</span>) </span>&#123;</span><br><span class="line">  CHECK_OBJECT_COERCIBLE(<span class="keyword">this</span>, <span class="string">"Array.prototype.sort"</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> array = TO_OBJECT(<span class="keyword">this</span>);</span><br><span class="line">  <span class="keyword">var</span> length = TO_LENGTH(array.length);</span><br><span class="line">  <span class="keyword">return</span> InnerArraySort(array, length, comparefn);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>InnerArraySort </li>
</ul>
<p>å¯¹ç±»æ•°ç»„å¯¹è±¡ä»¥åŠç©ºæ´æ•°ç»„è¿›è¡Œç‰¹æ®Šå¤„ç†ï¼Œç„¶åè¿›è¡Œæ’åº</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// comparefn ä¸å¯è°ƒç”¨ï¼ˆæœªå®šä¹‰ï¼Œéfunctionç­‰ï¼‰ï¼Œè®¾ç½®é»˜è®¤å‡½æ•°</span></span><br><span class="line"><span class="keyword">if</span> (!IS_CALLABLE(comparefn)) &#123;</span><br><span class="line">  comparefn = <span class="function"><span class="keyword">function</span> (<span class="params">x, y</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x === y) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (% _IsSmi(x) &amp;&amp; % _IsSmi(y)) &#123;</span><br><span class="line">      <span class="keyword">return</span> % SmiLexicographicCompare(x, y);</span><br><span class="line">    &#125;</span><br><span class="line">    x = TO_STRING(x);</span><br><span class="line">    y = TO_STRING(y);</span><br><span class="line">    <span class="keyword">if</span> (x == y) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> x &lt; y ? <span class="number">-1</span> : <span class="number">1</span>;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (length &lt; <span class="number">2</span>) <span class="keyword">return</span> array;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> is_array = IS_ARRAY(array);</span><br><span class="line"><span class="keyword">var</span> max_prototype_element;</span><br><span class="line"><span class="keyword">if</span> (!is_array) &#123;</span><br><span class="line">  <span class="comment">// å¯¹ ç±»æ•°ç»„å¯¹è±¡ï¼ˆæ¯”å¦‚ &#123;length:10,0:'c',10:'b'&#125;ï¼‰ è¿›è¡Œæ’åºï¼Œå…¼å®¹ JSCæ ‡å‡†</span></span><br><span class="line">  <span class="comment">// è€ƒè™‘äº†ç»§æ‰¿å±æ€§ï¼Œæ‰€ä»¥æ•ˆç‡å¯èƒ½ä¸é«˜ï¼Œä¸è¿‡è¿™ç§éœ€è¦æ’åºçš„æƒ…å†µè¾ƒå°‘</span></span><br><span class="line">  <span class="comment">// e.g. ä¹Ÿå¯ä»¥çœ‹è¿™ä¸ªä¾‹å­ https://github.com/v8/v8/blob/5.9.221/test/mjsunit/array-sort.js#L337</span></span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">  let f1 = &#123;1: "c", 3: "f"&#125;</span></span><br><span class="line"><span class="comment">  let f2 = &#123;6: "a", length: 10&#125;</span></span><br><span class="line"><span class="comment">  f2.__proto__ = f1</span></span><br><span class="line"><span class="comment">  f2 // &#123;6: "a", length: 10,__proto__:&#123;1: "c", 3: "f"&#125;&#125;</span></span><br><span class="line"><span class="comment">  Array.prototype.sort.call(f2) // &#123;0: "a", 1: "b", 2: "c", 3: "f", length: 10&#125;</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="comment">// è¿”å›è‡ªèº«åŠåŸå‹é“¾ä¸­æ‰€æœ‰å±æ€§çš„ä¸ªæ•°</span></span><br><span class="line">  max_prototype_element = CopyFromPrototype(array, length);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å¿«é€ŸRemoveArrayHolesï¼šä»æ•°ç»„æœ«å°¾å¤åˆ¶å·²å®šä¹‰å…ƒç´ å¡«å……åˆ°å‰é¢çš„ç©ºæ´ï¼ˆæœ«å°¾å˜ä¸ºç©ºæ´ï¼‰</span></span><br><span class="line"><span class="comment">// ç±»æ•°ç»„å¯¹è±¡ç­‰æƒ…å†µä¸æ”¯æŒå¿«é€ŸRemoveArrayHolesï¼Œä¼šè¿”å› -1</span></span><br><span class="line"><span class="comment">// å¦åˆ™ è¿”å›å·²å®šä¹‰å…ƒç´ çš„ä¸ªæ•°</span></span><br><span class="line"><span class="keyword">var</span> num_non_undefined = % RemoveArrayHoles(array, length);</span><br><span class="line"><span class="comment">// å¤„ç†ç±»æ•°ç»„å¯¹è±¡ç­‰æƒ…å†µ</span></span><br><span class="line"><span class="keyword">if</span> (num_non_undefined == <span class="number">-1</span>) &#123;</span><br><span class="line">  <span class="comment">// è¿”å› ç±»æ•°ç»„å¯¹è±¡çš„å·²å®šä¹‰å®ä¾‹å±æ€§çš„ä¸ªæ•°</span></span><br><span class="line">  num_non_undefined = SafeRemoveArrayHoles(array);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">QuickSort(array, <span class="number">0</span>, num_non_undefined);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!is_array &amp;&amp; (num_non_undefined + <span class="number">1</span> &lt; max_prototype_element)) &#123;</span><br><span class="line">  <span class="comment">// å¤„ç† åŸå‹åŒåå±æ€§ ç­‰æƒ…å†µ</span></span><br><span class="line">  ShadowPrototypeElements(array, num_non_undefined, max_prototype_element);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> array;</span><br></pre></td></tr></table></figure>
<p>å…¶ä»–çš„ç‰¹æ®Šå¤„ç†ä¸åœ¨æ–‡æœ¬è®ºè¿°ä¸­ï¼Œæˆ‘ä»¬ç›´æ¥çœ‹æ’åºå®ç°</p>
<ul>
<li>QuickSort</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">QuickSort</span> (<span class="params">a, from, to</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// åŸºå‡†é€‰æ‹©ç¬¬ä¸€ä¸ªå…ƒç´ </span></span><br><span class="line">  <span class="keyword">var</span> third_index = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">    <span class="comment">// å¾…æ’åºæ•°ç»„é•¿åº¦ &lt;= 10 é‡‡ç”¨æ’å…¥æ’åº</span></span><br><span class="line">    <span class="keyword">if</span> (to - <span class="keyword">from</span> &lt;= <span class="number">10</span>) &#123;</span><br><span class="line">      InsertionSort(a, <span class="keyword">from</span>, to);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (to - <span class="keyword">from</span> &gt; <span class="number">1000</span>) &#123;</span><br><span class="line">      <span class="comment">// æ¯éš” 200 ~ 215 ï¼ˆæ ¹æ® length &amp; 15çš„ç»“æœï¼‰ä¸ªå…ƒç´ å–ä¸€ä¸ªå€¼ï¼Œ</span></span><br><span class="line">      <span class="comment">// ç„¶åå°†è¿™äº›å€¼è¿›è¡Œæ’åºï¼Œå–ä¸­é—´å€¼çš„ä¸‹æ ‡</span></span><br><span class="line">      <span class="comment">// è¿™é‡Œçš„æ’åºå…¶å®åˆæ˜¯ä¸€ä¸ªé€’å½’è°ƒç”¨</span></span><br><span class="line">      third_index = GetThirdIndex(a, <span class="keyword">from</span>, to);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// å°†ä¸­é—´å…ƒç´ è®¾ä¸ºåŸºå‡†å€¼</span></span><br><span class="line">      third_index = <span class="keyword">from</span> + ((to - <span class="keyword">from</span>) &gt;&gt; <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å°†ç¬¬ä¸€ä¸ª,ä¸­é—´å…ƒç´ ï¼ˆä¸Šé¢è·å–çš„åŸºå‡†å€¼ï¼‰ï¼Œæœ€åä¸€ä¸ªå…ƒç´ ä¸‰è€…ä¸­çš„ä¸­ä½æ•°ä½œä¸ºåŸºå‡†å€¼</span></span><br><span class="line">    <span class="keyword">var</span> v0 = a[<span class="keyword">from</span>];</span><br><span class="line">    <span class="keyword">var</span> v1 = a[to - <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">var</span> v2 = a[third_index];</span><br><span class="line">    <span class="keyword">var</span> c01 = comparefn(v0, v1);</span><br><span class="line">    <span class="keyword">if</span> (c01 &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="comment">// v1 &lt; v0, so swap them.</span></span><br><span class="line">      <span class="keyword">var</span> tmp = v0;</span><br><span class="line">      v0 = v1;</span><br><span class="line">      v1 = tmp;</span><br><span class="line">    &#125; <span class="comment">// v0 &lt;= v1.</span></span><br><span class="line">    <span class="keyword">var</span> c02 = comparefn(v0, v2);</span><br><span class="line">    <span class="keyword">if</span> (c02 &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="comment">// v2 &lt;= v0 &lt;= v1.</span></span><br><span class="line">      <span class="keyword">var</span> tmp = v0;</span><br><span class="line">      v0 = v2;</span><br><span class="line">      v2 = v1;</span><br><span class="line">      v1 = tmp;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// v0 &lt;= v1 &amp;&amp; v0 &lt; v2</span></span><br><span class="line">      <span class="keyword">var</span> c12 = comparefn(v1, v2);</span><br><span class="line">      <span class="keyword">if</span> (c12 &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// v0 &lt;= v2 &lt; v1</span></span><br><span class="line">        <span class="keyword">var</span> tmp = v1;</span><br><span class="line">        v1 = v2;</span><br><span class="line">        v2 = tmp;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æœ€ç»ˆæ•ˆæœ v0 &lt;= v1 &lt;= v2</span></span><br><span class="line">    a[<span class="keyword">from</span>] = v0;</span><br><span class="line">    a[to - <span class="number">1</span>] = v2;</span><br><span class="line">    <span class="keyword">var</span> pivot = v1;</span><br><span class="line">    <span class="keyword">var</span> low_end = <span class="keyword">from</span> + <span class="number">1</span>;   <span class="comment">// æ¯”åŸºå‡†å€¼å°çš„å…ƒç´ çš„ä¸Šç•Œ</span></span><br><span class="line">    <span class="keyword">var</span> high_start = to - <span class="number">1</span>;  <span class="comment">// æ¯”åŸºå‡†å€¼å¤§çš„å…ƒç´ çš„ä¸‹ç•Œ</span></span><br><span class="line">    <span class="comment">// å°†åŸºå‡†å€¼ä¸ from + 1 ä½ç½®çš„å…ƒç´ è¿›è¡Œäº’æ¢</span></span><br><span class="line">    <span class="comment">// æ­¤æ—¶ from + 1 ä½ç½®çš„å…ƒç´ è‚¯å®šæ˜¯è¦æ’ form ä½ç½®åé¢çš„</span></span><br><span class="line">    a[third_index] = a[low_end];</span><br><span class="line">    a[low_end] = pivot;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ’åˆ†å‡½æ•° å°†å°äºï¼ˆå‡è®¾å‡åºæ’åºï¼‰åŸºå‡†å€¼çš„å…ƒç´ æ’åœ¨å·¦è¾¹</span></span><br><span class="line">    partition: <span class="keyword">for</span> (<span class="keyword">var</span> i = low_end + <span class="number">1</span>; i &lt; high_start; i++) &#123;</span><br><span class="line">      <span class="keyword">var</span> element = a[i];</span><br><span class="line">      <span class="keyword">var</span> order = comparefn(element, pivot);</span><br><span class="line">      <span class="keyword">if</span> (order &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        a[i] = a[low_end];</span><br><span class="line">        a[low_end] = element;</span><br><span class="line">        low_end++;</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (order &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// å½“å¾…æ’åºå…ƒç´ å¤§äºåŸºå‡†å€¼æ—¶ï¼Œ</span></span><br><span class="line">        <span class="comment">// ä¸åˆ°å³ä¾§ç¬¬ä¸€ä¸ªå°äºåŸºå‡†å€¼çš„å…ƒç´ äº’æ¢</span></span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">          high_start--;</span><br><span class="line">          <span class="keyword">if</span> (high_start == i) <span class="keyword">break</span> partition;</span><br><span class="line">          <span class="keyword">var</span> top_elem = a[high_start];</span><br><span class="line">          order = comparefn(top_elem, pivot);</span><br><span class="line">        &#125; <span class="keyword">while</span> (order &gt; <span class="number">0</span>);</span><br><span class="line">        a[i] = a[high_start];</span><br><span class="line">        a[high_start] = element;</span><br><span class="line">        <span class="comment">// è¯¥å…ƒç´ å°äºåŸºå‡†å€¼ï¼Œéœ€è¦æ’åœ¨åŸºå‡†å€¼å·¦è¾¹</span></span><br><span class="line">        <span class="keyword">if</span> (order &lt; <span class="number">0</span>) &#123;</span><br><span class="line">          element = a[i];</span><br><span class="line">          a[i] = a[low_end];</span><br><span class="line">          a[low_end] = element;</span><br><span class="line">          low_end++;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å¯¹å·¦å³ä¸¤ä¸ªå­æ•°ç»„å†è¿›è¡Œæ’åº</span></span><br><span class="line">    <span class="comment">// å…ˆå¤„ç†å¾…æ’åºå…ƒç´ è¾ƒå°‘çš„</span></span><br><span class="line">    <span class="keyword">if</span> (to - high_start &lt; low_end - <span class="keyword">from</span>) &#123;</span><br><span class="line">      QuickSort(a, high_start, to);</span><br><span class="line">      to = low_end;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      QuickSort(a, <span class="keyword">from</span>, low_end);</span><br><span class="line">      <span class="keyword">from</span> = high_start;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>åœ¨åŸºå‡†é€‰æ‹©ä¸Šåšäº†å„ç§å¤„ç†ï¼Œè¯¦ç»†çœ‹æ³¨é‡Š</p>
<p>ä»¥æ­£å¸¸çš„å‡åºæ’åºä¸ºä¾‹</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">array &#x3D; [1,2,13,14,5,6,17,18,9,10,11,12,31,14,51]</span><br><span class="line">comparefn &#x3D; (a,b)&#x3D;&gt;a-b</span><br></pre></td></tr></table></figure>

<p>ç¬¬ä¸€è½®æ‰§è¡Œè¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li>third_index = 7, from = 0, to = 15, pivot = a[7] = 18, low_end = 1, high_start = 14, a[7] = a[1] = 2, a[1] = 18<blockquote>
<p>[1,18,13,14,5,6,17,2,9,10,11,12,31,14,51]</p>
</blockquote>
</li>
<li>è¿›å…¥ partition å¾ªç¯ï¼Œä» i=2å¼€å§‹æ¯”è¾ƒ</li>
<li>i=2,ç”±äº a[i] &lt; pivot, æ­¤æ—¶ a[2] = a[low_end] = a[1] = 18, low_end = 2<blockquote>
<p>[1,13,18,14,5,6,17,2,9,10,11,12,31,14,51]</p>
</blockquote>
</li>
<li>ç›´åˆ° i=12 æ‰å‡ºç° a[i]=31 &gt; pivot, è¿™æ®µè¿‡ç¨‹ç»“æŸå low_end = 11<blockquote>
<p>[1,13,14,5,6,17,2,9,10,11,12,18,31,14,51]</p>
</blockquote>
</li>
<li>i=12,ç”±äº a[12] = 31 &gt; pivot,high_start = 13,ç”±äº a[13] &lt; pivot,a[i=12]=a[13]=14,a[13]=31<blockquote>
<p>[1,13,14,5,6,17,2,9,10,11,12,18,14,31,51]</p>
</blockquote>
</li>
<li>åŒæ—¶ç”±äº a[13] &lt; pivotï¼Œa[12] = a[low_end] = a[11] = 18,a[11] = 31, low_end = 12<blockquote>
<p>[1,13,14,5,6,17,2,9,10,11,12,14,18,31,51]</p>
</blockquote>
</li>
<li>i &lt; high_start ä¸æˆç«‹ï¼Œå¾ªç¯ä¸­æ–­</li>
<li>to - high_start = 14-13=1ï¼Œlow_end - from = 12ï¼Œåˆ†åˆ«è¿›è¡Œ QuickSort(a,13,14) å’Œ QuickSort(a,0,12)</li>
<li>ç»§ç»­æ–°ä¸€è½®çš„æ‰§è¡Œ</li>
</ol>
<p>çœ‹ä¸Šå»æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œè¿™æ¬¡é‡‡ç”¨å¼€å¤´çš„ä¾‹å­</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">array &#x3D; [1,2,13,14,5,6,17,18,9,10,11,12,31,14,51]</span><br><span class="line">comparefn &#x3D; (a,b)&#x3D;&gt;0</span><br></pre></td></tr></table></figure>

<p>ç¬¬ä¸€è½®æ‰§è¡Œè¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li>third_index = 7, from = 0, to = 15, v0=a[0]=1,v[1]=a[14]=51,v[2]=a[7]=18,</li>
<li>ç”±äº comparefn(v0, v2)&gt;=0,è¡¨ç¤º v2 &lt;= v0 &lt;= v1,v0=18,v1=1,v2=51, a[0]=18,a[14]=51,pivot = v1 = 1, low_end = 1, high_start = 14, a[7] = a[1] = 2, a[1] = 1<blockquote>
<p>[18,1,13,14,5,6,17,2,9,10,11,12,31,14,51]</p>
</blockquote>
</li>
<li>è¿›å…¥ partition å¾ªç¯ï¼Œä» i=2å¼€å§‹æ¯”è¾ƒ,ç”±äº comparefn(element, pivot)=0 ä¸è¿›è¡Œå¤„ç†ç›´è‡³å¾ªç¯ç»“æŸ</li>
<li>to - high_start = 14-14=0ï¼Œlow_end - from = 0ï¼Œæ•…å…ˆè¿›è¡Œ QuickSort(a,0,0) å†è¿›å…¥å¾ªç¯åˆ¤æ–­ QuickSort(a,14,14)</li>
<li>åˆ¤æ–­ç»“æŸï¼Œè¿”å› [18,1,13,14,5,6,17,2,9,10,11,12,31,14,51]</li>
</ol>
<p>å¯ä»¥çœ‹å‡ºæ¥ï¼Œv8æºç æœ‰ä¸¤ä¸ªé—®é¢˜</p>
<h4 id="â‘ -v0-v1-v2-çš„äº¤æ¢å¤„ç†ä»£ç "><a href="#â‘ -v0-v1-v2-çš„äº¤æ¢å¤„ç†ä»£ç " class="headerlink" title="â‘  v0,v1,v2 çš„äº¤æ¢å¤„ç†ä»£ç "></a>â‘  v0,v1,v2 çš„äº¤æ¢å¤„ç†ä»£ç </h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">comparefn = <span class="function">(<span class="params">a,b</span>)=&gt;</span><span class="number">0</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">swap</span> (<span class="params">[v0, v1, v2]</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ç»™å®š v0,v1,v2</span></span><br><span class="line">  <span class="comment">// å¯¹å…¶è¿›è¡Œæ’åºï¼Œä¿è¯ v0&lt;=v1&lt;=v2</span></span><br><span class="line">  <span class="keyword">var</span> c01 = comparefn(v0, v1);</span><br><span class="line">  <span class="keyword">if</span> (c01 &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="comment">// v1 &lt; v0, so swap them.</span></span><br><span class="line">    <span class="keyword">var</span> tmp = v0;</span><br><span class="line">    v0 = v1;</span><br><span class="line">    v1 = tmp;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// æ­¤æ—¶ v0 &lt;= v1.</span></span><br><span class="line">  <span class="keyword">var</span> c02 = comparefn(v0, v2);</span><br><span class="line">  <span class="keyword">if</span> (c02 &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="comment">// v2 &lt; v0 &lt;= v1.çš„æƒ…å†µ è¿›è¡Œäº¤æ¢</span></span><br><span class="line">    <span class="keyword">var</span> tmp = v0;</span><br><span class="line">    v0 = v2;</span><br><span class="line">    v2 = v1;</span><br><span class="line">    v1 = tmp;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// v0 &lt;= v1 &amp;&amp; v0 &lt;= v2</span></span><br><span class="line">    <span class="keyword">var</span> c12 = comparefn(v1, v2);</span><br><span class="line">    <span class="keyword">if</span> (c12 &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="comment">// v1 &gt; v2</span></span><br><span class="line">      <span class="keyword">var</span> tmp = v1;</span><br><span class="line">      v1 = v2;</span><br><span class="line">      v2 = tmp;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> [v0, v1, v2]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸»è¦æ˜¯ c02 çš„åˆ¤æ–­ä¸Šæ”¹ä¸º <code>&gt;</code> ,ä¿è¯ v0ä¸v2ç›¸åŒæ—¶ ä¸ä¼šè¿›è¡Œäº¤æ¢</p>
<h4 id="â‘¡-é‡æ–°èµ‹å€¼"><a href="#â‘¡-é‡æ–°èµ‹å€¼" class="headerlink" title="â‘¡ é‡æ–°èµ‹å€¼"></a>â‘¡ é‡æ–°èµ‹å€¼</h4><p>åŸæ¥ä»£ç åœ¨äº¤æ¢åï¼Œåšäº†è¿™äº›æ“ä½œï¼Œæ²¡æœ‰è€ƒè™‘ç›¸ç­‰çš„æƒ…å†µ</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">a[<span class="keyword">from</span>] = v0;</span><br><span class="line">a[to - <span class="number">1</span>] = v2;</span><br><span class="line"><span class="keyword">var</span> pivot = v1;</span><br><span class="line"><span class="keyword">var</span> low_end = <span class="keyword">from</span> + <span class="number">1</span>;   <span class="comment">// Upper bound of elements lower than pivot.</span></span><br><span class="line"><span class="keyword">var</span> high_start = to - <span class="number">1</span>;  <span class="comment">// Lower bound of elements greater than pivot.</span></span><br><span class="line">a[third_index] = a[low_end];</span><br><span class="line">a[low_end] = pivot;</span><br></pre></td></tr></table></figure>
<p>å‡è®¾ v0,v1,v2çš„é¡ºåºä¸å˜ï¼Œä½†æ˜¯åŸæ¥ <code>a[to-1]</code> çš„å€¼æ˜¯v1 æ­¤æ—¶å˜æˆv2,æ•…åœ¨ä¸€å¼€å§‹èµ‹å€¼æ—¶åº”è¯¥å˜æ›´é¡ºåº</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> v0 = a[<span class="keyword">from</span>];</span><br><span class="line"><span class="keyword">var</span> v1 = a[third_index];</span><br><span class="line"><span class="keyword">var</span> v2 = a[to - <span class="number">1</span>];</span><br></pre></td></tr></table></figure>
<p><code>a[third_index]</code> æ˜¯å¦ä¸ <code>a[low_end]</code> äº¤æ¢ï¼Œä¹Ÿåº”è¯¥åšä¸ªåˆ¤æ–­</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(comparefn(pivot,a[low_end])!==<span class="number">0</span>)&#123;</span><br><span class="line">  a[third_index] = a[low_end];</span><br><span class="line">  a[low_end] = pivot;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  a[third_index] = pivot</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ä¼˜åŒ–åçš„å¿«æ’å‡½æ•°</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ArraySort</span> (<span class="params">array, comparefn</span>) </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">InsertionSort</span> (<span class="params">a, from, to</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="keyword">from</span> + <span class="number">1</span>; i &lt; to; i++) &#123;</span><br><span class="line">      <span class="keyword">var</span> element = a[i];</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">var</span> j = i - <span class="number">1</span>; j &gt;= <span class="keyword">from</span>; j--) &#123;</span><br><span class="line">        <span class="keyword">var</span> tmp = a[j];</span><br><span class="line">        <span class="keyword">var</span> order = comparefn(tmp, element);</span><br><span class="line">        <span class="keyword">if</span> (order &gt; <span class="number">0</span>) &#123;</span><br><span class="line">          a[j + <span class="number">1</span>] = tmp;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      a[j + <span class="number">1</span>] = element;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">GetThirdIndex</span> (<span class="params">a, from, to</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> t_array = <span class="keyword">new</span> <span class="built_in">Array</span>();</span><br><span class="line">    <span class="comment">// Use both 'from' and 'to' to determine the pivot candidates.</span></span><br><span class="line">    <span class="keyword">var</span> increment = <span class="number">200</span> + ((to - <span class="keyword">from</span>) &amp; <span class="number">15</span>);</span><br><span class="line">    <span class="keyword">var</span> j = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">from</span> += <span class="number">1</span>;</span><br><span class="line">    to -= <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="keyword">from</span>; i &lt; to; i += increment) &#123;</span><br><span class="line">      t_array[j] = [i, a[i]];</span><br><span class="line">      j++;</span><br><span class="line">    &#125;</span><br><span class="line">    t_array.sort(<span class="function"><span class="keyword">function</span> (<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> comparefn(a[<span class="number">1</span>], b[<span class="number">1</span>]);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">var</span> third_index = t_array[t_array.length &gt;&gt; <span class="number">1</span>][<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">return</span> third_index;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">QuickSort</span> (<span class="params">a, from, to</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// åŸºå‡†é€‰æ‹©ç¬¬ä¸€ä¸ªå…ƒç´ </span></span><br><span class="line">    <span class="keyword">var</span> third_index = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">      <span class="comment">// å¾…æ’åºæ•°ç»„é•¿åº¦ &lt;= 10 é‡‡ç”¨æ’å…¥æ’åº</span></span><br><span class="line">      <span class="keyword">if</span> (to - <span class="keyword">from</span> &lt;= <span class="number">10</span>) &#123;</span><br><span class="line">        InsertionSort(a, <span class="keyword">from</span>, to);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (to - <span class="keyword">from</span> &gt; <span class="number">1000</span>) &#123;</span><br><span class="line">        <span class="comment">// æ¯éš” 200 ~ 215 ï¼ˆæ ¹æ® length &amp; 15çš„ç»“æœï¼‰ä¸ªå…ƒç´ å–ä¸€ä¸ªå€¼ï¼Œ</span></span><br><span class="line">        <span class="comment">// ç„¶åå°†è¿™äº›å€¼è¿›è¡Œæ’åºï¼Œå–ä¸­é—´å€¼çš„ä¸‹æ ‡</span></span><br><span class="line">        <span class="comment">// è¿™é‡Œçš„æ’åºå…¶å®åˆæ˜¯ä¸€ä¸ªé€’å½’è°ƒç”¨</span></span><br><span class="line">        third_index = GetThirdIndex(a, <span class="keyword">from</span>, to);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// å°†ä¸­é—´å…ƒç´ è®¾ä¸ºåŸºå‡†å€¼</span></span><br><span class="line">        third_index = <span class="keyword">from</span> + ((to - <span class="keyword">from</span>) &gt;&gt; <span class="number">1</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// å°†ç¬¬ä¸€ä¸ª,ä¸­é—´å…ƒç´ ï¼ˆä¸Šé¢è·å–çš„åŸºå‡†å€¼ï¼‰ï¼Œæœ€åä¸€ä¸ªå…ƒç´ ä¸‰è€…ä¸­çš„ä¸­ä½æ•°ä½œä¸ºåŸºå‡†å€¼</span></span><br><span class="line">      <span class="keyword">var</span> v0 = a[<span class="keyword">from</span>];</span><br><span class="line">      <span class="keyword">var</span> v1 = a[third_index];</span><br><span class="line">      <span class="keyword">var</span> v2 = a[to - <span class="number">1</span>];</span><br><span class="line">      <span class="keyword">var</span> c01 = comparefn(v0, v1);</span><br><span class="line">      <span class="keyword">if</span> (c01 &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// v1 &lt; v0, so swap them.</span></span><br><span class="line">        <span class="keyword">var</span> tmp = v0;</span><br><span class="line">        v0 = v1;</span><br><span class="line">        v1 = tmp;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// æ­¤æ—¶ v0 &lt;= v1.</span></span><br><span class="line">      <span class="keyword">var</span> c02 = comparefn(v0, v2);</span><br><span class="line">      <span class="keyword">if</span> (c02 &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// v2 &lt; v0 &lt;= v1.çš„æƒ…å†µ è¿›è¡Œäº¤æ¢</span></span><br><span class="line">        <span class="keyword">var</span> tmp = v0;</span><br><span class="line">        v0 = v2;</span><br><span class="line">        v2 = v1;</span><br><span class="line">        v1 = tmp;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// v0 &lt;= v1 &amp;&amp; v0 &lt;= v2</span></span><br><span class="line">        <span class="keyword">var</span> c12 = comparefn(v1, v2);</span><br><span class="line">        <span class="keyword">if</span> (c12 &gt; <span class="number">0</span>) &#123;</span><br><span class="line">          <span class="comment">// v1 &gt; v2</span></span><br><span class="line">          <span class="keyword">var</span> tmp = v1;</span><br><span class="line">          v1 = v2;</span><br><span class="line">          v2 = tmp;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// æœ€ç»ˆæ•ˆæœ v0 &lt;= v1 &lt;= v2</span></span><br><span class="line">      a[<span class="keyword">from</span>] = v0;</span><br><span class="line">      a[to - <span class="number">1</span>] = v2;</span><br><span class="line">      <span class="keyword">var</span> pivot = v1;</span><br><span class="line">      <span class="keyword">var</span> low_end = <span class="keyword">from</span> + <span class="number">1</span>;   <span class="comment">// æ¯”åŸºå‡†å€¼å°çš„å…ƒç´ çš„ä¸Šç•Œ</span></span><br><span class="line">      <span class="keyword">var</span> high_start = to - <span class="number">1</span>;  <span class="comment">// æ¯”åŸºå‡†å€¼å¤§çš„å…ƒç´ çš„ä¸‹ç•Œ</span></span><br><span class="line">      <span class="comment">// å°†åŸºå‡†å€¼ä¸ from + 1 ä½ç½®çš„å…ƒç´ è¿›è¡Œäº’æ¢</span></span><br><span class="line">      <span class="comment">// æ­¤æ—¶ from + 1 ä½ç½®çš„å…ƒç´ è‚¯å®šæ˜¯è¦æ’ form ä½ç½®åé¢çš„</span></span><br><span class="line">      <span class="keyword">if</span> (comparefn(pivot, a[low_end]) !== <span class="number">0</span>) &#123;</span><br><span class="line">        a[third_index] = a[low_end];</span><br><span class="line">        a[low_end] = pivot;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        a[third_index] = pivot</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// åˆ’åˆ†å‡½æ•° å°†å°äºï¼ˆå‡è®¾å‡åºæ’åºï¼‰åŸºå‡†å€¼çš„å…ƒç´ æ’åœ¨å·¦è¾¹</span></span><br><span class="line">      partition: <span class="keyword">for</span> (<span class="keyword">var</span> i = low_end + <span class="number">1</span>; i &lt; high_start; i++) &#123;</span><br><span class="line">        <span class="keyword">var</span> element = a[i];</span><br><span class="line">        <span class="keyword">var</span> order = comparefn(element, pivot);</span><br><span class="line">        <span class="keyword">if</span> (order &lt; <span class="number">0</span>) &#123;</span><br><span class="line">          a[i] = a[low_end];</span><br><span class="line">          a[low_end] = element;</span><br><span class="line">          low_end++;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (order &gt; <span class="number">0</span>) &#123;</span><br><span class="line">          <span class="comment">// å½“å¾…æ’åºå…ƒç´ å¤§äºåŸºå‡†å€¼æ—¶ï¼Œ</span></span><br><span class="line">          <span class="comment">// ä¸åˆ°å³ä¾§ç¬¬ä¸€ä¸ªå°äºåŸºå‡†å€¼çš„å…ƒç´ äº’æ¢</span></span><br><span class="line">          <span class="keyword">do</span> &#123;</span><br><span class="line">            high_start--;</span><br><span class="line">            <span class="keyword">if</span> (high_start == i) <span class="keyword">break</span> partition;</span><br><span class="line">            <span class="keyword">var</span> top_elem = a[high_start];</span><br><span class="line">            order = comparefn(top_elem, pivot);</span><br><span class="line">          &#125; <span class="keyword">while</span> (order &gt; <span class="number">0</span>);</span><br><span class="line">          a[i] = a[high_start];</span><br><span class="line">          a[high_start] = element;</span><br><span class="line">          <span class="comment">// è¯¥å…ƒç´ å°äºåŸºå‡†å€¼ï¼Œéœ€è¦æ’åœ¨åŸºå‡†å€¼å·¦è¾¹</span></span><br><span class="line">          <span class="keyword">if</span> (order &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            element = a[i];</span><br><span class="line">            a[i] = a[low_end];</span><br><span class="line">            a[low_end] = element;</span><br><span class="line">            low_end++;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// å¯¹å·¦å³ä¸¤ä¸ªå­æ•°ç»„å†è¿›è¡Œæ’åº</span></span><br><span class="line">      <span class="comment">// å…ˆå¤„ç†å¾…æ’åºå…ƒç´ è¾ƒå°‘çš„</span></span><br><span class="line">      <span class="keyword">if</span> (to - high_start &lt; low_end - <span class="keyword">from</span>) &#123;</span><br><span class="line">        QuickSort(a, high_start, to);</span><br><span class="line">        to = low_end;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        QuickSort(a, <span class="keyword">from</span>, low_end);</span><br><span class="line">        <span class="keyword">from</span> = high_start;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  QuickSort(array, <span class="number">0</span>, array.length)</span><br><span class="line">  <span class="keyword">return</span> array</span><br><span class="line">&#125;</span><br><span class="line">ArraySort([<span class="number">1</span>,<span class="number">2</span>,<span class="number">13</span>,<span class="number">14</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">17</span>,<span class="number">18</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">12</span>,<span class="number">31</span>,<span class="number">41</span>],()=&gt;<span class="number">0</span>)</span><br><span class="line"><span class="comment">// Â [1, 2, 13, 14, 5, 6, 17, 18, 9, 10, 11, 12, 31, 41]</span></span><br><span class="line">ArraySort([<span class="number">1</span>,<span class="number">2</span>,<span class="number">13</span>,<span class="number">14</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">17</span>,<span class="number">18</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">12</span>,<span class="number">31</span>,<span class="number">41</span>],(a,b)=&gt;a-b)</span><br><span class="line"><span class="comment">// Â [1, 2, 5, 6, 9, 10, 11, 12, 13, 14, 17, 18, 31, 41]</span></span><br></pre></td></tr></table></figure>

<h3 id="7-6-303"><a href="#7-6-303" class="headerlink" title="7.6.303"></a>7.6.303</h3><p>æ ¹æ® <a href="https://juejin.im/post/5c472940e51d455249762bef" target="_blank" rel="noopener">V8å¼•æ“ä¸­çš„æ’åº</a> å¾—çŸ¥ï¼Œåœ¨v8 çš„7.0ç‰ˆæœ¬ä¸­ä¿®æ”¹äº† Array.prototype.sort çš„å®ç°ï¼Œä¸å†é‡‡ç”¨jså®ç°ï¼Œè¿›è€Œé‡‡ç”¨ä¸€ç›´å« <code>Torque</code> çš„è¯­è¨€ï¼Œç±»ä¼¼ TypeScriptï¼Œå¼ºç±»å‹ã€‚</p>
<blockquote>
<p>v8 ä¸­çš„ src/js/array.js åœ¨å¤§æ¦‚ 7.2ä¹‹åçš„ç‰ˆæœ¬åˆ é™¤ï¼Œä¸­é—´å‡ ä¸ªç‰ˆæœ¬ç”¨æ¥è¿ç§» arrayçš„å…¶ä»–æ–¹æ³•</p>
</blockquote>
<p>æºç è·¯å¾„ <a href="https://github.com/v8/v8/blob/7.6.303/third_party/v8/builtins/array-sort.tq" target="_blank" rel="noopener">/third_party/v8/builtins/array-sort.tq</a></p>
<p>å¯ä»¥å¾—çŸ¥ï¼Œsort æ›´æ¢äº†å®ç°ï¼Œé‡‡ç”¨äº† <a href="https://en.wikipedia.org/wiki/Timsort" target="_blank" rel="noopener">TimSort æ’åºç®—æ³•</a></p>
<p>ç®€å•çš„è¯´ï¼š</p>
<ol>
<li>æ‰«ææ•°ç»„ï¼Œç¡®å®šå…¶ä¸­çš„å•è°ƒä¸Šå‡æ®µå’Œä¸¥æ ¼å•è°ƒä¸‹é™æ®µï¼Œå°†ä¸¥æ ¼ä¸‹é™æ®µåè½¬ã€‚æˆ‘ä»¬å°†è¿™æ ·çš„æ®µç§°ä¹‹ä¸ºrunã€‚ </li>
<li>å®šä¹‰æœ€å°runé•¿åº¦ï¼ŒçŸ­äºæ­¤çš„runé€šè¿‡æ’å…¥æ’åºåˆå¹¶ç›´è‡³é•¿åº¦å¤§äºæœ€å°runé•¿åº¦ï¼› </li>
<li>åå¤å½’å¹¶ä¸€äº›ç›¸é‚»runï¼Œè¿‡ç¨‹ä¸­éœ€è¦é¿å…å½’å¹¶é•¿åº¦ç›¸å·®å¾ˆå¤§çš„runï¼Œç›´è‡³æ•´ä¸ªæ’åºå®Œæˆï¼›</li>
</ol>
<p>å®ç°è¿˜æ˜¯è¾ƒä¸ºå¤æ‚çš„ï¼Œæœ¬æ–‡ä¸è¿›è¡Œæ·±å…¥ï¼Œå…·ä½“çš„å¯ä»¥æŸ¥çœ‹ <a href="https://mp.weixin.qq.com/s?__biz=MzI2MTY0OTg2Nw==&mid=2247483816&idx=1&sn=079af3d70efcb68efa7400f09decb59c&chksm=ea56650cdd21ec1ace7c8fd168d62feb636e4b32f9a4d90329fe479489d8e7a70e612df8920b&token=2074049324&lang=zh_CN#rd" target="_blank" rel="noopener">TimSortçš„å®ç°</a> ä¸€æ–‡</p>
<h3 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h3><p>åœ¨çœ‹æºç çš„æ—¶å€™åˆå‘ç°ä¸€ä¸ªå®ç°å·®å¼‚çš„é—®é¢˜</p>
<p>chrome v59</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">[<span class="number">1</span>,,<span class="number">2</span>,,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>].sort(<span class="function"><span class="params">v</span>=&gt;</span><span class="number">0</span>)</span><br><span class="line"><span class="comment">// [1, 5, 2, 4, 3, undefined x 2]</span></span><br></pre></td></tr></table></figure>
<p>chrome 76</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">[<span class="number">1</span>,,<span class="number">2</span>,,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>].sort(<span class="function"><span class="params">v</span>=&gt;</span><span class="number">0</span>)</span><br><span class="line"><span class="comment">// [1, 2, 3, 4, 5, empty Ã— 2]</span></span><br></pre></td></tr></table></figure>

<p>æ–°ç‰ˆçš„å®ç°åº”è¯¥æ˜¯è¾ƒä¸ºç§‘å­¦çš„</p>
<p>è¿˜æœ‰ä¸€äº›æœ‰è¶£çš„å·®å¼‚å¯ä»¥çœ‹<a href="https://juejin.im/post/5c472940e51d455249762bef#heading-2" target="_blank" rel="noopener">è¿™é‡Œ</a></p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>ä½ç‰ˆæœ¬ v8 çš„å¿«æ’å®ç°æœ‰bug,å½“æ•°ç»„è¾ƒå°æ—¶é‡‡ç”¨æ’å…¥æ’åºæ˜¯æ²¡é—®é¢˜çš„</p>
<p>æ–°ç‰ˆæœ¬çš„chromeæ‰€ä½¿ç”¨çš„v8ç‰ˆæœ¬å®ç°äº†ç¨³å®šæ’åºï¼Œå¹¶è§£å†³äº†ä¸€äº›æ½œåœ¨é—®é¢˜ï¼ˆä¸å¼€å‘è€…æƒ³è¦çš„å®ç°æ•ˆæœä¸åŒï¼‰</p>
<p>æœ€ååˆ†äº«ä¸€ä¸ª <code>V8æºç ä¸­å¯»æ‰¾JSæ–¹æ³•å®ç°</code> çš„æŠ€å·§</p>
<ol>
<li>æ ¹æ®éƒ¨åˆ†æ–‡ä»¶åå¿«é€ŸæŸ¥æ‰¾æ–‡ä»¶ï¼š<a href="https://help.github.com/en/articles/finding-files-on-github" target="_blank" rel="noopener">https://help.github.com/en/articles/finding-files-on-github</a></li>
<li>åœ¨æœç´¢æ ä¸­è¾“å…¥ â€œArray.prototype.sortâ€ in:file å³å¯æœç´¢å«æœ‰å…¨åŒ¹é… Array.prototype.sort å†…å®¹çš„æ–‡ä»¶</li>
<li>jsæ–¹æ³•å®ç°ä¸€èˆ¬åœ¨ /src/js/ å’Œ /src/runtime/ ç›®å½•ä¸­ï¼Œå‚è€ƒè‡ª <a href="https://www.zhihu.com/question/59792274/answer/169671660" target="_blank" rel="noopener">https://www.zhihu.com/question/59792274/answer/169671660</a></li>
<li>ç»“åˆ test/mjsunit ä¸€èµ·çœ‹æºç æ•ˆæœæ›´ä½³</li>
</ol>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ol>
<li><a href="http://yanhaijing.com/es5/#353" target="_blank" rel="noopener">es5ä¸­æ–‡è§„èŒƒ</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/sort" target="_blank" rel="noopener">MDN-Array.prototype.sort</a></li>
<li><a href="https://yalishizhude.com/2019/09/05/v8-sort/" target="_blank" rel="noopener">ã€æ·±åº¦ã€‘æ‰’å¼€V8å¼•æ“çš„æºç ï¼Œæˆ‘æ‰¾åˆ°äº†ä½ ä»¬æƒ³è¦çš„å‰ç«¯ç®—æ³•</a></li>
<li><a href="https://juejin.im/post/59e80dc6f265da432a7aaf15" target="_blank" rel="noopener">JavaScriptä¸“é¢˜ä¹‹è§£è¯» v8 æ’åºæºç </a></li>
<li><a href="https://v8.dev/blog/array-sort" target="_blank" rel="noopener">Getting things sorted in V8</a></li>
</ol>
]]></content>
      <categories>
        <category>å¤§å‰ç«¯</category>
      </categories>
      <tags>
        <tag>ECMAScript</tag>
        <tag>V8</tag>
      </tags>
  </entry>
  <entry>
    <title>Vueä¹‹ä»é›¶ç¼–å†™ä¸€ä¸ªContextMenu(å³é”®èœå•)æ’ä»¶</title>
    <url>/2019/07/03/2019Q3/Vue%E4%B9%8B%E4%BB%8E%E9%9B%B6%E7%BC%96%E5%86%99%E4%B8%80%E4%B8%AAContextMenu(%E5%8F%B3%E9%94%AE%E8%8F%9C%E5%8D%95)%E6%8F%92%E4%BB%B6/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ContextMenu å³å³é”®èœå•ï¼Œå½“å‰çš„éœ€æ±‚æ˜¯ï¼šå³é”®ç‚¹å‡»æŸäº›ç»„ä»¶æ—¶ï¼Œæ ¹æ®æ‰€ç‚¹å‡»ç»„ä»¶çš„ä¿¡æ¯ï¼Œå±•ç¤ºä¸åŒçš„èœå•ã€‚</p>
<p>æœ¬æ’ä»¶å·²å¼€æºï¼Œå…·ä½“ä»£ç å’Œä½¿ç”¨å¯å‚è€ƒï¼š <a href="https://github.com/Francecil/vue-contextmenu" target="_blank" rel="noopener">vue-contextmenu</a></p>
<p>æœ¬æ–‡é‡‡ç”¨çš„æ˜¯ vue æŠ€æœ¯æ ˆï¼Œéƒ¨åˆ†å¤„ç†å¯¹äº react æ˜¯å¯ä»¥å€Ÿé‰´çš„</p>
<p>å…¶ä¸­éœ€è¦æ³¨æ„çš„ç‚¹æœ‰ï¼š</p>
<ol>
<li>èœå•å®Œå…¨æ˜¾ç¤ºï¼Œå³å³é”®ç‚¹å‡»ä½äºé¡µé¢ä¸‹/å³ä¾§æ—¶ï¼Œèœå•åº”è¯¥å‘ä¸Š/å·¦æ˜¾ç¤º</li>
<li>å…·ä½“èœå•ç”±ä¸Šå±‚æ§åˆ¶ï¼Œè¯¥ç»„ä»¶ä»…æä¾›slot</li>
<li>è¯¥èœå•domä¸Šå”¯ä¸€ï¼Œä¸éœ€è¦æ—¶åº”è¯¥é”€æ¯</li>
<li>ç‚¹å‡»é¡µé¢å…¶ä»–ä½ç½®ï¼Œèœå•æ¶ˆå¤±</li>
</ol>
<p>å…ˆä¸è€ƒè™‘æ’ä»¶å½¢å¼ï¼ŒæŒ‰æ—¥å¸¸ç»„ä»¶å¼€å‘</p>
<a id="more"></a>


<h2 id="é¡¹ç›®ç»“æ„"><a href="#é¡¹ç›®ç»“æ„" class="headerlink" title="é¡¹ç›®ç»“æ„"></a>é¡¹ç›®ç»“æ„</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">|-components</span><br><span class="line">|---ContextMenu.vue    <span class="comment">//èœå•ç»„ä»¶</span></span><br><span class="line">|-views</span><br><span class="line">|---Home.vue            <span class="comment">//é¡µé¢ç»„ä»¶</span></span><br><span class="line">|---Dashbox.vue        <span class="comment">//å›¾è¡¨ç»„ä»¶ï¼Œç»å¯¹å®šä½äºAppä¸­ï¼Œæœ‰å¤šä¸ªï¼Œå³é”®å±•ç¤ºè‡ªå®šä¹‰èœå•</span></span><br></pre></td></tr></table></figure>
<p>å…¶ä½™çš„ vue-router ä»€ä¹ˆçš„ï¼Œä¸å†èµ˜è¯‰</p>
<p>å³é”®èœå•çš„å†…å®¹ç”±ä½¿ç”¨è€…å®šä¹‰ï¼ˆé€šè¿‡slotï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å¾ˆå¿«çš„ç¼–å†™ ContextMenu çš„ä»£ç </p>
<blockquote>
<p>åŒæ—¶è§£å†³äº† <strong>æ³¨æ„ç‚¹2</strong></p>
</blockquote>
<p>ContextMenu.vue</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"context-menu"</span> <span class="attr">v-show</span>=<span class="string">"show"</span> <span class="attr">:style</span>=<span class="string">"style"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">slot</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="actionscript">  name: <span class="string">"context-menu"</span>,</span></span><br><span class="line">  props: &#123;</span><br><span class="line"><span class="javascript">    show: <span class="built_in">Boolean</span></span></span><br><span class="line">  &#125;,</span><br><span class="line">  computed: &#123;</span><br><span class="line">    style() &#123;</span><br><span class="line"><span class="actionscript">      <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="actionscript">        left: <span class="string">"0px"</span>,</span></span><br><span class="line"><span class="actionscript">        top: <span class="string">"0px"</span></span></span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">lang</span>=<span class="string">"scss"</span> <span class="attr">scoped</span>&gt;</span></span><br><span class="line"><span class="css"><span class="selector-class">.context-menu</span> &#123;</span></span><br><span class="line">  z-index: 1000;</span><br><span class="line">  display: block;</span><br><span class="line">  position: absolute;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>å…ˆä¸è€ƒè™‘æ˜¾ç¤ºçš„ä½ç½®ï¼Œé€šè¿‡ show prop çš„å€¼æ¥æ˜¾ç¤º/éšè—è¯¥èœå•ï¼Œå½“å‰å®ç° èœå•å°†ä¼šæ˜¾ç¤ºåœ¨å·¦ä¸Šè§’</p>
<p>Dashbox.vue</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">:style</span>=<span class="string">"dashbox.style"</span> <span class="attr">class</span>=<span class="string">"dashbox"</span> @<span class="attr">contextmenu</span>=<span class="string">"showContextMenu"</span>&gt;</span></span><br><span class="line">    &#123;&#123; dashbox.content &#125;&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line">  props: &#123;</span><br><span class="line"><span class="javascript">    dashbox: <span class="built_in">Object</span></span></span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    showContextMenu(e) &#123;</span><br><span class="line"><span class="actionscript">      <span class="keyword">this</span>.$emit(<span class="string">"show-contextmenu"</span>, e);</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="css"><span class="selector-class">.dashbox</span> &#123;</span></span><br><span class="line">  position: absolute;</span><br><span class="line">  background-color: aliceblue;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>ç»å¯¹å®šä½åœ¨é¡µé¢ä¸­ï¼Œå³é”®æ—¶ä¼šå‘ä¸Šå±‚ä¼ é€’äº‹ä»¶</p>
<p>Home.vue</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"home"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Dashbox</span></span></span><br><span class="line"><span class="tag">      <span class="attr">v-for</span>=<span class="string">"dashbox in dashboxs"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:key</span>=<span class="string">"dashbox.id"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:dashbox</span>=<span class="string">"dashbox"</span></span></span><br><span class="line"><span class="tag">      @<span class="attr">show-contextmenu</span>=<span class="string">"showContextMenu"</span></span></span><br><span class="line"><span class="tag">    /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ContextMenu</span> <span class="attr">:show</span>=<span class="string">"contextMenuVisible"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span>&gt;</span>å¤åˆ¶<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span>&gt;</span>ç²˜è´´<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span>&gt;</span>å‰ªåˆ‡<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ContextMenu</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> ContextMenu <span class="keyword">from</span> <span class="string">"@/components/ContextMenu.vue"</span>;</span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> Dashbox <span class="keyword">from</span> <span class="string">"./Dashbox.vue"</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="actionscript">  name: <span class="string">"home"</span>,</span></span><br><span class="line">  components: &#123;</span><br><span class="line">    ContextMenu,</span><br><span class="line">    Dashbox</span><br><span class="line">  &#125;,</span><br><span class="line">  data() &#123;</span><br><span class="line"><span class="actionscript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="actionscript">      contextMenuVisible: <span class="literal">false</span>,</span></span><br><span class="line">      dashboxs: [</span><br><span class="line">        &#123;</span><br><span class="line">          id: 1,</span><br><span class="line"><span class="actionscript">          style: <span class="string">"left:200px;top:200px;width:100px;height:100px"</span>,</span></span><br><span class="line"><span class="actionscript">          content: <span class="string">"test1"</span></span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          id: 2,</span><br><span class="line"><span class="actionscript">          style: <span class="string">"left:400px;top:400px;width:100px;height:100px"</span>,</span></span><br><span class="line"><span class="actionscript">          content: <span class="string">"test2"</span></span></span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    showContextMenu(e) &#123;</span><br><span class="line">      e.preventDefault();</span><br><span class="line"><span class="actionscript">      <span class="keyword">this</span>.contextMenuVisible = <span class="literal">true</span>;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æ­¤æ—¶å¯ä»¥çœ‹åˆ°é¡µé¢ä¸­æœ‰2ä¸ªçŸ©å½¢æ¡†ï¼Œå³é”®çš„æ—¶å€™ï¼Œå·¦ä¸Šè§’èƒ½å‡ºç°èœå•</p>
<p>å½“ç„¶ï¼Œæ­¤æ—¶å¹¶æ²¡æœ‰åŠæ³•å°†è¯¥èœå•éšè—</p>
<p>ä¸‹é¢ï¼Œæˆ‘ä»¬å°†ä¸€æ­¥æ­¥è¿›è¡Œä¼˜åŒ–</p>
<h2 id="èœå•å¤„äºå³é”®ç‚¹å‡»ä½ç½®"><a href="#èœå•å¤„äºå³é”®ç‚¹å‡»ä½ç½®" class="headerlink" title="èœå•å¤„äºå³é”®ç‚¹å‡»ä½ç½®"></a>èœå•å¤„äºå³é”®ç‚¹å‡»ä½ç½®</h2><p>ä¸Šé¢æˆ‘ä»¬åœ¨ showContextMenu æ–¹æ³•ä¸­è·å–åˆ°ç‚¹å‡»äº‹ä»¶eï¼Œ</p>
<p>å…¶ä¸­ <code>e.clientX/Y</code> æ˜¯åŸºäºæµè§ˆå™¨çª—å£viewportçš„ä½ç½®ï¼Œå‚è€ƒç‚¹éšç€æµè§ˆå™¨çš„æ»šåŠ¨è€Œå˜åŒ–ï¼ˆå³ä¸€ç›´æ˜¯è§†çª—å·¦ä¸Šè§’ï¼‰</p>
<p>é‚£ä¹ˆï¼Œå°† clientX/Y ç›´æ¥ä¼ å…¥ ContextMenu ç»„ä»¶ä¿®æ”¹å…¶æ ·å¼æ˜¯å¦å°±å¯ä»¥äº†ï¼Ÿ</p>
<p>æ€è€ƒä¸€ä¸‹â€¦</p>
<hr>
<p>.</p>
<p>.</p>
<p>.</p>
<p>.</p>
<p>ç­”æ¡ˆæ˜¯ä¸å¯ä»¥çš„ï¼ŒåŸå› åœ¨äº ContextMenu çš„ç¥–å…ˆèŠ‚ç‚¹çš„å®šä½å¯èƒ½ä¸æ˜¯ static,</p>
<p>å½“ç¥–å…ˆèŠ‚ç‚¹å®šä½é static æ—¶ï¼Œabsolute å®šä½çš„ ContextMenu çš„å‚è€ƒç‚¹å°±æ˜¯ä»¥ç¥–å…ˆèŠ‚ç‚¹ä¸ºå‚è€ƒç‚¹äº†ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"header"</span> <span class="attr">style</span>=<span class="string">"height:200px"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"home"</span> <span class="attr">style</span>=<span class="string">"position: relative;"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"context-menu"</span> <span class="attr">style</span>=<span class="string">"left: 200px;top: 200px;position: absolute;"</span>&gt;</span></span><br><span class="line">      æˆ‘æ˜¯å³é”®èœå•</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>è€Œå®é™…ä¸Šï¼Œå½“å³é”®çš„ clientX/Y å€¼ä¸º 200ï¼Œ200æ—¶ï¼Œä¼ å…¥ context-menuçš„styleåï¼Œå…¶èœå•åº”è¯¥æ˜¾ç¤ºåœ¨ç‚¹å‡»å¤„ä¸‹æ–¹ 200px, å³ç›¸å¯¹ viewport çš„ left,top åˆ†åˆ«ä¸º 200ï¼Œ400</p>
<blockquote>
<p>äº†è§£ element-uiç­‰ç»„ä»¶åº“çš„åº”è¯¥çŸ¥é“ï¼Œåœ¨æ¶‰åŠ poper æ˜¾ç¤ºçš„æ—¶å€™ï¼Œå®˜æ–¹é»˜è®¤<code>popper-append-to-body</code>ï¼Œç›®çš„å°±æ˜¯å°†å¼¹çª—ç»„ä»¶æ’å…¥bodyï¼Œè„±ç¦»æ–‡æ¡£æµï¼Œä¸ä¸å®šä¹‰å¤„çš„çˆ¶ç»„ä»¶äº§ç”Ÿå…³ç³»ï¼Œå¹¶ä¸”æ–¹ä¾¿ä½¿ç”¨ event.clientX/Y</p>
</blockquote>
<p>æ‰€ä»¥ï¼Œå°†å…¶ç›´æ¥æ’å…¥ body æ˜¯æœ€çœäº‹çš„ï¼Œ</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">mounted () &#123;</span><br><span class="line">  <span class="built_in">document</span>.body.appendChild(<span class="keyword">this</span>.$el)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ContextMenu å¢åŠ  offset å±æ€§å¹¶ä¿®æ”¹æ ·å¼</p>
<p>Home.vue</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"home"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Dashbox</span></span></span><br><span class="line"><span class="tag">      <span class="attr">v-for</span>=<span class="string">"dashbox in dashboxs"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:key</span>=<span class="string">"dashbox.id"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:dashbox</span>=<span class="string">"dashbox"</span></span></span><br><span class="line"><span class="tag">      @<span class="attr">show-contextmenu</span>=<span class="string">"showContextMenu"</span></span></span><br><span class="line"><span class="tag">    /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ContextMenu</span> <span class="attr">:show</span>=<span class="string">"contextMenuVisible"</span> <span class="attr">:offset</span>=<span class="string">"contextMenuOffset"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span>&gt;</span>å¤åˆ¶<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span>&gt;</span>ç²˜è´´<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span>&gt;</span>å‰ªåˆ‡<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ContextMenu</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> ContextMenu <span class="keyword">from</span> <span class="string">"@/components/ContextMenu.vue"</span>;</span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> Dashbox <span class="keyword">from</span> <span class="string">"./Dashbox.vue"</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="actionscript">  name: <span class="string">"home"</span>,</span></span><br><span class="line">  components: &#123;</span><br><span class="line">    ContextMenu,</span><br><span class="line">    Dashbox</span><br><span class="line">  &#125;,</span><br><span class="line">  data() &#123;</span><br><span class="line"><span class="actionscript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="actionscript">      contextMenuVisible: <span class="literal">false</span>,</span></span><br><span class="line">      contextMenuOffset: &#123;</span><br><span class="line">        left: 0,</span><br><span class="line">        top: 0</span><br><span class="line">      &#125;,</span><br><span class="line">      dashboxs: [</span><br><span class="line">        &#123;</span><br><span class="line">          id: 1,</span><br><span class="line"><span class="actionscript">          style: <span class="string">"left:200px;top:200px;width:100px;height:100px"</span>,</span></span><br><span class="line"><span class="actionscript">          content: <span class="string">"test1"</span></span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          id: 2,</span><br><span class="line"><span class="actionscript">          style: <span class="string">"left:400px;top:400px;width:100px;height:100px"</span>,</span></span><br><span class="line"><span class="actionscript">          content: <span class="string">"test2"</span></span></span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    showContextMenu(e) &#123;</span><br><span class="line">      e.preventDefault();</span><br><span class="line"><span class="actionscript">      <span class="keyword">this</span>.contextMenuVisible = <span class="literal">true</span>;</span></span><br><span class="line"><span class="actionscript">      <span class="keyword">this</span>.contextMenuOffset = &#123;</span></span><br><span class="line">        left: e.clientX,</span><br><span class="line">        top: e.clientY</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>ContextMenu.vue</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"context-menu"</span> <span class="attr">v-show</span>=<span class="string">"show"</span> <span class="attr">:style</span>=<span class="string">"style"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">slot</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="actionscript">  name: <span class="string">"context-menu"</span>,</span></span><br><span class="line">  props: &#123;</span><br><span class="line">    offset: &#123;</span><br><span class="line"><span class="javascript">      type: <span class="built_in">Object</span>,</span></span><br><span class="line"><span class="actionscript">      <span class="keyword">default</span>: <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">return</span> &#123;</span></span><br><span class="line">          left: 0,</span><br><span class="line">          top: 0</span><br><span class="line">        &#125;;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"><span class="javascript">    show: <span class="built_in">Boolean</span></span></span><br><span class="line">  &#125;,</span><br><span class="line">  computed: &#123;</span><br><span class="line">    style() &#123;</span><br><span class="line"><span class="actionscript">      <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">        left: <span class="string">`<span class="subst">$&#123;<span class="keyword">this</span>.offset.left&#125;</span>px`</span>,</span></span><br><span class="line"><span class="javascript">        top: <span class="string">`<span class="subst">$&#123;<span class="keyword">this</span>.offset.top&#125;</span>px`</span></span></span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  mounted() &#123;</span><br><span class="line"><span class="javascript">    <span class="built_in">document</span>.body.appendChild(<span class="keyword">this</span>.$el);</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">lang</span>=<span class="string">"scss"</span> <span class="attr">scoped</span>&gt;</span></span><br><span class="line"><span class="css"><span class="selector-class">.context-menu</span> &#123;</span></span><br><span class="line">  z-index: 1000;</span><br><span class="line">  display: block;</span><br><span class="line">  position: absolute;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å°±å¯ä»¥å®ç° <strong>èœå•å¤„äºå³é”®ç‚¹å‡»ä½ç½®</strong> çš„æ•ˆæœäº†ï¼Œæ¯æ¬¡å³é”®ç‚¹å‡»ï¼Œcontext-menu ä¼šæ˜¾ç¤ºåœ¨å¯¹åº”ä½ç½®</p>
<h2 id="è¯¥èœå•domä¸Šå”¯ä¸€ï¼Œä¸éœ€è¦æ—¶åº”è¯¥é”€æ¯"><a href="#è¯¥èœå•domä¸Šå”¯ä¸€ï¼Œä¸éœ€è¦æ—¶åº”è¯¥é”€æ¯" class="headerlink" title="è¯¥èœå•domä¸Šå”¯ä¸€ï¼Œä¸éœ€è¦æ—¶åº”è¯¥é”€æ¯"></a>è¯¥èœå•domä¸Šå”¯ä¸€ï¼Œä¸éœ€è¦æ—¶åº”è¯¥é”€æ¯</h2><p>è¿™ä¸ªä¹Ÿå¾ˆç®€å•</p>
<p>åœ¨ç»„ä»¶é”€æ¯æ—¶ï¼ŒæŠŠè‡ªå·±ä» body ä¸­ç§»é™¤</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">beforeDestroy () &#123;</span><br><span class="line">  <span class="keyword">let</span> popperElm = <span class="keyword">this</span>.$el</span><br><span class="line">  <span class="keyword">if</span> (popperElm &amp;&amp; popperElm.parentNode === <span class="built_in">document</span>.body) &#123;</span><br><span class="line">    <span class="built_in">document</span>.body.removeChild(popperElm);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ç‚¹å‡»é¡µé¢å…¶ä»–ä½ç½®ï¼Œèœå•æ¶ˆå¤±"><a href="#ç‚¹å‡»é¡µé¢å…¶ä»–ä½ç½®ï¼Œèœå•æ¶ˆå¤±" class="headerlink" title="ç‚¹å‡»é¡µé¢å…¶ä»–ä½ç½®ï¼Œèœå•æ¶ˆå¤±"></a>ç‚¹å‡»é¡µé¢å…¶ä»–ä½ç½®ï¼Œèœå•æ¶ˆå¤±</h2><p>è¿™é‡Œæˆ‘ä»¬é€‰æ‹©ç›‘å¬ mousedownï¼Œè‹¥äº‹ä»¶æ²¡æœ‰åœæ­¢ä¼ é€’ï¼Œåˆ™ document ä¸Šå¯ä»¥ç›‘å¬åˆ°</p>
<blockquote>
<p>å½“ç„¶ è¿™é‡Œæˆ‘ä»¬éœ€è¦ä¿è¯ äº‹ä»¶ä¸ä¼šè¢« stopPropagation</p>
</blockquote>
<p>ContextMenu.vue</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span></span></span><br><span class="line"><span class="tag">    <span class="attr">class</span>=<span class="string">"context-menu"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">v-show</span>=<span class="string">"show"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:style</span>=<span class="string">"style"</span></span></span><br><span class="line"><span class="tag">    @<span class="attr">mousedown.stop</span></span></span><br><span class="line"><span class="tag">    @<span class="attr">contextmenu.prevent</span></span></span><br><span class="line"><span class="tag">  &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">slot</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="actionscript">  name: <span class="string">"context-menu"</span>,</span></span><br><span class="line">  props: &#123;</span><br><span class="line">    offset: &#123;</span><br><span class="line"><span class="javascript">      type: <span class="built_in">Object</span>,</span></span><br><span class="line"><span class="actionscript">      <span class="keyword">default</span>: <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">return</span> &#123;</span></span><br><span class="line">          left: 0,</span><br><span class="line">          top: 0</span><br><span class="line">        &#125;;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"><span class="javascript">    show: <span class="built_in">Boolean</span></span></span><br><span class="line">  &#125;,</span><br><span class="line">  computed: &#123;</span><br><span class="line">    style() &#123;</span><br><span class="line"><span class="actionscript">      <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">        left: <span class="string">`<span class="subst">$&#123;<span class="keyword">this</span>.offset.left&#125;</span>px`</span>,</span></span><br><span class="line"><span class="javascript">        top: <span class="string">`<span class="subst">$&#123;<span class="keyword">this</span>.offset.top&#125;</span>px`</span></span></span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  beforeDestroy() &#123;</span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> popperElm = <span class="keyword">this</span>.$el;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">if</span> (popperElm &amp;&amp; popperElm.parentNode === <span class="built_in">document</span>.body) &#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">document</span>.body.removeChild(popperElm);</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="javascript">    <span class="built_in">document</span>.removeEventListener(<span class="string">"mousedown"</span>, <span class="keyword">this</span>.clickDocumentHandler);</span></span><br><span class="line">  &#125;,</span><br><span class="line">  mounted() &#123;</span><br><span class="line"><span class="javascript">    <span class="built_in">document</span>.body.appendChild(<span class="keyword">this</span>.$el);</span></span><br><span class="line"><span class="javascript">    <span class="built_in">document</span>.addEventListener(<span class="string">"mousedown"</span>, <span class="keyword">this</span>.clickDocumentHandler);</span></span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    clickDocumentHandler() &#123;</span><br><span class="line"><span class="actionscript">      <span class="keyword">if</span> (<span class="keyword">this</span>.show) &#123;</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">this</span>.$emit(<span class="string">"update:show"</span>, <span class="literal">false</span>);</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">lang</span>=<span class="string">"scss"</span> <span class="attr">scoped</span>&gt;</span></span><br><span class="line"><span class="css"><span class="selector-class">.context-menu</span> &#123;</span></span><br><span class="line">  z-index: 1000;</span><br><span class="line">  display: block;</span><br><span class="line">  position: absolute;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Home.vue å¢åŠ  <code>@update:show</code> äº‹ä»¶å¤„ç†</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ContextMenu</span></span></span><br><span class="line"><span class="tag">  <span class="attr">:show</span>=<span class="string">"contextMenuVisible"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">:offset</span>=<span class="string">"contextMenuOffset"</span></span></span><br><span class="line"><span class="tag">  @<span class="attr">update:show</span>=<span class="string">"show =&gt; (contextMenuVisible = show)"</span></span></span><br><span class="line"><span class="tag">&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span>å¤åˆ¶<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span>ç²˜è´´<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span>å‰ªåˆ‡<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ContextMenu</span>&gt;</span></span><br></pre></td></tr></table></figure>


<h2 id="èœå•å®Œå…¨æ˜¾ç¤º"><a href="#èœå•å®Œå…¨æ˜¾ç¤º" class="headerlink" title="èœå•å®Œå…¨æ˜¾ç¤º"></a>èœå•å®Œå…¨æ˜¾ç¤º</h2><p>æ ¹æ®ç‚¹å‡»ä½ç½®ï¼Œåˆ¤æ–­èœå•å‘ä¸Šæ˜¾ç¤ºæˆ–å‘ä¸‹æ˜¾ç¤ºï¼Œå³å³é”®ç‚¹å‡»ä½äºé¡µé¢ä¸‹/å³ä¾§æ—¶ï¼Œèœå•åº”è¯¥å‘ä¸Š/å·¦æ˜¾ç¤º</p>
<p>é¡µé¢é«˜åº¦ï¼š<code>let docHeight = document.documentElement.clientHeight</code></p>
<p>èœå•é«˜åº¦ï¼š<code>let menuHeight = this.$el.getBoundingClientRect().height</code></p>
<p>å½“ <code>e.clientY + menuHeight &gt;= docHeight</code> æ—¶ï¼Œèœå•å‘ä¸‹æ˜¾ç¤ºå°±ä¼šè¢«é®æŒ¡äº†ï¼Œéœ€è¦å‘ä¸Šæ˜¾ç¤º</p>
<p>åŒç†ï¼Œ</p>
<p>é¡µé¢å®½åº¦ï¼š<code>let docWidth = document.documentElement.clientWidth</code></p>
<p>èœå•é«˜åº¦ï¼š<code>let menuWidth = this.$el.getBoundingClientRect().width</code></p>
<p>å½“ <code>e.clientX + menuWidth &gt;= docWidth</code> æ—¶ï¼Œèœå•éœ€è¦å‘å·¦æ˜¾ç¤º</p>
<p>ç”±äºèœå•ç”±å¤–éƒ¨å®šä¹‰ï¼Œå®½é«˜ä¸å¯æ§ï¼Œæ‰€ä»¥æ¯æ¬¡éƒ½éœ€è¦é€šè¿‡ <code>getBoundingClientRect</code> è·å–å®é™…å®½é«˜</p>
<p>è¿™é‡Œéœ€è¦æ³¨æ„è·å– getBoundingClientRect çš„æ—¶æœºã€‚</p>
<p>ä¸€å¼€å§‹å°è¯•ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">computed: &#123;</span><br><span class="line">    style() &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="keyword">this</span>.$el)</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        left: <span class="string">`<span class="subst">$&#123;<span class="keyword">this</span>.offset.left&#125;</span>px`</span>,</span><br><span class="line">        top: <span class="string">`<span class="subst">$&#123;<span class="keyword">this</span>.offset.top&#125;</span>px`</span></span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>å‘ç°æ­¤æ—¶ç»„ä»¶å¤„äº <code>display:none</code> çŠ¶æ€ï¼Œè·å–åˆ°çš„å®½é«˜éƒ½ä¸º0</p>
<p>æœ‰2ç§è§£å†³æ–¹æ¡ˆï¼Œä¸€ç§æ˜¯å°† v-show ä¹Ÿå°±æ˜¯ <code>display æ ·å¼</code> æ”¹ä¸º <code>visibility</code></p>
<p>ä½†æ‹…å¿ƒæ­¤æ³•ä¸å¤Ÿé€šç”¨ï¼ˆå…¶å®æ˜¯æƒ³è¯•è¯• $nextTickï¼Œ</p>
<p>å¦ä¸€ç§å°±æ˜¯åœ¨ä¸‹ä¸€ä¸ªæ¸²æŸ“å‘¨æœŸç»“æŸåæ‰æ‰§è¡Œï¼Œå³ <code>v-show=&quot;true&quot;</code> åè®¡ç®—å®½é«˜</p>
<p>æ•…æˆ‘ä»¬éœ€è¦ç›‘å¬ show prop çš„å€¼ï¼Œå½“å…¶ä¸º true æ—¶ï¼Œåœ¨ <code>$nextTick</code> å›è°ƒä¸­è®¾ç½®èœå•åæ ‡æ ·å¼ï¼Œæ­¤æ—¶ style ä¸ç”¨ computed,å…·ä½“çœ‹ä»£ç ã€‚</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span></span></span><br><span class="line"><span class="tag">    <span class="attr">class</span>=<span class="string">"context-menu"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">v-show</span>=<span class="string">"show"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:style</span>=<span class="string">"style"</span></span></span><br><span class="line"><span class="tag">    @<span class="attr">mousedown.stop</span></span></span><br><span class="line"><span class="tag">    @<span class="attr">contextmenu.prevent</span></span></span><br><span class="line"><span class="tag">  &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">slot</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="actionscript">  name: <span class="string">"context-menu"</span>,</span></span><br><span class="line">  data() &#123;</span><br><span class="line"><span class="actionscript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line">      style: &#123;&#125;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  props: &#123;</span><br><span class="line">    offset: &#123;</span><br><span class="line"><span class="javascript">      type: <span class="built_in">Object</span>,</span></span><br><span class="line"><span class="actionscript">      <span class="keyword">default</span>: <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">return</span> &#123;</span></span><br><span class="line">          left: 0,</span><br><span class="line">          top: 0</span><br><span class="line">        &#125;;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"><span class="javascript">    show: <span class="built_in">Boolean</span></span></span><br><span class="line">  &#125;,</span><br><span class="line">  watch: &#123;</span><br><span class="line">    show(show) &#123;</span><br><span class="line">      if (show) &#123;</span><br><span class="line"><span class="actionscript">        <span class="keyword">this</span>.$nextTick(<span class="keyword">this</span>.setPosition);</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  beforeDestroy() &#123;</span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> popperElm = <span class="keyword">this</span>.$el;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">if</span> (popperElm &amp;&amp; popperElm.parentNode === <span class="built_in">document</span>.body) &#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">document</span>.body.removeChild(popperElm);</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="javascript">    <span class="built_in">document</span>.removeEventListener(<span class="string">"mousedown"</span>, <span class="keyword">this</span>.clickDocumentHandler);</span></span><br><span class="line">  &#125;,</span><br><span class="line">  mounted() &#123;</span><br><span class="line"><span class="javascript">    <span class="built_in">document</span>.body.appendChild(<span class="keyword">this</span>.$el);</span></span><br><span class="line"><span class="javascript">    <span class="built_in">document</span>.addEventListener(<span class="string">"mousedown"</span>, <span class="keyword">this</span>.clickDocumentHandler);</span></span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    clickDocumentHandler() &#123;</span><br><span class="line"><span class="actionscript">      <span class="keyword">if</span> (<span class="keyword">this</span>.show) &#123;</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">this</span>.$emit(<span class="string">"update:show"</span>, <span class="literal">false</span>);</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    setPosition() &#123;</span><br><span class="line"><span class="javascript">      <span class="keyword">let</span> docHeight = <span class="built_in">document</span>.documentElement.clientHeight;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">let</span> docWidth = <span class="built_in">document</span>.documentElement.clientWidth;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">let</span> menuHeight = <span class="keyword">this</span>.$el.getBoundingClientRect().height;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">let</span> menuWidth = <span class="keyword">this</span>.$el.getBoundingClientRect().width;</span></span><br><span class="line"><span class="actionscript">      <span class="comment">// å¢åŠ ç‚¹å‡»å¤„ä¸èœå•é—´é—´éš”ï¼Œè¾ƒä¸ºç¾è§‚</span></span></span><br><span class="line"><span class="actionscript">      <span class="keyword">const</span> gap = <span class="number">10</span>;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">let</span> topover =</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">this</span>.offset.top + menuHeight + gap &gt;= docHeight</span></span><br><span class="line">          ? menuHeight + gap</span><br><span class="line">          : -gap;</span><br><span class="line"><span class="javascript">      <span class="keyword">let</span> leftover =</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">this</span>.offset.left + menuWidth + gap &gt;= docWidth ? menuWidth + gap : -gap;</span></span><br><span class="line"><span class="actionscript">      <span class="keyword">this</span>.style = &#123;</span></span><br><span class="line"><span class="javascript">        left: <span class="string">`<span class="subst">$&#123;<span class="keyword">this</span>.offset.left - leftover&#125;</span>px`</span>,</span></span><br><span class="line"><span class="javascript">        top: <span class="string">`<span class="subst">$&#123;<span class="keyword">this</span>.offset.top - topover&#125;</span>px`</span></span></span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">lang</span>=<span class="string">"scss"</span> <span class="attr">scoped</span>&gt;</span></span><br><span class="line"><span class="css"><span class="selector-class">.context-menu</span> &#123;</span></span><br><span class="line">  z-index: 1000;</span><br><span class="line">  display: block;</span><br><span class="line">  position: absolute;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>å½“ç„¶ï¼Œå¦‚æœè¦åšåˆ°ï¼ˆé¡µé¢æ»šåŠ¨/page resizeï¼‰ç­‰èœå•ä½ç½®è·Ÿç€å˜åŒ–ï¼Œå¯ä»¥å‚è€ƒ element popper çš„å®ç°</p>
<ol>
<li><a href="https://github.com/ElemeFE/element/blob/dev/src/utils/popper.js" target="_blank" rel="noopener">https://github.com/ElemeFE/element/blob/dev/src/utils/popper.js</a></li>
<li><a href="https://github.com/ElemeFE/element/blob/dev/src/utils/vue-popper.js" target="_blank" rel="noopener">https://github.com/ElemeFE/element/blob/dev/src/utils/vue-popper.js</a></li>
</ol>
<p>å³é”®èœå•åº”è¯¥æ˜¯æ²¡æœ‰è¿™æ ·çš„éœ€æ±‚</p>
<h2 id="å¢åŠ æ˜¾ç¤º-éšè—çš„è¿‡åº¦åŠ¨ç”»"><a href="#å¢åŠ æ˜¾ç¤º-éšè—çš„è¿‡åº¦åŠ¨ç”»" class="headerlink" title="å¢åŠ æ˜¾ç¤º/éšè—çš„è¿‡åº¦åŠ¨ç”»"></a>å¢åŠ æ˜¾ç¤º/éšè—çš„è¿‡åº¦åŠ¨ç”»</h2><p>è¿™ä¸ªä¹Ÿæ¯”è¾ƒç®€å•ï¼Œé‡‡ç”¨ vue è‡ªå¸¦çš„ transition</p>
<p>ContextMenu ä¸­åŒ…ä¸€å±‚ <code>&lt;transition name=&quot;context-menu&quot;&gt;</code></p>
<p>style æ ·å¼ æ”¹ä¸º</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&lt;style lang="scss" scoped&gt;</span><br><span class="line"><span class="selector-class">.context-menu</span> &#123;</span><br><span class="line">  <span class="attribute">z-index</span>: <span class="number">1000</span>;</span><br><span class="line">  <span class="attribute">display</span>: block;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  &amp;-enter,</span><br><span class="line">  &amp;<span class="selector-tag">-leave-to</span> &#123;</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  &amp;<span class="selector-tag">-enter-active</span>,</span><br><span class="line">  &amp;<span class="selector-tag">-leave-active</span> &#123;</span><br><span class="line">    <span class="attribute">transition</span>: opacity <span class="number">0.5s</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<h2 id="æ’ä»¶æ³¨å†Œ"><a href="#æ’ä»¶æ³¨å†Œ" class="headerlink" title="æ’ä»¶æ³¨å†Œ"></a>æ’ä»¶æ³¨å†Œ</h2><p>å‚è€ƒäº† <a href="https://github.com/ElemeFE/element/blob/master/src/index.js" target="_blank" rel="noopener">element-ui</a> çš„ä»£ç å’Œ <a href="https://github.com/ElemeFE/element#quick-start" target="_blank" rel="noopener">README</a></p>
<p>ä»¥åŠ <a href="https://cn.vuejs.org/v2/guide/plugins.html" target="_blank" rel="noopener">vue å®˜æ–¹æ–‡æ¡£-æ’ä»¶</a> </p>
<p>æˆ‘ä»¬å…ˆåˆ›å»ºä¸€ä¸ª contextmenu.js</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> ContextMenu <span class="keyword">from</span> <span class="string">"@/components/ContextMenu.vue"</span>;</span><br><span class="line"><span class="keyword">const</span> plugin = &#123;&#125;;</span><br><span class="line">plugin.install = <span class="function"><span class="keyword">function</span>(<span class="params">Vue</span>) </span>&#123;</span><br><span class="line">  Vue.component(ContextMenu.name, ContextMenu);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Auto install</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="built_in">window</span> !== <span class="string">"undefined"</span> &amp;&amp; <span class="built_in">window</span>.Vue) &#123;</span><br><span class="line">  <span class="built_in">window</span>.Vue.use(plugin);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> plugin;</span><br><span class="line"><span class="keyword">export</span> &#123; ContextMenu &#125;;</span><br></pre></td></tr></table></figure>

<p>æ¥ä¸‹æ¥ä½¿ç”¨çš„è¯æœ‰3ç§æ–¹å¼</p>
<p>main.js</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> ContextMenu <span class="keyword">from</span> <span class="string">"./contextmenu"</span>;</span><br><span class="line"><span class="comment">// å°†ä¼šè°ƒç”¨installæ–¹æ³•</span></span><br><span class="line">Vue.use(ContextMenu);</span><br><span class="line"><span class="comment">// or </span></span><br><span class="line"><span class="keyword">import</span> &#123; ContextMenu &#125; <span class="keyword">from</span> <span class="string">"./contextmenu"</span>;</span><br><span class="line">Vue.component(ContextMenu.name, ContextMenu);</span><br></pre></td></tr></table></figure>

<p>æˆ–è€…åœ¨vueæ–‡ä»¶ä¸­ä½¿ç”¨(åŒæ³•2ï¼Œå±€éƒ¨æ³¨å†Œ)</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ContextMenu &#125; <span class="keyword">from</span> <span class="string">"@/contextmenu"</span>;</span><br><span class="line">components: &#123;</span><br><span class="line">  <span class="string">"context-menu"</span>: ContextMenu,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<code>ContextMenu.vue</code> ä¸­ name ä¸º <code>context-name</code>, æ•… Home.vue ä¸­åº”è¯¥ç›¸åº”çš„æ”¹ä¸º <code>&lt;context-name/&gt;</code> </p>
<h2 id="æ»šåŠ¨å®šä½åç§»é—®é¢˜"><a href="#æ»šåŠ¨å®šä½åç§»é—®é¢˜" class="headerlink" title="æ»šåŠ¨å®šä½åç§»é—®é¢˜"></a>æ»šåŠ¨å®šä½åç§»é—®é¢˜</h2><p>body å’Œ Dashbox çˆ¶å®¹å™¨ éƒ½å¯æ»šåŠ¨çš„æƒ…å†µä¸‹ï¼Œä¼šå‡ºç°èœå•ä¸åœ¨ç‚¹å‡»ä½ç½®çš„é—®é¢˜ï¼Œ</p>
<p>æµ‹è¯•é¡µé¢ï¼šä¿®æ”¹ Home.vue</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"home"</span>&gt;</span></span><br><span class="line">+   <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"content"</span>&gt;</span></span><br><span class="line">      ...</span><br><span class="line">+   <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">//å¢åŠ æ ·å¼</span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">lang</span>=<span class="string">"scss"</span> <span class="attr">scoped</span>&gt;</span></span><br><span class="line"><span class="css"><span class="selector-class">.home</span> &#123;</span></span><br><span class="line">  margin: 10px;</span><br><span class="line">  overflow: scroll;</span><br><span class="line">  height: 1500px;</span><br><span class="line">  width: 100%;</span><br><span class="line"><span class="css">  <span class="selector-tag">background</span>: <span class="selector-id">#eee</span>;</span></span><br><span class="line"><span class="css">  <span class="selector-class">.content</span> &#123;</span></span><br><span class="line">    position: relative;</span><br><span class="line">    height: 2000px;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>æ­¤æ—¶å…ˆæ»šåŠ¨ homeï¼Œç„¶åå³é”®dashbox å°±ä¼šå‘ç°é”™ä½äº†ï¼Œå› ä¸ºæ­¤æ—¶çš„ event.clientY æ¯” ç»å¯¹å®šä½çš„ top å°‘äº†ä¸€ä¸ª scrollY å€¼</p>
<p>æœ‰ä¸¤ç§æ–¹æ³•ï¼š</p>
<ol>
<li>å°† ContextMenu çš„ position ç”± absolute æ”¹ä¸º fixed</li>
<li>ä¼ å…¥çš„åæ ‡é‡‡ç”¨ pageX/Y</li>
</ol>
<p><em>é¢˜å¤–è¯</em></p>
<p>ä¸Šæ–‡æåˆ°ï¼ŒContextMenu æ˜¯æ’å…¥ body çš„ï¼Œé‚£æœ‰æ²¡æœ‰ä»€ä¹ˆåœºæ™¯æ˜¯ä¸æ’å…¥bodyçš„ï¼Œå¦å¤– element-ui ä¸­ <code>popper-append-to-body=false</code> çš„åœºæ™¯æ˜¯ä»€ä¹ˆï¼Œè¿™é‡Œä¼šå‡ºç°ä¹ˆï¼Œåº”è¯¥æ€ä¹ˆè§£å†³ï¼Ÿ</p>
<p>å½“ Dashbox ç»„ä»¶çš„çˆ¶èŠ‚ç‚¹å®¹å™¨æ˜¯é™åˆ¶é«˜åº¦ä¸”å¯ä»¥ scroll çš„æ—¶å€™ï¼Œè‹¥è¦æ±‚å³é”®èœå•ï¼ˆå¼¹æ¡†ç­‰ï¼‰ä¸èƒ½è¶…å‡ºå®¹å™¨ï¼Œåˆ™ä¸åº”è¯¥æ’å…¥body,å½“å‰ï¼Œæˆ‘ä»¬å³é”®èœå•æ²¡æœ‰è¿™æ ·çš„è¦æ±‚</p>
<p>å‚è€ƒ antd-select ä¾‹å­ <a href="https://codesandbox.io/s/4j168r7jw0" target="_blank" rel="noopener">https://codesandbox.io/s/4j168r7jw0</a></p>
<h2 id="ç”Ÿæˆ-vue-cli-æ’ä»¶"><a href="#ç”Ÿæˆ-vue-cli-æ’ä»¶" class="headerlink" title="ç”Ÿæˆ vue-cli æ’ä»¶"></a>ç”Ÿæˆ vue-cli æ’ä»¶</h2><p>æœ‰ç”¨è¿‡ <code>vue-cli 3</code> å’Œ <code>element-ui</code> çš„ï¼Œåº”è¯¥ç†Ÿæ‚‰ <a href="https://github.com/ElementUI/vue-cli-plugin-element" target="_blank" rel="noopener">vue-cli-plugin-element</a></p>
<p>åœ¨æˆ‘ä»¬çš„é¡¹ç›®ä¸­ï¼Œä½¿ç”¨ <code>vue add element</code> å‘½ä»¤åï¼Œä¼šè‡ªåŠ¨å»ä¸‹è½½ <code>vue-cli-plugin-element</code> å¹¶åœ¨ plugins æ–‡ä»¶å¤¹ä¸­æ–°å¢ element.js æœ€ååœ¨ main.js ä¸­ä½¿ç”¨ï¼Œçœå»äº†ä¸Šé¢é‚£äº›æ‰‹åŠ¨å¼•å…¥çš„è¿‡ç¨‹ã€‚</p>
<p>è¿™é‡Œæˆ‘ä»¬ä¹Ÿå°è¯•ç¼–å†™ä¸€ä¸ª <a href="https://github.com/francecil/vue-cli-plugin-contextmenu" target="_blank" rel="noopener">vue-cli-plugin-contextmenu</a></p>
<p>é¡¹ç›®ç»“æ„</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">.</span><br><span class="line">â”œâ”€â”€ README.md</span><br><span class="line">â”œâ”€â”€ generator.js  # generator (å¯é€‰,è¿™é‡Œé‡‡ç”¨ generator&#x2F;index.js çš„å½¢å¼)</span><br><span class="line">â”œâ”€â”€ prompts.js    # prompt æ–‡ä»¶ (å¯é€‰,æœ¬é¡¹ç›®ä¸ä½¿ç”¨)</span><br><span class="line">â”œâ”€â”€ index.js      # service æ’ä»¶</span><br><span class="line">â””â”€â”€ package.json</span><br></pre></td></tr></table></figure>

<p>ä»£ç çš„è¯ä¸»è¦æ˜¯å‚è€ƒ <a href="https://github.com/ElementUI/vue-cli-plugin-element" target="_blank" rel="noopener">vue-cli-plugin-element</a> ï¼Œå…¶ä¸­æœ€ä¸»è¦çš„æ˜¯ generator çš„ä»£ç ï¼Œå¦‚ä¸‹</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function">(<span class="params">api, opts, rootOptions</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> utils = <span class="built_in">require</span>(<span class="string">'./utils'</span>)(api)</span><br><span class="line"></span><br><span class="line">  api.extendPackage(&#123;</span><br><span class="line">    dependencies: &#123;</span><br><span class="line">      <span class="string">'@gahing/vcontextmenu'</span>: <span class="string">'^1.0.0'</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  api.injectImports(utils.getMain(), <span class="string">`import './plugins/contextmenu.js'`</span>)</span><br><span class="line"></span><br><span class="line">  api.render(&#123;</span><br><span class="line">    <span class="string">'./src/plugins/contextmenu.js'</span>: <span class="string">'./templates/src/plugins/contextmenu.js'</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å½“æˆ‘ä»¬å†™å®Œåï¼Œéœ€è¦è¿›è¡Œæœ¬åœ°æµ‹è¯•ä¸‹</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºæµ‹è¯•é¡¹ç›®(å…¨é€‰é»˜è®¤è®¾ç½®)</span></span><br><span class="line">vue create <span class="built_in">test</span>-app</span><br><span class="line"><span class="built_in">cd</span> <span class="built_in">test</span>-app</span><br><span class="line"><span class="comment"># cdåˆ°é¡¹ç›®æ–‡ä»¶å¤¹å¹¶å®‰è£…æˆ‘ä»¬æ–°åˆ›å»ºçš„æ’ä»¶</span></span><br><span class="line">npm i file://E:/WebProjects/vue-cli-plugin-contextmenu -S</span><br><span class="line"><span class="comment"># è°ƒç”¨è¯¥æ’ä»¶</span></span><br><span class="line">vue invoke vue-cli-plugin-contextmenu</span><br></pre></td></tr></table></figure>
<p>æŸ¥çœ‹test-appé¡¹ç›®çš„main.js,å°†ä¼šçœ‹åˆ°æ–°å¢è¿™è¡Œä»£ç ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'./plugins/contextmenu.js'</span></span><br></pre></td></tr></table></figure>

<p>plugins/contextmenu.js ä¸­å†…å®¹ä¸º</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> ContextMenu <span class="keyword">from</span> <span class="string">'@gahing/vcontextmenu'</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">'@gahing/vcontextmenu/lib/vcontextmenu.css'</span></span><br><span class="line">Vue.use(ContextMenu)</span><br></pre></td></tr></table></figure>

<p>è‡³æ­¤ï¼Œvue-cli-plugin-contextmenu å°±å¼€å‘å®Œæˆï¼Œå°†å…¶å‘å¸ƒåˆ° npm ä¸Š</p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ol>
<li><p><a href="https://cli.vuejs.org/zh/dev-guide/plugin-dev.html#%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5" target="_blank" rel="noopener">æ’ä»¶å¼€å‘æŒ‡å—</a></p>
</li>
<li><p><a href="https://github.com/ElementUI/vue-cli-plugin-element" target="_blank" rel="noopener">vue-cli-plugin-element</a></p>
</li>
<li><p><a href="https://juejin.im/post/5cb59c4bf265da03a743e979" target="_blank" rel="noopener">ã€ŒVueè¿›é˜¶ã€5åˆ†é’Ÿæ’¸ä¸€ä¸ªVue CLI æ’ä»¶</a></p>
</li>
</ol>
]]></content>
      <categories>
        <category>å¤§å‰ç«¯</category>
      </categories>
      <tags>
        <tag>Vue</tag>
      </tags>
  </entry>
  <entry>
    <title>å¤§å±å¯è§†åŒ–ä¹‹ç»„ä»¶å±‚çº§è®¾ç½®</title>
    <url>/2019/07/02/2019Q3/%E5%A4%A7%E5%B1%8F%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8B%E7%BB%84%E4%BB%B6%E5%B1%82%E7%BA%A7%E8%AE%BE%E7%BD%AE/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æœ€è¿‘åœ¨è¿›è¡Œå¤§å±å¯è§†åŒ–äº§å“çš„æŠ€æœ¯è°ƒç ”ï¼Œä¸»è¦æ˜¯è°ƒç ” ç½‘æ˜“æœ‰æ•° å’Œ datav</p>
<p>åœ¨ç»„ä»¶å±‚çº§æ’åˆ—è¿™å—ï¼Œä¸¤è€…çš„å®ç°æ˜¯ä¸ä¸€æ ·çš„</p>
<ul>
<li>datav:ç»„ä»¶å‡åœ¨åŒçº§ï¼ˆz-indexéƒ½æ˜¯ä¸€æ ·çš„ï¼‰ï¼Œåå®šä¹‰çš„å±äºé«˜å±‚ã€‚è°ƒæ•´å±‚çº§å°±éœ€è¦ç§»åŠ¨domèŠ‚ç‚¹ä½ç½®</li>
<li>æœ‰æ•°:æ ¹æ®z-indexå»è®¾ç½®ï¼Œè°ƒæ•´å±‚çº§å°±éœ€è¦è°ƒæ•´è‡ªèº«z-indexä»¥åŠå…¶ä»–å—å½±å“çš„å›¾è¡¨ z-index</li>
</ul>
<p>é€šè¿‡åˆ†ævueä¸Šä¸¤è€…çš„å®ç°ï¼Œæ¯”è¾ƒä¸¤è€…çš„ä¼˜ç¼ºç‚¹</p>
<a id="more"></a>


<h2 id="datav"><a href="#datav" class="headerlink" title="datav"></a>datav</h2><p>Dashbox æ˜¯å±‚çº§æ§ä»¶</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Dashbox</span></span></span><br><span class="line"><span class="tag">    <span class="attr">v-for</span>=<span class="string">"dashbox in dashboxs"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:key</span>=<span class="string">"dashbox.id"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:dashbox</span>=<span class="string">"dashbox"</span></span></span><br><span class="line"><span class="tag">  &gt;</span><span class="tag">&lt;/<span class="name">Dashbox</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line">  data()&#123;</span><br><span class="line"><span class="actionscript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line">      dashboxs:[&#123;...&#125;,&#123;...&#125;]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>å½“è°ƒæ•´å±‚çº§æ—¶ï¼Œæˆ‘ä»¬è°ƒç”¨æ–¹æ³•</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">move:<span class="function">(<span class="params">type,id</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="keyword">let</span> index = <span class="keyword">this</span>.dashboxs.findIndex(<span class="function"><span class="params">dashbox</span>=&gt;</span>dashbox.id===id)</span><br><span class="line">  <span class="keyword">switch</span>(type)&#123;</span><br><span class="line">    <span class="comment">//ä¸Šç§»ä¸€å±‚</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">'up'</span>:&#123;</span><br><span class="line">      <span class="keyword">let</span> dashbox = <span class="keyword">this</span>.dashboxs.splice(index,<span class="number">1</span>)</span><br><span class="line">      <span class="keyword">this</span>.dashboxs.splice(index+<span class="number">1</span>,<span class="number">0</span>,dashbox[<span class="number">0</span>])</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//ä¸‹ç§»ä¸€å±‚</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">'down'</span>:&#123;</span><br><span class="line">      <span class="keyword">let</span> dashbox = <span class="keyword">this</span>.dashboxs.splice(index,<span class="number">1</span>)</span><br><span class="line">      <span class="keyword">this</span>.dashboxs.splice(index - <span class="number">1</span> &gt;= <span class="number">0</span> ? index - <span class="number">1</span> : <span class="number">0</span>, <span class="number">0</span>,dashbox[<span class="number">0</span>])</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//ç½®é¡¶</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">'top'</span>:&#123;</span><br><span class="line">      <span class="keyword">let</span> dashbox = <span class="keyword">this</span>.dashboxs.splice(index,<span class="number">1</span>)</span><br><span class="line">      <span class="keyword">this</span>.dashboxs.push(dashbox)</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//ç½®åº•</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">'bottom'</span>:&#123;</span><br><span class="line">      <span class="keyword">let</span> dashbox = <span class="keyword">this</span>.dashboxs.splice(index,<span class="number">1</span>)</span><br><span class="line">      <span class="keyword">this</span>.dashboxs.unshift(dashbox)</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ¯ä¸ª dashbox æœ‰keyå€¼ï¼Œæ ¹æ® diff ç®—æ³•åŒçº§ç»„ä»¶ä¹‹é—´æ›´æ”¹ä½ç½®è¿˜æ˜¯å¾ˆé«˜æ•ˆçš„</p>
<p>ä¼˜ç‚¹ï¼š</p>
<ol>
<li>å±‚çº§è°ƒæ•´æ–¹æ³•å®ç°ç®€å•</li>
<li>dashbox æ•°æ®ä¸ç”¨å¸¦z-indexå‚æ•°ï¼ŒèŠ‚çœç©ºé—´</li>
</ol>
<p>ç¼ºç‚¹ï¼š</p>
<ol>
<li>dom èŠ‚ç‚¹ç§»åŠ¨ä¼šäº§ç”ŸLayout,ä¸è¿‡è¿™é‡Œç”¨çš„ç»å¯¹å®šä½ï¼Œæ‰€ä»¥å½±å“å¾ˆå°ï¼Œæµ‹è¯•Layoutè€—æ—¶åœ¨1mså·¦å³(Performanceä¸­æ— çº¢è‰²æç¤º)</li>
</ol>
<h2 id="æœ‰æ•°"><a href="#æœ‰æ•°" class="headerlink" title="æœ‰æ•°"></a>æœ‰æ•°</h2><p>Dashbox æ˜¯å±‚çº§æ§ä»¶ ç»„ä»¶çš„ zIndex å€¼ä»1å¼€å§‹ï¼Œä¸æ–­é€’å¢ä¸”ä¸ä¸­æ–­</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Dashbox</span></span></span><br><span class="line"><span class="tag">    <span class="attr">v-for</span>=<span class="string">"dashbox in dashboxs"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:key</span>=<span class="string">"dashbox.id"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:dashbox</span>=<span class="string">"dashbox"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">style</span>=<span class="string">"z-index:`$&#123;dashbox.zIndex&#125;`"</span></span></span><br><span class="line"><span class="tag">  &gt;</span><span class="tag">&lt;/<span class="name">Dashbox</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line">  data()&#123;</span><br><span class="line"><span class="actionscript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line">      dashboxs:[&#123;...&#125;,&#123;...&#125;]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>å½“è°ƒæ•´å±‚çº§æ—¶ï¼Œæˆ‘ä»¬è°ƒç”¨æ–¹æ³•</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">move:<span class="function">(<span class="params">type,id</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="keyword">let</span> dashbox = <span class="keyword">this</span>.dashboxs.find(<span class="function"><span class="params">dashbox</span>=&gt;</span>dashbox.id===id)</span><br><span class="line">  <span class="keyword">let</span> maxz = <span class="keyword">this</span>.dashboxs.length</span><br><span class="line">  <span class="keyword">let</span> curz = dashbox.zIndex</span><br><span class="line">  <span class="keyword">switch</span>(type)&#123;</span><br><span class="line">    <span class="comment">//ä¸Šç§»ä¸€å±‚</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">'up'</span>:&#123;</span><br><span class="line">      <span class="keyword">if</span>(curz&lt;maxz)&#123;</span><br><span class="line">        <span class="keyword">this</span>.dashboxs.find(<span class="function"><span class="params">d</span>=&gt;</span>d.zIndex===curz+<span class="number">1</span>).zIndex = curz</span><br><span class="line">        dashbox.zIndex = curz +<span class="number">1</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//ä¸‹ç§»ä¸€å±‚</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">'down'</span>:&#123;</span><br><span class="line">      <span class="keyword">if</span>(curz&gt;<span class="number">1</span>)&#123;</span><br><span class="line">        <span class="keyword">this</span>.dashboxs.find(<span class="function"><span class="params">d</span>=&gt;</span>d.zIndex===curz<span class="number">-1</span>).zIndex = curz</span><br><span class="line">        dashbox.zIndex = curz - <span class="number">1</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//ç½®é¡¶</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">'top'</span>:&#123;</span><br><span class="line">      <span class="keyword">if</span>(curz!==maxz)&#123;</span><br><span class="line">        <span class="keyword">this</span>.dashboxs.forEach(<span class="function"><span class="params">v</span>=&gt;</span>v.zIndex&gt;curz&amp;&amp;v.zIndex=v.zIndex<span class="number">-1</span>)</span><br><span class="line">        dashbox.zIndex = maxz</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//ç½®åº•</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">'bottom'</span>:&#123;</span><br><span class="line">      <span class="keyword">if</span>(curz!==<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">this</span>.dashboxs.forEach(<span class="function"><span class="params">v</span>=&gt;</span>v.zIndex&lt;curz&amp;&amp;v.zIndex=v.zIndex+<span class="number">1</span>)</span><br><span class="line">        dashbox.zIndex = <span class="number">0</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¼˜ç‚¹ï¼š</p>
<ol>
<li>åˆ©ç”¨z-indexä»…é‡ç»˜ï¼Œä¸äº§ç”Ÿå›æµ</li>
</ol>
<p>ç¼ºç‚¹ï¼š</p>
<ol>
<li>å±‚çº§è°ƒæ•´æ–¹æ³•ç›¸å¯¹å¤æ‚</li>
<li>ç»„ä»¶è¿‡å¤šæ—¶z-indexä¸å¯æ§ï¼Œå¯èƒ½å½±å“å…¶ä»–åŒå±‚çº§édashboxç»„ä»¶çš„å±‚çº§æ˜¾ç¤ºï¼ˆæ¯”å¦‚åŒå±‚çº§æœ‰ä¸€ä¸ªåˆ’æ¡†ï¼Œå…¶z-indexå°±ç»å¯¹è¦åœ¨æœ€é«˜å±‚ï¼‰</li>
<li>æ•°æ®å¢åŠ z-indexå­—æ®µï¼Œç•¥å¾®å¢åŠ äº†ç©ºé—´</li>
</ol>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ol>
<li><a href="https://csstriggers.com/" target="_blank" rel="noopener">ä¸åŒæ¸²æŸ“å¼•æ“åœ¨ä¸åŒæ ·å¼å˜åŠ¨ä¸‹çš„Layout/Paint/Composite(æ¸²æŸ“å±‚åˆå¹¶)æƒ…å†µ</a></li>
</ol>
]]></content>
      <categories>
        <category>å¤§å‰ç«¯</category>
      </categories>
      <tags>
        <tag>å¤§å±</tag>
      </tags>
  </entry>
  <entry>
    <title>vscodeé…ç½®åŒæ­¥åŠæ‹“å±•æ‰¹é‡ç¦»çº¿å®‰è£…</title>
    <url>/2019/07/01/2019Q3/vscode%E9%85%8D%E7%BD%AE%E5%90%8C%E6%AD%A5%E5%8F%8A%E6%8B%93%E5%B1%95%E6%89%B9%E9%87%8F%E7%A6%BB%E7%BA%BF%E5%AE%89%E8%A3%85/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><ol>
<li>æ¢ç”µè„‘åï¼Œæ€ä¹ˆä¿æŒ é…ç½®ï¼ˆsettings.json,æ’ä»¶,é”®ä½è®¾ç½®ç­‰ï¼‰åŒæ­¥ï¼Ÿ</li>
<li>ç¦»çº¿å®‰è£…æ‹“å±•ï¼Ÿ</li>
<li>åˆ©ç”¨è„šæœ¬è‡ªåŠ¨è¿›è¡Œå‰é¢ä¸¤ä¸ªæ­¥éª¤</li>
</ol>
<a id="more"></a>

<h2 id="é…ç½®åŒæ­¥"><a href="#é…ç½®åŒæ­¥" class="headerlink" title="é…ç½®åŒæ­¥"></a>é…ç½®åŒæ­¥</h2><p><a href="https://juejin.im/post/5b9b5a6f6fb9a05d22728e36" target="_blank" rel="noopener">ä¸‰åˆ†é’Ÿæ•™ä½ åŒæ­¥ Visual Studio Code è®¾ç½®</a></p>
<h2 id="ç¦»çº¿å®‰è£…æ‹“å±•"><a href="#ç¦»çº¿å®‰è£…æ‹“å±•" class="headerlink" title="ç¦»çº¿å®‰è£…æ‹“å±•"></a>ç¦»çº¿å®‰è£…æ‹“å±•</h2><p><a href="https://blog.csdn.net/u012814856/article/details/80684376" target="_blank" rel="noopener">ç®€å•çš„ VSCode æ’ä»¶ç¦»çº¿å®‰è£…æ–¹æ³•</a></p>
<p>å®‰è£…æŒ‡ä»¤</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># vscodeå®‰è£…ç›®å½•/bin</span></span><br><span class="line"><span class="comment"># æ³¨æ„æ‹“å±•çš„è·¯å¾„</span></span><br><span class="line"></span><br><span class="line">./code --install-extension xxx/octref.vetur-0.22.6.vsix</span><br></pre></td></tr></table></figure>

<h2 id="æ‰¹é‡ä¸‹è½½ç¦»çº¿å®‰è£…åŒ…"><a href="#æ‰¹é‡ä¸‹è½½ç¦»çº¿å®‰è£…åŒ…" class="headerlink" title="æ‰¹é‡ä¸‹è½½ç¦»çº¿å®‰è£…åŒ…"></a>æ‰¹é‡ä¸‹è½½ç¦»çº¿å®‰è£…åŒ…</h2><p>è¿™ä¸ªéœ€æ±‚çš„æ¥æºæ˜¯ï¼šäº‘æ¡Œé¢ä¸èƒ½è®¿é—®å¤–ç½‘ä½†æ˜¯å¯ä»¥è®¿é—®å®¿ä¸»æœºï¼Œæƒ³è¦åŒæ­¥å®¿ä¸»æœºçš„ vscode æ‹“å±•åˆ°äº‘æ¡Œé¢ç¯å¢ƒ</p>
<p>å¯ä»¥ç›´æ¥é‡‡ç”¨ <code>ç¦»çº¿å®‰è£…æ‹“å±•</code> çš„åšæ³•ï¼Œä½†æ˜¯å½“æ‹“å±•å¤šäº†å°±å¾ˆæµªè´¹æ—¶é—´ã€‚</p>
<p>æ•…ä¸»è¦åšçš„äº‹æƒ…å°±æ˜¯ï¼š</p>
<ol>
<li>è·å–å¹¶è§£æ æ‹“å±•åˆ—è¡¨ é…ç½®æ–‡ä»¶</li>
<li>æ ¹æ®é…ç½®ä¸‹è½½å®‰è£…åŒ…</li>
</ol>
<!--more-->

<p>æˆ‘ä»¬å…ˆä¸Šæœ€ç»ˆçš„æ“ä½œæ­¥éª¤ï¼š</p>
<blockquote>
<p>ä¸ºäº†ä¿è¯å¹³å°ç»Ÿä¸€ï¼Œæˆ‘ä»¬çš„æ“ä½œé‡‡ç”¨ <code>git bash</code></p>
</blockquote>
<p>è¿›å…¥å®¿ä¸»æœºçš„ vscodeå®‰è£…ç›®å½•/bin ä¸‹,å³é”® <code>Git Bash Here</code> æ‰§è¡Œä»¥ä¸‹è„šæœ¬</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å…ˆåˆ›å»ºä¸€ä¸ªtmpä¸´æ—¶ç›®å½•ï¼Œå®‰è£…åŒ…éƒ½ä¼šä¸‹åˆ°é‡Œé¢</span></span><br><span class="line"><span class="comment"># tr '\n' ' ' å¤šè¡Œè½¬ä¸€è¡Œ</span></span><br><span class="line"><span class="comment"># | sh å°†è¾“å‡ºè¿›è¡Œæ‰§è¡Œ</span></span><br><span class="line">mkdir tmp;</span><br><span class="line">./code --list-extensions --show-versions | sed -r <span class="string">'s/(.*?)\.(.*?)@(.*)/https:\/\/marketplace.visualstudio.com\/_apis\/public\/gallery\/publishers\/\1\/vsextensions\/\2\/\3\/vspackage -o tmp\/\1.\2-\3.vsix/'</span> | tr <span class="string">'\n'</span> <span class="string">' '</span> | sed -r <span class="string">'s/(.*)/curl \1/'</span> | sh</span><br></pre></td></tr></table></figure>
<p>å®‰è£…åŒ…ä¸‹è½½åˆ° tmp ç›®å½•ä¸‹</p>
<p>åœ¨äº‘æ¡Œé¢çš„ vscode ä¸­ï¼Œç‚¹å‡» EXTENSIONS åé¢çš„ â€¦ ç¬¦å·ï¼Œé€‰æ‹© <code>install from VXIS</code> ç„¶åé€‰æ‹©æœ¬åœ°ç›¸åº”çš„æ’ä»¶åŒ…ï¼Œæ’å…¥ï¼Œreload å³å¯ã€‚</p>
<blockquote>
<p>ä¸‹é¢è¿›è¡Œè¯¦ç»†ä»‹ç»ï¼š</p>
</blockquote>
<h3 id="ä¸€ã€è·å–å¹¶è§£æ-æ‹“å±•åˆ—è¡¨-é…ç½®æ–‡ä»¶"><a href="#ä¸€ã€è·å–å¹¶è§£æ-æ‹“å±•åˆ—è¡¨-é…ç½®æ–‡ä»¶" class="headerlink" title="ä¸€ã€è·å–å¹¶è§£æ æ‹“å±•åˆ—è¡¨ é…ç½®æ–‡ä»¶"></a>ä¸€ã€è·å–å¹¶è§£æ æ‹“å±•åˆ—è¡¨ é…ç½®æ–‡ä»¶</h3><h4 id="æ–¹æ¡ˆ0-ç›´æ¥æ‹¿-é…ç½®åŒæ­¥-æ—¶-gist-github-ä¸­ä¿å­˜çš„json"><a href="#æ–¹æ¡ˆ0-ç›´æ¥æ‹¿-é…ç½®åŒæ­¥-æ—¶-gist-github-ä¸­ä¿å­˜çš„json" class="headerlink" title="æ–¹æ¡ˆ0: ç›´æ¥æ‹¿ é…ç½®åŒæ­¥ æ—¶ gist.github ä¸­ä¿å­˜çš„json"></a>æ–¹æ¡ˆ0: ç›´æ¥æ‹¿ <code>é…ç½®åŒæ­¥</code> æ—¶ gist.github ä¸­ä¿å­˜çš„json</h4><h4 id="æ–¹æ¡ˆ1ï¼šè§£æç›®å½•å¹¶å¾—åˆ°åˆ—è¡¨ï¼š"><a href="#æ–¹æ¡ˆ1ï¼šè§£æç›®å½•å¹¶å¾—åˆ°åˆ—è¡¨ï¼š" class="headerlink" title="æ–¹æ¡ˆ1ï¼šè§£æç›®å½•å¹¶å¾—åˆ°åˆ—è¡¨ï¼š"></a>æ–¹æ¡ˆ1ï¼šè§£æç›®å½•å¹¶å¾—åˆ°åˆ—è¡¨ï¼š</h4><p>æˆ‘ä»¬å¯ä»¥åœ¨ä»¥ä¸‹ç›®å½•ä¸­æ‹¿åˆ°æ‹“å±•åˆ—è¡¨ç›®å½•ï¼Œç›®å½•åä¸º<code>${publisher}.${name}-${version}</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Windows %USERPROFILE%\.vscode\extensions</span><br><span class="line">Mac ~&#x2F;.vscode&#x2F;extensions</span><br><span class="line">Linux ~&#x2F;.vscode&#x2F;extensions</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªæ–¹æ¡ˆæ˜¯å¯è¡Œçš„ï¼Œä½†æ˜¯æ„Ÿè§‰æ“ä½œæœ‰ç‚¹éº»çƒ¦ï¼Œå¼ƒ</p>
<h4 id="æ–¹æ¡ˆ2ï¼šä½¿ç”¨code-list-extensionså‘½ä»¤"><a href="#æ–¹æ¡ˆ2ï¼šä½¿ç”¨code-list-extensionså‘½ä»¤" class="headerlink" title="æ–¹æ¡ˆ2ï¼šä½¿ç”¨code --list-extensionså‘½ä»¤"></a>æ–¹æ¡ˆ2ï¼šä½¿ç”¨<code>code --list-extensions</code>å‘½ä»¤</h4><p>åœ¨ vscode å®‰è£…ç›®å½•ä¸‹çš„binç›®å½•ä¸­æ‰§è¡Œ</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">// linux or git shell</span><br><span class="line">./code --list-extensions --show-versions</span><br><span class="line">// windows cmd or powershell</span><br><span class="line">.\code --list-extensions --show-versions</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥åˆ—å‡º <code>${publisher}.${name}@${version}</code>åˆ—è¡¨</p>
<p>ä¾‹å¦‚ï¼ˆç¬¬ä¸€è¡Œä¸ºå‘½åè¡Œæ“ä½œå®Œçš„æç¤ºï¼Œä¸åœ¨å®é™…è¾“å‡ºä¸­ï¼‰ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">[createInstance] extensionManagementService depends on downloadService <span class="built_in">which</span> is NOT registered.</span><br><span class="line">Andreabbondanza.ignoregit@1.0.1</span><br><span class="line">bpruitt-goddard.mermaid-markdown-syntax-highlighting@1.0.1</span><br><span class="line">dbaeumer.vscode-eslint@1.6.0</span><br></pre></td></tr></table></figure>

<p>å‚è€ƒ<a href="https://code.visualstudio.com/docs/editor/command-line" target="_blank" rel="noopener">Command Line Interface (CLI)</a></p>
<h4 id="æ–¹æ¡ˆ3ï¼šä½¿ç”¨-vscode-npm-åŒ…"><a href="#æ–¹æ¡ˆ3ï¼šä½¿ç”¨-vscode-npm-åŒ…" class="headerlink" title="æ–¹æ¡ˆ3ï¼šä½¿ç”¨ vscode npm åŒ…"></a>æ–¹æ¡ˆ3ï¼šä½¿ç”¨ vscode npm åŒ…</h4><p>æœ¬æƒ³ä½¿ç”¨ vscode.extensions.all æ¥å£æ‹¿åˆ°ï¼Œç¢°åˆ°ä¸€äº›tsç›¸å…³çš„é—®é¢˜åæ”¾å¼ƒäº†</p>
<hr>
<blockquote>
<p>æœ€ç»ˆé‡‡ç”¨ <strong>æ–¹æ¡ˆ2</strong></p>
</blockquote>
<h3 id="äºŒã€æ ¹æ®é…ç½®ä¸‹è½½å®‰è£…åŒ…"><a href="#äºŒã€æ ¹æ®é…ç½®ä¸‹è½½å®‰è£…åŒ…" class="headerlink" title="äºŒã€æ ¹æ®é…ç½®ä¸‹è½½å®‰è£…åŒ…"></a>äºŒã€æ ¹æ®é…ç½®ä¸‹è½½å®‰è£…åŒ…</h3><p>ä¸‹è½½é“¾æ¥ä¸ºï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">https://marketplace.visualstudio.com/_apis/public/gallery/publishers/<span class="variable">$&#123;publisher&#125;</span>/vsextensions/<span class="variable">$&#123;name&#125;</span>/<span class="variable">$&#123;version&#125;</span>/vspackage</span><br></pre></td></tr></table></figure>

<p>å‡è®¾æŸä¸ªæ’ä»¶é…ç½®ä¸º</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"metadata"</span>: &#123;</span><br><span class="line">    <span class="attr">"id"</span>: <span class="string">"e337c67b-55c2-4fef-8949-eb260e7fb7fd"</span>,</span><br><span class="line">    <span class="attr">"publisherId"</span>: <span class="string">"Shan.code-settings-sync"</span>,</span><br><span class="line">    <span class="attr">"publisherDisplayName"</span>: <span class="string">"Shan"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"name"</span>: <span class="string">"code-settings-sync"</span>,</span><br><span class="line">  <span class="attr">"publisher"</span>: <span class="string">"Shan"</span>,</span><br><span class="line">  <span class="attr">"version"</span>: <span class="string">"3.1.2"</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>åˆ™ ä¸‹è½½é“¾æ¥ä¸º </p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">https://marketplace.visualstudio.com/_apis/public/gallery/publishers/Shan/vsextensions/code-settings-sync/3.1.2/vspackage</span><br></pre></td></tr></table></figure>

<p>ä¸‹è½½çš„æ–‡ä»¶åä¸º <code>Shan.code-settings-sync-3.1.2.vsix</code></p>
<h4 id="åœ¨æŒ‡å®šç›®å½•ä¸‹åˆ©ç”¨-git-bash-ä¸‹è½½æ–‡ä»¶"><a href="#åœ¨æŒ‡å®šç›®å½•ä¸‹åˆ©ç”¨-git-bash-ä¸‹è½½æ–‡ä»¶" class="headerlink" title="åœ¨æŒ‡å®šç›®å½•ä¸‹åˆ©ç”¨ git bash ä¸‹è½½æ–‡ä»¶"></a>åœ¨æŒ‡å®šç›®å½•ä¸‹åˆ©ç”¨ git bash ä¸‹è½½æ–‡ä»¶</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">curl https:&#x2F;&#x2F;marketplace.visualstudio.com&#x2F;_apis&#x2F;public&#x2F;gallery&#x2F;publishers&#x2F;Shan&#x2F;vsextensions&#x2F;code-settings-sync&#x2F;3.1.2&#x2F;vspackage -O</span><br></pre></td></tr></table></figure>
<p>æœ¬ä»¥ä¸ºä½¿ç”¨ -O ï¼ˆä»¥æœåŠ¡å™¨ä¸Šçš„åç§°ä¿å­˜åœ¨æœ¬åœ°ï¼‰ï¼Œä¸‹è½½çš„æ–‡ä»¶åæ˜¯ <code>Shan.code-settings-sync-3.1.2.vsix</code>ï¼Œç»“æœæ˜¯ <code>vspackage</code></p>
<p>æ ¹æ® <a href="http://www.codebelief.com/article/2017/05/linux-command-line-curl-usage/#3" target="_blank" rel="noopener">cURL-å°†é“¾æ¥ä¿å­˜åˆ°æ–‡ä»¶</a> ä¸­å¾—çŸ¥ï¼Œ</p>
<blockquote>
<p>æ³¨æ„ï¼šä½¿ç”¨ -O é€‰é¡¹æ—¶ï¼Œå¿…é¡»ç¡®ä¿é“¾æ¥æœ«å°¾åŒ…å«æ–‡ä»¶åï¼Œå¦åˆ™ curl æ— æ³•æ­£ç¡®ä¿å­˜æ–‡ä»¶ã€‚å¦‚æœé‡åˆ°é“¾æ¥ä¸­æ— æ–‡ä»¶åçš„æƒ…å†µï¼Œåº”è¯¥ä½¿ç”¨ -o é€‰é¡¹æ‰‹åŠ¨æŒ‡å®šæ–‡ä»¶åï¼Œæˆ–ä½¿ç”¨é‡å®šå‘ç¬¦å·ã€‚</p>
</blockquote>
<p>å¦å¤–ä»‹ç»ä¸‹ sh çš„æ­£åˆ™å’Œæ–‡æœ¬æ›¿æ¢</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">echo</span> dbaeumer.vscode-eslint@1.6.0 | egrep <span class="string">"(.*?)\.(.*?)@(.*)"</span></span><br><span class="line"><span class="comment">#è¾“å‡º dbaeumer.vscode-eslint@1.6.0</span></span><br></pre></td></tr></table></figure>
<p>ä¸€å¼€å§‹ä½¿ç”¨ egrep å‘½ä»¤ï¼Œå‘ç°ä¸èƒ½ç›´æ¥åšæ›¿æ¢ï¼Œåç›´æ¥é‡‡ç”¨ sed å‘½ä»¤</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">'dbaeumer.vscode-eslint@1.6.0'</span> |  sed -r <span class="string">'s/(.*?)\.(.*?)@(.*)/\1.\2-\3.vsix/'</span></span><br><span class="line"><span class="comment"># è¾“å‡º dbaeumer.vscode-eslint-1.6.0.vsix</span></span><br></pre></td></tr></table></figure>

<p>-r å‚æ•°è¡¨ç¤º sed å¼€å¯æ‹“å±•æ­£åˆ™åŠŸèƒ½</p>
<p>å‚è€ƒ <a href="https://www.cnblogs.com/jcli/p/4088514.html" target="_blank" rel="noopener">sedä»‹ç»</a></p>
<p><strong>å•æ–‡ä»¶ä¸‹è½½çš„ sh å‘½ä»¤å³</strong></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">'dbaeumer.vscode-eslint@1.6.0'</span> | sed -r <span class="string">'s/(.*?)\.(.*?)@(.*)/curl https:\/\/marketplace.visualstudio.com\/_apis\/public\/gallery\/publishers\/\1\/vsextensions\/\2\/\3\/vspackage -o \1.\2-\3.vsix/'</span> | sh</span><br></pre></td></tr></table></figure>

<p>ç»“åˆæ­¥éª¤ä¸€</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å…ˆåˆ›å»ºä¸€ä¸ªtmpä¸´æ—¶ç›®å½•ï¼Œå®‰è£…åŒ…éƒ½ä¼šä¸‹åˆ°é‡Œé¢</span></span><br><span class="line"><span class="comment"># tr '\n' ' ' å¤šè¡Œè½¬ä¸€è¡Œ</span></span><br><span class="line"><span class="comment"># | sh å°†è¾“å‡ºè¿›è¡Œæ‰§è¡Œ</span></span><br><span class="line">mkdir tmp;</span><br><span class="line">./code --list-extensions --show-versions | sed -r <span class="string">'s/(.*?)\.(.*?)@(.*)/https:\/\/marketplace.visualstudio.com\/_apis\/public\/gallery\/publishers\/\1\/vsextensions\/\2\/\3\/vspackage -o tmp\/\1.\2-\3.vsix/'</span> | tr <span class="string">'\n'</span> <span class="string">' '</span> | sed -r <span class="string">'s/(.*)/curl \1/'</span> | sh</span><br></pre></td></tr></table></figure>


<h2 id="åç»­"><a href="#åç»­" class="headerlink" title="åç»­"></a>åç»­</h2><p>å‘ç°æœ‰çš„æ–‡ä»¶ä¸‹è½½ä¸‹æ¥å®‰è£…ä¸äº†ï¼Œæç¤º <code>end of central directory record signature not found</code></p>
<p>å¯èƒ½æ˜¯å½“å‰æ’ä»¶æ‰€ä¾èµ–çš„ vscode ç‰ˆæœ¬è¾ƒé«˜ï¼Œè¦ä¹ˆå‡çº§ vscode è¦ä¹ˆä¸‹è½½æ—§ç‰ˆæ’ä»¶</p>
<blockquote>
<p>å¯ä»¥å» <code>https://marketplace.visualstudio.com/items/${publisher}.${name}/changelog</code> æŸ¥çœ‹ç‰ˆæœ¬è®°å½•ä¸‹è½½æ—§ç‰ˆæœ¬</p>
</blockquote>
<p>ä¹Ÿæœ‰å¯èƒ½éœ€è¦å» <code>gallery.vsassets.io</code> ä¸‹è½½</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">https://<span class="variable">$&#123;publisher&#125;</span>.gallery.vsassets.io/_apis/public/gallery/publisher/<span class="variable">$&#123;publisher&#125;</span>/extension/<span class="variable">$&#123;extension name&#125;</span>/<span class="variable">$&#123;version&#125;</span>/assetbyname/Microsoft.VisualStudio.Services.VSIXPackage</span><br></pre></td></tr></table></figure>

<p>sh å‘½ä»¤</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">'dbaeumer.vscode-eslint@1.6.0'</span> | sed -r <span class="string">'s/(.*?)\.(.*?)@(.*)/curl https:\/\/\1.gallery.vsassets.io\/_apis\/public\/gallery\/publisher\/\1\/extension\/\2\/\3\/assetbyname\/Microsoft.VisualStudio.Services.VSIXPackage -o \1.\2-\3.vsix/'</span> | sh</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼Œå¦‚æœç”¨å‘½ä»¤è¡Œä¸‹è½½çš„æ—¶å€™æç¤ºï¼š<code>curl:(92) HTTP/2 stream 1 was not closed cleanly: HTTP_1_1_REQUIRED (err 13)</code>,éœ€è¦é‡æ–°ä¸‹</p>
]]></content>
      <categories>
        <category>éšç¬”</category>
      </categories>
      <tags>
        <tag>vscode</tag>
        <tag>shell</tag>
      </tags>
  </entry>
  <entry>
    <title>React ContextåŠæ¢è‚¤åŠŸèƒ½å®ç°</title>
    <url>/2019/07/01/2019Q3/React%20Context%E5%8F%8A%E6%8D%A2%E8%82%A4%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>é€šè¿‡è®²è§£ React Context çš„ç”¨æ³•ï¼Œå¼•å‡º React æ¢è‚¤åŠŸèƒ½çš„å®ç°</p>
<a id="more"></a>

<h2 id="Context-æ¦‚å¿µ"><a href="#Context-æ¦‚å¿µ" class="headerlink" title="Context æ¦‚å¿µ"></a>Context æ¦‚å¿µ</h2><p>åœ¨ç»„ä»¶æ ‘ä¸­å…±äº«æ•°æ®ï¼Œé¿å…é€å±‚ä¼ é€’ã€‚</p>
<p>æˆ‘ä»¬ç»å¸¸é‡åˆ°è¿™æ ·çš„åœºæ™¯ï¼Œæ•°æ®éœ€è¦ä¼ åˆ°å­ç»„ä»¶çš„å­ç»„ä»¶æ›´ç”šè‡³æ›´ä¸‹å±‚ç»„ä»¶ï¼Œç”¨propsé€å±‚ä¼ é€’çš„ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Toolbar</span> <span class="attr">theme</span>=<span class="string">"dark"</span> /&gt;</span>;</span></span><br><span class="line"><span class="xml">  &#125;</span></span><br><span class="line"><span class="xml">&#125;</span></span><br><span class="line"><span class="xml">function Toolbar(props) &#123;</span></span><br><span class="line"><span class="xml">  // Toolbar ç»„ä»¶æ¥å—ä¸€ä¸ªé¢å¤–çš„â€œthemeâ€å±æ€§ï¼Œç„¶åä¼ é€’ç»™ Button ç»„ä»¶ã€‚</span></span><br><span class="line"><span class="xml">  // å¦‚æœåº”ç”¨ä¸­æ¯ä¸€ä¸ªå•ç‹¬çš„æŒ‰é’®éƒ½éœ€è¦çŸ¥é“ theme çš„å€¼ï¼Œè¿™ä¼šæ˜¯ä»¶å¾ˆéº»çƒ¦çš„äº‹ï¼Œ</span></span><br><span class="line"><span class="xml">  // å› ä¸ºå¿…é¡»å°†è¿™ä¸ªå€¼å±‚å±‚ä¼ é€’æ‰€æœ‰ç»„ä»¶ã€‚</span></span><br><span class="line"><span class="xml">  return (</span></span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;Button theme=&#123;props.theme&#125; /&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line">function Button(props)&#123;</span><br><span class="line">  // Button ç»„ä»¶æ ¹æ®ä¼ é€’è¿‡æ¥çš„ theme å†³å®š èƒŒæ™¯è‰²</span><br><span class="line">  return (</span><br><span class="line">    &lt;button style=&#123;&#123;backgroundColor:props.theme==='dark'?'black':'white'&#125;&#125;&gt;</span><br><span class="line">      test</span><br><span class="line">    &lt;/button&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨ context,å¯ä»¥é¿å…ä¸­é—´ç»„ä»¶ä¼ é€’props</p>
<h2 id="Context-åŸºæœ¬ä½¿ç”¨"><a href="#Context-åŸºæœ¬ä½¿ç”¨" class="headerlink" title="Context åŸºæœ¬ä½¿ç”¨"></a>Context åŸºæœ¬ä½¿ç”¨</h2><h3 id="Provider-amp-Consumer"><a href="#Provider-amp-Consumer" class="headerlink" title="Provider &amp; Consumer"></a>Provider &amp; Consumer</h3><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ä¸ºå½“å‰çš„ theme åˆ›å»ºä¸€ä¸ª contextï¼ˆâ€œlightâ€ä¸ºé»˜è®¤å€¼ï¼‰ã€‚</span></span><br><span class="line"><span class="keyword">const</span> ThemeContext = React.createContext(<span class="string">'light'</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="comment">// ä½¿ç”¨ä¸€ä¸ª Provider æ¥å°†å½“å‰çš„ theme ä¼ é€’ç»™ä»¥ Toolbar å¼€å§‹çš„ç»„ä»¶æ ‘</span></span><br><span class="line">  <span class="comment">// æœ¬ä¾‹ä½¿ç”¨ "dark" å€¼è¦†ç›–é»˜è®¤çš„ "light"å€¼</span></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;ThemeContext.Provider value=<span class="string">"dark"</span>&gt;</span><br><span class="line">        &lt;Toolbar /&gt;</span><br><span class="line">      &lt;<span class="regexp">/ThemeContext.Provider&gt;</span></span><br><span class="line"><span class="regexp">    )</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp">function Toolbar() &#123;</span></span><br><span class="line"><span class="regexp">  /</span><span class="regexp">/ æ— éœ€å†ä¼ é€’ themeå€¼</span></span><br><span class="line"><span class="regexp">  return (</span></span><br><span class="line"><span class="regexp">    &lt;div&gt;</span></span><br><span class="line"><span class="regexp">      &lt;Button /</span>&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp">function Button()&#123;</span></span><br><span class="line"><span class="regexp">  /</span><span class="regexp">/ åœ¨ Context.Consumer ä¸­é€šè¿‡ RenderProps çš„æ–¹å¼ä½¿ç”¨</span></span><br><span class="line"><span class="regexp">  return (</span></span><br><span class="line"><span class="regexp">    &lt;ThemeContext.Consumer&gt;</span></span><br><span class="line"><span class="regexp">      &#123;theme =&gt;(</span></span><br><span class="line"><span class="regexp">        &lt;button style=&#123;&#123;backgroundColor:theme==='dark'?'black':'white'&#125;&#125;&gt;</span></span><br><span class="line"><span class="regexp">          test</span></span><br><span class="line"><span class="regexp">        &lt;/</span>button&gt;</span><br><span class="line">      )&#125;</span><br><span class="line">    &lt;<span class="regexp">/ThemeContext.Consumer&gt;</span></span><br><span class="line"><span class="regexp">  )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>

<p>Button å¾€ä¸Šç»„ä»¶æ ‘å¯»æ‰¾æœ€è¿‘çš„ ThemeContext.Provider æä¾›çš„valueå€¼ï¼Œå¦‚æœæ²¡æœ‰å¯¹åº”çš„ Providerï¼Œä½¿ç”¨ createContext æ—¶çš„é»˜è®¤å€¼</p>
<p>åŒæ—¶ä¹Ÿè¯´æ˜äº†ä¸€ä¸ªé—®é¢˜ï¼Œæ•°æ®æ˜¯å•å‘çš„è‡ªä¸Šè€Œä¸‹ï¼Œè‹¥ <code>ThemeContext.Provider</code> å®šä¹‰åœ¨å­ç»„ä»¶ï¼Œ <code>ThemeContext.Consumer</code> åœ¨çˆ¶ç»„ä»¶ï¼Œå­ç»„ä»¶ä¼ çš„å€¼ä¼ ä¸åˆ°çˆ¶ç»„ä»¶ä¸­ã€‚è¿™é‡Œå°±ä¸ä¸¾ä¾‹äº†</p>
<h3 id="Class-ç»„ä»¶ä½¿ç”¨-Consumer"><a href="#Class-ç»„ä»¶ä½¿ç”¨-Consumer" class="headerlink" title="Class ç»„ä»¶ä½¿ç”¨ Consumer"></a>Class ç»„ä»¶ä½¿ç”¨ Consumer</h3><p>åœ¨ Class ç»„ä»¶ä¸­ä¹Ÿå¯ä»¥ç”¨ Consumer çš„å½¢å¼</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Button</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;ThemeContext.Consumer&gt;</span><br><span class="line">        &#123;theme =&gt; (</span><br><span class="line">          &lt;button style=&#123;&#123; <span class="attr">backgroundColor</span>: theme === <span class="string">'dark'</span> ? <span class="string">'black'</span> : <span class="string">'white'</span> &#125;&#125;&gt;</span><br><span class="line">            test</span><br><span class="line">          &lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">        )&#125;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>ThemeContext.Consumer&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯åœ¨ render é‡Œè¿™ä¹ˆå†™çœ‹ç€æœ‰ç‚¹ä¹±ï¼Œå¦‚æœ themeçš„å€¼èƒ½åƒ props é‚£æ ·ä½¿ç”¨å°±å¥½äº†ï¼Œ</p>
<h3 id="Class-ç»„ä»¶ä½¿ç”¨-contextType"><a href="#Class-ç»„ä»¶ä½¿ç”¨-contextType" class="headerlink" title="Class ç»„ä»¶ä½¿ç”¨ contextType"></a>Class ç»„ä»¶ä½¿ç”¨ contextType</h3><p>è¿™ä½¿ç”¨å°±è¦åˆ©ç”¨ <code>Class.contextType</code> æ¥è·å– <code>this.context</code> å€¼ï¼Œä¸¾ä¸ªä¾‹å­</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Button</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> contextType = ThemeContext;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">let</span> theme = <span class="keyword">this</span>.context;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;button style=&#123;&#123; <span class="attr">backgroundColor</span>: theme === <span class="string">'dark'</span> ? <span class="string">'black'</span> : <span class="string">'white'</span> &#125;&#125;&gt;</span><br><span class="line">        test</span><br><span class="line">      &lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">    )</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>static contextType = ThemeContext;</code> ä¹Ÿå¯ä»¥å†™åœ¨å¤–é¢: <code>Button.contextType = ThemeContext;</code></p>
<p>æŒ‚è½½åœ¨ class ä¸Šçš„ contextType å±æ€§ä¼šè¢«é‡èµ‹å€¼ä¸ºä¸€ä¸ªç”± React.createContext() åˆ›å»ºçš„ Context å¯¹è±¡ã€‚è¿™èƒ½è®©ä½ ä½¿ç”¨ this.context æ¥æ¶ˆè´¹æœ€è¿‘ Context ä¸Šçš„é‚£ä¸ªå€¼ã€‚ä½ å¯ä»¥åœ¨ä»»ä½•ç”Ÿå‘½å‘¨æœŸä¸­è®¿é—®åˆ°å®ƒï¼ŒåŒ…æ‹¬ render å‡½æ•°ä¸­ã€‚</p>
</blockquote>
<p>å‚è€ƒï¼š<a href="https://react.docschina.org/docs/context.html#classcontexttype" target="_blank" rel="noopener">Class.contextType</a></p>
<h3 id="æ¶ˆè´¹å¤šä¸ª-Context"><a href="#æ¶ˆè´¹å¤šä¸ª-Context" class="headerlink" title="æ¶ˆè´¹å¤šä¸ª Context"></a>æ¶ˆè´¹å¤šä¸ª Context</h3><p>å¯ä»¥çœ‹å‡ºæ¥ï¼Œå¦‚æœæ˜¯ä½¿ç”¨ contextType çš„åšæ³•ï¼Œåªèƒ½æ¶ˆè´¹ä¸€ç§ Context ä¸”æœ€è¿‘çš„é‚£ä¸ª ï¼Œå¤š Context è¿˜æ˜¯å¾—é€šè¿‡ Consumer å®ç°</p>
<p>ä¸¾ä¾‹ï¼š</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> ThemeContext = React.createContext(<span class="string">'light'</span>);</span><br><span class="line"><span class="keyword">const</span> UserContext = React.createContext(&#123;</span><br><span class="line">  name: <span class="string">'Guest'</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;ThemeContext.Provider value=<span class="string">"dark"</span>&gt;</span><br><span class="line">        &lt;ThemeContext.Provider value=<span class="string">"blue"</span>&gt;</span><br><span class="line">          &lt;UserContext.Provider value=&#123;&#123; <span class="attr">name</span>: <span class="string">'gahing'</span> &#125;&#125;&gt;</span><br><span class="line">            &lt;Toolbar /&gt;</span><br><span class="line">          &lt;<span class="regexp">/UserContext.Provider&gt;</span></span><br><span class="line"><span class="regexp">        &lt;/</span>ThemeContext.Provider&gt;</span><br><span class="line">      &lt;<span class="regexp">/ThemeContext.Provider&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">function Toolbar() &#123;</span></span><br><span class="line"><span class="regexp">  return (</span></span><br><span class="line"><span class="regexp">    &lt;div&gt;</span></span><br><span class="line"><span class="regexp">      &lt;Button /</span>&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">class Button extends React.Component &#123;</span></span><br><span class="line"><span class="regexp">  static contextType = ThemeContext;</span></span><br><span class="line"><span class="regexp">  render() &#123;</span></span><br><span class="line"><span class="regexp">    let theme = this.context;</span></span><br><span class="line"><span class="regexp">    console.log(theme)</span></span><br><span class="line"><span class="regexp">    return (</span></span><br><span class="line"><span class="regexp">      &lt;button style=&#123;&#123; backgroundColor: theme === 'dark' ? 'black' : 'red' &#125;&#125;&gt;</span></span><br><span class="line"><span class="regexp">        &lt;UserContext.Consumer&gt;</span></span><br><span class="line"><span class="regexp">          &#123;(user) =&gt; (</span></span><br><span class="line"><span class="regexp">            &lt;span&gt;&#123;user.name&#125;&lt;/</span>span&gt;</span><br><span class="line">          )&#125;</span><br><span class="line">        &lt;<span class="regexp">/UserContext.Consumer&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>button&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°,theme æ‹¿åˆ°çš„å€¼ä¸ºæœ€è¿‘çš„ Provider æä¾›çš„ <code>blue</code> ,buttoné‡Œé¢çš„å†…å®¹æ˜¯ <code>gahing</code> ã€‚</p>
<p>åŒæ—¶ï¼Œè¦æƒ³ä½¿ç”¨ UserContext å€¼ï¼Œéœ€è¦ä½¿ç”¨ <code>Context.Consumer</code></p>
<h3 id="åœ¨åµŒå¥—ç»„ä»¶ä¸­æ›´æ–°-Context"><a href="#åœ¨åµŒå¥—ç»„ä»¶ä¸­æ›´æ–°-Context" class="headerlink" title="åœ¨åµŒå¥—ç»„ä»¶ä¸­æ›´æ–° Context"></a>åœ¨åµŒå¥—ç»„ä»¶ä¸­æ›´æ–° Context</h3><p>è¿˜æ˜¯ä»¥æœ€å¼€å§‹çš„ ThemeContext ä¸ºä¾‹ï¼Œæ­¤æ—¶æˆ‘ä»¬éœ€è¦åŠ ä¸ªåŠŸèƒ½ï¼Œç‚¹å‡» button å backgroundColor ä¼šè¿›è¡Œåˆ‡æ¢ï¼Œ</p>
<p>æœ€ç®€å•çš„æƒ³æ³•æ˜¯å°±æ˜¯ Provider åŒ…ç»„ä»¶çš„æ—¶å€™ä¼ ä¸€ä¸ª toggleTheme prop,ç„¶åä¸€å±‚å±‚ä¼ ä¸Šå»ï¼Œæœ€å button ç‚¹å‡»çš„æ—¶å€™æ‰§è¡Œ toggleTheme æ–¹æ³•ï¼Œ</p>
<p>å°±åˆå›åˆ°äº†æœ€å¼€å§‹è¯´ props é€å±‚ä¼ é€’çš„å¼Šç«¯ï¼Œé‚£åº”è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿ</p>
<p>æŠŠ toggleTheme å’Œ theme éƒ½ä½œä¸ºä¸€ä¸ªå¯¹è±¡å±æ€§æ”¾åœ¨ React.createContext ä¸­çš„é»˜è®¤å€¼å‚æ•°</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> ThemeContext = React.createContext(&#123;</span><br><span class="line">  theme: <span class="string">'dark'</span>,</span><br><span class="line">  toggleTheme: <span class="function"><span class="params">()</span> =&gt;</span> &#123;&#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>å…·ä½“ä¾‹å­</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> ThemeContext = React.createContext(&#123;</span><br><span class="line">  theme: <span class="string">'dark'</span>,</span><br><span class="line">  toggleTheme: <span class="function"><span class="params">()</span> =&gt;</span> &#123;&#125;,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">    <span class="keyword">this</span>.toggleTheme = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">this</span>.setState(<span class="function">(<span class="params">state</span>) =&gt;</span> (&#123;</span><br><span class="line">        theme:</span><br><span class="line">          state.theme === <span class="string">'dark'</span></span><br><span class="line">            ? <span class="string">'light'</span></span><br><span class="line">            : <span class="string">'dark'</span>,</span><br><span class="line">      &#125;));</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">this</span>.state = &#123;</span><br><span class="line">      theme: <span class="string">'light'</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;ThemeContext.Provider value=&#123;&#123;</span><br><span class="line">        theme:<span class="keyword">this</span>.state.theme,</span><br><span class="line">        toggleTheme: <span class="keyword">this</span>.toggleTheme,</span><br><span class="line">      &#125;&#125;&gt;</span><br><span class="line">        &lt;Toolbar /&gt;</span><br><span class="line">      &lt;<span class="regexp">/ThemeContext.Provider&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">function Toolbar() &#123;</span></span><br><span class="line"><span class="regexp">  return (</span></span><br><span class="line"><span class="regexp">    &lt;div&gt;</span></span><br><span class="line"><span class="regexp">      &lt;Button /</span>&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">class Button extends React.Component &#123;</span></span><br><span class="line"><span class="regexp">  static contextType = ThemeContext;</span></span><br><span class="line"><span class="regexp">  render() &#123;</span></span><br><span class="line"><span class="regexp">    let &#123;theme, toggleTheme&#125; = this.context;</span></span><br><span class="line"><span class="regexp">    return (</span></span><br><span class="line"><span class="regexp">      &lt;button style=&#123;&#123; backgroundColor: theme === 'dark' ? 'black' : 'white' &#125;&#125; onClick=&#123;toggleTheme&#125;&gt;</span></span><br><span class="line"><span class="regexp">        test</span></span><br><span class="line"><span class="regexp">      &lt;/</span>button&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ•ˆæœå³é»˜è®¤ç™½è‰²æŒ‰é’®ï¼Œç‚¹å‡»ååˆ‡æ¢æˆé»‘è‰²ï¼Œå†ç‚¹åˆå˜æˆç™½è‰²â€¦</p>
<h2 id="Context-æ³¨æ„äº‹é¡¹"><a href="#Context-æ³¨æ„äº‹é¡¹" class="headerlink" title="Context æ³¨æ„äº‹é¡¹"></a>Context æ³¨æ„äº‹é¡¹</h2><blockquote>
<p>å†™ä¾‹å­çš„æ—¶å€™ç”¨çš„æ˜¯ tsx,ä¸äº†è§£ typescript çš„å¯ä»¥ç›´æ¥æŠŠ any ä¹‹ç±»çš„åˆ å»</p>
</blockquote>
<h3 id="1-å½“ä¼ é€’å¯¹è±¡ç»™-value-æ—¶ï¼Œæ£€æµ‹å˜åŒ–çš„æ–¹å¼ä¼šå¯¼è‡´ä¸€äº›é—®é¢˜"><a href="#1-å½“ä¼ é€’å¯¹è±¡ç»™-value-æ—¶ï¼Œæ£€æµ‹å˜åŒ–çš„æ–¹å¼ä¼šå¯¼è‡´ä¸€äº›é—®é¢˜" class="headerlink" title="1.å½“ä¼ é€’å¯¹è±¡ç»™ value æ—¶ï¼Œæ£€æµ‹å˜åŒ–çš„æ–¹å¼ä¼šå¯¼è‡´ä¸€äº›é—®é¢˜"></a>1.å½“ä¼ é€’å¯¹è±¡ç»™ value æ—¶ï¼Œæ£€æµ‹å˜åŒ–çš„æ–¹å¼ä¼šå¯¼è‡´ä¸€äº›é—®é¢˜</h3><p>ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œ ThemeContext valueçš„å€¼æ˜¯è¿™æ ·çš„</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;ThemeContext.Provider value=&#123;&#123;</span><br><span class="line">  theme:<span class="keyword">this</span>.state.theme,</span><br><span class="line">  toggleTheme: <span class="keyword">this</span>.toggleTheme,</span><br><span class="line">&#125;&#125;&gt;</span><br></pre></td></tr></table></figure>
<p>å½“ provider çš„çˆ¶ç»„ä»¶ï¼ˆAppï¼‰è¿›è¡Œé‡æ¸²æŸ“ï¼ˆæ‰§è¡Œrenderæ–¹æ³•ï¼‰æ—¶ï¼Œç”±äº provider çš„<code>value</code>å±æ€§æ€»æ˜¯ä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œå¯¼è‡´ consumers ç»„ä»¶ä¼šè§¦å‘æ„å¤–çš„æ¸²æŸ“</p>
<p>æŠŠä¸Šé¢çš„ä¾‹å­ç¨å¾®æ”¹é€ ä¸‹å°±çŸ¥é“äº†</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> ThemeContext = React.createContext(&#123;</span><br><span class="line">  theme: <span class="string">'dark'</span>,</span><br><span class="line">  toggleTheme: <span class="function"><span class="params">()</span> =&gt;</span> &#123;&#125;,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span>&lt;<span class="title">any</span>,<span class="title">any</span>&gt; </span>&#123;</span><br><span class="line">  private toggleTheme:any;</span><br><span class="line">  <span class="keyword">constructor</span>(props: any) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">    <span class="keyword">this</span>.toggleTheme = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">this</span>.setState(<span class="function">(<span class="params">state: any</span>) =&gt;</span> (&#123;</span><br><span class="line">        themeContext: &#123;</span><br><span class="line">          theme: state.themeContext.theme === <span class="string">'dark'</span></span><br><span class="line">            ? <span class="string">'light'</span></span><br><span class="line">            : <span class="string">'dark'</span>,</span><br><span class="line">          toggleTheme: state.themeContext.toggleTheme</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;));</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">this</span>.state = &#123;</span><br><span class="line">      themeContext: &#123;</span><br><span class="line">        theme: <span class="string">'light'</span>,</span><br><span class="line">        toggleTheme: <span class="keyword">this</span>.toggleTheme,</span><br><span class="line">      &#125;,</span><br><span class="line">      count: <span class="number">1</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  componentDidMount()&#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">        count:<span class="number">2</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;, <span class="number">5000</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'render App'</span>)</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;ThemeContext.Provider value=&#123;&#123;</span><br><span class="line">        theme: <span class="keyword">this</span>.state.themeContext.theme,</span><br><span class="line">        toggleTheme: <span class="keyword">this</span>.toggleTheme,</span><br><span class="line">      &#125;&#125;&gt;</span><br><span class="line">        &lt;Toolbar /&gt;</span><br><span class="line">        &lt;span&gt;&#123;<span class="keyword">this</span>.state.count&#125;&lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>ThemeContext.Provider&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ä½¿ç”¨memo,å½“propsæ²¡æœ‰å˜åŠ¨æ—¶ä¸è§¦å‘render</span></span><br><span class="line"><span class="keyword">const</span> Toolbar = React.memo(<span class="function"><span class="params">()</span>=&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'render Toolbar'</span>)</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;Button /&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;)</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ ä½¿ç”¨ PureComponent,æœ¬æ¥åº”è¯¥æ˜¯ propsæ²¡æœ‰å˜åŠ¨æ—¶ä¸è§¦å‘renderï¼Œä½†æœ¬ä¾‹ä¸­è¿˜æ˜¯è§¦å‘äº†render</span></span><br><span class="line"><span class="regexp">class Button extends React.PureComponent &#123;</span></span><br><span class="line"><span class="regexp">  static contextType = ThemeContext;</span></span><br><span class="line"><span class="regexp">  render() &#123;</span></span><br><span class="line"><span class="regexp">    let &#123;theme, toggleTheme&#125; = this.context;</span></span><br><span class="line"><span class="regexp">    console.log('render Button')</span></span><br><span class="line"><span class="regexp">    return (</span></span><br><span class="line"><span class="regexp">      &lt;button style=&#123;&#123; backgroundColor: theme === 'dark' ? 'black' : 'white' &#125;&#125; onClick=&#123;toggleTheme&#125;&gt;</span></span><br><span class="line"><span class="regexp">        test</span></span><br><span class="line"><span class="regexp">      &lt;/</span>button&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºç»“æœä¸º</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">render App</span><br><span class="line">render Toolbar</span><br><span class="line">render Button</span><br><span class="line"><span class="comment"># è‡ªåŠ¨è¿‡5såè¾“å‡º</span></span><br><span class="line">render App</span><br><span class="line">render Button</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥å‘ç°ï¼ŒAppç»„ä»¶é‡æ¸²æŸ“çš„æ—¶å€™ï¼ŒButton è¿™ä¸ª consumers ç»„ä»¶ä¹Ÿå‘ç”Ÿäº†é‡æ¸²æŸ“</p>
<p>Button æ¢æˆ Consumer çš„å®ç°</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Button</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">PureComponent</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'render Button'</span>)</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;ThemeContext.Consumer&gt;</span><br><span class="line">        &#123;(&#123; theme, toggleTheme &#125;) =&gt; &#123;</span><br><span class="line">          <span class="built_in">console</span>.log(<span class="string">'render Consumer'</span>)</span><br><span class="line">          <span class="keyword">return</span> (</span><br><span class="line">            &lt;button style=&#123;&#123; <span class="attr">backgroundColor</span>: theme === <span class="string">'dark'</span> ? <span class="string">'black'</span> : <span class="string">'white'</span> &#125;&#125; onClick=&#123;toggleTheme&#125;&gt;</span><br><span class="line">              test</span><br><span class="line">            &lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">          )</span></span><br><span class="line"><span class="regexp">        &#125;&#125;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>ThemeContext.Consumer&gt;</span><br><span class="line"></span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºç»“æœä¸º</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">render App</span><br><span class="line">render Toolbar</span><br><span class="line">render Button</span><br><span class="line">render Consumer</span><br><span class="line"><span class="comment"># è‡ªåŠ¨è¿‡5såè¾“å‡º</span></span><br><span class="line">render App</span><br><span class="line">render Consumer</span><br></pre></td></tr></table></figure>
<p>æ­¤æ—¶æ²¡æœ‰è¾“å‡º <code>render Button</code> æ˜¯å› ä¸º Button å¹¶ä¸æ˜¯ Consumer ç»„ä»¶ï¼Œåªæœ‰åº•ä¸‹çš„å­ç»„ä»¶(ConsumeråŒ…ä½çš„éƒ¨åˆ†) æ‰æ˜¯ï¼Œæ‰ä¼šè¿›è¡Œé‡æ¸²æŸ“</p>
<p>æ”¹é€  <code>value</code>,ä½¿å¾— consumers ç»„ä»¶ä¸ä¼šé‡æ¸²æŸ“</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="comment">// App render ä¿®æ”¹ä¸º</span></span><br><span class="line">&lt;ThemeContext.Provider value=&#123;<span class="keyword">this</span>.state.themeContext&#125;&gt;</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºç»“æœä¸º</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">render App</span><br><span class="line">render Toolbar</span><br><span class="line">render Button</span><br><span class="line">render Consumer</span><br><span class="line"><span class="comment"># è‡ªåŠ¨è¿‡5såè¾“å‡º</span></span><br><span class="line">render App</span><br><span class="line"><span class="comment"># ç‚¹å‡»æŒ‰é’®åè¾“å‡º</span></span><br><span class="line">render App</span><br><span class="line">render Consumer</span><br></pre></td></tr></table></figure>
<p>è¿™å°±è¯´æ˜ï¼ŒAppç»„ä»¶è¿›è¡Œé‡æ¸²æŸ“ï¼Œåªè¦ provider æä¾›çš„ value å€¼ä¸å˜ï¼Œå…¶ä¸‹çš„ consumers ç»„ä»¶å°±ä¸ä¼šæ„å¤–çš„é‡æ¸²æŸ“</p>
<p><strong>é™¤äº†å°† value çŠ¶æ€æå‡åˆ°çˆ¶èŠ‚ç‚¹çš„ state é‡Œï¼Œä¹Ÿå¯ä»¥åˆ©ç”¨ <code>memoization</code> æ¥å®ç°</strong></p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> memoize <span class="keyword">from</span> <span class="string">"memoize-one"</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span>&lt;<span class="title">any</span>, <span class="title">any</span>&gt; </span>&#123;</span><br><span class="line">  private toggleTheme: any;</span><br><span class="line">  <span class="keyword">constructor</span>(props: any) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">    <span class="keyword">this</span>.toggleTheme = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">this</span>.setState(<span class="function">(<span class="params">state: any</span>) =&gt;</span> (&#123;</span><br><span class="line">        themeContext: &#123;</span><br><span class="line">          theme: state.themeContext.theme === <span class="string">'dark'</span></span><br><span class="line">            ? <span class="string">'light'</span></span><br><span class="line">            : <span class="string">'dark'</span>,</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;));</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">this</span>.state = &#123;</span><br><span class="line">      themeContext: &#123;</span><br><span class="line">        theme: <span class="string">'light'</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      count: <span class="number">1</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  componentDidMount() &#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">        count: <span class="number">2</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;, <span class="number">5000</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  cacheThemeContext = memoize(<span class="function">(<span class="params">theme</span>)=&gt;</span>(&#123;</span><br><span class="line">    theme,</span><br><span class="line">    toggleTheme: <span class="keyword">this</span>.toggleTheme</span><br><span class="line">  &#125;))</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'render App'</span>)</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;ThemeContext.Provider value=&#123;<span class="keyword">this</span>.cacheThemeContext(<span class="keyword">this</span>.state.themeContext.theme)&#125;&gt;</span><br><span class="line">        &lt;Toolbar /&gt;</span><br><span class="line">      &lt;<span class="regexp">/ThemeContext.Provider&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-ä»€ä¹ˆæƒ…å†µä¸‹ä¸è¯¥ç”¨-Context"><a href="#2-ä»€ä¹ˆæƒ…å†µä¸‹ä¸è¯¥ç”¨-Context" class="headerlink" title="2.ä»€ä¹ˆæƒ…å†µä¸‹ä¸è¯¥ç”¨ Context"></a>2.ä»€ä¹ˆæƒ…å†µä¸‹ä¸è¯¥ç”¨ Context</h3><blockquote>
<p>Context ä¸»è¦åº”ç”¨åœºæ™¯åœ¨äº<strong>å¾ˆå¤š</strong>ä¸åŒå±‚çº§çš„ç»„ä»¶éœ€è¦è®¿é—®åŒæ ·ä¸€äº›çš„æ•°æ®</p>
</blockquote>
<blockquote>
<p>å¦‚æœä½ åªæ˜¯æƒ³é¿å…å±‚å±‚ä¼ é€’ä¸€äº›å±æ€§ï¼Œ<a href="https://react.docschina.org/docs/composition-vs-inheritance.html" target="_blank" rel="noopener">ç»„ä»¶ç»„åˆï¼ˆcomponent compositionï¼‰</a>æœ‰æ—¶å€™æ˜¯ä¸€ä¸ªæ¯” context æ›´å¥½çš„è§£å†³æ–¹æ¡ˆ</p>
</blockquote>
<p>å‚è€ƒ: <a href="https://react.docschina.org/docs/context.html#before-you-use-context" target="_blank" rel="noopener">ä½¿ç”¨ Context ä¹‹å‰çš„è€ƒè™‘</a></p>
<p>å¤§è‡´æ„æ€å°±æ˜¯æŠŠæœ€åº•ä¸‹éœ€è¦ç”¨åˆ° props çš„ç»„ä»¶æåˆ°æœ€ä¸Šå±‚æ¥ï¼Œå°†ç»„ä»¶åŒ…æˆä¸€ä¸ªpropå¾€ä¸‹ä¼ é€’ï¼Œ</p>
<p>è¿™é‡Œæœ‰ä¸ªç–‘é—®ï¼Œé‚£ä¸è¿˜æ˜¯å¾—æ¯ä¸ªç»„ä»¶å†™ä¸€æ¬¡ prop è€Œä¸”è¿™äº›é«˜å±‚ç»„ä»¶å˜å¾—æ›´å¤æ‚äº†ã€‚ã€‚</p>
<p>å½“ç„¶æœ‰çš„è¯´æ³•æ˜¯å‡å°‘äº†ä¼ é€’çš„propsæ•°é‡ï¼Œå¯¹é«˜å±‚ç»„ä»¶æ›´å®¹æ˜“æŠŠæ§ç­‰ç­‰ã€‚ã€‚</p>
<p>æ‰€ä»¥ï¼Œä½¿ç”¨ <code>ç»„ä»¶ç»„åˆ</code> è¿˜æ˜¯ <code>Context</code> ä¸ªäººè§‰å¾—æ²¡æœ‰è¯¦ç»†çš„ç•Œé™</p>
<h2 id="æ¢è‚¤"><a href="#æ¢è‚¤" class="headerlink" title="æ¢è‚¤"></a>æ¢è‚¤</h2><p>éœ€æ±‚å¾ˆç®€å•ï¼Œæ¢ä¸ªä¸»é¢˜è‰²ã€‚</p>
<p><a href="https://github.com/whinc/blog/issues/4" target="_blank" rel="noopener">Reactç»„ä»¶åº“ä¸»é¢˜è®¾è®¡</a> çš„åšæ³•ï¼Œä¸»é¢˜è‰²å®šä¹‰åœ¨jsä¸­ï¼Œå’Œä¸Šæ–‡ä¸€æ ·ï¼Œé€šè¿‡ Context å»è®¾ç½®æˆ–åˆ‡æ¢ä¸»é¢˜è‰²</p>
<p>åŒæ ·çš„ï¼Œä¸»é¢˜è‰²å®šä¹‰åœ¨ css ä¸­ï¼Œcontext å€¼ä¿å­˜ classNameï¼Œåˆ‡æ¢ className å®ç°ä¸»é¢˜åˆ‡æ¢</p>
<p>ï¼ˆç¤ºä¾‹å°±ä¸æä¾›äº†ï¼Œå¯ä»¥çœ‹ä¸Šé¢çš„å‚è€ƒæ–‡çŒ®ï¼‰</p>
]]></content>
      <categories>
        <category>å¤§å‰ç«¯</category>
      </categories>
      <tags>
        <tag>React</tag>
        <tag>æ¢è‚¤</tag>
      </tags>
  </entry>
  <entry>
    <title>npm å‘åŒ…è¿‡ç¨‹</title>
    <url>/2019/07/01/npm/npm%E5%8F%91%E5%8C%85%E5%91%BD%E4%BB%A4/</url>
    <content><![CDATA[<h2 id="å‘å¸ƒå‰å‡†å¤‡"><a href="#å‘å¸ƒå‰å‡†å¤‡" class="headerlink" title="å‘å¸ƒå‰å‡†å¤‡"></a>å‘å¸ƒå‰å‡†å¤‡</h2><h3 id="npm-pack-æŸ¥çœ‹å“ªäº›æ–‡ä»¶ä¼šè¢«å‘é€"><a href="#npm-pack-æŸ¥çœ‹å“ªäº›æ–‡ä»¶ä¼šè¢«å‘é€" class="headerlink" title="npm pack æŸ¥çœ‹å“ªäº›æ–‡ä»¶ä¼šè¢«å‘é€"></a>npm pack æŸ¥çœ‹å“ªäº›æ–‡ä»¶ä¼šè¢«å‘é€</h3><p>æ‰§è¡Œè¯¥å‘½ä»¤åä¼šç”Ÿæˆä¸€ä¸ª xxx.tgz æ–‡ä»¶</p>
<p>è¿™äº›è¦è¢«æ‰“åŒ…å‘å¸ƒçš„æ–‡ä»¶æ˜¯é€šè¿‡ä»¥ä¸‹å‘½ä»¤ç­›é€‰åˆ°çš„</p>
<ol>
<li>package.json çš„ files é…ç½®ï¼ˆç™½åå•æ¨¡å¼ï¼‰</li>
<li>.npmignore</li>
<li>.gitignore</li>
</ol>
<a id="more"></a>

<p>åªè¦å…¶ä¸­ä¸€ä¸ªç”Ÿæ•ˆï¼Œå°±ä¼šå¿½ç•¥ä½™ä¸‹çš„é…ç½®ï¼Œå‚è€ƒè‡ª<a href="https://zellwk.com/blog/ignoring-files-from-npm-package/" target="_blank" rel="noopener">How to ignore files from your npm package</a></p>
<p>æ‰€ä»¥ï¼Œfiles é…ç½®<code>[&quot;lib&quot;]</code> è€Œ .npmignore é…ç½® <code>*.snap</code> å¹¶ä¸ä¼šè¿‡æ»¤æ‰ lib ç›®å½•ä¸‹çš„ snap æ–‡ä»¶</p>
<p>å› ä¸º ç¬¬ä¸€é¡¹é…ç½®ç”Ÿæ•ˆäº† ä¹Ÿå°±å¿½ç•¥ç¬¬äºŒé¡¹é…ç½®äº†</p>
<p>é‚£éœ€è¦æ€ä¹ˆåšå‘¢ï¼Ÿ files é…ç½®<code>[&quot;lib&quot;]</code> æ”¹ä¸º <code>[&quot;lib&quot;,&quot;!*.snap&quot;]</code> å³å¯</p>
<h3 id="link"><a href="#link" class="headerlink" title="link"></a>link</h3><p>npm link å‘åŒ…å‰ï¼Œå…ˆç”¨æœ¬åœ°é¡¹ç›®è¿æ¥è°ƒè¯•ä¸‹</p>
<p>npm link xxx ç”¨æµ‹è¯•é¡¹ç›®é“¾æ¥å¾…å‘å¸ƒ npm åŒ…</p>
<h2 id="å‘å¸ƒ"><a href="#å‘å¸ƒ" class="headerlink" title="å‘å¸ƒ"></a>å‘å¸ƒ</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm publish åŒ…å</span><br></pre></td></tr></table></figure>
<h2 id="æ’¤é”€å·²å‘å¸ƒçš„åŒ…"><a href="#æ’¤é”€å·²å‘å¸ƒçš„åŒ…" class="headerlink" title="æ’¤é”€å·²å‘å¸ƒçš„åŒ…"></a>æ’¤é”€å·²å‘å¸ƒçš„åŒ…</h2><p>æŸä¸ªç‰ˆæœ¬çš„åŒ…å‘å¸ƒä¹‹åï¼Œä¸èƒ½å†æ¬¡å‘å¸ƒç›¸å…³ç‰ˆæœ¬çš„åŒ…ã€‚</p>
<p>å¦‚æœå‘ç°æœ‰é—®é¢˜ï¼Œåªèƒ½å‡çº§åŒ…</p>
<p>ä¸è¿‡å¯ä»¥è¿›è¡Œæ’¤å›å·²å‘å¸ƒçš„åŒ…ï¼ˆä¸æå€¡ï¼‰</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm unpublish åŒ…å</span><br></pre></td></tr></table></figure>
<p>å¹¶ä¸”æœ‰è¦æ±‚ï¼š</p>
<ol>
<li>24å°æ—¶å†…ä¸Šä¼ çš„</li>
<li>å³ä½¿æ’¤å›äº†ï¼Œä¹Ÿä¸èƒ½å†å‘è¿™ä¸ªç‰ˆæœ¬çš„åŒ…</li>
</ol>
]]></content>
      <categories>
        <category>éšç¬”</category>
      </categories>
      <tags>
        <tag>npm</tag>
      </tags>
  </entry>
  <entry>
    <title>TypeScriptå­¦ä¹ ç¬”è®°</title>
    <url>/2019/05/01/2019Q2/TypeScript%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><a id="more"></a>

<h2 id="Partial"><a href="#Partial" class="headerlink" title="Partial"></a>Partial</h2><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> Partial&lt;T&gt; = &#123;</span><br><span class="line">    [P <span class="keyword">in</span> keyof T]?: T[P];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>ä½¿å¾—Tçš„æ‰€æœ‰å±æ€§å¯é€‰</p>
<h2 id="Omit"><a href="#Omit" class="headerlink" title="Omit"></a>Omit</h2><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> Omit&lt;T, K <span class="keyword">extends</span> keyof <span class="built_in">any</span>&gt; = Pick&lt;T, Exclude&lt;keyof T, K&gt;&gt;;</span><br></pre></td></tr></table></figure>
<p>æ„é€ ä¸€ä¸ªå¸¦æœ‰Tæ‰€æœ‰å±æ€§å¹¶å»é™¤Kå±æ€§çš„ç±»å‹</p>
<p>å¸¸è§ç”¨æ³•1ï¼šç»§æ‰¿å¹¶è¦†ç›–æ¥å£ç±»å‹</p>
<blockquote>
<p>tsç»§æ‰¿çš„è¯ä¸èƒ½ä¿®æ”¹çˆ¶ç±»æŸä¸ªå±æ€§çš„ç±»å‹ï¼Œå¯ä»¥é‡‡å– </p>
</blockquote>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">interface</span> base &#123;</span><br><span class="line">  a:<span class="built_in">number</span>,</span><br><span class="line">  b:<span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">interface</span> child <span class="keyword">extends</span> Omit&lt;base,'a'&gt; &#123;</span><br><span class="line">  a:<span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// right</span></span><br><span class="line"><span class="keyword">const</span> t:child = &#123;</span><br><span class="line">  a:<span class="string">""</span>,</span><br><span class="line">  b:<span class="string">""</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¸¸è§ç”¨æ³•2ï¼šç»„åˆä¸¤ä¸ªæ¥å£ï¼ŒåŒåå±æ€§ä»¥åè€…ä¸ºå‡†</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">interface</span> t1 &#123;</span><br><span class="line">  a:<span class="built_in">number</span>,</span><br><span class="line">  b:<span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">interface</span> t2 &#123;</span><br><span class="line">  a:<span class="built_in">string</span>,</span><br><span class="line">  c:<span class="built_in">boolean</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> t3 = Omit&lt;t1, keyof t2&gt; &amp; t2;</span><br><span class="line"><span class="comment">// right</span></span><br><span class="line"><span class="keyword">const</span> t:t3 = &#123;</span><br><span class="line">  a:<span class="string">""</span>,</span><br><span class="line">  b:<span class="string">""</span>,</span><br><span class="line">  c:<span class="literal">true</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç”¨æ³•1ï¼Œ2ç»å¸¸ç»„åˆèµ·æ¥ä½¿ç”¨</p>
<h2 id="T-T-gt-T"><a href="#T-T-gt-T" class="headerlink" title="T | T[] =&gt; T[]"></a>T | T[] =&gt; T[]</h2><p>æœ‰ä¸ªå¯¹è±¡ï¼Œå…¶ç±»å‹ä¸º Option æˆ– Option æ•°ç»„</p>
<p>ç°åœ¨éœ€è¦å°†å…¶å¼ºåˆ¶è½¬ä¸º Option æ•°ç»„ç±»å‹ï¼Œå³å¦‚æœä»–æ˜¯ Option åˆ™æ”¾å…¥æ•°ç»„ä¸­</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">interface Option &#123;</span><br><span class="line">  [key: string]: React.ReactNode;</span><br><span class="line">&#125;</span><br><span class="line">type A = Option | Option[]</span><br><span class="line"><span class="keyword">const</span> a:A = &#123;<span class="attr">name</span>:<span class="string">"111"</span>&#125;</span><br><span class="line"><span class="comment">// å®ç° toArray å‡½æ•°ï¼Œä½¿å¾— b çš„ç±»å‹ä¸º Option[]</span></span><br><span class="line"><span class="keyword">const</span> b = toArray(a)</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">export function toArray&lt;T&gt;(value: T | T[] | undefined): T[] &#123;</span><br><span class="line">  <span class="keyword">let</span> ret = value;</span><br><span class="line">  <span class="keyword">if</span> (value === <span class="literal">undefined</span>) &#123;</span><br><span class="line">    ret = [];</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!<span class="built_in">Array</span>.isArray(value)) &#123;</span><br><span class="line">    ret = [value <span class="keyword">as</span> T];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> ret <span class="keyword">as</span> T[];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æœ¬ä¾‹è¿˜éœ€è¦å¸¦ä¸Šç±»å‹ï¼Œå…¶ä»–çš„ç®€å•æ¥å£å°±ä¸ç”¨äº†</span></span><br><span class="line">toArray&lt;Option&gt;(a)</span><br></pre></td></tr></table></figure>

<h2 id="æ•°ç»„è¿‡æ»¤-null"><a href="#æ•°ç»„è¿‡æ»¤-null" class="headerlink" title="æ•°ç»„è¿‡æ»¤ null"></a>æ•°ç»„è¿‡æ»¤ null</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> list = [<span class="string">"a"</span>,<span class="literal">null</span>,<span class="string">"b"</span>]</span><br><span class="line"><span class="keyword">const</span> list2 = list.filter(<span class="function"><span class="params">v</span>=&gt;</span>v)</span><br></pre></td></tr></table></figure>

<p>ç„¶å list2 çš„æ¨å¯¼ç±»å‹è¿˜æ˜¯ <code>string | null []</code></p>
<p>éœ€è¦å¯¹ filter æ–¹æ³•è¿›è¡Œå£°æ˜</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ç®­å¤´å‡½æ•° TODO</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">notEmpty</span>&lt;<span class="title">TValue</span>&gt;(<span class="params">value: TValue | null | undefined</span>): <span class="title">value</span> <span class="title">is</span> <span class="title">TValue</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> value !== <span class="literal">null</span> &amp;&amp; value !== <span class="literal">undefined</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> list2 = list.filter(notEmpty) <span class="comment">// string[]</span></span><br></pre></td></tr></table></figure>


]]></content>
      <categories>
        <category>å¤§å‰ç«¯</category>
      </categories>
      <tags>
        <tag>TypeScript</tag>
      </tags>
  </entry>
  <entry>
    <title>npm version å‘½ä»¤</title>
    <url>/2019/05/01/npm/npm%20version%20%E5%91%BD%E4%BB%A4/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å¯¹äº NodeJS é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦å˜æ›´ package.json ä¸­çš„ç‰ˆæœ¬ä¿¡æ¯ã€‚</p>
<p>æ­£å¸¸æ“ä½œæ˜¯ï¼Œæ‰‹åŠ¨ä¿®æ”¹ package.json æ–‡ä»¶çš„ç‰ˆæœ¬ä¿¡æ¯ï¼Œç„¶åå†commitã€‚</p>
<p>æ¯æ¬¡è¿™æ ·åšï¼Œæ“ä½œå¤ªç¹çã€‚</p>
<p>å®é™…ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>npm version &lt;newversion&gt;</code> å‘½ä»¤</p>
<a id="more"></a>

<h2 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm version [&lt;newversion&gt; | major | minor | patch | premajor | preminor | prepatch | prerelease | from-git]</span><br></pre></td></tr></table></figure>
<ul>
<li>majorï¼šä¸»ç‰ˆæœ¬å·</li>
<li>minorï¼šæ¬¡ç‰ˆæœ¬å·</li>
<li>patchï¼šè¡¥ä¸å·</li>
<li>premajorï¼šé¢„å¤‡ä¸»ç‰ˆæœ¬</li>
<li>prepatchï¼šé¢„å¤‡æ¬¡ç‰ˆæœ¬</li>
<li>prereleaseï¼šé¢„å‘å¸ƒç‰ˆæœ¬</li>
</ul>
<p>æ¯”å¦‚å½“å‰ç‰ˆæœ¬ä¸º 0.1.1ï¼Œä½¿ç”¨<code>npm version patch</code>åï¼Œä¼šæ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š</p>
<ol>
<li>ä¿®æ”¹ package.json çš„ version ä¸º0.1.2</li>
<li>git commit -m â€œ0.1.2â€</li>
<li>npm tag -a v0.1.2</li>
</ol>
<p>ä¹Ÿå¯ä»¥æŒ‡å®š commitçš„ä¿¡æ¯</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm version patch -m <span class="string">"Upgrade to v%s"</span>  <span class="comment"># %s ä¼šè‡ªåŠ¨æ›¿æ¢æˆç‰ˆæœ¬å·</span></span><br><span class="line"><span class="comment"># æ­¤æ—¶æäº¤ä¿¡æ¯ä¸ºï¼š Upgrade to v0.1.2</span></span><br></pre></td></tr></table></figure>

<p>æ³¨ï¼šä½¿ç”¨ <code>npm version &lt;newversion&gt;</code> å‘½ä»¤ï¼Œéœ€è¦å½“å‰å·¥ä½œåŒºä¸ºcleançŠ¶æ€ï¼Œå¦åˆ™ä¼šæ‰§è¡Œå¤±è´¥ã€‚</p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://www.jianshu.com/p/9e64bdf1e8f9" target="_blank" rel="noopener">https://www.jianshu.com/p/9e64bdf1e8f9</a></p>
]]></content>
      <categories>
        <category>éšç¬”</category>
      </categories>
      <tags>
        <tag>npm</tag>
      </tags>
  </entry>
  <entry>
    <title>Antd Table è‡ªé€‚åº”å’Œçœç•¥å·</title>
    <url>/2019/04/20/2019Q2/Antd%20Table%20%E8%87%AA%E9%80%82%E5%BA%94%E5%92%8C%E7%9C%81%E7%95%A5%E5%8F%B7/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ä¹‹å‰å†™äº†ä¸€ç¯‡æ–‡ç« <a href="https://www.hongweipeng.com/index.php/archives/1724/" target="_blank" rel="noopener">Antd Tableç»„ä»¶ é…ç½®è§„èŒƒ</a></p>
<p>å…¶ä¸»è¦åˆ©ç”¨xæ»šåŠ¨æ¡ï¼Œè®©æ•°æ®å®Œå…¨å±•ç°ã€‚</p>
<p>ä½†æ˜¯æœ‰çš„éœ€æ±‚æ˜¯æ•°æ®ä¸€å±å±•ç¤ºä¸æ»šåŠ¨ï¼Œå½“å±å¹•è¶³å¤Ÿå°æ—¶ï¼Œå•å…ƒæ ¼å†…å®¹ç”¨çœç•¥å·ä»£æ›¿ï¼Œç„¶åç”¨Tooltipå±•ç¤ºå†…å®¹</p>
<a id="more"></a>


<p>å‚è€ƒï¼š</p>
<p><a href="https://github.com/ant-design/ant-design/issues/5753#issuecomment-451896473" target="_blank" rel="noopener">https://github.com/ant-design/ant-design/issues/5753#issuecomment-451896473</a></p>
<p><a href="https://github.com/ant-design/ant-design/issues/5753#issuecomment-457319869" target="_blank" rel="noopener">https://github.com/ant-design/ant-design/issues/5753#issuecomment-457319869</a></p>
<h2 id="å®ç°æ–¹æ¡ˆ"><a href="#å®ç°æ–¹æ¡ˆ" class="headerlink" title="å®ç°æ–¹æ¡ˆ"></a>å®ç°æ–¹æ¡ˆ</h2><p>å…ˆåˆ›å»ºä¸€ä¸ªå·¥å…·ç»„ä»¶ EllipsisTooltip</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> &#123; Tooltip &#125; <span class="keyword">from</span> <span class="string">'antd'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">EllipsisTooltip</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    visible: <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">  handleVisibleChange = <span class="function">(<span class="params">visible</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.container.clientWidth &lt; <span class="keyword">this</span>.container.scrollWidth) &#123;</span><br><span class="line">      <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">        visible: visible</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  render () &#123;</span><br><span class="line">    <span class="keyword">const</span> style = &#123;</span><br><span class="line">      textOverflow: <span class="string">'ellipsis'</span>,</span><br><span class="line">      overflow: <span class="string">'hidden'</span>,</span><br><span class="line">      ...this.props.style</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;Tooltip visible=&#123;<span class="keyword">this</span>.state.visible&#125; onVisibleChange=&#123;<span class="keyword">this</span>.handleVisibleChange&#125; title=&#123;<span class="keyword">this</span>.props.title&#125;&gt;</span><br><span class="line">        &lt;div ref=&#123;node =&gt; <span class="keyword">this</span>.container = node&#125; style=&#123;style&#125;&gt;&#123;<span class="keyword">this</span>.props.children&#125;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>Tooltip&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> EllipsisTooltip</span><br></pre></td></tr></table></figure>
<p>å½“å†…å®¹ä¸èƒ½å®Œå…¨å±•ç¤ºæ—¶ï¼Œç”¨çœç•¥å·ä»£æ›¿ï¼Œé¼ æ ‡ç§»è¿‡å»åˆ©ç”¨tooltipæ˜¾ç¤ºå®Œæ•´å†…å®¹</p>
<p>ç„¶ååœ¨columnsè¿™æ ·ä½¿ç”¨</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">title: <span class="string">'xxx'</span>,</span><br><span class="line">dataIndex: <span class="string">'name'</span>,</span><br><span class="line"><span class="comment">// å½“è¡¨æ ¼ä¸èƒ½å®Œå…¨å±•ç¤ºæ—¶ï¼Œè¯¥åˆ—å¤§å°è‡³å°‘æ˜¯100px</span></span><br><span class="line">onCell: <span class="function"><span class="params">()</span> =&gt;</span> (&#123;</span><br><span class="line">  style: &#123;</span><br><span class="line">    whiteSpace: <span class="string">'nowrap'</span>,</span><br><span class="line">    maxWidth: <span class="number">100</span>,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;),</span><br><span class="line">render: <span class="function">(<span class="params">text</span>)=&gt;</span> (<span class="xml"><span class="tag">&lt;<span class="name">EllipsisTooltip</span> <span class="attr">title</span>=<span class="string">&#123;text&#125;</span>&gt;</span>&#123;text&#125;<span class="tag">&lt;/<span class="name">EllipsisTooltip</span>&gt;</span></span>)</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°æ•°æ®èƒ½å¤Ÿè‡ªé€‚åº”å¹¶ä¸”å½“é¡µé¢è¶³å¤Ÿå°æ—¶æ˜¾ç¤ºçœç•¥å·ï¼Œä½†æ˜¯è¡¨å¤´å´æ˜¯æŠ˜è¡Œçš„å®ç°ï¼Œèƒ½å¦ä¹Ÿå®ç°çœç•¥å·å‘¢ï¼Ÿ</p>
<p><strong>è¡¨å¤´å®ç°çœç•¥å·</strong></p>
<p>æœªå®Œå¾…ç»­ã€‚ã€‚</p>
]]></content>
      <categories>
        <category>å¤§å‰ç«¯</category>
      </categories>
      <tags>
        <tag>ant-design</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€å‰ç«¯ã€‘ä»¿ Android TextView å®ç°å®Œæ•´çš„æ–‡æœ¬æº¢å‡ºæˆªæ–­çœç•¥æ•ˆæœ</title>
    <url>/2019/04/20/2019Q2/%E5%89%8D%E7%AB%AF-%E6%BA%A2%E5%87%BA%E6%96%87%E6%9C%AC%E6%98%BE%E7%A4%BA%E7%9C%81%E7%95%A5%E5%8F%B7/</url>
    <content><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>åœ¨ Android çš„æ–‡æœ¬ç»„ä»¶ä¸­ï¼Œæœ‰ä¸ªå†…å®¹è¿‡é•¿æ˜¾ç¤ºçœç•¥å·çš„å±æ€§ - ellipsize ï¼Œæœ‰ä»¥ä¸‹é€‰é¡¹</p>
<ul>
<li>end: çœç•¥å·åœ¨æœ«å°¾</li>
<li>start: çœç•¥å·åœ¨å¼€å¤´</li>
<li>middle: çœç•¥å·åœ¨ä¸­é—´</li>
<li>marquee: è·‘é©¬ç¯æ•ˆæœ</li>
</ul>
<p>å¹¶é€šè¿‡ singleline/lines ç­‰å±æ€§è¿›è¡Œè¡Œæ•°çš„çº¦æŸ</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">"@+id/tv"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:ellipsize</span>=<span class="string">"end"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:singleline</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">    /&gt;</span></span><br></pre></td></tr></table></figure>

<a id="more"></a>

<p>è¿™äº›åŠŸèƒ½åœ¨å‰ç«¯ä¸­åˆè¯¥å¦‚ä½•å®ç°å‘¢ï¼Ÿæœ¬æ–‡å°†é€ä¸€è¿›è¡Œä»‹ç»ï¼Œå¹¶å°è£…æˆä¸€ä¸ª TextView ç»„ä»¶</p>
<p><s> é¡¹ç›®å·²å¼€æºï¼Œè¯¦è§ <a href="https://github.com/francecil/TextView" target="_blank" rel="noopener">TextView</a> </s></p>
<p>å®ç°è¿‡ç¨‹ä¸­è¿˜éœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š</p>
<ol>
<li>åŒå‡»æ–‡æœ¬è¿›è¡Œå¤åˆ¶çš„æ—¶å€™ï¼Œé»˜è®¤åº”è¯¥æ˜¯æ‹¿åˆ°å…¨éƒ¨æ–‡æœ¬ï¼Œä¸”å¤åˆ¶çš„å†…å®¹ä¸­ä¸å«çœç•¥å·ï¼ˆåŒæ—¶è¯¥å®ç°å¯¹æœç´¢å¼•æ“è‰¯å¥½ï¼Œå› ä¸ºæ‰€æœ‰æ–‡æœ¬ä¿ç•™ï¼‰</li>
<li>è‡ªé€‚åº”ï¼Œå®½åº¦è¶³å¤Ÿçš„è¯ä¸æ˜¾ç¤ºçœç•¥å·</li>
<li>å¢åŠ çœç•¥å·åœ¨ä¸¤è¾¹çš„åŠŸèƒ½ï¼Œé€‚ç”¨äºæŸäº›åœºæ™¯ï¼ˆåé¢ä¼šæåˆ°ï¼‰</li>
</ol>
<!--more-->

<h1 id="å•è¡Œ"><a href="#å•è¡Œ" class="headerlink" title="å•è¡Œ"></a>å•è¡Œ</h1><p>é’ˆå¯¹å—çº§å…ƒç´ æº¢å‡ºå†…å®¹ï¼ŒCSS æœ‰ä¸€ä¸ª <a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/text-overflow" target="_blank" rel="noopener">text-overflow</a> å±æ€§ï¼Œç”¨äºå¤„ç†æº¢å‡ºå†…å®¹çš„å¤„ç†</p>
<p>ç›®å‰æµè§ˆå™¨æ”¯æŒçš„ï¼Œé€šè¿‡ææ¡ˆçš„å€¼æœ‰ï¼š</p>
<ul>
<li><code>clip</code> : ç›´æ¥æˆªæ–­(é»˜è®¤å€¼)</li>
<li><code>ellipsis</code>: é‡‡ç”¨çœç•¥å·è¡¨ç¤ºè¢«æˆªæ–­çš„æ–‡æœ¬</li>
</ul>
<p>ä»¥ä¸Šä¸º Basic support åŠŸèƒ½</p>
<p>åœ¨æœªé€šè¿‡çš„è‰æ¡ˆä¸­è¿˜å°†æ”¯æŒ <code>&lt;string&gt;</code> ç±»å‹çš„å€¼ï¼Œ fade ä»¥åŠ fade() æ–¹æ³•ï¼Œå¹¶å…è®¸é…ç½®ä¸¤ä¸ªå€¼ç”¨äºæ§åˆ¶å‰åæº¢å‡ºå†…å®¹çš„è¡Œä¸ºã€‚ä½†æ˜¯æµè§ˆå™¨åŸºæœ¬éƒ½æœªæ”¯æŒï¼Œä»…ç«ç‹æ”¯æŒäº† String value å’Œ åŒå€¼ã€‚è¯¦è§<a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/text-overflow#%E6%B5%8F%E8%A7%88%E5%99%A8%E5%85%BC%E5%AE%B9%E6%80%A7" target="_blank" rel="noopener">æµè§ˆå™¨å…¼å®¹æ€§</a></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[ clip | ellipsis | &lt;string&gt; ]&#123;1,2&#125;</span><br></pre></td></tr></table></figure>

<p>åŸºäºå…¼å®¹æ€§é—®é¢˜ï¼Œæœ¬èŠ‚çš„å®ç°ä»…åŸºäº Basic support</p>
<h2 id="çœç•¥å·åœ¨æœ«å°¾"><a href="#çœç•¥å·åœ¨æœ«å°¾" class="headerlink" title="çœç•¥å·åœ¨æœ«å°¾"></a>çœç•¥å·åœ¨æœ«å°¾</h2><p>æœ€å¸¸è§çš„éœ€æ±‚</p>
<p>ç®€å•ä½¿ç”¨ <code>text-overflow:ellipsis</code> å³å¯</p>
<p>ä¸ºäº†æ»¡è¶³éœ€æ±‚ï¼Œè¿˜éœ€è¦è¿›è¡Œå…¶ä»–è®¾ç½®ï¼š</p>
<ol>
<li><code>white-space: nowrap;</code> // ä¸å¯¹æ–‡æœ¬è¿›è¡Œæ¢è¡Œ</li>
<li><code>overflow: hidden;</code> // éšè—æº¢å‡ºçš„æ–‡æœ¬</li>
</ol>
<p>ç”±äºæ˜¯éšè—æº¢å‡ºï¼Œæ‰€ä»¥åŒå‡»å¤åˆ¶æ–‡æœ¬çš„æ—¶å€™ï¼Œæ‹¿åˆ°çš„æ˜¯å…¨éƒ¨çš„æ–‡æœ¬(ä¸å«çœç•¥å·)</p>
<script async src="//jsrun.pro/GWfKp/embed/all/light/"></script>

<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"width: 100px;overflow: hidden;text-overflow: ellipsis;white-space: nowrap;"</span>&gt;</span></span><br><span class="line">  æˆ‘å’Œäº”ä¸ªä¼˜ç§€å‘˜å·¥ï¼Œåˆ†åˆ«æ˜¯xxxx</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<div style="width: 100px;overflow: hidden;text-overflow: ellipsis;white-space: nowrap;">
  æˆ‘å’Œäº”ä¸ªä¼˜ç§€å‘˜å·¥ï¼Œåˆ†åˆ«æ˜¯xxxx
</div>

<h2 id="çœç•¥å·åœ¨å¼€å¤´"><a href="#çœç•¥å·åœ¨å¼€å¤´" class="headerlink" title="çœç•¥å·åœ¨å¼€å¤´"></a>çœç•¥å·åœ¨å¼€å¤´</h2><p>å…ˆä¸Šä¾‹å­ï¼Œå¦‚æœçœ‹æ‡‚çš„è¯å¯ä»¥ç›´æ¥è·³è¿‡æœ€åçœ‹ç»“è®º</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">dir</span>=<span class="string">"rtl"</span>&gt;</span>0:è¿™æ˜¯æµ‹è¯•æ–‡æœ¬-ss!<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">dir</span>=<span class="string">"rtl"</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">dir</span>=<span class="string">"ltr"</span>&gt;</span>0:è¿™æ˜¯æµ‹è¯•æ–‡æœ¬-ss!<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>å¯¹åº”åœ¨æµè§ˆå™¨ä¸Šçš„æ˜¾ç¤ºæ•ˆæœæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">!è¿™æ˜¯æµ‹è¯•æ–‡æœ¬-ss:0</span><br><span class="line">0:è¿™æ˜¯æµ‹è¯•æ–‡æœ¬-ss!</span><br></pre></td></tr></table></figure>
<p>ï¼ˆè‡ªå³å‘å·¦çš„ä¹¦å†™æ–¹å‘ï¼‰</p>
<p><img src="https://pic2.zhimg.com/80/3c77c63b18cafd0f1d0706f332b88574_hd.jpg" alt="é»‘äººé—®å·"></p>
<h3 id="èƒŒæ™¯çŸ¥è¯†"><a href="#èƒŒæ™¯çŸ¥è¯†" class="headerlink" title="èƒŒæ™¯çŸ¥è¯†"></a>èƒŒæ™¯çŸ¥è¯†</h3><p><a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Global_attributes/dir" target="_blank" rel="noopener">dir</a> HTML å±æ€§ç”¨äºå†³å®šæ–‡æœ¬æ€»ä½“çš„ä¹¦å†™æ–¹å‘ã€‚é»˜è®¤å€¼ä¸º ltr è¡¨ç¤ºä»å·¦åˆ°å³ï¼Œ rtl è¡¨ç¤ºä»å³åˆ°å·¦(ä¸€èˆ¬ç”¨äºé˜¿æ‹‰ä¼¯è¯­)</p>
<blockquote>
<p>æ•ˆæœä¸ CSS çš„ direction å±æ€§ç›¸åŒ</p>
</blockquote>
<p>åœ¨æµè§ˆå™¨ä¸­ï¼Œå­—ç¬¦æŒ‰ html ç»“æ„ä¸­çš„é¡ºåºè¢«å­˜æ”¾åˆ°å†…å­˜ä¸­ï¼Œå…¶ä¸é¡µé¢æ˜¾ç¤ºçš„é¡ºåºæ˜¯ä¸ä¸€æ ·çš„ã€‚é¡µé¢æ˜¾ç¤ºçš„æ–¹å‘ç”± <a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/unicode-bidi" target="_blank" rel="noopener">unicode-bidi</a> åŒå‘ä¹¦å†™ç®—æ³•å†³å®šã€‚æ³¨æ„ï¼šåŒå‡»é€‰ä¸­å¤åˆ¶æ–‡æœ¬çš„æ—¶å€™ï¼Œæ‹¿çš„æ˜¯å†…å­˜ä¸­çš„å€¼ï¼Œä¸å— unicode-bidi å½±å“</p>
<p>æ ¹æ®æ–¹å‘å±æ€§ï¼Œ Unicode å­—ç¬¦åˆ†ä¸ºä»¥ä¸‹å‡ ç§ç±»å‹ï¼š</p>
<table>
<thead>
<tr>
<th>ç±»å‹</th>
<th>æ–¹å‘</th>
<th>å­—ç¬¦</th>
<th>æ•ˆæœ</th>
</tr>
</thead>
<tbody><tr>
<td>å¼ºå­—ç¬¦</td>
<td>LTR/RTL</td>
<td>è‹±æ–‡ã€æ±‰å­—ã€é˜¿æ‹‰ä¼¯æ–‡å­—ç­‰</td>
<td>æ–¹å‘æ€§ç¡®å®š,LTR æˆ– RTL,å’Œä¸Šä¸‹æ–‡æ— å…³.ä¸”å¯èƒ½å½±å“å…¶å‰åå­—ç¬¦çš„æ–¹å‘æ€§</td>
</tr>
<tr>
<td>å¼±å­—ç¬¦</td>
<td>LTR/RTL</td>
<td>æ•°å­—ã€æ•°å­—ç›¸å…³ç¬¦å·</td>
<td>æ–¹å‘æ€§ç¡®å®šï¼Œä½†æ˜¯ä¸ä¼šå½±å“å‰åå­—ç¬¦çš„æ–¹å‘æ€§</td>
</tr>
<tr>
<td>ä¸­æ€§å­—ç¬¦</td>
<td>Neutral</td>
<td>å¤§éƒ¨åˆ†æ ‡ç‚¹ç¬¦å·å’Œç©ºæ ¼</td>
<td>æ–¹å‘æ€§ä¸ç¡®å®šï¼Œç”±ä¸Šä¸‹æ–‡ç¯å¢ƒå†³å®šå…¶æ–¹å‘</td>
</tr>
</tbody></table>
<p>ä¸Šä¸‹æ–‡ç¯å¢ƒç”±å¼ºå­—ç¬¦æ–¹å‘åŠå…¨å±€ä¹¦å†™æ–¹å‘å†³å®šï¼Œå…·ä½“è§„åˆ™åé¢å†å†™ä¸€ç¯‡æ–‡ç«  bidi ç®—æ³•çš„è®²è§£</p>
<p>ä¸€æ®µæ–‡æœ¬ä¸­å…·æœ‰ç›¸åŒæ–¹å‘æ€§çš„è¿ç»­å­—ç¬¦ï¼Œç§°ä¸ºæ–¹å‘ä¸²</p>
<p>å› æ­¤ <code>&lt;div dir=&quot;rtl&quot;&gt;0:è¿™æ˜¯æµ‹è¯•æ–‡æœ¬-ss!&lt;/div&gt;</code> åŒ…å«äº†å¦‚ä¸‹çš„æ–¹å‘ä¸²</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0 -&gt;</span><br><span class="line">: &lt;- &#x2F;&#x2F; dir&#x3D;&quot;rtl&quot;</span><br><span class="line">è¿™æ˜¯æµ‹è¯•æ–‡æœ¬ -&gt;</span><br><span class="line">- -&gt; &#x2F;&#x2F; å—å¼ºå­—ç¬¦å½±å“</span><br><span class="line">ss -&gt;</span><br><span class="line">! &lt;- &#x2F;&#x2F; dir&#x3D;&quot;rtl&quot;</span><br></pre></td></tr></table></figure>

<p><code>è¿™æ˜¯æµ‹è¯•æ–‡æœ¬</code>ã€<code>-</code>ã€<code>ss</code> ä¸ºç›¸åŒæ–¹å‘ï¼Œç»§ç»­åˆå¹¶ä¸ºä¸€ä¸ªæ–¹å‘ä¸²</p>
<p>æœ€åå°±å‰©</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0 -&gt;</span><br><span class="line">: &lt;- </span><br><span class="line">è¿™æ˜¯æµ‹è¯•æ–‡æœ¬-ss -&gt;</span><br><span class="line">! &lt;-</span><br></pre></td></tr></table></figure>

<p>æ ¹æ® rtl çš„æ€»ä½“ä¹¦å†™æ–¹å‘ï¼Œæœ€ååœ¨é¡µé¢ä¸­æ˜¾ç¤ºä¸º <code>!è¿™æ˜¯æµ‹è¯•æ–‡æœ¬-ss:0</code> ï¼Œé€šè¿‡å…‰æ ‡é€‰ä¸­ä¹Ÿèƒ½å¤Ÿæµ‹è¯•å…¶å†…éƒ¨æ–¹å‘</p>
<p>å¦‚æœæ–‡æœ¬åº”ç”¨äº†å†…è”å…ƒç´ ï¼Œå…¶æ–‡æœ¬ä¸­ä¸­æ€§å­—ç¬¦çš„æ–¹å‘ä¸å—å¤–å±‚å½±å“</p>
<p>å¯¹äº <code>&lt;div dir=&quot;rtl&quot;&gt;&lt;span dir=&quot;ltr&quot;&gt;0:è¿™æ˜¯æµ‹è¯•æ–‡æœ¬-ss!&lt;/span&gt;&lt;/div&gt;</code> è¿™ä¸ªä¾‹å­</p>
<p>span ä¸­æ‰€æœ‰å­—ç¬¦éƒ½æ˜¯é‡‡ç”¨ ltr çš„æ–¹å‘ï¼Œå¯¹äº div æ¥è¯´ï¼Œå…¶å†…å®¹åˆæ˜¯è‡ªå³å‘å·¦çš„ã€‚</p>
<p>äºæ˜¯å°±èƒ½å®ç°è‡ªå³å‘å·¦æ°´å¹³æº¢å‡ºï¼Œå†…éƒ¨å­—ç¬¦é¡ºåºä¿æŒä¸å˜çš„æ•ˆæœ</p>
<h3 id="åº”ç”¨"><a href="#åº”ç”¨" class="headerlink" title="åº”ç”¨"></a>åº”ç”¨</h3><p>æ ¹æ®ä»¥ä¸Šç‰¹æ€§ï¼Œæˆ‘ä»¬å†åº”ç”¨ä¸Š <code>text-overflow:ellipsis</code> è¯•è¯•</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">HTML</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">"text/css"</span>&gt;</span></span><br><span class="line">    div &#123;</span><br><span class="line">      text-align: left;</span><br><span class="line">      width: 100px;</span><br><span class="line">      overflow: hidden;</span><br><span class="line">      text-overflow: ellipsis;</span><br><span class="line">      white-space: nowrap;</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">dir</span>=<span class="string">"rtl"</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">dir</span>=<span class="string">"ltr"</span>&gt;</span>0:è¿™æ˜¯æµ‹è¯•æ–‡æœ¬-ss!<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>è€ƒè™‘åˆ°çˆ¶å…ƒç´ å®½åº¦è¶³å¤Ÿå¤§ï¼Œè€Œæ–‡æœ¬è¾ƒå°‘æ—¶ï¼Œæ–‡æœ¬ä¼šé å³æ˜¾ç¤ºï¼Œæ•…åœ¨ div ä¸Šè®¾ç½® <code>text-align: left;</code></p>
<p>å®éªŒä¸­å‘ç°ï¼Œå¦‚æœ span é‡‡ç”¨çš„æ˜¯ <code>direction: ltr;</code> ï¼Œè¿˜éœ€è¦åŠ ä¸Š <code>unicode-bidi: embed;</code> åœ¨è¾¹ç•ŒåŠ å…¥ä¸€äº›æ§åˆ¶å­—ç¬¦ã€‚å…·ä½“åŸç†æœ¬æ–‡ä¸å†åˆ†æã€‚</p>
<p>unicode-bidi çš„ç›¸å…³èµ„æ–™å¯ä»¥æŸ¥çœ‹ä»¥ä¸‹é“¾æ¥</p>
<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/unicode-bidi" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Web/CSS/unicode-bidi</a></p>
<p><a href="https://www.w3.org/TR/CSS2/visuren.html#propdef-unicode-bidi" target="_blank" rel="noopener">https://www.w3.org/TR/CSS2/visuren.html#propdef-unicode-bidi</a></p>
<script async src="//jsrun.pro/KffKp/embed/all/light/"></script>

<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">dir</span>=<span class="string">"rtl"</span> <span class="attr">style</span>=<span class="string">"text-align: left;width: 100px;overflow: hidden;text-overflow: ellipsis;white-space: nowrap;"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">span</span> <span class="attr">dir</span>=<span class="string">"ltr"</span>&gt;</span>0:è¿™æ˜¯æµ‹è¯•æ–‡æœ¬-ss!<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<div dir="rtl" style="text-align: left;width: 100px;overflow: hidden;text-overflow: ellipsis;white-space: nowrap;">
  <span dir="ltr">0:è¿™æ˜¯æµ‹è¯•æ–‡æœ¬-ss!</span>
</div>

<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨ç«ç‹ä¸­ï¼Œå¾—åˆ°çš„æ•ˆæœæ˜¯å‘ˆç°çš„å­—ç¬¦ç›¸å¯¹çˆ¶å®¹å™¨é å³</p>
<h2 id="çœç•¥å·åœ¨ä¸¤è¾¹"><a href="#çœç•¥å·åœ¨ä¸¤è¾¹" class="headerlink" title="çœç•¥å·åœ¨ä¸¤è¾¹"></a>çœç•¥å·åœ¨ä¸¤è¾¹</h2><p>ä¸€èˆ¬ä½¿ç”¨çš„åœºæ™¯æ˜¯ï¼Œæˆ‘ä»¬æœç´¢åˆ°æŸä¸ªå…³é”®å­—ï¼Œç„¶åè¦å±…ä¸­å±•ç¤ºè¯¥å…³é”®å­—ï¼Œå·¦å³ä¸¤è¾¹è¶…è¿‡è¾¹ç•Œçš„å­—ç¬¦éƒ½æ˜¾ç¤ºçœç•¥å·</p>
<p>å®ç°æ€è·¯ä¸ºåˆ‡åˆ†ä¸ºä¸¤ä¸ªå­—ç¬¦ä¸²ï¼Œåˆ†ä¸ºåº”ç”¨ <strong>çœç•¥åœ¨å¼€å¤´</strong> å’Œ <strong>çœç•¥åœ¨æœ«å°¾</strong> çš„è§£å†³æ–¹æ¡ˆ</p>
<p>å¦‚ä½•åˆ‡åˆ†ï¼Œåˆæœ‰ä»¥ä¸‹ä¸¤ç§æ€è·¯</p>
<p>ä¸€èˆ¬é‡‡ç”¨ç¬¬äºŒç§</p>
<h3 id="å‰åŠå­—ç¬¦ä¸²å«å…³é”®å­—"><a href="#å‰åŠå­—ç¬¦ä¸²å«å…³é”®å­—" class="headerlink" title="å‰åŠå­—ç¬¦ä¸²å«å…³é”®å­—"></a>å‰åŠå­—ç¬¦ä¸²å«å…³é”®å­—</h3><p>åˆ‡åˆ†ä¸ºä¸¤ä¸ªå­—ç¬¦ä¸²ï¼Œå‰åŠå­—ç¬¦ä¸²åŒ…å«å…³é”®å­—</p>
<p>æœ€åç”¨ä¸€ä¸ªdiv åŒ…ä½ä¸¤ä¸ªå­—ç¬¦ä¸²ï¼Œè¯¥ div å®½åº¦ä¸ºå‰ä¸² div å®½åº¦+16ï¼Œå¹¶åº”ç”¨ <strong>çœç•¥åœ¨æœ«å°¾</strong> çš„è§£å†³æ–¹æ¡ˆ</p>
<p>æ³¨æ„ï¼Œä¸ºäº†è‡ªé€‚åº”ï¼Œå‰ä¸²çš„å®½åº¦å®šä¹‰ä¸º <code>max-width: calc(100% - 14px);</code></p>
<p>å½“çˆ¶ div è¶³å¤Ÿå¤§æ—¶ï¼Œå‰é¢çš„å­—ä¸²ä¼šå…ˆå±•ç¤ºï¼Œç„¶åå†å±•ç¤ºåé¢çš„å­—ä¸²</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">HTML</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">"text/css"</span>&gt;</span></span><br><span class="line"><span class="css">    <span class="selector-class">.wrapper</span> &#123;</span></span><br><span class="line">      width: 200px;</span><br><span class="line">      text-align: left;</span><br><span class="line">      overflow: hidden;</span><br><span class="line">      text-overflow: ellipsis;</span><br><span class="line">      white-space: nowrap;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="css">    <span class="selector-class">.left</span> &#123;</span></span><br><span class="line">      display: inline-block;</span><br><span class="line">      text-align: left;</span><br><span class="line">      overflow: hidden;</span><br><span class="line">      text-overflow: ellipsis;</span><br><span class="line">      white-space: nowrap;</span><br><span class="line">      max-width: calc(100% - 14px);</span><br><span class="line">      vertical-align: text-bottom;</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"wrapper"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">dir</span>=<span class="string">"rtl"</span> <span class="attr">class</span>=<span class="string">"left"</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">dir</span>=<span class="string">"ltr"</span>&gt;</span>12-è¿™æ˜¯ä¸€æ®µæµ‹è¯•æ–‡æœ¬ä¸€æ®µæµ‹è¯•æ–‡æœ¬!@<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"right"</span>&gt;</span>å³ä¾§æ–‡æœ¬ã€‚<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<div class="wrapper" style="width: 200px;text-align: left;overflow: hidden;text-overflow: ellipsis;white-space: nowrap;">
  <span dir="rtl" class="left" style="display:inline-block;text-align: left;overflow: hidden;text-overflow: ellipsis;white-space: nowrap;max-width: calc(100% - 14px);vertical-align: text-bottom;"><span dir="ltr">12-è¿™æ˜¯ä¸€æ®µæµ‹è¯•æ–‡æœ¬ä¸€æ®µæµ‹è¯•æ–‡æœ¬!@</span></span
  ><span class="right">å³ä¾§æ–‡æœ¬ã€‚</span>
</div>

<p>åœ¨æ§åˆ¶å°ä¸­ä¿®æ”¹ wrapper çš„å®½åº¦ï¼ŒæŸ¥çœ‹æ•ˆæœ</p>
<p>æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š</p>
<ul>
<li>è¡Œå†…å…ƒç´ ä¹‹é—´ä¼šå¸¦ä¸€ä¸ªç©ºæ ¼ï¼›ä»£ç é‡Œå†™æˆä¸€è¡Œå°±ä¸ä¼š</li>
<li>åœ¨ç«ç‹ä¸­å¤åˆ¶ï¼Œéœ€è¦ <code>ctrl+a</code> å…¨é€‰æ‰è¡Œ</li>
<li>ç”±äº IFC çš„åŸå› ï¼Œåé¢çš„å†…è”å—ä¼šå‚ç›´åä¸‹ï¼Œé€šè¿‡è®¾ç½® <code>vertical-align</code> è§£å†³</li>
</ul>
<h3 id="åˆ‡åˆ†æ—¶ä¸¤ä¸ªå­—ç¬¦ä¸²å„å 50"><a href="#åˆ‡åˆ†æ—¶ä¸¤ä¸ªå­—ç¬¦ä¸²å„å 50" class="headerlink" title="åˆ‡åˆ†æ—¶ä¸¤ä¸ªå­—ç¬¦ä¸²å„å 50%"></a>åˆ‡åˆ†æ—¶ä¸¤ä¸ªå­—ç¬¦ä¸²å„å 50%</h3><p>ä¸ä¸Šç§æ€è·¯çš„æ•ˆæœä¸åŒï¼Œå½“çˆ¶å…ƒç´ å˜å¤§çš„æ—¶å€™ï¼Œå·¦å³ä¸¤è¾¹çš„å­—ç¬¦ä¼šä¸€èµ·ä¸æ–­å±•ç¤º</p>
<p>å‰ä¸²é€šè¿‡è®¾ç½® <code>max-width:50%;</code> æ ·å¼ï¼Œå½“çˆ¶å…ƒç´ è¶³å¤Ÿå¤§çš„æ—¶å€™ï¼Œæ–‡å­—å§‹ç»ˆå±…å·¦</p>
<p>è‹¥è¦å®ç°æ–‡å­—å§‹ç»ˆå±…ä¸­ï¼Œåˆ™æ”¹ä¸º <code>width:50%;</code></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">HTML</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">"text/css"</span>&gt;</span></span><br><span class="line"><span class="css">    <span class="selector-class">.wrapper</span> &#123;</span></span><br><span class="line">      width: 200px;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="css">    <span class="selector-class">.left</span> &#123;</span></span><br><span class="line">      display: inline-block;</span><br><span class="line">      max-width: 50%;</span><br><span class="line">      overflow: hidden;</span><br><span class="line">      text-overflow: ellipsis;</span><br><span class="line">      white-space: nowrap;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="css">    <span class="selector-class">.right</span> &#123;</span></span><br><span class="line">      width: 50%;</span><br><span class="line">      display: inline-block;</span><br><span class="line">      overflow: hidden;</span><br><span class="line">      text-overflow: ellipsis;</span><br><span class="line">      white-space: nowrap;</span><br><span class="line">      text-align: left;</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"wrapper"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"left"</span> <span class="attr">dir</span>=<span class="string">"rtl"</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">dir</span>=<span class="string">"ltr"</span>&gt;</span>12-è¿™æ˜¯ä¸€æ®µæµ‹è¯•æ–‡æœ¬!@1<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"right"</span>&gt;</span>å±å±å±å±çœ‹çš„åˆ°æˆ‘å—ï¼Ÿ<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<div class="wrapper" style="width: 200px;">
  <div class="left" dir="rtl" style="display:inline-block;
  max-width:50%;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;"><span dir="ltr">12-è¿™æ˜¯ä¸€æ®µæµ‹è¯•æ–‡æœ¬!@1</span></div
  ><span class="right" style="width:50%;
  display:inline-block;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  text-align: left;">å±å±å±å±çœ‹çš„åˆ°æˆ‘å—ï¼Ÿ</span>
</div>

<h2 id="çœç•¥å·åœ¨ä¸­é—´ï¼ˆæˆ–æŸä¸ªä½ç½®ï¼‰"><a href="#çœç•¥å·åœ¨ä¸­é—´ï¼ˆæˆ–æŸä¸ªä½ç½®ï¼‰" class="headerlink" title="çœç•¥å·åœ¨ä¸­é—´ï¼ˆæˆ–æŸä¸ªä½ç½®ï¼‰"></a>çœç•¥å·åœ¨ä¸­é—´ï¼ˆæˆ–æŸä¸ªä½ç½®ï¼‰</h2><p>ä¾æ—§éœ€è¦å¯¹å­—ç¬¦ä¸²è¿›è¡Œåˆ‡åˆ†</p>
<p>å‰ååˆ†åˆ«åº”ç”¨ <strong>çœç•¥åœ¨æœ«å°¾</strong> å’Œ  <strong>çœç•¥åœ¨å¼€å¤´</strong></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">HTML</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">"text/css"</span>&gt;</span></span><br><span class="line"><span class="css">    <span class="selector-class">.wrapper</span> &#123;</span></span><br><span class="line">      width: 200px;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="css">    <span class="selector-class">.left</span> &#123;</span></span><br><span class="line">      max-width: 50%;</span><br><span class="line">      display: inline-block;</span><br><span class="line">      overflow: hidden;</span><br><span class="line">      text-overflow: ellipsis;</span><br><span class="line">      white-space: nowrap;</span><br><span class="line">      text-align: right;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="css">    <span class="selector-class">.right</span> &#123;</span></span><br><span class="line">      display: inline-block;</span><br><span class="line">      max-width: 50%;</span><br><span class="line">      overflow: hidden;</span><br><span class="line">      text-overflow: ellipsis;</span><br><span class="line">      white-space: nowrap;</span><br><span class="line">      text-align: left;</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"wrapper"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"left"</span>&gt;</span>12-è¿™æ˜¯ä¸€æ®µæµ‹è¯•æ–‡æœ¬!@1<span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"right"</span> <span class="attr">dir</span>=<span class="string">"rtl"</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">dir</span>=<span class="string">"ltr"</span>&gt;</span>å±å±å±å±çœ‹çš„åˆ°æˆ‘å—ï¼Ÿ<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>åœ¨ chrome ä¸Šæ˜¾ç¤ºè‰¯å¥½ï¼Œä½†æ˜¯ç«ç‹ï¼ŒIE ä¸¤ä¸ªçœç•¥å·ä¸­ä¼šå­˜åœ¨ä¸€ä¸ªé—´éš”ï¼Œå¹¶ä¸”å½“ wrapper å®½åº¦è¶³å¤Ÿçš„æ—¶å€™ï¼Œçœç•¥å·å°†å˜ä¸ºä¸€ä¸ªï¼Œæ ·å¼ä¸Šä¸ç»Ÿä¸€</p>
<div class="wrapper" style="width: 200px;">
  <div class="left" style="max-width:50%;
  display:inline-block;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  text-align: right;">12-è¿™æ˜¯ä¸€æ®µæµ‹è¯•æ–‡æœ¬!@1</div
  ><span class="right" dir="rtl" style="display:inline-block;
  max-width:50%;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  text-align: left;"><span dir="ltr">å±å±å±å±çœ‹çš„åˆ°æˆ‘å—ï¼Ÿ</span><span>
</div>

<p>ç›®å‰æš‚æœªæ‰¾åˆ°å…¶ä»–è§£å†³æ–¹æ¡ˆ</p>
<h2 id="è·‘é©¬ç¯æ•ˆæœ"><a href="#è·‘é©¬ç¯æ•ˆæœ" class="headerlink" title="è·‘é©¬ç¯æ•ˆæœ"></a>è·‘é©¬ç¯æ•ˆæœ</h2><p>é‡‡ç”¨ <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/marquee" target="_blank" rel="noopener">marquee</a> HTML å…ƒç´ å®ç°ã€‚è¯¥å…ƒç´ å…¼å®¹æ€§é«˜ï¼Œå¹¶æä¾›å¤šç§å±æ€§é…ç½®ã€‚</p>
<p>loop æ§åˆ¶æ»šåŠ¨æ¬¡æ•°,é»˜è®¤å€¼ -1 è¡¨ç¤ºè¿ç»­æ»šåŠ¨</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">marquee</span> <span class="attr">width</span>=<span class="string">"100"</span> <span class="attr">loop</span>=<span class="string">"-1"</span>&gt;</span>This text will scroll from right to left<span class="tag">&lt;/<span class="name">marquee</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">marquee</span> <span class="attr">width</span>=<span class="string">"100"</span> <span class="attr">loop</span>=<span class="string">"3"</span>&gt;</span>This text will scroll from right to left<span class="tag">&lt;/<span class="name">marquee</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><marquee width="100" loop="-1">This text will scroll from right to left</marquee><br><marquee width="100" loop="3">This text will scroll from right to left</marquee></p>
<p>direction æ§åˆ¶æ»šåŠ¨æ–¹å‘ï¼Œå¯é€‰å€¼æœ‰ leftã€é»˜è®¤ã€‘, right, up and down</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">marquee</span> <span class="attr">width</span>=<span class="string">"100"</span> <span class="attr">direction</span>=<span class="string">"left"</span>&gt;</span>This text will scroll from right to left<span class="tag">&lt;/<span class="name">marquee</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">marquee</span> <span class="attr">width</span>=<span class="string">"100"</span> <span class="attr">direction</span>=<span class="string">"up"</span>&gt;</span>This text will scroll from right to left<span class="tag">&lt;/<span class="name">marquee</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><marquee width="100" direction="left">This text will scroll from right to left</marquee><br><marquee width="100" direction="up">This text will scroll from right to left</marquee></p>
<p>åˆ©ç”¨ <code>scrollamount/scrolldelay/truespeed</code> æ§åˆ¶æ»šåŠ¨é€Ÿåº¦</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">marquee</span> <span class="attr">width</span>=<span class="string">"100"</span> <span class="attr">scrollamount</span>=<span class="string">"6"</span> <span class="attr">scrolldelay</span>=<span class="string">"30"</span> <span class="attr">truespeed</span>&gt;</span>This text will scroll from right to left<span class="tag">&lt;/<span class="name">marquee</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">marquee</span> <span class="attr">width</span>=<span class="string">"100"</span> <span class="attr">scrollamount</span>=<span class="string">"10"</span> <span class="attr">scrolldelay</span>=<span class="string">"30"</span> <span class="attr">truespeed</span>&gt;</span>This text will scroll from right to left<span class="tag">&lt;/<span class="name">marquee</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">marquee</span> <span class="attr">width</span>=<span class="string">"100"</span> <span class="attr">scrollamount</span>=<span class="string">"6"</span> <span class="attr">scrolldelay</span>=<span class="string">"80"</span>&gt;</span>This text will scroll from right to left<span class="tag">&lt;/<span class="name">marquee</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><marquee width="100" scrollamount="6" scrolldelay="30" truespeed>This text will scroll from right to left</marquee><br><marquee width="100" scrollamount="10" scrolldelay="30" truespeed>This text will scroll from right to left</marquee><br><marquee width="100" scrollamount="6" scrolldelay="80">This text will scroll from right to left</marquee></p>
<p>æ ¹æ®éœ€æ±‚è¿›è¡Œé…ç½®</p>
<h1 id="å¤šè¡Œ"><a href="#å¤šè¡Œ" class="headerlink" title="å¤šè¡Œ"></a>å¤šè¡Œ</h1><p>ç½‘ä¸Šä¹Ÿæœ‰å¾ˆå¤šè§£å†³æ–¹æ¡ˆï¼Œè¯¦è§ <a href="https://juejin.im/post/5dc15b35f265da4d432a3d10" target="_blank" rel="noopener">å¯èƒ½æ˜¯æœ€å…¨çš„ â€œæ–‡æœ¬æº¢å‡ºæˆªæ–­çœç•¥â€ æ–¹æ¡ˆåˆé›†</a>ï¼Œæœ¬æ–‡ä¸åšåŸç†è®²è§£</p>
<p>ä»¥åŠä¸€ä¸ªè¾ƒä¸ºæµè¡Œçš„å¼€æºåº“ <a href="https://github.com/josephschmitt/Clamp.js" target="_blank" rel="noopener">Clamp.js</a></p>
<p>å„æœ‰ä¼˜ç¼ºç‚¹ï¼Œæ²¡æœ‰å®Œç¾æ–¹æ¡ˆ</p>
<p>è¿™é‡Œä»¥<strong>ä¼ªå…ƒç´  + å®šä½å®ç°å¤šè¡Œçœç•¥</strong>çš„è§£å†³æ–¹æ¡ˆå®ç°å¤šè¡Œæº¢å‡ºçœç•¥çš„æ•ˆæœ</p>
<p>é€šè¿‡ <code>line-height</code> å’Œ <code>max-height</code> æ§åˆ¶è¡Œæ•°ã€‚è‡³äºè¡Œé«˜åº”è¯¥è®¾ç½®å¤šå°‘ï¼Œè¿™ä¸ªåº”è¯¥å¯¹å¤–æä¾›ä¸€ä¸ªå±æ€§è®©ç”¨æˆ·è¿›è¡Œé…ç½®ã€‚æ€»ä¹‹ï¼Œ<code>max-height = N * line-height (em)</code></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">HTML</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">"text/css"</span>&gt;</span></span><br><span class="line"><span class="css">    <span class="selector-class">.multi-line-ellipsis</span> &#123;</span></span><br><span class="line">      width: 200px;</span><br><span class="line">      max-height: 2em;</span><br><span class="line">      line-height: 1;</span><br><span class="line">      overflow: hidden;</span><br><span class="line">      position: relative;</span><br><span class="line">      text-align: justify;</span><br><span class="line">      margin-right: -1em;</span><br><span class="line">      padding-right: 1em;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="css">    <span class="selector-class">.multi-line-ellipsis</span><span class="selector-pseudo">::before</span> &#123;</span></span><br><span class="line">      content: '...';</span><br><span class="line">      position: absolute;</span><br><span class="line">      right: 0;</span><br><span class="line">      bottom: 0;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="css">    <span class="selector-class">.multi-line-ellipsis</span><span class="selector-pseudo">::after</span> &#123;</span></span><br><span class="line">      content: '';</span><br><span class="line">      position: absolute;</span><br><span class="line">      right: 0;</span><br><span class="line">      width: 1em;</span><br><span class="line">      height: 1em;</span><br><span class="line"><span class="css">      <span class="selector-tag">margin-top</span>: 0<span class="selector-class">.2em</span>;</span></span><br><span class="line">      background: white;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="css">    <span class="selector-class">.block-with-text</span><span class="selector-pseudo">:before</span> &#123;</span></span><br><span class="line">      content: '...';</span><br><span class="line">      position: absolute;</span><br><span class="line">      right: 0;</span><br><span class="line">      bottom: 0;</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"multi-line-ellipsis"</span>&gt;</span>è¿™æ˜¯ä¸€ä¸²çŸ­å­—ç¬¦ä¸²<span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"multi-line-ellipsis"</span>&gt;</span>è¿™æ˜¯ä¸€ä¸²é•¿é•¿é•¿é•¿é•¿é•¿é•¿é•¿é•¿é•¿é•¿å­—ç¬¦ä¸²<span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"multi-line-ellipsis"</span>&gt;</span>è¿™æ˜¯ä¸€ä¸²é•¿é•¿é•¿é•¿é•¿é•¿é•¿é•¿é•¿é•¿é•¿å­—ç¬¦ä¸²ï¼Œåé¢çš„å†…å®¹åº”è¯¥ä¼šè¢«æˆªæ‰äº†<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æ•ˆæœå¦‚ä¸‹</p>
<p><img src="https://upload-images.jianshu.io/upload_images/9277731-74eb31c31be6d059.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="lines"></p>
<h1 id="æ–‡æœ¬æº¢å‡ºæ¨¡å¼"><a href="#æ–‡æœ¬æº¢å‡ºæ¨¡å¼" class="headerlink" title="æ–‡æœ¬æº¢å‡ºæ¨¡å¼"></a>æ–‡æœ¬æº¢å‡ºæ¨¡å¼</h1><p>è¿˜å‰©ä¸‹ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚ä½•åˆ¤æ–­å½“å‰æ–‡æœ¬å¤„äºæ–‡æœ¬æº¢å‡ºæ¨¡å¼ã€‚</p>
<p>ç”¨äºå¤–éƒ¨ç›‘å¬ï¼Œå½“å¤„äºæ–‡æœ¬æº¢å‡ºæ¨¡å¼ï¼Œé¼ æ ‡æŒ‡å‘è¯¥ç»„ä»¶æ—¶åº”è¯¥å‡ºç°ä¸€ä¸ªå®Œæ•´æ–‡æœ¬çš„ Tooltip ç»„ä»¶</p>
<p>é‚£å¦‚ä½•åˆ¤æ–­å‘¢ï¼Ÿ</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// target ä¸ºæ–‡æœ¬å…ƒç´ </span></span><br><span class="line"><span class="keyword">let</span> containerWidth = target.getBoundingClientRect().width  <span class="comment">//å½“å‰å®¹å™¨çš„å®½åº¦</span></span><br><span class="line"><span class="keyword">let</span> textWidth = target.scrollWidth; <span class="comment">//å½“å‰æ–‡å­—ï¼ˆåŒ…æ‹¬çœç•¥éƒ¨åˆ†ï¼‰çš„å®½åº¦</span></span><br><span class="line"><span class="keyword">let</span> isEllipsis = textWidth &gt; containerWidth</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæˆ‘ä»¬å¯ä»¥ç”¨ title å±æ€§æ¥æ¨¡æ‹Ÿ Tooltip</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(isEllipsis)&#123;</span><br><span class="line">  target.setAttribute(<span class="string">"title"</span>,<span class="string">"å®Œæ•´æ–‡æœ¬"</span>)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  el.removeAttribute(<span class="string">"title"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>åŸºæœ¬ä¸Šæˆ‘ä»¬å·²ç»èƒ½å¤Ÿåœ¨å‰ç«¯æ¨¡æ‹Ÿ Android TextView çš„æº¢å‡ºæ–‡æœ¬æ•ˆæœ</p>
<p>ç›®å‰æå‡ºçš„è§£å†³æ–¹æ¡ˆèƒ½å¤Ÿå…¼å®¹å¤§å¤šæ•°ä¸»æµæµè§ˆå™¨ï¼Œè‹¥å­˜åœ¨ä¸å…¼å®¹çš„æƒ…å†µï¼Œæ¬¢è¿æå‡º</p>
<h1 id="å±•æœ›"><a href="#å±•æœ›" class="headerlink" title="å±•æœ›"></a>å±•æœ›</h1><p>è‹¥æœ¬èº«åŒ…å«é˜¿æ‹‰ä¼¯å­—ç¬¦ï¼Œä»¥ä¸Šæ“ä½œæ˜¯å¦è¿˜æœ‰æ•ˆï¼Œè¿˜æœªéªŒè¯</p>
<p>åç»­å°†é‡‡ç”¨ React Hooks æŠ€æœ¯å¯¹ç»„ä»¶è¿›è¡Œå°è£…ï¼Œå¹¶è¿›è¡Œå¼€æº</p>
<h1 id="æ‹“å±•é˜…è¯»"><a href="#æ‹“å±•é˜…è¯»" class="headerlink" title="æ‹“å±•é˜…è¯»"></a>æ‹“å±•é˜…è¯»</h1><ol>
<li><a href="https://blog.csdn.net/qq_25243451/article/details/89500218" target="_blank" rel="noopener">CSSæ·±åº¦å­¦ä¹  - æ–‡æœ¬æ–¹å‘ direction å’Œ dir</a></li>
<li><a href="https://www.cnblogs.com/dojo-lzz/p/4289423.html" target="_blank" rel="noopener">bidi(åŒå‘æ–‡å­—)ä¸RTLå¸ƒå±€æ€»ç»“</a></li>
<li><a href="https://juejin.im/entry/5bbc7b18f265da0aeb712117" target="_blank" rel="noopener">Unicode æ§åˆ¶å­—ç¬¦åŠå…¶æœ‰å…³çš„åŒå‘ç®—æ³•</a></li>
<li><a href="https://www.jianshu.com/p/07bcb00aa0ee" target="_blank" rel="noopener">å¤šè¡Œæ–‡æœ¬çœç•¥è¿‘å®Œç¾æ–¹æ¡ˆ</a></li>
</ol>
]]></content>
      <categories>
        <category>å¤§å‰ç«¯</category>
      </categories>
      <tags>
        <tag>HTML</tag>
        <tag>CSS</tag>
      </tags>
  </entry>
  <entry>
    <title>vue-eslint-vscode é€šç”¨é…ç½®</title>
    <url>/2019/01/20/2019Q1/vue-eslint-vscode%E9%80%9A%E7%94%A8%E9%85%8D%E7%BD%AE/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>åœ¨vscodeçš„vueé¡¹ç›®ä¸­ï¼Œå…³äºä»£ç æ£€æŸ¥å’Œæ ¼å¼åŒ–ï¼Œé‡åˆ°å„ç§å„æ ·çš„é—®é¢˜ï¼Œæ¯”å¦‚ï¼š</p>
<ol>
<li>ä¸æ¸…æ¥šå®‰è£…çš„æ‹“å±•çš„åŠŸèƒ½ï¼Œå¯¼è‡´å®‰è£…äº†é‡å¤åŠŸèƒ½çš„æ‹“å±•</li>
<li>å³é”®æ ¼å¼åŒ–æ–‡æ¡£çš„æ—¶å€™ï¼Œä¸æ˜¯æŒ‰eslintçš„è§„åˆ™æ¥æ ¼å¼åŒ–ï¼Œå¯¼è‡´éœ€è¦æˆ‘å†æ¬¡æ‰‹åŠ¨è°ƒæ•´</li>
<li>ä¿å­˜æ—¶ä¸èƒ½è‡ªåŠ¨ä¿®å¤ä»£ç </li>
</ol>
<p>ä»¥ä¸‹é€šè¿‡è‡ªå·±çš„å®è·µï¼Œè¿›è¡Œäº†ç›¸åº”é…ç½®ï¼Œç›®å‰å¯ä»¥å®ç°ï¼š</p>
<ul>
<li>ä»…å®‰è£…2ä¸ªæ¨èçš„æ‹“å±•</li>
<li>å³é”®æ ¼å¼åŒ–æ–‡æ¡£æŒ‰ç…§eslintè§„åˆ™ï¼Œä¸ä¼šäº§ç”Ÿé”™è¯¯</li>
<li>ä¿å­˜æ—¶è‡ªåŠ¨ä¿®å¤ä»£ç </li>
</ul>
<a id="more"></a>

<h2 id="vscode-æ‹“å±•å®‰è£…"><a href="#vscode-æ‹“å±•å®‰è£…" class="headerlink" title="vscode æ‹“å±•å®‰è£…"></a>vscode æ‹“å±•å®‰è£…</h2><h3 id="eslint-æ‹“å±•"><a href="#eslint-æ‹“å±•" class="headerlink" title="eslint æ‹“å±•"></a>eslint æ‹“å±•</h3><p>è¯¥æ‹“å±•æœ¬èº«ä¸å¸¦ä»»ä½•æ’ä»¶ï¼Œå½“å‰é¡¹ç›®è¦ä½¿ç”¨è¯¥æ‹“å±•ï¼Œéœ€è¦å®‰è£…ç›¸åº”çš„npmåŒ…ï¼ˆå…¨å±€å®‰è£…æˆ–å½“å‰é¡¹ç›®å®‰è£…ï¼‰</p>
<p>å¯¹äº vue é¡¹ç›®ï¼Œé€šå¸¸åœ¨ vscode ä¸­åšå¦‚ä¸‹è®¾ç½®:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//ä¿å­˜æ—¶è‡ªåŠ¨ä¿®å¤ä»£ç </span></span><br><span class="line"><span class="string">"eslint.autoFixOnSave"</span>: <span class="literal">true</span>,</span><br><span class="line"><span class="string">"eslint.options"</span>: &#123;</span><br><span class="line">    <span class="comment">// åº”æ£€æŸ¥ä»£ç çš„æ–‡ä»¶æ‰©å±•åæ•°ç»„</span></span><br><span class="line">    <span class="string">"extensions"</span>: [</span><br><span class="line">        <span class="string">".js"</span>,</span><br><span class="line">        <span class="string">".vue"</span></span><br><span class="line">    ]</span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">// é…ç½®è¦éªŒè¯çš„è¯­è¨€æ ‡è¯†å’Œè‡ªåŠ¨ä¿®å¤é€‰é¡¹ï¼Œæ¯”å‰é¢ä¸¤ä¸ªé…ç½®çš„ç»“åˆæ›´ä¸ºç»†ç²’åº¦è¯ã€‚å¯ä»¥ä»…é…ç½®ä¸‹é¢ä»£ç </span></span><br><span class="line"><span class="string">"eslint.validate"</span>: [</span><br><span class="line">    <span class="string">"javascript"</span>,</span><br><span class="line">    <span class="string">"javascriptreact"</span>,</span><br><span class="line">    <span class="string">"html"</span>,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">"language"</span>: <span class="string">"vue"</span>,</span><br><span class="line">        <span class="string">"autoFix"</span>: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">],</span><br></pre></td></tr></table></figure>




<h3 id="vetur-æ‹“å±•"><a href="#vetur-æ‹“å±•" class="headerlink" title="vetur æ‹“å±•"></a>vetur æ‹“å±•</h3><p>vue å·¥å…·ï¼Œä¸»è¦æœ‰ä»¥ä¸‹åŠŸèƒ½</p>
<ul>
<li>Syntax-highlighting è¯­æ³•é«˜äº®</li>
<li>Snippet å¿«é€Ÿå®šä¹‰è„šæ‰‹æ¶ä»£ç ç‰‡æ®µï¼Œå¦‚ï¼šå†™scriptåä¼šè·³å‡º<code>export default{xxx}</code>,style åé¢ä¼šå¸¦langã€scopeç­‰</li>
<li>Emmet ä»¿cssé€‰æ‹©å™¨å¿«é€Ÿç”Ÿæˆ html/css ä»£ç </li>
<li>Linting / Error Checking veturçš„ Linting ä»…ç”¨äºå¿«é€Ÿå¯åŠ¨ï¼Œå¯¹äºè§„åˆ™é…ç½®éœ€è¦ç”¨<code>eslint.validate</code><blockquote>
<p>Linting ä¸å¯é…ç½®ï¼Œä¸”è‡ªå¸¦äº†ä¸€ä¸ªå›ºå®šç‰ˆæœ¬çš„<code>eslint-plugin-vue</code>ï¼Œä¸€èˆ¬æˆ‘ä»¬ä¸ç”¨ã€‚è€Œæ˜¯é‡‡ç”¨ä»¥ä¸‹é…ç½®ï¼š</p>
</blockquote>
<ol>
<li>vscodeä¸­è®¾ç½®<code>&quot;vetur.validation.template&quot;: false</code></li>
<li>å®‰è£…ESlintæ‹“å±•ï¼Œé”™è¯¯å¤„ç†å°†èµ°eslint</li>
<li>é¡¹ç›®ä¸­å®‰è£…<code>npm i -D eslint eslint-plugin-vue</code>æ’ä»¶</li>
<li>åœ¨<code>.eslintrc.*</code>è®¾ç½®eslintè§„åˆ™,åé¢ä¼šä»‹ç»eslintrcç›¸å…³é…ç½®</li>
</ol>
</li>
<li>Formatting å³å³é”®çš„<code>Format Document</code>åŠŸèƒ½ï¼Œä¸æ”¯æŒæ ¼å¼åŒ–é€‰ä¸­å†…å®¹ã€‚<blockquote>
<p>å¯ä»¥åœ¨è®¾ç½®ä¸­é…ç½®<code>vetur.format.defaultFormatter</code> <br>å¦‚ï¼šé»˜è®¤<code>&quot;vetur.format.defaultFormatter.html&quot;: &quot;prettyhtml&quot;</code>,ä¹Ÿå¯å°†å€¼è®¾ä¸º none å°±ä¸ä¼šæ ¼å¼åŒ–è¯¥ç±»æ–‡ä»¶äº† <br>è¿™ä¸ªé»˜è®¤è®¾ç½®éå¸¸éš¾ç”¨ï¼Œä¼šå°†vueæ–‡ä»¶å˜å¾—å¾ˆä¹±ï¼Œæ¯”å¦‚é»˜è®¤åŠ åˆ†å·ï¼Œå±æ€§æŒ‰åˆ—å±•å¼€ï¼›æˆ‘ä»¬åœ¨è®¾ç½®ä¸­è¿›è¡Œå¦‚ä¸‹é…ç½®å³å¯å®ç°æ ¼å¼åŒ–vueæ–‡ä»¶æ—¶æŒ‰eslintçš„è§„åˆ™æ¥</p>
</blockquote>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">"vetur.format.defaultFormatterOptions": &#123;</span><br><span class="line">      "js-beautify-html": &#123;</span><br><span class="line">          <span class="comment">// å±æ€§åˆ—å¤ªé•¿æ‰æŠ˜è¡Œ,é»˜è®¤çš„force-expand-multilineä¸ç¾è§‚</span></span><br><span class="line">          "wrap_attributes": "auto"</span><br><span class="line">      &#125;,</span><br><span class="line">      "prettier": &#123;</span><br><span class="line">        <span class="comment">//å»æ‰ä»£ç ç»“å°¾åˆ†å·</span></span><br><span class="line">        "semi": false,</span><br><span class="line">        <span class="comment">//ä½¿ç”¨eslintçš„ä»£ç æ ¼å¼è¿›è¡Œæ ¡éªŒ</span></span><br><span class="line">        "eslintIntegration": true,</span><br><span class="line">        <span class="comment">//é‡‡ç”¨å•å¼•å·</span></span><br><span class="line">        "singleQuote": true</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//æ ¼å¼åŒ–.vueä¸­htmlï¼Œjs</span></span><br><span class="line">  "vetur.format.defaultFormatter.html": "js-beautify-html",</span><br><span class="line">  "vetur.format.defaultFormatter.js": "vscode-typescript",</span><br><span class="line">  <span class="comment">//è®©å‡½æ•°(å)å’Œåé¢çš„æ‹¬å·ä¹‹é—´åŠ ä¸ªç©ºæ ¼</span></span><br><span class="line">  "javascript.format.insertSpaceBeforeFunctionParenthesis": true,</span><br></pre></td></tr></table></figure></li>
<li>IntelliSense æ™ºèƒ½æ„ŸçŸ¥vueæ–‡ä»¶ç»“æ„,æ¯”å¦‚<code>&lt;template&gt;</code>ä¸­æä¾›äº†htmlæ ‡ç­¾å’Œå±æ€§çš„æ„ŸçŸ¥ï¼Œå½“ç¼–è¾‘<code>&lt;template&gt;</code>æ—¶å¦‚åŒç¼–è¾‘htmlæ–‡ä»¶ä¸€æ ·ï¼Œè®©å…¶ä»–æ’ä»¶å¯ä»¥å¦‚htmlæ”¯æŒä¸€æ ·è¿›è¡Œæ”¯æŒ<code>&lt;template&gt;</code></li>
<li>Debugging è°ƒè¯•åŠŸèƒ½</li>
<li>Framework Support for Element UI and Onsen UI UIæ¡†æ¶æ”¯æŒ</li>
</ul>
<p>å¦‚æœæƒ³ä½¿ç”¨<code>Format Selection</code>åŠŸèƒ½ï¼Œéœ€è¦å†ä¸‹è½½<code>prettier-Code formatter</code>æ‹“å±•ã€‚</p>
<p>ä½†åªè¦é…ç½®åˆç†ï¼Œå…¨æ–‡æ ¼å¼åŒ–æœªå°ä¸å¯</p>
<h2 id="eslintrc-é…ç½®"><a href="#eslintrc-é…ç½®" class="headerlink" title="eslintrc é…ç½®"></a>eslintrc é…ç½®</h2><p>å®‰è£…å®Œä¸Šæ–‡ä¸¤ä¸ªæ‹“å±•å’Œè¿›è¡Œç›¸åº”é…ç½®åï¼Œè¿˜éœ€è¦ å¯¹<code>.eslintrc.js</code> è¿›è¡Œé…ç½®ã€‚æ–‡ä»¶ä¸å­˜åœ¨æˆ–é…ç½®ä¸å½“ï¼Œç¼–ç æ—¶ä¸ä¼šè¿›è¡Œé”™è¯¯æç¤º</p>
<p>è‹¥ä½¿ç”¨<code>@vue/cli</code> åˆå§‹åŒ–é¡¹ç›®å¹¶é€‰æ‹©æ”¯æŒeslintï¼Œåˆ™é»˜è®¤ç”Ÿæˆæ—¶å°±å­˜åœ¨äº†ã€‚</p>
<p>å¦åˆ™éœ€è¦æ‰‹åŠ¨ç”Ÿæˆï¼š</p>
<p>è¯¦è§<a href="https://eslint.vuejs.org/user-guide/#installation" target="_blank" rel="noopener">Installation</a></p>
<p>###ã€€.eslintrc.js</p>
<p>æ—©æœŸçš„ä¸€ä¸ªé…ç½®</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// http://eslint.org/docs/user-guide/configuring</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  root: <span class="literal">true</span>,</span><br><span class="line">  parser: <span class="string">'babel-eslint'</span>,</span><br><span class="line">  parserOptions: &#123;</span><br><span class="line">    sourceType: <span class="string">'module'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  env: &#123;</span><br><span class="line">    browser: <span class="literal">true</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// https://github.com/feross/standard/blob/master/RULES.md#javascript-standard-style</span></span><br><span class="line">  extends: <span class="string">'standard'</span>,</span><br><span class="line">  <span class="comment">// required to lint *.vue files</span></span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="string">'html'</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="comment">// add your custom rules here</span></span><br><span class="line">  <span class="string">'rules'</span>: &#123;</span><br><span class="line">    <span class="comment">// allow paren-less arrow functions</span></span><br><span class="line">    <span class="string">'arrow-parens'</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="comment">// allow async-await</span></span><br><span class="line">    <span class="string">'generator-star-spacing'</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="comment">// allow debugger during development</span></span><br><span class="line">    <span class="string">'no-debugger'</span>: process.env.NODE_ENV === <span class="string">'production'</span> ? <span class="number">2</span> : <span class="number">0</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>å½“å‰é…ç½®ï¼ˆä¸»æµï¼‰</strong>ï¼šextendsé…ç½®vueæ ¡éªŒè§„åˆ™ï¼Œparserç§»è‡³parserOptionsä¸‹ï¼Œpluginsä¸­é…ç½®ä¸ºvue</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// http://eslint.org/docs/user-guide/configuring</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  root: <span class="literal">true</span>,</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// parser: 'babel-eslint',</span></span><br><span class="line">  parserOptions: &#123;</span><br><span class="line">    sourceType: <span class="string">'module'</span>,</span><br><span class="line">    parser: <span class="string">'babel-eslint'</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  env: &#123;</span><br><span class="line">    browser: <span class="literal">true</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// https://github.com/feross/standard/blob/master/RULES.md#javascript-standard-style</span></span><br><span class="line">  extends: [</span><br><span class="line">    <span class="comment">// æŒ‰ä»ä¸Šå¾€ä¸‹çš„è§„åˆ™åŒ¹é…</span></span><br><span class="line">    <span class="comment">//æ¨èæ ¡éªŒ</span></span><br><span class="line">    <span class="string">"plugin:vue/recommended"</span>,</span><br><span class="line">    <span class="comment">//åŸºæœ¬æ ¡éªŒ</span></span><br><span class="line">    <span class="comment">//"plugin:vue/essential",</span></span><br><span class="line">    <span class="string">"standard"</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="comment">// required to lint *.vue files</span></span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="string">'vue'</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="comment">// add your custom rules here</span></span><br><span class="line">  <span class="string">'rules'</span>: &#123;</span><br><span class="line">    <span class="comment">// allow paren-less arrow functions</span></span><br><span class="line">    <span class="string">'arrow-parens'</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="comment">// allow async-await</span></span><br><span class="line">    <span class="string">'generator-star-spacing'</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="comment">// allow debugger during development</span></span><br><span class="line">    <span class="string">'no-debugger'</span>: process.env.NODE_ENV === <span class="string">'production'</span> ? <span class="number">2</span> : <span class="number">0</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>plugin:vue/recommended</code> ä¸‹ wrap_attributes çš„è§„åˆ™æ˜¯force-expand-multiline</p>
<p>å³æŒ‰ä¸Šè¿°é…ç½®ï¼Œæ ¼å¼åŒ–æ–‡æ¡£æ—¶ï¼Œå±æ€§ä¼šå˜æˆä¸€åˆ—ï¼ˆautoï¼‰ï¼Œä½†ä¿å­˜æ—¶çš„eslint çš„autoFixä¼šæŒ‰ force-expand-multiline å¤šè¡Œå±•å¼€ã€‚</p>
<p>è§‰å¾—éº»çƒ¦çš„ï¼Œå¯ä»¥é…ç½®ä¸º<code>plugin:vue/essential</code> </p>
<h2 id="é…ç½®åˆ†äº«"><a href="#é…ç½®åˆ†äº«" class="headerlink" title="é…ç½®åˆ†äº«"></a>é…ç½®åˆ†äº«</h2><p><strong>settings.json</strong></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å°†è®¾ç½®æ”¾å…¥æ­¤æ–‡ä»¶ä¸­ä»¥è¦†ç›–é»˜è®¤è®¾ç½®</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"editor.fontSize"</span>: <span class="number">12</span>,</span><br><span class="line">    <span class="attr">"editor.tabSize"</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="attr">"files.associations"</span>: &#123;</span><br><span class="line">        <span class="attr">"*.vue"</span>: <span class="string">"vue"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"eslint.autoFixOnSave"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"eslint.options"</span>: &#123;</span><br><span class="line">        <span class="attr">"extensions"</span>: [</span><br><span class="line">            <span class="string">".js"</span>,</span><br><span class="line">            <span class="string">".vue"</span></span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"eslint.validate"</span>: [</span><br><span class="line">        <span class="string">"javascript"</span>,</span><br><span class="line">        <span class="string">"javascriptreact"</span>,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"language"</span>: <span class="string">"html"</span>,</span><br><span class="line">            <span class="attr">"autoFix"</span>: <span class="literal">true</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"language"</span>: <span class="string">"vue"</span>,</span><br><span class="line">            <span class="attr">"autoFix"</span>: <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">"vetur.validation.template"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"vetur.format.defaultFormatterOptions"</span>: &#123;</span><br><span class="line">        <span class="attr">"js-beautify-html"</span>: &#123;</span><br><span class="line">            <span class="comment">// å±æ€§åˆ—å¤ªé•¿æ‰æŠ˜è¡Œ,é»˜è®¤çš„force-expand-multilineä¸ç¾è§‚</span></span><br><span class="line">            <span class="attr">"wrap_attributes"</span>: <span class="string">"auto"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"prettier"</span>: &#123;</span><br><span class="line">          <span class="comment">//å»æ‰ä»£ç ç»“å°¾åˆ†å·</span></span><br><span class="line">          <span class="attr">"semi"</span>: <span class="literal">false</span>,</span><br><span class="line">          <span class="comment">//ä½¿ç”¨eslintçš„ä»£ç æ ¼å¼è¿›è¡Œæ ¡éªŒ</span></span><br><span class="line">          <span class="attr">"eslintIntegration"</span>: <span class="literal">true</span>,</span><br><span class="line">          <span class="comment">//é‡‡ç”¨å•å¼•å·</span></span><br><span class="line">          <span class="attr">"singleQuote"</span>: <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//æ ¼å¼åŒ–.vueä¸­htmlï¼Œjs</span></span><br><span class="line">    <span class="attr">"vetur.format.defaultFormatter.html"</span>: <span class="string">"js-beautify-html"</span>,</span><br><span class="line">    <span class="attr">"vetur.format.defaultFormatter.js"</span>: <span class="string">"vscode-typescript"</span>,</span><br><span class="line">    <span class="comment">//è®©å‡½æ•°(å)å’Œåé¢çš„æ‹¬å·ä¹‹é—´åŠ ä¸ªç©ºæ ¼</span></span><br><span class="line">    <span class="attr">"javascript.format.insertSpaceBeforeFunctionParenthesis"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"search.exclude"</span>: &#123;</span><br><span class="line">        <span class="attr">"**/Node_modules"</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"**/bower_components"</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"**/dist"</span>: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"git.confirmSync"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"window.zoomLevel"</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">"editor.renderWhitespace"</span>: <span class="string">"boundary"</span>,</span><br><span class="line">    <span class="attr">"editor.cursorBlinking"</span>: <span class="string">"smooth"</span>,</span><br><span class="line">    <span class="attr">"editor.minimap.enabled"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"editor.minimap.renderCharacters"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"editor.fontFamily"</span>: <span class="string">"'Droid Sans Mono', 'Courier New', monospace, 'Droid Sans Fallback'"</span>,</span><br><span class="line">    <span class="attr">"window.title"</span>: <span class="string">"$&#123;dirty&#125;$&#123;activeEditorMedium&#125;$&#123;separator&#125;$&#123;rootName&#125;"</span>,</span><br><span class="line">    <span class="attr">"editor.codeLens"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"editor.snippetSuggestions"</span>: <span class="string">"top"</span>,</span><br><span class="line">    <span class="attr">"workbench.colorTheme"</span>: <span class="string">"Solarized Light"</span>,</span><br><span class="line">    <span class="attr">"extensions.ignoreRecommendations"</span>: <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>##ã€€å‚è€ƒ ï¼š </p>
<ol>
<li>eslint-plugin-vueï¼š <a href="https://eslint.vuejs.org/user-guide/" target="_blank" rel="noopener">https://eslint.vuejs.org/user-guide/</a></li>
</ol>
]]></content>
      <categories>
        <category>å¤§å‰ç«¯</category>
      </categories>
      <tags>
        <tag>VSCode</tag>
      </tags>
  </entry>
  <entry>
    <title>å¦‚ä½•å‡å°‘é¢„æ£€è¯·æ±‚OPTIONS</title>
    <url>/2018/12/16/2018Q4/%E5%A6%82%E4%BD%95%E5%87%8F%E5%B0%91%E9%A2%84%E6%A3%80%E8%AF%B7%E6%B1%82OPTIONS/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å…ˆè¯´ç»“è®ºï¼Œåªèƒ½å°†å¤æ‚è¯·æ±‚æ”¹é€ ä¸ºç®€å•è¯·æ±‚</p>
<p>å¸¸è§çš„åšæ³•æ˜¯ï¼š</p>
<ol>
<li>tokenæ”¾åŸç”Ÿçš„è¯·æ±‚å¤´ï¼šAuthorization </li>
<li>Content-Type æ”¹ä¸ºtext/plain ç„¶ååç«¯ç»Ÿä¸€å¤„ç†</li>
</ol>
<a id="more"></a>

<p>è‹¥æ— æ³•ä¿®æ”¹è¯·æ±‚ï¼Œé‚£ä¹ˆå¯ä»¥è®¾ç½® <code>Access-Control-Max-Age</code> å“åº”</p>
<p>æ¯ä¸ªurlçš„OPTIONSéƒ½æœ‰ä¸€ä¸ªç”Ÿå‘½å‘¨æœŸï¼Œåœ¨è¯¥æ—¶é—´å†…ä¸ä¼šå†æ¬¡å‘ç”Ÿã€‚chromeé»˜è®¤æ˜¯5s</p>
<p>æ•…æˆ‘ä»¬å¯ä»¥é€šè¿‡è®¾ç½®<code>Access-Control-Max-Age</code>æ¥æé«˜å‘¨æœŸä¸Šé™ã€‚ä¸è¿‡æ¯ä¸ªæµè§ˆå™¨ä¹Ÿæ˜¯æœ‰ä¸Šé™çš„ï¼Œæ¯”å¦‚chromeä¸Šé™æ˜¯10minã€‚</p>
<p>æ•…æ­¤ï¼Œåœ¨10minå†… å¯¹äº <strong>åŒä¸€è¯·æ±‚ï¼ˆå®Œæ•´urlç›¸åŒ,å‚æ•°ä¸åŒä¹Ÿè§†ä¸ºä¸åŒurlï¼‰</strong> ä¸ä¼šå†å‘ç¬¬äºŒæ¬¡OPTIONSã€‚</p>
<p>æ³¨æ„ï¼šè‹¥è®¾ç½®äº† <code>disable-cache</code> é‚£ä¹ˆæ¯æ¬¡å¤æ‚è¯·æ±‚éƒ½ä¼šå‘OPTIONS</p>
<h2 id="åè®°"><a href="#åè®°" class="headerlink" title="åè®°"></a>åè®°</h2><p>å†™è¿™ç¯‡åšå®¢çš„èƒŒæ™¯æ˜¯åŸæ¥æœ‰ä¸ªé¡¹ç›®çš„å‰åç«¯åˆ†ç¦»åšçš„ä¸å¯¹</p>
<p>å‰ç«¯èµ„æº(åŒ…æ‹¬index.html)å•ç‹¬ä¸€å°æœåŠ¡å™¨ï¼Œç„¶åè®¿é—®å…¶ä»–æœåŠ¡å™¨çš„æ¥å£</p>
<p>å®é™…è¿™ç§åº”è¯¥åœ¨å‰ç«¯æœåŠ¡å™¨è¿™è¾¹åšä¸ªè½¬å‘ï¼Œé¿å…è·¨åŸŸã€‚æˆ–è€… index.html æ”¾åœ¨åç«¯æœåŠ¡å™¨ï¼Œå…¶ä»–èµ„æºæ”¾å‰ç«¯æœåŠ¡å™¨ï¼Œæ²¡æœ‰è·¨åŸŸé—®é¢˜</p>
]]></content>
      <categories>
        <category>å¤§å‰ç«¯</category>
      </categories>
      <tags>
        <tag>HTTP</tag>
        <tag>è·¨åŸŸ</tag>
      </tags>
  </entry>
  <entry>
    <title>Angular1.xå­¦ä¹ </title>
    <url>/2018/11/10/2018Q4/Angular1.x%E5%AD%A6%E4%B9%A0/</url>
    <content><![CDATA[<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>ng-app æŒ‡ä»¤å‘Šè¯‰ AngularJSï¼Œ<code>&lt;div&gt;</code> å…ƒç´ æ˜¯ AngularJS åº”ç”¨ç¨‹åº çš„â€æ‰€æœ‰è€…â€ã€‚</p>
<a id="more"></a>

<p>ng-model æŒ‡ä»¤æŠŠè¾“å…¥åŸŸçš„å€¼ç»‘å®šåˆ°åº”ç”¨ç¨‹åºå˜é‡ nameã€‚</p>
<p>ng-bind æŒ‡ä»¤æŠŠåº”ç”¨ç¨‹åºå˜é‡ name ç»‘å®šåˆ°æŸä¸ªæ®µè½çš„ innerHTMLã€‚</p>
<p>ng-init æŒ‡ä»¤åˆå§‹åŒ– AngularJS åº”ç”¨ç¨‹åºå˜é‡ã€‚ <strong>ä¸€èˆ¬ä¸ç”¨ã€‚ä½¿ç”¨æ§åˆ¶å™¨å»åˆå§‹åŒ–</strong></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-app</span>=<span class="string">""</span> <span class="attr">ng-init</span>=<span class="string">"firstName='John'"</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>å§“åä¸º <span class="tag">&lt;<span class="name">span</span> <span class="attr">ng-bind</span>=<span class="string">"firstName"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>AngularJS æ¨¡å—å®šä¹‰åº”ç”¨:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> app = angular.module(<span class="string">'myApp'</span>, []);</span><br></pre></td></tr></table></figure>
<p>AngularJS æ§åˆ¶å™¨æ§åˆ¶åº”ç”¨:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">app.controller(<span class="string">'myCtrl'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">$scope</span>) </span>&#123;</span><br><span class="line">    $scope.firstName= <span class="string">"John"</span>;</span><br><span class="line">    $scope.lastName= <span class="string">"Doe"</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="æŒ‡ä»¤"><a href="#æŒ‡ä»¤" class="headerlink" title="æŒ‡ä»¤"></a>æŒ‡ä»¤</h2><p>é™¤äº†ä¸Šé¢è®²çš„å¤–ï¼Œå¸¸è§çš„è¿˜æœ‰ï¼š</p>
<ol>
<li>ng-show æ§åˆ¶å…ƒç´ çš„disableå€¼è¾¾åˆ°æ˜¾ç¤ºä¸éšè—</li>
<li>ng-repeat æŒ‡ä»¤ä¼šé‡å¤ä¸€ä¸ª HTML å…ƒç´ ï¼š<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">ng-repeat</span>=<span class="string">"x in names"</span>&gt;</span></span><br><span class="line">  &#123;&#123; x &#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="è‡ªå®šä¹‰æŒ‡ä»¤-directive"><a href="#è‡ªå®šä¹‰æŒ‡ä»¤-directive" class="headerlink" title="è‡ªå®šä¹‰æŒ‡ä»¤ directive"></a>è‡ªå®šä¹‰æŒ‡ä»¤ directive</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">ng-app</span>=<span class="string">"myApp"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">runoob-directive</span>&gt;</span><span class="tag">&lt;/<span class="name">runoob-directive</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="actionscript"><span class="keyword">var</span> app = angular.module(<span class="string">"myApp"</span>, []);</span></span><br><span class="line"><span class="actionscript">app.directive(<span class="string">"runoobDirective"</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="handlebars"><span class="xml">        template : "<span class="tag">&lt;<span class="name">h1</span>&gt;</span>è‡ªå®šä¹‰æŒ‡ä»¤!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span>"</span></span></span><br><span class="line">    &#125;;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>ä½¿ç”¨é©¼å³°æ³•æ¥å‘½åä¸€ä¸ªæŒ‡ä»¤ï¼Œ runoobDirective, ä½†åœ¨ä½¿ç”¨å®ƒæ—¶éœ€è¦ä»¥ - åˆ†å‰², runoob-directive:</p>
</blockquote>
<p>è¿˜å¯ä»¥ç”¨ä»¥ä¸‹æ–¹å¼å»è°ƒç”¨è¯¥æŒ‡ä»¤</p>
<ol>
<li>å±æ€§<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">runoob-directive</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>ç±»å<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"runoob-directive"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="actionscript"><span class="keyword">var</span> app = angular.module(<span class="string">"myApp"</span>, []);</span></span><br><span class="line"><span class="actionscript">app.directive(<span class="string">"runoobDirective"</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="actionscript">        restrict : <span class="string">"C"</span>,</span></span><br><span class="line"><span class="handlebars"><span class="xml">        template : "<span class="tag">&lt;<span class="name">h1</span>&gt;</span>è‡ªå®šä¹‰æŒ‡ä»¤!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span>"</span></span></span><br><span class="line">    &#125;;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">strong</span>&gt;</span>æ³¨æ„ï¼š<span class="tag">&lt;/<span class="name">strong</span>&gt;</span> ä½ å¿…é¡»è®¾ç½® <span class="tag">&lt;<span class="name">b</span>&gt;</span>restrict<span class="tag">&lt;/<span class="name">b</span>&gt;</span> çš„å€¼ä¸º "C" æ‰èƒ½é€šè¿‡ç±»åæ¥è°ƒç”¨æŒ‡ä»¤ã€‚<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>æ³¨é‡Š<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">ng-app</span>=<span class="string">"myApp"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- directive: runoob-directive --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="actionscript"><span class="keyword">var</span> app = angular.module(<span class="string">"myApp"</span>, []);</span></span><br><span class="line"><span class="actionscript">app.directive(<span class="string">"runoobDirective"</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="actionscript">        restrict : <span class="string">"M"</span>,</span></span><br><span class="line"><span class="actionscript">        replace : <span class="literal">true</span>,</span></span><br><span class="line"><span class="handlebars"><span class="xml">        template : "<span class="tag">&lt;<span class="name">h1</span>&gt;</span>è‡ªå®šä¹‰æŒ‡ä»¤!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span>"</span></span></span><br><span class="line">    &#125;;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">strong</span>&gt;</span>æ³¨æ„ï¼š<span class="tag">&lt;/<span class="name">strong</span>&gt;</span> æˆ‘ä»¬éœ€è¦åœ¨è¯¥å®ä¾‹æ·»åŠ  <span class="tag">&lt;<span class="name">strong</span>&gt;</span>replace<span class="tag">&lt;/<span class="name">strong</span>&gt;</span> å±æ€§ï¼Œ å¦åˆ™è¯„è®ºæ˜¯ä¸å¯è§çš„ã€‚<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">strong</span>&gt;</span>æ³¨æ„ï¼š<span class="tag">&lt;/<span class="name">strong</span>&gt;</span> ä½ å¿…é¡»è®¾ç½® <span class="tag">&lt;<span class="name">b</span>&gt;</span>restrict<span class="tag">&lt;/<span class="name">b</span>&gt;</span> çš„å€¼ä¸º "M" æ‰èƒ½é€šè¿‡æ³¨é‡Šæ¥è°ƒç”¨æŒ‡ä»¤ã€‚<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>restrict å€¼å¯ä»¥æ˜¯ä»¥ä¸‹å‡ ç§:</p>
<ol>
<li>E ä½œä¸ºå…ƒç´ åä½¿ç”¨</li>
<li>A ä½œä¸ºå±æ€§ä½¿ç”¨</li>
<li>C ä½œä¸ºç±»åä½¿ç”¨</li>
<li>M ä½œä¸ºæ³¨é‡Šä½¿ç”¨</li>
</ol>
<blockquote>
<p>restrict é»˜è®¤å€¼ä¸º EA, å³å¯ä»¥é€šè¿‡å…ƒç´ åå’Œå±æ€§åæ¥è°ƒç”¨æŒ‡ä»¤ã€‚</p>
</blockquote>
<h2 id="æ¨¡å‹-ng-model"><a href="#æ¨¡å‹-ng-model" class="headerlink" title="æ¨¡å‹ ng-model"></a>æ¨¡å‹ ng-model</h2><p>é™¤äº†ä¸Šè¿°è¯´çš„ï¼Œè¿˜æœ‰ä»¥ä¸‹éœ€è¦äº†è§£ï¼š</p>
<h3 id="åº”ç”¨çŠ¶æ€"><a href="#åº”ç”¨çŠ¶æ€" class="headerlink" title="åº”ç”¨çŠ¶æ€"></a>åº”ç”¨çŠ¶æ€</h3><p>ng-model æŒ‡ä»¤å¯ä»¥ä¸ºåº”ç”¨æ•°æ®æä¾›çŠ¶æ€å€¼(invalid, dirty, touched, error):</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">ng-app</span>=<span class="string">""</span> <span class="attr">name</span>=<span class="string">"myForm"</span> <span class="attr">ng-init</span>=<span class="string">"myText = 'test@runoob.com'"</span>&gt;</span></span><br><span class="line">    Email:</span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"email"</span> <span class="attr">name</span>=<span class="string">"myAddress"</span> <span class="attr">ng-model</span>=<span class="string">"myText"</span> <span class="attr">required</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>ç¼–è¾‘é‚®ç®±åœ°å€ï¼ŒæŸ¥çœ‹çŠ¶æ€çš„æ”¹å˜ã€‚<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>çŠ¶æ€<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Valid: &#123;&#123;myForm.myAddress.$valid&#125;&#125; (å¦‚æœè¾“å…¥çš„å€¼æ˜¯åˆæ³•çš„åˆ™ä¸º true)ã€‚<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Dirty: &#123;&#123;myForm.myAddress.$dirty&#125;&#125; (å¦‚æœå€¼æ”¹å˜åˆ™ä¸º true)ã€‚<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Touched: &#123;&#123;myForm.myAddress.$touched&#125;&#125; (å¦‚æœé€šè¿‡è§¦å±ç‚¹å‡»åˆ™ä¸º true)ã€‚<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="CSSç±»"><a href="#CSSç±»" class="headerlink" title="CSSç±»"></a>CSSç±»</h3><p>åŸºäºçŠ¶æ€ä¸ºhtmlå…ƒç´ æä¾›äº†cssç±»</p>
<p>ä¸¾ä¾‹ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="css"><span class="selector-tag">input</span><span class="selector-class">.ng-dirty</span> &#123;</span></span><br><span class="line">    background-color: lightblue;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">ng-app</span>=<span class="string">""</span> <span class="attr">name</span>=<span class="string">"myForm"</span>&gt;</span></span><br><span class="line">    è¾“å…¥ä½ çš„åå­—:</span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"myName"</span> <span class="attr">ng-model</span>=<span class="string">"myText"</span> <span class="attr">required</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>å½“inputçš„å€¼æ”¹å˜æ—¶ï¼Œåº”ç”¨äº†<code>input.ng-dirty</code> çš„æ ·å¼</p>
<p>æœ‰ä»¥ä¸‹cssç±»ï¼š</p>
<ol>
<li>ng-valid: éªŒè¯é€šè¿‡</li>
<li>ng-invalid: éªŒè¯å¤±è´¥</li>
<li>ng-valid-[key]: ç”±$setValidityæ·»åŠ çš„æ‰€æœ‰éªŒè¯é€šè¿‡çš„å€¼</li>
<li>ng-invalid-[key]: ç”±$setValidityæ·»åŠ çš„æ‰€æœ‰éªŒè¯å¤±è´¥çš„å€¼</li>
<li>ng-pristine: æ§ä»¶ä¸ºåˆå§‹çŠ¶æ€</li>
<li>ng-dirty: æ§ä»¶è¾“å…¥å€¼å·²å˜æ›´</li>
<li>ng-touched: æ§ä»¶å·²å¤±å»ç„¦ç‚¹</li>
<li>ng-untouched: æ§ä»¶æœªå¤±å»ç„¦ç‚¹</li>
<li>ng-pending: ä»»ä½•ä¸ºæ»¡è¶³$asyncValidatorsçš„æƒ…å†µ</li>
</ol>
<h2 id="ä½œç”¨åŸŸ-scope"><a href="#ä½œç”¨åŸŸ-scope" class="headerlink" title="ä½œç”¨åŸŸ scope"></a>ä½œç”¨åŸŸ scope</h2><p>AngularJS åº”ç”¨ç»„æˆå¦‚ä¸‹ï¼š</p>
<ul>
<li>View(è§†å›¾), å³ HTMLã€‚</li>
<li>Model(æ¨¡å‹), å½“å‰è§†å›¾ä¸­å¯ç”¨çš„æ•°æ®ã€‚</li>
<li>Controller(æ§åˆ¶å™¨), å³ JavaScript å‡½æ•°ï¼Œå¯ä»¥æ·»åŠ æˆ–ä¿®æ”¹å±æ€§ã€‚</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-app</span>=<span class="string">"myApp"</span> <span class="attr">ng-controller</span>=<span class="string">"myCtrl"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">ng-model</span>=<span class="string">"name"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;&#123;greeting&#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">ng-click</span>=<span class="string">'sayHello()'</span>&gt;</span>ç‚¹æˆ‘<span class="tag">&lt;/<span class="name">button</span>&gt;</span>    </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="actionscript"><span class="keyword">var</span> app = angular.module(<span class="string">'myApp'</span>, []);</span></span><br><span class="line"><span class="actionscript">app.controller(<span class="string">'myCtrl'</span>, <span class="function"><span class="keyword">function</span><span class="params">($scope)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">    $scope.name = <span class="string">"Runoob"</span>;</span></span><br><span class="line"><span class="actionscript">    $scope.sayHello = <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">        $scope.greeting = <span class="string">'Hello '</span> + $scope.name + <span class="string">'!'</span>;</span></span><br><span class="line">    &#125;;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œscopeçš„ä½œç”¨åŸŸåœ¨ æ•´ä¸ªdivä¸­éƒ½å¯ä»¥ç”¨ï¼Œå¦‚æœæ”¹æˆä»¥ä¸‹ï¼Œ</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-app</span>=<span class="string">"myApp"</span> &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">ng-model</span>=<span class="string">"name"</span> <span class="attr">ng-controller</span>=<span class="string">"myCtrl"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;&#123;name&#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="actionscript"><span class="keyword">var</span> app = angular.module(<span class="string">'myApp'</span>, []);</span></span><br><span class="line"><span class="actionscript">app.controller(<span class="string">'myCtrl'</span>, <span class="function"><span class="keyword">function</span><span class="params">($scope)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">    $scope.name = <span class="string">"Runoob"</span>;</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>&lt;h1&gt;&lt;/h1&gt;</code> ä¸åœ¨ myCtrl çš„ä½œç”¨åŸŸä¸‹ï¼Œæ‰€ä»¥æ‹¿ä¸åˆ°å€¼</p>
<h3 id="æ ¹ä½œç”¨åŸŸ-rootScope"><a href="#æ ¹ä½œç”¨åŸŸ-rootScope" class="headerlink" title="æ ¹ä½œç”¨åŸŸ rootScope"></a>æ ¹ä½œç”¨åŸŸ rootScope</h3><p>rootscope å®šä¹‰çš„å€¼ï¼Œå¯ä»¥åœ¨å„ä¸ª controller ä¸­ä½¿ç”¨ã€‚</p>
<p>å‚æ•°çš„ä½ç½®éšæ„ ä½†æ˜¯å‚æ•°å‘½åä¸€å®šè¦æ˜¯<code>$rootscope</code></p>
<p>ä¸Šé¢çš„ä¾‹å­ä¿®æ”¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-app</span>=<span class="string">"myApp"</span> &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">ng-model</span>=<span class="string">"name"</span> <span class="attr">ng-controller</span>=<span class="string">"myCtrl"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;&#123;name&#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="actionscript"><span class="keyword">var</span> app = angular.module(<span class="string">'myApp'</span>, []);</span></span><br><span class="line"><span class="actionscript">app.controller(<span class="string">'myCtrl'</span>, <span class="function"><span class="keyword">function</span><span class="params">($scope,$rootScope)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">    $scope.name = <span class="string">"Runoob"</span>;</span></span><br><span class="line"><span class="actionscript">    $rootScope.name = <span class="string">"root Runoob"</span>;</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>&lt;h1&gt;&lt;/h1&gt;</code> åœ¨æ ¹ä½œç”¨åŸŸæœ‰nameçš„å€¼ï¼Œæ•…è¿™è¾¹å¯ä»¥æ˜¾ç¤º<code>root Runoob</code> ,è€ŒinputæŒ‰ç…§ä½œç”¨åŸŸä¼ é€’åŸåˆ™ï¼Œå…ˆæ‹¿åˆ°è‡ªå·±æ§åˆ¶å™¨ä½œç”¨åŸŸçš„<code>Runoob</code></p>
<blockquote>
<p>æŠŠ <code>$scope.name = &quot;Runoob&quot;;</code> æ³¨é‡Šæ‰ï¼Œinputä¸­èƒ½å–åˆ°rootScopeä¸­çš„nameå¯¹åº”çš„<code>root Runoob</code>,ä½†inputä¸­nameå€¼çš„æ›´æ–°ä¾ç„¶ä¸ä¼šå½±å“åˆ°h1ä¸­çš„name</p>
</blockquote>
<h2 id="æ§åˆ¶å™¨-controller"><a href="#æ§åˆ¶å™¨-controller" class="headerlink" title="æ§åˆ¶å™¨ controller"></a>æ§åˆ¶å™¨ controller</h2><p>ç•¥ï¼Œçœ‹ä¸Šæ–‡</p>
<h2 id="è¿‡æ»¤å™¨"><a href="#è¿‡æ»¤å™¨" class="headerlink" title="è¿‡æ»¤å™¨"></a>è¿‡æ»¤å™¨</h2><p>ç”¨äºè½¬æ¢æ•°æ®ã€‚</p>
<p>è‡ªå¸¦çš„è¿‡æ»¤å™¨æœ‰ï¼š</p>
<ul>
<li>currency æ ¼å¼åŒ–æ•°å­—ä¸ºè´§å¸æ ¼å¼ã€‚</li>
<li>filter ä»æ•°ç»„é¡¹ä¸­é€‰æ‹©ä¸€ä¸ªå­é›†ã€‚</li>
<li>lowercase æ ¼å¼åŒ–å­—ç¬¦ä¸²ä¸ºå°å†™ã€‚</li>
<li>orderBy æ ¹æ®æŸä¸ªè¡¨è¾¾å¼æ’åˆ—æ•°ç»„ã€‚</li>
<li>uppercase æ ¼å¼åŒ–å­—ç¬¦ä¸²ä¸ºå¤§å†™ã€‚</li>
</ul>
<p>åœ¨è¡¨è¾¾å¼ä¸­ä½¿ç”¨ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&#123; å˜é‡ | è¿‡æ»¤å™¨&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨è¾“å…¥ä¸­ä½¿ç”¨</p>
<p>è¿‡æ»¤å™¨åè·Ÿä¸€ä¸ªå†’å·å’Œä¸€ä¸ªæ¨¡å‹åç§°(æˆ–è€…ä¸€ä¸ªå¸¸é‡)</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-app</span>=<span class="string">"myApp"</span> <span class="attr">ng-controller</span>=<span class="string">"namesCtrl"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>è¾“å…¥è¿‡æ»¤:<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">ng-model</span>=<span class="string">"test"</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span> <span class="attr">ng-repeat</span>=<span class="string">"x in names | filter:test "</span>&gt;</span></span><br><span class="line">    &#123;&#123; (x.name | uppercase) + ', ' + x.country &#125;&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="actionscript">angular.module(<span class="string">'myApp'</span>, []).controller(<span class="string">'namesCtrl'</span>, <span class="function"><span class="keyword">function</span><span class="params">($scope)</span> </span>&#123;</span></span><br><span class="line">    $scope.names = [</span><br><span class="line"><span class="actionscript">        &#123;name:<span class="string">'Jani'</span>,country:<span class="string">'Norway'</span>&#125;,</span></span><br><span class="line"><span class="actionscript">        &#123;name:<span class="string">'Hege'</span>,country:<span class="string">'Sweden'</span>&#125;,</span></span><br><span class="line"><span class="actionscript">        &#123;name:<span class="string">'Kai'</span>,country:<span class="string">'Denmark'</span>&#125;</span></span><br><span class="line">    ];</span><br><span class="line">&#125;);</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸Šä¾‹å­å³ï¼Œå¯¹äºnamesçš„æ¯ä¸€é¡¹ï¼Œè¿‡æ»¤å‡ºæ»¡è¶³ <code>indexOf(test)&gt;=0</code>çš„é¡¹</p>
<p>å†åŠ ä¸ªorderByçš„è¿‡æ»¤å™¨ï¼š<code>&lt;li ng-repeat=&quot;x in names | filter:test | orderBy:&#39;country&#39;&quot;&gt;</code></p>
<p>åœ¨ <code>indexOf(test)&gt;=0</code>çš„å‰æä¸‹ï¼ŒæŒ‰æ¯é¡¹çš„<code>country</code>è¿›è¡Œå‡åºæ’åºï¼Œè‹¥è¦é™åºï¼Œä½¿ç”¨<code>orderBy:&#39;country&#39;:true</code></p>
<h3 id="è‡ªå®šä¹‰è¿‡æ»¤å™¨"><a href="#è‡ªå®šä¹‰è¿‡æ»¤å™¨" class="headerlink" title="è‡ªå®šä¹‰è¿‡æ»¤å™¨"></a>è‡ªå®šä¹‰è¿‡æ»¤å™¨</h3><p>è‡ªå®šä¹‰ä¸€ä¸ªè¿‡æ»¤å™¨ reverseï¼Œå°†å­—ç¬¦ä¸²åè½¬ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-app</span>=<span class="string">"myApp"</span> <span class="attr">ng-controller</span>=<span class="string">"myCtrl"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">å§“å: &#123;&#123; msg | reverse &#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="actionscript"><span class="keyword">var</span> app = angular.module(<span class="string">'myApp'</span>, []);</span></span><br><span class="line"><span class="actionscript">app.controller(<span class="string">'myCtrl'</span>, <span class="function"><span class="keyword">function</span><span class="params">($scope)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">    $scope.msg = <span class="string">"Runoob"</span>;</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="actionscript">app.filter(<span class="string">'reverse'</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123; <span class="comment">//å¯ä»¥æ³¨å…¥ä¾èµ–</span></span></span><br><span class="line"><span class="actionscript">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span><span class="params">(text)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">return</span> text.split(<span class="string">""</span>).reverse().join(<span class="string">""</span>);</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="æœåŠ¡-Service"><a href="#æœåŠ¡-Service" class="headerlink" title="æœåŠ¡ Service"></a>æœåŠ¡ Service</h2><p>æœåŠ¡æ˜¯ä¸€ä¸ªå‡½æ•°æˆ–å¯¹è±¡ï¼Œåœ¨ Angular åº”ç”¨ä¸­ä½¿ç”¨ã€‚</p>
<p>service æ˜¯å•ä¾‹å¯¹è±¡ï¼Œåœ¨åº”ç”¨ç”Ÿå‘½å‘¨æœŸç»“æŸæ‰ä¼šè¢«æ¸…é™¤</p>
<h3 id="å†…ç½®æœåŠ¡"><a href="#å†…ç½®æœåŠ¡" class="headerlink" title="å†…ç½®æœåŠ¡"></a>å†…ç½®æœåŠ¡</h3><p>ä½œä¸ºå‚æ•°ä¼ é€’åˆ° controller ä¸­å³å¯ä½¿ç”¨ï¼Œä¾‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">app.controller(<span class="string">'customersCtrl'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">$scope, $location</span>) </span>&#123;</span><br><span class="line">    $scope.myUrl = $location.absUrl();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p> Angular å¸¸ç”¨çš„å†…ç½®æœåŠ¡</p>
<ul>
<li>$location<blockquote>
<p>è¿”å›å½“å‰é¡µé¢çš„urlåœ°å€</p>
</blockquote>
</li>
<li>$http æœåŠ¡<blockquote>
<p>å‘æœåŠ¡ç«¯å‘é€è¯·æ±‚ï¼Œ<code>$http.get</code>ç­‰ï¼Œå‚è§ <a href="http://www.runoob.com/angularjs/angularjs-http.html" target="_blank" rel="noopener">http://www.runoob.com/angularjs/angularjs-http.html</a></p>
</blockquote>
</li>
<li>$injector<blockquote>
<p>å¯ä»¥ç”¨äºè·å–å…¶ä»–å¯¹è±¡ï¼ˆæœåŠ¡ä½œç”¨åŸŸæ§åˆ¶å™¨ç­‰ï¼‰ï¼š<code>$injector.get(&quot;userService&quot;)</code></p>
</blockquote>
<h3 id="è‡ªå®šä¹‰çš„æœåŠ¡"><a href="#è‡ªå®šä¹‰çš„æœåŠ¡" class="headerlink" title="è‡ªå®šä¹‰çš„æœåŠ¡"></a>è‡ªå®šä¹‰çš„æœåŠ¡</h3></li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//åˆ›å»ºåä¸ºhexafy çš„æœåŠ¡:</span></span><br><span class="line">app.service(<span class="string">'hexafy'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.myFunc = <span class="function"><span class="keyword">function</span> (<span class="params">x</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> x.toString(<span class="number">16</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä½¿ç”¨è‡ªå®šä¹‰çš„çš„æœåŠ¡ hexafy å°†ä¸€ä¸ªæ•°å­—è½¬æ¢ä¸º16è¿›åˆ¶æ•°:</span></span><br><span class="line"></span><br><span class="line">app.controller(<span class="string">'myCtrl'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">$scope, hexafy</span>) </span>&#123;</span><br><span class="line">    $scope.hex = hexafy.myFunc(<span class="number">255</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿‡æ»¤å™¨ä¸­ä½¿ç”¨æœåŠ¡,æ•°ç»„å‰é¢è¦ä¼ å…¥æœåŠ¡å</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">app.filter(<span class="string">'myFormat'</span>,[<span class="string">'hexafy'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">hexafy</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> hexafy.myFunc(x);</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;]);</span><br></pre></td></tr></table></figure>

<p>ç»¼åˆä½¿ç”¨ serviceã€controllerã€filter</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-app</span>=<span class="string">"myApp"</span> <span class="attr">ng-controller</span>=<span class="string">"myCtrl"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>åœ¨è·å–æ•°ç»„ [255, 251, 200] å€¼æ—¶ä½¿ç”¨è¿‡æ»¤å™¨:<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span> <span class="attr">ng-repeat</span>=<span class="string">"x in counts"</span>&gt;</span>&#123;&#123;x | myFormat&#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>è¿‡æ»¤å™¨ä½¿ç”¨æœåŠ¡å°†10è¿›åˆ¶è½¬æ¢ä¸º16è¿›åˆ¶ã€‚<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="actionscript"><span class="keyword">var</span> app = angular.module(<span class="string">'myApp'</span>, []);</span></span><br><span class="line"><span class="actionscript">app.service(<span class="string">'hexafy'</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">	<span class="keyword">this</span>.myFunc = <span class="function"><span class="keyword">function</span> <span class="params">(x)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">return</span> x.toString(<span class="number">16</span>);</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="actionscript">app.filter(<span class="string">'myFormat'</span>,[<span class="string">'hexafy'</span>, <span class="function"><span class="keyword">function</span><span class="params">(hexafy)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span><span class="params">(x)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">return</span> hexafy.myFunc(x);</span></span><br><span class="line">    &#125;;</span><br><span class="line">&#125;]);</span><br><span class="line"><span class="actionscript">app.controller(<span class="string">'myCtrl'</span>, <span class="function"><span class="keyword">function</span><span class="params">($scope)</span> </span>&#123;</span></span><br><span class="line">    $scope.counts = [255, 251, 200];</span><br><span class="line">&#125;);</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="ä¾èµ–æ³¨å…¥"><a href="#ä¾èµ–æ³¨å…¥" class="headerlink" title="ä¾èµ–æ³¨å…¥"></a>ä¾èµ–æ³¨å…¥</h2><p>æœ‰5ä¸ªæ ¸å¿ƒç»„ä»¶ç”¨äºä¾èµ–æ³¨å…¥</p>
<h3 id="value"><a href="#value" class="headerlink" title="value"></a>value</h3><p>value:ä¸€ä¸ªç®€å•jså¯¹è±¡ï¼Œç”¨äºå‘æ§åˆ¶å™¨æˆ–å…¶ä»–ç»„ä»¶ä¼ å€¼</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> mainApp = angular.module(<span class="string">"mainApp"</span>, []);</span><br><span class="line">mainApp.value(<span class="string">"defaultInput"</span>, <span class="number">5</span>);</span><br><span class="line">mainApp.controller(<span class="string">'CalcController'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">$scope, defaultInput</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(defaultInput) <span class="comment">//5</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="factory"><a href="#factory" class="headerlink" title="factory"></a>factory</h3><p>factory: ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºè®¡ç®—å’Œè¿”å›å€¼ã€‚ä¸€èˆ¬ç”¨åœ¨serviceå’Œcontroller</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">mainApp.factory(<span class="string">'MathService'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">   <span class="keyword">var</span> factory = &#123;&#125;;</span><br><span class="line">   </span><br><span class="line">   factory.multiply = <span class="function"><span class="keyword">function</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> a * b</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> factory;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="service"><a href="#service" class="headerlink" title="service"></a>service</h2><p>è§ä¸Šä¸€èŠ‚ï¼Œserviceä¸factoryçš„åŒºåˆ«åœ¨äºï¼š</p>
<p>service æ˜¯ç”¨newå®ä¾‹åŒ–çš„ï¼Œæ‰€ä»¥å±æ€§å’Œæ–¹æ³•å®šä¹‰åœ¨thisä¸Šï¼Œ</p>
<p>factory æ˜¯åˆ›å»ºå¹¶è¿”å›ä¸€ä¸ªå¯¹è±¡</p>
<p>ã€‚ã€‚ å¥½åƒå°±åªæ˜¯å†™æ³•ä¸Šçš„å·®å¼‚ï¼Œæ²¡æœ‰æ ¸å¿ƒå·®å¼‚</p>
<h3 id="provider"><a href="#provider" class="headerlink" title="provider"></a>provider</h3><p>é€šè¿‡ provider åˆ›å»ºä¸€ä¸ª serviceã€factory</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ä½¿ç”¨ provider åˆ›å»º service å®šä¹‰ä¸€ä¸ªæ–¹æ³•ç”¨äºè®¡ç®—ä¸¤æ•°ä¹˜ç§¯</span></span><br><span class="line">mainApp.config(<span class="function"><span class="keyword">function</span>(<span class="params">$provide</span>) </span>&#123;</span><br><span class="line">   $provide.provider(<span class="string">'MathService'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">       <span class="comment">// ç”¨äºè¿”å› value/service/factory</span></span><br><span class="line">      <span class="keyword">this</span>.$<span class="keyword">get</span> = function() &#123;</span><br><span class="line">         <span class="keyword">var</span> factory = &#123;&#125;;  </span><br><span class="line">         </span><br><span class="line">         factory.multiply = <span class="function"><span class="keyword">function</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> a * b; </span><br><span class="line">         &#125;</span><br><span class="line">         <span class="keyword">return</span> factory;</span><br><span class="line">      &#125;;</span><br><span class="line">   &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>å…·ä½“ä½¿ç”¨å·®å¼‚ ä¸è¿‡å¤šäº†è§£</p>
<h3 id="constant"><a href="#constant" class="headerlink" title="constant"></a>constant</h3><p>é…ç½®å¸¸é‡</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">mainApp.constant(<span class="string">"configParam"</span>, <span class="string">"constant value"</span>);</span><br></pre></td></tr></table></figure>

<h2 id="è·¯ç”±"><a href="#è·¯ç”±" class="headerlink" title="è·¯ç”±"></a>è·¯ç”±</h2><ol>
<li><p>éœ€è¦å¼•å…¥angular-route</p>
</li>
<li><p>åœ¨ä¸»æ¨¡å—ä¸­æ·»åŠ ä¾èµ–æ¨¡å—â€”â€”ngRoute</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">angular.module(<span class="string">'routingDemoApp'</span>,[<span class="string">'ngRoute'</span>])</span><br></pre></td></tr></table></figure></li>
<li><p>ä½¿ç”¨ ngView æŒ‡ä»¤</p>
</li>
</ol>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-view</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>div ä¸­å†…å®¹ä¼šæ ¹æ®è·¯ç”±å˜åŒ–è€Œå˜åŒ–</p>
<ol start="4">
<li>é…ç½®$routeProvider</li>
</ol>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.config([<span class="string">'$routeProvider'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">$routeProvider</span>)</span>&#123;</span><br><span class="line">    $routeProvider</span><br><span class="line">        .when(<span class="string">'/'</span>,&#123;<span class="attr">template</span>:<span class="string">'è¿™æ˜¯é¦–é¡µé¡µé¢'</span>&#125;)</span><br><span class="line">        .when(<span class="string">'/computers'</span>,&#123;<span class="attr">template</span>:<span class="string">'è¿™æ˜¯ç”µè„‘åˆ†ç±»é¡µé¢'</span>&#125;)</span><br><span class="line">        .when(<span class="string">'/printers'</span>,&#123;<span class="attr">template</span>:<span class="string">'è¿™æ˜¯æ‰“å°æœºé¡µé¢'</span>&#125;)</span><br><span class="line">        .otherwise(&#123;<span class="attr">redirectTo</span>:<span class="string">'/'</span>&#125;);</span><br><span class="line">&#125;]);</span><br></pre></td></tr></table></figure>

<p>when è¡¨ç¤ºå‘½ä¸­ï¼Œotherwiseè¡¨å…¶ä»–ï¼Œ</p>
<p>é‡Œé¢ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯urlæˆ–è€…æ­£åˆ™ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯è·¯ç”±é…ç½®å¯¹è±¡ã€‚</p>
<p>è·¯ç”±é…ç½®å¯¹è±¡ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">$routeProvider.when(url,&#123;</span><br><span class="line">    template:string, <span class="comment">//åœ¨ng-viewä¸­æ’å…¥ç®€å•çš„htmlå†…å®¹</span></span><br><span class="line">    templateUrl:string, <span class="comment">//åœ¨ng-viewä¸­æ’å…¥htmlæ¨¡ç‰ˆæ–‡ä»¶</span></span><br><span class="line">    controller:string,<span class="function"><span class="keyword">function</span> / <span class="title">array</span>, //åœ¨å½“å‰æ¨¡ç‰ˆä¸Šæ‰§è¡Œçš„<span class="title">controller</span>å‡½æ•°</span></span><br><span class="line"><span class="function">    <span class="title">controllerAs</span>:<span class="title">string</span>, //ä¸º<span class="title">controller</span>æŒ‡å®šåˆ«å</span></span><br><span class="line"><span class="function">    <span class="title">redirectTo</span>:<span class="title">string</span>,<span class="title">function</span>, //é‡å®šå‘çš„åœ°å€</span></span><br><span class="line"><span class="function">    <span class="title">resolve</span>:<span class="title">object</span>&lt;<span class="title">key</span>,<span class="title">function</span>&gt; //æŒ‡å®šå½“å‰<span class="title">controller</span>æ‰€ä¾èµ–çš„å…¶ä»–æ¨¡å—</span></span><br><span class="line"><span class="function">&#125;);</span></span><br></pre></td></tr></table></figure>

<p>ä¸æƒ³æ–°å»ºhtmlæ–‡ä»¶æ—¶ï¼Œå¯ä»¥ç”¨</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/ng-template"</span> <span class="attr">id</span>=<span class="string">"embedded.about.html"</span>&gt;</span></span><br><span class="line"><span class="handlebars"><span class="xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span> About <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>templateUrlä¸­æŒ‡å®š<code>embedded.about.html</code>å³å¯</p>
<h3 id="ui-view-angular-ui-router-stateProvider"><a href="#ui-view-angular-ui-router-stateProvider" class="headerlink" title="ui-view + angular-ui-router + $stateProvider"></a>ui-view + angular-ui-router + $stateProvider</h3><h2 id="run"><a href="#run" class="headerlink" title="run"></a>run</h2><pre><code class="js"><span class="built_in">module</span>.run(<span class="function"><span class="keyword">function</span>(<span class="params">...</span>)</span>{
    <span class="comment">//é‡Œé¢çš„ä»£ç å°†ç›´æ¥è¿è¡Œï¼Œä¸€èˆ¬ç”¨äºæ‰§è¡Œé…ç½®</span>
})</code></pre>
<h2 id="ç¬¬ä¸‰æ–¹æ’ä»¶"><a href="#ç¬¬ä¸‰æ–¹æ’ä»¶" class="headerlink" title="ç¬¬ä¸‰æ–¹æ’ä»¶"></a>ç¬¬ä¸‰æ–¹æ’ä»¶</h2><p>ç•¥</p>
<h2 id="vs-Vue2"><a href="#vs-Vue2" class="headerlink" title="vs Vue2"></a>vs Vue2</h2><p>ä»¥ä¸‹çš„ç›¸å½“ï¼Œåªæ˜¯è¯´æ˜åšæŠ€æœ¯æ ˆè¿ç§»æ—¶çš„è€ƒè™‘æ–¹å‘ã€‚è‚¯å®šæœ‰äº›ç»†èŠ‚ä¸ä¸€æ ·</p>
<p>directive ç›¸å½“äº vue çš„ props</p>
<p>controller ç›¸å½“äº vue çš„ method </p>
<p>æ•°æ®ç›¸å½“äº vue çš„ data å’Œ prop</p>
<p>html ç›¸å½“äº vue çš„ template</p>
<p>directive ä¸­çš„ link: function(scope, element)</p>
<p>scope ç›¸å½“äº vue çš„å½“å‰ä½œç”¨åŸŸ this</p>
<p>ng1.x ä¸­ element è¡¨ç¤ºå¸¦æœ‰ç±»ä¼¼ jquery æ–¹æ³•çš„ dom èŠ‚ç‚¹ï¼›åœ¨ vue ä¸­é€šè¿‡ ref æ‹¿åˆ°çš„æ˜¯å®é™… dom èŠ‚ç‚¹</p>
]]></content>
      <categories>
        <category>å¤§å‰ç«¯</category>
      </categories>
      <tags>
        <tag>Angular1.x</tag>
      </tags>
  </entry>
  <entry>
    <title>document-writeé‡å†™</title>
    <url>/2018/11/01/2018Q4/document-write%E9%87%8D%E5%86%99/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æœ¬æ–‡ä»‹ç»çš„ <code>document.write</code> é‡å†™æ–¹æ³•ï¼Œä¼šæ”¾åœ¨æ–‡æ¡£å¤´éƒ¨æ‰§è¡Œï¼Œä¸”ä¸å½±å“åŸå…ˆ <code>document.write</code> çš„æ‰§è¡Œæ—¶é—´ç‚¹ã€‚å†…éƒ¨æ‰§è¡Œä¸å†é‡‡ç”¨ <code>document.write</code></p>
<a id="more"></a>

<h2 id="document-write-çš„å¥‡å¦™ç”¨æ³•"><a href="#document-write-çš„å¥‡å¦™ç”¨æ³•" class="headerlink" title="document.write çš„å¥‡å¦™ç”¨æ³•"></a>document.write çš„å¥‡å¦™ç”¨æ³•</h2><p>htmlæ–‡æ¡£æ˜¯è¾¹è§£é‡Šè¾¹æ‰§è¡Œçš„ï¼Œæ‰€ä»¥ write ä¸€éƒ¨åˆ†æ—¶ï¼Œä¼šæŠŠè¿™éƒ¨åˆ†æ”¾å…¥ html è§£æå™¨ä¸­ã€‚</p>
<p>è‹¥æ²¡æœ‰åç»­ write ï¼Œå¯èƒ½ä¼šæŠŠ js ä»£ç æ–­ä½œä¸º html èŠ‚ç‚¹å†…å®¹çš„ä¸€éƒ¨åˆ†</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="built_in">document</span>.write(<span class="string">"&lt;script&gt;"</span>)</span><br><span class="line"><span class="comment">// æ²¡æœ‰åŠæ—¶å†™å…¥&lt;\/script&gt;</span></span><br><span class="line"><span class="keyword">var</span> a = <span class="number">1</span>;</span><br><span class="line"><span class="comment">// ä¸Šé¢çš„ä»£ç ä¼šå˜æˆ&lt;script&gt;ä»£ç ä¸­çš„ä¸€éƒ¨åˆ†</span></span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæˆ‘ä»¬å‡è®¾ç”¨æˆ·çš„ <code>document.write</code> ç”¨æ³•æ˜¯æ­£ç¡®çš„ï¼Œå³ write äº†å¼€æ ‡ç­¾ï¼Œå¦‚æœä¸ write é—­æ ‡ç­¾ä¼šå‡ºé”™çš„è¯ åé¢ä¸€å®šä¼šwriteé—­æ ‡ç­¾ã€‚</p>
<p><strong>å¯¹äºå•ä¸ªèŠ‚ç‚¹çš„write(æ— çˆ¶èŠ‚ç‚¹ç­‰å¤æ‚æƒ…å†µ)</strong>,è€ƒè™‘ä»¥ä¸‹å‡ ç§æƒ…å†µ</p>
<ol>
<li>ä»…å†™å…¥å¼€æ ‡ç­¾ï¼Œä½†å¿…è¦çš„é—­æ ‡ç­¾åœ¨ä¸‹ä¸€ä¸ª <code>document.write</code> ä¸­</li>
<li>ä»…å†™å…¥å¼€æ ‡ç­¾ï¼Œä½†é—­æ ‡ç­¾éå¿…è¦</li>
<li>å­˜åœ¨scriptæ ‡ç­¾</li>
<li>å†™å…¥æ ‡ç­¾æœªé—­åˆï¼Œä¾‹ï¼š<code>&lt;di</code> æš‚æœªèƒ½åˆ¤æ–­æ˜¯æ–‡æœ¬è¿˜æ˜¯æ ‡ç­¾</li>
</ol>
<h3 id="ä»…å†™å…¥å¼€æ ‡ç­¾ï¼Œä½†å¿…è¦çš„é—­æ ‡ç­¾åœ¨ä¸‹ä¸€ä¸ª-document-write-ä¸­"><a href="#ä»…å†™å…¥å¼€æ ‡ç­¾ï¼Œä½†å¿…è¦çš„é—­æ ‡ç­¾åœ¨ä¸‹ä¸€ä¸ª-document-write-ä¸­" class="headerlink" title="ä»…å†™å…¥å¼€æ ‡ç­¾ï¼Œä½†å¿…è¦çš„é—­æ ‡ç­¾åœ¨ä¸‹ä¸€ä¸ª document.write ä¸­"></a>ä»…å†™å…¥å¼€æ ‡ç­¾ï¼Œä½†å¿…è¦çš„é—­æ ‡ç­¾åœ¨ä¸‹ä¸€ä¸ª <code>document.write</code> ä¸­</h3><p>ç»´æŠ¤ä¸€ä¸ª éœ€è¦å¿…è¦é—­æ ‡ç­¾çš„æ ‡ç­¾åˆ—è¡¨ï¼Œç¬¬ä¸€ä¸ªwriteå†™å…¥äº†å¼€æ ‡ç­¾ï¼Œæ­¤æ—¶å°†å…¶æš‚å­˜ï¼Œåœ¨ç¬¬äºŒä¸ªwriteçš„æ—¶å€™å†è¡¥ä¸Š <code>str=leLabel+str</code></p>
<h3 id="ä»…å†™å…¥å¼€æ ‡ç­¾ï¼Œä½†é—­æ ‡ç­¾éå¿…è¦"><a href="#ä»…å†™å…¥å¼€æ ‡ç­¾ï¼Œä½†é—­æ ‡ç­¾éå¿…è¦" class="headerlink" title="ä»…å†™å…¥å¼€æ ‡ç­¾ï¼Œä½†é—­æ ‡ç­¾éå¿…è¦"></a>ä»…å†™å…¥å¼€æ ‡ç­¾ï¼Œä½†é—­æ ‡ç­¾éå¿…è¦</h3><p>ç¬¬ä¸€ä¸ªwriteå†™å…¥äº†å¼€æ ‡ç­¾ï¼Œä½†è¯¥æ ‡ç­¾ä¸åœ¨<code>éœ€è¦å¿…è¦é—­æ ‡ç­¾çš„æ ‡ç­¾åˆ—è¡¨</code>ä¸­,æ­¤æ—¶å°†å…¶æš‚å­˜ï¼Œåœ¨ç¬¬äºŒä¸ªwriteçš„æ—¶å€™å†è¡¥ä¸Š <code>str=leLabel+str</code></p>
<h3 id="å­˜åœ¨scriptæ ‡ç­¾"><a href="#å­˜åœ¨scriptæ ‡ç­¾" class="headerlink" title="å­˜åœ¨scriptæ ‡ç­¾"></a>å­˜åœ¨scriptæ ‡ç­¾</h3><p>å…ˆå†™å…¥scriptå‰çš„å†…å®¹ï¼Œç„¶åappend script å†ç»§ç»­å¤„ç†scriptåçš„å†…å®¹</p>
<h3 id="å†™å…¥æ ‡ç­¾æœªé—­åˆï¼Œä¾‹ï¼š-lt-di-æš‚æœªèƒ½åˆ¤æ–­æ˜¯æ–‡æœ¬è¿˜æ˜¯æ ‡ç­¾"><a href="#å†™å…¥æ ‡ç­¾æœªé—­åˆï¼Œä¾‹ï¼š-lt-di-æš‚æœªèƒ½åˆ¤æ–­æ˜¯æ–‡æœ¬è¿˜æ˜¯æ ‡ç­¾" class="headerlink" title="å†™å…¥æ ‡ç­¾æœªé—­åˆï¼Œä¾‹ï¼š&lt;di æš‚æœªèƒ½åˆ¤æ–­æ˜¯æ–‡æœ¬è¿˜æ˜¯æ ‡ç­¾"></a>å†™å…¥æ ‡ç­¾æœªé—­åˆï¼Œä¾‹ï¼š<code>&lt;di</code> æš‚æœªèƒ½åˆ¤æ–­æ˜¯æ–‡æœ¬è¿˜æ˜¯æ ‡ç­¾</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="built_in">document</span>.write(<span class="string">"&lt;spa"</span>)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="number">555</span>)</span><br><span class="line"><span class="built_in">document</span>.write(<span class="string">"n&gt;dsdas&lt;/span&gt;"</span>)</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure>

<p>å°†å…¶å½“æˆæ ‡ç­¾ï¼Œæš‚ä¸å†™å…¥å†…å®¹ï¼Œåœ¨ä¸‹ä¸€æ¬¡ <code>document.write</code> çš„æ—¶å€™ï¼Œå…ˆåˆ¤æ–­ä¸Šä¸‹æ–‡ã€‚</p>
<p>è‹¥å¤„äºä¸åŒ currentScript,è¯´æ˜ä¸Šä¸€æœªé—­åˆæ ‡ç­¾æ˜¯æ™®é€šæ–‡æœ¬ï¼Œéœ€è¦è¡¥ä¸Šæ–‡æœ¬</p>
<p>å¦åˆ™æ£€æµ‹æœ¬æ¬¡ write çš„æ–‡æœ¬ æ˜¯å¦ä»¥ <code>xx&gt;</code> å¼€å¤´ï¼Œä¸”<code>(document.createElement(æ ‡ç­¾å)).__proto__ instanceof HTMLUnknownElement === false</code> åˆ™è¯´æ˜ä¸ºæ ‡ç­¾ï¼Œå¦åˆ™ä¸ºæ™®é€šæ–‡æœ¬</p>
<p>ç¬¬ä¸‰æ–¹åº“é‡Œé¢ç”¨çš„è‡ªå®šä¹‰å…ƒç´ ï¼Œ<code>(document.createElement(æ ‡ç­¾å)).__proto__ instanceof HTMLElement === true</code></p>
<h2 id="æ‹“å±•çŸ¥è¯†ï¼šæœªçŸ¥å…ƒç´ ä¸è‡ªå®šä¹‰å…ƒç´ "><a href="#æ‹“å±•çŸ¥è¯†ï¼šæœªçŸ¥å…ƒç´ ä¸è‡ªå®šä¹‰å…ƒç´ " class="headerlink" title="æ‹“å±•çŸ¥è¯†ï¼šæœªçŸ¥å…ƒç´ ä¸è‡ªå®šä¹‰å…ƒç´ "></a>æ‹“å±•çŸ¥è¯†ï¼šæœªçŸ¥å…ƒç´ ä¸è‡ªå®šä¹‰å…ƒç´ </h2><ul>
<li>æœªçŸ¥å…ƒç´ <blockquote>
<p><code>&lt;unknownelement&gt;</code></p>
<p>HTMLè§„èŒƒä¸­å°†æ²¡æœ‰å®šä¹‰çš„å…ƒç´ ä½œä¸º HTMLUnknownElement è¿›è¡Œè§£æã€‚</p>
</blockquote>
</li>
</ul>
<ul>
<li>è‡ªå®šä¹‰å…ƒç´ <blockquote>
<p><code>&lt;custom-element&gt;</code></p>
<p>è‡ªå®šä¹‰å…ƒç´ åˆ™å¹¶éå¦‚æ­¤ã€‚å¦‚æœåœ¨åˆ›å»ºæ—¶ä½¿ç”¨æœ‰æ•ˆçš„åç§°ï¼ˆåŒ…å«â€œ-â€ï¼‰ï¼Œåˆ™æ½œåœ¨çš„è‡ªå®šä¹‰å…ƒç´ å°†è§£æä¸º HTMLElement ã€‚</p>
</blockquote>
</li>
</ul>
]]></content>
      <categories>
        <category>å¤§å‰ç«¯</category>
      </categories>
      <tags>
        <tag>HTML</tag>
      </tags>
  </entry>
  <entry>
    <title>markdownæŠ€å·§</title>
    <url>/2018/10/16/2018Q4/markdown%E6%8A%80%E5%B7%A7/</url>
    <content><![CDATA[<h2 id="1-æ–‡æœ¬åˆ é™¤çº¿æ•ˆæœ"><a href="#1-æ–‡æœ¬åˆ é™¤çº¿æ•ˆæœ" class="headerlink" title="1. æ–‡æœ¬åˆ é™¤çº¿æ•ˆæœ"></a>1. æ–‡æœ¬åˆ é™¤çº¿æ•ˆæœ</h2><p>åœ¨éœ€è¦åˆ é™¤çº¿æ•ˆæœçš„å•è¡Œæ–‡æœ¬ä¸¤ä¾§åŠ <code>~~</code>ï¼Œä¾‹å¦‚</p>
<a id="more"></a>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">~~test~~</span><br></pre></td></tr></table></figure>
<p>æ•ˆæœå¦‚ä¸‹ï¼š</p>
<p><del>test</del></p>
<p>ä½†å¯¹äºå¤šè¡Œæ–‡æœ¬ï¼Œä½¿ç”¨</p>
<p>~~test1</p>
<p>test2~~</p>
<p>æˆ‘ä»¬å‘ç°æ²¡æœ‰æ•ˆæœï¼Œæ­¤æ—¶æœ‰ä¸¤ç§æ–¹æ³•ï¼Œ</p>
<ol>
<li>æ¯è¡Œéƒ½ç”¨<code>~~</code>åŒ…èµ·æ¥ï¼Œå³<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">~~test1~~</span><br><span class="line"></span><br><span class="line">~~test2~~</span><br></pre></td></tr></table></figure></li>
<li>åˆ©ç”¨htmlçš„<code>&lt;s&gt;</code>åˆ é™¤çº¿æ ‡ç­¾<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;s&gt;test1</span><br><span class="line"></span><br><span class="line">test2~~&lt;&#x2F;s&gt;</span><br></pre></td></tr></table></figure>
æ•ˆæœå¦‚ä¸‹ï¼š</li>
</ol>
<p><s>test1</p>
<p>test2</s></p>
<h2 id="2-åŒºå—å¼•ç”¨çš„æ¢è¡Œ"><a href="#2-åŒºå—å¼•ç”¨çš„æ¢è¡Œ" class="headerlink" title="2. åŒºå—å¼•ç”¨çš„æ¢è¡Œ"></a>2. åŒºå—å¼•ç”¨çš„æ¢è¡Œ</h2><p>æˆ‘ä»¬å¯ä»¥åœ¨æ–‡æ˜å‰ä½¿ç”¨<code>&gt;</code> æ¥å¯¹æ–‡æœ¬æ ·å¼è¿›è¡Œç‰¹æ®Šçš„å±•ç¤ºï¼Œå¸¸ç”¨äºå¼•ç”¨ã€è¯´æ˜ã€æ ‡æ³¨ï¼Œä¾‹å¦‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt; test</span><br></pre></td></tr></table></figure>
<p>æ•ˆæœå¦‚ä¸‹ï¼š</p>
<blockquote>
<p>test</p>
</blockquote>
<p>å¯¹äºå¤šè¡Œæ–‡æœ¬ï¼Œä½¿ç”¨</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt; test1</span><br><span class="line">&gt; test2</span><br></pre></td></tr></table></figure>
<p>æ•ˆæœå¦‚ä¸‹ï¼š</p>
<blockquote>
<p>test1<br>test2</p>
</blockquote>
<p>æˆ‘ä»¬å‘ç° test1 test2å¤„äºåŒä¸€è¡Œï¼Œè§£å†³æ–¹æ³•æœ‰ä¸¤ç§</p>
<ol>
<li>åŠ å…¥ç©ºçš„<code>&gt;</code>è¡Œ<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt; test1</span><br><span class="line">&gt;</span><br><span class="line">&gt; test2</span><br></pre></td></tr></table></figure>
æ•ˆæœå¦‚ä¸‹,ä¼šå¤šä¸€ä¸ªç©ºè¡Œï¼š</li>
</ol>
<blockquote>
<p>test1</p>
<p>test2</p>
</blockquote>
<ol start="2">
<li>è¡Œæœ«åŠ å…¥<code>\</code><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt; test1\</span><br><span class="line">&gt; test2</span><br></pre></td></tr></table></figure>
æ•ˆæœå¦‚ä¸‹ï¼š<blockquote>
<p>test1<br>test2</p>
</blockquote>
</li>
</ol>
<p>ps: æœ‰äº›mdè§£æå™¨æ²¡æœ‰æ•ˆæœ</p>
<h2 id="3-ç‚¹å‡»å±•å¼€æ•ˆæœ"><a href="#3-ç‚¹å‡»å±•å¼€æ•ˆæœ" class="headerlink" title="3. ç‚¹å‡»å±•å¼€æ•ˆæœ"></a>3. ç‚¹å‡»å±•å¼€æ•ˆæœ</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;details&gt;</span><br><span class="line">&lt;summary&gt;title&lt;&#x2F;summary&gt;</span><br><span class="line">content</span><br><span class="line">&lt;&#x2F;details&gt;</span><br></pre></td></tr></table></figure>
<p>æ•ˆæœå¦‚ä¸‹:</p>
<details>
<summary>ç‚¹å‡»å±•å¼€</summary>
æˆ‘æ˜¯å†…å®¹è¯¦æƒ…
</details>

<h2 id="4-é¡µå†…è·³è½¬"><a href="#4-é¡µå†…è·³è½¬" class="headerlink" title="4. é¡µå†…è·³è½¬"></a>4. é¡µå†…è·³è½¬</h2><ol>
<li>å…ˆå®šä¹‰ä¸€ä¸ªé”š</li>
</ol>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">"anchor"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>ä½¿ç”¨é“¾æ¥è·³è½¬è¯­æ³•</li>
</ol>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[ç‚¹å‡»è·³è½¬](#anchor)</span><br><span class="line">or</span><br><span class="line">&lt;a href&#x3D;&quot;#anchor&quot;&gt;ç‚¹å‡»è·³è½¬&lt;&#x2F;a&gt;</span><br></pre></td></tr></table></figure>

<p><strong>æ³¨æ„ï¼š</strong></p>
<p>ä½¿ç”¨ <code>#</code> è¯­æ³•å®šä¹‰çš„å„çº§æ ‡é¢˜ï¼Œè‹¥æ ‡é¢˜ä¸ºçº¯æ–‡æœ¬ï¼ˆæ²¡æœ‰ä½¿ç”¨mdæ ·å¼ï¼‰ä¸”ä¸å¸¦ç©ºæ ¼ï¼Œè¯¥æ ‡é¢˜å°±æ˜¯ä¸€ä¸ªé”š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">## å‰è¨€</span><br><span class="line"></span><br><span class="line">## **å†…å®¹** 1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; æœ‰æ•ˆ</span><br><span class="line">[ç‚¹å‡»è·³è½¬](#å‰è¨€)</span><br><span class="line">&#x2F;&#x2F; æ— æ•ˆ</span><br><span class="line">[ç‚¹å‡»è·³è½¬](#**å†…å®¹** 1)</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>éšç¬”</category>
      </categories>
      <tags>
        <tag>markdown</tag>
      </tags>
  </entry>
  <entry>
    <title>æ€ç»´å¯¼å›¾ç»„ä»¶å¼€å‘</title>
    <url>/2018/10/16/2018Q4/%E6%80%9D%E7%BB%B4%E5%AF%BC%E5%9B%BE%E7%BB%84%E4%BB%B6%E5%BC%80%E5%8F%91/</url>
    <content><![CDATA[<p>æœ¬æ–‡ä¸»è¦æè¿°æ€ç»´å¯¼å›¾å®ç°çš„è¦ç´ </p>
<p>åå‘äºæ¦‚è¦è®¾è®¡</p>
<a id="more"></a>

<h2 id="å®šä¹‰"><a href="#å®šä¹‰" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h2><h3 id="å…ƒç´ å®šä¹‰"><a href="#å…ƒç´ å®šä¹‰" class="headerlink" title="å…ƒç´ å®šä¹‰"></a>å…ƒç´ å®šä¹‰</h3><ol>
<li>ä¸­å¿ƒèŠ‚ç‚¹<blockquote>
<p>å¤„äºä¸»æ ‘å¹²ï¼Œå”¯ä¸€ï¼Œä¸å¯åˆ é™¤</p>
</blockquote>
</li>
<li>ä¸»æ ‘å¹²<blockquote>
<p>ä»¥ä¸­å¿ƒèŠ‚ç‚¹ä¸ºæ ¹èŠ‚ç‚¹æ„æˆçš„æ ‘ </p>
</blockquote>
</li>
<li>æ¸¸ç¦»æ ‘<blockquote>
<p>éä¸»æ ‘å¹²çš„æ ‘ï¼Œå…¶æ ¹èŠ‚ç‚¹ç”±æ‹–åŠ¨ã€ç²˜è´´ã€ç©ºç™½å¤„åˆ›å»º ç”Ÿæˆ</p>
</blockquote>
</li>
<li>æ™®é€šèŠ‚ç‚¹<blockquote>
<p>åŒ…æ‹¬ä¸»æ ‘å¹²èŠ‚ç‚¹å’Œæ¸¸ç¦»æ ‘èŠ‚ç‚¹<br>å«ä¸€ä¸ªç¼©æ”¾æŒ‰é’®ï¼Œæ§åˆ¶å­å­™èŠ‚ç‚¹çš„å±•ç¤º</p>
</blockquote>
</li>
<li>è¿æ¥çº¿<blockquote>
<p>çˆ¶å­èŠ‚ç‚¹ä¹‹é—´çš„è¿çº¿ï¼Œæ— ç®­å¤´ï¼Œæ— æ ‡é¢˜ </p>
</blockquote>
</li>
<li>å…³è”çº¿<blockquote>
<p>ä»»æ„ä¸¤èŠ‚ç‚¹ä¹‹é—´çš„è¿çº¿ï¼Œå¸¦ç®­å¤´ï¼Œå¸¦æ ‡é¢˜</p>
</blockquote>
</li>
</ol>
<h3 id="çŠ¶æ€å®šä¹‰"><a href="#çŠ¶æ€å®šä¹‰" class="headerlink" title="çŠ¶æ€å®šä¹‰"></a>çŠ¶æ€å®šä¹‰</h3><ol>
<li>é€‰æ‹©çŠ¶æ€</li>
<li>ç¼–è¾‘çŠ¶æ€</li>
</ol>
<p>ä¸¤ä¸ªçŠ¶æ€äº’æ–¥</p>
<h2 id="åˆ›å»º"><a href="#åˆ›å»º" class="headerlink" title="åˆ›å»º"></a>åˆ›å»º</h2><h3 id="æ™®é€šèŠ‚ç‚¹åˆ›å»ºæ–¹å¼"><a href="#æ™®é€šèŠ‚ç‚¹åˆ›å»ºæ–¹å¼" class="headerlink" title="æ™®é€šèŠ‚ç‚¹åˆ›å»ºæ–¹å¼"></a>æ™®é€šèŠ‚ç‚¹åˆ›å»ºæ–¹å¼</h3><ol>
<li>èŠ‚ç‚¹é€‰æ‹©çŠ¶æ€ï¼ŒæŒ‰å›è½¦é”®ï¼Œåˆ›å»ºåŒçº§èŠ‚ç‚¹</li>
<li>èŠ‚ç‚¹é€‰æ‹©çŠ¶æ€ï¼Œé¼ æ ‡å³é”®ï¼Œå¯ä»¥åˆ›å»ºåŒçº§èŠ‚ç‚¹æˆ–å­èŠ‚ç‚¹</li>
<li>åœ¨ç©ºç™½å¤„é¼ æ ‡å³é”®ï¼Œé€‰æ‹©åˆ›å»ºèŠ‚ç‚¹é€‰é¡¹ï¼Œå°†åˆ›å»ºæ¸¸ç¦»çš„æ™®é€šèŠ‚ç‚¹</li>
<li>ç•Œé¢å·¦ä¾§é¢„è®¾ä¸€äº›èŠ‚ç‚¹ï¼Œå¯ä»¥å°†å…¶æ‹–åŠ¨è¿‡æ¥ã€‚è¿™äº›èŠ‚ç‚¹ä¸»è¦æ˜¯å¸¦ä¸€äº›é€šç”¨å›¾æ ‡</li>
<li>èŠ‚ç‚¹ç²˜è´´ï¼šå·²è¿›è¡ŒèŠ‚ç‚¹å¤åˆ¶æ“ä½œï¼Œåœ¨èŠ‚ç‚¹é€‰æ‹©çŠ¶æ€æˆ–è€…ç©ºç™½å¤„é¼ æ ‡å³é”®ï¼Œè¿›è¡Œå…ƒç´ ç²˜è´´</li>
</ol>
<h3 id="è¿æ¥çº¿åˆ›å»ºæ–¹å¼"><a href="#è¿æ¥çº¿åˆ›å»ºæ–¹å¼" class="headerlink" title="è¿æ¥çº¿åˆ›å»ºæ–¹å¼"></a>è¿æ¥çº¿åˆ›å»ºæ–¹å¼</h3><ol>
<li>è‡ªåŠ¨åˆ›å»ºï¼šå½“èŠ‚ç‚¹åˆ›å»ºæ—¶ä¸æ˜¯æ¸¸ç¦»æ ‘æ ¹èŠ‚ç‚¹æ—¶ï¼Œè‡ªåŠ¨è¿›è¡Œè¿æ¥çº¿åˆ›å»º</li>
<li>æ‰‹åŠ¨åˆ›å»ºï¼šé¼ æ ‡å³é”®å¤„äºä¸»æ ‘å¹²çš„æ™®é€šèŠ‚ç‚¹ï¼Œé€‰æ‹©åˆ›å»ºè¿æ¥çº¿ï¼Œæ‹–åŠ¨è‡³æ¸¸ç¦»æ ‘æ ¹èŠ‚ç‚¹</li>
</ol>
<h3 id="å…³è”çº¿åˆ›å»ºæ–¹å¼"><a href="#å…³è”çº¿åˆ›å»ºæ–¹å¼" class="headerlink" title="å…³è”çº¿åˆ›å»ºæ–¹å¼"></a>å…³è”çº¿åˆ›å»ºæ–¹å¼</h3><p>é¼ æ ‡å³é”®æ™®é€šèŠ‚ç‚¹ï¼Œé€‰æ‹©åˆ›å»ºå…³è”çº¿ï¼Œæ‹‰åŠ¨å¹¶è¿ä¸Šå…¶ä»–æ™®é€šèŠ‚ç‚¹ï¼Œå°†åˆ›å»ºè¿æ¥å¹¶è¿›å…¥èŠ‚ç‚¹æ ‡é¢˜ç¼–è¾‘çŠ¶æ€</p>
<h2 id="åˆ é™¤"><a href="#åˆ é™¤" class="headerlink" title="åˆ é™¤"></a>åˆ é™¤</h2><ol>
<li>çˆ¶èŠ‚ç‚¹åˆ é™¤ï¼Œå­èŠ‚ç‚¹è‡ªåŠ¨åˆ é™¤</li>
<li>èŠ‚ç‚¹é€‰æ‹©çŠ¶æ€ï¼šæŒ‰Deleteé”®ï¼Œè¿›è¡Œå…ƒç´ åˆ é™¤</li>
</ol>
<h2 id="é€‰æ‹©"><a href="#é€‰æ‹©" class="headerlink" title="é€‰æ‹©"></a>é€‰æ‹©</h2><p>æŒ‰ä½CTRLé”®ï¼Œç‚¹å‡»èŠ‚ç‚¹ï¼Œå¯è¿›è¡Œå¤šèŠ‚ç‚¹çš„é€‰æ‹©ã€‚</p>
<p>åŒæ—¶é€‰æ‹©çˆ¶èŠ‚ç‚¹å’Œå­èŠ‚ç‚¹ï¼Œå¯¹äºåç»­å„ç§æ“ä½œï¼Œéƒ½åªæ“ä½œçˆ¶èŠ‚ç‚¹ã€‚</p>
<p>ä¾‹å¦‚ï¼Œ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Aâ€”A1</span><br><span class="line">|â€”A2</span><br></pre></td></tr></table></figure>
<p>é€‰æ‹©Aå’ŒA2èŠ‚ç‚¹ï¼Œæ‹–åŠ¨è‡³BèŠ‚ç‚¹ï¼Œæ­¤æ—¶AèŠ‚ç‚¹ä¸ºBèŠ‚ç‚¹çš„å­èŠ‚ç‚¹ï¼ŒA1,A2ä»æ˜¯Açš„å­èŠ‚ç‚¹ã€‚å³<strong>åªæ“ä½œäº†çˆ¶èŠ‚ç‚¹</strong>ã€‚</p>
<h2 id="æ‹–åŠ¨"><a href="#æ‹–åŠ¨" class="headerlink" title="æ‹–åŠ¨"></a>æ‹–åŠ¨</h2><p>æ‹–åŠ¨ä¸­å¿ƒèŠ‚ç‚¹ï¼Œåˆ™ä¸»æ ‘å¹²è¿›è¡Œç§»åŠ¨ï¼Œæ¸¸ç¦»æ ‘ä¸åŠ¨</p>
<p>æ‹–åŠ¨æ™®é€šèŠ‚ç‚¹è‡³ç©ºç™½å¤„ï¼Œåˆ™ä½ç½®è¿›è¡Œè°ƒæ•´ï¼›å…¶å­èŠ‚ç‚¹è§†æƒ…å†µè°ƒæ•´ï¼ˆåˆ¶å®šç­–ç•¥ï¼Œæœ‰ä¸€å®šå·¥ä½œé‡ï¼‰ï¼Œè¿æ¥çº¿å’Œå…³è”çº¿è‡ªåŠ¨è°ƒæ•´ã€‚</p>
<blockquote>
<p>æ”¯æŒå¤šä¸ªèŠ‚ç‚¹åŒæ—¶æ‹–åŠ¨</p>
</blockquote>
<p>æ‹–åŠ¨æ™®é€šèŠ‚ç‚¹è‡³èŠ‚ç‚¹å¤„ï¼Œå½“å‰èŠ‚ç‚¹ä¼šå˜ä¸ºè¯¥èŠ‚ç‚¹çš„å­èŠ‚ç‚¹</p>
<p>åŒæ—¶é€‰æ‹©ä¸­å¿ƒèŠ‚ç‚¹å’Œæ¸¸ç¦»æ ‘èŠ‚ç‚¹ï¼Œåˆ™è¿™äº›æ ‘ä¸€èµ·æ‹–åŠ¨,ä¸”ä¸èƒ½æ‹–åŠ¨è‡³æ™®é€šèŠ‚ç‚¹</p>
<p>è¿æ¥çº¿æ— æ³•æ‹–åŠ¨</p>
<p>å…³è”çº¿å¯æ‹–åŠ¨ï¼Œåˆ©ç”¨å·¦å³ä¸¤ä¸ªæ‹‰æ†ï¼ˆå‚è€ƒprocesson</p>
<h2 id="å¤åˆ¶ä¸ç²˜è´´"><a href="#å¤åˆ¶ä¸ç²˜è´´" class="headerlink" title="å¤åˆ¶ä¸ç²˜è´´"></a>å¤åˆ¶ä¸ç²˜è´´</h2><h3 id="å¤åˆ¶"><a href="#å¤åˆ¶" class="headerlink" title="å¤åˆ¶"></a>å¤åˆ¶</h3><p>é€‰æ‹©èŠ‚ç‚¹åï¼ŒCTRL+Cæˆ–è€…é¼ æ ‡å³é”®ç‚¹å¤åˆ¶ï¼Œå¯è¿›è¡ŒèŠ‚ç‚¹çš„å¤åˆ¶ã€‚</p>
<p>ä¼šåŒæ—¶å¤åˆ¶è¿™äº›èŠ‚ç‚¹çš„å­å­™èŠ‚ç‚¹</p>
<h3 id="ç²˜è´´"><a href="#ç²˜è´´" class="headerlink" title="ç²˜è´´"></a>ç²˜è´´</h3><ul>
<li>é¼ æ ‡å³é”®æ™®é€šèŠ‚ç‚¹ï¼Œé€‰æ‹©ç²˜è´´ï¼Œä¼šå°†å¤åˆ¶çš„èŠ‚ç‚¹ä½œä¸ºè¯¥èŠ‚ç‚¹çš„å­èŠ‚ç‚¹</li>
<li>é¼ æ ‡å³é”®ç©ºç™½å¤„ï¼Œé€‰æ‹©ç²˜è´´ã€‚è‹¥å¤åˆ¶çš„çˆ¶èŠ‚ç‚¹è¶…è¿‡ä¸€ä¸ªï¼Œè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªæ¸¸ç¦»æ ‘æ ¹èŠ‚ç‚¹ï¼Œå¹¶å°†è¿™äº›èŠ‚ç‚¹ä½œä¸ºæ ¹èŠ‚ç‚¹çš„å­èŠ‚ç‚¹ï¼Œå¦åˆ™ç›´æ¥ç²˜è´´ã€‚</li>
</ul>
<h2 id="ä¿å­˜ï¼Œæ’¤é”€ï¼Œé‡åš"><a href="#ä¿å­˜ï¼Œæ’¤é”€ï¼Œé‡åš" class="headerlink" title="ä¿å­˜ï¼Œæ’¤é”€ï¼Œé‡åš"></a>ä¿å­˜ï¼Œæ’¤é”€ï¼Œé‡åš</h2><p>ä¸€æ¬¡æ“ä½œå®šä¹‰ï¼š</p>
<ul>
<li>ç»„ä»¶åˆ›å»º</li>
<li>ç»„ä»¶æ‹–åŠ¨è‡³é¼ æ ‡æ¾å¼€</li>
<li>ç»„ä»¶å±æ€§ä¿®æ”¹ï¼šæ ‡é¢˜ã€æ ·å¼</li>
</ul>
<p>ç¼©æ”¾æ“ä½œä»…é’ˆå¯¹æœ¬åœ°æ˜¾ç¤ºï¼Œä¸æ¶‰åŠ<code>ä¸€æ¬¡æ“ä½œ</code></p>
<p>å†å²è®°å½•ï¼šæ“ä½œæ­¥éª¤çš„è®°å½•ï¼Œindexè®°å½•å½“å‰å¤„äºå†å²è®°å½•çš„å“ªä¸ªæ“ä½œ</p>
<h3 id="ä¿å­˜"><a href="#ä¿å­˜" class="headerlink" title="ä¿å­˜"></a>ä¿å­˜</h3><p>æ¯æ¬¡æ“ä½œç»“æŸï¼Œé€šè¿‡websocketå‘é€å½“å‰æ“ä½œåˆ°æœåŠ¡ç«¯ï¼Œè¿›è¡Œè‡ªåŠ¨ä¿å­˜ï¼ˆautosaveï¼‰ã€‚</p>
<blockquote>
<p>å¯ç”¨äºå¤šäººæ“ä½œåŠé˜²æ­¢æ„å¤–å…³é—­</p>
</blockquote>
<p>ç‚¹å‡»ä¿å­˜æŒ‰é’®æˆ–æŒ‰<code>CTRL+S</code>è¿›è¡Œæ–‡ä»¶ä¿å­˜ï¼Œä¼šå°†å½“å‰æ•´ä¸ªæ–‡ä»¶ç»“æ„ä¸Šä¼ ï¼ˆsaveï¼‰ï¼Œå¹¶æ¸…ç©º<code>å†å²è®°å½•</code></p>
<h3 id="æ’¤é”€"><a href="#æ’¤é”€" class="headerlink" title="æ’¤é”€"></a>æ’¤é”€</h3><p>æ’¤é”€ï¼ˆundoï¼‰ä¸€æ¬¡æ“ä½œï¼Œå¹¶è¿›è¡Œè‡ªåŠ¨ä¿å­˜ï¼ˆautosaveï¼‰</p>
<blockquote>
<p>å†å²è®°å½•å›é€€ï¼Œè‹¥è¿›è¡Œæ–°çš„æ“ä½œï¼Œindexå…¶åçš„å†å²è®°å½•ä¼šè¢«èˆå¼ƒ</p>
</blockquote>
<h3 id="é‡åš"><a href="#é‡åš" class="headerlink" title="é‡åš"></a>é‡åš</h3><p>åœ¨å¤„äºæ’¤é”€æƒ…å†µä¸‹è¿›è¡Œè¿˜åŸæ“ä½œï¼ˆredoï¼‰ï¼Œå¹¶è¿›è¡Œè‡ªåŠ¨ä¿å­˜</p>
<h2 id="å±•å¼€ä¸ç¼©ç•¥"><a href="#å±•å¼€ä¸ç¼©ç•¥" class="headerlink" title="å±•å¼€ä¸ç¼©ç•¥"></a>å±•å¼€ä¸ç¼©ç•¥</h2><p>æ™®é€šèŠ‚ç‚¹æ—æ˜¾ç¤ºä¸€ä¸ªå±•å¼€æŒ‰é’®<code>+</code>æˆ–ç¼©ç•¥æŒ‰é’®<code>-</code> </p>
<p>ç‚¹å‡»å±•å¼€æŒ‰é’®ï¼Œå±•å¼€å½“å‰èŠ‚ç‚¹çš„ä¸‹ä¸€çº§èŠ‚ç‚¹</p>
<p>ç‚¹å‡»ç¼©ç•¥æŒ‰é’®ï¼Œç¼©ç•¥å½“å‰èŠ‚ç‚¹çš„æ‰€æœ‰å­å­™èŠ‚ç‚¹</p>
<h2 id="å¿«æ·æ“ä½œ"><a href="#å¿«æ·æ“ä½œ" class="headerlink" title="å¿«æ·æ“ä½œ"></a>å¿«æ·æ“ä½œ</h2><ol>
<li>èŠ‚ç‚¹é€‰æ‹©çŠ¶æ€ï¼šæŒ‰å›è½¦é”®ï¼Œè‡ªåŠ¨åˆ›å»ºåŒçº§èŠ‚ç‚¹å¹¶å¤„äºèŠ‚ç‚¹ç¼–è¾‘çŠ¶æ€ï¼›æ˜¾ç¤ºåˆ é™¤æŒ‰é’®</li>
<li>èŠ‚ç‚¹é€‰æ‹©çŠ¶æ€ï¼šæŒ‰Tapé”®ï¼Œè‡ªåŠ¨åˆ›å»ºå­èŠ‚ç‚¹å¹¶å¤„äºèŠ‚ç‚¹ç¼–è¾‘çŠ¶æ€</li>
<li>èŠ‚ç‚¹é€‰æ‹©çŠ¶æ€ï¼šæŒ‰Deleteé”®ï¼Œè¿›è¡Œå…ƒç´ åˆ é™¤</li>
<li>èŠ‚ç‚¹ç¼–è¾‘çŠ¶æ€ï¼šæŒ‰å›è½¦é”®ï¼Œä¿å­˜èŠ‚ç‚¹æ ‡é¢˜å¹¶å¤„äºèŠ‚ç‚¹é€‰æ‹©çŠ¶æ€</li>
<li>åŒå‡»èŠ‚ç‚¹ï¼Œè¿›å…¥èŠ‚ç‚¹æ ‡é¢˜ç¼–è¾‘çŠ¶æ€</li>
<li>æŒ‰ä½CTRLï¼Œå¯ä»¥é€‰æ‹©å¤šä¸ªèŠ‚ç‚¹</li>
<li>CTRL+A è¿›è¡Œæ‰€æœ‰èŠ‚ç‚¹çš„é€‰æ‹©</li>
</ol>
<h2 id="æ ·å¼"><a href="#æ ·å¼" class="headerlink" title="æ ·å¼"></a>æ ·å¼</h2><ul>
<li>ç”»å¸ƒåˆå§‹åŒ–ä¸€å®šå¤§å°ï¼Œä¸­å¿ƒèŠ‚ç‚¹å¤„äºä¸­å¿ƒã€‚ç”»å¸ƒå¯æ— é™æ‹‰ä¼¸</li>
<li>æ™®é€šèŠ‚ç‚¹æ”¯æŒ</li>
</ul>
]]></content>
      <categories>
        <category>éšç¬”</category>
      </categories>
  </entry>
  <entry>
    <title>cssä¸jsçš„é˜»å¡å…³ç³»</title>
    <url>/2018/10/01/2018Q4/css%E4%B8%8Ejs%E7%9A%84%E9%98%BB%E5%A1%9E%E5%85%B3%E7%B3%BB/</url>
    <content><![CDATA[<p>åœ¨ html çš„è§£æè¿‡ç¨‹ä¸­ï¼Œæ ·å¼æ–‡ä»¶å’Œè„šæœ¬æ–‡ä»¶ä¹‹é—´æ˜¯å¦æœ‰ä¾èµ–å…³ç³»å‘¢ï¼Ÿ</p>
<p>æˆ‘ä»¬ç»å¸¸çœ‹åˆ°è¿™æ ·ä¸€å¥è¯</p>
<blockquote>
<p>æµè§ˆå™¨å°†å»¶è¿Ÿè„šæœ¬æ‰§è¡Œå’Œ DOM æ„å»ºï¼Œç›´è‡³å…¶å®Œæˆ CSSOM çš„ä¸‹è½½å’Œæ„å»º</p>
</blockquote>
<a id="more"></a>

<p>(å¼•è‡ª:<a href="https://developers.google.com/web/fundamentals/performance/critical-rendering-path/adding-interactivity-with-javascript?hl=zh-cn" target="_blank" rel="noopener">ä½¿ç”¨ JavaScript æ·»åŠ äº¤äº’</a></p>
<p>ç®€å•è¿›è¡Œäº†ä»¥ä¸‹æµ‹è¯•</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>é¡µé¢<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"><span class="keyword">var</span> start = +<span class="keyword">new</span> <span class="built_in">Date</span>;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> end1 = +<span class="keyword">new</span> <span class="built_in">Date</span>;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(end1-start);</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> end2 = +<span class="keyword">new</span> <span class="built_in">Date</span>;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(end2-start);</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"./css/style.css"</span> /&gt;</span></span><br><span class="line">   </span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> end3 = +<span class="keyword">new</span> <span class="built_in">Date</span>;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(end3-start);</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">"span"</span>&gt;</span>test<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> end4 = +<span class="keyword">new</span> <span class="built_in">Date</span>;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(end4-start);</span></span><br><span class="line"><span class="javascript">    <span class="built_in">document</span>.getElementById(<span class="string">"span"</span>).style.height = <span class="string">"20px"</span>;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> end5 = +<span class="keyword">new</span> <span class="built_in">Date</span>;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(end5-start);</span></span><br><span class="line"><span class="actionscript">    alert((end1-start)+<span class="string">','</span>+(end2-start)+<span class="string">','</span>+(end3-start)+<span class="string">','</span>+(end4-start)+<span class="string">','</span>+(end5-start))</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>å¾—åˆ°äº†è¿™æ ·çš„ç»“æœ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0</span><br><span class="line">3</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">83</span><br></pre></td></tr></table></figure>

<p>è¯´æ˜ script çš„æ‰§è¡Œéœ€è¦ç­‰å¾…å‰é¢ css çš„æ‰§è¡Œã€‚</p>
<p>åˆçœ‹åˆ°è¿™æ ·ä¸€å¥è¯ï¼š</p>
<blockquote>
<p>Firefox åœ¨æ ·å¼è¡¨åŠ è½½å’Œè§£æçš„è¿‡ç¨‹ä¸­ï¼Œä¼šç¦æ­¢æ‰€æœ‰è„šæœ¬ã€‚è€Œå¯¹äº WebKit è€Œè¨€ï¼Œä»…å½“è„šæœ¬å°è¯•è®¿é—®çš„æ ·å¼å±æ€§å¯èƒ½å—å°šæœªåŠ è½½çš„æ ·å¼è¡¨å½±å“æ—¶ï¼Œå®ƒæ‰ä¼šç¦æ­¢è¯¥è„šæœ¬ã€‚</p>
</blockquote>
<p>(å¼•è‡ª:<a href="https://www.html5rocks.com/zh/tutorials/internals/howbrowserswork/#Tree_construction_algorithm" target="_blank" rel="noopener">æµè§ˆå™¨çš„å·¥ä½œåŸç†</a></p>
<p>ä½†æµ‹è¯•äº†ios safari 12(WebKit),å‘ç°è¿˜æ˜¯ä¼šç¦ç”¨è„šæœ¬ï¼Œè„šæœ¬è¿˜æ˜¯ä¼šè¢«æ ·å¼é˜»å¡</p>
<p>å‡è®¾èƒ½å®ç°ï¼Œå¼•æ“æ˜¯å¦‚ä½•åˆ¤æ–­è„šæœ¬ä¸­è®¿é—®çš„æ ·å¼ä¼šå—æœªåŠ è½½çš„æ ·å¼è¡¨å½±å“ï¼Ÿæ¬¢è¿æ¢è®¨</p>
]]></content>
      <categories>
        <category>å¤§å‰ç«¯</category>
      </categories>
      <tags>
        <tag>HTML</tag>
      </tags>
  </entry>
  <entry>
    <title>adblockplus.jsæºç è§£æ</title>
    <url>/2018/09/15/2018Q3/adblockplus.js%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/</url>
    <content><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>æœ¬æ¬¡åˆ†æçš„æ˜¯ <code>adblockplus</code> çš„ 3.3.2_0 ç‰ˆæœ¬ï¼Œ</p>
<p>æºç è§ <a href="https://github.com/adblockplus/adblockpluschrome" target="_blank" rel="noopener">adblockplus</a> </p>
<a id="more"></a>


<h1 id="è¯´æ˜"><a href="#è¯´æ˜" class="headerlink" title="è¯´æ˜"></a>è¯´æ˜</h1><p>æ¯ä¸ªæ¨¡å—çš„å†™æ³•å¤§è‡´éƒ½æ˜¯ä»¥ä¸‹è¿™æ ·çš„</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">require</span>.scopes.xxx = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> obj =  &#123;&#125;</span><br><span class="line">  obj.Xxx = &#123;</span><br><span class="line">    <span class="comment">//å…¬æœ‰æ–¹æ³•</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> obj</span><br><span class="line">&#125;()</span><br></pre></td></tr></table></figure>

<p>å…¶ä»–æ¨¡å—ä½¿ç”¨</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> xxx = <span class="built_in">require</span>(<span class="string">"xxx"</span>).Xxx</span><br></pre></td></tr></table></figure>

<h1 id="æ¨¡å—è§£æ"><a href="#æ¨¡å—è§£æ" class="headerlink" title="æ¨¡å—è§£æ"></a>æ¨¡å—è§£æ</h1><h2 id="è¿‡æ»¤å™¨æ¨¡å—"><a href="#è¿‡æ»¤å™¨æ¨¡å—" class="headerlink" title="è¿‡æ»¤å™¨æ¨¡å—"></a>è¿‡æ»¤å™¨æ¨¡å—</h2><p>æ ¸å¿ƒä»£ç ï¼Œä» fromText å…¥æ‰‹</p>
<p>åœ¨ fromText ä¸­ï¼Œå¯¹è§„åˆ™è¿›è¡Œåˆ†ç±»ï¼Œæ„é€ ç›¸åº”çš„è¿‡æ»¤å™¨</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Cache for known filters, maps string representation to filter objects.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@type <span class="type">&#123;Map.&lt;string,Filter&gt;&#125;</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">Filter.knownFilters = <span class="keyword">new</span> <span class="built_in">Map</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Regular expression that content filters should match</span></span><br><span class="line"><span class="comment"> * åŒ¹é…å†…å®¹è¿‡æ»¤å™¨ï¼Œä¼šç»§ç»­ç»†åˆ† å…ƒç´ éšè— ç­‰è¿‡æ»¤å™¨</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@type <span class="type">&#123;RegExp&#125;</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">Filter.contentRegExp = <span class="regexp">/^([^/*|@"!]*?)#([@?$])?#(.+)$/</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Regular expression that RegExp filters specified as RegExps should match</span></span><br><span class="line"><span class="comment"> * åŒ¹é…æ­£åˆ™å½¢å¼çš„è§„åˆ™</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@type <span class="type">&#123;RegExp&#125;</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">Filter.regexpRegExp = <span class="regexp">/^(@@)?\/.*\/(?:\$~?[\w-]+(?:=[^,\s]+)?(?:,~?[\w-]+(?:=[^,\s]+)?)*)?$/</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Regular expression that options on a RegExp filter should match</span></span><br><span class="line"><span class="comment"> * åŒ¹é…è¿‡æ»¤è§„åˆ™é€‰é¡¹ï¼Œè¿™äº›é€‰é¡¹æ”¾åœ¨$å å¹¶ä»¥,åˆ†å‰²</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@type <span class="type">&#123;RegExp&#125;</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">Filter.optionsRegExp = <span class="regexp">/\$(~?[\w-]+(?:=[^,]*)?(?:,~?[\w-]+(?:=[^,]*)?)*)$/</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Regular expression that matches an invalid Content Security Policy</span></span><br><span class="line"><span class="comment"> * åŒ¹é…æ— æ•ˆçš„csp</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@type <span class="type">&#123;RegExp&#125;</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">Filter.invalidCSPRegExp = <span class="regexp">/(;|^) ?(base-uri|referrer|report-to|report-uri|upgrade-insecure-requests)\b/i</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Creates a filter of correct type from its text representation - does the</span></span><br><span class="line"><span class="comment"> * basic parsing and calls the right constructor then.</span></span><br><span class="line"><span class="comment"> * è§£æå•è¡Œå­—ç¬¦ä¸²ï¼Œæ„é€ ç›¸åº”è¿‡æ»¤å™¨</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;string&#125;</span> </span>text   as in Filter()</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return <span class="type">&#123;Filter&#125;</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">Filter.fromText = <span class="function"><span class="keyword">function</span>(<span class="params">text</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="comment">// åˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦å·²è¢«è§£ææˆè¿‡æ»¤å™¨</span></span><br><span class="line">  <span class="keyword">let</span> filter = Filter.knownFilters.get(text);</span><br><span class="line">  <span class="keyword">if</span> (filter)</span><br><span class="line">    <span class="keyword">return</span> filter;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> match = text.includes(<span class="string">"#"</span>) ? Filter.contentRegExp.exec(text) : <span class="literal">null</span>;</span><br><span class="line">  <span class="comment">//åŒ¹é…å†…å®¹è¿‡æ»¤å™¨</span></span><br><span class="line">  <span class="keyword">if</span> (match)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">let</span> propsMatch;</span><br><span class="line">    <span class="keyword">if</span> (!match[<span class="number">2</span>] &amp;&amp;</span><br><span class="line">        (propsMatch = <span class="regexp">/\[-abp-properties=(["'])([^"']+)\1\]/</span>.exec(match[<span class="number">3</span>])))</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">// This is legacy CSS properties syntax, convert to current syntax</span></span><br><span class="line">      <span class="comment">// è½¬åŒ–é—ç•™cssè¯­æ³•åˆ°å½“å‰è¯­æ³•--å¼•å·å½¢å¼å˜æˆæ‹¬å·å½¢å¼ï¼Œä¾‹[-abp-properties='width:300px;height:250px;'] will be converted to :-abp-properties(width:300px;height:250px;)</span></span><br><span class="line">      <span class="comment">// æ‹¬å·ä¸­å†…å®¹è¡¨ç¤ºèµ‹å€¼è¿™äº›å±æ€§ç»™å…ƒç´ style ; match[3] ï¼šé€‰æ‹©å™¨åŠ-abp-propertieså†…å®¹</span></span><br><span class="line">      <span class="comment">// </span></span><br><span class="line">      <span class="keyword">let</span> prefix = match[<span class="number">3</span>].substr(<span class="number">0</span>, propsMatch.index);</span><br><span class="line">      <span class="keyword">let</span> expression = propsMatch[<span class="number">2</span>];</span><br><span class="line">      <span class="keyword">let</span> suffix = match[<span class="number">3</span>].substr(propsMatch.index + propsMatch[<span class="number">0</span>].length);</span><br><span class="line">      <span class="keyword">return</span> Filter.fromText(<span class="string">`<span class="subst">$&#123;match[<span class="number">1</span>]&#125;</span>#?#`</span> +</span><br><span class="line">          <span class="string">`<span class="subst">$&#123;prefix&#125;</span>:-abp-properties(<span class="subst">$&#123;expression&#125;</span>)<span class="subst">$&#123;suffix&#125;</span>`</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    filter = ContentFilter.fromText(text, match[<span class="number">1</span>], match[<span class="number">2</span>], match[<span class="number">3</span>]);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//åŒ¹é…æ³¨é‡Šè§„åˆ™</span></span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (text[<span class="number">0</span>] == <span class="string">"!"</span>)</span><br><span class="line">    filter = <span class="keyword">new</span> CommentFilter(text);</span><br><span class="line">  <span class="comment">//åŒ¹é…æ­£åˆ™å½¢å¼è§„åˆ™</span></span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    filter = RegExpFilter.fromText(text);</span><br><span class="line">  <span class="comment">//ç¼“å­˜</span></span><br><span class="line">  Filter.knownFilters.set(filter.text, filter);</span><br><span class="line">  <span class="keyword">return</span> filter;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="å†…å®¹è¿‡æ»¤å™¨-ContentFilter"><a href="#å†…å®¹è¿‡æ»¤å™¨-ContentFilter" class="headerlink" title="å†…å®¹è¿‡æ»¤å™¨-ContentFilter"></a>å†…å®¹è¿‡æ»¤å™¨-ContentFilter</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">match = <span class="regexp">/^([^/*|@"!]*?)#([@?$])?#(.+)$/</span>.exec(text)</span><br><span class="line">ContentFilter.fromText(text, match[<span class="number">1</span>], match[<span class="number">2</span>], match[<span class="number">3</span>])</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Creates a content filter from a pre-parsed text representation</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;string&#125;</span> </span>text         same as in Filter()</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;string&#125;</span> </span>[domains]</span></span><br><span class="line"><span class="comment"> *   domains part of the text representation</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;string&#125;</span> </span>[type]</span></span><br><span class="line"><span class="comment"> *   rule type, either:</span></span><br><span class="line"><span class="comment"> *     &lt;li&gt;"" for an element hiding filter&lt;/li&gt;</span></span><br><span class="line"><span class="comment"> *     &lt;li&gt;"@" for an element hiding exception filter&lt;/li&gt;</span></span><br><span class="line"><span class="comment"> *     &lt;li&gt;"?" for an element hiding emulation filter&lt;/li&gt;</span></span><br><span class="line"><span class="comment"> *     &lt;li&gt;"$" for a snippet filter&lt;/li&gt;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;string&#125;</span> <span class="variable">body</span></span></span></span><br><span class="line"><span class="comment"> *   body part of the text representation, either a CSS selector or a snippet</span></span><br><span class="line"><span class="comment"> *   script</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return <span class="type">&#123;ElemHideFilter|ElemHideException|</span></span></span></span><br><span class="line"><span class="comment"><span class="doctag"><span class="type"> *          ElemHideEmulationFilter|SnippetFilter|InvalidFilter&#125;</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">ContentFilter.fromText = <span class="function"><span class="keyword">function</span>(<span class="params">text, domains, type, body</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="comment">// We don't allow content filters which have any empty domains.</span></span><br><span class="line">  <span class="comment">// Note: The ContentFilter.prototype.domainSeparator is duplicated here, if</span></span><br><span class="line">  <span class="comment">// that changes this must be changed too.</span></span><br><span class="line">  <span class="comment">// å­˜åœ¨ç©ºçš„åŸŸåï¼Œå³ 'a.com,,b.com' é€—å·ä¸­é—´ä¸ºç©ºï¼Œæ•…è¯¥è§„åˆ™æ— æ•ˆ</span></span><br><span class="line">  <span class="keyword">if</span> (domains &amp;&amp; <span class="regexp">/(^|,)~?(,|$)/</span>.test(domains))</span><br><span class="line">    <span class="comment">// æ— æ•ˆè¿‡æ»¤å™¨</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> InvalidFilter(text, <span class="string">"filter_invalid_domain"</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (type == <span class="string">"@"</span>)</span><br><span class="line">    <span class="comment">//å…ƒç´ éšè—ä¾‹å¤–è¿‡æ»¤å™¨ï¼Œå³åŒ¹é…è§„åˆ™çš„ä¸è¿›è¡Œå…ƒç´ éšè—</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ElemHideException(text, domains, body);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (type == <span class="string">"$"</span>)</span><br><span class="line">    <span class="comment">// scriptç‰‡æ®µè¿‡æ»¤å™¨ï¼Œç›®å‰ä»…æ‰¾åˆ°è¯¥æ¡è§„åˆ™</span></span><br><span class="line">    <span class="comment">// e.g. ipv6.baidu.com,xueshu.baidu.com,www.baidu.com,www1.baidu.com#$#hide-if-contains å¹¿å‘Š .c-container '.f13 &gt; .m'</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> SnippetFilter(text, domains, body);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (type == <span class="string">"?"</span>)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// Element hiding emulation filters are inefficient so we need to make sure</span></span><br><span class="line">    <span class="comment">// that they're only applied if they specify active domains</span></span><br><span class="line">    <span class="comment">// å…ƒç´ éšè—æ‹“å±•é€‰æ‹©å™¨è¿‡æ»¤å™¨ã€‚å¯ä»¥ä½¿ç”¨æ‹“å±•è¯­æ³•ï¼Œä½†æ˜¯æœ‰æ€§èƒ½å½±å“,éœ€è¦æŒ‡å®šåŸŸåä½¿ç”¨</span></span><br><span class="line">    <span class="comment">//e.g. 58.com#?#.ac_item:-abp-has(.jingpin) è§„åˆ™ç”¨åˆ°äº†-abp-hasæ‹“å±•é€‰æ‹©å™¨</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="regexp">/,[^~][^,.]*\.[^,]/</span>.test(<span class="string">","</span> + domains))</span><br><span class="line">      <span class="comment">//æœªè®¾ç½®åŸŸå</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> InvalidFilter(text, <span class="string">"filter_elemhideemulation_nodomain"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ElemHideEmulationFilter(text, domains, body);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//é»˜è®¤å…ƒç´ éšè—è¿‡æ»¤å™¨</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> ElemHideFilter(text, domains, body);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="æ³¨é‡Šè¿‡æ»¤å™¨-CommentFilter"><a href="#æ³¨é‡Šè¿‡æ»¤å™¨-CommentFilter" class="headerlink" title="æ³¨é‡Šè¿‡æ»¤å™¨-CommentFilter"></a>æ³¨é‡Šè¿‡æ»¤å™¨-CommentFilter</h3><p>ä¸åšå¤„ç†</p>
<h3 id="æ­£åˆ™è¿‡æ»¤å™¨-RegExpFilter"><a href="#æ­£åˆ™è¿‡æ»¤å™¨-RegExpFilter" class="headerlink" title="æ­£åˆ™è¿‡æ»¤å™¨-RegExpFilter"></a>æ­£åˆ™è¿‡æ»¤å™¨-RegExpFilter</h3><h3 id="æ— æ•ˆè¿‡æ»¤å™¨-InvalidFilter"><a href="#æ— æ•ˆè¿‡æ»¤å™¨-InvalidFilter" class="headerlink" title="æ— æ•ˆè¿‡æ»¤å™¨-InvalidFilter"></a>æ— æ•ˆè¿‡æ»¤å™¨-InvalidFilter</h3><h2 id="åŒ¹é…å™¨-Matcher"><a href="#åŒ¹é…å™¨-Matcher" class="headerlink" title="åŒ¹é…å™¨ Matcher"></a>åŒ¹é…å™¨ Matcher</h2><p>è§„åˆ™åŒ¹é…è¿‡æ»¤å™¨çš„è¿‡ç¨‹</p>
<ol>
<li>å°†urlåˆ†å‰²æˆå…³é”®å­—å€™é€‰åˆ—è¡¨<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Tests whether the URL matches any of the known filters</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;string&#125;</span> <span class="variable">location</span></span></span></span><br><span class="line"><span class="comment"> *   URL to be tested</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;number&#125;</span> <span class="variable">typeMask</span></span></span></span><br><span class="line"><span class="comment"> *   bitmask of content / request types to match</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;string&#125;</span> <span class="variable">docDomain</span></span></span></span><br><span class="line"><span class="comment"> *   domain name of the document that loads the URL</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;boolean&#125;</span> <span class="variable">thirdParty</span></span></span></span><br><span class="line"><span class="comment"> *   should be true if the URL is a third-party request</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;string&#125;</span> <span class="variable">sitekey</span></span></span></span><br><span class="line"><span class="comment"> *   public key provided by the document</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;boolean&#125;</span> <span class="variable">specificOnly</span></span></span></span><br><span class="line"><span class="comment"> *   should be true if generic matches should be ignored</span></span><br><span class="line"><span class="comment"> *   éé€šç”¨åŒ¹é…ï¼Œå³å«æœ‰cssæ‹“å±•é€‰æ‹©å™¨</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return <span class="type">&#123;?RegExpFilter&#125;</span></span></span></span><br><span class="line"><span class="comment"> *   matching filter or null</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">matchesAny(location, typeMask, docDomain, thirdParty, sitekey, specificOnly)&#125;&#123;</span><br><span class="line">  <span class="keyword">let</span> candidates = location.toLowerCase().match(<span class="regexp">/[a-z0-9%]&#123;3,&#125;/g</span>);</span><br><span class="line">  <span class="keyword">if</span> (candidates === <span class="literal">null</span>)candidates = [];</span><br><span class="line">  candidates.push(<span class="string">""</span>);</span><br><span class="line">  <span class="comment">//2.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>éå†å…³é”®å­—å€™é€‰åˆ—è¡¨ï¼Œåˆ¤æ–­è¯¥urlå±äºå“ªä¸ªè¿‡æ»¤å™¨<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> blacklistHit = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>, l = candidates.length; i &lt; l; i++) &#123;</span><br><span class="line">  <span class="keyword">let</span> substr = candidates[i];</span><br><span class="line">  <span class="comment">//åœ¨ç™½åå•åˆ—è¡¨ä¸­ï¼Œç›´æ¥è¿”å›</span></span><br><span class="line">  <span class="keyword">let</span> result = <span class="keyword">this</span>.whitelist._checkEntryMatch(</span><br><span class="line">    substr, location, typeMask, docDomain, thirdParty, sitekey</span><br><span class="line">  );</span><br><span class="line">  <span class="keyword">if</span> (result)</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  <span class="keyword">if</span> (blacklistHit === <span class="literal">null</span>) &#123;</span><br><span class="line">    blacklistHit = <span class="keyword">this</span>.blacklist._checkEntryMatch(</span><br><span class="line">      substr, location, typeMask, docDomain, thirdParty, sitekey,</span><br><span class="line">      specificOnly</span><br><span class="line">    );</span><br><span class="line">    <span class="comment">//è¿™é‡Œå‘½ä¸­é»‘åå•ä¸ç›´æ¥è¿”å›åŸå› æ˜¯ä¸ºäº†ç¡®ä¿æ²¡æœ‰å…³é”®å­—å€™é€‰å‘½ä¸­ç™½åå•</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> blacklistHit;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<ul>
<li>_checkEntryMatch è¿‡ç¨‹</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">_checkEntryMatch(keyword, location, typeMask, docDomain, thirdParty, sitekey, specificOnly) &#123;</span><br><span class="line">          <span class="comment">//è·å–å…³é”®å­—å¯¹åº”çš„è¿‡æ»¤å™¨åˆ—è¡¨</span></span><br><span class="line">          <span class="keyword">let</span> list = <span class="keyword">this</span>.filterByKeyword.get(keyword);</span><br><span class="line">          <span class="keyword">if</span> (<span class="keyword">typeof</span> list == <span class="string">"undefined"</span>) &#123; <span class="keyword">return</span> <span class="literal">null</span>; &#125;</span><br><span class="line">          <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; list.length; i++) &#123;</span><br><span class="line">            <span class="keyword">let</span> filter = list[i];</span><br><span class="line">            <span class="comment">// å±äºcssæ‹“å±•è§„åˆ™ï¼Œè€Œè¯¥è¿‡æ»¤å™¨åŒ¹é…é€šç”¨è§„åˆ™ä¸”ä¸åœ¨ç™½åå•ï¼ˆä¾‹å¤–è§„åˆ™è¿‡æ»¤å™¨ï¼‰ä¸­ï¼Œåˆ™è·³è¿‡</span></span><br><span class="line">            <span class="keyword">if</span> (specificOnly &amp;&amp; filter.isGeneric() &amp;&amp;</span><br><span class="line">              !(filter <span class="keyword">instanceof</span> WhitelistFilter))</span><br><span class="line">              <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (filter.matches(location, typeMask, docDomain, thirdParty, sitekey))</span><br><span class="line">              <span class="keyword">return</span> filter;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;,</span><br></pre></td></tr></table></figure>

<ul>
<li>è¿‡æ»¤å™¨åŒ¹é…</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Tests whether the URL matches this filter</span></span><br><span class="line"><span class="comment">         * URLæ˜¯å¦åŒ¹é…è¯¥è¿‡æ»¤å™¨</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param <span class="type">&#123;string&#125;</span> </span>location URL to be tested</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param <span class="type">&#123;number&#125;</span> </span>typeMask bitmask of content / request types to match</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param <span class="type">&#123;string&#125;</span> </span>[docDomain] domain name of the document that loads the URL</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param <span class="type">&#123;boolean&#125;</span> </span>[thirdParty] should be true if the URL is a third-party</span></span><br><span class="line"><span class="comment">         *                               request</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param <span class="type">&#123;string&#125;</span> </span>[sitekey] public key provided by the document</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@return <span class="type">&#123;boolean&#125;</span> </span>true in case of a match</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        matches(location, typeMask, docDomain, thirdParty, sitekey) &#123;</span><br><span class="line">          <span class="keyword">if</span> (<span class="keyword">this</span>.contentType &amp; typeMask &amp;&amp;</span><br><span class="line">            (<span class="keyword">this</span>.thirdParty == <span class="literal">null</span> || <span class="keyword">this</span>.thirdParty == thirdParty) &amp;&amp;</span><br><span class="line">            <span class="keyword">this</span>.isActiveOnDomain(docDomain, sitekey) &amp;&amp; <span class="keyword">this</span>.regexp.test(location)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>å…³é”®å­—æ·»åŠ è¿‡æ»¤å™¨è¿‡ç¨‹</li>
</ul>
<blockquote>
<p>ä¸‹è½½è§„åˆ™åº“ï¼Œurlåˆ†æï¼Œåˆå§‹åŒ–</p>
</blockquote>
<p>æœªå®Œå¾…ç»­â€¦</p>
]]></content>
      <categories>
        <category>å¤§å‰ç«¯</category>
      </categories>
  </entry>
  <entry>
    <title>å‰ç«¯å®ç°ç›¸å¯¹è·¯å¾„è½¬ç»å¯¹è·¯å¾„çš„å‡ ç§æ–¹æ³•</title>
    <url>/2018/08/16/2018Q3/js_%E7%9B%B8%E5%AF%B9%E8%B7%AF%E5%BE%84%E8%BD%AC%E7%BB%9D%E5%AF%B9%E8%B7%AF%E5%BE%84/</url>
    <content><![CDATA[<h2 id="1-ä½¿ç”¨aæ ‡ç­¾"><a href="#1-ä½¿ç”¨aæ ‡ç­¾" class="headerlink" title="1.ä½¿ç”¨aæ ‡ç­¾"></a>1.ä½¿ç”¨aæ ‡ç­¾</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getAbsoluteUrlByA</span> (<span class="params">url</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> a = <span class="built_in">document</span>.createElement(<span class="string">"a"</span>)</span><br><span class="line">  a.href = url</span><br><span class="line">  a.href = a.href <span class="comment">//ie8çš„é—®é¢˜</span></span><br><span class="line">  <span class="keyword">return</span> a.href</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<a id="more"></a>

<p>æ³¨ï¼šnode.js ä¸é€‚ç”¨</p>
<h2 id="2-æ•°ç»„å¤„ç†"><a href="#2-æ•°ç»„å¤„ç†" class="headerlink" title="2.æ•°ç»„å¤„ç†"></a>2.æ•°ç»„å¤„ç†</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getAbsoluteUrl</span>(<span class="params">url</span>) </span>&#123;</span><br><span class="line">  url = url.replace(<span class="regexp">/&amp;amp;|&amp;#38;/g</span>, <span class="string">"&amp;"</span>);</span><br><span class="line">  <span class="keyword">if</span> (url.startsWith(<span class="string">"http"</span>) || url.startsWith(<span class="string">"javascript:"</span>) || url === <span class="string">"about:blank"</span>) <span class="keyword">return</span> url;</span><br><span class="line">  <span class="keyword">if</span> (url.startsWith(<span class="string">"//"</span>)) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">window</span>.location.protocol + url</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">var</span> stack = <span class="built_in">window</span>.location.href.split(<span class="string">"/"</span>);</span><br><span class="line">  stack.pop()</span><br><span class="line">  <span class="keyword">var</span> parts = url.split(<span class="string">"/"</span>)</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; parts.length; i++) &#123;</span><br><span class="line">      <span class="keyword">if</span> (parts[i] == <span class="string">"."</span>)</span><br><span class="line">          <span class="keyword">continue</span>;</span><br><span class="line">      <span class="keyword">if</span> (parts[i] == <span class="string">".."</span>)</span><br><span class="line">          stack.pop();</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">          stack.push(parts[i]);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> stack.join(<span class="string">"/"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å‚è€ƒ<a href="https://stackoverflow.com/questions/14780350/convert-relative-path-to-absolute-using-javascript" target="_blank" rel="noopener">stackoverflow</a></p>
<h2 id="3-æ­£åˆ™å­—ç¬¦æ›¿æ¢"><a href="#3-æ­£åˆ™å­—ç¬¦æ›¿æ¢" class="headerlink" title="3.æ­£åˆ™å­—ç¬¦æ›¿æ¢"></a>3.æ­£åˆ™å­—ç¬¦æ›¿æ¢</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">relPathToAbs</span> (<span class="params">sRelPath</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> nUpLn, sDir = <span class="string">""</span>, sPath = location.pathname.replace(<span class="regexp">/[^\/]*$/</span>, sRelPath.replace(<span class="regexp">/(\/|^)(?:\.?\/+)+/g</span>, <span class="string">"$1"</span>));</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> nEnd, nStart = <span class="number">0</span>; nEnd = sPath.indexOf(<span class="string">"/../"</span>, nStart), nEnd &gt; <span class="number">-1</span>; nStart = nEnd + nUpLn) &#123;</span><br><span class="line">    nUpLn = <span class="regexp">/^\/(?:\.\.\/)*/</span>.exec(sPath.slice(nEnd))[<span class="number">0</span>].length;</span><br><span class="line">    sDir = (sDir + sPath.substring(nStart, nEnd)).replace(<span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">"(?:\\\/+[^\\\/]*)&#123;0,"</span> + ((nUpLn - <span class="number">1</span>) / <span class="number">3</span>) + <span class="string">"&#125;$"</span>), <span class="string">"/"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> sDir + sPath.substr(nStart);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è½¬è‡ª<a href="https://developer.mozilla.org/en-US/docs/Web/API/document/cookie#Using_relative_URLs_in_the_path_parameter" target="_blank" rel="noopener">MDN</a></p>
<h2 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h2><p>æµ‹è¯•å¤šæ¬¡,æ€»ä½“é€Ÿåº¦ç›¸è¿‘ï¼Œç¬¬äºŒç§å¯èƒ½ä¼šå¿«ä¸€ç‚¹ç‚¹</p>
]]></content>
      <categories>
        <category>å¤§å‰ç«¯</category>
      </categories>
  </entry>
  <entry>
    <title>å¦‚ä½•å®ç° script å¹¶è¡Œå¼‚æ­¥åŠ è½½é¡ºåºæ‰§è¡Œ</title>
    <url>/2018/08/10/2018Q3/js%E5%BC%82%E6%AD%A5%E5%8A%A0%E8%BD%BD%E9%A1%BA%E5%BA%8F%E6%89%A7%E8%A1%8C/</url>
    <content><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>å‰ç«¯ä¼˜åŒ–æœ‰ä¸ªåŸåˆ™ï¼Œå«èµ„æºæ‡’åŠ è½½ã€‚</p>
<p>å¯¹äºæŸäº›jsèµ„æºï¼Œæˆ‘ä»¬åœ¨é¡µé¢loadå‰å¹¶ä¸éœ€è¦ç”¨åˆ°ï¼ŒåŠ è½½åè€Œä¼šå½±å“åˆ°é¦–å±é€Ÿåº¦ã€‚</p>
<p>æŠŠè¿™äº›jsæ”¾åˆ° load åè¿›è¡ŒåŠ è½½ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºjså¼‚æ­¥åŠ è½½ã€‚</p>
<a id="more"></a>

<h1 id="å¼‚æ­¥åŠ è½½çš„æ‰‹æ®µ"><a href="#å¼‚æ­¥åŠ è½½çš„æ‰‹æ®µ" class="headerlink" title="å¼‚æ­¥åŠ è½½çš„æ‰‹æ®µ"></a>å¼‚æ­¥åŠ è½½çš„æ‰‹æ®µ</h1><h2 id="1-æœ€ç®€å•çš„åšæ³•ï¼šScript-Dom"><a href="#1-æœ€ç®€å•çš„åšæ³•ï¼šScript-Dom" class="headerlink" title="1. æœ€ç®€å•çš„åšæ³•ï¼šScript Dom"></a>1. æœ€ç®€å•çš„åšæ³•ï¼šScript Dom</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> script = <span class="built_in">document</span>.createElement(<span class="string">"script"</span>)</span><br><span class="line">script.src=<span class="string">"xxx.js"</span></span><br><span class="line"><span class="built_in">document</span>.head.appendChild(script)</span><br></pre></td></tr></table></figure>
<p>å¤šä¸ªjsæˆ‘ä»¬è¿›è¡Œå¾ªç¯å³å¯</p>
<h3 id="å­˜åœ¨çš„é—®é¢˜ï¼š"><a href="#å­˜åœ¨çš„é—®é¢˜ï¼š" class="headerlink" title="å­˜åœ¨çš„é—®é¢˜ï¼š"></a>å­˜åœ¨çš„é—®é¢˜ï¼š</h3><ol>
<li>å¤§éƒ¨åˆ†æµè§ˆå™¨ä¸ä¼šé¡ºåºæ‰§è¡Œscript,(firefoxã€operaæŸäº›ç‰ˆæœ¬å¯ä»¥)ï¼Œå¯¹äºæœ‰ä¾èµ–çš„è„šæœ¬ä¼šå‡ºç°å„ç§æœªå®šä¹‰é”™è¯¯å’Œé€»è¾‘é”™è¯¯</li>
</ol>
<h2 id="2-script-onloadåå†å‘èµ·è¯·æ±‚ï¼ŒæŒ‰åºä¸‹è½½-æ‰§è¡Œ"><a href="#2-script-onloadåå†å‘èµ·è¯·æ±‚ï¼ŒæŒ‰åºä¸‹è½½-æ‰§è¡Œ" class="headerlink" title="2. script onloadåå†å‘èµ·è¯·æ±‚ï¼ŒæŒ‰åºä¸‹è½½-æ‰§è¡Œ"></a>2. script onloadåå†å‘èµ·è¯·æ±‚ï¼ŒæŒ‰åºä¸‹è½½-æ‰§è¡Œ</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// é¡ºåºä¸‹è½½å’Œæ‰§è¡Œ</span></span><br><span class="line">AsyncLoad.sync = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * åŠ è½½jså¹¶æ”¾å…¥æ‰§è¡Œé˜Ÿåˆ—ä¸­</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;string&#125;</span> </span>url </span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;string&#125;</span> </span>[type="normal"] scriptç±»å‹ï¼Œnormalä¸ºæ™®é€šjsæ­¤å¤–è¿˜æœ‰asyncã€defer</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;function&#125;</span> </span>callback </span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">var</span> normalQueue = []</span><br><span class="line">  <span class="keyword">var</span> deferQueue = []</span><br><span class="line">  <span class="keyword">var</span> processedNum = <span class="number">0</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">loadScript</span>(<span class="params">url, type, callback</span>) </span>&#123;</span><br><span class="line">    type = type || <span class="string">'normal'</span></span><br><span class="line">    <span class="keyword">switch</span> (type) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">'defer'</span>:</span><br><span class="line">        <span class="keyword">var</span> dqId = deferQueue.length</span><br><span class="line">        <span class="comment">//cached: &lt;object&gt;ç¼“å­˜æˆåŠŸ done: æ˜¯å¦æ‰§è¡ŒscriptæˆåŠŸ</span></span><br><span class="line">        deferQueue[dqId] = &#123; <span class="attr">url</span>: url, <span class="attr">cached</span>: <span class="literal">false</span>, <span class="attr">done</span>: <span class="literal">false</span>, <span class="attr">onload</span>: callback &#125;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">'async'</span>:</span><br><span class="line">        <span class="keyword">var</span> script = <span class="built_in">document</span>.createElement(<span class="string">'script'</span>)</span><br><span class="line">        script.onload = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">          <span class="keyword">if</span> (callback) &#123;</span><br><span class="line">            callback();</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        script.src = url</span><br><span class="line">        <span class="built_in">document</span>.head.appendChild(script)</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">var</span> nqId = normalQueue.length</span><br><span class="line">        normalQueue[nqId] = &#123; <span class="attr">url</span>: url, <span class="attr">cached</span>: <span class="literal">false</span>, <span class="attr">done</span>: <span class="literal">false</span>, <span class="attr">onload</span>: callback &#125;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//é¡ºåºæ‰§è¡Œ</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">processScripts</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (deferQueue.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      normalQueue = normalQueue.concat(deferQueue)</span><br><span class="line">      deferQueue = []</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// é‡åˆ°æœ‰srcçš„å°±ä¸­æ–­æ‰§è¡Œ</span></span><br><span class="line">    <span class="keyword">if</span> (processedNum &lt; normalQueue.length) &#123;</span><br><span class="line">      <span class="keyword">var</span> head = <span class="built_in">document</span>.head;</span><br><span class="line">      <span class="keyword">var</span> newScript = <span class="built_in">document</span>.createElement(<span class="string">'script'</span>);</span><br><span class="line">      newScript.type = <span class="string">'text/javascript'</span>;</span><br><span class="line">      newScript.src = normalQueue[processedNum].url;</span><br><span class="line">      newScript.onload = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        processScripts();</span><br><span class="line">      &#125;</span><br><span class="line">      newScript.onerror=newScript.onload</span><br><span class="line">      processedNum++;</span><br><span class="line">      head.appendChild(newScript);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    loadScript: loadScript,</span><br><span class="line">    processScripts: processScripts</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure>

<p>ç”¨æ³•(åé¢çš„æ–¹æ³•å°±æŠŠ sync æ¢æˆå„è‡ªæ–¹æ³•å)ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> AL = AsyncLoad.sync</span><br><span class="line">AL.loadScript(<span class="string">'./js/d.js'</span>, <span class="string">'defer'</span>, () =&gt; <span class="built_in">console</span>.log(<span class="string">"defer 1 åŠ è½½å®Œæ¯•"</span>))</span><br><span class="line">AL.loadScript(<span class="string">'./js/a.js'</span>, <span class="string">'normal'</span>, () =&gt; <span class="built_in">console</span>.log(<span class="string">"a.jsåŠ è½½å®Œæ¯•"</span>))</span><br><span class="line">AL.loadScript(<span class="string">'./js/b.js'</span>, <span class="string">''</span>, () =&gt; <span class="built_in">console</span>.log(<span class="string">"async 1 åŠ è½½å®Œæ¯•"</span>))</span><br></pre></td></tr></table></figure>
<h3 id="å­˜åœ¨çš„é—®é¢˜ï¼š-1"><a href="#å­˜åœ¨çš„é—®é¢˜ï¼š-1" class="headerlink" title="å­˜åœ¨çš„é—®é¢˜ï¼š"></a>å­˜åœ¨çš„é—®é¢˜ï¼š</h3><ol>
<li>ä¸æµè§ˆå™¨é¡µé¢è§£ææ—¶çš„å¹¶å‘ä¸‹è½½é¡ºåºæ‰§è¡Œé€»è¾‘ä¸åŒï¼Œä¸èƒ½å……åˆ†åˆ©ç”¨IO/CPUçš„å¹¶è¡Œæ“ä½œï¼Œè€—æ—¶ä¼šè¾ƒä¹…ã€‚ä¸”å½“å‡ºç°æŸä¸ªèµ„æºè¯·æ±‚è¾ƒä¹…æ—¶ä¼šå½±å“ä¼šæ›´ä¸¥é‡ã€‚</li>
</ol>
<h2 id="3-XHR-eval"><a href="#3-XHR-eval" class="headerlink" title="3. XHR+eval"></a>3. XHR+eval</h2><p>åˆ©ç”¨ajaxè¯·æ±‚jsæ•°æ®ï¼Œä¿å­˜å“åº”å†…å®¹ï¼Œå¹¶æŒ‰åºevalã€‚å¯ä»¥åšåˆ°å¹¶è¡Œä¸‹è½½ï¼ŒæŒ‰åºæ‰§è¡Œ</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">AsyncLoad.xhr = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> queuedScripts = []</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">loadScript</span>(<span class="params">url, type, onload</span>) </span>&#123;</span><br><span class="line">    type = type || <span class="string">'normal'</span></span><br><span class="line">    <span class="keyword">var</span> iQ = queuedScripts.length;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¦‚æœéœ€è¦æŒ‰é¡ºåºæ‰§è¡Œï¼Œå¹¶å°†è„šæœ¬å¯¹è±¡æ”¾å…¥æ•°ç»„</span></span><br><span class="line">    <span class="keyword">if</span> (type !== <span class="string">'async'</span>) &#123;</span><br><span class="line">      <span class="keyword">var</span> qScript = &#123; <span class="attr">response</span>: <span class="literal">null</span>, <span class="attr">onload</span>: onload, <span class="attr">done</span>: <span class="literal">false</span> &#125;;</span><br><span class="line">      queuedScripts[iQ] = qScript;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è°ƒç”¨AJAX</span></span><br><span class="line">    <span class="keyword">var</span> xhrObj = getXHRObject();</span><br><span class="line">    xhrObj.onreadystatechange = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (xhrObj.readyState == <span class="number">4</span>) &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (type !== <span class="string">'async'</span>) &#123;</span><br><span class="line">          queuedScripts[iQ].response = xhrObj.responseText;</span><br><span class="line">          injectScripts();</span><br><span class="line"></span><br><span class="line">          <span class="comment">//å¦‚æœä¸éœ€è¦æŒ‰é¡ºåºæ‰§è¡Œï¼Œå³ç«‹å³åŠ è½½è„šæœ¬</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="built_in">eval</span>(xhrObj.responseText);</span><br><span class="line">          <span class="keyword">if</span> (onload) &#123;</span><br><span class="line">            onload();</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    xhrObj.open(<span class="string">'GET'</span>, url, <span class="literal">true</span>);</span><br><span class="line">    xhrObj.send(<span class="string">''</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">injectScripts</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> len = queuedScripts.length;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">      <span class="keyword">var</span> qScript = queuedScripts[i];</span><br><span class="line"></span><br><span class="line">      <span class="comment">//å·²åŠ è½½çš„è„šæœ¬</span></span><br><span class="line">      <span class="keyword">if</span> (!qScript.done) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å¦‚æœå“åº”æœªè¿”å› ç«‹å³åœæ­¢</span></span><br><span class="line">        <span class="keyword">if</span> (!qScript.response) &#123;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">          <span class="comment">//æ‰§è¡Œè„šæœ¬</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="built_in">eval</span>(qScript.response);</span><br><span class="line">          <span class="keyword">if</span> (qScript.onload) &#123;</span><br><span class="line">            qScript.onload();</span><br><span class="line">          &#125;</span><br><span class="line">          qScript.done = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//AJAXå¯¹è±¡</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">getXHRObject</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> xhrObj = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      xhrObj = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      <span class="keyword">var</span> aTypes = [<span class="string">"Msxm12.XMLHTTP6.0"</span>,</span><br><span class="line">        <span class="string">"Msxm12.XMLHTTP3.0"</span>,</span><br><span class="line">        <span class="string">"Msxm12.XMLHTTP"</span>,</span><br><span class="line">        <span class="string">"Microsoft.XMLHTTP"</span>];</span><br><span class="line">      <span class="keyword">var</span> len = aTypes.length;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">          xhrObj = <span class="keyword">new</span> ActiveXObject(aTypes[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">          <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">finally</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> xhrObj;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    loadScript: loadScript,</span><br><span class="line">    processScripts:<span class="function"><span class="params">()</span>=&gt;</span>&#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure>


<h3 id="å­˜åœ¨çš„é—®é¢˜ï¼š-2"><a href="#å­˜åœ¨çš„é—®é¢˜ï¼š-2" class="headerlink" title="å­˜åœ¨çš„é—®é¢˜ï¼š"></a>å­˜åœ¨çš„é—®é¢˜ï¼š</h3><ol>
<li>è·¨åŸŸé—®é¢˜</li>
</ol>
<h2 id="4-object-tag-é¢„åŠ è½½èµ„æºï¼Œscript-onload-æŒ‰åºä¸‹è½½-å‘½ä¸­ç¼“å­˜-æ‰§è¡Œ"><a href="#4-object-tag-é¢„åŠ è½½èµ„æºï¼Œscript-onload-æŒ‰åºä¸‹è½½-å‘½ä¸­ç¼“å­˜-æ‰§è¡Œ" class="headerlink" title="4. object tag é¢„åŠ è½½èµ„æºï¼Œscript onload æŒ‰åºä¸‹è½½(å‘½ä¸­ç¼“å­˜)-æ‰§è¡Œ"></a>4. object tag é¢„åŠ è½½èµ„æºï¼Œscript onload æŒ‰åºä¸‹è½½(å‘½ä¸­ç¼“å­˜)-æ‰§è¡Œ</h2><p><a href="https://github.com/stevesouders/controljs/blob/master/control.js" target="_blank" rel="noopener">contorl.jsäºŒæ¬¡å‘½ä¸­ç¼“å­˜å®ç°å¹¶è¡Œä¸‹è½½é¡ºåºæ‰§è¡Œï¼Œä½†æ˜¯å®ƒé€šè¿‡setTimeoutæŸ¥è¯¢æ˜¯å¦æ‰§è¡Œå®Œæ¯•ï¼Œæ¯”æˆ‘çš„å®ç°å·®ç‚¹</a></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">AsyncLoad.object = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * åŠ è½½jså¹¶æ”¾å…¥æ‰§è¡Œé˜Ÿåˆ—ä¸­</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;string&#125;</span> </span>url </span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;string&#125;</span> </span>[type="normal"] scriptç±»å‹ï¼Œnormalä¸ºæ™®é€šjsæ­¤å¤–è¿˜æœ‰asyncã€defer</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;function&#125;</span> </span>callback </span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">var</span> normalQueue = []</span><br><span class="line">  <span class="keyword">var</span> deferQueue = []</span><br><span class="line">  <span class="keyword">var</span> isExecuting = <span class="literal">false</span> <span class="comment">//domæ’å…¥scriptåˆ°scriptæ‰§è¡Œå®Œæ¯•è¿™æ®µè¿‡ç¨‹ å–å€¼ä¸ºtrue</span></span><br><span class="line">  <span class="keyword">var</span> waitNum = <span class="number">0</span> <span class="comment">// å¾…æ‰§è¡ŒinjectScriptsçš„ä¸ªæ•°</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">loadScript</span>(<span class="params">url, type, callback</span>) </span>&#123;</span><br><span class="line">    type = type || <span class="string">'normal'</span></span><br><span class="line">    <span class="keyword">switch</span> (type) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">'defer'</span>:</span><br><span class="line">        <span class="keyword">var</span> dqId = deferQueue.length</span><br><span class="line">        <span class="comment">//cached: &lt;object&gt;ç¼“å­˜æˆåŠŸ done: æ˜¯å¦æ‰§è¡ŒscriptæˆåŠŸ</span></span><br><span class="line">        deferQueue[dqId] = &#123; <span class="attr">url</span>: url, <span class="attr">cached</span>: <span class="literal">false</span>, <span class="attr">done</span>: <span class="literal">false</span>, <span class="attr">onload</span>: callback &#125;</span><br><span class="line">        preload(deferQueue[dqId])</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">'async'</span>:</span><br><span class="line">        <span class="keyword">var</span> script = <span class="built_in">document</span>.createElement(<span class="string">'script'</span>)</span><br><span class="line">        script.onload = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">          <span class="keyword">if</span> (callback) &#123;</span><br><span class="line">            callback();</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        script.src = url</span><br><span class="line">        <span class="built_in">document</span>.head.appendChild(script)</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">var</span> nqId = normalQueue.length</span><br><span class="line">        normalQueue[nqId] = &#123; <span class="attr">url</span>: url, <span class="attr">cached</span>: <span class="literal">false</span>, <span class="attr">done</span>: <span class="literal">false</span>, <span class="attr">onload</span>: callback &#125;</span><br><span class="line">        preload(normalQueue[nqId])</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;any&#125;</span> </span>item é˜Ÿåˆ—å…ƒç´ </span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">preload</span>(<span class="params">item</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//chromeä¼šå‡ºç°Resource interpreted as Document but transferred with MIME type application/javascriptè­¦å‘Š</span></span><br><span class="line">    <span class="keyword">var</span> obj = <span class="built_in">document</span>.createElement(<span class="string">'object'</span>);</span><br><span class="line">    <span class="comment">// console.log(item.url, 'preload...')</span></span><br><span class="line">    obj.onload = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">// console.log(item.url, 'object cached...', isExecuting, waitNum)</span></span><br><span class="line">      <span class="comment">//è§¦å‘scriptæ ‡ç­¾æ’å…¥</span></span><br><span class="line">      item.cached = <span class="literal">true</span></span><br><span class="line">      obj.onload = <span class="literal">null</span></span><br><span class="line">      <span class="keyword">if</span> (isExecuting) &#123;</span><br><span class="line">        waitNum++</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        waitNum += injectScripts()</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    obj.onerrot = obj.onload</span><br><span class="line">    obj.data = item.url</span><br><span class="line">    obj.width = <span class="number">1</span>;</span><br><span class="line">    obj.height = <span class="number">1</span>;</span><br><span class="line">    obj.style.visibility = <span class="string">"hidden"</span>;</span><br><span class="line">    obj.type = <span class="string">"text/plain"</span>;</span><br><span class="line">    <span class="built_in">document</span>.body.appendChild(obj)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">injectScripts</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (deferQueue.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      normalQueue = normalQueue.concat(deferQueue)</span><br><span class="line">      deferQueue = []</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> num = <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; normalQueue.length; i++) &#123;</span><br><span class="line">      <span class="keyword">var</span> normal = normalQueue[i];</span><br><span class="line">      <span class="keyword">if</span> (!normal.done) &#123;</span><br><span class="line">        <span class="keyword">if</span> (normal.cached) &#123;</span><br><span class="line">          num = <span class="number">0</span></span><br><span class="line">          syncExcuteScript(normal)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> num</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">syncExcuteScript</span>(<span class="params">item</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// console.log(item.url, 'pre insertScript...', isExecuting, waitNum)</span></span><br><span class="line">    isExecuting = <span class="literal">true</span></span><br><span class="line">    <span class="keyword">var</span> script = <span class="built_in">document</span>.createElement(<span class="string">"script"</span>)</span><br><span class="line">    script.onload = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      isExecuting = <span class="literal">false</span></span><br><span class="line">      <span class="comment">// console.log(item.url, 'completed', isExecuting, waitNum)</span></span><br><span class="line">      script.onload = <span class="literal">null</span></span><br><span class="line">      item.done = <span class="literal">true</span></span><br><span class="line">      <span class="keyword">if</span> (item.onload) &#123;</span><br><span class="line">        item.onload();</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (waitNum) &#123;</span><br><span class="line">        waitNum--</span><br><span class="line">        waitNum += injectScripts()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    script.onerror = script.onload</span><br><span class="line">    script.src = item.url</span><br><span class="line">    <span class="built_in">document</span>.head.appendChild(script)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    loadScript: loadScript,</span><br><span class="line">    processScripts:<span class="function"><span class="params">()</span>=&gt;</span>&#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure>
<h3 id="å­˜åœ¨çš„é—®é¢˜ï¼š-3"><a href="#å­˜åœ¨çš„é—®é¢˜ï¼š-3" class="headerlink" title="å­˜åœ¨çš„é—®é¢˜ï¼š"></a>å­˜åœ¨çš„é—®é¢˜ï¼š</h3><ol>
<li>åˆ›å»º<code>&lt;object/&gt;</code>åï¼Œéœ€è¦æ’å…¥æ–‡æ¡£æ‰ä¼šå‘èµ·è¯·æ±‚ï¼ˆdomæ“ä½œè€—æ—¶ï¼‰ï¼Œæµè§ˆå™¨è¿˜ä¼šæ„å»ºä¸€ä¸ªblobå¯¹è±¡ï¼ˆæŒºè€—æ—¶çš„ï¼‰ï¼Œä¸”å³ä½¿å‘½ä¸­æœ¬åœ°ç¼“å­˜ä¹Ÿæœ‰äº›è®¸è€—æ—¶ï¼Œæ€»ä½“å¹¶æ²¡æœ‰æ–¹æ³•2 é¡ºåºä¸‹è½½æ‰§è¡Œæ¥çš„å¿«</li>
<li>ä¸è®ºæ˜¯å¦æœ‰ç¼“å­˜ï¼Œéƒ½ä¼šå‘èµ·ä¸¤æ¬¡è¯·æ±‚ï¼Œå½“jså…¨è¢«ç¼“å­˜çš„æ—¶å€™ï¼Œè¯¥åšæ³•æ¯”æ–¹æ³•2æ…¢çš„å¤š</li>
</ol>
<h2 id="5-new-Image-src-é¢„åŠ è½½èµ„æºï¼Œscript-onload-æŒ‰åºä¸‹è½½-å‘½ä¸­ç¼“å­˜-æ‰§è¡Œ"><a href="#5-new-Image-src-é¢„åŠ è½½èµ„æºï¼Œscript-onload-æŒ‰åºä¸‹è½½-å‘½ä¸­ç¼“å­˜-æ‰§è¡Œ" class="headerlink" title="5. new Image().src é¢„åŠ è½½èµ„æºï¼Œscript onload æŒ‰åºä¸‹è½½(å‘½ä¸­ç¼“å­˜)-æ‰§è¡Œ"></a>5. new Image().src é¢„åŠ è½½èµ„æºï¼Œscript onload æŒ‰åºä¸‹è½½(å‘½ä¸­ç¼“å­˜)-æ‰§è¡Œ</h2><p>ç›¸æ¯”object tagçš„ä¸€ä¸ªå¥½å¤„æ˜¯ä¸éœ€è¦è¿›è¡Œdomæ“ä½œï¼Œä¸ç”¨æ„å»ºblobå¯¹è±¡ï¼Œæ€»ä½“é€Ÿåº¦æ¯”å‰å‡ ç§æ–¹æ³•éƒ½å¿«</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">AsyncLoad.img = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * åŠ è½½jså¹¶æ”¾å…¥æ‰§è¡Œé˜Ÿåˆ—ä¸­</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;string&#125;</span> </span>url </span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;string&#125;</span> </span>[type="normal"] scriptç±»å‹ï¼Œnormalä¸ºæ™®é€šjsæ­¤å¤–è¿˜æœ‰asyncã€defer</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;function&#125;</span> </span>callback </span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">var</span> normalQueue = []</span><br><span class="line">  <span class="keyword">var</span> deferQueue = []</span><br><span class="line">  <span class="keyword">var</span> isExecuting = <span class="literal">false</span> <span class="comment">//domæ’å…¥scriptåˆ°scriptæ‰§è¡Œå®Œæ¯•è¿™æ®µè¿‡ç¨‹ å–å€¼ä¸ºtrue</span></span><br><span class="line">  <span class="keyword">var</span> waitNum = <span class="number">0</span> <span class="comment">// å¾…æ‰§è¡ŒinjectScriptsçš„ä¸ªæ•°</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">loadScript</span>(<span class="params">url, type, callback</span>) </span>&#123;</span><br><span class="line">    type = type || <span class="string">'normal'</span></span><br><span class="line">    <span class="keyword">switch</span> (type) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">'defer'</span>:</span><br><span class="line">        <span class="keyword">var</span> dqId = deferQueue.length</span><br><span class="line">        <span class="comment">//cached: &lt;object&gt;ç¼“å­˜æˆåŠŸ done: æ˜¯å¦æ‰§è¡ŒscriptæˆåŠŸ</span></span><br><span class="line">        deferQueue[dqId] = &#123; <span class="attr">url</span>: url, <span class="attr">cached</span>: <span class="literal">false</span>, <span class="attr">done</span>: <span class="literal">false</span>, <span class="attr">onload</span>: callback &#125;</span><br><span class="line">        preload(deferQueue[dqId])</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">'async'</span>:</span><br><span class="line">        <span class="keyword">var</span> script = <span class="built_in">document</span>.createElement(<span class="string">'script'</span>)</span><br><span class="line">        script.onload = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">          <span class="keyword">if</span> (callback) &#123;</span><br><span class="line">            callback();</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        script.src = url</span><br><span class="line">        <span class="built_in">document</span>.head.appendChild(script)</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">var</span> nqId = normalQueue.length</span><br><span class="line">        normalQueue[nqId] = &#123; <span class="attr">url</span>: url, <span class="attr">cached</span>: <span class="literal">false</span>, <span class="attr">done</span>: <span class="literal">false</span>, <span class="attr">onload</span>: callback &#125;</span><br><span class="line">        preload(normalQueue[nqId])</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;any&#125;</span> </span>item é˜Ÿåˆ—å…ƒç´ </span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">preload</span>(<span class="params">item</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//chromeä¼šå‡ºç°Resource interpreted as Document but transferred with MIME type application/javascriptè­¦å‘Š</span></span><br><span class="line">    <span class="keyword">var</span> img = <span class="keyword">new</span> Image();</span><br><span class="line">    <span class="built_in">console</span>.log(item.url, <span class="string">'é¢„åŠ è½½'</span>)</span><br><span class="line">    img.onload = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(item.url, <span class="string">'img cached ç»“æŸ'</span>, isExecuting, waitNum)</span><br><span class="line">      <span class="comment">//è§¦å‘scriptæ ‡ç­¾æ’å…¥</span></span><br><span class="line">      item.cached = <span class="literal">true</span></span><br><span class="line">      img.onload = <span class="literal">null</span></span><br><span class="line">      <span class="keyword">if</span> (isExecuting) &#123;</span><br><span class="line">        waitNum++</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        waitNum += injectScripts()</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    img.onerror = img.onload</span><br><span class="line">    img.src = item.url</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">injectScripts</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (deferQueue.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'normalQueue.concat(deferQueue)'</span>,<span class="built_in">JSON</span>.stringify(deferQueue))</span><br><span class="line">      normalQueue = normalQueue.concat(deferQueue)</span><br><span class="line">      deferQueue = []</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> num = <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; normalQueue.length; i++) &#123;</span><br><span class="line">      <span class="keyword">var</span> normal = normalQueue[i];</span><br><span class="line">      <span class="keyword">if</span> (!normal.done) &#123;</span><br><span class="line">        <span class="keyword">if</span> (normal.cached) &#123;</span><br><span class="line">          num = <span class="number">0</span></span><br><span class="line">          syncExcuteScript(normal)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> num</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">syncExcuteScript</span>(<span class="params">item</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(item.url, <span class="string">'é¢„æ’å…¥&lt;script&gt;'</span>, isExecuting, waitNum)</span><br><span class="line">    isExecuting = <span class="literal">true</span></span><br><span class="line">    <span class="keyword">var</span> script = <span class="built_in">document</span>.createElement(<span class="string">"script"</span>)</span><br><span class="line">    script.onload = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      isExecuting = <span class="literal">false</span></span><br><span class="line">      <span class="built_in">console</span>.log(item.url, <span class="string">'js æ‰§è¡Œå®Œæ¯•'</span>, isExecuting, waitNum)</span><br><span class="line">      script.onload = <span class="literal">null</span></span><br><span class="line">      item.done = <span class="literal">true</span></span><br><span class="line">      <span class="keyword">if</span> (item.onload) &#123;</span><br><span class="line">        item.onload();</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (waitNum) &#123;</span><br><span class="line">        waitNum--</span><br><span class="line">        waitNum += injectScripts()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    script.onerror = script.onload</span><br><span class="line">    script.src = item.url</span><br><span class="line">    <span class="built_in">document</span>.head.appendChild(script)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    loadScript: loadScript,</span><br><span class="line">    processScripts:<span class="function"><span class="params">()</span>=&gt;</span>&#123;<span class="built_in">console</span>.log(normalQueue)&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure>
<h3 id="å­˜åœ¨çš„é—®é¢˜ï¼š-4"><a href="#å­˜åœ¨çš„é—®é¢˜ï¼š-4" class="headerlink" title="å­˜åœ¨çš„é—®é¢˜ï¼š"></a>å­˜åœ¨çš„é—®é¢˜ï¼š</h3><ol>
<li>ä¸è®ºæ˜¯å¦æœ‰ç¼“å­˜ï¼Œéƒ½ä¼šå‘èµ·ä¸¤æ¬¡è¯·æ±‚ï¼ˆå°½ç®¡ç¬¬äºŒæ¬¡æ˜¯å‘½ä¸­æœ¬åœ°ç¼“å­˜ï¼‰ï¼Œå½“jså…¨è¢«ç¼“å­˜çš„æ—¶å€™ï¼Œè¯¥åšæ³•æ¯”æ–¹æ³•2ç¨æ…¢ï¼›</li>
<li>æµè§ˆå™¨è®¾ç½®ç¦ç”¨ç¼“å­˜æ—¶è¯¥æ–¹æ¡ˆæ›´æ…¢</li>
<li><del>å‡ºç°è¿‡imgè¯·æ±‚æŸäº›jsæ—¶å“åº”ä¸å®Œæ•´ï¼Œå¯¼è‡´ç¬¬äºŒæ¬¡è¯·æ±‚ä¸èµ°ç¼“å­˜ä»æ˜¯å®Œæ•´è¯·æ±‚ ï¼ˆç•™ä¸ªå‘ï¼Œå…·ä½“åŸå› å¾…åˆ†æï¼‰</del> <blockquote>
<p>ç¬¬äºŒæ¬¡å…¶å®ä¸æ˜¯å®Œæ•´è¯·æ±‚ï¼Œå“åº”ç ä¸º206è¡¨ç¤ºè¿”å›éƒ¨åˆ†å†…å®¹ï¼Œåº”è¯¥æ˜¯å’Œç¬¬ä¸€æ¬¡è¯·æ±‚è¿›è¡Œåˆå¹¶å¤„ç†ã€‚å…·ä½“æŠ€æœ¯ç»†èŠ‚è¿˜ä¸æ¸…æ¥šï¼Œä½†ç›®å‰æ¥çœ‹èµ°çš„æµé‡å¹¶ä¸ä¼šå¤šã€‚</p>
</blockquote>
</li>
</ol>
<h4 id="è¡¥å……ï¼š"><a href="#è¡¥å……ï¼š" class="headerlink" title="è¡¥å……ï¼š"></a><strong>è¡¥å……ï¼š</strong></h4><blockquote>
<p>æµè§ˆå™¨å¼€å‘è€…å·¥å…·å¼€å¯ <strong>Disable cache</strong>åï¼Œä»»ä½•è¯·æ±‚éƒ½ä¸ä¼šèµ°æœ¬åœ°å¼ºç¼“å­˜ï¼Œä½†æ˜¯ä¼šèµ°304åå•†ç¼“å­˜ï¼ˆå¼ºåˆ¶åˆ·æ–°é™¤å¤–ï¼‰<br>æœªå¼€å¯<strong>Disable cache</strong>çš„çŠ¶æ€ä¸‹ï¼Œctrl+F5å¼ºåˆ¶åˆ·æ–°ï¼Œå¯¹äº<code>page load</code>å‰çš„è¯·æ±‚ï¼Œéƒ½æ˜¯ä¸èµ°ç¼“å­˜(å¼ºç¼“å­˜å’Œåå•†ç¼“å­˜<code>cache-control:no-cache</code>)çš„ï¼Œä½†æ˜¯<code>page load</code>åçš„è¯·æ±‚ä¸å—é™åˆ¶å¯ä»¥èµ°ç¼“å­˜</p>
</blockquote>
<h2 id="6-æœ€ç»ˆæ–¹æ¡ˆ"><a href="#6-æœ€ç»ˆæ–¹æ¡ˆ" class="headerlink" title="6. æœ€ç»ˆæ–¹æ¡ˆ"></a>6. æœ€ç»ˆæ–¹æ¡ˆ</h2><h3 id="LABjs-v3-0çš„æ–¹æ¡ˆï¼š"><a href="#LABjs-v3-0çš„æ–¹æ¡ˆï¼š" class="headerlink" title="LABjs v3.0çš„æ–¹æ¡ˆï¼š"></a><strong>LABjs v3.0</strong>çš„æ–¹æ¡ˆï¼š</h3><ol>
<li>å¯¹äºæ”¯æŒ<code>&lt;link rel=&quot;preload&quot; href=&quot;xxx.js&quot; as=&quot;script&quot;&gt;</code>çš„æµè§ˆå™¨ã€chrome50+ã€safari 11+ã€‘ï¼Œåˆ™ç”¨preloadè¿›è¡Œé¢„åŠ è½½ï¼ˆè¯·æ±‚ä¼šå¤ç”¨ï¼Œä¸ç”¨æ‹…å¿ƒä¸script.srcåŒæ—¶å‘èµ·ä¼šå‘ä¸¤ä¸ªè¯·æ±‚ï¼‰ï¼Œåªè¦æ”¯æŒå°±åŠ ä¸Š</li>
<li>å¯¹äºæ”¯æŒasyncçš„ï¼Œå³<code>document.createElement(&quot;script&quot;).async === true</code>ã€IE&gt;=10 ,å…¶ä»–æµè§ˆå™¨å¤§éƒ¨åˆ†ç‰ˆæœ¬ã€‘,åœ¨æ–¹æ¡ˆ1çš„åŸºç¡€ä¸Šè®¾ç½®ä¸€ä¸ª<code>script.async=false</code>å³å¯</li>
<li>å¯¹äºå…¶ä»–æµè§ˆå™¨ï¼Œé‡‡ç”¨æ–¹æ¡ˆ2åšæ³•</li>
</ol>
<p>PS: preload å’Œ prefetch çš„åŒºåˆ«å¯ä»¥å‚è€ƒï¼š<a href="https://www.w3cplus.com/performance/reloading/preload-prefetch-and-priorities-in-chrome.html" target="_blank" rel="noopener">Preloadï¼ŒPrefetch å’Œå®ƒä»¬åœ¨ Chrome ä¹‹ä¸­çš„ä¼˜å…ˆçº§</a></p>
<p>PS2: <strong>preloadé¢„åŠ è½½åï¼Œæ’å…¥scriptèŠ‚ç‚¹ä¸ä¼šå‘èµ·è¯·æ±‚ï¼Œä¸æ˜¯å‘½ä¸­æœ¬åœ°ç¼“å­˜çš„æ–¹å¼ï¼ˆ200 from cacheï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´å³ä½¿ç¦ç”¨ç¼“å­˜ï¼Œåç»­ä¹Ÿä¸ä¼šè¿›è¡Œé‡å¤è¯·æ±‚ï¼</strong></p>
<h3 id="ä¼˜åŒ–"><a href="#ä¼˜åŒ–" class="headerlink" title="ä¼˜åŒ–"></a>ä¼˜åŒ–</h3><p>æ­£å¸¸æ¥è¯´ï¼Œ<code>async=false</code>å³å¯è§£å†³å¤§éƒ¨åˆ†æµè§ˆå™¨ï¼Œå‰©ä¸‹çš„å°±æ˜¯IE9ç‰ˆæœ¬åŠä»¥ä¸‹ï¼Œä»¥åŠå…¶ä»–æµè§ˆå™¨çš„æŸäº›ç‰ˆæœ¬</p>
<p>æœ¬æ–¹æ¡ˆä¼šåˆ©ç”¨IEçš„ç‰¹æ€§ä¼˜åŒ–æ–¹æ¡ˆ2åšæ³•ï¼Œå®ç°å¹¶è¡Œä¸‹è½½æŒ‰åºæ‰§è¡Œï¼šIEç³»åˆ— è®¾ç½®script.src åå³å‘èµ·è¯·æ±‚ï¼Œæ’å…¥domæ‰æ‰§è¡Œ</p>
<p>å¯¹äºä¸æ”¯æŒ<code>asyncå±æ€§</code>ã€<code>async=false</code>ä¸ä¼šæŒ‰åºæ‰§è¡Œçš„(å¦‚Safari 5.0)ï¼Œåˆ™åˆ©ç”¨æ–¹æ¡ˆ5åšæ³•ã€‚</p>
<p>ä»äº§å“å±‚é¢è€ƒè™‘ï¼Œè‹¥æ‹…å¿ƒæ–¹æ¡ˆ5ç”¨æˆ·ç¦ç”¨ç¼“å­˜å¯¼è‡´çš„åŒå€æµé‡ï¼Œåˆ™é‡‡ç”¨xhré¢„åŠ è½½åŒåŸŸjs eval+æ–¹æ¡ˆ2ã€‚</p>
<h1 id="å‚è€ƒæ–‡æ¡£"><a href="#å‚è€ƒæ–‡æ¡£" class="headerlink" title="å‚è€ƒæ–‡æ¡£"></a>å‚è€ƒæ–‡æ¡£</h1><ol>
<li><a href="https://www.cnblogs.com/Darlietoothpaste/p/6518631.html" target="_blank" rel="noopener">å¼‚æ­¥åŠ è½½è„šæœ¬ä¿æŒæ‰§è¡Œé¡ºåº</a></li>
<li><a href="https://www.html5rocks.com/en/tutorials/speed/script-loading/" target="_blank" rel="noopener">Deep dive into the murky waters of script loading</a></li>
<li><a href="https://github.com/getify/LABjs/tree/v3.0" target="_blank" rel="noopener">github LABjs3.0æºç </a></li>
</ol>
]]></content>
      <categories>
        <category>å¤§å‰ç«¯</category>
      </categories>
      <tags>
        <tag>å‰ç«¯ä¼˜åŒ–</tag>
      </tags>
  </entry>
  <entry>
    <title>æµ…è°ˆå›¾ç‰‡åˆ†å±‚åŠ è½½ä¸æ‡’åŠ è½½</title>
    <url>/2018/07/18/2018Q3/%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB-%E5%9B%BE%E7%89%87%E5%88%86%E5%B1%82%E5%8A%A0%E8%BD%BD%E4%B8%8E%E6%87%92%E5%8A%A0%E8%BD%BD/</url>
    <content><![CDATA[<h1 id="æŠ€æœ¯ä»‹ç»"><a href="#æŠ€æœ¯ä»‹ç»" class="headerlink" title="æŠ€æœ¯ä»‹ç»"></a>æŠ€æœ¯ä»‹ç»</h1><h2 id="ä¸€ã€-å›¾ç‰‡æ‡’åŠ è½½"><a href="#ä¸€ã€-å›¾ç‰‡æ‡’åŠ è½½" class="headerlink" title="ä¸€ã€ å›¾ç‰‡æ‡’åŠ è½½"></a>ä¸€ã€ å›¾ç‰‡æ‡’åŠ è½½</h2><p>æŒ‰éœ€åŠ è½½ï¼Œå³ç”¨æˆ·æ»šåŠ¨é¡µé¢åˆ°ä¸€å®šä½ç½®ï¼ˆå¯è§†åŒºåŸŸï¼‰æ—¶æ‰è§¦å‘å›¾ç‰‡çš„åŠ è½½ï¼›</p>
<p>å¸¸ç”¨äºå›¾ç‰‡è¾ƒå¤šçš„ç½‘é¡µï¼Œå¯ä»¥å»¶è¿Ÿç½‘ç»œè¯·æ±‚ï¼Œé¡µé¢æ›´å¿«load</p>
<a id="more"></a>
<h3 id="æ•ˆæœ"><a href="#æ•ˆæœ" class="headerlink" title="æ•ˆæœ"></a>æ•ˆæœ</h3><p><a href="https://www.jd.com/" target="_blank" rel="noopener">äº¬ä¸œé¦–é¡µæ•ˆæœ</a></p>
<h3 id="å®ç°åŸç†"><a href="#å®ç°åŸç†" class="headerlink" title="å®ç°åŸç†"></a>å®ç°åŸç†</h3><ol>
<li><code>&lt;img&gt;</code>èŠ‚ç‚¹ä¸ä½¿ç”¨srcå±æ€§ï¼Œå°†å›¾ç‰‡åœ°å€æ”¾åœ¨å…¶ä»–è‡ªå®šä¹‰å±æ€§ä¸Š</li>
<li>å½“é¡µé¢æ»šåŠ¨åˆ°ä¸€å®šä½ç½®ï¼Œå°†è‡ªå®šä¹‰å±æ€§ä¸Šçš„å›¾ç‰‡åœ°å€èµ‹å€¼ç»™src</li>
</ol>
<p>ä¸»è¦æœ‰ä¸¤ç§æ–¹æ¡ˆ</p>
<h4 id="IntersectionObserver"><a href="#IntersectionObserver" class="headerlink" title="IntersectionObserver"></a>IntersectionObserver</h4><p>ä¸€ä¸ªç”¨äºåˆ¤æ–­ dom èŠ‚ç‚¹æ˜¯å¦å¤„äºè§†å£çš„API</p>
<p><img src="https://images2015.cnblogs.com/blog/604527/201610/604527-20161021180737935-494667792.gif"></img><br>      <em>(å¼•ç”¨ç½‘ä¸Šå›¾ç‰‡)</em></p>
<p>  <strong>ç®€å•ä»£ç ï¼š</strong><br>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> intersectionObserver = <span class="keyword">new</span> IntersectionObserver(<span class="function"><span class="keyword">function</span>(<span class="params">entries</span>) </span>&#123;</span><br><span class="line">  entries.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">entry</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//intersectionRatioï¼šè¯¥å…ƒç´ çš„å¯è§æ€§æ¯”ä¾‹</span></span><br><span class="line">    <span class="keyword">if</span> (entry.intersectionRatio &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="comment">//å¯¹å…¶domèŠ‚ç‚¹ï¼ˆentry.targetï¼‰è¿›è¡Œä¸‹ä¸€æ­¥æ“ä½œ</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;,&#123;</span><br><span class="line">  <span class="comment">// ç”¨äºè®¡ç®—ç›¸äº¤åŒºåŸŸçš„æ ¹å…ƒç´ ï¼Œé»˜è®¤documenté¡¶å±‚æ–‡æ¡£çš„è§†å£</span></span><br><span class="line">  rootï¼š<span class="literal">null</span>,</span><br><span class="line">  <span class="comment">// æŒ‡å®šåˆ°rootçš„è·ç¦»ï¼Œç”¨äºæ‰©å¤§æˆ–ç¼©å°äº¤å‰åŒºåŸŸé¢ç§¯,ä¸€èˆ¬ç”¨äºæå‰/å»¶è¿Ÿæ‡’åŠ è½½</span></span><br><span class="line">  <span class="comment">// ä¸marginä¸€æ ·è·¨åŸŸç”¨4ä¸ªå€¼ï¼Œå…è®¸è´Ÿå€¼</span></span><br><span class="line">  <span class="comment">// æ˜¾ç¤ºæŒ‡å®šrootæ—¶æ‰å¯ä½¿ç”¨ç™¾åˆ†æ¯”å€¼</span></span><br><span class="line">  rootMargin:<span class="string">"0px"</span>,</span><br><span class="line">  <span class="comment">// è§¦å‘å›è°ƒå‡½æ•°çš„ä¸´ç•Œå€¼ï¼Œç”¨ 0 ~ 1 çš„æ¯”ç‡æŒ‡å®šï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªæ•°ç»„ã€‚</span></span><br><span class="line">  <span class="comment">// å…¶å€¼æ˜¯è¢«è§‚æµ‹å…ƒç´ å¯è§†é¢ç§¯ / æ€»é¢ç§¯</span></span><br><span class="line">  <span class="comment">// å½“å¯è§†æ¯”ç‡ç»è¿‡è¿™ä¸ªå€¼çš„æ—¶å€™ï¼Œå›è°ƒå‡½æ•°å°±ä¼šè¢«è°ƒç”¨ã€‚</span></span><br><span class="line">  thresholds:[<span class="number">0</span>]</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">document</span>.querySelectorAll(<span class="string">'img'</span>).forEach(<span class="function"><span class="params">v</span>=&gt;</span>intersectionObserver.observe(v))</span><br></pre></td></tr></table></figure><br>  å…¼å®¹æ€§ï¼š<a href="https://caniuse.com/#search=intersectionObserver" target="_blank" rel="noopener">è¾ƒå·®ï¼Œcaniuse</a></p>
<h4 id="scroll-requestAnimationFrame-getBoundingClientRect"><a href="#scroll-requestAnimationFrame-getBoundingClientRect" class="headerlink" title="scroll+requestAnimationFrame+getBoundingClientRect"></a>scroll+requestAnimationFrame+getBoundingClientRect</h4><p>ç›‘å¬çª—å£æ»šåŠ¨å’Œå¤§å°å˜åŒ–äº‹ä»¶ï¼Œåˆ©ç”¨ requestAnimationFrame è¿›è¡ŒèŠ‚æµ</p>
<p>åˆ¤æ–­å…ƒç´ æ˜¯å¦åœ¨è§†åŒºä¸­ä»£ç ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">inViewport</span>(<span class="params">node</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//æ–‡æ¡£æ»šåŠ¨è·ç¦»</span></span><br><span class="line">  <span class="keyword">var</span> viewTop = getScrollY()</span><br><span class="line">  <span class="keyword">var</span> viewBot = viewTop + windowHeight</span><br><span class="line">  <span class="comment">//èŠ‚ç‚¹è·ç¦»æ–‡æ¡£é¡¶éƒ¨çš„è·ç¦»</span></span><br><span class="line">  <span class="keyword">var</span> nodeTop = getNodeTop(node)</span><br><span class="line">  <span class="keyword">var</span> nodeBot = nodeTop + getNodeOffsetHeight(wsnode)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> offset = (settings.lazyLoadStrategy.threshold / <span class="number">100</span>) * windowHeight</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (nodeBot &gt;= viewTop - offset) &amp;&amp; (nodeTop &lt;= viewBot + offset)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å…¼å®¹æ€§ï¼šIE7+æµ‹è¯•é€šè¿‡</p>
<h2 id="äºŒã€-åˆ†å±‚åŠ è½½"><a href="#äºŒã€-åˆ†å±‚åŠ è½½" class="headerlink" title="äºŒã€ åˆ†å±‚åŠ è½½"></a>äºŒã€ åˆ†å±‚åŠ è½½</h2><p>å…ˆæ˜¾ç¤ºä¸€å¼ æ¨¡ç³Šçš„å›¾ç‰‡ï¼Œåé¢å†æ¢æˆåŸå›¾</p>
<h3 id="æ•ˆæœ-1"><a href="#æ•ˆæœ-1" class="headerlink" title="æ•ˆæœ"></a>æ•ˆæœ</h3><p><a href="https://www.zhihu.com/question/20958648/answer/74805876" target="_blank" rel="noopener">çŸ¥ä¹ï¼ˆä¸ºè§‚å¯Ÿæµ‹è¯•æ•ˆæœè¯·é™åˆ¶å¸¦å®½ï¼‰</a></p>
<h3 id="å®ç°åŸç†-1"><a href="#å®ç°åŸç†-1" class="headerlink" title="å®ç°åŸç†"></a>å®ç°åŸç†</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">id</span>=<span class="string">"img"</span> <span class="attr">src</span>=<span class="string">"small.jpg"</span> <span class="attr">data-original</span>=<span class="string">"big.jpg"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> smallImage = <span class="built_in">document</span>.getElementById(<span class="string">'img'</span>)</span><br><span class="line"><span class="keyword">let</span> imgLarge = <span class="keyword">new</span> Image();</span><br><span class="line">imgLarge.src = smallImage.getAttribute(<span class="string">"data-original"</span>)</span><br><span class="line">imgLarge.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  smallImage.src = imgLarge.src</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-æ‡’åŠ è½½-åˆ†å±‚åŠ è½½"><a href="#3-æ‡’åŠ è½½-åˆ†å±‚åŠ è½½" class="headerlink" title="3. æ‡’åŠ è½½+åˆ†å±‚åŠ è½½"></a>3. æ‡’åŠ è½½+åˆ†å±‚åŠ è½½</h2><p><code>&lt;img src=&quot;small.jpg&quot;&gt;</code></p>
<p>ç„¶åæŒ‰æ‡’åŠ è½½çš„åšæ³•ï¼Œåœ¨å›¾ç‰‡èŠ‚ç‚¹è¿›å…¥è§†åŒºæ—¶ï¼Œè¿›è¡Œsrcçš„æ›¿æ¢</p>
<h1 id="æŠ€æœ¯æ¶æ„"><a href="#æŠ€æœ¯æ¶æ„" class="headerlink" title="æŠ€æœ¯æ¶æ„"></a>æŠ€æœ¯æ¶æ„</h1><h2 id="æ—¶åºå›¾"><a href="#æ—¶åºå›¾" class="headerlink" title="æ—¶åºå›¾"></a>æ—¶åºå›¾</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sequenceDiagram</span><br><span class="line">participant æµè§ˆå™¨</span><br><span class="line">participant ä»£ç†æœåŠ¡å™¨</span><br><span class="line">participant æºç«™</span><br><span class="line">æµè§ˆå™¨ -&gt;&gt; ä»£ç†æœåŠ¡å™¨:è¯·æ±‚æ¨¡ç³Šå›¾</span><br><span class="line">Note right of ä»£ç†æœåŠ¡å™¨:æ²¡æœ‰ç¼“å­˜ï¼Œè¯·æ±‚æºç«™</span><br><span class="line">ä»£ç†æœåŠ¡å™¨ -&gt;&gt; æºç«™:è¯·æ±‚åŸå§‹å›¾åƒèµ„æº</span><br><span class="line">Note right of ä»£ç†æœåŠ¡å™¨:ç¼“å­˜å›¾åƒ</span><br><span class="line">ä»£ç†æœåŠ¡å™¨ -&gt;&gt; ä»£ç†æœåŠ¡å™¨:å›¾åƒæ¨¡ç³ŠåŒ–</span><br><span class="line">ä»£ç†æœåŠ¡å™¨ --&gt;&gt; æµè§ˆå™¨:è¿”å›æ¨¡ç³Šå›¾</span><br><span class="line">Note right of æµè§ˆå™¨:domè§£æå®Œæ¯•&lt;br&#x2F;&gt;æ‰«ææ–‡æ¡£</span><br><span class="line">æµè§ˆå™¨ -&gt;&gt; ä»£ç†æœåŠ¡å™¨:è¯·æ±‚å›¾ç‰‡è´¨é‡æ ‡è¯†wsqå¯¹åº”å›¾åƒ</span><br><span class="line">ä»£ç†æœåŠ¡å™¨ -&gt;&gt; ä»£ç†æœåŠ¡å™¨:æ ¹æ®wsqå¯¹åŸå›¾åšç›¸åº”çš„å‹ç¼©</span><br><span class="line">ä»£ç†æœåŠ¡å™¨ --&gt;&gt;æµè§ˆå™¨:è¿”å›wsqå¯¹åº”å›¾ç‰‡</span><br></pre></td></tr></table></figure>
<h2 id="æ€»æµç¨‹"><a href="#æ€»æµç¨‹" class="headerlink" title="æ€»æµç¨‹"></a>æ€»æµç¨‹</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">graph TB</span><br><span class="line">  st(å¼€å§‹)--&gt;init((åˆå§‹åŒ–))</span><br><span class="line">  init--&gt;obs[æ·»åŠ DOMContentLoaded,Loadäº‹ä»¶ç›‘å¬å™¨]</span><br><span class="line">  obs--&gt;DOMContentLoaded[DOMContentLoadedäº‹ä»¶è§¦å‘]</span><br><span class="line">  DOMContentLoaded--&gt;cal[åˆ©ç”¨htmlæ–‡æ¡£ä¸‹è½½é€Ÿåº¦æ¥è¿›è¡Œç®€å•æµ‹é€Ÿ]</span><br><span class="line">  cal--&gt;firstScreenPicSpeed[å‚ç…§ç½‘é€Ÿå‹ç¼©æ¯”å¯¹ç…§è¡¨å¾—åˆ°é¦–å±å›¾ç‰‡å‹ç¼©æ¯”]</span><br><span class="line">  firstScreenPicSpeed--&gt;firstScreen((æ‰«ææ–‡æ¡£,è·å–å›¾ç‰‡èŠ‚ç‚¹))</span><br><span class="line">  firstScreen--&gt;quicksort[æŒ‰è§†è·å¿«æ’å›¾ç‰‡èŠ‚ç‚¹]</span><br><span class="line">  quicksort--&gt;judgeCache[ä»»å–ä¸€æ¨¡ç³Šå›¾çš„name,é€šè¿‡transferSizeæ˜¯å¦ä¸º0æ¥åˆ¤æ–­æœ¬æ¬¡åŠ è½½æ˜¯å¦ä¸ºæ— ç¼“å­˜åŠ è½½]</span><br><span class="line">  judgeCache--&gt;firstScreenCal[è·å–è§†è·å¤„äºé¦–å±çš„å›¾ç‰‡èŠ‚ç‚¹]</span><br><span class="line">  firstScreenCal--&gt;oripicload((è¿›è¡ŒåŸå›¾åŠ è½½))</span><br><span class="line">  oripicload--&gt;load[Loadäº‹ä»¶è§¦å‘]</span><br><span class="line">  load--&gt;speedtest[é‡‡ç”¨æµ‹é€Ÿç®—æ³•æµ‹é€Ÿ,å¾—åˆ°ç›¸åº”å›¾åƒå‹ç¼©æ¯”]</span><br><span class="line">  speedtest--&gt;islazyLoad&#123;æ˜¯å¦æ‡’åŠ è½½&#125;</span><br><span class="line">  islazyLoad--æ˜¯--&gt;lazyload[å¯åŠ¨æ‡’åŠ è½½ç­–ç•¥]</span><br><span class="line">  islazyLoad--å¦--&gt;replaceOther[æ‰¾åˆ°å…¶ä»–æœªè¿›è¡ŒåŸå›¾åŠ è½½çš„èŠ‚ç‚¹]</span><br><span class="line">  replaceOther--&gt;oripicload1((è¿›è¡ŒåŸå›¾åŠ è½½))</span><br><span class="line">  lazyload--&gt;islazycompleted&#123;æ‡’åŠ è½½å®Œæ¯•?&#125;</span><br><span class="line">  islazycompleted--æ˜¯--&gt;ed(ç»“æŸ)</span><br><span class="line">  islazycompleted--å¦--&gt;scall&#123;æ˜¯å¦è¿›è¡Œçª—å£æ»šåŠ¨&#125;</span><br><span class="line">  scall--æ˜¯--&gt;debounceCul[èŠ‚æµå¤„ç†,è·å–æ»¡è¶³è§†è·æ¡ä»¶çš„æœªè¿›è¡ŒåŸå›¾åŠ è½½çš„èŠ‚ç‚¹]</span><br><span class="line">  debounceCul--&gt;oripicload2((è¿›è¡ŒåŸå›¾åŠ è½½))</span><br><span class="line">  oripicload2--&gt;islazycompleted</span><br><span class="line">  scall--å¦--&gt;mousetimeout&#123;é¼ æ ‡äº‹ä»¶10sæœªè§¦å‘&#125;</span><br><span class="line">  mousetimeout--æ˜¯--&gt;replaceOther</span><br><span class="line">  mousetimeout--å¦--&gt;scall</span><br><span class="line">  oripicload1--&gt;ed</span><br></pre></td></tr></table></figure>
<h2 id="åˆå§‹åŒ–å…·ä½“æµç¨‹"><a href="#åˆå§‹åŒ–å…·ä½“æµç¨‹" class="headerlink" title="åˆå§‹åŒ–å…·ä½“æµç¨‹"></a>åˆå§‹åŒ–å…·ä½“æµç¨‹</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">graph LR</span><br><span class="line">  init(åˆå§‹åŒ–å¼€å§‹)--&gt;evalElement(è§£æscriptæ ‡ç­¾ä¸­è‡ªå®šä¹‰å±æ€§)</span><br><span class="line">  evalElement--&gt;getHost[è·å–å¯æ›¿æ¢å›¾ç‰‡åŸŸå]</span><br><span class="line">  evalElement--&gt;getHashHost[è·å–æ•£åˆ—åŸŸå]</span><br><span class="line">  evalElement--&gt;getLazy[è·å–æ‡’åŠ è½½ç­–ç•¥]</span><br><span class="line">  evalElement--&gt;getSpeedZip[è·å–ç½‘é€Ÿå‹ç¼©æ¯”å‚ç…§è¡¨]</span><br><span class="line">  evalElement--&gt;getTTL[è·å–å›¾ç‰‡ç¼“å­˜æ—¶é—´]</span><br><span class="line">  getHost--&gt;initStop(åˆå§‹åŒ–ç»“æŸ)</span><br><span class="line">  getHashHost--&gt;initStop</span><br><span class="line">  getLazy--&gt;initStop</span><br><span class="line">  getSpeedZip--&gt;initStop</span><br><span class="line">  getTTL--&gt;initStop</span><br></pre></td></tr></table></figure>

<h2 id="åŸå›¾åŠ è½½å…·ä½“æµç¨‹"><a href="#åŸå›¾åŠ è½½å…·ä½“æµç¨‹" class="headerlink" title="åŸå›¾åŠ è½½å…·ä½“æµç¨‹"></a>åŸå›¾åŠ è½½å…·ä½“æµç¨‹</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">graph TB</span><br><span class="line">oripicstart(åŸå›¾åŠ è½½å¼€å§‹)--&gt;judgeEle&#123;åˆ¤æ–­èŠ‚ç‚¹ç±»å‹&#125;</span><br><span class="line">judgeEle--pictureèŠ‚ç‚¹--&gt;getpic[è·å–å…¶å­èŠ‚ç‚¹ä¸­sourceèŠ‚ç‚¹å’ŒimgèŠ‚ç‚¹ä¸­srcå’Œsrcsetå±æ€§ä¸­çš„å›¾ç‰‡url]</span><br><span class="line">judgeEle--imgèŠ‚ç‚¹--&gt;getsrcset[è·å–èŠ‚ç‚¹çš„srcå’Œsrcsetå±æ€§ä¸­çš„å›¾ç‰‡url]</span><br><span class="line">judgeEle--videoèŠ‚ç‚¹--&gt;getposter[è·å–èŠ‚ç‚¹çš„posterå±æ€§ä¸­çš„å›¾ç‰‡url]</span><br><span class="line">judgeEle--å…¶ä»–èŠ‚ç‚¹--&gt;getother[è·å–èŠ‚ç‚¹background-imageçš„å›¾ç‰‡url]</span><br><span class="line">getpic--&gt;getfinalurl((urlæ›¿æ¢))</span><br><span class="line"></span><br><span class="line">getsrcset--&gt;getfinalurl1((urlæ›¿æ¢))</span><br><span class="line">getposter--&gt;getfinalurl1((urlæ›¿æ¢))</span><br><span class="line">getother--&gt;getfinalurl1((urlæ›¿æ¢))</span><br><span class="line"></span><br><span class="line">getfinalurl1--&gt;newImg[new Imageçš„æ–¹å¼åŠ è½½èµ„æº,å…¶urlä¸ºæ›¿æ¢åçš„url,å¯èƒ½éœ€è¦è®¾ç½®srcsetå±æ€§]</span><br><span class="line">newImg--&gt;onload[Imageçš„onloadè§¦å‘]</span><br><span class="line">onload--&gt;updateEle</span><br><span class="line"></span><br><span class="line">getfinalurl-.-hashurl[å°†æ¨¡ç³Šå›¾urlåœ°å€é€šè¿‡ä¸€å®šç®—æ³•æ˜ å°„åˆ°å›ºå®šçš„æ•£åˆ—åŸŸå,å¾—åˆ°æ–°çš„å›¾ç‰‡url-newUrl]</span><br><span class="line">hashurl--&gt;findstorage&#123;localstorageä¸­æ˜¯å¦æœ‰newUrlä¸”å‹ç¼©æ¯”ä¸€æ ·æˆ–æ›´ä½çš„è®°å½•&#125;</span><br><span class="line">findstorage--æ˜¯--&gt;isExpired&#123;æ˜¯å¦è¿‡æœŸ&#125;</span><br><span class="line">findstorage--å¦--&gt;carrycur</span><br><span class="line">isExpired--å¦--&gt;carryhigh[å–æœªè¿‡æœŸçš„å‹ç¼©æ¯”æœ€ä½çš„è®°å½•,newUrlåå¸¦ä¸Šå‹ç¼©æ¯”å‚æ•°]</span><br><span class="line">isExpired--æ˜¯--&gt;carrycur[å›¾ç‰‡urlåå¸¦ä¸Šå½“å‰çš„å‹ç¼©æ¯”]</span><br><span class="line">carryhigh--&gt;replaceEnd(urlæ›¿æ¢å®Œæ¯•)</span><br><span class="line">carrycur--&gt;replaceEnd</span><br><span class="line">getfinalurl--&gt;updateEle[å°†èŠ‚ç‚¹å±æ€§çš„å›¾ç‰‡urlè¿›è¡Œæ›¿æ¢]</span><br><span class="line">updateEle--&gt;updatelocal[æ›´æ–°localstorage]</span><br><span class="line">updatelocal--&gt;isnocache&#123;æ— ç¼“å­˜åŠ è½½æˆ–localstorageä¸­æ²¡æœ‰å‘½ä¸­ç¼“å­˜?&#125;</span><br><span class="line">isnocache--å¦--&gt;oripicstop[åŸå›¾åŠ è½½å®Œæ¯•]</span><br><span class="line">isnocache--æ˜¯--&gt;update[æ›´æ–° url-å‹ç¼©æ¯”-ttl è®°å½•]</span><br><span class="line">update--&gt;oripicstop</span><br></pre></td></tr></table></figure>

<h2 id="æ‰«ææ–‡æ¡£ï¼Œè·å–å›¾ç‰‡èŠ‚ç‚¹å…·ä½“æµç¨‹"><a href="#æ‰«ææ–‡æ¡£ï¼Œè·å–å›¾ç‰‡èŠ‚ç‚¹å…·ä½“æµç¨‹" class="headerlink" title="æ‰«ææ–‡æ¡£ï¼Œè·å–å›¾ç‰‡èŠ‚ç‚¹å…·ä½“æµç¨‹"></a>æ‰«ææ–‡æ¡£ï¼Œè·å–å›¾ç‰‡èŠ‚ç‚¹å…·ä½“æµç¨‹</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">graph LR</span><br><span class="line">init(åˆå§‹åŒ–èŠ‚ç‚¹åˆ—è¡¨)--&gt;scanOver&#123;æ–‡æ¡£æ‰«æå®Œæ¯•?&#125;</span><br><span class="line">scanOver--å¦--&gt;scan[æ‰«ææ–‡æ¡£]</span><br><span class="line">scan--&gt;getPicEle[è·å–pictureèŠ‚ç‚¹]</span><br><span class="line">getPicEle--&gt;getchild[è·å–å­èŠ‚ç‚¹çš„srcå’Œsrcsetä¸­æ‰€æœ‰å›¾ç‰‡çš„url]</span><br><span class="line">getchild--&gt;ishost&#123;èŠ‚ç‚¹å›¾ç‰‡urlçš„åŸŸåå­˜åœ¨å¯æ›¿æ¢å›¾ç‰‡åŸŸå?&#125;</span><br><span class="line">ishost--å¦--&gt;skip[è·³è¿‡è¯¥èŠ‚ç‚¹]</span><br><span class="line">ishost--æ˜¯--&gt;addList[èŠ‚ç‚¹åˆ—è¡¨åŠ å…¥è¯¥èŠ‚ç‚¹]</span><br><span class="line">scan--&gt;getImgEle[è·å–çˆ¶èŠ‚ç‚¹épictureçš„imgèŠ‚ç‚¹]</span><br><span class="line">getImgEle--&gt;getsrc[è·å–èŠ‚ç‚¹çš„srcæˆ–srcsetå±æ€§]</span><br><span class="line">getsrc--&gt;ishost</span><br><span class="line">scan--&gt;getstyleEle[è·å–styleä¸­å«æœ‰background-imageå±æ€§ä¸”å€¼ä¸ºå›¾ç‰‡urlçš„èŠ‚ç‚¹]</span><br><span class="line">getstyleEle--&gt;ishost</span><br><span class="line">scan--&gt;getcss[æ‰«æcssæ–‡æ¡£,è·å–å«æœ‰background-imageå±æ€§ä¸”å€¼ä¸ºå›¾ç‰‡urlçš„cssè§„åˆ™]</span><br><span class="line">getcss--&gt;getcssDom[åŒ¹é…cssè§„åˆ™å¾—åˆ°ç›¸åº”èŠ‚ç‚¹]</span><br><span class="line">getcssDom--&gt;ishost</span><br><span class="line">scan--&gt;getvideo[è·å–å«posterå±æ€§ä¸”å€¼ä¸ºå›¾ç‰‡urlçš„videoèŠ‚ç‚¹]</span><br><span class="line">getvideo--&gt;ishost</span><br><span class="line">skip--&gt;scanOver</span><br><span class="line">addList--&gt;scanOver</span><br><span class="line">scanOver--æ˜¯--&gt;scanEnd(èŠ‚ç‚¹è·å–å®Œæ¯•)</span><br></pre></td></tr></table></figure>

<h1 id="é—®é¢˜ä¸è§£å†³"><a href="#é—®é¢˜ä¸è§£å†³" class="headerlink" title="é—®é¢˜ä¸è§£å†³"></a>é—®é¢˜ä¸è§£å†³</h1><h2 id="1-å“åº”å¼å›¾ç‰‡å¤„ç†"><a href="#1-å“åº”å¼å›¾ç‰‡å¤„ç†" class="headerlink" title="1. å“åº”å¼å›¾ç‰‡å¤„ç†"></a>1. å“åº”å¼å›¾ç‰‡å¤„ç†</h2><ul>
<li><code>&lt;img&gt;</code>çš„ srcset å±æ€§å’Œ <del>cssçš„image-set()</del></li>
<li><code>&lt;picture&gt;</code> sourceã€imgå­èŠ‚ç‚¹</li>
</ul>
<p>(1) æ‹¿åˆ°srcsetå€¼ï¼Œå¹¶è·å–srcsetä¸­çš„å›¾ç‰‡åœ°å€åˆ—è¡¨<br>(2) å°†å›¾ç‰‡åœ°å€å˜æˆå¸¦è´¨é‡æ ‡è¯†çš„åœ°å€<br>(3) å°†å¤„ç†è¿‡çš„å›¾ç‰‡åœ°å€åˆ—è¡¨æ›¿æ¢ä¸ºåŸæ¥çš„srcsetå€¼</p>
<h2 id="2-å¸¦å®½ä¼°ç®—"><a href="#2-å¸¦å®½ä¼°ç®—" class="headerlink" title="2. å¸¦å®½ä¼°ç®—"></a>2. å¸¦å®½ä¼°ç®—</h2><p>åˆ©ç”¨ WebPerformanceApi è·å–å·²åŠ è½½èµ„æºçš„ç½‘ç»œè¯·æ±‚æ—¶é—´è€—è´¹</p>
<h3 id="ç®—æ³•æµç¨‹"><a href="#ç®—æ³•æµç¨‹" class="headerlink" title="ç®—æ³•æµç¨‹"></a>ç®—æ³•æµç¨‹</h3><ol start="0">
<li><p>æ•°æ®ç»“æ„ä½“</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  name: v.name,<span class="comment">//æ ‡è¯†è€Œå·²</span></span><br><span class="line">  start: v.responseStart,</span><br><span class="line">  end: v.responseEnd,</span><br><span class="line">  size: v.transferSize,</span><br><span class="line">  <span class="comment">//KB/S æ–°ç®—æ³•ä¸­ä¸ç”¨è¯¥å‚æ•°</span></span><br><span class="line">  speed: v.transferSize / (v.responseEnd - v.responseStart || <span class="number">1</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>è¿‡æ»¤ã€æŒ‰startå€¼å‡åºæ’åº</p>
<blockquote>
<p>å‰”é™¤å°æ•°æ®,ä¿ç•™æ»¡è¶³ä»¥ä¸‹æ¡ä»¶æ•°æ®â€“ã€‹å°æ•°æ®ä¼šå¯¼è‡´å‡ºç°è¿‡å¤§çš„ç½‘é€Ÿè®¡ç®—ç»“æœï¼Œå‰”é™¤å°æ•°æ®åå¯¹æ€»ä½“ç»“æœå½±å“å°ï¼Œ<br><code>v.transferSize &gt; 100 &amp;&amp; (v.responseEnd - v.responseStart) &gt; 10 &amp;&amp; v.responseStart &lt; loadTime</code></p>
</blockquote>
</li>
<li><p>åˆ†ç»„ï¼Œå°†å“åº”æ—¶é—´æ— è¿ç»­çš„åˆ†ç»„</p>
</li>
<li><p>è®¡ç®—æ¯ç»„çš„æ¯æ¡å“åº”çš„é€Ÿåº¦ï¼ˆå…·ä½“è®¡ç®—è§å¦‚ä¸‹ï¼‰ï¼Œå¹¶è®¡ç®—æ•´ç»„å‡å€¼ã€æ–¹å·®ã€æœ€å¤§å€¼</p>
<ul>
<li>3.1 å°†æ¯æ¡å“åº”çš„start,endæ”¾å…¥numArr</li>
<li>3.2 numArrå»é‡ï¼Œå‡åºæ’åº</li>
<li>3.3 å°†æ¯æ¡å“åº”çš„æ—¶é—´åŒºé—´æŒ‰numArrå€¼åˆ†å‰²ï¼Œå½“å…¶ä»–å“åº”æœ‰é‡å¤çš„åŒºé—´ï¼Œè¯¥æ¡å“åº”çš„è¯¥æ—¶é—´åŒºé—´ä¼šä¹˜ä»¥é‡å¤çš„æ•°é‡(åŒ…æ‹¬è‡ªå·±)</li>
<li>3.4 å°†æ¯æ®µæ—¶é—´åŒºé—´ç›¸åŠ ï¼Œå½¢æˆè¯¥å“åº”çš„å®é™…å“åº”æ—¶é—´ï¼Œç”¨sizeå¤„äºè¯¥æ—¶é—´åˆ™ä¸ºè¯¥å“åº”çš„å®é™…é€Ÿåº¦</li>
<li>3.5 è®¡ç®—æ¯æ¡å“åº”çš„é€Ÿåº¦</li>
</ul>
</li>
<li><p>æ ¹æ®sizeåšåŠ æƒå¹³å‡ï¼Œå¾—åˆ°æ¯ç»„å¸¦å®½ä¼°ç®—å€¼ã€‚</p>
</li>
<li><p>æ¯”è¾ƒæ¯ç»„æ•°æ®çš„ç»“æœï¼Œå–æœ€å¤§å€¼</p>
</li>
</ol>
<h2 id="3-å¤šç‰ˆæœ¬ç¼“å­˜å‘½ä¸­ç­–ç•¥"><a href="#3-å¤šç‰ˆæœ¬ç¼“å­˜å‘½ä¸­ç­–ç•¥" class="headerlink" title="3. å¤šç‰ˆæœ¬ç¼“å­˜å‘½ä¸­ç­–ç•¥"></a>3. å¤šç‰ˆæœ¬ç¼“å­˜å‘½ä¸­ç­–ç•¥</h2><p>Q: å¸¦ç½‘ç»œå‚æ•°ï¼Œä¸ä¼šå‘½ä¸­åŸå›¾å·²æœ‰æœ¬åœ°ç¼“å­˜ </p>
<p>è¯¦ç»†æè¿°ï¼šæœ¬åœ°å·²ç¼“å­˜é«˜è´¨é‡å›¾ç‰‡<code>a.jpg?q=80</code>ï¼Œæœ¬åœ°é€šè¿‡ç½‘ç»œè®¡ç®—éœ€è¦å»è¯·æ±‚ä½æ¸…å›¾ç‰‡<code>a.jpg?q=50</code>,è¿™æ ·å°±æµªè´¹äº†åŸæ¥çš„åŸå›¾ç¼“å­˜äº†ã€‚</p>
<p><strong>è§£æ³•ï¼šå¼•å…¥localStorageçš„ç¼“å­˜æ§åˆ¶ç­–ç•¥</strong></p>
<p>ä¸åŒæ¯”ä¾‹å›¾ç‰‡loadåï¼Œå°†<code>url-TTL-q</code>æ”¾åˆ° localstorage ä¸­ã€‚<br>æ¯æ¬¡ç½‘ç»œè®¡ç®—å®Œåï¼Œå…ˆæŸ¥è¯¢ç¼“å­˜ä¸­æœ‰æ²¡æœ‰æ›´é«˜æ¸…çš„ä¸”æœªè¿‡æœŸçš„å›¾ç‰‡ï¼Œæœ‰çš„è¯é€‰æ›´é«˜æ¸…çš„è¿›è¡Œè¯·æ±‚ï¼Œä¸å¯¹localstorageåšå¤„ç† ï¼›<br>å¦åˆ™è¯·æ±‚ç›¸åº”ç½‘ç»œçŠ¶æ€çš„å›¾ç‰‡ï¼Œonloadåä¿å­˜æˆ–æ›´æ–°localstorageã€‚</p>
<blockquote>
<p>æ³¨1ï¼šæ¯ç§æ¸…æ™°åº¦å›¾ç‰‡çš„TTLå¯é…ç½®ï¼Œé€šè¿‡scriptèŠ‚ç‚¹è‡ªå®šä¹‰å±æ€§è®¾ç½®ã€‚</p>
</blockquote>
<p><strong>æ³¨æ„ï¼šå¼ºåˆ·é¡µé¢æˆ–è€…<code>disable cache</code>ï¼Œè¯·æ±‚å›¾ç‰‡å¾—åˆ°å“åº”åï¼Œ<code>cache-control</code>æœ¬åœ°ç¼“å­˜æ—¶é—´ä¼šé‡æ–°è®¡ç®—ã€‚</strong></p>
<p>ç›¸åº”çš„æˆ‘ä»¬localstorageçš„TTLä¹Ÿè¦è¿›è¡Œä¿®æ”¹</p>
<p>è¿™è¾¹æˆ‘ä»¬ä¸»è¦å°±æ˜¯åˆ¤æ–­å›¾ç‰‡æ˜¯å¦ä¸ºæ— ç¼“å­˜è¯·æ±‚ï¼Œå½“ä¸ºæ— ç¼“å­˜è¯·æ±‚ï¼Œimg.onloadåéœ€è¦å¯¹localstorageè¿›è¡Œæ›´æ–°ã€‚</p>
<p>è‡³äºæ€ä¹ˆåˆ¤æ–­æ˜¯å¦ä¸ºæ— ç¼“å­˜ï¼Œå°±ç”¨<code>performance.getEntriesByName(&#39;å½“å‰åŠ è½½å›¾ç‰‡çš„url&#39;)</code>ç»“æœæ˜¯å¦æ»¡è¶³æŸäº›è§„åˆ™æ¥åˆ¤æ–­</p>
<h3 id="transferSize-æ¯”-encodedBodySize-å°çš„æƒ…å†µï¼š"><a href="#transferSize-æ¯”-encodedBodySize-å°çš„æƒ…å†µï¼š" class="headerlink" title="transferSize æ¯” encodedBodySize å°çš„æƒ…å†µï¼š"></a>transferSize æ¯” encodedBodySize å°çš„æƒ…å†µï¼š</h3><blockquote>
<p> It is possible for transferSize value to be lower than encodedBodySize: when a cached response is successfully revalidated the transferSize reports the size of the response HTTP headers incurred during the revalidation, and encodedBodySize reports the size of the previously retrieved payload body.</p>
</blockquote>
<p>ç¼“å­˜ç”Ÿæ•ˆï¼ŒtransferSize ä¸ºå“åº”HTTPå¤´çš„å¤§å°ï¼Œè€ŒencodedBodySize ä¸ºå…ˆå‰æ£€ç´¢åˆ°çš„æœ‰æ•ˆå†…å®¹ä¸»ä½“çš„å¤§å°ã€‚</p>
<p>200 from cache. ä¸” transferSize ä¸€èˆ¬ä¸º0</p>
<h3 id="encodedBodySize-ä¸º0-çš„æƒ…å†µï¼š"><a href="#encodedBodySize-ä¸º0-çš„æƒ…å†µï¼š" class="headerlink" title="encodedBodySize ä¸º0 çš„æƒ…å†µï¼š"></a>encodedBodySize ä¸º0 çš„æƒ…å†µï¼š</h3><blockquote>
<p>The encodedBodySize may be zero depending on the response code - e.g. HTTP 204 (No Content), 3XX, etc.</p>
</blockquote>
<p>204,3XX ã€‚</p>
<h2 id="4-åŠ¨æ€å›¾ç‰‡èŠ‚ç‚¹æ‰«æ"><a href="#4-åŠ¨æ€å›¾ç‰‡èŠ‚ç‚¹æ‰«æ" class="headerlink" title="4. åŠ¨æ€å›¾ç‰‡èŠ‚ç‚¹æ‰«æ"></a>4. åŠ¨æ€å›¾ç‰‡èŠ‚ç‚¹æ‰«æ</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">wraptSet</span>(<span class="params">obj, attr, interceptor, callback, useParent</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> desc = <span class="built_in">Object</span>.getOwnPropertyDescriptor(obj, attr);</span><br><span class="line">    <span class="keyword">var</span> original = desc.set;</span><br><span class="line">    desc.set = <span class="function"><span class="keyword">function</span> (<span class="params">value</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"inject to attr:"</span>, obj, attr)</span><br><span class="line">        <span class="keyword">var</span> new_value = interceptor(value);</span><br><span class="line">      &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">        <span class="built_in">console</span>.warn(err);</span><br><span class="line">      &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (callback) &#123;</span><br><span class="line">          callback(<span class="keyword">this</span>, useParent)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="comment">//è¯´æ˜æ˜¯å…ƒç´ çš„å›¾ç‰‡åœ°å€å±æ€§è®¾ç½®</span></span><br><span class="line">          <span class="keyword">this</span>.setAttribute(<span class="string">"wsload"</span>, <span class="string">"true"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> original.call(<span class="keyword">this</span>, new_value);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">Object</span>.defineProperty(obj, attr, desc);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">wrapInvoke</span>(<span class="params">obj, method, callback, useParent</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> original = obj[method];</span><br><span class="line">    obj[method] = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"inject to method:"</span>, obj, method)</span><br><span class="line">        <span class="keyword">if</span> (callback) &#123;</span><br><span class="line">          callback(<span class="keyword">this</span>, useParent)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> original.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>);</span><br><span class="line">      &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">        <span class="built_in">console</span>.warn(err);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">var</span> callback = <span class="function"><span class="keyword">function</span> (<span class="params">node, useParent</span>) </span>&#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      nodeList = nodeList.concat(Util.queryImgNodeList(useParent ? node.parentNode : node))</span><br><span class="line">      LazyLoad.check()</span><br><span class="line">    &#125;, <span class="number">5</span>);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>è¿›è¡Œå¤„ç†çš„å±æ€§å’Œæ–¹æ³•</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">NodeWriter.wraptSet(<span class="built_in">window</span>.HTMLImageElement.prototype, <span class="string">'src'</span>, wrapSetSrc);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">window</span>.HTMLSourceElement &amp;&amp; NodeWriter.wraptSet(<span class="built_in">window</span>.HTMLSourceElement.prototype, <span class="string">'src'</span>, wrapSetSrc);</span><br><span class="line">    <span class="comment">// ie8 è®¾ç½®srcsetä¼šæŠ¥é”™ï¼šå±æ€§ä¸èƒ½åŒæ—¶å…·æœ‰å–å€¼å‡½æ•°å’Œå€¼</span></span><br><span class="line">    <span class="keyword">if</span> (!((gBrowser.name === <span class="string">"IE"</span> || gBrowser.name === <span class="string">'MSIE'</span>) &amp;&amp; gBrowser.version === <span class="string">"8"</span>)) &#123;</span><br><span class="line">      NodeWriter.wraptSet(<span class="built_in">window</span>.HTMLImageElement.prototype, <span class="string">'srcset'</span>, wrapSetSrcSet);</span><br><span class="line">      NodeWriter.wraptSet(<span class="built_in">window</span>.HTMLSourceElement.prototype, <span class="string">'srcset'</span>, wrapSetSrcSet);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">window</span>.HTMLVideoElement &amp;&amp; NodeWriter.wraptSet(<span class="built_in">window</span>.HTMLVideoElement.prototype, <span class="string">'poster'</span>, wrapSetSrc);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> EleProto = ((gBrowser.name === <span class="string">"IE"</span> || gBrowser.name === <span class="string">'MSIE'</span>) &amp;&amp; <span class="built_in">window</span>.HTMLElement) ? <span class="built_in">window</span>.HTMLElement.prototype : <span class="built_in">window</span>.Element.prototype</span><br><span class="line"></span><br><span class="line">    NodeWriter.wrapInvoke(EleProto, <span class="string">'insertAdjacentHTML'</span>, callback, <span class="literal">true</span>);</span><br><span class="line">    NodeWriter.wraptSet(EleProto, <span class="string">'innerHTML'</span>, wrapSetOrigin, callback);</span><br><span class="line">    NodeWriter.wraptSet(EleProto, <span class="string">'outerHTML'</span>, wrapSetOrigin, callback, <span class="literal">true</span>);</span><br><span class="line">    NodeWriter.wraptSet(EleProto, <span class="string">'className'</span>, wrapSetOrigin, callback);</span><br></pre></td></tr></table></figure>

<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>æœ¬æ–‡ä»‹ç»äº†ä¸€ä¸ªå¸¦å®½ä¼°ç®—æ¨¡å‹ï¼ŒåŸºäºè¯¥æ¨¡å‹å®ç°åˆ†å±‚åŠ è½½ä¸æ‡’åŠ è½½åŠŸèƒ½ï¼Œæœ‰æ•ˆå‡å°‘ç”¨æˆ·æµé‡æ¶ˆè€—ï¼Œæé«˜é¡µé¢åŠ è½½é€Ÿåº¦ã€‚</p>
]]></content>
      <categories>
        <category>å¤§å‰ç«¯</category>
      </categories>
      <tags>
        <tag>å‰ç«¯ä¼˜åŒ–</tag>
      </tags>
  </entry>
  <entry>
    <title>getElementsByClassNameéå†æ—¶å‡ºç°çš„é—®é¢˜</title>
    <url>/2018/07/15/2018Q3/getElementsByClassName%E9%81%8D%E5%8E%86%E6%97%B6%E5%87%BA%E7%8E%B0%E7%9A%84%E9%97%AE%E9%A2%98/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æˆ‘ä»¬éœ€è¦éå† <code>.lyad</code> çš„å…ƒç´ ,å¹¶å°†å…¶ <code>className</code> ä¸­çš„ <code>lyad</code> åˆ æ‰ã€‚ </p>
<a id="more"></a>


<p>æœ€å¼€å§‹çš„åšæ³•æ˜¯</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> s = <span class="string">'lyad'</span></span><br><span class="line"><span class="keyword">var</span> eles = <span class="built_in">document</span>.querySelectorAll(<span class="string">'.'</span>+<span class="string">'s'</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">0</span>,len=eles.length; j &lt; len; j++) &#123;</span><br><span class="line">  eles[j].className = eles[j].className.replace(s, <span class="string">''</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>æ²¡æœ‰ä»»ä½•é—®é¢˜ã€‚</strong></p>
<p>æŸ¥è¯¢æ–‡æ¡£ä»¥åŠè‡ªæµ‹ï¼Œå‘ç° <code>getElementsByClassName</code> çš„é€Ÿåº¦æ¯” <code>querySelectorAll</code> å¿«å¾ˆå¤šï¼Œ5å€ä»¥ä¸Šã€‚</p>
<p>ä¸ºäº†æ€§èƒ½è€ƒè™‘ï¼Œæˆ‘ä»¬æ”¹ä¸ºä»¥ä¸‹å†™æ³•ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> eles = <span class="built_in">document</span>.getElementsByClassName(s)</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">0</span>,len=eles.length; j &lt; len; j++) &#123;</span><br><span class="line">  eles[j].className = eles[j].className.replace(s, <span class="string">''</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸å‡ºæ„å¤–ï¼Œä¼šæŠ¥ <code>Cannot read property &#39;className&#39; of undefined</code> é”™è¯¯ã€‚</p>
<p>è§‚å¯Ÿå‘ç°ï¼Œä¸€å¼€å§‹ eles ä¸ºå››ä¸ªï¼Œåœ¨è®¿é—® <code>eles[2]</code> çš„æ—¶å€™å‡ºé”™,è¯´æ˜æ­¤æ—¶ <code>eles.length===2</code> ï¼Œè®¿é—®äº†ä¸€ä¸ªç©ºå…ƒç´ ã€‚</p>
<p>å³ï¼Œ getElementsByClassName å¾—åˆ°çš„å…ƒç´ å…¶å¯¹åº” className è¢«åˆ æ‰çš„è¯ï¼Œeles ä¼šè‡ªåŠ¨åˆ å»å…¶å…ƒç´ ã€‚</p>
<p>åšä¸ªæµ‹è¯•ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> eles = <span class="built_in">document</span>.getElementsByClassName(<span class="string">'lyad'</span>)</span><br><span class="line"><span class="built_in">console</span>.log(eles.length) <span class="comment">//4</span></span><br><span class="line">eles[<span class="number">0</span>].className = eles[<span class="number">0</span>].className.replace(<span class="string">'lyad'</span>, <span class="string">''</span>)</span><br><span class="line"><span class="built_in">console</span>.log(eles.length) <span class="comment">//3</span></span><br></pre></td></tr></table></figure>

<h2 id="ä»¥ä¸‹å†™æ³•éƒ½æ˜¯okçš„"><a href="#ä»¥ä¸‹å†™æ³•éƒ½æ˜¯okçš„" class="headerlink" title="ä»¥ä¸‹å†™æ³•éƒ½æ˜¯okçš„"></a>ä»¥ä¸‹å†™æ³•éƒ½æ˜¯okçš„</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> eles = <span class="built_in">document</span>.getElementsByClassName(<span class="string">'lyad'</span>)</span><br><span class="line"><span class="keyword">while</span>(eles.length&gt;<span class="number">0</span>)&#123;</span><br><span class="line">  eles[<span class="number">0</span>].className = eles[<span class="number">0</span>].className.replace(<span class="string">'lyad'</span>, <span class="string">''</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ eles è·å–è¦ç”¨ <code>getElementsByClassName</code> è€Œä¸æ˜¯ <code>querySelectorAll</code> å¦åˆ™å°†å¯¼è‡´æ­»å¾ªç¯ã€‚</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> eles = <span class="built_in">document</span>.getElementsByClassName(<span class="string">'lyad'</span>)</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">0</span>,len=eles.length; j &lt; len; j++) &#123;</span><br><span class="line">  eles[<span class="number">0</span>].className = eles[<span class="number">0</span>].className.replace(<span class="string">'lyad'</span>, <span class="string">''</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ len éœ€è¦ç”¨ä¸´æ—¶å˜é‡ä¿å­˜ï¼Œå¦åˆ™æ¯æ¬¡è·å–å°†ä¼šå¾—åˆ°ä¸åŒçš„ length å¯¼è‡´æå‰ç»“æŸã€‚</p>
<p>ç›¸æ¯”ä¸Šä¸€ç§å†™æ³•æ›´å®‰å…¨ã€‚</p>
<h2 id="è¡¥å……"><a href="#è¡¥å……" class="headerlink" title="è¡¥å……"></a>è¡¥å……</h2><p>ä¸Šé¢å†™æ³•æœ‰å·®å¼‚ï¼Œåœ¨äºNodeListå¯¹è±¡çš„ä¸åŒè¡¨ç°ã€‚</p>
<blockquote>
<p>å¤§å¤šæ•°æƒ…å†µä¸‹ï¼ŒNodeList å¯¹è±¡éƒ½æ˜¯ä¸ªå®æ—¶é›†åˆã€‚</p>
<p>æ„æ€æ˜¯è¯´ï¼Œå¦‚æœæ–‡æ¡£ä¸­çš„èŠ‚ç‚¹æ ‘å‘ç”Ÿå˜åŒ–ï¼Œåˆ™å·²ç»å­˜åœ¨çš„ NodeList å¯¹è±¡ä¹Ÿå¯èƒ½ä¼šå˜åŒ–ã€‚</p>
<p>åœ¨å¦ä¸€äº›æƒ…å†µä¸‹ï¼ŒNodeList æ˜¯ä¸€ä¸ªé™æ€é›†åˆï¼Œä¹Ÿå°±æ„å‘³ç€éšåå¯¹æ–‡æ¡£å¯¹è±¡æ¨¡å‹çš„ä»»ä½•æ”¹åŠ¨éƒ½ä¸ä¼šå½±å“é›†åˆçš„å†…å®¹ã€‚document.querySelectorAll è¿”å›ä¸€ä¸ªé™æ€çš„ NodeListã€‚</p>
</blockquote>
<p>å¼•ç”¨è‡ªï¼š<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/NodeList" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Web/API/NodeList</a></p>
<p>åŒæ—¶ï¼Œè¿™ä¹Ÿè§£é‡Šäº†ä¸ºä½•<code>getElementsByClassName</code>è·å–NodeListçš„é€Ÿåº¦æ¯”<code>querySelectorAll</code>å¿«ã€‚</p>
<p>å› ä¸ºå‰è€…ä»…è¿”å› <strong>åˆ—è¡¨çš„å¼•ç”¨åœ°å€</strong> ä»…è®¿é—®æ—¶æ‰å®æ—¶è·å–æ•°æ® , è€Œåè€…ä¸€å¼€å§‹å°±è¦è·å–å’Œå°è£…æ‰€æœ‰æ•°æ®ã€‚</p>
<blockquote>
<p>DynamicNodeList å¯¹è±¡é€šè¿‡åœ¨cacheç¼“å­˜ä¸­ æ³¨å†Œå®ƒçš„å­˜åœ¨ å¹¶åˆ›å»ºã€‚ ä»æœ¬è´¨ä¸Šè®², åˆ›å»ºä¸€ä¸ªæ–°çš„ DynamicNodeList æ˜¯éå¸¸è½»é‡çº§çš„, å› ä¸ºä¸éœ€è¦åšä»»ä½•å‰æœŸå·¥ä½œã€‚ æ¯æ¬¡è®¿é—® DynamicNodeList æ—¶, å¿…é¡»æŸ¥è¯¢ document çš„å˜åŒ–, length å±æ€§ ä»¥åŠ item() æ–¹æ³•è¯æ˜äº†è¿™ä¸€ç‚¹(ä½¿ç”¨ä¸­æ‹¬å·çš„æ–¹å¼è®¿é—®ä¹Ÿæ˜¯ä¸€æ ·çš„).</p>
</blockquote>
<blockquote>
<p>ç›¸æ¯”ä¹‹ä¸‹, StaticNodeList å¯¹è±¡å®ä¾‹ç”±å¦ä¸€ä¸ªæ–‡ä»¶åˆ›å»º,ç„¶åå¾ªç¯å¡«å……æ‰€æœ‰çš„æ•°æ® ã€‚ åœ¨ document ä¸­æ‰§è¡Œé™æ€æŸ¥è¯¢çš„å‰æœŸæˆæœ¬ä¸Šæ¯”èµ· DynamicNodeList è¦æ˜¾è‘—æé«˜å¾ˆå¤šå€ã€‚</p>
</blockquote>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://blog.csdn.net/renfufei/article/details/41088521" target="_blank" rel="noopener">DOMä¸­çš„åŠ¨æ€NodeListä¸é™æ€NodeList</a></p>
]]></content>
      <categories>
        <category>å¤§å‰ç«¯</category>
      </categories>
      <tags>
        <tag>HTML</tag>
      </tags>
  </entry>
  <entry>
    <title>å‰ç«¯å°çŸ¥è¯†-æ ¼å¼åŒ–æ ‡ç­¾</title>
    <url>/2018/07/12/2018Q3/%E5%89%8D%E7%AB%AF%E5%B0%8F%E7%9F%A5%E8%AF%86-%E6%A0%BC%E5%BC%8F%E5%8C%96%E6%A0%87%E7%AD%BE/</url>
    <content><![CDATA[<p>å¸¸è§çš„htmlæ ¼å¼åŒ–æ ‡ç­¾ï¼š<code>a, b, big, code, em, font, i, nobr, s, small, strike, strong, tt, and u.</code></p>
<a id="more"></a>

<p>å¯¹äºä»¥ä¸‹ä»£ç </p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">b</span>&gt;</span>666<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span>aaa<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æ¸²æŸ“å¼•æ“ä¼šå°†å…¶è§£ææˆ</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">b</span>&gt;</span>666<span class="tag">&lt;/<span class="name">b</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">b</span>&gt;</span><span class="tag">&lt;/<span class="name">b</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">b</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>aaa<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">b</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>å³æµè§ˆå™¨è®¤ä¸ºæ ¼å¼åŒ–æ ‡ç­¾çš„å¼€é—­æ ‡ç­¾å¯èƒ½æ˜¯ä¼šè·¨èŠ‚ç‚¹çš„ï¼ˆéåŒä¸€çº§ï¼‰</p>
<p>åç»­æŸ¥æ‰¾æ²¡æœ‰æ‰¾åˆ°é—­æ ‡ç­¾ä¼šåœ¨åŸèŠ‚ç‚¹åŸºç¡€ä¸Šæ·»åŠ æ ¼å¼åŒ–æ ‡ç­¾ä¸ºçˆ¶èŠ‚ç‚¹</p>
<blockquote>
<p>å› ä¸º b ç­‰å¸¦æœ‰æ ¼å¼åŒ–çš„æ ‡ç­¾ä¼šç‰¹æ®Šå¤„ç†ï¼Œé‡åˆ°ä¸€ä¸ªå¼€æ ‡ç­¾æ—¶ä¼šå®ƒä»¬æ”¾åˆ°ä¸€ä¸ªåˆ—è¡¨é‡Œé¢ï¼š</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">m_activeFormattingElements.append(currentElementRecord()-&gt;stackItem());</span><br></pre></td></tr></table></figure>

<p>é‡åˆ°ä¸€ä¸ªé—­æ ‡ç­¾æ—¶ï¼Œåˆä¼šä»è¿™ä¸ªåˆ—è¡¨é‡Œé¢åˆ æ‰ã€‚æ¯å¤„ç†ä¸€ä¸ªæ–°æ ‡ç­¾æ—¶å°±ä¼šè¿›è¡Œæ£€æŸ¥å’Œè¿™ä¸ªåˆ—è¡¨å’Œæ ˆé‡Œçš„å¼€æ ‡ç­¾æ˜¯å¦å¯¹åº”ï¼Œå¦‚æœä¸å¯¹åº”åˆ™ä¼š reconstruct ï¼šé‡æ–°æ’å…¥ä¸€ä¸ªå¼€æ ‡ç­¾ã€‚å› æ­¤ b å°±ä¸æ–­åœ°è¢«é‡æ–°æ’å…¥ï¼Œç›´åˆ°é‡åˆ°ä¸‹ä¸€ä¸ªbçš„é—­æ ‡ç­¾ä¸ºæ­¢ã€‚</p>
<p>å‚è€ƒ <a href="https://zhuanlan.zhihu.com/p/24911872" target="_blank" rel="noopener">ä»Chromeæºç çœ‹æµè§ˆå™¨å¦‚ä½•æ„å»ºDOMæ ‘</a></p>
]]></content>
      <categories>
        <category>å¤§å‰ç«¯</category>
      </categories>
  </entry>
  <entry>
    <title>æµ…è°ˆ preload é¢„åŠ è½½</title>
    <url>/2018/07/10/2018Q3/%E6%B5%85%E8%B0%88%20preload%20%E9%A2%84%E5%8A%A0%E8%BD%BD/</url>
    <content><![CDATA[<h1 id="preloadç®€ä»‹"><a href="#preloadç®€ä»‹" class="headerlink" title="preloadç®€ä»‹"></a>preloadç®€ä»‹</h1><p>ä¸€ç§èµ„æºé¢„åŠ è½½çš„æ–¹å¼ã€‚ç”¨äºæé«˜æ€§èƒ½ï¼Œæ–¹ä¾¿å¼€å‘äººå‘˜æ§åˆ¶èµ„æºåŠ è½½ã€‚</p>
<p>preload æŒ‡ç¤ºæµè§ˆå™¨é¢„å…ˆè¯·æ±‚å½“å‰é¡µé¢æ¥ä¸‹æ¥ä¼šéœ€è¦ç”¨åˆ°çš„èµ„æºã€‚</p>
<p>åœ¨chromeä¸­ï¼Œé‡‡ç”¨ preload é¢„åŠ è½½èµ„æºåï¼Œåç»­æ²¡æœ‰åœ¨å¯¹èµ„æºè¿›è¡Œè¯·æ±‚(3s)ï¼Œæ§åˆ¶å°ä¼šæç¤ºè¯´æ˜¯å¦æœ‰å¿…è¦é¢„åŠ è½½è¯¥èµ„æºã€‚</p>
<a id="more"></a>


<h1 id="ä½¿ç”¨preloadçš„å‡ ç§æ–¹å¼"><a href="#ä½¿ç”¨preloadçš„å‡ ç§æ–¹å¼" class="headerlink" title="ä½¿ç”¨preloadçš„å‡ ç§æ–¹å¼"></a>ä½¿ç”¨preloadçš„å‡ ç§æ–¹å¼</h1><h2 id="æ–¹å¼1ï¼šhtmlé¡µé¢ä¹¦å†™linkæ ‡ç­¾"><a href="#æ–¹å¼1ï¼šhtmlé¡µé¢ä¹¦å†™linkæ ‡ç­¾" class="headerlink" title="æ–¹å¼1ï¼šhtmlé¡µé¢ä¹¦å†™linkæ ‡ç­¾"></a>æ–¹å¼1ï¼šhtmlé¡µé¢ä¹¦å†™linkæ ‡ç­¾</h2><p><code>&lt;link rel=&quot;preload&quot; href=&quot;èµ„æºåœ°å€&quot; as=&quot;script&quot;&gt;</code> </p>
<p>as å±æ€§å‘Šè¯‰æµè§ˆå™¨åŠ è½½çš„æ˜¯ä»€ä¹ˆèµ„æºï¼Œ<a href="https://link.jianshu.com/?t=https://fetch.spec.whatwg.org/#concept-request-destination" target="_blank" rel="noopener">å¸¸è§å–å€¼æœ‰ï¼šâ€scriptâ€,â€styleâ€,â€imageâ€,â€mediaâ€,â€documentâ€</a></p>
<p>ä¸åŠ aså‚æ•°ï¼Œèµ„æºè¯·æ±‚ä¼˜å…ˆçº§å’Œå¼‚æ­¥xhrä¸€æ ·ï¼Œéå¸¸ä½ã€‚(æ–°ç‰ˆchromeæ— asæˆ–é”™è¯¯å€¼å°†ä¸ä¼šè¿›è¡Œpreload)</p>
<p>å¯¹äºå­—ä½“æ–‡ä»¶<code>as=&quot;font&quot;</code>ï¼Œéœ€è¦åŠ ä¸Š<code>crossorigin</code>å±æ€§: <a href="https://drafts.csswg.org/css-fonts/#font-fetching-requirements" target="_blank" rel="noopener">fonts were fetched using anonymous mode CORS </a>,<br>å¦åˆ™æ¥ä¸‹æ¥çš„å­—ä½“èµ„æºè¯·æ±‚ä¼šé‡æ–°è·å–ï¼ˆäºŒæ¬¡è·å–ï¼‰ã€‚</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"preload"</span> <span class="attr">href</span>=<span class="string">"font.woff2"</span> <span class="attr">as</span>=<span class="string">"font"</span> <span class="attr">type</span>=<span class="string">"font/woff2"</span> <span class="attr">crossorigin</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>typeå’Œasæœ‰ä¸€æ ·çš„ä½œç”¨ï¼Œå–å€¼ä¸ä¸€æ ·</p>
<blockquote>
<p>ä¸€è¡Œä»£ç å®ç°cssæ‡’åŠ è½½</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"preload"</span> <span class="attr">as</span>=<span class="string">"style"</span> <span class="attr">href</span>=<span class="string">"asyncstyle.css"</span> <span class="attr">onload</span>=<span class="string">"this.rel='stylesheet'"</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>å“åº”å¼åŠ è½½</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"preload"</span> <span class="attr">as</span>=<span class="string">"image"</span> <span class="attr">href</span>=<span class="string">"map.png"</span> <span class="attr">media</span>=<span class="string">"(max-width: 600px)"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"preload"</span> <span class="attr">as</span>=<span class="string">"script"</span> <span class="attr">href</span>=<span class="string">"map.js"</span> <span class="attr">media</span>=<span class="string">"(min-width: 601px)"</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="æ–¹å¼2ï¼šjsåˆ›å»ºlinkæ ‡ç­¾"><a href="#æ–¹å¼2ï¼šjsåˆ›å»ºlinkæ ‡ç­¾" class="headerlink" title="æ–¹å¼2ï¼šjsåˆ›å»ºlinkæ ‡ç­¾"></a>æ–¹å¼2ï¼šjsåˆ›å»ºlinkæ ‡ç­¾</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> elem = <span class="built_in">document</span>.createElement(<span class="string">"link"</span>);</span><br><span class="line">elem.setAttribute(<span class="string">"href"</span>, url);</span><br><span class="line">elem.setAttribute(<span class="string">"as"</span>, <span class="string">"script"</span>);</span><br><span class="line">elem.setAttribute(<span class="string">"rel"</span>, <span class="string">"preload"</span>);</span><br><span class="line"><span class="built_in">document</span>.head.appendChild(elem);</span><br></pre></td></tr></table></figure>

<h2 id="åˆ©ç”¨httpå“åº”å¤´é¢„åŠ è½½"><a href="#åˆ©ç”¨httpå“åº”å¤´é¢„åŠ è½½" class="headerlink" title="åˆ©ç”¨httpå“åº”å¤´é¢„åŠ è½½"></a>åˆ©ç”¨httpå“åº”å¤´é¢„åŠ è½½</h2><p>åœ¨htmlé¡µé¢çš„å“åº”å¤´ä¸­å¢åŠ  Link å“åº”å¤´ï¼Œå…¶å†…å®¹ä¸º<code>&lt;./js/image-optimizer.js&gt;; rel=preload; as=script</code></p>
<p>åœ¨htmlæ–‡æ¡£ä¸‹è½½å®Œæ¯•æ—¶ï¼Œåˆ™ä¼šè¿›è¡Œ<code>./js/image-optimizer.js</code>çš„é¢„åŠ è½½</p>
<blockquote>
<p>æœ¬åœ°åˆ©ç”¨ fiddler4åšä¸ªæµ‹è¯•</p>
</blockquote>
<ol>
<li>è¾“å…¥bpu localhost/test.htmlå‘½ä»¤ æ‹¦æˆªæµ‹è¯•é¡µé¢htmlè¯·æ±‚ï¼Œæ­¤æ—¶å¯ä»¥è¿›è¡Œè¯·æ±‚å¤´å’Œå†…å®¹çš„ä¿®æ”¹</li>
<li>ç‚¹å‡» <em>Break on Response</em> æŒ‰é’® å‘èµ·è¯·æ±‚ï¼Œå¹¶æ‹¦æˆªå“åº”ï¼Œæ­¤å¤„æˆ‘ä»¬å¯¹å“åº”å¤´è¿›è¡Œå†…å®¹æ·»åŠ </li>
<li>ç‚¹å‡» <em>Run to Completino</em> æŒ‰é’®,è¿”å›å“åº”ã€‚</li>
</ol>
<h1 id="æµè§ˆå™¨å…¼å®¹æ€§"><a href="#æµè§ˆå™¨å…¼å®¹æ€§" class="headerlink" title="æµè§ˆå™¨å…¼å®¹æ€§"></a>æµè§ˆå™¨å…¼å®¹æ€§</h1><p><a href="https://caniuse.com/#search=preload" target="_blank" rel="noopener">chrome 50+,safari 11+ç­‰</a></p>
<blockquote>
<p>æ£€æµ‹<code>&lt;link rel=&quot;preload&quot;&gt;</code>æ˜¯å¦è¢«æ”¯æŒ</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> preloadSupported = <span class="function"><span class="params">()</span> =&gt;</span> &#123; </span><br><span class="line">  <span class="keyword">const</span> link = <span class="built_in">document</span>.createElement(<span class="string">'link'</span>); </span><br><span class="line">  <span class="keyword">const</span> relList = link.relList; </span><br><span class="line">  <span class="keyword">if</span> (!relList || !relList.supports) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>; </span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> relList.supports(<span class="string">'preload'</span>); </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>


<h1 id="ä¸-prefetch-çš„å¼‚åŒç‚¹"><a href="#ä¸-prefetch-çš„å¼‚åŒç‚¹" class="headerlink" title="ä¸ prefetch çš„å¼‚åŒç‚¹"></a>ä¸ prefetch çš„å¼‚åŒç‚¹</h1><h2 id="åŒºåˆ«"><a href="#åŒºåˆ«" class="headerlink" title="åŒºåˆ«"></a>åŒºåˆ«</h2><p>å½“å‰é¡µé¢å¿…è¦èµ„æºåˆ™é‡‡ç”¨<code>preload</code>,å°†æ¥é¡µé¢ä½¿ç”¨çš„èµ„æºé‡‡ç”¨<code>prefetch</code></p>
<p>Aé¡µé¢å‘èµ· a.js çš„ prefetch é¢„åŠ è½½ï¼Œåœ¨è¯·æ±‚è¿‡ç¨‹ä¸­æ­¤æ—¶è°ƒè½¬åˆ°Bé¡µé¢ï¼Œa.js è¯·æ±‚ä¸ä¼šä¸­æ–­ï¼Œè€Œæ¢æˆ preloadé¢„åŠ è½½åˆ™è¯·æ±‚ä¼šä¸­æ–­ã€‚</p>
<h2 id="å…±é€šç‚¹"><a href="#å…±é€šç‚¹" class="headerlink" title="å…±é€šç‚¹"></a>å…±é€šç‚¹</h2><blockquote>
<p>Chrome æœ‰å››ç§ç¼“å­˜: HTTP ç¼“å­˜ï¼Œå†…å­˜ç¼“å­˜ï¼ŒService Worker ç¼“å­˜å’Œ Push ç¼“å­˜ã€‚preload å’Œ prefetch éƒ½è¢«å­˜å‚¨åœ¨ HTTP ç¼“å­˜ä¸­ã€‚</p>
<p>å½“ä¸€ä¸ªèµ„æºè¢« preload æˆ–è€… prefetch è·å–åï¼Œå®ƒå¯ä»¥ä» HTTP ç¼“å­˜ç§»åŠ¨è‡³æ¸²æŸ“å™¨çš„å†…å­˜ç¼“å­˜ä¸­ã€‚å¦‚æœèµ„æºå¯ä»¥è¢«ç¼“å­˜ï¼ˆæ¯”å¦‚è¯´å­˜åœ¨æœ‰æ•ˆçš„cache-control å’Œ max-ageï¼‰ï¼Œå®ƒè¢«å­˜å‚¨åœ¨ HTTP ç¼“å­˜ä¸­å¯ä»¥è¢«ç°åœ¨æˆ–å°†æ¥çš„ä»»åŠ¡ä½¿ç”¨ï¼Œå¦‚æœèµ„æºä¸èƒ½è¢«&gt;ç¼“å­˜åœ¨ HTTP ç¼“å­˜ä¸­ï¼Œä½œä¸ºä»£æ›¿ï¼Œå®ƒè¢«æ”¾åœ¨å†…å­˜ç¼“å­˜ä¸­ç›´åˆ°è¢«ä½¿ç”¨ã€‚</p>
</blockquote>
<h2 id="æ³¨æ„ç‚¹"><a href="#æ³¨æ„ç‚¹" class="headerlink" title="æ³¨æ„ç‚¹"></a>æ³¨æ„ç‚¹</h2><ol>
<li>å½“prefetchå’Œpreloadé¢„åŠ è½½åŒä¸€ä¸ªèµ„æºæ—¶ï¼Œå®é™…ä¼šäº§ç”Ÿä¸¤æ¬¡ä¸‹è½½</li>
</ol>
<h2 id="Chrome-å¯¹äº-preload-å’Œ-prefetch-çš„ç½‘ç»œä¼˜å…ˆçº§ï¼Ÿ"><a href="#Chrome-å¯¹äº-preload-å’Œ-prefetch-çš„ç½‘ç»œä¼˜å…ˆçº§ï¼Ÿ" class="headerlink" title="Chrome å¯¹äº preload å’Œ prefetch çš„ç½‘ç»œä¼˜å…ˆçº§ï¼Ÿ"></a>Chrome å¯¹äº preload å’Œ prefetch çš„ç½‘ç»œä¼˜å…ˆçº§ï¼Ÿ</h2><p><img src="https://www.w3cplus.com/sites/default/files/blogs/2017/1708/preload-6.jpeg"></img><br>(æ¥æºï¼š<a href="https://docs.google.com/document/d/1bCDuq9H1ih9iNjgzyAL0gpwNFiEP4TZS-YLRp_RuMlc/edit#" target="_blank" rel="noopener">https://docs.google.com/document/d/1bCDuq9H1ih9iNjgzyAL0gpwNFiEP4TZS-YLRp_RuMlc/edit#</a>)</p>
<blockquote>
<p>perloadåˆ©ç”¨asæˆ–typeæ¥è¡¨ç¤ºè¯·æ±‚èµ„æºçš„ä¼˜å…ˆçº§ã€‚</p>
</blockquote>
<p>æŒ‰DevToolsçš„æ ‡å‡†ï¼Œaså–å€¼å¯¹åº”çš„ä¼˜å…ˆçº§å¦‚ä¸‹ï¼š</p>
<ul>
<li>styleâ€“&gt;Highest</li>
<li>script,fontâ€“&gt;High </li>
<li>imageâ€“&gt;Low</li>
</ul>
<p>Prefetchçš„ä¼˜å…ˆçº§ä¸º Lowest</p>
<p>ä»è¯¥è¡¨å¾—åˆ°çš„å…¶ä»–ä¿¡æ¯ï¼š</p>
<ol>
<li>ç¬¬ä¸€å¼ å›¾ç‰‡é¢„åŠ è½½ä¹‹å‰å‘èµ·çš„è„šæœ¬è¯·æ±‚ä¼˜å…ˆçº§ä¸º High</li>
<li>ç¬¬ä¸€å¼ å›¾ç‰‡é¢„åŠ è½½ä¹‹åå‘èµ·çš„è„šæœ¬è¯·æ±‚ä¼˜å…ˆçº§ä¸º Medium</li>
<li>å¼‚æ­¥è„šæœ¬è¯·æ±‚ä¼˜å…ˆçº§ä¸º Low</li>
<li>è§†å£å›¾ç‰‡æ¯”éè§†å£å›¾ç‰‡çš„è¯·æ±‚ä¼˜å…ˆçº§é«˜</li>
</ol>
<p>å›¾ç‰‡é¢„åŠ è½½ä¹‹å‰ï¼š<code>scriptèŠ‚ç‚¹</code>åœ¨domè§£ææ—¶å¤„äºå›¾ç‰‡èŠ‚ç‚¹ä¹‹å‰</p>
<h1 id="DNS-prefetch"><a href="#DNS-prefetch" class="headerlink" title="DNS prefetch"></a>DNS prefetch</h1><p>é¢„è§£æ DNS</p>
<p>é»˜è®¤æƒ…å†µä¸‹ <code>dns prefetch</code> åªå¯¹hrefå±æ€§çš„urlåœ°å€è¿›è¡Œdnsé¢„è§£æï¼Œä½†è‹¥å½“è¯¥ç½‘ç«™å¤„äºhttpsæ—¶åˆ™ä¸ä¼šè¿›è¡Œå¤„ç†</p>
<p>å¯ä»¥é€šè¿‡<code>&lt;meta http-equiv=&quot;x-dns-prefetch-control&quot; content=&quot;on&quot;&gt;</code>æ‰‹åŠ¨å¼€å¯ï¼Œæ­¤æ—¶httpsä¹Ÿå¯æ­£å¸¸å¤„ç†ï¼Œå¯é€šè¿‡è®¾ç½®offæ¥è¿›è¡Œå…³é—­ï¼Œå½“è®¾ç½®offå…³é—­åï¼Œå†è®¾ç½®onå°±æ²¡æœ‰æ•ˆæœäº†ã€‚</p>
<p>åˆ©ç”¨ <code>&lt;link rel=&quot;dns-prefetch&quot; href=&quot;//host_name_to_prefetch.com&quot;&gt;</code>æ‰‹åŠ¨é¢„è§£æï¼Œä¸€èˆ¬ç”¨æ¥é¢„è§£æä»¥ä¸‹åœºæ™¯ï¼šè¯·æ±‚é‡å®šå‘åçš„åœ°å€ï¼Œjsä»£ç ä¸­çš„å¼‚æ­¥è¯·æ±‚åœ°å€ï¼Œå›¾ç‰‡è¯·æ±‚åœ°å€ï¼Œè¾ƒæ™šè¢«domè§£æçš„scriptèŠ‚ç‚¹åœ°å€</p>
<h1 id="å‚è€ƒæ–‡æ¡£"><a href="#å‚è€ƒæ–‡æ¡£" class="headerlink" title="å‚è€ƒæ–‡æ¡£"></a>å‚è€ƒæ–‡æ¡£</h1><ol>
<li><a href="https://www.w3.org/TR/preload/" target="_blank" rel="noopener">W3C preload æ–‡æ¡£</a></li>
<li><a href="https://www.smashingmagazine.com/2016/02/preload-what-is-it-good-for/" target="_blank" rel="noopener">Preload: What is it Good For?</a></li>
<li><a href="http://dev.chromium.org/developers/design-documents/dns-prefetching" target="_blank" rel="noopener">chromium DNS Prefetching</a></li>
<li><a href="https://www.w3cplus.com/performance/reloading/preload-prefetch-and-priorities-in-chrome.html" target="_blank" rel="noopener">Preloadï¼ŒPrefetch å’Œå®ƒä»¬åœ¨ Chrome ä¹‹ä¸­çš„ä¼˜å…ˆçº§</a> </li>
<li><a href="http://dev.chromium.org/developers/design-documents/dns-prefetching" target="_blank" rel="noopener">DNS Prefetching</a></li>
</ol>
]]></content>
      <categories>
        <category>å¤§å‰ç«¯</category>
      </categories>
      <tags>
        <tag>å‰ç«¯ä¼˜åŒ–</tag>
      </tags>
  </entry>
  <entry>
    <title>å‰ç«¯ç›‘å¬èµ„æºåŠ è½½é”™è¯¯</title>
    <url>/2018/07/05/2018Q3/%E5%89%8D%E7%AB%AF%E7%9B%91%E5%90%AC%E8%B5%84%E6%BA%90%E5%8A%A0%E8%BD%BD%E9%94%99%E8%AF%AF/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>é¡µé¢ä¸Šæœ‰å¾ˆå¤šèµ„æºå…ƒç´ ï¼Œæ¯”å¦‚ <code>&lt;img&gt;</code>,<code>&lt;iframe&gt;</code>ç­‰ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“å…¶åŠ è½½æƒ…å†µ,æ ¹æ®åŠ è½½æˆåŠŸä¸å¦è¿›è¡Œä¸‹ä¸€æ­¥çš„å¤„ç†ã€‚</p>
<a id="more"></a>

<p>å¸¸è§çš„åšæ³•æ˜¯ç»™è¿™äº›å…ƒç´ ä¸Šè®¾ç½® <code>onload</code>,<code>onerror</code>æ–¹æ³•ã€‚</p>
<p>æ¯”å¦‚ï¼š<code>&lt;img onerror=&quot;errFn()&quot; onload=&quot;loadFn()&quot;&gt;</code></p>
<blockquote>
<p>æ”¯æŒ <code>onload</code> çš„æ ‡ç­¾ï¼š<code>&lt;body&gt;, &lt;frame&gt;, &lt;frameset&gt;, &lt;iframe&gt;, &lt;img&gt;, &lt;input type=&quot;image&quot;&gt;, &lt;link&gt;, &lt;script&gt;, &lt;style&gt;</code></p>
</blockquote>
<blockquote>
<p>æ”¯æŒ <code>onerror</code> çš„æ ‡ç­¾ï¼š<code>&lt;img&gt;, &lt;input type=&quot;image&quot;&gt;, &lt;object&gt;, &lt;script&gt;, &lt;style&gt; , &lt;audio&gt;, &lt;video&gt;</code></p>
</blockquote>
<p>æ³¨æ„IE9.0åŠä»¥ä¸Šæ‰æ”¯æŒ <code>&lt;audio&gt;, &lt;video&gt;</code> æ ‡ç­¾</p>
<p>æ­¤å¤–å‡ ä¹æ‰€æœ‰æµè§ˆå™¨éƒ½æ”¯æŒ <code>onload</code> å’Œ <code>onerror</code>,</p>
<p><strong>è¿™ç§åšæ³•çš„ç¼ºç‚¹ï¼š</strong></p>
<ol>
<li>æ¯ä¸ªè¦å¤„ç†çš„å…ƒç´ éƒ½è¦ç»‘å®šäº‹ä»¶ï¼Œhtmlå’Œjsè€¦åˆå¤ªæ·±,å¤„ç†çš„è„šæœ¬ä¸èƒ½é€šç”¨åŒ–ã€æ’ä»¶åŒ–ï¼Œæ¯”å¦‚ç»™å¦ä¸€ä¸ªé¡µé¢ä¹Ÿèƒ½æ–¹ä¾¿ä½¿ç”¨</li>
<li>Windows 7 ä¸‹çš„ Internet Explorer 11 ä¸æ”¯æŒ <code>&lt;audio&gt;, &lt;video&gt;</code>çš„ onerror äº‹ä»¶ï¼ˆæˆ‘æ²¡è¯•è¿‡ã€‚</li>
</ol>
<h2 id="window-addEventListener"><a href="#window-addEventListener" class="headerlink" title="window.addEventListener"></a>window.addEventListener</h2><p><code>window.addEventListener(&#39;error&#39;)</code>ä¸window.onerrorçš„å¼‚åŒç‚¹åœ¨äºï¼š</p>
<ol>
<li>å‰è€…èƒ½å¤Ÿæ•è·åˆ°èµ„æºåŠ è½½é”™è¯¯ï¼Œåè€…ä¸èƒ½ã€‚</li>
<li>éƒ½èƒ½æ•è·jsè¿è¡Œæ—¶é”™è¯¯ï¼Œæ•è·åˆ°çš„é”™è¯¯å‚æ•°ä¸åŒã€‚å‰è€…å‚æ•°ä¸ºä¸€ä¸ªeventå¯¹è±¡ï¼›åè€…ä¸º msg, url, lineNo, columnNo, errorä¸€ç³»åˆ—å‚æ•°ã€‚eventå¯¹è±¡ä¸­éƒ½å«æœ‰åè€…å‚æ•°çš„ä¿¡æ¯ã€‚</li>
</ol>
<p>ç”¨æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">window</span>.addEventListener(<span class="string">'error'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(event)</span><br><span class="line">  <span class="keyword">if</span> (event) &#123;</span><br><span class="line">    <span class="keyword">var</span> target = event.target || event.srcElement;</span><br><span class="line">    <span class="comment">// å†™ä¸Š</span></span><br><span class="line">    <span class="keyword">var</span> isElementTarget = target <span class="keyword">instanceof</span> HTMLElement</span><br><span class="line">    <span class="keyword">if</span> (!isElementTarget) <span class="keyword">return</span>; <span class="comment">// js errorä¸å†å¤„ç†</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> source = event.target</span><br><span class="line">    <span class="comment">// å¯¹è¯¥èµ„æºè¿›è¡Œå¤„ç†..</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//è®¾ä¸ºtrueè¡¨ç¤ºæ•è·é˜¶æ®µè°ƒç”¨ï¼Œä¼šåœ¨å…ƒç´ çš„onerrorå‰è°ƒç”¨</span></span><br><span class="line">&#125;, <span class="literal">true</span>)</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢è¯´è¿‡ï¼Œ<code>&lt;iframe&gt;</code>æ”¯æŒ onload ä¸æ”¯æŒ onerror,æ•…ä»¥ä¸Šä»£ç ä¸ä¼šç›‘å¬åˆ°iframeåŠ è½½å¤±è´¥äº‹ä»¶</p>
<p>æ­¤å¤–ï¼Œç”±äº<code>window.addEventListener(&#39;load&#39;)</code>æ˜¯ç›‘å¬æ–‡æ¡£æ˜¯å¦åŠ è½½å®Œæ¯•ï¼Œæ•…æ— æ³•ç›‘å¬èµ„æºåŠ è½½æˆåŠŸäº‹ä»¶</p>
<h2 id="æœ€ç»ˆæ–¹æ¡ˆï¼š-document-addEventListener"><a href="#æœ€ç»ˆæ–¹æ¡ˆï¼š-document-addEventListener" class="headerlink" title="æœ€ç»ˆæ–¹æ¡ˆï¼š document.addEventListener"></a>æœ€ç»ˆæ–¹æ¡ˆï¼š document.addEventListener</h2><p><code>document.addEventListener</code> å¯ä»¥ç”¨æ¥ç›‘å¬<code>Elementå…ƒç´ </code>çš„åŠ è½½æƒ…å†µ</p>
<p>å¯¹äºiframeæ¥è¯´ï¼Œæˆ‘ä»¬åªèƒ½ç›‘å¬load.</p>
<p><s>è‡³äºåˆ¤æ–­æ˜¯å¦åŠ è½½æˆåŠŸï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ï¼š<code>event.target.contentWindow!==null</code>æ¥åˆ¤æ–­ã€‚</p>
<p><strong>åªè¦è¯·æ±‚å“åº”æˆåŠŸï¼Œè¯¥ contentWindow å°±ä¸ä¼šä¸ºnullã€‚</strong></p>
<p>æ³¨æ„ï¼šå¯¹äºè®¾ç½®äº†<code>X-Frame-Options:DENY</code>æˆ–<code>Content Security Policy</code>çš„æƒ…å†µï¼Œç”±äºè¯·æ±‚å“åº”æ˜¯okçš„ï¼Œæ‰€ä»¥ contentWindow ä¸ä¼šä¸ºç©ºã€‚</p>
<p>è¿™ç§æƒ…å†µæ˜¯å¦å±äºèµ„æºåŠ è½½é”™è¯¯å±äºäº§å“å±‚é¢å®šä¹‰ã€‚</p>
<p>è‹¥å½’ç±»ä¸ºåŠ è½½é”™è¯¯ï¼Œæš‚æœªæ‰¾åˆ°å¥½çš„è§£å†³æ–¹æ¡ˆã€‚</p>
<blockquote>
<p>åŒåŸŸçš„è¯å¯ä»¥è®¿é—® contetnDocument, çœ‹é‡Œé¢å†…å®¹æ˜¯å¦ä¸ºç©ºï¼ˆä»…åªæœ‰headå’Œbodyæ ‡ç­¾ï¼‰<br></s></p>
</blockquote>
<blockquote>
<p>ä½†æ˜¯åŠ è½½æˆåŠŸå¤±è´¥ä¸å¦ï¼ŒcontentWindow å¯¹è±¡éƒ½å­˜åœ¨ã€‚</p>
</blockquote>
<p>å¯¹äºåŒåŸŸ iframe å¯ä»¥æ£€æŸ¥ contenDocument çš„å†…å®¹æ¥åˆ¤æ–­</p>
<p><strong>å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">document</span>.addEventListener(<span class="string">'load'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (event) &#123;</span><br><span class="line">    <span class="keyword">var</span> target = event.target</span><br><span class="line">    <span class="keyword">if</span>(target.localName===<span class="string">'iframe'</span>)&#123;</span><br><span class="line">      <span class="comment">// ç»§ç»­åˆ¤æ–­...</span></span><br><span class="line">    &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">      <span class="comment">//èµ„æºåŠ è½½æˆåŠŸå¤„ç†..</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;, <span class="literal">true</span>)</span><br><span class="line"><span class="built_in">document</span>.addEventListener(<span class="string">'error'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (event) &#123;</span><br><span class="line">    <span class="keyword">var</span> target = event.target</span><br><span class="line">    <span class="comment">// èµ„æºåŠ è½½é”™è¯¯å¤„ç†.. target.outerHTML æ‹¿åˆ°åŸæ ‡ç­¾å†…å®¹ï¼Œä¾‹ &lt;img src="./img/a.png"&gt;</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//è®¾ä¸ºtrueè¡¨ç¤ºæ•è·é˜¶æ®µè°ƒç”¨ï¼Œä¼šåœ¨å…ƒç´ çš„onerrorå‰è°ƒç”¨,åœ¨window.addEventListener('error')åè°ƒç”¨</span></span><br><span class="line">&#125;, <span class="literal">true</span>)</span><br></pre></td></tr></table></figure>

<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://segmentfault.com/a/1190000014672384" target="_blank" rel="noopener">JSé”™è¯¯ç›‘æ§æ€»ç»“</a></p>
]]></content>
      <categories>
        <category>å¤§å‰ç«¯</category>
      </categories>
      <tags>
        <tag>HTML</tag>
      </tags>
  </entry>
  <entry>
    <title>gitå‘½ä»¤å­¦ä¹ </title>
    <url>/2018/06/14/2018Q2/git%E5%91%BD%E4%BB%A4%E5%AD%A6%E4%B9%A0/</url>
    <content><![CDATA[<h2 id="1-åˆ†æ”¯åˆ‡æ¢"><a href="#1-åˆ†æ”¯åˆ‡æ¢" class="headerlink" title="1. åˆ†æ”¯åˆ‡æ¢"></a>1. åˆ†æ”¯åˆ‡æ¢</h2><h3 id="æŸ¥çœ‹è¿œç¨‹åˆ†æ”¯"><a href="#æŸ¥çœ‹è¿œç¨‹åˆ†æ”¯" class="headerlink" title="æŸ¥çœ‹è¿œç¨‹åˆ†æ”¯"></a>æŸ¥çœ‹è¿œç¨‹åˆ†æ”¯</h3><p>git branch -a</p>
<h3 id="æŸ¥çœ‹æœ¬åœ°åˆ†æ”¯"><a href="#æŸ¥çœ‹æœ¬åœ°åˆ†æ”¯" class="headerlink" title="æŸ¥çœ‹æœ¬åœ°åˆ†æ”¯"></a>æŸ¥çœ‹æœ¬åœ°åˆ†æ”¯</h3><p>git branch</p>
<h3 id="åˆ‡æ¢åˆ†æ”¯"><a href="#åˆ‡æ¢åˆ†æ”¯" class="headerlink" title="åˆ‡æ¢åˆ†æ”¯"></a>åˆ‡æ¢åˆ†æ”¯</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ git checkout -b dev origin&#x2F;dev   </span><br><span class="line">ä»è¿œç¨‹devåˆ†æ”¯å–å¾—åˆ°æœ¬åœ°åˆ†æ”¯dev</span><br><span class="line">Branch dev set up to track remote branch dev from origin.</span><br><span class="line">Switched to a new branch &#39;v0.9rc1&#39;</span><br></pre></td></tr></table></figure>

<p>-b :åˆ›å»ºå¹¶åˆ‡æ¢ï¼Œç›¸å½“äº git branch dev;git checkout dev</p>
<a id="more"></a>

<h2 id="2-åˆ†æ”¯åˆå¹¶"><a href="#2-åˆ†æ”¯åˆå¹¶" class="headerlink" title="2. åˆ†æ”¯åˆå¹¶"></a>2. åˆ†æ”¯åˆå¹¶</h2><h3 id="æ•´ä¸ªåˆ†æ”¯åˆå¹¶"><a href="#æ•´ä¸ªåˆ†æ”¯åˆå¹¶" class="headerlink" title="æ•´ä¸ªåˆ†æ”¯åˆå¹¶"></a>æ•´ä¸ªåˆ†æ”¯åˆå¹¶</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#åˆ‡æ¢åˆ°masteråˆ†æ”¯</span></span><br><span class="line">git checkout master</span><br><span class="line"><span class="comment">#åˆå¹¶devåˆ†æ”¯</span></span><br><span class="line">git merge dev</span><br></pre></td></tr></table></figure>

<h3 id="åˆå¹¶æŸä¸ªcommitåˆ°æŒ‡å®šçš„åˆ†æ”¯ä¸Š"><a href="#åˆå¹¶æŸä¸ªcommitåˆ°æŒ‡å®šçš„åˆ†æ”¯ä¸Š" class="headerlink" title="åˆå¹¶æŸä¸ªcommitåˆ°æŒ‡å®šçš„åˆ†æ”¯ä¸Š"></a>åˆå¹¶æŸä¸ªcommitåˆ°æŒ‡å®šçš„åˆ†æ”¯ä¸Š</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹å½“å‰åˆ†æ”¯çš„commitè®°å½•ï¼Œè®°å½•commit_id</span></span><br><span class="line">git <span class="built_in">log</span></span><br><span class="line"><span class="comment"># åˆ‡æ¢åˆ°masteråˆ†æ”¯</span></span><br><span class="line">git checkout master</span><br><span class="line"><span class="comment"># å°†è¯¥æ¬¡commit åˆå¹¶åˆ°masteråˆ†æ”¯</span></span><br><span class="line">git cherry-pick &lt;commit_id&gt;</span><br></pre></td></tr></table></figure>

<h3 id="åˆå¹¶è¿ç»­å¤šä¸ªcommitï¼ˆaaaa-gt-bbbbï¼‰åˆ°æŒ‡å®šçš„åˆ†æ”¯ä¸Š"><a href="#åˆå¹¶è¿ç»­å¤šä¸ªcommitï¼ˆaaaa-gt-bbbbï¼‰åˆ°æŒ‡å®šçš„åˆ†æ”¯ä¸Š" class="headerlink" title="åˆå¹¶è¿ç»­å¤šä¸ªcommitï¼ˆaaaa-&gt;bbbbï¼‰åˆ°æŒ‡å®šçš„åˆ†æ”¯ä¸Š"></a>åˆå¹¶è¿ç»­å¤šä¸ªcommitï¼ˆaaaa-&gt;bbbbï¼‰åˆ°æŒ‡å®šçš„åˆ†æ”¯ä¸Š</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºå¹¶åˆ‡æ¢åˆ°newbranchåˆ†æ”¯ ä»¥bbbbæäº¤ä¸ºç»“å°¾</span></span><br><span class="line">git checkout -b newbranch bbbb</span><br><span class="line"><span class="comment"># ä»¥aaaaçš„commitè®°å½•å¼€å§‹åˆå¹¶åˆ°masterï¼Œæ­¤æ—¶åˆå¹¶çš„ä¸ºaaaa-&gt;bbbbçš„commit</span></span><br><span class="line">git rebase â€”onto master aaaa^</span><br></pre></td></tr></table></figure>

<h2 id="3-push"><a href="#3-push" class="headerlink" title="3. push"></a>3. push</h2><h3 id="æ¨é€åˆ°æŒ‡å®šåç§°çš„è¿œç¨‹åˆ†æ”¯"><a href="#æ¨é€åˆ°æŒ‡å®šåç§°çš„è¿œç¨‹åˆ†æ”¯" class="headerlink" title="æ¨é€åˆ°æŒ‡å®šåç§°çš„è¿œç¨‹åˆ†æ”¯"></a>æ¨é€åˆ°æŒ‡å®šåç§°çš„è¿œç¨‹åˆ†æ”¯</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">// å°†<span class="built_in">local</span>-devæ¨é€åˆ° origin-dev åˆ†æ”¯</span><br><span class="line">git push origin <span class="built_in">local</span>-dev:origin-dev</span><br><span class="line">// å½“ <span class="built_in">local</span>-dev ä¸ºç©ºæ—¶ï¼Œå°†åˆ é™¤ origin-dev åˆ†æ”¯</span><br><span class="line">git push origin :origin-dev</span><br></pre></td></tr></table></figure>
<h3 id="å°†æœ¬åœ°ä»“åº“è½¬åˆ°è¿œç¨‹ä»“åº“"><a href="#å°†æœ¬åœ°ä»“åº“è½¬åˆ°è¿œç¨‹ä»“åº“" class="headerlink" title="å°†æœ¬åœ°ä»“åº“è½¬åˆ°è¿œç¨‹ä»“åº“"></a>å°†æœ¬åœ°ä»“åº“è½¬åˆ°è¿œç¨‹ä»“åº“</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ·»åŠ è¿œç¨‹ä»“åº“</span></span><br><span class="line">git remote add [name] [url]</span><br><span class="line"><span class="comment"># æ¨é€è¿œç¨‹ä»“åº“ï¼šè¿™é‡Œçš„åœºæ™¯ localBranchName ä¸€èˆ¬ç”¨master</span></span><br><span class="line">git push [remoteName] [localBranchName]</span><br></pre></td></tr></table></figure>

<h2 id="4-ç‰ˆæœ¬å›é€€"><a href="#4-ç‰ˆæœ¬å›é€€" class="headerlink" title="4. ç‰ˆæœ¬å›é€€"></a>4. ç‰ˆæœ¬å›é€€</h2><h3 id="åˆ é™¤è¿œç¨‹ä»“åº“çš„æ–‡ä»¶-å¹¶å¿½ç•¥æäº¤"><a href="#åˆ é™¤è¿œç¨‹ä»“åº“çš„æ–‡ä»¶-å¹¶å¿½ç•¥æäº¤" class="headerlink" title="åˆ é™¤è¿œç¨‹ä»“åº“çš„æ–‡ä»¶ å¹¶å¿½ç•¥æäº¤"></a>åˆ é™¤è¿œç¨‹ä»“åº“çš„æ–‡ä»¶ å¹¶å¿½ç•¥æäº¤</h3><p>å½“æ–‡ä»¶è¿›å…¥ç‰ˆæœ¬ç®¡ç†æ—¶ï¼Œè®¾ç½® gitignore å°†æ²¡æœ‰æ•ˆæœï¼Œæ­¤æ—¶å°†æäº¤pushåˆ°è¿œç¨‹ä»“åº“ä¼šå‘ç°è¿œç¨‹ä»“åº“æœ‰è¿™äº›æ–‡ä»¶</p>
<p>ä¸¾ä¾‹ï¼šåœ¨<code>.gitignore</code>è®¾ç½®å¿½ç•¥testç›®å½•æ—¶ï¼Œå·²è¿›è¡Œtestç›®å½•çš„gitç®¡ç†,æ­¤æ—¶æˆ‘ä»¬ä¸å°å¿ƒæŠŠtestç›®å½•ä¹Ÿpushåˆ°è¿œç¨‹åˆ†æ”¯äº†ï¼Œæ€ä¹ˆåŠï¼Ÿ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git rm -r --cached <span class="built_in">test</span></span><br><span class="line">git commit -m <span class="string">"delete test/"</span></span><br><span class="line">git push origin master</span><br></pre></td></tr></table></figure>

<p>æ­¤æ—¶å¯ä»¥æŠŠå¿½ç•¥è§„åˆ™å†™åˆ°gitignoreä¸­äº†ã€‚</p>
<h3 id="git-reset"><a href="#git-reset" class="headerlink" title="git reset"></a>git reset</h3><p>å…ˆç”¨git log æŸ¥çœ‹commitè®°å½•ï¼Œå›è½¦ä¸‹ä¸€é¡µï¼Œqé€€å‡ºæŸ¥çœ‹</p>
<p>git reset â€“hard commit_id æˆ–è€… HEAD^ è¡¨ç¤ºå½“å‰ç‰ˆæœ¬çš„ä¸Šä¸€ä¸ªç‰ˆæœ¬ï¼Œ10ä¸ªå‰çš„ç‰ˆæœ¬å°±æ˜¯ HEAD~10</p>
<p>å°† commit ä¿¡æ¯å’Œæ–‡ä»¶éƒ½è¿›è¡Œå›é€€</p>
<blockquote>
<p>ä¸æŒ‡å®š â€“hard çš„è¯å³é»˜è®¤çš„ â€“mixed æ¨¡å¼, å›é€€ commit ä¿¡æ¯ï¼Œæ–‡ä»¶å¤„äºå·¥ä½œåŒºï¼ˆå¾… addï¼‰</p>
</blockquote>
<p>è¿˜å¯ä»¥æŒ‡å®šä¸º â€“soft ï¼Œå›é€€ commit ä¿¡æ¯ï¼Œæ–‡ä»¶å¤„äº staged çŠ¶æ€ï¼ˆå¾… commitï¼‰</p>
<p>å½“å‰ç‰ˆæœ¬è¢«é‡ç½®åï¼Œæƒ³å›åˆ°åˆšåˆšçš„ç‰ˆæœ¬ï¼Œåˆæ‰¾ä¸åˆ°commit_id,åˆšåˆšçš„å‘½ä»¤çª—å£è¢«å…³é—­ï¼Œæ€ä¹ˆåŠ?</p>
<p>å¯ä»¥é€šè¿‡ git reflog é‡Œé¢è®°å½•äº†æˆ‘ä»¬æ¯æ¬¡çš„å‘½ä»¤ </p>
<h2 id="git-æ–‡ä»¶æ”¹ä¸€åŠéœ€è¦ä¸´æ—¶æ”¹ä¸ªbug-commitä¸Šæ€ä¹ˆå†™ï¼Ÿ"><a href="#git-æ–‡ä»¶æ”¹ä¸€åŠéœ€è¦ä¸´æ—¶æ”¹ä¸ªbug-commitä¸Šæ€ä¹ˆå†™ï¼Ÿ" class="headerlink" title="git æ–‡ä»¶æ”¹ä¸€åŠéœ€è¦ä¸´æ—¶æ”¹ä¸ªbug -commitä¸Šæ€ä¹ˆå†™ï¼Ÿ"></a>git æ–‡ä»¶æ”¹ä¸€åŠéœ€è¦ä¸´æ—¶æ”¹ä¸ªbug -commitä¸Šæ€ä¹ˆå†™ï¼Ÿ</h2><p><a href="https://www.cnblogs.com/wufangfang/p/6085617.html" target="_blank" rel="noopener">å‚è€ƒ</a></p>
<ol>
<li>git stash  å­˜å‚¨å·¥ä½œåŒº</li>
<li>git checkout -b issue-xxx å¤åˆ¶å½“å‰åˆ†æ”¯åˆ°issue-xxxåˆ†æ”¯</li>
<li>git commit -m â€œfix bug xxxâ€  ä¿®æ”¹bugå¹¶æäº¤</li>
<li>git checkout master åˆ‡æ¢åˆ°masteråˆ†æ”¯</li>
<li>git merge issue-xxx åˆå¹¶issue-xxxåˆ†æ”¯</li>
<li>git branch -d issue-xxx åˆ é™¤issue-xxxåˆ†æ”¯</li>
<li>git stash list å±•ç¤ºåˆšæ‰çš„å·¥ä½œåŒº</li>
<li>git stash pop è¿˜åŸå·¥ä½œåŒºå¹¶åˆ é™¤å¯¹åº”çš„stash</li>
<li>git stash list æ­¤æ—¶åº”è¯¥æ˜¯ç©ºçš„</li>
</ol>
<h2 id="git-commit"><a href="#git-commit" class="headerlink" title="git commit"></a>git commit</h2><p>â€“amend : ç”¨æ¥ä¿®æ”¹ä¸Šæ¬¡æäº¤æ—¶çš„ message</p>
<h2 id="git-rebase"><a href="#git-rebase" class="headerlink" title="git rebase"></a>git rebase</h2><h3 id="i-start-point-end-point-å¯äº¤äº’å˜åŸº"><a href="#i-start-point-end-point-å¯äº¤äº’å˜åŸº" class="headerlink" title="-i [start_point] [end_point] å¯äº¤äº’å˜åŸº"></a>-i [start_point] [end_point] å¯äº¤äº’å˜åŸº</h3><p>å¸¸ç”¨æ¥è°ƒæ•´ commit è®°å½•çš„é¡ºåºï¼Œ è¿›è¡Œ commit åˆå¹¶ç­‰ã€‚</p>
<p>é¦–æ¡ pick or edit(ä¿®æ”¹ message ç”¨)ï¼Œå…¶ä»–çš„ç”¨ s or f(ä¸¢å¼ƒè¯¥ commit çš„ message)</p>
<h2 id="git-tag"><a href="#git-tag" class="headerlink" title="git tag"></a>git tag</h2><p><a href="https://www.jianshu.com/p/9e64bdf1e8f9" target="_blank" rel="noopener">å‚è€ƒ</a></p>
<h3 id="æ·»åŠ tag"><a href="#æ·»åŠ tag" class="headerlink" title="æ·»åŠ tag"></a>æ·»åŠ tag</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git tag -a  &lt;tagå&gt; -m &lt;æ³¨é‡Šæ–‡å­—&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># git tag -a v0.1.0 -m v0.1.0</span></span><br></pre></td></tr></table></figure>

<h3 id="push-tag"><a href="#push-tag" class="headerlink" title="push tag"></a>push tag</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git push origin &lt;æ ‡ç­¾å&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">#ä¸€æ¬¡æ¨é€æœ¬åœ°æ‰€æœ‰ tagsï¼Œä½¿ç”¨ --tagsé€‰é¡¹ï¼š</span></span><br><span class="line">git push origin --tags</span><br></pre></td></tr></table></figure>

<h2 id="git-clone"><a href="#git-clone" class="headerlink" title="git clone"></a>git clone</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment">##æœ€è¿‘ä¸€æ¬¡æäº¤</span></span><br><span class="line">git <span class="built_in">clone</span> --depth 1 &lt;remote-addr:repo.git&gt;</span><br></pre></td></tr></table></figure>

<h2 id="gh-pages"><a href="#gh-pages" class="headerlink" title="gh-pages"></a>gh-pages</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æŒ‡å®šæŸä¸ªæ–‡ä»¶å¤¹</span></span><br><span class="line">git subtree push --prefix=dist origin gh-pages</span><br><span class="line"><span class="comment"># æ•´ä¸ªé¡¹ç›®éƒ½ä¸Šä¼ </span></span><br><span class="line">git symbolic-ref HEAD refs/heads/gh-pages</span><br><span class="line">git push origin gh-pages</span><br></pre></td></tr></table></figure>

<h2 id="åˆ‡æ¢ä»“åº“"><a href="#åˆ‡æ¢ä»“åº“" class="headerlink" title="åˆ‡æ¢ä»“åº“"></a>åˆ‡æ¢ä»“åº“</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git remote <span class="built_in">set</span>-url origin url</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼Œæ­£å¸¸çš„è¯ åˆ‡æ¢å®Œ pull æ˜¯æ²¡é—®é¢˜çš„ï¼ˆæ–°çš„è¿œç¨‹ä»“åº“ä¹Ÿæ˜¯åŸæ¥æœ¬åœ°ä»“åº“çš„è®°å½•ï¼‰</p>
<p>ä½†å¦‚æœæ–°çš„ä»“åº“åœ°å€çš„è®°å½•ä¸æœ¬åœ°ä¸ç›¸å…³çš„è¯ï¼Œå°±ä¼šæŠ¥</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">fatal: refusing to merge unrelated histories</span><br></pre></td></tr></table></figure>

<p>æ­¤æ—¶åº”è¯¥æ”¾å¼ƒåŸæ¥çš„gitè®°å½•ï¼Œé‡‡ç”¨ä»£ç è¦†ç›–é‡æ–°æäº¤çš„æ–¹å¼ã€‚ã€‚</p>
<p>è‹¥é‡‡ç”¨ <code>git pull origin master --allow-unrelated-histories</code> å¼ºåˆ¶åˆå¹¶ï¼Œä¼šæœ‰å„ç§å†²çªç­‰ç­‰ï¼Œ</p>
<p>å…¶å®æœ€å¥½çš„æ–¹æ³•å°±æ˜¯è®©åŒä¼´ä¸è¦æŠŠä¸ç›¸å…³çš„è®°å½•ç›´æ¥ä¼ æ–°çš„ä»“åº“ã€‚ã€‚</p>
<p><strong>æ–¹å¼2</strong></p>
<p>å…·ä½“è¿ç§»æ­¥éª¤</p>
<p>åœ¨æ–°åœ°å€ä¸Šæ–°å»ºå¯¹åº”é¡¹ç›®</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git <span class="built_in">clone</span> --bare <span class="variable">$url</span>  //æ‹·è´ä¸€ä»½æ—§GITè£¸ç‰ˆæœ¬çš„ä»£ç </span><br><span class="line"><span class="built_in">cd</span> xxx.git             //è¿›å…¥åˆ°ç›®å½•åº•ä¸‹</span><br><span class="line">git push --mirror <span class="variable">$newurl</span>   //æ¨é€åˆ°æ–°çš„ä»“åº“åœ°å€</span><br><span class="line"><span class="built_in">cd</span> ../ &amp;&amp; rm -rf xxx.git     //åˆ é™¤æ‹·è´</span><br></pre></td></tr></table></figure>

<p>git remote add å’Œ set-url åŒºåˆ«</p>
<h2 id="å…‹éš†ä»“åº“"><a href="#å…‹éš†ä»“åº“" class="headerlink" title="å…‹éš†ä»“åº“"></a>å…‹éš†ä»“åº“</h2><p>https ä¸ ssh çš„åŒºåˆ«</p>
<p>å‰è€…æ¯æ¬¡ push æ—¶éƒ½éœ€è¦è¾“å…¥è´¦å·å¯†ç </p>
<p>åè€…ä¼šåˆ©ç”¨å·²ç»é…ç½®çš„ key è¿›è¡Œç™»é™†ï¼Œè¦æ±‚è‡ªèº«ä¸ºå…‹éš†çš„ä»“åº“çš„æ‹¥æœ‰è€…æˆ–è€…åŠ å…¥è€…</p>
]]></content>
      <categories>
        <category>Git</category>
      </categories>
  </entry>
  <entry>
    <title>å‰ç«¯å›¾ç‰‡åˆ†å±‚åŠ è½½è¯¦è§£</title>
    <url>/2018/05/20/2018Q2/%E5%9B%BE%E7%89%87%E5%88%86%E5%B1%82%E5%8A%A0%E8%BD%BD/</url>
    <content><![CDATA[<h1 id="ä¸€ã€å¼•è¨€"><a href="#ä¸€ã€å¼•è¨€" class="headerlink" title="ä¸€ã€å¼•è¨€"></a>ä¸€ã€å¼•è¨€</h1><h2 id="1-1-ç¼–å†™ç›®çš„"><a href="#1-1-ç¼–å†™ç›®çš„" class="headerlink" title="1.1 ç¼–å†™ç›®çš„"></a>1.1 ç¼–å†™ç›®çš„</h2><p>ä»‹ç»å›¾ç‰‡åˆ†å±‚åŠ è½½ç³»ç»Ÿæ¶æ„åŠæŠ€æœ¯æ–¹æ¡ˆï¼Œç»“åˆæ‡’åŠ è½½åçš„æ€»æµç¨‹ï¼Œæ¢³ç†å¸¸è§é—®é¢˜åŠç›¸åº”è§£å†³æ–¹æ¡ˆã€‚</p>
<a id="more"></a>

<h2 id="1-2-é¡¹ç›®èƒŒæ™¯"><a href="#1-2-é¡¹ç›®èƒŒæ™¯" class="headerlink" title="1.2 é¡¹ç›®èƒŒæ™¯"></a>1.2 é¡¹ç›®èƒŒæ™¯</h2><h3 id="1-2-1-èƒŒæ™¯"><a href="#1-2-1-èƒŒæ™¯" class="headerlink" title="1.2.1 èƒŒæ™¯"></a>1.2.1 èƒŒæ™¯</h3><p>å‰ç«¯ä¼˜åŒ–ç«™çš„åŠŸèƒ½æ¨¡å—ä¹‹ä¸€ï¼Œå±äºå›¾åƒä¼˜åŒ–èŒƒç•´ã€‚</p>
<h3 id="1-2-2-ä¸šç•Œå®¢æˆ·ç°çŠ¶"><a href="#1-2-2-ä¸šç•Œå®¢æˆ·ç°çŠ¶" class="headerlink" title="1.2.2 ä¸šç•Œå®¢æˆ·ç°çŠ¶"></a>1.2.2 ä¸šç•Œå®¢æˆ·ç°çŠ¶</h3><p>å¤§éƒ¨åˆ†å®¢æˆ·åœ¨å›¾ç‰‡åŠ è½½ä¸Šæ²¡åšä¼˜åŒ–ï¼Œé¡µé¢ç›´æ¥åŠ è½½åŸå›¾ï¼Œæµè§ˆå™¨ä¼šå‘èµ·å¤§é‡åŸå›¾è¯·æ±‚ï¼Œå¯¼è‡´é¡µé¢åŠ è½½æ—¶é—´è¿‡é•¿ï¼Œç½‘ç»œå¸¦å®½æ¶ˆè€—å¤§ã€‚</p>
<p>å› æ­¤ï¼Œæˆ‘ä»¬æå‡ºäº†ä¸€æ•´å¥—çš„å›¾ç‰‡ä¼˜åŒ–è§£å†³æ–¹æ¡ˆï¼Œå®ç°é¡µé¢å›¾ç‰‡æ‡’åŠ è½½ï¼ŒåŠ å¿«å®¢æˆ·é¡µé¢åŠ è½½é€Ÿåº¦ï¼ŒèŠ‚çœæµé‡ã€‚</p>
<h3 id="1-2-3-å‹å•†æŠ€æœ¯æ–¹æ¡ˆ"><a href="#1-2-3-å‹å•†æŠ€æœ¯æ–¹æ¡ˆ" class="headerlink" title="1.2.3 å‹å•†æŠ€æœ¯æ–¹æ¡ˆ"></a>1.2.3 å‹å•†æŠ€æœ¯æ–¹æ¡ˆ</h3><p>Akamai åœ¨å›¾åƒä¼˜åŒ–ä¸Šæå‡ºäº†ä¸‰ä¸ªè§£å†³æ–¹æ¡ˆï¼š</p>
<ul>
<li>è‡ªé€‚åº”å‹ç¼©<blockquote>
<p>åŸºäºç½‘ç»œæ¡ä»¶åˆ†å±‚åŠ è½½,æä¾›å¤šç§å‹ç¼©çº§åˆ«çš„å›¾åƒèµ„æº</p>
</blockquote>
</li>
<li>æ‡’åŠ è½½<blockquote>
<p>ä»…åŠ è½½å½“å‰æµè§ˆå™¨è§†åŒºå¯è§çš„å›¾åƒï¼Œå½“ç”¨æˆ·å‘ä¸‹æ»‘åŠ¨æ—¶åŠ è½½æ–°å›¾åƒ</p>
</blockquote>
</li>
<li>ç‰¹å®šå›¾åƒæ ¼å¼ä¼˜åŒ–<blockquote>
<p>webpã€jpeg2000ç­‰å›¾åƒæ ¼å¼å¯ä»¥é™ä½è´Ÿè½½ï¼Œè€Œä¸å½±å“å›¾ç‰‡è´¨é‡,ä½†åªæœ‰ç‰¹å®šæµè§ˆå™¨å…¼å®¹</p>
</blockquote>
</li>
</ul>
<p><strong>ç›®å‰æœ¬æ–¹æ¡ˆèƒ½å®ç°ä»¥ä¸ŠåŠŸèƒ½</strong>ï¼Œå¹¶åœ¨æ‡’åŠ è½½æ–¹æ¡ˆç»§ç»­ä¼˜åŒ–ï¼Œç»“åˆäº†é¢„åŠ è½½çš„æ€æƒ³ï¼Œå½“pageloadåä¸”scrollä¸€å®šæ—¶é—´æ²¡æœ‰è§¦å‘ï¼Œä¼šè§¦å‘å›¾åƒåŠ è½½æœºåˆ¶ï¼Œç”¨äºæ»¡è¶³æŸäº›å®¢æˆ·éœ€æ±‚ã€‚</p>
<h2 id="1-3-æœ¯è¯­å®šä¹‰"><a href="#1-3-æœ¯è¯­å®šä¹‰" class="headerlink" title="1.3 æœ¯è¯­å®šä¹‰"></a>1.3 æœ¯è¯­å®šä¹‰</h2><p>å°å›¾ï¼š åˆ†è¾¨ç‡ä¸å˜ï¼Œå›¾åƒè´¨é‡è¾ƒä½çš„å›¾ç‰‡èµ„æº-æ¨¡ç³Šå›¾<br>å°å°å›¾ï¼š åå°åˆå¯¹å°å›¾åšäº†å‹ç¼©å¤„ç†</p>
<h2 id="1-4-å‚è€ƒèµ„æ–™"><a href="#1-4-å‚è€ƒèµ„æ–™" class="headerlink" title="1.4 å‚è€ƒèµ„æ–™"></a>1.4 å‚è€ƒèµ„æ–™</h2><p><a href="https://www.akamai.com/cn/zh/web-and-mobile-performance.jsp" target="_blank" rel="noopener">AKAMAI WEB æ€§èƒ½è§£å†³æ–¹æ¡ˆ</a></p>
<p><a href="https://github.com/tuupola/jquery_lazyload/tree/master" target="_blank" rel="noopener">lazy_loadå¼€æºåº“</a></p>
<h1 id="äºŒã€ç³»ç»Ÿæ¶æ„"><a href="#äºŒã€ç³»ç»Ÿæ¶æ„" class="headerlink" title="äºŒã€ç³»ç»Ÿæ¶æ„"></a>äºŒã€ç³»ç»Ÿæ¶æ„</h1><p><em>æœ¬å¥—ç³»ç»Ÿåˆ†ä¸ºå‰ç«¯å’Œåå°ï¼Œæœ¬æ–‡ä¾§é‡äºä»‹ç»å‰ç«¯éƒ¨åˆ†ã€‚</em></p>
<p>å½“æµè§ˆå™¨å‘èµ·htmlæ–‡æ¡£è¯·æ±‚æ—¶ï¼Œåå°ä¼šå¯¹è¯¥æ–‡æ¡£è¿›è¡Œä¿®æ”¹å¹¶è¿”å›ã€‚</p>
<p>å…ˆä»‹ç»ä¸‹åå°çš„<strong>htmlæ–‡æ¡£æ”¹å†™è§„åˆ™</strong>(ä»…é’ˆå¯¹å›¾åƒä¼˜åŒ–åŠŸèƒ½):</p>
<blockquote>
<p>åœ¨æ–‡æ¡£åº•éƒ¨æ’å…¥å›¾ç‰‡ä¼˜åŒ–çš„jsä»£ç ï¼Œé…ç½®é¡¹é€šè¿‡è®¾ç½®scriptèŠ‚ç‚¹çš„è‡ªå®šä¹‰å±æ€§æ¥å®ç°ã€‚</p>
<p>ä¸»è¦é…ç½®é¡¹ï¼šæ•£åˆ—åŸŸåï¼Œæ˜¯å¦å¼€å¯æ‡’åŠ è½½ï¼Œæ‡’åŠ è½½ç­–ç•¥ï¼Œæ˜¯å¦å¤„ç†<code>background-image</code></p>
</blockquote>
<p>å‰ç«¯è¿™è¾¹æ”¶åˆ°htmlæ–‡æ¡£ä¹‹åï¼Œä¸åå°äº¤äº’æµç¨‹å¦‚ä¸‹ï¼š</p>
<h2 id="æµç¨‹å›¾"><a href="#æµç¨‹å›¾" class="headerlink" title="æµç¨‹å›¾"></a>æµç¨‹å›¾</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">graph TB</span><br><span class="line">  st(æµè§ˆå™¨domè§£æ)--&gt;op[æµè§ˆå™¨å‘èµ·å›¾ç‰‡è¯·æ±‚]</span><br><span class="line">  op--&gt;op2[åå°å¤„ç†å¹¶è¿”å›æ¨¡ç³Šå›¾]</span><br><span class="line">  op2--&gt;co&#123; pageloadå®Œæˆ? &#125;</span><br><span class="line">  co--no--&gt;co</span><br><span class="line">  co--yes--&gt;op3[æ‰«ææ–‡æ¡£çš„å›¾åƒèµ„æº]</span><br><span class="line">  op3--&gt;op4[ä¿®æ”¹å›¾åƒurlåœ°å€çš„åŸŸåéƒ¨åˆ†å¹¶ä½œä¸ºå›¾åƒæ–°çš„src]</span><br><span class="line">  op4--&gt;op5[æµè§ˆå™¨å‘èµ·æ–°çš„å›¾ç‰‡è¯·æ±‚]</span><br><span class="line">  op5--&gt;co2&#123; åå°åˆ¤æ–­æ˜¯å¦æœ‰ç¼“å­˜? &#125;</span><br><span class="line">  co2--no--&gt;op6[å›æºè·å–å¹¶ç¼“å­˜]</span><br><span class="line">  co2--yes--&gt;op7[è¿›è¡Œå“åº”]</span><br><span class="line">  op6--&gt;op7</span><br></pre></td></tr></table></figure>

<h2 id="æ—¶åºå›¾"><a href="#æ—¶åºå›¾" class="headerlink" title="æ—¶åºå›¾"></a>æ—¶åºå›¾</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sequenceDiagram</span><br><span class="line">participant æµè§ˆå™¨</span><br><span class="line">participant shark</span><br><span class="line">participant æºç«™</span><br><span class="line">æµè§ˆå™¨ -&gt;&gt; shark:è¯·æ±‚å›¾åƒèµ„æº</span><br><span class="line">Note right of shark:æ²¡æœ‰ç¼“å­˜ï¼Œè¯·æ±‚æºç«™</span><br><span class="line">shark -&gt;&gt; æºç«™:è¯·æ±‚å›¾åƒèµ„æº</span><br><span class="line">Note right of shark:ç¼“å­˜å›¾åƒ</span><br><span class="line">shark -&gt;&gt; shark:å›¾åƒæ¨¡ç³ŠåŒ–</span><br><span class="line">shark --&gt;&gt; æµè§ˆå™¨:è¿”å›æ¨¡ç³Šå›¾</span><br><span class="line">Note right of æµè§ˆå™¨:domè§£æå®Œæ¯•&lt;br&#x2F;&gt;æ‰«ææ–‡æ¡£</span><br><span class="line">æµè§ˆå™¨ -&gt;&gt; shark:è¯·æ±‚å›¾ç‰‡è´¨é‡æ ‡è¯†wsqå¯¹åº”å›¾åƒ</span><br><span class="line">shark -&gt;&gt; shark:æ ¹æ®wsqå¯¹åŸå›¾åšç›¸åº”çš„å‹ç¼©</span><br><span class="line">shark --&gt;&gt;æµè§ˆå™¨:è¿”å›wsqå¯¹åº”å›¾ç‰‡</span><br></pre></td></tr></table></figure>

<p><del>æˆ–è€…é‡‡ç”¨å¦å¤–ä¸€ä¸ªæ–¹æ¡ˆï¼Œä¿®æ”¹htmlæ–‡æ¡£ä¸­imgçš„srcï¼ŒåŸå›¾æ”¾åœ¨data-srcä¸­ï¼Œè¿™æ ·å¯ä»¥æ§åˆ¶å“ªäº›å›¾ç‰‡éœ€è¦åšåˆ†å±‚ï¼Œå¯è§£å†³åé¢æåˆ°çš„ <strong><code>æ ¹æ®åª’ä½“å±æ€§çš„æ¸²æŸ“</code></strong> é—®é¢˜ï¼Œä½†æ˜¯æ”¹å†™æ–‡æ¡£çš„å·¥ä½œé‡å’Œéš¾åº¦éƒ½æ¯”è¾ƒå¤§</del></p>
<h2 id="å‰ç«¯æµç¨‹"><a href="#å‰ç«¯æµç¨‹" class="headerlink" title="å‰ç«¯æµç¨‹"></a>å‰ç«¯æµç¨‹</h2><p>åŸå›¾è¯·æ±‚é€šè¿‡urlæ›¿æ¢çš„æ–¹å¼ï¼Œä¸é‡‡ç”¨ajax</p>
<h3 id="æ€»æµç¨‹"><a href="#æ€»æµç¨‹" class="headerlink" title="æ€»æµç¨‹"></a>æ€»æµç¨‹</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">graph TB</span><br><span class="line">  st(å¼€å§‹)--&gt;init((åˆå§‹åŒ–))</span><br><span class="line">  init--&gt;obs[æ·»åŠ DOMContentLoaded,Loadäº‹ä»¶ç›‘å¬å™¨]</span><br><span class="line">  obs--&gt;DOMContentLoaded[DOMContentLoadedäº‹ä»¶è§¦å‘]</span><br><span class="line">  DOMContentLoaded--&gt;cal[åˆ©ç”¨htmlæ–‡æ¡£ä¸‹è½½é€Ÿåº¦æ¥è¿›è¡Œç®€å•æµ‹é€Ÿ]</span><br><span class="line">  cal--&gt;firstScreenPicSpeed[å‚ç…§ç½‘é€Ÿå‹ç¼©æ¯”å¯¹ç…§è¡¨å¾—åˆ°é¦–å±å›¾ç‰‡å‹ç¼©æ¯”]</span><br><span class="line">  firstScreenPicSpeed--&gt;firstScreen((æ‰«ææ–‡æ¡£,è·å–å›¾ç‰‡èŠ‚ç‚¹))</span><br><span class="line">  firstScreen--&gt;quicksort[æŒ‰è§†è·å¿«æ’å›¾ç‰‡èŠ‚ç‚¹]</span><br><span class="line">  quicksort--&gt;judgeCache[ä»»å–ä¸€æ¨¡ç³Šå›¾çš„name,é€šè¿‡transferSizeæ˜¯å¦ä¸º0æ¥åˆ¤æ–­æœ¬æ¬¡åŠ è½½æ˜¯å¦ä¸ºæ— ç¼“å­˜åŠ è½½]</span><br><span class="line">  judgeCache--&gt;firstScreenCal[è·å–è§†è·å¤„äºé¦–å±çš„å›¾ç‰‡èŠ‚ç‚¹]</span><br><span class="line">  firstScreenCal--&gt;oripicload((è¿›è¡ŒåŸå›¾åŠ è½½))</span><br><span class="line">  oripicload--&gt;load[Loadäº‹ä»¶è§¦å‘]</span><br><span class="line">  load--&gt;speedtest[é‡‡ç”¨æµ‹é€Ÿç®—æ³•æµ‹é€Ÿ,å¾—åˆ°ç›¸åº”å›¾åƒå‹ç¼©æ¯”]</span><br><span class="line">  speedtest--&gt;islazyLoad&#123;æ˜¯å¦æ‡’åŠ è½½&#125;</span><br><span class="line">  islazyLoad--æ˜¯--&gt;lazyload[å¯åŠ¨æ‡’åŠ è½½ç­–ç•¥]</span><br><span class="line">  islazyLoad--å¦--&gt;replaceOther[æ‰¾åˆ°å…¶ä»–æœªè¿›è¡ŒåŸå›¾åŠ è½½çš„èŠ‚ç‚¹]</span><br><span class="line">  replaceOther--&gt;oripicload1((è¿›è¡ŒåŸå›¾åŠ è½½))</span><br><span class="line">  lazyload--&gt;islazycompleted&#123;æ‡’åŠ è½½å®Œæ¯•?&#125;</span><br><span class="line">  islazycompleted--æ˜¯--&gt;ed(ç»“æŸ)</span><br><span class="line">  islazycompleted--å¦--&gt;scall&#123;æ˜¯å¦è¿›è¡Œçª—å£æ»šåŠ¨&#125;</span><br><span class="line">  scall--æ˜¯--&gt;debounceCul[èŠ‚æµå¤„ç†,è·å–æ»¡è¶³è§†è·æ¡ä»¶çš„æœªè¿›è¡ŒåŸå›¾åŠ è½½çš„èŠ‚ç‚¹]</span><br><span class="line">  debounceCul--&gt;oripicload2((è¿›è¡ŒåŸå›¾åŠ è½½))</span><br><span class="line">  oripicload2--&gt;islazycompleted</span><br><span class="line">  scall--å¦--&gt;mousetimeout&#123;é¼ æ ‡äº‹ä»¶10sæœªè§¦å‘&#125;</span><br><span class="line">  mousetimeout--æ˜¯--&gt;replaceOther</span><br><span class="line">  mousetimeout--å¦--&gt;scall</span><br><span class="line">  oripicload1--&gt;ed</span><br></pre></td></tr></table></figure>
<h3 id="åˆå§‹åŒ–å…·ä½“æµç¨‹"><a href="#åˆå§‹åŒ–å…·ä½“æµç¨‹" class="headerlink" title="åˆå§‹åŒ–å…·ä½“æµç¨‹"></a>åˆå§‹åŒ–å…·ä½“æµç¨‹</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">graph LR</span><br><span class="line">  init(åˆå§‹åŒ–å¼€å§‹)--&gt;evalElement(è§£æscriptæ ‡ç­¾ä¸­è‡ªå®šä¹‰å±æ€§)</span><br><span class="line">  evalElement--&gt;getHost[è·å–å¯æ›¿æ¢å›¾ç‰‡åŸŸå]</span><br><span class="line">  evalElement--&gt;getHashHost[è·å–æ•£åˆ—åŸŸå]</span><br><span class="line">  evalElement--&gt;getLazy[è·å–æ‡’åŠ è½½ç­–ç•¥]</span><br><span class="line">  evalElement--&gt;getSpeedZip[è·å–ç½‘é€Ÿå‹ç¼©æ¯”å‚ç…§è¡¨]</span><br><span class="line">  evalElement--&gt;getTTL[è·å–å›¾ç‰‡ç¼“å­˜æ—¶é—´]</span><br><span class="line">  getHost--&gt;initStop(åˆå§‹åŒ–ç»“æŸ)</span><br><span class="line">  getHashHost--&gt;initStop</span><br><span class="line">  getLazy--&gt;initStop</span><br><span class="line">  getSpeedZip--&gt;initStop</span><br><span class="line">  getTTL--&gt;initStop</span><br></pre></td></tr></table></figure>

<h3 id="åŸå›¾åŠ è½½å…·ä½“æµç¨‹"><a href="#åŸå›¾åŠ è½½å…·ä½“æµç¨‹" class="headerlink" title="åŸå›¾åŠ è½½å…·ä½“æµç¨‹"></a>åŸå›¾åŠ è½½å…·ä½“æµç¨‹</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">graph TB</span><br><span class="line">oripicstart(åŸå›¾åŠ è½½å¼€å§‹)--&gt;judgeEle&#123;åˆ¤æ–­èŠ‚ç‚¹ç±»å‹&#125;</span><br><span class="line">judgeEle--pictureèŠ‚ç‚¹--&gt;getpic[è·å–å…¶å­èŠ‚ç‚¹ä¸­sourceèŠ‚ç‚¹å’ŒimgèŠ‚ç‚¹ä¸­srcå’Œsrcsetå±æ€§ä¸­çš„å›¾ç‰‡url]</span><br><span class="line">judgeEle--imgèŠ‚ç‚¹--&gt;getsrcset[è·å–èŠ‚ç‚¹çš„srcå’Œsrcsetå±æ€§ä¸­çš„å›¾ç‰‡url]</span><br><span class="line">judgeEle--videoèŠ‚ç‚¹--&gt;getposter[è·å–èŠ‚ç‚¹çš„posterå±æ€§ä¸­çš„å›¾ç‰‡url]</span><br><span class="line">judgeEle--å…¶ä»–èŠ‚ç‚¹--&gt;getother[è·å–èŠ‚ç‚¹background-imageçš„å›¾ç‰‡url]</span><br><span class="line">getpic--&gt;getfinalurl((urlæ›¿æ¢))</span><br><span class="line"></span><br><span class="line">getsrcset--&gt;getfinalurl1((urlæ›¿æ¢))</span><br><span class="line">getposter--&gt;getfinalurl1((urlæ›¿æ¢))</span><br><span class="line">getother--&gt;getfinalurl1((urlæ›¿æ¢))</span><br><span class="line"></span><br><span class="line">getfinalurl1--&gt;newImg[new Imageçš„æ–¹å¼åŠ è½½èµ„æº,å…¶urlä¸ºæ›¿æ¢åçš„url,å¯èƒ½éœ€è¦è®¾ç½®srcsetå±æ€§]</span><br><span class="line">newImg--&gt;onload[Imageçš„onloadè§¦å‘]</span><br><span class="line">onload--&gt;updateEle</span><br><span class="line"></span><br><span class="line">getfinalurl-.-hashurl[å°†æ¨¡ç³Šå›¾urlåœ°å€é€šè¿‡ä¸€å®šç®—æ³•æ˜ å°„åˆ°å›ºå®šçš„æ•£åˆ—åŸŸå,å¾—åˆ°æ–°çš„å›¾ç‰‡url-newUrl]</span><br><span class="line">hashurl--&gt;findstorage&#123;localstorageä¸­æ˜¯å¦æœ‰newUrlä¸”å‹ç¼©æ¯”ä¸€æ ·æˆ–æ›´ä½çš„è®°å½•&#125;</span><br><span class="line">findstorage--æ˜¯--&gt;isExpired&#123;æ˜¯å¦è¿‡æœŸ&#125;</span><br><span class="line">findstorage--å¦--&gt;carrycur</span><br><span class="line">isExpired--å¦--&gt;carryhigh[å–æœªè¿‡æœŸçš„å‹ç¼©æ¯”æœ€ä½çš„è®°å½•,newUrlåå¸¦ä¸Šå‹ç¼©æ¯”å‚æ•°]</span><br><span class="line">isExpired--æ˜¯--&gt;carrycur[å›¾ç‰‡urlåå¸¦ä¸Šå½“å‰çš„å‹ç¼©æ¯”]</span><br><span class="line">carryhigh--&gt;replaceEnd(urlæ›¿æ¢å®Œæ¯•)</span><br><span class="line">carrycur--&gt;replaceEnd</span><br><span class="line">getfinalurl--&gt;updateEle[å°†èŠ‚ç‚¹å±æ€§çš„å›¾ç‰‡urlè¿›è¡Œæ›¿æ¢]</span><br><span class="line">updateEle--&gt;updatelocal[æ›´æ–°localstorage]</span><br><span class="line">updatelocal--&gt;isnocache&#123;æ— ç¼“å­˜åŠ è½½æˆ–localstorageä¸­æ²¡æœ‰å‘½ä¸­ç¼“å­˜?&#125;</span><br><span class="line">isnocache--å¦--&gt;oripicstop[åŸå›¾åŠ è½½å®Œæ¯•]</span><br><span class="line">isnocache--æ˜¯--&gt;update[æ›´æ–° url-å‹ç¼©æ¯”-ttl è®°å½•]</span><br><span class="line">update--&gt;oripicstop</span><br></pre></td></tr></table></figure>
<h3 id="æ‰«ææ–‡æ¡£ï¼Œè·å–å›¾ç‰‡èŠ‚ç‚¹å…·ä½“æµç¨‹"><a href="#æ‰«ææ–‡æ¡£ï¼Œè·å–å›¾ç‰‡èŠ‚ç‚¹å…·ä½“æµç¨‹" class="headerlink" title="æ‰«ææ–‡æ¡£ï¼Œè·å–å›¾ç‰‡èŠ‚ç‚¹å…·ä½“æµç¨‹"></a>æ‰«ææ–‡æ¡£ï¼Œè·å–å›¾ç‰‡èŠ‚ç‚¹å…·ä½“æµç¨‹</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">graph LR</span><br><span class="line">init(åˆå§‹åŒ–èŠ‚ç‚¹åˆ—è¡¨)--&gt;scanOver&#123;æ–‡æ¡£æ‰«æå®Œæ¯•?&#125;</span><br><span class="line">scanOver--å¦--&gt;scan[æ‰«ææ–‡æ¡£]</span><br><span class="line">scan--&gt;getPicEle[è·å–pictureèŠ‚ç‚¹]</span><br><span class="line">getPicEle--&gt;getchild[è·å–å­èŠ‚ç‚¹çš„srcå’Œsrcsetä¸­æ‰€æœ‰å›¾ç‰‡çš„url]</span><br><span class="line">getchild--&gt;ishost&#123;èŠ‚ç‚¹å›¾ç‰‡urlçš„åŸŸåå­˜åœ¨å¯æ›¿æ¢å›¾ç‰‡åŸŸå?&#125;</span><br><span class="line">ishost--å¦--&gt;skip[è·³è¿‡è¯¥èŠ‚ç‚¹]</span><br><span class="line">ishost--æ˜¯--&gt;addList[èŠ‚ç‚¹åˆ—è¡¨åŠ å…¥è¯¥èŠ‚ç‚¹]</span><br><span class="line">scan--&gt;getImgEle[è·å–çˆ¶èŠ‚ç‚¹épictureçš„imgèŠ‚ç‚¹]</span><br><span class="line">getImgEle--&gt;getsrc[è·å–èŠ‚ç‚¹çš„srcæˆ–srcsetå±æ€§]</span><br><span class="line">getsrc--&gt;ishost</span><br><span class="line">scan--&gt;getstyleEle[è·å–styleä¸­å«æœ‰background-imageå±æ€§ä¸”å€¼ä¸ºå›¾ç‰‡urlçš„èŠ‚ç‚¹]</span><br><span class="line">getstyleEle--&gt;ishost</span><br><span class="line">scan--&gt;getcss[æ‰«æcssæ–‡æ¡£,è·å–å«æœ‰background-imageå±æ€§ä¸”å€¼ä¸ºå›¾ç‰‡urlçš„cssè§„åˆ™]</span><br><span class="line">getcss--&gt;getcssDom[åŒ¹é…cssè§„åˆ™å¾—åˆ°ç›¸åº”èŠ‚ç‚¹]</span><br><span class="line">getcssDom--&gt;ishost</span><br><span class="line">scan--&gt;getvideo[è·å–å«posterå±æ€§ä¸”å€¼ä¸ºå›¾ç‰‡urlçš„videoèŠ‚ç‚¹]</span><br><span class="line">getvideo--&gt;ishost</span><br><span class="line">skip--&gt;scanOver</span><br><span class="line">addList--&gt;scanOver</span><br><span class="line">scanOver--æ˜¯--&gt;scanEnd(èŠ‚ç‚¹è·å–å®Œæ¯•)</span><br></pre></td></tr></table></figure>

<h1 id="ä¸‰ã€å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ"><a href="#ä¸‰ã€å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ" class="headerlink" title="ä¸‰ã€å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ"></a>ä¸‰ã€å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ</h1><h2 id="3-1-æºç«™æœ‰åšæ‡’åŠ è½½ç­–ç•¥çš„"><a href="#3-1-æºç«™æœ‰åšæ‡’åŠ è½½ç­–ç•¥çš„" class="headerlink" title="3.1 æºç«™æœ‰åšæ‡’åŠ è½½ç­–ç•¥çš„"></a>3.1 æºç«™æœ‰åšæ‡’åŠ è½½ç­–ç•¥çš„</h2><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œä¼šå‡ºç°åç»­è¯·æ±‚åŸå›¾æ—¶ï¼Œåå°è¿”å›å°å›¾çš„é—®é¢˜ã€‚</p>
<p>å› ä¸ºè®¿é—®çš„åŸŸåæ²¡æœ‰åšæ›´æ”¹ï¼Œåå°é»˜è®¤å°å›¾å¤„ç†ã€‚</p>
<p>æ­¤å¤–ï¼Œè¿˜ä¼šå‘èµ·æ›´å¤šçš„è¯·æ±‚</p>
<ul>
<li>imgä¸­æ²¡æœ‰src</li>
</ul>
<p>pageloadåæ‰«ææ–‡æ¡£å¹¶æ‹¿ä¸åˆ°src æ•…ä¸ä¼šå‘èµ·è·å–åŸå›¾çš„å¼‚æ­¥è¯·æ±‚</p>
<ul>
<li>imgä¸­srcä¸ºæºç«™çš„å°å›¾</li>
</ul>
<p>åˆæ¬¡è®¿é—®å°å›¾ï¼Œåå°ä¼šè¿”å›ä¸€å¼ å°å°å›¾ï¼Œpageloadä¹‹åæˆ‘ä»¬æ‰«ææ–‡æ¡£ä¼šå»æ‹¿å°å›¾ï¼ŒåŠ ä¸Šæ‡’åŠ è½½ç­–ç•¥è§¦å‘åˆè¯·æ±‚çš„å›¾ç‰‡ï¼Œæˆ‘ä»¬ä¼šå‘ä¸‰æ¬¡è¯·æ±‚</p>
<p><strong><code>è¿™ä¸ªç”±å®¢æˆ·é…ç½®ï¼Œå®¢æˆ·è‡ªå·±æœ‰åšæ‡’åŠ è½½å¯ä»¥ä¸é€‰æ‹©æˆ‘ä»¬çš„åˆ†å±‚åŠ è½½åŠŸèƒ½ï¼Œæ‰€ä»¥è¿™è¾¹æˆ‘ä»¬æ— éœ€è€ƒè™‘</code></strong></p>
<h2 id="3-2-csså’Œstyleä¸­background-imageæ˜¯å¦è¿›è¡Œå¤„ç†"><a href="#3-2-csså’Œstyleä¸­background-imageæ˜¯å¦è¿›è¡Œå¤„ç†" class="headerlink" title="3.2 csså’Œstyleä¸­background-imageæ˜¯å¦è¿›è¡Œå¤„ç†"></a>3.2 csså’Œstyleä¸­background-imageæ˜¯å¦è¿›è¡Œå¤„ç†</h2><p><strong><code>ç›®å‰å‰ç«¯è¿™è¾¹å¯ä»¥åšåˆ°æ‰«ææ–‡æ¡£è·å–åˆ°å›¾ç‰‡åœ°å€,å¯¹äºä¼ªç±»cssï¼ˆå¦‚ div:hover{background:xxx}ï¼‰è¿˜å¾—åšé¢å¤–å¤„ç†</code></strong></p>
<p>éœ€è¦æµ‹è¯•ä¸‹ä¼ªç±»</p>
<p>å¯¹äº <code>background-image:inherit</code>ï¼ˆä½¿ç”¨çˆ¶èŠ‚ç‚¹çš„bg-imageï¼‰ä¸åšå¤„ç†</p>
<h2 id="3-3-æ ¹æ®åª’ä½“å±æ€§çš„æ¸²æŸ“"><a href="#3-3-æ ¹æ®åª’ä½“å±æ€§çš„æ¸²æŸ“" class="headerlink" title="3.3 æ ¹æ®åª’ä½“å±æ€§çš„æ¸²æŸ“"></a>3.3 æ ¹æ®åª’ä½“å±æ€§çš„æ¸²æŸ“</h2><ul>
<li><p><code>&lt;img&gt;</code>çš„srcsetå±æ€§å’Œcssçš„image-set()</p>
</li>
<li><p><code>&lt;picture&gt;</code> sourceã€imgå­èŠ‚ç‚¹</p>
</li>
</ul>
<p><del>åˆæ¬¡è¿”å›å°å›¾ï¼Œpageloadä¹‹åå‰ç«¯è¿™è¾¹ä¸çŸ¥é“åº”è¯¥è¯·æ±‚å“ªå¼ å›¾ç‰‡ï¼Œä¸çŸ¥é“æœ‰æ²¡æœ‰åŠæ³•è·å–æ¸²æŸ“çš„æ˜¯å“ªå¼ å›¾</del><br>å¯ä»¥é€šè¿‡imgèŠ‚ç‚¹çš„currentSrcæ‹¿åˆ°å€¼ã€‚(æ³¨ï¼špictureçš„ä¹Ÿæ˜¯å»æ‹¿imgçš„currentSrc)</p>
<p>ä½†è¿˜æ˜¯æœ‰æ–°çš„é—®é¢˜ï¼Œè¿™ä¸ªæ˜¯å“åº”å¼çš„ï¼Œç•Œé¢å˜åŒ–åˆä¼šå»æ‹¿æ–°çš„å›¾ç‰‡åœ°å€äº†</p>
<blockquote>
<p>æ•…éœ€è¦åšimgèŠ‚ç‚¹currentSrcå€¼å˜åŒ–ç›‘å¬</p>
<p>ç›®å‰æ²¡æœ‰æ‰¾åˆ°ç›´æ¥ç›‘å¬currentSrcçš„æ–¹æ³•ï¼Œä½†æ˜¯ä¸€èˆ¬currentSrcçš„å˜åŒ–éƒ½æ˜¯ç”±çª—å£å¤§å°å˜åŒ–å¼•èµ·çš„ï¼Œæ•…éœ€è¦èŠ‚æµç›‘å¬ä¸‹window.resize,åˆ¤æ–­currentSrcæœ‰å˜åŒ–æ²¡ã€‚</p>
</blockquote>
<p>åé¢å‘ç°ï¼Œå³ä½¿çŸ¥é“å›¾ç‰‡åœ°å€å˜åŒ–äº†ï¼Œä¹Ÿå¹¶ä¸èƒ½é€šè¿‡imgæ”¹srcçš„æ–¹å¼æ›¿æ¢å›¾ç‰‡ï¼Œå› ä¸ºsrcsetå­˜åœ¨çš„æ—¶å€™srcæ˜¯æ— æ•ˆçš„ã€‚</p>
<p><strong><code>æ•…è§£æ³•åªæœ‰åœ¨pageloadçš„æ—¶å€™ï¼ŒæŠŠsrcsetä¸­å›¾ç‰‡çš„åœ°å€åšæ›¿æ¢</code></strong></p>
<h2 id="3-4-å’Œæ‡’åŠ è½½ç»“åˆçš„ç­–ç•¥"><a href="#3-4-å’Œæ‡’åŠ è½½ç»“åˆçš„ç­–ç•¥" class="headerlink" title="3.4 å’Œæ‡’åŠ è½½ç»“åˆçš„ç­–ç•¥"></a>3.4 å’Œæ‡’åŠ è½½ç»“åˆçš„ç­–ç•¥</h2><ul>
<li><p>åŠ è½½å…¨éƒ¨å°å›¾ï¼ŒpageloadååŠ è½½å…¨éƒ¨å¤§å›¾ï¼Œä¸åšæ‡’åŠ è½½</p>
</li>
<li><p>åŠ è½½å…¨éƒ¨å°å›¾ï¼Œæ»‘åŠ¨æ‡’åŠ è½½å¤§å›¾</p>
</li>
<li><p>åŠ è½½é¦–å±å°å›¾ï¼Œæ»‘åŠ¨æ‡’åŠ è½½å¤§å›¾</p>
</li>
</ul>
<blockquote>
<p>ç›®å‰æ˜¯åŠ è½½å…¨éƒ¨å°å›¾å’Œé¦–å±å¤§å›¾</p>
</blockquote>
<ul>
<li>loadedæ—¶å¼€å¯æ‡’åŠ è½½ï¼Œæ»‘åŠ¨æ‡’åŠ è½½å¤§å›¾ï¼Œloadå‰æ»‘åŠ¨ä¸åšå¤„ç†</li>
<li>domcontentloadedæ—¶å¼€å¯æ‡’åŠ è½½ï¼Œæœªloadå‰éƒ½æ˜¯åŠ è½½çš„åŸå›¾ã€‚</li>
</ul>
<h2 id="3-5-åŸå§‹å›¾ç‰‡è¾ƒå°ï¼Œç¬¬äºŒæ¬¡ä¸åšåŠ è½½"><a href="#3-5-åŸå§‹å›¾ç‰‡è¾ƒå°ï¼Œç¬¬äºŒæ¬¡ä¸åšåŠ è½½" class="headerlink" title="3.5 åŸå§‹å›¾ç‰‡è¾ƒå°ï¼Œç¬¬äºŒæ¬¡ä¸åšåŠ è½½"></a>3.5 åŸå§‹å›¾ç‰‡è¾ƒå°ï¼Œç¬¬äºŒæ¬¡ä¸åšåŠ è½½</h2><p>é‡‡ç”¨ajaxè¯·æ±‚ï¼Œæ ¹æ®å“åº”å€¼é•¿åº¦åˆ¤æ–­ï¼Œå“åº”å€¼é•¿åº¦å°äºæŸä¸ªå€¼ è¯´æ˜æ˜¯é”™è¯¯è¯·æ±‚æˆ–è€…ä¸åšåŠ è½½</p>
<p>æœ€åé€šè¿‡ window.URL.createObjectURL() æ’å…¥å›¾ç‰‡ã€‚ä½†æ˜¯è¯¥æ–¹æ¡ˆä¸èƒ½è§£å†³<code>é—®é¢˜3</code></p>
<p><strong>æ–°æ–¹æ¡ˆ</strong>ï¼š<strong><code>ç¬¬ä¸€æ¬¡å‘è¿‡æ¥è‹¥æ˜¯åŸå›¾ï¼Œè®¾ç½®ç¼“å­˜ç­–ç•¥ï¼Œåç»­è¯·æ±‚ï¼Œè¿”å›307é‡å®šå‘åˆ°åŸæ¥åœ°å€ï¼Œè¿™æ—¶å€™æœ¬åœ°æœ‰ç¼“å­˜å°±ä¸ä¼šå†å‘è¯·æ±‚äº†</code></strong></p>
<h2 id="3-6-æ ¹æ®ç½‘ç»œé€Ÿåº¦ï¼Œåœ¨ç¬¬äºŒæ¬¡æŒ‰ç…§ä¸€å®šæ¯”ä¾‹åŠ è½½é«˜æ¸…å›¾"><a href="#3-6-æ ¹æ®ç½‘ç»œé€Ÿåº¦ï¼Œåœ¨ç¬¬äºŒæ¬¡æŒ‰ç…§ä¸€å®šæ¯”ä¾‹åŠ è½½é«˜æ¸…å›¾" class="headerlink" title="3.6 æ ¹æ®ç½‘ç»œé€Ÿåº¦ï¼Œåœ¨ç¬¬äºŒæ¬¡æŒ‰ç…§ä¸€å®šæ¯”ä¾‹åŠ è½½é«˜æ¸…å›¾"></a>3.6 æ ¹æ®ç½‘ç»œé€Ÿåº¦ï¼Œåœ¨ç¬¬äºŒæ¬¡æŒ‰ç…§ä¸€å®šæ¯”ä¾‹åŠ è½½é«˜æ¸…å›¾</h2><p>å¦‚ä½•æµ‹é€Ÿï¼Ÿ</p>
<p>åˆ©ç”¨<code>Resource Timing API</code> ï¼Œç°ä»£æµè§ˆå™¨å¤§éƒ¨åˆ†æ”¯æŒï¼Œè¯¦è§caniuseï¼Œ</p>
<p>è‹¥ä¸æ”¯æŒ(safari11ä»¥ä¸‹)ï¼Œåˆ™é‡‡ç”¨<code>navigation timing</code></p>
<p>è¯¥apiå¿…é¡»åœ¨<code>page load</code>åæ‰èƒ½ä½¿ç”¨ã€‚</p>
<p><strong><code>å…·ä½“ç½‘ç»œå¸¦å®½ä¼°è®¡ç®—æ³•éœ€è¦ä¸€å®šç­–ç•¥æ¥è¯„åˆ¤</code></strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//è®¡ç®—æµè§ˆå™¨åŠ è½½è¯¥æ–‡æ¡£çš„æ—¶é—´</span></span><br><span class="line"><span class="keyword">var</span> nav = performance.getEntriesByType(<span class="string">'navigation'</span>)[<span class="number">0</span>]</span><br><span class="line"><span class="built_in">console</span>.log(nav.responseEnd-nav.responseStart,nav.transferSize,nav.transferSize/(nav.responseEnd-nav.responseStart)+<span class="string">"KB/s"</span>)</span><br></pre></td></tr></table></figure>

<p>facebookçš„æµ‹é€Ÿç®—æ³•ï¼š</p>
<p>å‰é¢èµ„æºè¿˜æœ‰åšä¸€å®šçš„è¿‡æ»¤å’Œæ’åºï¼ˆæŒ‰responseEndï¼‰ï¼Œ</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">performance.getEntriesByType(<span class="string">'resource'</span>).filter(<span class="function"><span class="params">v</span>=&gt;</span>v.responseEnd-v.responseStart&gt;<span class="number">30</span>).reduce(<span class="function">(<span class="params">sum,cur</span>)=&gt;</span><span class="number">0.5</span>*(cur.transferSize / (cur.responseEnd - cur.responseStart || <span class="number">1</span>))+<span class="number">0.5</span>*sum,<span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<p>facebookå¸¦å®½åˆ©ç”¨ç‡ï¼š<code>æ‰€æœ‰å“åº”æ—¶é—´å’ŒåŠå“åº”é—´éš”å’Œ/æ‰€æœ‰å“åº”æ—¶é—´</code></p>
<p><del>æˆ‘ä»¬å‡è®¾ç½‘ç»œé€Ÿåº¦æ’å®šï¼ˆä¸æŠ–åŠ¨ï¼‰ï¼Œç»™å‡ºä»¥ä¸‹æ•°æ®ï¼ˆå“åº”å¼€å§‹æ—¶é—´ï¼Œå“åº”ç»“æŸæ—¶é—´ï¼Œèµ„æºå¤§å°ï¼‰ã€‚æˆ‘ä»¬ä¼šè®¡ç®—æ¯ä¸€æ®µçš„å“åº”é€Ÿåº¦ï¼Œæœ€åå–æœ€å¤§å€¼ã€‚è¿™æ ·è§£å†³äº†ä¹‹å‰åªè®¡ç®—htmlæ–‡æ¡£å­˜åœ¨çš„é—®é¢˜ï¼Œå¹¶ä¸”è¯¥æ–¹æ¡ˆçš„ç»“æœä¹Ÿå…¼å®¹äº†htmlæ–‡æ¡£è®¡ç®—ã€‚<br>è¿™è¾¹å‡è®¾äº†ç½‘ç»œä¸æŠ–åŠ¨ã€‚å½“å‡ºç°ç½‘ç»œæŠ–åŠ¨æƒ…å†µï¼Œä¼šå‡ºç°å‰é¢ä¸‹è½½é€Ÿåº¦å’Œåé¢ä¸ä¸€è‡´æƒ…å†µï¼Œä½†æ˜¯ç”±äºæˆ‘ä»¬åé¢ä¹Ÿä¼šåšè®¡ç®—ï¼Œåœ¨æ•°æ®é‡è¶³å¤Ÿçš„æƒ…å†µä¸‹æ˜¯è¶‹äºç¨³å®šçš„ã€‚<br>æ¨èæ•°æ®ç»“æ„ï¼šçº¿æ®µæ ‘+æ‰«æçº¿ <code>O(nlogn)</code><br>æš´åŠ›è§£æ³•ï¼š<code>O(nÂ²)</code></del></p>
<h3 id="ç®—æ³•æµç¨‹"><a href="#ç®—æ³•æµç¨‹" class="headerlink" title="ç®—æ³•æµç¨‹"></a>ç®—æ³•æµç¨‹</h3><ol start="0">
<li><p>æ•°æ®ç»“æ„ä½“</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  name: v.name,<span class="comment">//æ ‡è¯†è€Œå·²</span></span><br><span class="line">  start: v.responseStart,</span><br><span class="line">  end: v.responseEnd,</span><br><span class="line">  size: v.transferSize,</span><br><span class="line">  <span class="comment">//KB/S æ–°ç®—æ³•ä¸­ä¸ç”¨è¯¥å‚æ•°</span></span><br><span class="line">  speed: v.transferSize / (v.responseEnd - v.responseStart || <span class="number">1</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>è¿‡æ»¤ã€æŒ‰startå€¼å‡åºæ’åº</p>
<blockquote>
<p>å‰”é™¤å°æ•°æ®,ä¿ç•™æ»¡è¶³ä»¥ä¸‹æ¡ä»¶æ•°æ®â€“ã€‹å°æ•°æ®ä¼šå¯¼è‡´å‡ºç°è¿‡å¤§çš„ç½‘é€Ÿè®¡ç®—ç»“æœï¼Œå‰”é™¤å°æ•°æ®åå¯¹æ€»ä½“ç»“æœå½±å“å°ï¼Œ<br><code>v.transferSize &gt; 100 &amp;&amp; (v.responseEnd - v.responseStart) &gt; 10 &amp;&amp; v.responseStart &lt; loadTime</code></p>
</blockquote>
</li>
<li><p>åˆ†ç»„ï¼Œå°†å“åº”æ—¶é—´æ— è¿ç»­çš„åˆ†ç»„</p>
</li>
<li><p>è®¡ç®—æ¯ç»„çš„æ¯æ¡å“åº”çš„é€Ÿåº¦ï¼ˆå…·ä½“è®¡ç®—è§å¦‚ä¸‹ï¼‰ï¼Œå¹¶è®¡ç®—æ•´ç»„å‡å€¼ã€æ–¹å·®ã€æœ€å¤§å€¼</p>
<ul>
<li>3.1 å°†æ¯æ¡å“åº”çš„start,endæ”¾å…¥numArr</li>
<li>3.2 numArrå»é‡ï¼Œå‡åºæ’åº</li>
<li>3.3 å°†æ¯æ¡å“åº”çš„æ—¶é—´åŒºé—´æŒ‰numArrå€¼åˆ†å‰²ï¼Œå½“å…¶ä»–å“åº”æœ‰é‡å¤çš„åŒºé—´ï¼Œè¯¥æ¡å“åº”çš„è¯¥æ—¶é—´åŒºé—´ä¼šä¹˜ä»¥é‡å¤çš„æ•°é‡(åŒ…æ‹¬è‡ªå·±)</li>
<li>3.4 å°†æ¯æ®µæ—¶é—´åŒºé—´ç›¸åŠ ï¼Œå½¢æˆè¯¥å“åº”çš„å®é™…å“åº”æ—¶é—´ï¼Œç”¨sizeå¤„äºè¯¥æ—¶é—´åˆ™ä¸ºè¯¥å“åº”çš„å®é™…é€Ÿåº¦</li>
<li>3.5 è®¡ç®—æ¯æ¡å“åº”çš„é€Ÿåº¦</li>
</ul>
</li>
<li><p>æ ¹æ®sizeåšåŠ æƒå¹³å‡ï¼Œå¾—åˆ°æ¯ç»„å¸¦å®½ä¼°ç®—å€¼ã€‚</p>
</li>
<li><p>æ¯”è¾ƒæ¯ç»„æ•°æ®çš„ç»“æœï¼Œå–æœ€å¤§å€¼</p>
</li>
</ol>
<p>ç›®å‰ä»å­˜åœ¨é—®é¢˜ï¼šå°æ•°æ®çŸ­æ—¶é—´ï¼Œå½“Ã—ä¸Šä¸€å®šå¹¶å‘æ—¶ï¼Œä¼šä½¿æ•°æ®è¿‡å¤§ã€‚</p>
<blockquote>
<p>sizeåŠ æƒå¹³å‡ï¼Œå¼±åŒ–å°æ•°æ®çš„å½±å“</p>
</blockquote>
<p>ç®—æ³•æ•ˆç‡è¿‡ä½O(nÂ³)ï¼šéœ€è¦æ”¹è¿›</p>
<blockquote>
<p>ç›®å‰O(nÂ²)ï¼Œä»å¯ä»¥å‰ªæä¼˜åŒ–</p>
</blockquote>
<h2 id="3-7-å›¾ç‰‡åˆå¹¶ï¼Œç¬¬ä¸€æ¬¡æ˜¯æ¨¡ç³Šå›¾ç‰‡ï¼Œç¬¬äºŒæ¬¡æ˜¯è¡¥å……ä¿¡æ¯ï¼Œåˆå¹¶åå˜æˆåŸå›¾"><a href="#3-7-å›¾ç‰‡åˆå¹¶ï¼Œç¬¬ä¸€æ¬¡æ˜¯æ¨¡ç³Šå›¾ç‰‡ï¼Œç¬¬äºŒæ¬¡æ˜¯è¡¥å……ä¿¡æ¯ï¼Œåˆå¹¶åå˜æˆåŸå›¾" class="headerlink" title="3.7 å›¾ç‰‡åˆå¹¶ï¼Œç¬¬ä¸€æ¬¡æ˜¯æ¨¡ç³Šå›¾ç‰‡ï¼Œç¬¬äºŒæ¬¡æ˜¯è¡¥å……ä¿¡æ¯ï¼Œåˆå¹¶åå˜æˆåŸå›¾"></a>3.7 å›¾ç‰‡åˆå¹¶ï¼Œç¬¬ä¸€æ¬¡æ˜¯æ¨¡ç³Šå›¾ç‰‡ï¼Œç¬¬äºŒæ¬¡æ˜¯è¡¥å……ä¿¡æ¯ï¼Œåˆå¹¶åå˜æˆåŸå›¾</h2><p>è¾ƒéš¾ï¼Œç›®å‰ä¸ç ”ç©¶</p>
<h2 id="3-8-å­˜åœ¨ç¼“å­˜ï¼Œè¿˜æ˜¯ä¼šåˆ†å±‚åŠ è½½ï¼Œä½“éªŒä¸å¥½"><a href="#3-8-å­˜åœ¨ç¼“å­˜ï¼Œè¿˜æ˜¯ä¼šåˆ†å±‚åŠ è½½ï¼Œä½“éªŒä¸å¥½" class="headerlink" title="3.8 å­˜åœ¨ç¼“å­˜ï¼Œè¿˜æ˜¯ä¼šåˆ†å±‚åŠ è½½ï¼Œä½“éªŒä¸å¥½"></a>3.8 å­˜åœ¨ç¼“å­˜ï¼Œè¿˜æ˜¯ä¼šåˆ†å±‚åŠ è½½ï¼Œä½“éªŒä¸å¥½</h2><p>ç®€å•çš„å°†è¿‡ç¨‹æ”¾åœ¨domcontentloadedæ—¶å¹¶ä¸èƒ½è§£å†³é—®é¢˜ï¼Œä¼šå¯¼è‡´åˆæ¬¡åŠ è½½æˆ–è€…æ— ç¼“å­˜åŠ è½½ï¼Œå¯èƒ½ä¸è§¦å‘åˆ†å±‚æœºåˆ¶ï¼ˆæ¨¡ç³Šçš„srcæœªä¸‹å®Œåˆç›´æ¥è¢«æ›¿æ¢äº†ï¼‰ã€‚</p>
<p><strong>åˆ†å±‚åŠ è½½é€»è¾‘ä¿®æ”¹ä¸º</strong>ï¼š</p>
<ol>
<li>htmlçš„åŸå§‹æ–‡æ¡£,imgä»…åšå ä½<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- åˆæ¬¡åŠ è½½çš„æ–‡æ¡£ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">figure</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">noscript</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"https://pic4.zhimg.com/50/1355440786fffad694ed56130dbbc0bc_hd.jpg"</span> <span class="attr">data-rawheight</span>=<span class="string">"667"</span> <span class="attr">data-rawwidth</span>=<span class="string">"1000"</span> <span class="attr">class</span>=<span class="string">"origin_image zh-lightbox-thumb"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">width</span>=<span class="string">"1000"</span> <span class="attr">data-original</span>=<span class="string">"https://pic4.zhimg.com/1355440786fffad694ed56130dbbc0bc_r.jpg"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">noscript</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"data:image/svg+xml;utf8,<span class="symbol">&amp;lt;</span>svg%20xmlns='http://www.w3.org/2000/svg'%20width='1000'%20height='667'<span class="symbol">&amp;gt;</span><span class="symbol">&amp;lt;</span>    /svg<span class="symbol">&amp;gt;</span>"</span><span class="attr">data-rawheight</span>=<span class="string">"667"</span> <span class="attr">data-rawwidth</span>=<span class="string">"1000"</span> <span class="attr">class</span>=<span class="string">"origin_image zh-lightbox-thumb lazy"</span> <span class="attr">width</span>=<span class="string">"1000"</span>           <span class="attr">data-original</span>=<span class="string">"https://pic4.zhimg.com/1355440786fffad694ed56130dbbc0bc_r.jpg"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">data-actualsrc</span>=<span class="string">"https://pic4.zhimg.com/50/1355440786fffad694ed56130dbbc0bc_hd.jpg"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">figure</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>domcontentloadåï¼Œjså°†imgç”¨divæ›¿æ¢ï¼Œå¹¶å¼€å§‹æ¨¡ç³Šå’Œé«˜æ¸…å›¾ç‰‡çš„åŠ è½½<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">figure</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">noscript</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"https://pic4.zhimg.com/50/1355440786fffad694ed56130dbbc0bc_hd.jpg"</span> <span class="attr">data-rawheight</span>=<span class="string">"667"</span> <span class="attr">data-rawwidth</span>=<span class="string">"1000"</span> <span class="attr">class</span>=<span class="string">"origin_image zh-lightbox-thumb"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">width</span>=<span class="string">"1000"</span> <span class="attr">data-original</span>=<span class="string">"https://pic4.zhimg.com/1355440786fffad694ed56130dbbc0bc_r.jpg"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">noscript</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--VagurImageä¸­è®¾ç½®äº†èƒŒæ™¯è‰²--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"VagurImage"</span> <span class="attr">data-src</span>=<span class="string">"https://pic4.zhimg.com/50/1355440786fffad694ed56130dbbc0bc_hd.jpg"</span> <span class="attr">style</span>=<span class="string">"width:654px;height:980.51px"</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!--è®¾ç½®äº†é«˜æ–¯æ¨¡ç³Šå’Œé€æ˜åº¦--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"VagueImage-mask is-active"</span>&gt;</span></span><br><span class="line">        ::before</span><br><span class="line">        ::after</span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">figure</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>æ¨¡ç³Šå›¾ç‰‡ä¸‹è½½å®Œæ¯•,è®¾ç½®background-image<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- æ–‡æ¡£å…¶ä»–åœ°æ–¹ä¸å˜ä¸å˜--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"VagueImage-mask is-active"</span> <span class="attr">background-image</span>=<span class="string">"url('https://pic4.zhimg.com/50/1355440786fffad694ed56130dbbc0bc_60w.jpg')"</span>&gt;</span></span><br><span class="line">  ::before</span><br><span class="line">  ::after</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>é«˜æ¸…å›¾ä¸‹è½½å®Œæ¯•<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">figure</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">noscript</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"https://pic4.zhimg.com/50/1355440786fffad694ed56130dbbc0bc_hd.jpg"</span> <span class="attr">data-rawheight</span>=<span class="string">"667"</span> <span class="attr">data-rawwidth</span>=<span class="string">"1000"</span> <span class="attr">class</span>=<span class="string">"origin_image zh-lightbox-thumb"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">width</span>=<span class="string">"1000"</span> <span class="attr">data-original</span>=<span class="string">"https://pic4.zhimg.com/1355440786fffad694ed56130dbbc0bc_r.jpg"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">noscript</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"https://pic4.zhimg.com/1355440786fffad694ed56130dbbc0bc_hd.jpg"</span> <span class="attr">data-rawheight</span>=<span class="string">"667"</span> <span class="attr">data-rawwidth</span>=<span class="string">"1000"</span> <span class="attr">class</span>=<span class="string">"origin_image zh-lightbox-thumb lazy"</span> <span class="attr">width</span>=<span class="string">"1000"</span>           <span class="attr">data-original</span>=<span class="string">"https://pic4.zhimg.com/1355440786fffad694ed56130dbbc0bc_r.jpg"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">data-actualsrc</span>=<span class="string">"https://pic4.zhimg.com/50/1355440786fffad694ed56130dbbc0bc_hd.jpg"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">figure</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>jsä»£ç </p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//è¿˜æ˜¯æ”¾åœ¨domcontentloadedæ‰§è¡Œ</span></span><br><span class="line"><span class="built_in">document</span>.addEventListener(<span class="string">"DOMContentLoaded"</span>,func,<span class="literal">false</span>)</span><br><span class="line"><span class="comment">//func</span></span><br><span class="line"><span class="comment">//é‡‡ç”¨ä¸¤æ¬¡Imageï¼Œè‹¥imgç›´æ¥åŠ è½½æ¨¡ç³Šå›¾çš„è¯ï¼Œåªéœ€imgLargeå³å¯</span></span><br><span class="line"><span class="keyword">let</span> smallImage = <span class="built_in">document</span>.getElementById(<span class="string">'small-img'</span>)</span><br><span class="line"><span class="keyword">let</span> img = <span class="keyword">new</span> Image()</span><br><span class="line">img.src=smallImage.src</span><br><span class="line"><span class="comment">//ç”±äºsmallImageçš„å·²ç»loadäº†ï¼Œè¿™è¾¹æˆ‘ä»¬åˆ©ç”¨ç¼“å­˜å†åŠ è½½åŒä¸ªå›¾ï¼Œä¼šå»æ‹¿ç¼“å­˜è§¦å‘onload</span></span><br><span class="line">img.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="comment">//ä¸‹å›¾åŠ è½½å®Œæ¯•</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> imgLarge = <span class="keyword">new</span> Image();</span><br><span class="line">imgLarge.src = smallImage.getAttribute(<span class="string">"originSrc"</span>)</span><br><span class="line">imgLarge.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  smallImage.src = imgLarge.src</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ä½†æ˜¯ç›®å‰è¯¥åšæ³•æœ‰ä¸ªé—®é¢˜ï¼Œå°±æ˜¯åŸå›¾è·å–æ˜¯åœ¨domcontentloadedçš„æ—¶å€™è¿›è¡Œï¼Œæ­¤æ—¶è¿˜æœªè¿›è¡Œæµ‹é€Ÿï¼Œæˆ–è€…è¯´æ­¤æ—¶è¿›è¡Œæµ‹é€Ÿç”¨æˆ‘ä»¬çš„æµ‹é€Ÿç®—æ³•æ˜¯ä¸å‡†çš„ï¼ˆèµ„æºä¸‹è½½è¿‡ç¨‹ä¸­<code>performance.getEntries</code>æ˜¯æ‹¿ä¸åˆ°è¯¥èµ„æºçš„ï¼‰ã€‚<br>ä¸€ä¸ªæƒ³æ³•æ˜¯å¯¹äºæœªæµ‹é€Ÿæ—¶ï¼Œéƒ½åŠ è½½åŸå›¾</p>
</blockquote>
<h2 id="3-9-å¸¦ç½‘ç»œå‚æ•°ï¼Œä¸ä¼šå‘½ä¸­åŸå›¾å·²æœ‰æœ¬åœ°ç¼“å­˜"><a href="#3-9-å¸¦ç½‘ç»œå‚æ•°ï¼Œä¸ä¼šå‘½ä¸­åŸå›¾å·²æœ‰æœ¬åœ°ç¼“å­˜" class="headerlink" title="3.9 å¸¦ç½‘ç»œå‚æ•°ï¼Œä¸ä¼šå‘½ä¸­åŸå›¾å·²æœ‰æœ¬åœ°ç¼“å­˜"></a>3.9 å¸¦ç½‘ç»œå‚æ•°ï¼Œä¸ä¼šå‘½ä¸­åŸå›¾å·²æœ‰æœ¬åœ°ç¼“å­˜</h2><p>é—®é¢˜è¯¦ç»†æè¿°ï¼šæœ¬åœ°å·²ç¼“å­˜åŸå›¾<code>a.jpg</code>ï¼Œæœ¬åœ°é€šè¿‡ç½‘ç»œè®¡ç®—éœ€è¦å»è¯·æ±‚ä½æ¸…å›¾ç‰‡<code>a.jpg?q=50</code>,è¿™æ ·å°±æµªè´¹äº†åŸæ¥çš„åŸå›¾ç¼“å­˜äº†ã€‚</p>
<p>è§£æ³•ï¼šä¸åŒæ¯”ä¾‹å›¾ç‰‡loadåï¼Œå°†<code>url-TTL</code>æ”¾åˆ°localstorageä¸­ã€‚æ¯æ¬¡ç½‘ç»œè®¡ç®—å®Œåï¼Œå…ˆæŸ¥è¯¢ç¼“å­˜ä¸­æœ‰æ²¡æœ‰æ›´é«˜æ¸…çš„ä¸”æœªè¿‡æœŸçš„å›¾ç‰‡ï¼Œæœ‰çš„è¯é€‰æ›´é«˜æ¸…çš„è¿›è¡Œè¯·æ±‚ï¼Œä¸å¯¹localstorageåšå¤„ç† ï¼›å¦åˆ™è¯·æ±‚ç›¸åº”ç½‘ç»œçŠ¶æ€çš„å›¾ç‰‡ï¼Œonloadåä¿å­˜æˆ–æ›´æ–°localstorageã€‚</p>
<blockquote>
<p>æ³¨1ï¼šæ¯ç§æ¸…æ™°åº¦å›¾ç‰‡çš„TTLå¯é…ç½®ï¼Œé€šè¿‡scriptèŠ‚ç‚¹è‡ªå®šä¹‰å±æ€§è®¾ç½®ã€‚</p>
</blockquote>
<blockquote>
<p>æ³¨2ï¼šæœ¬åœ°åªæœ‰ä½æ¸…ç¼“å­˜ä¸è€ƒè™‘è¯·æ±‚æ˜¯å› ä¸ºæˆ‘ä»¬å½“å‰ç½‘ç»œçŠ¶æ€ç®—è¿˜è¡Œäº†ï¼Œä¸éœ€è¦ç”¨ä½æ¸…çš„ï¼Œå¦åˆ™å¤šæ¬¡æ¸…æ™°åº¦åˆ‡æ¢ä¼šå¯¹ç”¨æˆ·é€ æˆè§†è§‰ä¸Šå½±å“ã€‚</p>
</blockquote>
<p>å½“å‰è¿™ä¸ªé—®é¢˜ä¹Ÿå¯ä»¥é€šè¿‡<code>blur+åŠ¨ç”»</code>è§£å†³ï¼Œéœ€è¦äº§å“è¯„ä¼°ä¸‹ã€‚</p>
<p>å­˜åœ¨é—®é¢˜ï¼šå¼ºåˆ·é¡µé¢æˆ–è€…<code>disable cache</code>ï¼Œè¯·æ±‚å›¾ç‰‡å¾—åˆ°å“åº”åï¼Œ<code>cache-control</code>æœ¬åœ°ç¼“å­˜æ—¶é—´ä¼šé‡æ–°è®¡ç®—ã€‚ç›¸åº”çš„æˆ‘ä»¬localstorageçš„TTLä¹Ÿè¦è¿›è¡Œä¿®æ”¹</p>
<p>è§£å†³æ–¹æ¡ˆï¼šè¿™è¾¹æˆ‘ä»¬ä¸»è¦å°±æ˜¯åˆ¤æ–­å›¾ç‰‡æ˜¯å¦ä¸ºæ— ç¼“å­˜è¯·æ±‚ï¼Œå½“ä¸ºæ— ç¼“å­˜è¯·æ±‚ï¼Œimg.onloadåéœ€è¦å¯¹localstorageè¿›è¡Œæ›´æ–°ã€‚<br>è‡³äºæ€ä¹ˆåˆ¤æ–­æ˜¯å¦ä¸ºæ— ç¼“å­˜ï¼Œå°±ç”¨<code>performance.getEntriesByName(&#39;å½“å‰åŠ è½½å›¾ç‰‡çš„url&#39;)</code>ç»“æœæ˜¯å¦æ»¡è¶³æŸäº›è§„åˆ™æ¥åˆ¤æ–­</p>
<h2 id="3-10-åŸå›¾è®¿é—®ä¼šåšurlæ›¿æ¢ï¼Œå½“å‰ä¸æ˜¯ç”¨h2-è€Œæ˜¯ç”¨åŸŸåˆ†ç‰‡ï¼Œå½“ä¸¤æ¬¡å›¾ç‰‡è¯·æ±‚ä¸æ˜¯åŒä¸ªåŸŸæ—¶ä¼šä¸èµ°ç¼“å­˜"><a href="#3-10-åŸå›¾è®¿é—®ä¼šåšurlæ›¿æ¢ï¼Œå½“å‰ä¸æ˜¯ç”¨h2-è€Œæ˜¯ç”¨åŸŸåˆ†ç‰‡ï¼Œå½“ä¸¤æ¬¡å›¾ç‰‡è¯·æ±‚ä¸æ˜¯åŒä¸ªåŸŸæ—¶ä¼šä¸èµ°ç¼“å­˜" class="headerlink" title="3.10 åŸå›¾è®¿é—®ä¼šåšurlæ›¿æ¢ï¼Œå½“å‰ä¸æ˜¯ç”¨h2 è€Œæ˜¯ç”¨åŸŸåˆ†ç‰‡ï¼Œå½“ä¸¤æ¬¡å›¾ç‰‡è¯·æ±‚ä¸æ˜¯åŒä¸ªåŸŸæ—¶ä¼šä¸èµ°ç¼“å­˜"></a>3.10 åŸå›¾è®¿é—®ä¼šåšurlæ›¿æ¢ï¼Œå½“å‰ä¸æ˜¯ç”¨h2 è€Œæ˜¯ç”¨åŸŸåˆ†ç‰‡ï¼Œå½“ä¸¤æ¬¡å›¾ç‰‡è¯·æ±‚ä¸æ˜¯åŒä¸ªåŸŸæ—¶ä¼šä¸èµ°ç¼“å­˜</h2><blockquote>
<p>æ–¹æ³•1ï¼š å°†å›¾ç‰‡é“¾æ¥ä¸åŸŸååšmapæ˜ å°„<code>url-&gt;host</code>ï¼Œä¿å­˜åœ¨localstorageï¼Œä¸‹æ¬¡è®¿é—®ä¼šå…ˆæŸ¥ä¸€éï¼Œæ²¡æœ‰çš„è¯å°±éšæœºè®¿é—®å¹¶ä¿å­˜åœ¨localstorage</p>
</blockquote>
<blockquote>
<p>æ–¹æ³•2ï¼š åˆ©ç”¨ç®—æ³•å°†å›¾ç‰‡urlæ˜ å°„åˆ°æŸä¸ªMODå€¼(lengthä¸ºæ•£åˆ—åŸŸååˆ—è¡¨å¤§å°) éœ€è¦ä¿è¯æ¯ä¸ªè®¡ç®—ç»“æœå€¼ä¸å˜ä¸”æ˜ å°„æ¯ä¸ªåŸŸåçš„æ¦‚ç‡ä¸€è‡´<br>js åç§°çš„æ¯ä¸ªå­—ç¬¦çš„asciiç å€¼ç›¸åŠ å†mod length</p>
</blockquote>
<h2 id="3-11-JavaScriptè¢«ç¦ç”¨-åˆ†å±‚åŠ è½½æ‹¿ä¸åˆ°åŸå›¾"><a href="#3-11-JavaScriptè¢«ç¦ç”¨-åˆ†å±‚åŠ è½½æ‹¿ä¸åˆ°åŸå›¾" class="headerlink" title="3.11 JavaScriptè¢«ç¦ç”¨ åˆ†å±‚åŠ è½½æ‹¿ä¸åˆ°åŸå›¾"></a>3.11 JavaScriptè¢«ç¦ç”¨ åˆ†å±‚åŠ è½½æ‹¿ä¸åˆ°åŸå›¾</h2><p>ç›®å‰ä¸è€ƒè™‘</p>
<h2 id="3-12-é€æ˜é®ç½©ï¼ŒåŠ¨ç”»è®©å›¾ç‰‡åˆ‡æ¢å˜å¾—è‡ªç„¶"><a href="#3-12-é€æ˜é®ç½©ï¼ŒåŠ¨ç”»è®©å›¾ç‰‡åˆ‡æ¢å˜å¾—è‡ªç„¶" class="headerlink" title="3.12 é€æ˜é®ç½©ï¼ŒåŠ¨ç”»è®©å›¾ç‰‡åˆ‡æ¢å˜å¾—è‡ªç„¶"></a>3.12 é€æ˜é®ç½©ï¼ŒåŠ¨ç”»è®©å›¾ç‰‡åˆ‡æ¢å˜å¾—è‡ªç„¶</h2><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.VagueImage-mask</span> &#123;</span><br><span class="line">    <span class="attribute">z-index</span>: <span class="number">1</span>;</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">background-size</span>: cover;</span><br><span class="line">    <span class="attribute">background-position</span>: <span class="number">50%</span>;</span><br><span class="line">    <span class="attribute">background-repeat</span>: no-repeat;</span><br><span class="line">    <span class="attribute">transition</span>: opacity .<span class="number">3s</span> ease-in</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸è¿‡ ç”±äºæˆ‘ä»¬ä¸æ˜¯æä¾›çš„å°åˆ†è¾¨ç‡å›¾å†æ”¾å¤§ï¼Œè€Œæ˜¯æä¾›åŒåˆ†è¾¨ç‡çš„æ¨¡ç³Šå›¾ï¼Œè¿™è¾¹å°±ä¸è¿›è¡Œé€æ˜é®ç½©å¤„ç†äº†ã€‚</p>
<h2 id="3-13-å›¾ç‰‡èŠ‚ç‚¹æ‰«æå®Œæ¯•åï¼Œåç»­é€šè¿‡jsåŠ¨æ€å¢åŠ çš„ImageèŠ‚ç‚¹ï¼Œè‹¥å›¾ç‰‡srcæ»¡è¶³åˆ†å±‚è§„åˆ™ï¼Œåå°ä¼šè¿”å›æ¨¡ç³Šå›¾ç‰‡"><a href="#3-13-å›¾ç‰‡èŠ‚ç‚¹æ‰«æå®Œæ¯•åï¼Œåç»­é€šè¿‡jsåŠ¨æ€å¢åŠ çš„ImageèŠ‚ç‚¹ï¼Œè‹¥å›¾ç‰‡srcæ»¡è¶³åˆ†å±‚è§„åˆ™ï¼Œåå°ä¼šè¿”å›æ¨¡ç³Šå›¾ç‰‡" class="headerlink" title="3.13 å›¾ç‰‡èŠ‚ç‚¹æ‰«æå®Œæ¯•åï¼Œåç»­é€šè¿‡jsåŠ¨æ€å¢åŠ çš„ImageèŠ‚ç‚¹ï¼Œè‹¥å›¾ç‰‡srcæ»¡è¶³åˆ†å±‚è§„åˆ™ï¼Œåå°ä¼šè¿”å›æ¨¡ç³Šå›¾ç‰‡"></a>3.13 å›¾ç‰‡èŠ‚ç‚¹æ‰«æå®Œæ¯•åï¼Œåç»­é€šè¿‡jsåŠ¨æ€å¢åŠ çš„ImageèŠ‚ç‚¹ï¼Œè‹¥å›¾ç‰‡srcæ»¡è¶³åˆ†å±‚è§„åˆ™ï¼Œåå°ä¼šè¿”å›æ¨¡ç³Šå›¾ç‰‡</h2><ol>
<li>å®šæ—¶æ‰«æ<br>æ— ä»»ä½•ä¼˜åŒ–æ—¶ï¼Œjd 3kå¤šèŠ‚ç‚¹  æ¯æ¬¡æ‰«æè€—æ—¶20mså·¦å³ï¼Œåé¢å¯èƒ½å¯ä»¥åšå¢é‡ä¼˜åŒ–ã€‚<br>ä½†æœ‰ä¸ªé—®é¢˜å°±æ˜¯éœ€è¦ä¸€ç›´å»åšå®šæ—¶æ‰«æï¼Œå¯¹å®¢æˆ·ç½‘é¡µæ€§èƒ½æœ‰å½±å“</li>
</ol>
<p>æŠ€æœ¯éš¾åº¦ä½</p>
<ol start="2">
<li>å…ƒç´ ç›‘å¬</li>
</ol>
<h3 id="é€šè¿‡Object-definePropertyå»ç›‘å¬srcçš„set"><a href="#é€šè¿‡Object-definePropertyå»ç›‘å¬srcçš„set" class="headerlink" title="é€šè¿‡Object.definePropertyå»ç›‘å¬srcçš„set"></a>é€šè¿‡<code>Object.defineProperty</code>å»ç›‘å¬srcçš„set</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="built_in">Object</span>.defineProperty(HTMLImageElement.prototype, <span class="string">'src'</span>, &#123;</span><br><span class="line">      enumerable: <span class="literal">false</span>,</span><br><span class="line">      configurable: <span class="literal">true</span>,</span><br><span class="line">      <span class="keyword">get</span>: function () &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.getAttribute(<span class="string">'src'</span>)</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="keyword">set</span>: function (newval) &#123;</span><br><span class="line">        <span class="comment">//å±äºå¯æ›¿æ¢åŸŸçš„</span></span><br><span class="line">        <span class="keyword">if</span> (newval.indexOf(<span class="string">"data:image"</span>) === <span class="number">-1</span> &amp;&amp; Util.inlist(newval, settings.imgHostList)) &#123;</span><br><span class="line">          <span class="keyword">this</span>.setAttribute(<span class="string">'src'</span>, Util.getNewUrlFromCache(newval, MAX_QUALITY).url);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">this</span>.setAttribute(<span class="string">'src'</span>, newval);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">//TODO srcsetçš„defineProperty</span></span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    <span class="built_in">console</span>.error(<span class="string">'Image Element set error'</span>, error)</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>å…¼å®¹IE8ï¼ŒIE8æ”¯æŒå¯¹htmlå…ƒç´ å¯¹è±¡è¿›è¡Œ defineProperty ,enumerable éœ€è¦è®¾ç½®ä¸ºfalse</p>
<h3 id="document-writeæ–¹æ³•é‡è½½"><a href="#document-writeæ–¹æ³•é‡è½½" class="headerlink" title="document.writeæ–¹æ³•é‡è½½"></a>document.writeæ–¹æ³•é‡è½½</h3><p>æ³¨ï¼šè¦ä¹ˆå¿…é¡»æ”¯æŒjså¼‚æ­¥åŠ è½½è®©document.writeå»¶åæ‰§è¡Œï¼Œè¦ä¹ˆæŠŠå›¾ç‰‡ä¼˜åŒ–è„šæœ¬æ”¾åœ¨headä¸­</p>
<p>ä»¥ä¸‹æ­¥éª¤ä»…æµ‹è¯•å›¾ç‰‡ä¼˜åŒ–åŠŸèƒ½ç”¨ï¼Œæš‚ä¸å…¼å®¹jså¼‚æ­¥åŠ è½½åŠŸèƒ½ï¼Œdocument.writeæ–¹æ³•ä¹Ÿæ˜¯ç­‰å›¾ç‰‡ä¼˜åŒ–è„šæœ¬åŠ è½½å®Œæ¯•åæ‰§è¡Œ</p>
<ol>
<li>è·å¾—å½“å‰æ‰§è¡Œè„šæœ¬èŠ‚ç‚¹-currentScript<blockquote>
<p>ä½œä¸ºæ ‡å¿—ä½ï¼Œå†…å®¹å°†æ’å…¥åœ¨è¯¥èŠ‚ç‚¹ä¹‹å‰ï¼Œæ­¤å¤„å‘½ä¸­ä¸ºèŠ‚ç‚¹ CUR</p>
</blockquote>
</li>
<li>æ‰¾åˆ°CURçš„çˆ¶èŠ‚ç‚¹CURP,åˆ›å»ºä¸€ä¸ªCURP.tagNameçš„èŠ‚ç‚¹CURCï¼Œå…¶innerHTMLä¸ºæ‰€æ’å…¥å†…å®¹</li>
<li>éå†èŠ‚ç‚¹ï¼Œæ‰¾åˆ°æ»¡è¶³æ¡ä»¶çš„å›¾ç‰‡èŠ‚ç‚¹å¹¶è¿›è¡Œhostæ›¿æ¢</li>
<li>å°†CURCçš„æ‰€æœ‰å­èŠ‚ç‚¹insertBefore(CUR)</li>
</ol>
<p>è¯¥åšæ³•è·å–ä¸åˆ°cssæ¸²æŸ“</p>
<p>æŠ€æœ¯éš¾åº¦è¾ƒé«˜</p>
<h2 id="3-14-å›¾ç‰‡èŠ‚ç‚¹å¯»æ‰¾å®Œæ¯•åï¼Œéœ€è¦è¿›è¡Œä¸€ä¸ªè§†è·æ’åºï¼Œè¿™æ ·å½“æ²¡å¼€å¯æ‡’åŠ è½½æ—¶æ‰ä¼šä¼˜å…ˆåŠ è½½é¦–å±å›¾åƒ"><a href="#3-14-å›¾ç‰‡èŠ‚ç‚¹å¯»æ‰¾å®Œæ¯•åï¼Œéœ€è¦è¿›è¡Œä¸€ä¸ªè§†è·æ’åºï¼Œè¿™æ ·å½“æ²¡å¼€å¯æ‡’åŠ è½½æ—¶æ‰ä¼šä¼˜å…ˆåŠ è½½é¦–å±å›¾åƒ" class="headerlink" title="3.14 å›¾ç‰‡èŠ‚ç‚¹å¯»æ‰¾å®Œæ¯•åï¼Œéœ€è¦è¿›è¡Œä¸€ä¸ªè§†è·æ’åºï¼Œè¿™æ ·å½“æ²¡å¼€å¯æ‡’åŠ è½½æ—¶æ‰ä¼šä¼˜å…ˆåŠ è½½é¦–å±å›¾åƒ"></a>3.14 å›¾ç‰‡èŠ‚ç‚¹å¯»æ‰¾å®Œæ¯•åï¼Œéœ€è¦è¿›è¡Œä¸€ä¸ªè§†è·æ’åºï¼Œè¿™æ ·å½“æ²¡å¼€å¯æ‡’åŠ è½½æ—¶æ‰ä¼šä¼˜å…ˆåŠ è½½é¦–å±å›¾åƒ</h2><p>æœ‰ç©ºå†™</p>
<h1 id="å››ã€è¯¦ç»†è®¾è®¡"><a href="#å››ã€è¯¦ç»†è®¾è®¡" class="headerlink" title="å››ã€è¯¦ç»†è®¾è®¡"></a>å››ã€è¯¦ç»†è®¾è®¡</h1><h2 id="4-1-è·å–scriptè‡ªå®šä¹‰æ•°æ®"><a href="#4-1-è·å–scriptè‡ªå®šä¹‰æ•°æ®" class="headerlink" title="4.1 è·å–scriptè‡ªå®šä¹‰æ•°æ®"></a>4.1 è·å–scriptè‡ªå®šä¹‰æ•°æ®</h2><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">data-host</span>=<span class="string">"xxx"</span> <span class="attr">id</span>=<span class="string">"speed"</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">let</span> ele = <span class="built_in">document</span>.currentScript</span></span><br><span class="line"><span class="javascript">  <span class="built_in">console</span>.log(ele.attributes[<span class="string">"data-host"</span>].nodeValue)</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>è¿™æ ·å¯ä»¥è·å–åˆ°æœ¬scriptèŠ‚ç‚¹çš„è‡ªå®šä¹‰æ•°æ®</p>
<h2 id="4-2-æ³¨å†Œwindow-loadäº‹ä»¶ç›‘å¬å™¨"><a href="#4-2-æ³¨å†Œwindow-loadäº‹ä»¶ç›‘å¬å™¨" class="headerlink" title="4.2 æ³¨å†Œwindow.loadäº‹ä»¶ç›‘å¬å™¨"></a>4.2 æ³¨å†Œwindow.loadäº‹ä»¶ç›‘å¬å™¨</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addLoadEvent</span>(<span class="params">func</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">window</span>.addEventListener) &#123;</span><br><span class="line">    <span class="built_in">window</span>.addEventListener(<span class="string">"load"</span>, func, <span class="literal">false</span>)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">//ä½ç‰ˆieå…¼å®¹</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">window</span>.attachEvent) &#123;</span><br><span class="line">      <span class="built_in">window</span>.attachEvent(<span class="string">"onload"</span>, func)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">addLoadEvent(streamFunc);</span><br></pre></td></tr></table></figure>
<h2 id="4-3-è®¡ç®—ç”¨æˆ·ç½‘ç»œçŠ¶å†µ"><a href="#4-3-è®¡ç®—ç”¨æˆ·ç½‘ç»œçŠ¶å†µ" class="headerlink" title="4.3 è®¡ç®—ç”¨æˆ·ç½‘ç»œçŠ¶å†µ"></a>4.3 è®¡ç®—ç”¨æˆ·ç½‘ç»œçŠ¶å†µ</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//è®¡ç®—æµè§ˆå™¨åŠ è½½è¯¥æ–‡æ¡£çš„æ—¶é—´</span></span><br><span class="line"><span class="keyword">var</span> nav = performance.getEntriesByType(<span class="string">'navigation'</span>)[<span class="number">0</span>]</span><br><span class="line"><span class="built_in">console</span>.log(nav.responseEnd-nav.responseStart,nav.transferSize,nav.transferSize/(nav.responseEnd-nav.responseStart)+<span class="string">"KB/s"</span>)</span><br></pre></td></tr></table></figure>

<h2 id="4-4-èŠ‚ç‚¹è·å–"><a href="#4-4-èŠ‚ç‚¹è·å–" class="headerlink" title="4.4 èŠ‚ç‚¹è·å–"></a>4.4 èŠ‚ç‚¹è·å–</h2><h3 id="4-4-1-è·å–imgå…ƒç´ "><a href="#4-4-1-è·å–imgå…ƒç´ " class="headerlink" title="4.4.1 è·å–imgå…ƒç´ "></a>4.4.1 è·å–imgå…ƒç´ </h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> imgDOMList = <span class="built_in">document</span>.getElementsByTagName(<span class="string">"img"</span>);</span><br><span class="line">[...imgDOMList].forEach(<span class="function">(<span class="params">dom</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//å…¶ä»–å¤„ç†</span></span><br><span class="line">    <span class="comment">//å«srcsetå±æ€§åšé¢å¤–æ ‡è¯†</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="4-4-2-è·å–styleä¸­çš„background"><a href="#4-4-2-è·å–styleä¸­çš„background" class="headerlink" title="4.4.2 è·å–styleä¸­çš„background"></a>4.4.2 è·å–styleä¸­çš„background</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> styleDOMList = <span class="built_in">document</span>.querySelectorAll(<span class="string">"[style*=background]"</span>);</span><br><span class="line">[...styleDOMList].filter(<span class="function"><span class="params">v</span>=&gt;</span>v.nodeType == <span class="number">1</span> &amp;&amp; v.style.backgroundImage).forEach(<span class="function">(<span class="params">dom</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//å…¶ä»–å¤„ç†</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="4-4-3-è·å–cssä¸­çš„background"><a href="#4-4-3-è·å–cssä¸­çš„background" class="headerlink" title="4.4.3 è·å–cssä¸­çš„background"></a>4.4.3 è·å–cssä¸­çš„background</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//è·å–cssä¸­çš„backgroundï¼Œ</span></span><br><span class="line"><span class="built_in">document</span>.styleSheets.filter(<span class="function"><span class="params">v</span>=&gt;</span>&#123;</span><br><span class="line">  <span class="comment">//æ ¹æ®v.hrefè¿‡æ»¤ç¬¬ä¸‰æ–¹css</span></span><br><span class="line">  <span class="keyword">return</span> </span><br><span class="line">&#125;).forEach(<span class="function"><span class="params">v</span>=&gt;</span>&#123;</span><br><span class="line">  <span class="keyword">let</span> rules = v.cssRules || v.rules</span><br><span class="line">  rules.forEach(<span class="function"><span class="params">v</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">let</span> sel = v.selectorText</span><br><span class="line">    <span class="keyword">let</span> domList = <span class="built_in">document</span>.querySelectorAll(sel);</span><br><span class="line">    <span class="keyword">if</span>(v.style.backgroundImage)&#123;</span><br><span class="line">      <span class="comment">//æ»¡è¶³æ¡ä»¶çš„æ“ä½œ</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>å®Œæ•´ç‰ˆæœ¬</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">queryImgNodeList: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> list = []</span><br><span class="line">        <span class="comment">//è·å–pictureèŠ‚ç‚¹</span></span><br><span class="line">        ; (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">          <span class="keyword">var</span> pictureList = <span class="built_in">document</span>.getElementsByTagName(<span class="string">"picture"</span>);</span><br><span class="line">          <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; pictureList.length; i++) &#123;</span><br><span class="line">            <span class="comment">//ä»…imgå­èŠ‚ç‚¹å­˜åœ¨æ—¶è¿›è¡Œä¸‹ä¸€æ­¥åˆ¤æ–­ï¼Œä¸€èˆ¬éƒ½ä¼šæœ‰imgå­èŠ‚ç‚¹</span></span><br><span class="line">            <span class="keyword">if</span> (pictureList[i].getElementsByTagName(<span class="string">"img"</span>).length) &#123;</span><br><span class="line">              <span class="keyword">var</span> urlList = []</span><br><span class="line">              <span class="keyword">var</span> nodeList = pictureList[i].querySelectorAll(<span class="string">"source,img"</span>)</span><br><span class="line">              <span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; nodeList.length; j++) &#123;</span><br><span class="line">                <span class="keyword">var</span> srcset = nodeList[j].getAttribute(<span class="string">"srcset"</span>)</span><br><span class="line">                <span class="keyword">var</span> src = nodeList[j].getAttribute(<span class="string">"src"</span>)</span><br><span class="line">                <span class="keyword">if</span> (srcset) &#123;</span><br><span class="line">                  urlList = urlList.concat(getUrlListInSrcset(srcset))</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (src &amp;&amp; src.indexOf(<span class="string">"data:image"</span>) === <span class="number">-1</span>) &#123;</span><br><span class="line">                  urlList.push(src)</span><br><span class="line">                &#125;</span><br><span class="line">              &#125;</span><br><span class="line">              <span class="keyword">if</span> (urlList.length &gt; <span class="number">0</span> &amp;&amp; inlist(urlList, settings.imgHostList)) &#123;</span><br><span class="line">                list.push(<span class="keyword">new</span> WsNode(<span class="string">'picture'</span>, pictureList[i]))</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)()</span><br><span class="line">        <span class="comment">// è·å–videoèŠ‚ç‚¹</span></span><br><span class="line">        ; (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">          <span class="keyword">var</span> videoList = <span class="built_in">document</span>.getElementsByTagName(<span class="string">"video"</span>);</span><br><span class="line">          <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; videoList.length; i++) &#123;</span><br><span class="line">            <span class="keyword">var</span> poster = videoList[i].getAttribute(<span class="string">"poster"</span>)</span><br><span class="line">            <span class="keyword">if</span> (poster &amp;&amp; poster.indexOf(<span class="string">"data:image"</span>) === <span class="number">-1</span> &amp;&amp; inlist(poster, settings.imgHostList)) &#123;</span><br><span class="line">              list.push(<span class="keyword">new</span> WsNode(<span class="string">'video'</span>, videoList[i]))</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)()</span><br><span class="line">        <span class="comment">// è·å–imgèŠ‚ç‚¹</span></span><br><span class="line">        ; (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">          <span class="keyword">var</span> imgList = <span class="built_in">document</span>.getElementsByTagName(<span class="string">"img"</span>);</span><br><span class="line">          <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; imgList.length; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (imgList[i].parentNode.nodeName !== <span class="string">"PICTURE"</span>) &#123;</span><br><span class="line">              <span class="keyword">var</span> urlList = []</span><br><span class="line">              <span class="keyword">var</span> srcset = imgList[i].getAttribute(<span class="string">"srcset"</span>)</span><br><span class="line">              <span class="keyword">var</span> src = imgList[i].getAttribute(<span class="string">"src"</span>)</span><br><span class="line">              <span class="keyword">if</span> (srcset) &#123;</span><br><span class="line">                urlList = getUrlListInSrcset(srcset)</span><br><span class="line">              &#125; <span class="keyword">else</span> <span class="keyword">if</span> (src &amp;&amp; src.indexOf(<span class="string">"data:image"</span>) === <span class="number">-1</span>) &#123;</span><br><span class="line">                urlList.push(src)</span><br><span class="line">              &#125;</span><br><span class="line">              <span class="keyword">if</span> (urlList.length &gt; <span class="number">0</span> &amp;&amp; inlist(urlList, settings.imgHostList)) &#123;</span><br><span class="line">                list.push(<span class="keyword">new</span> WsNode(<span class="string">'img'</span>, imgList[i]))</span><br><span class="line">              &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)()</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        //è·å–style*background-image</span></span><br><span class="line"><span class="comment">        ; (function () &#123;</span></span><br><span class="line"><span class="comment">          var styleList = document.querySelectorAll("[style]");</span></span><br><span class="line"><span class="comment">          //ie8 not support [style*=background]</span></span><br><span class="line"><span class="comment">          for (var i = 0; i &lt; styleList.length; i++) &#123;</span></span><br><span class="line"><span class="comment">            var cur = styleList[i];</span></span><br><span class="line"><span class="comment">            if (cur.nodeType == 1 &amp;&amp; cur.style.backgroundImage) &#123;</span></span><br><span class="line"><span class="comment">              var url = getBackgroundImageUrl(cur.style.backgroundImage);</span></span><br><span class="line"><span class="comment">              if (url &amp;&amp; inlist(url, settings.imgHostList)) &#123;</span></span><br><span class="line"><span class="comment">                list.push(new WsNode('style', cur))</span></span><br><span class="line"><span class="comment">              &#125;</span></span><br><span class="line"><span class="comment">            &#125;</span></span><br><span class="line"><span class="comment">          &#125;</span></span><br><span class="line"><span class="comment">        &#125;)()</span></span><br><span class="line"><span class="comment">        //è·å–css background-image</span></span><br><span class="line"><span class="comment">        ; (function () &#123;</span></span><br><span class="line"><span class="comment">          for (var i = 0; i &lt; document.styleSheets.length; i++) &#123;</span></span><br><span class="line"><span class="comment">            var href = document.styleSheets[i].href;</span></span><br><span class="line"><span class="comment">            //è¿‡æ»¤ä¸æ»¡è¶³è§„åˆ™çš„csså¤–é“¾</span></span><br><span class="line"><span class="comment">            if (href &amp;&amp; !inlist(href, settings.cssHostList)) &#123;</span></span><br><span class="line"><span class="comment">              continue</span></span><br><span class="line"><span class="comment">            &#125;</span></span><br><span class="line"><span class="comment">            var rules = document.styleSheets[i].cssRules || document.styleSheets[i].rules</span></span><br><span class="line"><span class="comment">            //éå†æ¯æ¡è§„åˆ™</span></span><br><span class="line"><span class="comment">            for (var j = 0; j &lt; rules.length; j++) &#123;</span></span><br><span class="line"><span class="comment">              var url = getBackgroundImageUrl(rules[j].style.backgroundImage)</span></span><br><span class="line"><span class="comment">              if (url &amp;&amp; inlist(url, settings.imgHostList)) &#123;</span></span><br><span class="line"><span class="comment">                var eles = document.querySelectorAll(rules[j].selectorText)</span></span><br><span class="line"><span class="comment">                for (var k = 0; k &lt; eles.length; k++) &#123;</span></span><br><span class="line"><span class="comment">                  list.push(new WsNode('css', eles[k], url))</span></span><br><span class="line"><span class="comment">                &#125;</span></span><br><span class="line"><span class="comment">              &#125;</span></span><br><span class="line"><span class="comment">            &#125;</span></span><br><span class="line"><span class="comment">          &#125;</span></span><br><span class="line"><span class="comment">        &#125;)()*/</span></span><br><span class="line">        <span class="comment">//è·å–background-imageçš„èŠ‚ç‚¹</span></span><br><span class="line">        ; (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">          <span class="keyword">var</span> bglist = <span class="built_in">document</span>.querySelectorAll(<span class="string">"*"</span>)</span><br><span class="line">          <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; bglist.length; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (bglist[i].nodeType === <span class="number">1</span>) &#123;</span><br><span class="line">              <span class="keyword">var</span> url = getBackgroundImageUrl(getStyleBackgroundImage(bglist[i]))</span><br><span class="line">              <span class="keyword">if</span> (url &amp;&amp; inlist(url, settings.imgHostList)) &#123;</span><br><span class="line">                list.push(<span class="keyword">new</span> WsNode(<span class="string">'bg'</span>, bglist[i], url))</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)()</span><br><span class="line">      <span class="keyword">return</span> list</span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure>
<h3 id="4-4-4-è·å–pictureèŠ‚ç‚¹"><a href="#4-4-4-è·å–pictureèŠ‚ç‚¹" class="headerlink" title="4.4.4 è·å–pictureèŠ‚ç‚¹"></a>4.4.4 è·å–pictureèŠ‚ç‚¹</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> imgDOMList = <span class="built_in">document</span>.getElementsByTagName(<span class="string">"picture"</span>);</span><br><span class="line">imgDOMList.forEach(<span class="function"><span class="params">v</span>=&gt;</span>v.childList.forEach(<span class="function"><span class="params">c</span>=&gt;</span>c))</span><br></pre></td></tr></table></figure>

<p>ä¸ºé¿å…é‡å¤è®¡ç®—ï¼Œå…ˆæ‰«æ<code>picture</code>,å†æ‰«æ<code>img</code></p>
<h2 id="4-5-æ‡’åŠ è½½"><a href="#4-5-æ‡’åŠ è½½" class="headerlink" title="4.5 æ‡’åŠ è½½"></a>4.5 æ‡’åŠ è½½</h2><h3 id="æ–¹æ³•1-IntersectionObserver"><a href="#æ–¹æ³•1-IntersectionObserver" class="headerlink" title="æ–¹æ³•1 IntersectionObserver"></a>æ–¹æ³•1 IntersectionObserver</h3><p>å…¼å®¹æ€§å·®ï¼Œå¼€å‘é‡ä½</p>
<h3 id="æ–¹æ³•2-scroll-window-requestAnimationFrame"><a href="#æ–¹æ³•2-scroll-window-requestAnimationFrame" class="headerlink" title="æ–¹æ³•2 scroll+window.requestAnimationFrame()"></a>æ–¹æ³•2 scroll+window.requestAnimationFrame()</h3><p>å…¼å®¹æ€§é«˜ï¼Œå¼€å‘é‡è¿˜è¡Œ</p>
<h2 id="4-6-å›¾ç‰‡åœ°å€æ›¿æ¢"><a href="#4-6-å›¾ç‰‡åœ°å€æ›¿æ¢" class="headerlink" title="4.6 å›¾ç‰‡åœ°å€æ›¿æ¢"></a>4.6 å›¾ç‰‡åœ°å€æ›¿æ¢</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åˆ¤æ–­æ˜¯å¦ä¸ºå¯æ›¿æ¢åŸŸå</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">judgeHost</span>(<span class="params">url</span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ç›¸å¯¹è·¯å¾„è½¬ç»å¯¹è·¯å¾„(IE6, IE7)æ— æ•ˆ</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">directlink</span>(<span class="params">url</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> a = <span class="built_in">document</span>.createElement(<span class="string">'a'</span>);</span><br><span class="line">  a.href = url;</span><br><span class="line">  <span class="keyword">return</span> a.href;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// æ ¹æ®æ•£åˆ—åŸŸåã€ç½‘é€Ÿæ›¿æ¢url</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">replace</span>(<span class="params">originUrl,hashHost,networkSpeed</span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>å¤§å‰ç«¯</category>
      </categories>
      <tags>
        <tag>å‰ç«¯ä¼˜åŒ–</tag>
      </tags>
  </entry>
  <entry>
    <title>åŸºäºCDNçš„å‰ç«¯ä¼˜åŒ–å¯è¡Œæ€§åˆ†æ</title>
    <url>/2018/05/14/2018Q2/%E5%9F%BA%E4%BA%8ECDN%E7%9A%84%E5%89%8D%E7%AB%AF%E4%BC%98%E5%8C%96%E5%8F%AF%E8%A1%8C%E6%80%A7%E5%88%86%E6%9E%90/</url>
    <content><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>æ¢ç´¢ CDN å‚å•†èƒ½ä¸ºå‰ç«¯é¡µé¢æä¾›çš„ä¼˜åŒ–æ–¹æ¡ˆ</p>
<a id="more"></a>

<h1 id="åŸºæœ¬ä¼˜åŒ–"><a href="#åŸºæœ¬ä¼˜åŒ–" class="headerlink" title="åŸºæœ¬ä¼˜åŒ–"></a>åŸºæœ¬ä¼˜åŒ–</h1><h2 id="èµ„æºå‹ç¼©"><a href="#èµ„æºå‹ç¼©" class="headerlink" title="èµ„æºå‹ç¼©"></a>èµ„æºå‹ç¼©</h2><blockquote>
<p>html,css,jsç­‰èµ„æºæ–‡ä»¶è¿›è¡Œå‹ç¼©</p>
</blockquote>
<h2 id="ç¼“å­˜æ§åˆ¶"><a href="#ç¼“å­˜æ§åˆ¶" class="headerlink" title="ç¼“å­˜æ§åˆ¶"></a>ç¼“å­˜æ§åˆ¶</h2><blockquote>
<p>è®¾ç½®åˆç†çš„ç¼“å­˜ç­–ç•¥,æ–‡ä»¶è®¾ç½®ç‰ˆæœ¬å·ç­‰ç­‰</p>
</blockquote>
<h2 id="åŸŸåˆ†ç‰‡"><a href="#åŸŸåˆ†ç‰‡" class="headerlink" title="åŸŸåˆ†ç‰‡"></a>åŸŸåˆ†ç‰‡</h2><blockquote>
<p>å¢å¤§httpå¹¶å‘è¿æ¥æ•°</p>
</blockquote>
<h1 id="å›¾åƒä¼˜åŒ–"><a href="#å›¾åƒä¼˜åŒ–" class="headerlink" title="å›¾åƒä¼˜åŒ–"></a>å›¾åƒä¼˜åŒ–</h1><h2 id="åˆ†å±‚åŠ è½½"><a href="#åˆ†å±‚åŠ è½½" class="headerlink" title="åˆ†å±‚åŠ è½½"></a>åˆ†å±‚åŠ è½½</h2><blockquote>
<p>åŸºäºç½‘ç»œæ¡ä»¶åˆ†å±‚åŠ è½½,æä¾›å¤šç§å‹ç¼©çº§åˆ«çš„å›¾åƒèµ„æº</p>
</blockquote>
<h2 id="æ‡’åŠ è½½"><a href="#æ‡’åŠ è½½" class="headerlink" title="æ‡’åŠ è½½"></a>æ‡’åŠ è½½</h2><blockquote>
<p>ä»…åŠ è½½å½“å‰æµè§ˆå™¨è§†åŒºå¯è§çš„å›¾åƒï¼Œå½“ç”¨æˆ·å‘ä¸‹æ»‘åŠ¨æ—¶åŠ è½½æ–°å›¾åƒ,å‚è€ƒlazyloadã€‚é™¤äº†å›¾åƒå¤–ï¼Œå…¶ä»–èµ„æºä¹Ÿæ˜¯åŒç†</p>
</blockquote>
<blockquote>
<p>å‚è€ƒï¼š<a href="http://taobaofed.org/blog/2016/04/06/optimize-in-tbhome#å…³é”®æ¨¡å—ä¼˜å…ˆ" target="_blank" rel="noopener">http://taobaofed.org/blog/2016/04/06/optimize-in-tbhome#å…³é”®æ¨¡å—ä¼˜å…ˆ</a></p>
</blockquote>
<h2 id="ç‰¹å®šæµè§ˆå™¨çš„å›¾åƒä¼˜åŒ–"><a href="#ç‰¹å®šæµè§ˆå™¨çš„å›¾åƒä¼˜åŒ–" class="headerlink" title="ç‰¹å®šæµè§ˆå™¨çš„å›¾åƒä¼˜åŒ–"></a>ç‰¹å®šæµè§ˆå™¨çš„å›¾åƒä¼˜åŒ–</h2><blockquote>
<p>webpã€jpeg2000ç­‰å›¾åƒæ ¼å¼å¯ä»¥é™ä½è´Ÿè½½ï¼Œè€Œä¸å½±å“å›¾ç‰‡è´¨é‡</p>
</blockquote>
<h2 id="å›¾åƒå†…è”"><a href="#å›¾åƒå†…è”" class="headerlink" title="å›¾åƒå†…è”"></a>å›¾åƒå†…è”</h2><blockquote>
<p>å¯¹äºå°äº10k(å…·ä½“å¤§å°å¯å•†å®š)çš„å›¾åƒèµ„æºé‡‡ç”¨base64å†…è”</p>
</blockquote>
<h1 id="jsä¼˜åŒ–"><a href="#jsä¼˜åŒ–" class="headerlink" title="jsä¼˜åŒ–"></a>jsä¼˜åŒ–</h1><h2 id="jsåˆå¹¶"><a href="#jsåˆå¹¶" class="headerlink" title="jsåˆå¹¶"></a>jsåˆå¹¶</h2><blockquote>
<p>å°†æ— ä¾èµ–çš„jsæ‰“åŒ…ä¸ºä¸€ä¸ªjsï¼Œå‡å°‘httpè¯·æ±‚æ•°ã€‚è¿˜éœ€è¦è€ƒè™‘åˆ°æ˜¯å¦ä¼šè®©ç¼“å­˜å¤±æ•ˆ</p>
</blockquote>
<h2 id="å¼‚æ­¥åŒ–"><a href="#å¼‚æ­¥åŒ–" class="headerlink" title="å¼‚æ­¥åŒ–"></a>å¼‚æ­¥åŒ–</h2><blockquote>
<p>ä¸domæ— å…³çš„jsæ”¾åœ¨é¡µé¢æ¸²æŸ“ååŠ è½½</p>
</blockquote>
<h1 id="å…¶ä»–æ–¹å‘"><a href="#å…¶ä»–æ–¹å‘" class="headerlink" title="å…¶ä»–æ–¹å‘"></a>å…¶ä»–æ–¹å‘</h1><h2 id="ç»„ä»¶é¢„åŠ è½½"><a href="#ç»„ä»¶é¢„åŠ è½½" class="headerlink" title="ç»„ä»¶é¢„åŠ è½½"></a>ç»„ä»¶é¢„åŠ è½½</h2><blockquote>
<p>åˆ©ç”¨æµè§ˆå™¨ç©ºé—²æ—¶é—´è¯·æ±‚ç”¨æˆ·æ¥ä¸‹æ¥å¯èƒ½ä¼šè®¿é—®çš„ç»„ä»¶ã€‚</p>
</blockquote>
<p>ç”¨æˆ·è¡Œä¸ºé¢„æµ‹åˆ†æ</p>
<h2 id="http2"><a href="#http2" class="headerlink" title="http2"></a>http2</h2><blockquote>
<p>å¤šè·¯å¤ç”¨ï¼Œheaderå‹ç¼©</p>
</blockquote>
<h2 id="dns-prefetch"><a href="#dns-prefetch" class="headerlink" title="dns-prefetch"></a>dns-prefetch</h2><p>è§ <code>W3C_DNS_Prefetching.md</code></p>
<h2 id="å°½æ—©å‘é€htmléƒ¨åˆ†å“åº”"><a href="#å°½æ—©å‘é€htmléƒ¨åˆ†å“åº”" class="headerlink" title="å°½æ—©å‘é€htmléƒ¨åˆ†å“åº”"></a>å°½æ—©å‘é€htmléƒ¨åˆ†å“åº”</h2><blockquote>
<p>ç¼©çŸ­æä¾›ç¬¬ä¸€éƒ¨åˆ†htmlå“åº”çš„ä¸–ç•Œï¼Œä½¿æµè§ˆå™¨æ›´æ—©ä¸‹è½½èµ„æºã€‚</p>
<p>akamai æä¾›çš„ EdgeStart åŠŸèƒ½ã€‚æˆ‘ç†è§£åº”è¯¥æ˜¯å¯¹æœåŠ¡ç«¯æ¸²æŸ“ç½‘é¡µçš„åŠ é€Ÿï¼Œå¯ä»¥æ¢è®¨ä¸‹</p>
</blockquote>
<p><a href="https://developer.akamai.com/learn/FEO/edgestart.html" target="_blank" rel="noopener">What is EdgeStart?</a></p>
<p>é’ˆå¯¹åŠ¨æ€ç½‘é¡µ,éœ€è¦å®¢æˆ·é…åˆè®¾ç½®ä¸€äº›æ ‡ç­¾ä½ï¼ˆæˆ–è€…çœ‹æ˜¯å¦è®¾ç½®ç¼“å­˜ç­–ç•¥ï¼‰ï¼Œå°†åŠ¨æ€ç½‘é¡µåˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œè®¾ä¸ºæ ‡è¯†ä½çš„å†…å®¹å…ˆè¿”å›ç»™å‰ç«¯ï¼ˆå¹¶å¸¦ä¸Šæˆ‘ä»¬çš„åŠ é€Ÿè„šæœ¬ï¼‰ï¼Œå†…å®¹ä¸€èˆ¬æ˜¯ä¸€äº›å¯ç¼“å­˜çš„èµ„æºã€‚æœªæ ‡è¯†çš„ä¸ºåŠ¨æ€å†…å®¹ï¼Œéœ€è¦å›æºæ¸²æŸ“ã€‚</p>
<p>å¯ä»¥åˆ©ç”¨httpçš„chunkï¼Œé€æ­¥æŠŠhtmlæ–‡æ¡£æ¨ç»™ç”¨æˆ·ã€‚æˆ–è€…æ’å…¥æˆ‘ä»¬åŠ é€Ÿè„šæœ¬ é‡‡ç”¨ajaxè¯·æ±‚è·å–æ•°æ®ã€‚ï¼ˆéœ€è¦CDNæˆ–æºç«™é…åˆé…åˆ</p>
<p>æ ‡å¿—ä½å†…å®¹å¯ä»¥å…ˆè¢«è§£æï¼Œç”¨äºæé«˜éç¼“å­˜é¡µé¢çš„æ¸²æŸ“æ—¶é—´å’ŒTTFB</p>
<h2 id="big-pipe-å—å¼ä¼ è¾“"><a href="#big-pipe-å—å¼ä¼ è¾“" class="headerlink" title="big_pipe å—å¼ä¼ è¾“"></a>big_pipe å—å¼ä¼ è¾“</h2><p>å‰ç«¯æ¨¡å—åŒ–ï¼ŒæœåŠ¡ç«¯å—å¼ä¼ è¾“ã€‚</p>
<h2 id="ç›‘æ§ç”±jså‘èµ·çš„jsè¯·æ±‚ï¼Œå¤–é“¾åŠ é€Ÿ"><a href="#ç›‘æ§ç”±jså‘èµ·çš„jsè¯·æ±‚ï¼Œå¤–é“¾åŠ é€Ÿ" class="headerlink" title="ç›‘æ§ç”±jså‘èµ·çš„jsè¯·æ±‚ï¼Œå¤–é“¾åŠ é€Ÿ"></a>ç›‘æ§ç”±jså‘èµ·çš„jsè¯·æ±‚ï¼Œå¤–é“¾åŠ é€Ÿ</h2><p>å¯¹è¯¥å¯¹è±¡çš„srcå±æ€§é‡æ–°å®šä¹‰</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Object</span>.defineProperty(HTMLScriptElement.prototype, <span class="string">'src'</span>, &#123;</span><br><span class="line">    enumerable: <span class="literal">true</span>,</span><br><span class="line">    configurable: <span class="literal">true</span>,</span><br><span class="line">    <span class="keyword">get</span>: function()&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.getAttribute(<span class="string">'src'</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="keyword">set</span>: function(newval)&#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">this</span>.setAttribute(<span class="string">'src'</span>,<span class="string">'http://www.wangsu.com/'</span>+newval);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>å¯¹äº<code>doument.write(&#39;&lt;script src=&quot;a.js&quot;/&gt;&#39;)</code> éœ€è¦é¢å¤–å¤„ç†</p>
<h2 id="CSS-DataURI"><a href="#CSS-DataURI" class="headerlink" title="CSS-DataURI"></a>CSS-DataURI</h2><h2 id="å¼‚æ­¥åŠ è½½jsä¸æ‰§è¡Œï¼ŒæŒ‰åºæ‰§è¡Œ"><a href="#å¼‚æ­¥åŠ è½½jsä¸æ‰§è¡Œï¼ŒæŒ‰åºæ‰§è¡Œ" class="headerlink" title="å¼‚æ­¥åŠ è½½jsä¸æ‰§è¡Œï¼ŒæŒ‰åºæ‰§è¡Œ"></a>å¼‚æ­¥åŠ è½½jsä¸æ‰§è¡Œï¼ŒæŒ‰åºæ‰§è¡Œ</h2><p>ä¸Šæ–‡ï¼Œæˆ‘ä»¬æå‡ºäº†jså¼‚æ­¥ï¼Œè®©jsåœ¨domcontentloadä¹‹åå†å»åŠ è½½ï¼ŒjsåŠ è½½çš„è¿‡ç¨‹ä¸­ï¼Œåªæ˜¯ç®€å•çš„æ’å…¥<code>&lt;script&gt;</code>èŠ‚ç‚¹åˆ°æ–‡æ¡£ä¸­ï¼Œä¸èƒ½ä¿è¯scriptçš„æ‰§è¡Œé¡ºåºã€‚</p>
<p>æœªå¼‚æ­¥å‰ï¼Œscriptæ˜¯ä¸¥æ ¼çš„æŒ‰åºæ‰§è¡Œçš„ï¼Œè€Œæ— è®ºåœ¨æµè§ˆå™¨çš„å“ªä¸ªèŠ‚ç‚¹ï¼Œé€šè¿‡åŠ¨æ€æ’å…¥<code>script</code>çš„æ–¹å¼æ— æ³•ä¿è¯å…¶æ‰§è¡Œé¡ºåº</p>
<p>æœ€ç²—æš´çš„åšæ³•å³ï¼šå‰ä¸€ä¸ªè„šæœ¬onloadäº‹ä»¶è§¦å‘å(è„šæœ¬æ‰§è¡Œå®Œæ¯•)ï¼Œæ‰§è¡Œä¸‹ä¸€ä¸ªè„šæœ¬çš„ä¸‹è½½çš„æ‰§è¡Œ</p>
<p>ä½†æ˜¯è¿™æ ·å°±å˜æˆé¡ºåºä¸‹è½½äº†ï¼Œæ— æ³•å……åˆ†åˆ©ç”¨å¸¦å®½ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥åˆ©ç”¨<code>&lt;object&gt;</code>è¿›è¡Œé¢„ä¸‹è½½ï¼Œå¹¶åšä¸€å¥—æ§åˆ¶</p>
<p>(åˆ©ç”¨object tag ä¼šç”Ÿæˆblob,æŒºè€—æ—¶çš„)</p>
<h1 id="ç§»åŠ¨ç«¯ä¼˜åŒ–"><a href="#ç§»åŠ¨ç«¯ä¼˜åŒ–" class="headerlink" title="ç§»åŠ¨ç«¯ä¼˜åŒ–"></a>ç§»åŠ¨ç«¯ä¼˜åŒ–</h1><h2 id="AMP"><a href="#AMP" class="headerlink" title="AMP"></a>AMP</h2>]]></content>
      <categories>
        <category>å¤§å‰ç«¯</category>
      </categories>
      <tags>
        <tag>CDN</tag>
        <tag>å‰ç«¯ä¼˜åŒ–</tag>
      </tags>
  </entry>
  <entry>
    <title>yahooå‰ç«¯ä¼˜åŒ–35å†›è§„</title>
    <url>/2018/05/10/2018Q2/yahoo%E5%89%8D%E7%AB%AF%E4%BC%98%E5%8C%9635%E5%86%9B%E8%A7%84/</url>
    <content><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>æœ¬æ–‡ä¸º yahoo å‰ç«¯ä¼˜åŒ–35å†›è§„çš„æ¢—æ¦‚ï¼Œéƒ¨åˆ†ä¼˜åŒ–æŠ€æœ¯å·²è¿‡æ—¶ï¼Œè¯·æ³¨æ„åˆ†è¾¨</p>
<a id="more"></a>

<h1 id="å†…å®¹"><a href="#å†…å®¹" class="headerlink" title="å†…å®¹"></a>å†…å®¹</h1><h2 id="1-å°½é‡å‡å°‘HTTPè¯·æ±‚æ•°"><a href="#1-å°½é‡å‡å°‘HTTPè¯·æ±‚æ•°" class="headerlink" title="1.å°½é‡å‡å°‘HTTPè¯·æ±‚æ•°"></a>1.å°½é‡å‡å°‘HTTPè¯·æ±‚æ•°</h2><ol>
<li>èµ„æºåˆå¹¶</li>
<li>å°å›¾ç‰‡base64ç¼–ç </li>
<li>å¤šå›¾åˆå¹¶ä¸ºå•å›¾</li>
<li>CSS Spritesï¼Œé€šè¿‡background-imageå’Œbackground-positionå±æ€§æ¥å®šä½è¦æ˜¾ç¤ºçš„éƒ¨åˆ†</li>
</ol>
<h2 id="2-å‡å°‘DNSæŸ¥æ‰¾"><a href="#2-å‡å°‘DNSæŸ¥æ‰¾" class="headerlink" title="2. å‡å°‘DNSæŸ¥æ‰¾"></a>2. å‡å°‘DNSæŸ¥æ‰¾</h2><p>ç»„ä»¶åˆ†æ•£åˆ°2-4ä¸ªä¸»æœºåï¼Œè¿™æ˜¯åŒæ—¶å‡å°‘DNSæŸ¥æ‰¾å’Œå…è®¸é«˜å¹¶å‘ä¸‹è½½çš„æŠ˜ä¸­æ–¹æ¡ˆ</p>
<h2 id="3-é¿å…é‡å®šå‘"><a href="#3-é¿å…é‡å®šå‘" class="headerlink" title="3. é¿å…é‡å®šå‘"></a>3. é¿å…é‡å®šå‘</h2><p>HTTP é‡å®šå‘æ˜¯ä¸€é¡¹ç”¨äºå°†å®¢æˆ·ç«¯é‡å®šå‘åˆ°è®¾å¤‡ä¸“ç”¨ç½‘å€çš„å¸¸ç”¨æŠ€æœ¯ã€‚</p>
<p>ä½†é‡‡ç”¨é‡å®šå‘ä¼šå¢åŠ å»¶è¿Ÿã€‚</p>
<p>è‹¥å¿…é¡»é‡å®šå‘çš„è¯ï¼Œè¯·ä½¿ç”¨HTTPé‡å®šå‘ï¼ˆå“åº”ä½“ä¸ºç©ºï¼‰å¹¶ç”¨301(æ°¸ä¹…è½¬ç§»)æˆ–302ï¼ˆæš‚æ—¶è½¬ç§»ï¼‰çŠ¶æ€ç ã€‚ï¼ˆä¸¤è€…åŒºåˆ«åœ¨äº302ä¼šè¢«urlæ‹¦æˆªï¼Œå…·ä½“ç™¾åº¦</p>
<p>å› ä¸ºç³»ç»Ÿä¼šæ ¹æ® HTTP è¯·æ±‚æ ‡å¤´ä¸­çš„ç”¨æˆ·ä»£ç†æ¥æ‰§è¡Œé‡å®šå‘ã€‚ ä¾‹å­ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">HTTP&#x2F;1.1 301 Moved Permanently</span><br><span class="line">Location: http:&#x2F;&#x2F;example.com&#x2F;newuri</span><br><span class="line">Content-Type: text&#x2F;html</span><br></pre></td></tr></table></figure>


<p>è‹¥éš¾ä»¥å®ç°HTTPé‡å®šå‘ï¼Œåˆ™ç”¨jså†å»åšã€‚è¯¥åšæ³•å¤šäº†æ–‡æ¡£ä¸‹è½½ï¼Œjsè§£æçš„è¿‡ç¨‹ã€‚</p>
<p><strong>æ³¨æ„1ï¼š</strong>æœ‰ä¸€ç§å¸¸è§çš„æå…¶æµªè´¹èµ„æºçš„é‡å®šå‘ï¼Œå°±æ˜¯URLå°¾éƒ¨ç¼ºå°‘ä¸€ä¸ªæ–œçº¿çš„æ—¶å€™ã€‚</p>
<p>ä¾‹å¦‚ï¼Œè·³è½¬åˆ°<a href="http://astrology.yahoo.com/astrologyä¼šè¿”å›ä¸€ä¸ªé‡å®šå‘åˆ°http://astrology.yahoo.com/astrology/çš„301å“åº”ï¼ˆæ³¨æ„æ·»åœ¨å°¾éƒ¨çš„æ–œçº¿ï¼‰ã€‚" target="_blank" rel="noopener">http://astrology.yahoo.com/astrologyä¼šè¿”å›ä¸€ä¸ªé‡å®šå‘åˆ°http://astrology.yahoo.com/astrology/çš„301å“åº”ï¼ˆæ³¨æ„æ·»åœ¨å°¾éƒ¨çš„æ–œçº¿ï¼‰ã€‚</a></p>
<p>åœ¨Apacheä¸­å¯ä»¥ç”¨Aliasï¼Œmod_rewriteæˆ–è€…DirectorySlashæŒ‡ä»¤æ¥å–æ¶ˆä¸å¿…è¦çš„é‡å®šå‘ã€‚</p>
<p><strong>æ³¨æ„2ï¼š</strong>è¿›è¡ŒåŒå‘é‡å®šå‘ä¸å•å‘é‡å®šå‘</p>
<p>å°†è®¿é—®æ¡Œé¢ç‰ˆç½‘é¡µçš„ç§»åŠ¨ç”¨æˆ·é‡å®šå‘åˆ°å¯¹åº”çš„ç§»åŠ¨ç‰ˆç½‘é¡µ â€“ â€œå•å‘â€é‡å®šå‘</p>
<p>åœ¨ç§»åŠ¨ç”¨æˆ·ä»¥åŠæ¡Œé¢è®¾å¤‡ç”¨æˆ·åˆ†åˆ«è®¿é—®æ¡Œé¢ç‰ˆç½‘ç«™å’Œç§»åŠ¨ç½‘ç«™ä¸Šçš„ç½‘é¡µæ—¶ï¼Œå¯¹ä»–ä»¬è¿›è¡Œé‡å®šå‘ â€“â€œåŒå‘â€é‡å®šå‘</p>
<p><a href="https://developers.google.com/search/mobile-sites/mobile-seo/separate-urls#automatic-redirection" target="_blank" rel="noopener">https://developers.google.com/search/mobile-sites/mobile-seo/separate-urls#automatic-redirection</a></p>
<!--more-->


<h2 id="4-ç¼“å­˜Ajax"><a href="#4-ç¼“å­˜Ajax" class="headerlink" title="4. ç¼“å­˜Ajax"></a>4. ç¼“å­˜Ajax</h2><p>Ajax GETè¯·æ±‚ï¼Œå¯ä»¥ä½¿ç”¨å®¢æˆ·ç«¯ç¼“å­˜ï¼ˆè€Œä¸”åªè¦åœ°å€ä¸€æ ·ï¼Œå®ƒæ€»æ˜¯ä¼šä½¿ç”¨å®¢æˆ·ç«¯ç¼“å­˜ï¼‰</p>
<p>e.g: é‚®ç®±web,è¯·æ±‚é€šè®¯å½•æ•°æ®ï¼Œè¯·æ±‚æ—¶è¿”å›ç»“æœå¸¦ä¸Šé€šè®¯å½•æœ€åä¿®æ”¹çš„æ—¶é—´ã€‚åç»­è¯·æ±‚å¸¦ä¸Šè¯¥æ—¶é—´æˆ³&amp;t=xxxï¼Œè‹¥é€šè®¯å½•æ²¡æœ‰æ”¹å˜åˆ™è¯·æ±‚ç¼“å­˜ã€‚è‹¥é€šè®¯å½•åšäº†ä¿®æ”¹ï¼Œæ—¶é—´æˆ³æ”¹å˜ï¼Œåç»­è¯¥è¯·æ±‚æ–°çš„æ•°æ®.</p>
<p><strong>æ³¨æ„ï¼š</strong>å¯èƒ½åªé€‚ç”¨äºå•ç”¨æˆ·ï¼Œå¦‚è¿™è¾¹çš„é€šè®¯å½•æ•°æ®å¯ä»¥å¤šäººæ›´æ”¹çš„è¯ï¼Œå°±ä¸èƒ½ç¼“å­˜äº†</p>
<h2 id="5-å»¶è¿ŸåŠ è½½ç»„ä»¶"><a href="#5-å»¶è¿ŸåŠ è½½ç»„ä»¶" class="headerlink" title="5. å»¶è¿ŸåŠ è½½ç»„ä»¶"></a>5. å»¶è¿ŸåŠ è½½ç»„ä»¶</h2><p>ä¸æ¸²æŸ“é¡µé¢æ— å…³çš„å†…å®¹å¯ä»¥å¾€åã€‚</p>
<p>æ¯”å¦‚æ·˜å®é¦–é¡µï¼ŒæŠŠéå…³é”®æ¨¡å—æ”¾å…¥äº†æ‡’åŠ è½½é˜Ÿåˆ—ï¼Œæ»¡è¶³ä¸€å®šæ¡ä»¶çš„æ—¶å€™å†å»åŠ è½½ï¼Œå‚è€ƒï¼š<a href="http://taobaofed.org/blog/2016/04/06/optimize-in-tbhome#å…³é”®æ¨¡å—ä¼˜å…ˆ" target="_blank" rel="noopener">http://taobaofed.org/blog/2016/04/06/optimize-in-tbhome#å…³é”®æ¨¡å—ä¼˜å…ˆ</a></p>
<h2 id="6-é¢„åŠ è½½ç»„ä»¶"><a href="#6-é¢„åŠ è½½ç»„ä»¶" class="headerlink" title="6. é¢„åŠ è½½ç»„ä»¶"></a>6. é¢„åŠ è½½ç»„ä»¶</h2><p>åˆ©ç”¨æµè§ˆå™¨ç©ºé—²æ—¶é—´è¯·æ±‚ç”¨æˆ·æ¥ä¸‹æ¥å¯èƒ½ä¼šè®¿é—®çš„ç»„ä»¶ã€‚</p>
<ol>
<li>æ— æ¡ä»¶é¢„åŠ è½½ <blockquote>
<p>æ¯”å¦‚ï¼šæœç´¢ä¸»é¡µï¼Œé¢„åŠ è½½åé¢æœç´¢é¡µä¸€å®šä¼šå‡ºç°çš„èµ„æº</p>
</blockquote>
</li>
<li>æ¡ä»¶æ€§é¢„åŠ è½½<blockquote>
<p>çŒœæµ‹ç”¨æˆ·å°†è¦è·³è½¬åˆ°å“ªé‡Œå¹¶æ®æ­¤é¢„åŠ è½½ã€‚æ¯”å¦‚æ­£åœ¨å¡«å†™â€œæ·»åŠ è¡¨å•â€ï¼Œåé¢ä¼šè·³åˆ°è¡¨å•è¯¦æƒ…ï¼Œåˆ™å…ˆæŠŠè¡¨å•è¯¦æƒ…çš„èµ„æºæ‹¿åˆ°</p>
</blockquote>
</li>
<li>æå‰é¢„åŠ è½½<blockquote>
<p>æ¯”å¦‚æä¾›äº†ä¸€ä¸ªæ–°ç‰ˆç½‘ç«™å…¥å£ã€‚ç”¨æˆ·ä»æ—§ç‰ˆè½¬å‘æ–°ç‰ˆæ—¶ï¼Œèµ„æºéƒ½æ˜¯åˆæ¬¡åŠ è½½ï¼Œä¼šæ¯”è¾ƒæ…¢ã€‚æ­¤æ—¶å¯ä»¥é€‰æ‹©é¢„åŠ è½½</p>
</blockquote>
</li>
</ol>
<h2 id="7-å‡å°‘domå…ƒç´ æ•°é‡"><a href="#7-å‡å°‘domå…ƒç´ æ•°é‡" class="headerlink" title="7. å‡å°‘domå…ƒç´ æ•°é‡"></a>7. å‡å°‘domå…ƒç´ æ•°é‡</h2><p>åªåœ¨è¯­ä¹‰ä¸Šæœ‰æ„ä¹‰çš„æ—¶å€™ä½¿ç”¨<code>&lt;div&gt;</code>ï¼Œè€Œä¸æ˜¯å› ä¸ºå®ƒèƒ½å¤Ÿæ¸²æŸ“ä¸€ä¸ªæ–°è¡Œ</p>
<p>æŒ‰éœ€åŠ è½½</p>
<p><code>document.getElementsByTagName(&#39;*&#39;).length</code> æŸ¥çœ‹domå…ƒç´ æ•°é‡</p>
<h2 id="8-è·¨åŸŸåˆ†ç¦»ç»„ä»¶"><a href="#8-è·¨åŸŸåˆ†ç¦»ç»„ä»¶" class="headerlink" title="8. è·¨åŸŸåˆ†ç¦»ç»„ä»¶"></a>8. è·¨åŸŸåˆ†ç¦»ç»„ä»¶</h2><p>å¯ä»¥æœ€å¤§åŒ–å¹¶è¡Œä¸‹è½½ã€‚ä¸ <strong><code>2. å‡å°‘DNSæŸ¥æ‰¾</code></strong> ç»“åˆï¼Œä¸€èˆ¬ä¸è¶…è¿‡2-4ä¸ªåŸŸ</p>
<h2 id="9-å°½é‡å°‘ç”¨ï¼Œåˆç†ä½¿ç”¨iframe"><a href="#9-å°½é‡å°‘ç”¨ï¼Œåˆç†ä½¿ç”¨iframe" class="headerlink" title="9. å°½é‡å°‘ç”¨ï¼Œåˆç†ä½¿ç”¨iframe"></a>9. å°½é‡å°‘ç”¨ï¼Œåˆç†ä½¿ç”¨iframe</h2><p>ç¼ºç‚¹ï¼š</p>
<ol>
<li>ä»£ä»·é«˜ï¼Œå³ä½¿æ˜¯ç©ºç™½çš„iframe</li>
<li>æµè§ˆå™¨è¿”å›æŒ‰é’®å¤±æ•ˆ</li>
<li>å µå¡ä¸»é¡µé¢çš„onloadäº‹ä»¶ï¼Œ</li>
<li>ä¸ä¸»é¡µé¢å…±äº«è¿æ¥æ± ï¼Œè€Œæµè§ˆå™¨å¯¹ç›¸åŒåŸŸçš„è¿æ¥æœ‰é™åˆ¶ï¼Œæ‰€ä»¥ä¼šå½±å“é¡µé¢çš„å¹¶è¡ŒåŠ è½½</li>
</ol>
<p>ä¼˜ç‚¹ï¼š</p>
<ol>
<li>å¯ä»¥å¼•å…¥ç¼“æ…¢çš„ç¬¬ä¸‰æ–¹å†…å®¹ï¼Œå¦‚å¹¿å‘Š</li>
<li>iframeå¼•å…¥äº†å®‰å…¨æ²™ç®±ï¼Œå¯é¿å…å¼•å…¥çš„é¡µé¢å¯¹è‡ªå·±çš„é¡µé¢äº§ç”Ÿä¸åˆ©çš„å½±å“ã€‚æ¯”å¦‚é˜²æ­¢è®¿é—®çˆ¶é¡µé¢dom,é˜²æ­¢è¯»å†™cookieç­‰æ•°æ®</li>
</ol>
<p>å»ºè®®ï¼š</p>
<blockquote>
<p>å¦‚æœè¦ä½¿ç”¨iframe,é‡‡ç”¨åŠ¨æ€ç»™iframeæ·»åŠ srcå±æ€§å€¼çš„æ–¹å¼ï¼ˆjsè„šæœ¬æ”¾åœ¨bodyåº•éƒ¨ï¼‰ã€‚<br>å¯ä»¥é¿å…ä¸Šè¿°ç¼ºç‚¹çš„3å’Œ4</p>
</blockquote>
<h2 id="10-é¿å…404"><a href="#10-é¿å…404" class="headerlink" title="10. é¿å…404"></a>10. é¿å…404</h2><p>è¯·æ±‚ä¸å­˜åœ¨çš„è„šæœ¬æ–‡ä»¶ï¼Œå³ä½¿è¿”å›404ï¼Œä»ä¼šå»è§£æå“åº”å†…å®¹ï¼Œæ— ç–‘å¤šäº†å¾ˆå¤šå¤„ç†æ—¶é—´</p>
<h1 id="css-éƒ¨åˆ†"><a href="#css-éƒ¨åˆ†" class="headerlink" title="css éƒ¨åˆ†"></a>css éƒ¨åˆ†</h1><h2 id="11-é¿å…åœ¨cssä¸­ä½¿ç”¨è¡¨è¾¾å¼"><a href="#11-é¿å…åœ¨cssä¸­ä½¿ç”¨è¡¨è¾¾å¼" class="headerlink" title="11. é¿å…åœ¨cssä¸­ä½¿ç”¨è¡¨è¾¾å¼"></a>11. é¿å…åœ¨cssä¸­ä½¿ç”¨è¡¨è¾¾å¼</h2><p>è¿ç®—å¤šæ¬¡ï¼Œæ€§èƒ½æ¶ˆè€—å¤§ã€‚</p>
<p>ç°ä»£æµè§ˆå™¨å·²ä¸æ”¯æŒäº†ï¼Œæ— éœ€äº†è§£ã€‚</p>
<h2 id="12-ä½¿ç”¨linkè€Œä¸æ˜¯-importå¯¼å…¥æ ·å¼è¡¨"><a href="#12-ä½¿ç”¨linkè€Œä¸æ˜¯-importå¯¼å…¥æ ·å¼è¡¨" class="headerlink" title="12. ä½¿ç”¨linkè€Œä¸æ˜¯@importå¯¼å…¥æ ·å¼è¡¨"></a>12. ä½¿ç”¨linkè€Œä¸æ˜¯@importå¯¼å…¥æ ·å¼è¡¨</h2><p>ä½¿ç”¨æ›´åŠ æ ‡å‡†çš„linkæ ‡è®°ï¼Œè€Œä¸æ˜¯ä½¿ç”¨IEä¸“ç”¨çš„@importè¯­å¥</p>
<h2 id="13-é¿å…ä½¿ç”¨Filters-æ»¤é•œ"><a href="#13-é¿å…ä½¿ç”¨Filters-æ»¤é•œ" class="headerlink" title="13. é¿å…ä½¿ç”¨Filters(æ»¤é•œ)"></a>13. é¿å…ä½¿ç”¨Filters(æ»¤é•œ)</h2><p>æ»¤é•œä¼šé˜»å¡æ¸²æŸ“ï¼Œå½±å“æ€§èƒ½ã€‚</p>
<p>ç°ä»£æµè§ˆå™¨å·²ä¸æ”¯æŒäº†ï¼Œæ— éœ€äº†è§£ã€‚</p>
<h2 id="14-æŠŠæ ·å¼è¡¨æ”¾åœ¨é¡¶éƒ¨"><a href="#14-æŠŠæ ·å¼è¡¨æ”¾åœ¨é¡¶éƒ¨" class="headerlink" title="14. æŠŠæ ·å¼è¡¨æ”¾åœ¨é¡¶éƒ¨"></a>14. æŠŠæ ·å¼è¡¨æ”¾åœ¨é¡¶éƒ¨</h2><p>ä¹‹æ‰€ä»¥æ”¾åœ¨é¡¶éƒ¨ï¼Œæ˜¯ä¸ºäº†èƒ½è®©é¡µé¢é€æ­¥æ¸²æŸ“ï¼ˆæ¸è¿›å¼å‘ˆç°ï¼ˆrender progressivelyï¼‰ï¼‰</p>
<h1 id="jséƒ¨åˆ†"><a href="#jséƒ¨åˆ†" class="headerlink" title="jséƒ¨åˆ†"></a>jséƒ¨åˆ†</h1><h2 id="15-å»é™¤é‡å¤è„šæœ¬"><a href="#15-å»é™¤é‡å¤è„šæœ¬" class="headerlink" title="15. å»é™¤é‡å¤è„šæœ¬"></a>15. å»é™¤é‡å¤è„šæœ¬</h2><h2 id="16-å°½é‡å‡å°‘DOMè®¿é—®"><a href="#16-å°½é‡å‡å°‘DOMè®¿é—®" class="headerlink" title="16. å°½é‡å‡å°‘DOMè®¿é—®"></a>16. å°½é‡å‡å°‘DOMè®¿é—®</h2><ol>
<li>ç¼“å­˜å·²è®¿é—®è¿‡çš„domå…ƒç´ </li>
<li>ä¸€æ‰¹èŠ‚ç‚¹æ“ä½œï¼Œä¸ç”¨ä¸€ä¸ªä¸€ä¸ªçš„åœ¨domæ ‘ä¸Šæ“ä½œï¼Œåº”è¯¥ä¸€èµ·æ“ä½œå®Œå†æ”¾domæ ‘ä¸Š</li>
<li>é¿å…jsç›´æ¥ä¿®æ”¹å¸ƒå±€ï¼Œè€Œæ˜¯ç”¨jsè®©èŠ‚ç‚¹é€‰æ‹©é¢„å®šä¹‰çš„å…¶ä»–csså¸ƒå±€ </li>
</ol>
<h2 id="17-è®¾è®¡â€œæ™ºèƒ½â€çš„äº‹ä»¶å¤„ç†ç¨‹åº"><a href="#17-è®¾è®¡â€œæ™ºèƒ½â€çš„äº‹ä»¶å¤„ç†ç¨‹åº" class="headerlink" title="17. è®¾è®¡â€œæ™ºèƒ½â€çš„äº‹ä»¶å¤„ç†ç¨‹åº"></a>17. è®¾è®¡â€œæ™ºèƒ½â€çš„äº‹ä»¶å¤„ç†ç¨‹åº</h2><p>ä¸¾ä¾‹ï¼šç›‘å¬AèŠ‚ç‚¹ä¸‹çš„10ä¸ªå­èŠ‚ç‚¹çš„ç‚¹å‡»äº‹ä»¶ã€‚åº”è¯¥æŠŠäº‹ä»¶å¤„ç†å™¨ç»‘å®šAèŠ‚ç‚¹è€Œä¸æ˜¯10ä¸ªèŠ‚ç‚¹å„è‡ªç»‘å®šã€‚</p>
<p>é€šè¿‡äº‹ä»¶å†’æ³¡è·çŸ¥å“ªä¸ªæŒ‰é’®æ˜¯äº‹ä»¶æº</p>
<p>è¿™æ ·åšç»´æŠ¤æ–¹ä¾¿ï¼ˆå–æ¶ˆç›‘å¬æ—¶åªè¦å–æ¶ˆä¸€å¤„ï¼‰ï¼Œæ€§èƒ½å¥½ï¼ˆåªæœ‰ä¸€ä¸ªäº‹ä»¶ç›‘å¬å™¨ï¼‰</p>
<h2 id="18-æŠŠè„šæœ¬æ”¾åœ¨åº•éƒ¨"><a href="#18-æŠŠè„šæœ¬æ”¾åœ¨åº•éƒ¨" class="headerlink" title="18. æŠŠè„šæœ¬æ”¾åœ¨åº•éƒ¨"></a>18. æŠŠè„šæœ¬æ”¾åœ¨åº•éƒ¨</h2><p>è„šæœ¬ä¼šå µå¡é¡µé¢çš„è§£æå’Œæ¸²æŸ“ã€‚</p>
<p>å¦‚æœè„šæœ¬ä¸å­˜åœ¨documentä¾èµ–ï¼Œåˆ™å¯ä»¥æ”¾åœ¨é¡µé¢åº•éƒ¨</p>
<h1 id="js-css"><a href="#js-css" class="headerlink" title="js,css"></a>js,css</h1><h2 id="19-å°†jså’Œcssä½œä¸ºå¤–éƒ¨æ–‡ä»¶å¼•ç”¨"><a href="#19-å°†jså’Œcssä½œä¸ºå¤–éƒ¨æ–‡ä»¶å¼•ç”¨" class="headerlink" title="19. å°†jså’Œcssä½œä¸ºå¤–éƒ¨æ–‡ä»¶å¼•ç”¨"></a>19. å°†jså’Œcssä½œä¸ºå¤–éƒ¨æ–‡ä»¶å¼•ç”¨</h2><p>ä¼˜ç‚¹ï¼š</p>
<ol>
<li>æé«˜å¤ç”¨æ€§</li>
<li>å¯ä»¥è¢«æµè§ˆå™¨ç¼“å­˜</li>
<li>æé«˜å¯ç»´æŠ¤æ€§</li>
</ol>
<p>ç¼ºç‚¹ï¼š<br>å¢åŠ é¢å¤–è¯·æ±‚</p>
<p>åœ¨ä¸‹é¢ä¸‰ç§æƒ…å†µä¸‹åº”è¯¥è€ƒè™‘ç›´æ¥åœ¨<strong>é¡µé¢ä¸­</strong>å®šä¹‰è„šæœ¬å’Œæ ·å¼ï¼š</p>
<ol>
<li>ä¸å¤ç”¨</li>
<li>é¡µé¢ä¸è¢«ç»å¸¸è®¿é—®</li>
<li>è„šæœ¬å’Œæ ·å¼å¾ˆå°‘</li>
</ol>
<h2 id="20-å‹ç¼©JAVASCRIPTå’ŒCSS"><a href="#20-å‹ç¼©JAVASCRIPTå’ŒCSS" class="headerlink" title="20. å‹ç¼©JAVASCRIPTå’ŒCSS"></a>20. å‹ç¼©JAVASCRIPTå’ŒCSS</h2><p>å‹ç¼©ï¼Œæ··æ·†ã€‚</p>
<h1 id="å›¾ç‰‡"><a href="#å›¾ç‰‡" class="headerlink" title="å›¾ç‰‡"></a>å›¾ç‰‡</h1><h2 id="21-ä¼˜åŒ–å›¾ç‰‡"><a href="#21-ä¼˜åŒ–å›¾ç‰‡" class="headerlink" title="21. ä¼˜åŒ–å›¾ç‰‡"></a>21. ä¼˜åŒ–å›¾ç‰‡</h2><p>gifé‡‡ç”¨<code>&lt;video&gt;</code>å®ç°</p>
<p>å›¾ç‰‡ç»§ç»­å‹ç¼©</p>
<h2 id="22-ä¼˜åŒ–-CSS-Sprite"><a href="#22-ä¼˜åŒ–-CSS-Sprite" class="headerlink" title="22. ä¼˜åŒ– CSS Sprite"></a>22. ä¼˜åŒ– CSS Sprite</h2><p>åœ¨<code>1.å°½é‡å‡å°‘HTTPè¯·æ±‚æ•°</code>ä¸­æåˆ°çš„æŠ€æœ¯ã€‚</p>
<p>é€šè¿‡background-imageå’Œbackground-positionå±æ€§æ¥å®šä½è¦æ˜¾ç¤ºçš„éƒ¨åˆ†</p>
<p>è¯¥æŠ€æœ¯çš„æ³¨æ„ç‚¹ï¼š</p>
<ol>
<li>é€‰ç”¨<a href="https://www.toptal.com/developers/css/sprite-generator" target="_blank" rel="noopener">å·¥å…·</a>å®Œæˆå›¾ç‰‡åˆå¹¶ï¼Œçœå»äººå·¥æµ‹é‡åƒç´ ä½ç½®</li>
<li>é¢å¤–ç»´æŠ¤å·¥ä½œï¼šæŸå›¾ç‰‡ä¿®æ”¹äº†ï¼Œä¸ä»…éœ€è¦ç”Ÿæˆæ–°çš„å›¾ç‰‡ï¼Œè¿˜æ¶‰åŠcssçš„ä¿®æ”¹</li>
<li>ä¸€èˆ¬åªèƒ½ä½¿ç”¨å›ºå®šå¤§å°çš„ç›’å­ï¼Œè¿™æ ·æ‰èƒ½å¤Ÿé®æŒ¡ä½ä¸åº”è¯¥çœ‹åˆ°çš„éƒ¨åˆ†</li>
</ol>
<p>å‡ ä¸ªä¼˜åŒ–å»ºè®®ï¼š</p>
<ol>
<li>å°½å¯èƒ½ä½¿ç”¨æ¨ªå‘ç»„åˆå›¾ç‰‡ï¼Œè¿™æ¯”çºµå‘ç»„åˆå›¾ç‰‡çš„ä½“ç§¯é€šå¸¸æ›´å°ä¸€ç‚¹</li>
<li>å°½é‡ä½¿å›¾ç‰‡å…·æœ‰æ¥è¿‘çš„è‰²ç³»ï¼Œè¿™æ ·æœ€ç»ˆç»„åˆå‡ºæ¥çš„å›¾ç‰‡ä¹Ÿä¼šå°ä¸€äº›ã€‚</li>
<li>å°½é‡ä½¿ç”¨å°ä¸€äº›çš„å›¾ç‰‡ï¼Œå¹¶ä¸”å›¾ç‰‡ä¹‹é—´çš„é—´éš™å°½é‡ä¹Ÿå°ä¸€äº›ï¼Œç›®çš„è¿˜æ˜¯ä¸ºäº†æœ€ç»ˆç»„åˆå‡ºæ¥çš„å›¾ç‰‡ä½“ç§¯æ›´å°</li>
</ol>
<h2 id="23-ä¸è¦åœ¨é¡µé¢ä¸­ç¼©æ”¾å›¾ç‰‡"><a href="#23-ä¸è¦åœ¨é¡µé¢ä¸­ç¼©æ”¾å›¾ç‰‡" class="headerlink" title="23. ä¸è¦åœ¨é¡µé¢ä¸­ç¼©æ”¾å›¾ç‰‡"></a>23. ä¸è¦åœ¨é¡µé¢ä¸­ç¼©æ”¾å›¾ç‰‡</h2><p>ä¸è¦å› ä¸ºhtmlæœ¬èº«å¯ä»¥è®¾ç½®å®½é«˜æ¥ä½¿ç”¨<strong>æœ¬ä¸éœ€è¦çš„å¤§å›¾</strong>ï¼Œ</p>
<p>è‹¥éœ€è¦<code>&lt;img width=&quot;100&quot; height=&quot;100&quot; src=&quot;mycat.jpg&quot; alt=&quot;My Cat&quot; /&gt;</code></p>
<p>é‚£ä¹ˆå›¾ç‰‡æœ¬èº«åº”è¯¥æ˜¯100x100 pxçš„ï¼Œè€Œä¸æ˜¯å»ç¼©æ”¾500x500 pxã€‚</p>
<p>è¯·è®°ä½å¹¶éµå®ˆè¿™æ¡åŸåˆ™ï¼šä½ éœ€è¦åœ¨ç½‘é¡µä¸­æ˜¾ç¤ºä»€ä¹ˆå°ºå¯¸çš„å›¾ç‰‡ï¼Œå°±è¯·å›¾ç‰‡è®¾è®¡äººå‘˜æä¾›ä»€ä¹ˆå°ºå¯¸çš„å›¾ç‰‡ï¼Œè€Œä¸æ˜¯åœ¨ç½‘é¡µä¸­è¿›è¡Œç¼©æ”¾ã€‚</p>
<h2 id="24-ä½¿favicon-icoå°½å¯èƒ½å°å¹¶å¯ç¼“å­˜"><a href="#24-ä½¿favicon-icoå°½å¯èƒ½å°å¹¶å¯ç¼“å­˜" class="headerlink" title="24. ä½¿favicon.icoå°½å¯èƒ½å°å¹¶å¯ç¼“å­˜"></a>24. ä½¿favicon.icoå°½å¯èƒ½å°å¹¶å¯ç¼“å­˜</h2><p><strong>æ³¨æ„ï¼š</strong>å³ä¾¿ä½ ä¸ç®¡å®ƒï¼Œæµè§ˆå™¨ä¹Ÿä¼šè‡ªåŠ¨è¯·æ±‚å®ƒï¼Œå¯¼è‡´å‡ºç°404ã€‚æ”¾åœ¨</p>
<p>å»ºè®®ï¼š</p>
<ol>
<li>1KBå·¦å³ï¼Œç™¾åº¦ï¼šåœ¨çº¿favicon.iconåˆ¶ä½œ</li>
<li>å¯ç¼“å­˜</li>
<li>æ”¾åœ¨å…¶ä»–ä¸»æœºï¼Œé¿å…è¯·æ±‚æ—¶å¸¦ä¸Šcookie</li>
</ol>
<h1 id="cookie"><a href="#cookie" class="headerlink" title="cookie"></a>cookie</h1><h2 id="25-å‡å°Cookieçš„ä½“ç§¯"><a href="#25-å‡å°Cookieçš„ä½“ç§¯" class="headerlink" title="25. å‡å°Cookieçš„ä½“ç§¯"></a>25. å‡å°Cookieçš„ä½“ç§¯</h2><ol>
<li>è®¾ç½®åˆé€‚çš„æœ‰æ•ˆæœŸ</li>
<li>è®¾ç½®åˆé€‚çš„åŸŸçº§åˆ«</li>
<li>å°½å¯èƒ½å°</li>
</ol>
<h2 id="26-æŠŠç»„ä»¶æ”¾åœ¨ä¸å«cookieçš„åŸŸä¸‹"><a href="#26-æŠŠç»„ä»¶æ”¾åœ¨ä¸å«cookieçš„åŸŸä¸‹" class="headerlink" title="26. æŠŠç»„ä»¶æ”¾åœ¨ä¸å«cookieçš„åŸŸä¸‹"></a>26. æŠŠç»„ä»¶æ”¾åœ¨ä¸å«cookieçš„åŸŸä¸‹</h2><p>é¡µé¢è¯·æ±‚æŸä¸ªåŸŸæ—¶ï¼Œä¼šå¸¦ä¸Šè¯¥åŸŸçš„cookieï¼Œå¯¹äºä¸€äº›é™æ€èµ„æºï¼Œè¯¥cookieæ˜¯æ²¡æœ‰å¿…è¦å‘é€çš„ï¼Œæ­¤æ—¶å¯ä»¥æŠŠè¿™äº›é™æ€èµ„æºæ”¾åœ¨å¦å¤–çš„åŸŸä¸Šã€‚</p>
<p>é™¤äº†ä¸å¸¦cookie,è¿˜å¢åŠ äº†é¡µé¢èµ„æºçš„å¹¶å‘ä¸‹è½½</p>
<h1 id="ç§»åŠ¨ç«¯"><a href="#ç§»åŠ¨ç«¯" class="headerlink" title="ç§»åŠ¨ç«¯"></a>ç§»åŠ¨ç«¯</h1><h2 id="27-ä¿è¯å•ä¸ªå†…å®¹ä½“ç§¯ï¼œ25K"><a href="#27-ä¿è¯å•ä¸ªå†…å®¹ä½“ç§¯ï¼œ25K" class="headerlink" title="27. ä¿è¯å•ä¸ªå†…å®¹ä½“ç§¯ï¼œ25K"></a>27. ä¿è¯å•ä¸ªå†…å®¹ä½“ç§¯ï¼œ25K</h2><p>iOS safari æ—©æœŸç‰ˆæœ¬ï¼ˆv3.2ï¼‰ ä¸èƒ½ç¼“å­˜è¶…è¿‡25Kï¼ˆæœªå‹ç¼©å¤§å°ï¼‰çš„ç»„ä»¶ã€‚ </p>
<p>ç°åœ¨ç‰ˆæœ¬åº”è¯¥èƒ½æ¯”è¾ƒå¤§äº†ï¼Œä¹Ÿä¸çŸ¥é“å…¶ä»–æµè§ˆå™¨æ”¯æŒçš„éƒ½å¤šå¤§= =</p>
<p>ä¸è¿‡ï¼Œæ€»çš„æ¥è¯´<strong>20. å‹ç¼©JAVASCRIPTå’ŒCSS</strong>æ˜¯å¿…è¦çš„</p>
<h2 id="28-å°†ç»„ä»¶ç›´æ¥æ‰“åŒ…åˆ°é¡µé¢"><a href="#28-å°†ç»„ä»¶ç›´æ¥æ‰“åŒ…åˆ°é¡µé¢" class="headerlink" title="28. å°†ç»„ä»¶ç›´æ¥æ‰“åŒ…åˆ°é¡µé¢"></a>28. å°†ç»„ä»¶ç›´æ¥æ‰“åŒ…åˆ°é¡µé¢</h2><p>ä¾‹å­ï¼š</p>
<ol>
<li>CSSä¸­è¿˜æœ‰å°å›¾ç‰‡çš„è¯·æ±‚ï¼Œå¯ä»¥ç›´æ¥æŠŠå°å›¾ç‰‡base64åŒ–æ›¿æ¢è¯¥cssæ ·å¼çš„å›¾ç‰‡url</li>
<li>é‚®ä»¶å†…å®¹å¸¦å›¾ç‰‡ï¼Œè¿™ç§å›¾ç‰‡ä¹Ÿæ˜¯ä½œä¸ºæ­£æ–‡çš„ä¸€éƒ¨åˆ†è¢«ç¼–ç è¿›å»çš„ï¼Œæ— éœ€æ–°è¯·æ±‚</li>
</ol>
<h1 id="æœåŠ¡å™¨"><a href="#æœåŠ¡å™¨" class="headerlink" title="æœåŠ¡å™¨"></a>æœåŠ¡å™¨</h1><h2 id="29-Gzipç»„ä»¶"><a href="#29-Gzipç»„ä»¶" class="headerlink" title="29. Gzipç»„ä»¶"></a>29. Gzipç»„ä»¶</h2><p>è¯·æ±‚å¤´ä¸­å¸¦æœ‰å¦‚ä¸‹ä¿¡æ¯</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Accept-Encoding: gzip, deflate</span><br></pre></td></tr></table></figure>
<p>è¿™æ˜¯æ ¹æ®æµè§ˆå™¨çš„è®¾ç½®å†³å®šçš„,è¡¨ç¤ºæµè§ˆå™¨æ¥å—çš„å‹ç¼©æ ¼å¼ã€‚</p>
<p>webæœåŠ¡å™¨é€šè¿‡Content-Encodingç›¸åº”å¤´æ¥é€šçŸ¥å®¢æˆ·ç«¯æ•°æ®é‡‡ç”¨äº†å“ªç§å‹ç¼©æ–¹å¼ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Content-Encoding: gzip</span><br></pre></td></tr></table></figure>
<h2 id="30-é¿å…å°†imgçš„srcå±æ€§è®¾ç½®ä¸ºç©º"><a href="#30-é¿å…å°†imgçš„srcå±æ€§è®¾ç½®ä¸ºç©º" class="headerlink" title="30. é¿å…å°†imgçš„srcå±æ€§è®¾ç½®ä¸ºç©º"></a>30. é¿å…å°†imgçš„srcå±æ€§è®¾ç½®ä¸ºç©º</h2><p>æ—©æœŸæµè§ˆå™¨ä»ä¼šå‘é€è¯·æ±‚ï¼Œç°ä»£æµè§ˆå™¨ä¸ä¼šå‘äº†ã€‚</p>
<p>è®¾ç½®ä¸ºç©ºï¼Œæœ¬æ„å¯èƒ½æ˜¯æƒ³å…ˆä¸åŠ è½½ï¼Œç­‰é¡µé¢è§£æå®Œå†ç”¨jså»è®¾ç½®imgçš„srcã€‚</p>
<p>åº”è¯¥é‡‡å–æ›´å¥½çš„å®ç°æ–¹å¼ï¼šImageLoader</p>
<h2 id="31-é…ç½®ETags"><a href="#31-é…ç½®ETags" class="headerlink" title="31. é…ç½®ETags"></a>31. é…ç½®ETags</h2><p>ETags æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä½œä¸ºæŸç»„ä»¶æŸç‰ˆæœ¬çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚</p>
<p>æœåŠ¡å™¨å“åº”ç»„ä»¶èµ„æºæ—¶ï¼Œå¸¦ä¸ŠETagså“åº”å¤´ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">HTTP&#x2F;1.1 200 OK</span><br><span class="line">Last-Modified: Tue, 12 Dec 2006 03:03:59 GMT</span><br><span class="line">ETag: &quot;10c24bc-4ab-457e1c1f&quot;</span><br><span class="line">Content-Length: 12195</span><br></pre></td></tr></table></figure>

<p>æµè§ˆå™¨ç»§ç»­è¯·æ±‚ç»„ä»¶æ—¶ï¼Œä¼šç”¨If-None-Matchè¯·æ±‚å¤´æ¥æŠŠETagä¼ å›æºæœåŠ¡å™¨ã€‚å¦‚æœåŒ¹é…æˆåŠŸï¼Œè¿”å›304ï¼Œå°±å‡å°‘äº†12195å­—èŠ‚çš„å“åº”</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">GET &#x2F;i&#x2F;yahoo.gif HTTP&#x2F;1.1</span><br><span class="line">      Host: us.yimg.com</span><br><span class="line">      If-Modified-Since: Tue, 12 Dec 2006 03:03:59 GMT</span><br><span class="line">      If-None-Match: &quot;10c24bc-4ab-457e1c1f&quot;</span><br><span class="line">      HTTP&#x2F;1.1 304 Not Modified</span><br></pre></td></tr></table></figure>

<h2 id="32-å¯¹Ajaxç”¨GETè¯·æ±‚"><a href="#32-å¯¹Ajaxç”¨GETè¯·æ±‚" class="headerlink" title="32. å¯¹Ajaxç”¨GETè¯·æ±‚"></a>32. å¯¹Ajaxç”¨GETè¯·æ±‚</h2><p>æ¨èç”¨GETè¯·æ±‚çš„åŸå› ï¼š</p>
<ol>
<li>GETè¯·æ±‚èƒ½åˆ©ç”¨å®¢æˆ·ç«¯çš„ç¼“å­˜</li>
<li>POSTè¯·æ±‚è¿›è¡Œäº†ä¸¤æ¬¡è¯·æ±‚ï¼šå…ˆå‘é€è¯·æ±‚å¤´å†å‘é€æ•°æ®</li>
</ol>
<p>ä½†æ˜¯ï¼Œé•¿åº¦æ–¹é¢å¯èƒ½ä¼šæœ‰é™åˆ¶ã€‚</p>
<p>è¯­ä¹‰ä¸æ˜“ç†è§£ï¼Œè¿èƒŒRESTfulåŸåˆ™</p>
<h2 id="33-å°½æ—©å‘é€ç¼“å†²åŒºå†…å®¹"><a href="#33-å°½æ—©å‘é€ç¼“å†²åŒºå†…å®¹" class="headerlink" title="33. å°½æ—©å‘é€ç¼“å†²åŒºå†…å®¹"></a>33. å°½æ—©å‘é€ç¼“å†²åŒºå†…å®¹</h2><p>åå°æœåŠ¡å™¨è¿˜åœ¨ç»„è£…htmlé¡µé¢çš„æ—¶å€™ï¼Œå…ˆå‘ä¸€éƒ¨åˆ†åˆ°ç»™æµè§ˆå™¨ï¼Œä¸€èˆ¬æ˜¯headä¹‹åã€‚è¿™æ ·æµè§ˆå™¨ç«¯å¯ä»¥å…ˆå»åŠ è½½headä¸­æŒ‡å®šçš„èµ„æº å’Œé¡µé¢çš„å‰©ä½™éƒ¨åˆ†åŠ è½½æ˜¯å¹¶è¡Œçš„ã€‚</p>
<p>å½“å“åº”è€—æ—¶ä¸»è¦åœ¨åå°çš„åŠ¨æ€é¡µé¢ç»„è£…æ—¶ï¼Œæœ€èƒ½ä½“ç°ä¼˜åŠ¿</p>
<p>å…·ä½“å®ç°æŠ€æœ¯åº”è¯¥æ˜¯åŠ¨æ€ç½‘é¡µç›¸å…³çš„ï¼Œæš‚æ—¶ä¸æ˜¯å¾ˆç†è§£ï¼Œè¿™è¾¹å…ˆç•™ä¸ªå‘ã€‚</p>
<h2 id="34-ä½¿ç”¨CDN"><a href="#34-ä½¿ç”¨CDN" class="headerlink" title="34. ä½¿ç”¨CDN"></a>34. ä½¿ç”¨CDN</h2><p><a href="http://www.wangsu.com/" target="_blank" rel="noopener">ç½‘å®¿ç§‘æŠ€</a>äº†è§£ä¸€ä¸‹</p>
<h2 id="35-æ·»ä¸ŠExpiresæˆ–è€…Cache-Control-HTTPå¤´"><a href="#35-æ·»ä¸ŠExpiresæˆ–è€…Cache-Control-HTTPå¤´" class="headerlink" title="35. æ·»ä¸ŠExpiresæˆ–è€…Cache-Control HTTPå¤´"></a>35. æ·»ä¸ŠExpiresæˆ–è€…Cache-Control HTTPå¤´</h2><p><del>éœ€è¦æ€»ç»“ä¸‹ç¼“å­˜æ§åˆ¶çš„ç”¨æ³•ã€‚è¿™è¾¹å…ˆç•™ä¸ªå‘</del></p>
<p>è¿™ä¸¤ä¸ªéƒ½æ˜¯ç”¨äºå¼ºç¼“å­˜(200 form cache)çš„ï¼Œ</p>
<blockquote>
<p>Cache-Control:ç¼“å­˜æ—¶é—´å€¼<br>Expires:ç»å¯¹æ—¶é—´<br>åŒæ—¶å­˜åœ¨æ—¶ï¼Œ<code>Cache-Control</code> ä¼˜å…ˆäº<code>Expires</code>ï¼Œä½¿ç”¨<code>Cache-Control</code>çš„ä¸€ä¸ªå¥½å¤„æ˜¯ä¸ç”¨æ‹…å¿ƒæœåŠ¡ç«¯æ—¶é—´å’Œæœ¬åœ°æ—¶é—´ä¸ä¸€è‡´</p>
</blockquote>
<p>è¿™ç¯‡æ€»ç»“çš„è¿˜è¡Œï¼š<a href="https://www.cnblogs.com/wonyun/p/5524617.html" target="_blank" rel="noopener">httpåå•†ç¼“å­˜VSå¼ºç¼“å­˜</a></p>
<p>è¿™é‡Œè¡¥å……ä¸¤ç‚¹ï¼š</p>
<ol>
<li>æµè§ˆå™¨å¼€å‘è€…å·¥å…·å¼€å¯ <strong>Disable cache</strong>åï¼Œä»»ä½•è¯·æ±‚éƒ½ä¸ä¼šèµ°æœ¬åœ°å¼ºç¼“å­˜ï¼Œä½†æ˜¯ä¼šèµ°304åå•†ç¼“å­˜ï¼ˆå¼ºåˆ¶åˆ·æ–°é™¤å¤–ï¼‰</li>
<li>æœªå¼€å¯<strong>Disable cache</strong>çš„çŠ¶æ€ä¸‹ï¼Œctrl+F5å¼ºåˆ¶åˆ·æ–°ï¼Œå¯¹äº<code>page load</code>å‰çš„è¯·æ±‚ï¼Œéƒ½æ˜¯ä¸èµ°ç¼“å­˜(å¼ºç¼“å­˜å’Œåå•†ç¼“å­˜<code>cache-control:no-cache</code>)çš„ï¼Œä½†æ˜¯<code>page load</code>åçš„è¯·æ±‚ä¸å—é™åˆ¶å¯ä»¥èµ°ç¼“å­˜</li>
</ol>
<h1 id="å…¶ä»–æ–°æŠ€æœ¯"><a href="#å…¶ä»–æ–°æŠ€æœ¯" class="headerlink" title="å…¶ä»–æ–°æŠ€æœ¯"></a>å…¶ä»–æ–°æŠ€æœ¯</h1><h2 id="DNSé¢„è§£æ-dns-prefetch"><a href="#DNSé¢„è§£æ-dns-prefetch" class="headerlink" title="DNSé¢„è§£æ-dns-prefetch"></a>DNSé¢„è§£æ-dns-prefetch</h2><p>è§ <code>W3C_DNS_Prefetching.md</code></p>
<h1 id="åè®°"><a href="#åè®°" class="headerlink" title="åè®°"></a>åè®°</h1><p>ä»¥ä¸Šå†…å®¹åªæ˜¯å¯¹35ä¼˜åŒ–åŸåˆ™çš„ç®€å•è®°å½•å’Œä¸ªäººè§è§£ï¼Œéè¯‘æ–‡ã€‚</p>
<p>yahooåŸæ–‡ï¼š<a href="https://developer.yahoo.com/performance/rules.html" target="_blank" rel="noopener">https://developer.yahoo.com/performance/rules.html</a></p>
<p>åˆ†äº«å‡ ç¯‡å†™çš„ä¸é”™çš„ï¼š</p>
<ol>
<li><a href="https://www.cnblogs.com/xianyulaodi/p/5755079.html" target="_blank" rel="noopener">é›…è™å‰ç«¯ä¼˜åŒ–çš„35æ¡å†›è§„</a></li>
<li><a href="http://www.cnblogs.com/chenxizhang/archive/2013/05/20/3088196.html" target="_blank" rel="noopener">ä¼˜åŒ–ç½‘ç«™è®¾è®¡ç³»åˆ—æ–‡ç« æ€»ç»“å’Œå¯¼è¯»</a></li>
</ol>
]]></content>
      <categories>
        <category>å¤§å‰ç«¯</category>
      </categories>
      <tags>
        <tag>å‰ç«¯ä¼˜åŒ–</tag>
      </tags>
  </entry>
  <entry>
    <title>log4jsé…ç½®è¯¦è§£</title>
    <url>/2018/04/14/2018Q2/log4js%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>log4js ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å‡ é¡¹é…ç½®</p>
<a id="more"></a>

<h2 id="Appender"><a href="#Appender" class="headerlink" title="Appender"></a>Appender</h2><p>è´Ÿè´£æ—¥å¿—è®°å½•çš„æ–¹å¼ï¼šæ–‡ä»¶ã€æ§åˆ¶å°è¾“å‡ºã€ç½‘ç»œå‘é€ã€é‚®ä»¶å‘é€</p>
<p>å¸¸ç”¨æ–¹å¼ï¼šconsole,file,dataFile</p>
<p>REF: <a href="https://blog.csdn.net/hfty290/article/details/42844085" target="_blank" rel="noopener">https://blog.csdn.net/hfty290/article/details/42844085</a></p>
<ol>
<li>type:â€consoleâ€</li>
</ol>
<p>å°†æ—¥å¿—è¾“å‡ºè‡³æ§åˆ¶å°ï¼Œè¿™æ ·å¯ä»¥æ–¹ä¾¿å¼€å‘äººå‘˜åœ¨å¼€å‘æ—¶æ¥çœ‹åˆ°æ‰€æœ‰æ—¥å¿—ä¿¡æ¯ï¼Œåœ¨å…¶ä»–ç¯å¢ƒä¸å»ºè®®è®¾ç½®</p>
<ol start="2">
<li>type:â€fileâ€</li>
</ol>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&quot;filename&quot;: &quot;log&#x2F;access.log&quot;,</span><br><span class="line">&quot;maxLogSize &quot;: 31457280,&#x2F;&#x2F;è®¾ç½®æ–‡ä»¶å¤§å°ï¼Œå½“è¾¾åˆ°æœ€å¤§å®¹é‡ï¼Œé‡å‘½åæ–‡ä»¶ä¸ºaccess.log.1ï¼Œæ—¥å¿—å†™å…¥æ–°æ–‡ä»¶access.log</span><br><span class="line">&quot;backups&quot;:1,&#x2F;&#x2F;æœ€å¤šäº§ç”Ÿçš„æ–‡ä»¶å¤‡ä»½æ•°ï¼Œè¶…è¿‡ä¼šåˆ é™¤</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>type:â€dateFileâ€</li>
</ol>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&quot;filename&quot;: &quot;log&#x2F;app-info.log&quot;,</span><br><span class="line">&quot;pattern&quot;: &quot;.yyyy-MM-dd&quot;,&#x2F;&#x2F;e.g.:app-info.log.2018-04-18</span><br><span class="line">&quot;alwaysIncludePattern&quot;:false&#x2F;&#x2F;å¦‚æœä¸ºtrueï¼Œåˆ™æ¯ä¸ªæ–‡ä»¶éƒ½ä¼šæŒ‰patternå‘½åï¼Œå¦åˆ™æœ€æ–°çš„æ–‡ä»¶ä¸ä¼šæŒ‰ç…§patternå‘½å</span><br><span class="line">&quot;compress&quot;:false,æ˜¯å¦å‹ç¼©ï¼Œä¹‹å‰çš„æ–‡ä»¶ä¼šè¢«å‹ç¼©</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>type:â€logLevelFilterâ€</li>
</ol>
<p>ç»§ç»­é…ç½®appender ä¼šç»§æ‰¿AppenderNameçš„æ‰€æœ‰è®¾ç½®å¹¶åœ¨å…¶ä¸Šåšlevelçš„è¿‡æ»¤</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&quot;appender&quot;: &quot;AppenderName&quot;,</span><br><span class="line">&quot;level&quot;: &quot;error&quot;</span><br></pre></td></tr></table></figure>

<h3 id="layout"><a href="#layout" class="headerlink" title="layout"></a>layout</h3><p>å®šä¹‰æ—¥å¿—è®°å½•æ ¼å¼ï¼šå“ªäº›å­—æ®µï¼Œé¢œè‰²ç­‰</p>
<h3 id="level-maxLevel"><a href="#level-maxLevel" class="headerlink" title="level,maxLevel"></a>level,maxLevel</h3><p>å½“ <code>let log=log4js.getLogger(name)</code> å¾—åˆ°çš„ Category åï¼Œæœ‰ä¸€ä¸ª appender åˆ—è¡¨ï¼Œ<br>log è®°å½•çš„æ–¹å¼ï¼Œå¦‚ <code>log.warn/log.error</code> ,ä¼šåœ¨ appender åˆ—è¡¨ä¸­ç»§ç»­è¿‡æ»¤ï¼Œå–æ»¡è¶³ <code>[level,maxLevel]</code> çš„ level çš„ appender</p>
<p>è‹¥æœªè®¾ç½®ï¼Œé»˜è®¤ all</p>
<h2 id="Category"><a href="#Category" class="headerlink" title="Category"></a>Category</h2><p>é…ç½®æ—¥å¿—çš„ç±»åˆ«ï¼Œå¯ä»¥é…ç½®ä¸€ä¸ªAppenderæ•°ç»„ï¼Œè¡¨ç¤ºå½“å‰ç±»åˆ«æ—¥å¿—ä¼šé€šè¿‡å…¶Appenderæ•°ç»„çš„æ¯ç§æ–¹å¼è¢«è®°å½•ï¼Œ<br>å¯ä»¥é…ç½®ä¸€ä¸ªlevelå±æ€§ï¼Œè¡¨ç¤ºä¼ å…¥çš„æ—¥å¿—çš„leveléœ€è¦åœ¨å…¶é…ç½®çš„levelåŠä¹‹ä¸Šæ‰ä¼šè¢«è®°å½•</p>
<p>Appender å’Œ Category çš„å…³ç³»ï¼š<code>Category &lt;--- 1ï¼šn ---&gt; Appender</code></p>
<p>Category å¯ä»¥é…ç½®ä¸€ä¸ªdefaultï¼Œå½“log4js.getLogger(name)çš„nameä¸åœ¨Categoryé…ç½®ä¸­å°±èµ°default,å¦‚æœæ²¡æœ‰é…ç½®è¯¥defaultï¼Œ<strong>nameä¹Ÿä¸åœ¨Categoryé…ç½®ä¸­ï¼Œä¼šèµ°æ‰€æœ‰Appender</strong></p>
<p>Categoryä¸­å¯ä»¥ç›´æ¥é…ç½®level æˆ–è€…log4js.getLogger(name).setLevel(log4js.levels.INFO)è¿™æ ·é…ç½®</p>
<h2 id="replaceConsole"><a href="#replaceConsole" class="headerlink" title="replaceConsole"></a>replaceConsole</h2><p>é»˜è®¤false,å¦‚æœä¸ºtrueï¼Œåˆ™ç¨‹åºä¸­ç”¨console.logè¾“å‡ºåˆ°æ§åˆ¶å°çš„ä¿¡æ¯ï¼Œä¹Ÿä¼šè¾“å‡ºåˆ°æ—¥å¿—æ–‡ä»¶ä¸­ï¼Œä¸”æ ¼å¼æŒ‰ç…§log4jsçš„æ ¼å¼è¾“å‡ºï¼Œå¦‚æœä¸ºfalseï¼Œåˆ™console.logåªä¼šè¾“å‡ºåœ¨æ§åˆ¶å°ã€‚ä¸type:consoleçš„appenderæ­£å¥½ç›¸åï¼Œå¦‚æœè®¾ç½®äº†type:consoleï¼Œåˆ™ä¼šå°†log4js.logæ—¥å¿—è¾“å‡ºè‡³æ§åˆ¶å°ã€‚</p>
<h2 id="level"><a href="#level" class="headerlink" title="level"></a>level</h2><p>ä»ä½åˆ°é«˜ï¼šALL,TRACE,DEBUG,INFO,WARN,ERROR,FATAL,OFF</p>
<h2 id="DEMO"><a href="#DEMO" class="headerlink" title="DEMO"></a>DEMO</h2><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"appenders"</span>: &#123;</span><br><span class="line">    <span class="attr">"console"</span>: &#123;</span><br><span class="line">      <span class="attr">"type"</span>: <span class="string">"console"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"trace"</span>: &#123;</span><br><span class="line">      <span class="attr">"type"</span>: <span class="string">"file"</span>,</span><br><span class="line">      <span class="attr">"filename"</span>: <span class="string">"log/access.log"</span>,</span><br><span class="line">      <span class="attr">"maxLogSize "</span>: <span class="number">31457280</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"http"</span>: &#123;</span><br><span class="line">      <span class="attr">"type"</span>: <span class="string">"logLevelFilter"</span>,</span><br><span class="line">      <span class="attr">"appender"</span>: <span class="string">"trace"</span>,</span><br><span class="line">      <span class="attr">"level"</span>: <span class="string">"trace"</span>,</span><br><span class="line">      <span class="attr">"maxLevel"</span>: <span class="string">"trace"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"info"</span>: &#123;</span><br><span class="line">      <span class="attr">"type"</span>: <span class="string">"dateFile"</span>,</span><br><span class="line">      <span class="attr">"filename"</span>: <span class="string">"log/app-info.log"</span>,</span><br><span class="line">      <span class="attr">"pattern"</span>: <span class="string">".yyyy-MM-dd"</span>,</span><br><span class="line">      <span class="attr">"layout"</span>: &#123;</span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"pattern"</span>,</span><br><span class="line">        <span class="attr">"pattern"</span>: <span class="string">"[%d&#123;ISO8601&#125;][%5p  %z  %c] %m"</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">"compress"</span>: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"maxInfo"</span>: &#123;</span><br><span class="line">      <span class="attr">"type"</span>: <span class="string">"logLevelFilter"</span>,</span><br><span class="line">      <span class="attr">"appender"</span>: <span class="string">"info"</span>,</span><br><span class="line">      <span class="attr">"level"</span>: <span class="string">"debug"</span>,</span><br><span class="line">      <span class="attr">"maxLevel"</span>: <span class="string">"info"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"error"</span>: &#123;</span><br><span class="line">      <span class="attr">"type"</span>: <span class="string">"dateFile"</span>,</span><br><span class="line">      <span class="attr">"filename"</span>: <span class="string">"log/app-error.log"</span>,</span><br><span class="line">      <span class="attr">"pattern"</span>: <span class="string">".yyyy-MM-dd"</span>,</span><br><span class="line">      <span class="attr">"layout"</span>: &#123;</span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"pattern"</span>,</span><br><span class="line">        <span class="attr">"pattern"</span>: <span class="string">"[%d&#123;ISO8601&#125;][%5p  %z  %c] %m"</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">"compress"</span>: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"minError"</span>: &#123;</span><br><span class="line">      <span class="attr">"type"</span>: <span class="string">"logLevelFilter"</span>,</span><br><span class="line">      <span class="attr">"appender"</span>: <span class="string">"error"</span>,</span><br><span class="line">      <span class="attr">"level"</span>: <span class="string">"error"</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"replaceConsole"</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">"pm2"</span>:<span class="literal">true</span>,</span><br><span class="line">  <span class="attr">"categories"</span>: &#123;</span><br><span class="line">    <span class="attr">"default"</span>: &#123;</span><br><span class="line">      <span class="attr">"appenders"</span>: [</span><br><span class="line">        <span class="string">"console"</span>,</span><br><span class="line">        <span class="string">"http"</span>,</span><br><span class="line">        <span class="string">"maxInfo"</span>,</span><br><span class="line">        <span class="string">"minError"</span></span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">"level"</span>: <span class="string">"debug"</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>å¤§å‰ç«¯</category>
      </categories>
      <tags>
        <tag>nodejs</tag>
      </tags>
  </entry>
  <entry>
    <title>nodejsæ–‡ä»¶ä¸‹è½½</title>
    <url>/2018/04/03/2018Q2/nodejs%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD/</url>
    <content><![CDATA[<p>æœ¬æ–‡æ¥è°ˆè°ˆ nodejs æ–‡ä»¶ä¸‹è½½çš„ç»†èŠ‚</p>
<p>æ³¨ï¼šè¿™è¾¹çš„æ–‡ä»¶ä¸‹è½½ï¼Œå‘èµ·è€…ä¸ºå®¢æˆ·ç«¯</p>
<a id="more"></a>

<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> (<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„/files/xls/demo.xlsxæ–‡ä»¶</span></span><br><span class="line">  <span class="keyword">var</span> filePath = path.join(__dirname, <span class="string">'../'</span>) + <span class="string">'/files/xls/demo.xlsx'</span></span><br><span class="line">  <span class="comment">// å®šä½åˆ°å…·ä½“æ–‡ä»¶</span></span><br><span class="line">  <span class="keyword">var</span> stats = fs.statSync(filePath)</span><br><span class="line">  <span class="comment">//åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">  <span class="keyword">if</span> (stats.isFile()) &#123;</span><br><span class="line">    <span class="comment">//Content-Dispositionå±æ€§ï¼Œå¦‚æœä¸è€ƒè™‘ä¸­æ–‡çš„è¯ï¼Œç›´æ¥ç”¨filename=demo.xlsxå³å¯</span></span><br><span class="line">    <span class="comment">//å¦‚æœæœ‰ä¸­æ–‡ï¼Œéœ€è¦è¿›è¡Œutf8ç¼–ç ï¼Œfilenameåéœ€å¸¦ä¸Š*=UTF-8''</span></span><br><span class="line">    <span class="comment">// å¦‚æœ‰ä¸­æ–‡ä½†ä¸è¿›è¡Œç¼–ç è®¾ç½®ï¼ŒContent-Dispositionå‚æ•°å°†ä¸ç”Ÿæ•ˆï¼Œè¿˜æ˜¯åŸæ¥çš„æ–‡ä»¶å</span></span><br><span class="line">    res.set(&#123;</span><br><span class="line">      <span class="string">'Content-Type'</span>: <span class="string">'application/octet-stream'</span>,</span><br><span class="line">      <span class="string">'Content-Disposition'</span>: <span class="string">"attachment; filename*=UTF-8''"</span> + <span class="built_in">encodeURI</span>(<span class="string">'Appæäº¤æ¨¡æ¿.xlsx'</span>),</span><br><span class="line">      <span class="string">'Content-Length'</span>: stats.size</span><br><span class="line">    &#125;)</span><br><span class="line">    res.send(stats)</span><br><span class="line">    <span class="comment">//fs.createReadStream(filePath).pipe(res)</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      res.status(<span class="number">404</span>).end()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯¹äºå°æ–‡ä»¶æ¥è¯´ï¼Œé‡‡ç”¨<code>res.send(buffer)</code> æˆ–<code>res.sendFile(fileName)</code>çš„å½¢å¼ï¼Œæ˜¯å…ˆå°†æ–‡ä»¶å†…å®¹æ”¾åˆ°buffä¸­å†è¿›è¡Œä¼ è¾“</p>
<p>è‹¥æ–‡ä»¶ç›¸å¯¹è¾ƒå¤§ï¼Œéœ€è¦é‡‡ç”¨<code>fs.createReadStream(filePath).pipe(res)</code>ç”¨æµç®¡é“çš„æ–¹å¼ä¼ è¾“,è¿™ç§æ–¹å¼è¯»ä¸€éƒ¨åˆ†å†™ä¸€éƒ¨åˆ†ï¼Œç”¨è¿‡çš„éƒ¨åˆ†ä¼šè¢«GC,æ•…å å†…å­˜å°‘</p>
<p>express è¿˜å¯¹reså°è£…äº†ä¸€ä¸ªdownloadæ–¹æ³•ï¼Œå·²é‡‡ç”¨<code>res.set</code>è¿›è¡Œå‚æ•°è®¾ç½®ï¼Œå¹¶è°ƒç”¨<code>res.sendFile()</code>æ–¹æ³•è¿›è¡Œæ–‡ä»¶ä¼ è¾“ï¼Œç”¨èµ·æ¥å¾ˆæ–¹ä¾¿</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> filePath = path.join(__dirname, <span class="string">'../'</span>) + <span class="string">'/files/xls/demo.xlsx'</span></span><br><span class="line">res.download(filePath, <span class="string">'Appæäº¤æ¨¡æ¿.xlsx'</span>)</span><br></pre></td></tr></table></figure>
<p>å½“æ–‡ä»¶ä¸å­˜åœ¨æ—¶(err)ï¼Œæ˜¯èµ°è·¯ç”±çš„Error Handler.è‹¥æŒ‡å®šç¬¬ä¸‰ä¸ªå‚æ•°<code>(err)=&gt;{}</code>åˆ™èµ°è¯¥å‚æ•°</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//æ–‡ä»¶ä¸å­˜åœ¨æ—¶äº§ç”Ÿçš„err</span></span><br><span class="line">err:</span><br><span class="line">  code:<span class="string">"ENOENT"</span></span><br><span class="line">  errno:<span class="number">-4058</span></span><br><span class="line">  expose:<span class="literal">false</span></span><br><span class="line">  message:<span class="string">"ENOENT: no such file or directory, stat 'e:\WebProjects\client-management-server\files\xls\demos.xlsx'"</span></span><br><span class="line">  path:<span class="string">"e:\WebProjects\client-management-server\files\xls\demos.xlsx"</span></span><br><span class="line">  stack:<span class="string">"Error: ENOENT: no such file or directory, stat 'e:\WebProjects\client-management-server\files\xls\demos.xlsx'"</span></span><br><span class="line">  status:<span class="number">404</span></span><br><span class="line">  statusCode:<span class="number">404</span></span><br><span class="line">  syscall:<span class="string">"stat"</span></span><br></pre></td></tr></table></figure>


<p>æ•…å°æ–‡ä»¶ï¼ˆ&lt;500Mï¼‰ï¼Œæ¨èç›´æ¥é‡‡ç”¨expressçš„downloadæ–¹æ³•</p>
]]></content>
      <categories>
        <category>å¤§å‰ç«¯</category>
      </categories>
      <tags>
        <tag>nodejs</tag>
      </tags>
  </entry>
  <entry>
    <title>Nodeå­è¿›ç¨‹æ‰§è¡Œpingæ“ä½œå¹¶è·å–ç»Ÿè®¡ä¿¡æ¯</title>
    <url>/2018/03/09/2018Q1/Node%E5%AD%90%E8%BF%9B%E7%A8%8B%E6%89%A7%E8%A1%8Cping%E6%93%8D%E4%BD%9C%E5%B9%B6%E8%8E%B7%E5%8F%96%E7%BB%9F%E8%AE%A1%E4%BF%A1%E6%81%AF/</url>
    <content><![CDATA[<h2 id="éœ€æ±‚"><a href="#éœ€æ±‚" class="headerlink" title="éœ€æ±‚"></a>éœ€æ±‚</h2><p>é‡‡ç”¨<code>ping -t</code>æ–¹å¼ä¸æ–­è¿›è¡Œpingæ“ä½œï¼Œç›´åˆ°æ”¶åˆ°å…³é—­ä¿¡å·oræŸä¸ªè¶…æ—¶æ—¶é—´æ—¶ç»“æŸæ“ä½œï¼Œè·å–ç»Ÿè®¡ä¿¡æ¯ã€‚</p>
<a id="more"></a>

<h2 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h2><p>åœ¨cmdçª—å£è¿›è¡Œ<code>ping -t</code>æ“ä½œï¼Œä¼šä¸€ç›´è¿›è¡Œpingï¼Œç›´åˆ°è¾“å…¥<code>ctrl+C</code> ä¼šè¾“å‡ºpingç»Ÿè®¡ä¿¡æ¯ã€‚</p>
<p><code>kill(&#39;SIGINT&#39;)</code> å³æ¨¡æ‹Ÿ <code>ctrl+C</code> ç»ˆæ­¢è¿›ç¨‹</p>
<h2 id="ç¼–ç "><a href="#ç¼–ç " class="headerlink" title="ç¼–ç "></a>ç¼–ç </h2><p>è¿™é‡Œæˆ‘è‡ªå·±æ‰‹åŠ¨è¿›è¡Œç»Ÿè®¡ä¿¡æ¯ï¼ŒåŸå› è§ä¸‹é¢åˆ†æã€‚</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> exec = <span class="built_in">require</span>(<span class="string">'child_process'</span>).exec;</span><br><span class="line"><span class="keyword">var</span> iconv = <span class="built_in">require</span>(<span class="string">'iconv-lite'</span>);</span><br><span class="line"><span class="keyword">let</span> ping = exec(<span class="string">`ping www.google.com.hk -t`</span>, &#123; <span class="attr">encoding</span>: <span class="string">'binary'</span>&#125;, <span class="function"><span class="keyword">function</span> (<span class="params">err, stdout, stderr</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> send = <span class="number">0</span></span><br><span class="line">    <span class="keyword">let</span> accept = <span class="number">0</span></span><br><span class="line">    <span class="keyword">let</span> lost = <span class="number">0</span></span><br><span class="line">    <span class="keyword">let</span> min = <span class="literal">Infinity</span></span><br><span class="line">    <span class="keyword">let</span> max = -<span class="literal">Infinity</span></span><br><span class="line">    <span class="keyword">let</span> avg = <span class="number">0</span></span><br><span class="line">    <span class="keyword">let</span> Min = <span class="function">(<span class="params">a,b</span>)=&gt;</span>a&lt;b?a:b;</span><br><span class="line">    <span class="keyword">let</span> Max = <span class="function">(<span class="params">a,b</span>)=&gt;</span>a&gt;b?a:b;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> str = iconv.decode(<span class="keyword">new</span> Buffer(stdout, <span class="string">'binary'</span>), <span class="string">'GBK'</span>)</span><br><span class="line">    <span class="built_in">console</span>.log(str);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'========='</span>)</span><br><span class="line">    <span class="keyword">let</span> regAccept = <span class="regexp">/æ¥è‡ª .*çš„å›å¤: å­—èŠ‚=(\d+) æ—¶é—´=(\d+)ms TTL=(\d+)/g</span></span><br><span class="line">    <span class="keyword">let</span> regAll = <span class="regexp">/\n/g</span></span><br><span class="line">    send = str.match(regAll).length - <span class="number">2</span></span><br><span class="line">    send=send&lt;<span class="number">0</span>?<span class="number">0</span>:send</span><br><span class="line">    <span class="keyword">let</span> res</span><br><span class="line">    <span class="keyword">while</span> (res = regAccept.exec(str)) &#123;</span><br><span class="line">        accept++</span><br><span class="line">        <span class="keyword">let</span> tim = <span class="built_in">Number</span>(res[<span class="number">2</span>])</span><br><span class="line">        min=Min(tim,min)</span><br><span class="line">        max=Max(tim,max)</span><br><span class="line">        avg= (avg*(accept<span class="number">-1</span>)+tim)/accept</span><br><span class="line">        <span class="built_in">console</span>.log(res[<span class="number">1</span>], tim, res[<span class="number">3</span>],avg)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'========='</span>)</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`å‘é€:<span class="subst">$&#123;send&#125;</span>;æ¥æ”¶:<span class="subst">$&#123;accept&#125;</span>;ä¸¢å¤±:<span class="subst">$&#123;send-accept&#125;</span>;<span class="subst">$&#123;(<span class="number">1</span>-(accept<span class="regexp">/send))*100&#125;%ä¸¢å¤±`)</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="regexp">    console.log(`æœ€çŸ­:$&#123;min&#125;ms;æœ€é•¿:$&#123;max&#125;ms;å¹³å‡:$&#123;avg&#125;ms`)</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="regexp">&#125;);</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="regexp">ping.on('close', (code) =&gt; &#123; console.log('close by', code) &#125;)</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="regexp">setTimeout(function () &#123;</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="regexp">    ping.kill('SIGINT')</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="regexp">&#125;, 5 * 1000);</span></span></span></span><br></pre></td></tr></table></figure>

<p>æƒ³é€šè¿‡<code>ping.kill(&#39;SIGINT&#39;)</code>å»å…³é—­execå­è¿›ç¨‹ã€‚</p>
<p>æµ‹è¯•ç»“æœæ˜¯ï¼šè¾“å‡ºäº† <code>close by null</code> åï¼Œç¨‹åºä¾ç„¶å†è¿è¡Œï¼Œå¹¶ä¸”æ²¡æœ‰è¾“å‡ºç»Ÿè®¡ä¿¡æ¯ã€‚</p>
<h2 id="é—®é¢˜è§£å†³"><a href="#é—®é¢˜è§£å†³" class="headerlink" title="é—®é¢˜è§£å†³"></a>é—®é¢˜è§£å†³</h2><p><strong>æ€è·¯1</strong>ï¼šåœ¨<code>setTimeout</code>ä¸­å¢åŠ <code>process.kill(ping.pid,&#39;SIGINT&#39;);process.exit(0)</code></p>
<p>æµ‹è¯•ç»“æœï¼šç¨‹åºä¼šé€€å‡ºï¼Œä½†æ˜¯æ²¡æœ‰è¾“å‡º<code>close by</code>ä¹Ÿæ²¡æœ‰è¾“å‡ºç»Ÿè®¡ä¿¡æ¯ã€‚å¹¶ä¸”ä»»åŠ¡ç®¡ç†å™¨ä¸­pingè¿›ç¨‹ä»ç„¶å­˜åœ¨ã€‚</p>
<p><strong>æ€è·¯2</strong>ï¼šæ¢ä¸ªæ€è·¯ï¼Œç»™execçš„optionså¢åŠ <code>timeout</code>å‚æ•°ï¼Œå–æ¶ˆ<code>setTimeout</code>ã€‚</p>
<p>æµ‹è¯•ç»“æœï¼šè¾¾åˆ°timeoutæ—¶é—´åï¼Œä¼šæ‰§è¡Œå›è°ƒå‡½æ•°ï¼Œå¯ä»¥è¾“å‡ºç»Ÿè®¡ä¿¡æ¯ï¼ˆcmd pingæ“ä½œæœ€åçš„ç»Ÿè®¡ä¿¡æ¯åœ¨è¿™è¾¹æ˜¯æ²¡æœ‰çš„ï¼Œè¿™è¾¹æˆ‘è‡ªå·±è¿›è¡Œäº†ç»Ÿè®¡ï¼‰ã€‚</p>
<p>ä½†æ˜¯ï¼ï¼pingè¿›ç¨‹å¹¶æ²¡æœ‰å…³é—­ã€‚å½“pingè¿›ç¨‹å¤§é‡å­˜åœ¨çš„æ—¶å€™ï¼Œpingçš„é€Ÿåº¦ä¼šè¶Šæ¥è¶Šæ…¢ã€‚</p>
<p><strong>çœ‹åˆ°ç½‘ä¸Šæœ‰ç¯‡æ–‡ç« <a href="https://cnodejs.org/topic/5664f61e374362a006a1a572" target="_blank" rel="noopener">child_processæ¨¡å—æ€ä¹ˆçœŸæ­£çš„æ€æ­»å­è¿›ç¨‹</a>æœ‰ä¸€æ ·çš„é—®é¢˜ã€‚</strong></p>
<p>æœ€åä»–æ˜¯é‡‡ç”¨ <a href="https://github.com/pkrumins/node-tree-kill" target="_blank" rel="noopener">node-tree-kill</a> åº“è§£å†³ã€‚</p>
<h3 id="node-tree-kill-ä½¿ç”¨ã€æºç åŠåŸç†"><a href="#node-tree-kill-ä½¿ç”¨ã€æºç åŠåŸç†" class="headerlink" title="node-tree-kill ä½¿ç”¨ã€æºç åŠåŸç†"></a>node-tree-kill ä½¿ç”¨ã€æºç åŠåŸç†</h3><h4 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h4><p><code>npm i tree-kill</code> å®‰è£…</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> kill = <span class="built_in">require</span>(<span class="string">'tree-kill'</span>);</span><br><span class="line">setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    kill(ping.pid) <span class="comment">//æŠŠæœ€åˆä»£ç è¿™è¾¹åšä¸‹æ›¿æ¢</span></span><br><span class="line">&#125;, <span class="number">5</span> * <span class="number">1000</span>);</span><br></pre></td></tr></table></figure>

<h4 id="æºç "><a href="#æºç " class="headerlink" title="æºç "></a>æºç </h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> (<span class="params">pid, signal, callback</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> tree = &#123;&#125;;</span><br><span class="line">    <span class="keyword">var</span> pidsToProcess = &#123;&#125;;</span><br><span class="line">    tree[pid] = [];</span><br><span class="line">    pidsToProcess[pid] = <span class="number">1</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> signal === <span class="string">'function'</span> &amp;&amp; callback === <span class="literal">undefined</span>) &#123;</span><br><span class="line">      callback = signal;</span><br><span class="line">      signal = <span class="literal">undefined</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">switch</span> (process.platform) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'win32'</span>:</span><br><span class="line">        <span class="comment">// /Tç»ˆæ­¢æŒ‡å®šçš„è¿›ç¨‹å’Œç”±å®ƒå¯ç”¨çš„å­è¿›ç¨‹</span></span><br><span class="line">        <span class="comment">// /FæŒ‡å®šå¼ºåˆ¶ç»ˆæ­¢è¿›ç¨‹ /pidæŒ‡å®šè¿›ç¨‹pidå·</span></span><br><span class="line">        exec(<span class="string">'taskkill /pid '</span> + pid + <span class="string">' /T /F'</span>, callback);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'darwin'</span>:</span><br><span class="line">        buildProcessTree(pid, tree, pidsToProcess, <span class="function"><span class="keyword">function</span> (<span class="params">parentPid</span>) </span>&#123;</span><br><span class="line">          <span class="keyword">return</span> spawn(<span class="string">'pgrep'</span>, [<span class="string">'-P'</span>, parentPid]);</span><br><span class="line">        &#125;, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            killAll(tree, signal, callback);</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="comment">// case 'sunos':</span></span><br><span class="line">    <span class="comment">//     buildProcessTreeSunOS(pid, tree, pidsToProcess, function () &#123;</span></span><br><span class="line">    <span class="comment">//         killAll(tree, signal, callback);</span></span><br><span class="line">    <span class="comment">//     &#125;);</span></span><br><span class="line">    <span class="comment">//     break;</span></span><br><span class="line">    <span class="keyword">default</span>: <span class="comment">// Linux</span></span><br><span class="line">        buildProcessTree(pid, tree, pidsToProcess, <span class="function"><span class="keyword">function</span> (<span class="params">parentPid</span>) </span>&#123;</span><br><span class="line">          <span class="keyword">return</span> spawn(<span class="string">'ps'</span>, [<span class="string">'-o'</span>, <span class="string">'pid'</span>, <span class="string">'--no-headers'</span>, <span class="string">'--ppid'</span>, parentPid]);</span><br><span class="line">        &#125;, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            killAll(tree, signal, callback);</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h4><p>å¾ˆç®€å•ã€‚å°±æ˜¯è°ƒç”¨äº†ç³»ç»ŸæŒ‡ä»¤å¼ºè¡Œå…³é—­è¿›ç¨‹ï¼Œè€Œä¸æ˜¯åŸæ¥ç¨‹åºä¸­å»åšå…³é—­ã€‚åšäº†ä¸åŒå¹³å°çš„å…¼å®¹ã€‚</p>
]]></content>
      <categories>
        <category>å¤§å‰ç«¯</category>
      </categories>
      <tags>
        <tag>nodejs</tag>
      </tags>
  </entry>
  <entry>
    <title>puppeteeråˆæ¢-æµ‹è¯•webrtc</title>
    <url>/2018/02/07/2018Q1/puppeteer%E5%88%9D%E6%8E%A2-%E6%B5%8B%E8%AF%95webrtc/</url>
    <content><![CDATA[<h1 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h1><p>puppeteeræ˜¯ä»€ä¹ˆ?</p>
<p>å®ƒæ˜¯ä¸€ä¸ªnodejsçš„åº“ï¼Œæ”¯æŒè°ƒç”¨Chromeçš„APIæ¥æ“çºµWeb å®ƒçš„domæ“ä½œå¯ä»¥å®Œå…¨åœ¨å†…å­˜ä¸­è¿›è¡Œæ¨¡æ‹Ÿè€Œä¸æ‰“å¼€æµè§ˆå™¨</p>
<p>åŠŸèƒ½å¼ºå¤§ï¼Œå¯ç”¨äºæˆªå›¾ã€pdfç”Ÿæˆã€UIæµ‹è¯•ã€è¡¨å•æäº¤ã€æ•°æ®çˆ¬å–ã€æ€§èƒ½è¯Šæ–­â€¦</p>
<p>å®˜æ–¹æ¥å£åœ°å€ï¼š<a href="https://github.com/GoogleChrome/puppeteer/blob/master/docs/api.md" target="_blank" rel="noopener">https://github.com/GoogleChrome/puppeteer/blob/master/docs/api.md</a></p>
<a id="more"></a>

<h1 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h1><p>é€šè¿‡<code>npm i puppeteer</code>å®‰è£…</p>
<p>æ­£å¸¸æ˜¯ä¼šæŠ¥é”™çš„ã€‚</p>
<p>è§£æ³•æ–¹æ³•1ï¼š</p>
<blockquote>
<p>1.é‡‡ç”¨<code>cnpm i puppeteer</code></p>
</blockquote>
<p>è§£æ³•æ–¹æ³•2ï¼š</p>
<blockquote>
<p>1.ä½¿ç”¨<code>npm i --save puppeteer --ignore-scripts</code>å®‰è£…å¹¶å¿½ç•¥<code>chromium</code>çš„ä¸‹è½½<br>2.è‡ªè¡Œä¸‹è½½ <a href='https://link.jianshu.com/?t=https%3A%2F%2Fdownload-chromium.appspot.com%2F' target="_blank" rel="noopener">chromium</a><br>æˆ– é‡‡ç”¨æœ¬åœ°chrome (åé¢ä¼šè¯´æ˜è¿™æ ·çš„å¥½å¤„)</p>
</blockquote>
<p>å‚è€ƒï¼š<a href="https://www.jianshu.com/p/a89d8d6c007b" target="_blank" rel="noopener">https://www.jianshu.com/p/a89d8d6c007b</a></p>
<h1 id="è¿è¡Œ"><a href="#è¿è¡Œ" class="headerlink" title="è¿è¡Œ"></a>è¿è¡Œ</h1><p>æ–°å»ºindex.js,ä»£ç </p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> puppeteer = <span class="built_in">require</span>(<span class="string">'puppeteer'</span>);</span><br><span class="line"></span><br><span class="line">(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> browser = <span class="keyword">await</span> puppeteer.launch();</span><br><span class="line">    <span class="keyword">const</span> page = <span class="keyword">await</span> browser.newPage();</span><br><span class="line">    <span class="keyword">await</span> page.goto(<span class="string">'https://y.qq.com'</span>);</span><br><span class="line">    <span class="keyword">await</span> page.screenshot(&#123;<span class="attr">path</span>: <span class="string">'yqq.png'</span>&#125;);</span><br><span class="line">    browser.close();</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨<code>node index.js</code>è¿è¡Œ</p>
<p>è‹¥å‡ºç°<code>async/await</code> é—®é¢˜ï¼Œæ£€æµ‹nodeç‰ˆæœ¬æ˜¯å¦åœ¨7.6ä»¥ä¸Š å¦åˆ™çš„è¯é‡æ–°å®‰è£…å³å¯</p>
<p>æ­£å¸¸åº”è¯¥æ˜¯å¯ä»¥è·å¾—æˆªå›¾äº†ã€‚</p>
<h1 id="æµ‹è¯•webrtcåº”ç”¨"><a href="#æµ‹è¯•webrtcåº”ç”¨" class="headerlink" title="æµ‹è¯•webrtcåº”ç”¨"></a>æµ‹è¯•webrtcåº”ç”¨</h1><p><code>puppeteer.launch()</code> å¯ä»¥å¡«å…¥å‚æ•°<code>{headless: false}</code> è¿™æ ·å°±å¯ä»¥æ‰“å¼€æµè§ˆå™¨æµ‹è¯•ï¼Œé»˜è®¤æ˜¯åªåœ¨å†…å­˜è·‘</p>
<p>é¦–å…ˆé‡‡ç”¨ chromium  æµ‹è¯•æˆ‘ä»¬çš„webrtcåº”ç”¨ï¼Œå‘ç°ç”»é¢æ²¡æœ‰æ˜¾ç¤ºï¼Œé‡‡ç”¨<code>chrome://webrtc-internals</code>å‘ç°æœ¬åœ°åªæ”¯æŒVP8,è€Œæˆ‘ä»¬çš„webrtcæœåŠ¡ç«¯åªä¼ H.264çš„æµã€‚</p>
<p>ç™¾åº¦æŸ¥çœ‹äº†ä¸‹ chrome å’Œ chromium çš„åŒºåˆ«ï¼Œchromium ä¼šæ¯”chrome å°‘ä¸€äº›éŸ³è§†é¢‘çš„æ ¼å¼æ”¯æŒï¼ŒåŒ…æ‹¬<code>h264,acc</code></p>
<p>é‚£ä¹ˆæœ¬åœ°çš„chromeèƒ½å¦æ”¯æŒå‘¢ï¼Ÿæµ‹è¯•ç»“æœå‘ç°æ˜¯å¯ä»¥æ”¯æŒçš„ã€‚ï¼ˆæ²¡ä¸‹çš„è¯è®°å¾—ä¸‹</p>
<p>ä½¿ç”¨ä¹Ÿå¾ˆç®€å•ã€‚</p>
<p>æ‰¾åˆ°chromeçš„å®‰è£…ç›®å½•ã€‚æˆ‘è¿™é‡Œæ˜¯<code>C:/Program Files (x86)/Google/Chrome/Application/chrome.exe</code></p>
<p>ç„¶ålaunchæ–¹æ³•ä¸­ä¼ å…¥<code>executablePath: &#39;C:/Program Files (x86)/Google/Chrome/Application/chrome.exe&#39;</code></p>
<p>æµ‹è¯•æˆåŠŸã€‚</p>
<p>å®Œæ•´æµ‹è¯•ä»£ç ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> puppeteer = <span class="built_in">require</span>(<span class="string">'puppeteer'</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">timeout</span>(<span class="params">ms</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">    setTimeout(resolve, ms);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(process.argv)</span><br><span class="line">puppeteer.launch(&#123;</span><br><span class="line">  <span class="comment">// headless: false,</span></span><br><span class="line">  executablePath: <span class="string">'./chrome/chrome.exe'</span>,</span><br><span class="line">&#125;).then(<span class="keyword">async</span> browser =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> page = <span class="keyword">await</span> browser.newPage();</span><br><span class="line">  <span class="keyword">await</span> page.goto(<span class="string">'http://10.8.116.11:8081/tryplay-h5/#/main?....'</span>);</span><br><span class="line">  <span class="keyword">await</span> timeout(<span class="number">10000</span>);</span><br><span class="line">  <span class="keyword">await</span> page.screenshot(&#123; <span class="attr">path</span>: <span class="string">'rtc.png'</span> &#125;);</span><br><span class="line">  <span class="keyword">await</span> browser.close();</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'end'</span>)</span><br><span class="line">&#125;).catch(<span class="function"><span class="params">e</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.error(e)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



]]></content>
      <categories>
        <category>å¤§å‰ç«¯</category>
      </categories>
      <tags>
        <tag>puppeteer</tag>
        <tag>å‰ç«¯æµ‹è¯•</tag>
      </tags>
  </entry>
  <entry>
    <title>ECMAScript6å…¥é—¨</title>
    <url>/2018/01/07/2018Q1/ECMAScript6%E5%85%A5%E9%97%A8/</url>
    <content><![CDATA[<h1 id="let-å’Œ-const"><a href="#let-å’Œ-const" class="headerlink" title="let å’Œ const"></a>let å’Œ const</h1><h2 id="let"><a href="#let" class="headerlink" title="let"></a>let</h2><h3 id="å—ä½œç”¨åŸŸå†…æœ‰æ•ˆ"><a href="#å—ä½œç”¨åŸŸå†…æœ‰æ•ˆ" class="headerlink" title="å—ä½œç”¨åŸŸå†…æœ‰æ•ˆ"></a>å—ä½œç”¨åŸŸå†…æœ‰æ•ˆ</h3><h3 id="ä¸å­˜åœ¨å˜é‡æå‡"><a href="#ä¸å­˜åœ¨å˜é‡æå‡" class="headerlink" title="ä¸å­˜åœ¨å˜é‡æå‡"></a>ä¸å­˜åœ¨å˜é‡æå‡</h3><h3 id="æš‚æ—¶æ€§æ­»åŒºï¼ˆTDZï¼‰"><a href="#æš‚æ—¶æ€§æ­»åŒºï¼ˆTDZï¼‰" class="headerlink" title="æš‚æ—¶æ€§æ­»åŒºï¼ˆTDZï¼‰"></a>æš‚æ—¶æ€§æ­»åŒºï¼ˆTDZï¼‰</h3><a id="more"></a>

<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">  <span class="comment">// TDZå¼€å§‹</span></span><br><span class="line">  tmp = <span class="string">'abc'</span>; <span class="comment">// ReferenceError</span></span><br><span class="line">  <span class="built_in">console</span>.log(tmp); <span class="comment">// ReferenceError</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> tmp; <span class="comment">// TDZç»“æŸ</span></span><br><span class="line">  <span class="built_in">console</span>.log(tmp); <span class="comment">// undefined</span></span><br><span class="line"></span><br><span class="line">  tmp = <span class="number">123</span>;</span><br><span class="line">  <span class="built_in">console</span>.log(tmp); <span class="comment">// 123</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å—ä½œç”¨åŸŸå†…å£°æ˜å‡½æ•°"><a href="#å—ä½œç”¨åŸŸå†…å£°æ˜å‡½æ•°" class="headerlink" title="å—ä½œç”¨åŸŸå†…å£°æ˜å‡½æ•°"></a>å—ä½œç”¨åŸŸå†…å£°æ˜å‡½æ•°</h3><p><a href="https://stackoverflow.com/questions/31419897/what-are-the-precise-semantics-of-block-level-functions-in-es6" target="_blank" rel="noopener">https://stackoverflow.com/questions/31419897/what-are-the-precise-semantics-of-block-level-functions-in-es6</a></p>
<p>æµè§ˆå™¨çš„å®ç°æ— éœ€æŒ‰ç…§æ ‡å‡†</p>
<p>åœ¨å—çº§ä½œç”¨åŸŸä¸­é‡‡ç”¨å‡½æ•°è¡¨è¾¾å¼ä»£æ›¿å‡½æ•°å£°æ˜</p>
<h2 id="const"><a href="#const" class="headerlink" title="const"></a>const</h2><p>const å®šä¹‰å¸¸é‡åï¼Œå…¶å€¼ä¸å¯å˜ã€‚</p>
<p>constå®šä¹‰å˜é‡åï¼Œä¿è¯çš„ä¸æ˜¯å˜é‡çš„å€¼ä¸å¾—æ”¹åŠ¨ï¼Œè€Œæ˜¯å˜é‡æ‰€æŒ‡å‘çš„å†…å­˜åœ°å€ä¸å¾—æ”¹å˜ã€‚</p>
<p>ä¸¾ä¾‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const MIN &#x3D; 1</span><br><span class="line">MIN &#x3D; 0 &#x2F;&#x2F;TypeError: Assignment to constant variable</span><br><span class="line">const obj &#x3D; &#123;&#125;</span><br><span class="line">obj.a &#x3D; 1 &#x2F;&#x2F;1</span><br><span class="line">obj &#x3D; &#123;&#125;  &#x2F;&#x2F;TypeError: Assignment to constant variable</span><br></pre></td></tr></table></figure>

<p>objå¯¹è±¡æœ¬èº«ä»æ˜¯å¯å˜çš„ï¼Œåªæ˜¯æ‰€å¤„å†…å­˜åœ°å€ä¸èƒ½æ”¹å˜</p>
<p>å¦‚æœçœŸçš„æƒ³è®©å¯¹è±¡å†»ç»“ï¼Œé‡‡ç”¨<code>Object.freeze</code>æ–¹æ³•</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> a = &#123;<span class="attr">name</span>:&#123;<span class="attr">first</span>:<span class="string">'gahing'</span>&#125;&#125;</span><br><span class="line"><span class="keyword">const</span> foo = <span class="built_in">Object</span>.freeze(a); <span class="comment">//ä»å¯ä»¥ä½¿ç”¨a=&#123;&#125; æ”¹å˜açš„å†…å­˜åœ°å€</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å¸¸è§„æ¨¡å¼æ—¶ï¼Œä¸‹é¢ä¸€è¡Œä¸èµ·ä½œç”¨ï¼›</span></span><br><span class="line"><span class="comment">// ä¸¥æ ¼æ¨¡å¼æ—¶ï¼Œè¯¥è¡Œä¼šæŠ¥é”™</span></span><br><span class="line">foo.prop = <span class="number">123</span>;</span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯å¯¹è±¡å…¶ä¸‹çš„å±æ€§æ˜¯ä¸èµ·ä½œç”¨çš„ï¼Œæ¯”å¦‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">foo.name.last&#x3D;&#39;z&#39;</span><br><span class="line">foo.name &#x2F;&#x2F;&#123;first: &quot;gahing&quot;, last: &quot;z&quot;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="è·å–é¡¶å±‚å¯¹è±¡"><a href="#è·å–é¡¶å±‚å¯¹è±¡" class="headerlink" title="è·å–é¡¶å±‚å¯¹è±¡"></a>è·å–é¡¶å±‚å¯¹è±¡</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">(typeof window !&#x3D;&#x3D; &#39;undefined&#39;</span><br><span class="line">   ? window</span><br><span class="line">   : (typeof process &#x3D;&#x3D;&#x3D; &#39;object&#39; &amp;&amp;</span><br><span class="line">      typeof require &#x3D;&#x3D;&#x3D; &#39;function&#39; &amp;&amp;</span><br><span class="line">      typeof global &#x3D;&#x3D;&#x3D; &#39;object&#39;)</span><br><span class="line">     ? global</span><br><span class="line">     : this);</span><br></pre></td></tr></table></figure>

<h1 id="æ­£åˆ™çš„æ‹“å±•"><a href="#æ­£åˆ™çš„æ‹“å±•" class="headerlink" title="æ­£åˆ™çš„æ‹“å±•"></a>æ­£åˆ™çš„æ‹“å±•</h1><h2 id="å¢åŠ æ„é€ å‡½æ•°"><a href="#å¢åŠ æ„é€ å‡½æ•°" class="headerlink" title="å¢åŠ æ„é€ å‡½æ•°"></a>å¢åŠ æ„é€ å‡½æ•°</h2><h2 id="uä¿®é¥°ç¬¦"><a href="#uä¿®é¥°ç¬¦" class="headerlink" title="uä¿®é¥°ç¬¦"></a>uä¿®é¥°ç¬¦</h2><p>ç”¨äºå››ä¸ªå­—èŠ‚çš„å­—ç¬¦</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;ğ ®·&#123;2&#125;&#x2F;.test(&#39;ğ ®·ğ ®·&#39;) &#x2F;&#x2F; false</span><br><span class="line">&#x2F;ğ ®·&#123;2&#125;&#x2F;u.test(&#39;ğ ®·ğ ®·&#39;) &#x2F;&#x2F; true</span><br></pre></td></tr></table></figure>

<h2 id="yä¿®é¥°ç¬¦"><a href="#yä¿®é¥°ç¬¦" class="headerlink" title="yä¿®é¥°ç¬¦"></a>yä¿®é¥°ç¬¦</h2><p>å’Œgä¸€æ ·ä¹Ÿæ˜¯å…¨å±€åŒ¹é…ï¼Œåªæ˜¯åŒ¹é…éƒ½æ˜¯ä»å‰©ä½™å­—ç¬¦ä¸²çš„ç¬¬ä¸€ä¸ªå­—ç¬¦å¼€å§‹åŒ¹é…</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">var s &#x3D; &#39;aaa_aa_a&#39;;</span><br><span class="line">var r1 &#x3D; &#x2F;a+&#x2F;g;</span><br><span class="line">var r2 &#x3D; &#x2F;a+&#x2F;y;</span><br><span class="line"></span><br><span class="line">r1.exec(s) &#x2F;&#x2F; [&quot;aaa&quot;]</span><br><span class="line">r2.exec(s) &#x2F;&#x2F; [&quot;aaa&quot;] å‰©ä½™_aa_a</span><br><span class="line"></span><br><span class="line">r1.exec(s) &#x2F;&#x2F; [&quot;aa&quot;]</span><br><span class="line">r2.exec(s) &#x2F;&#x2F; null</span><br></pre></td></tr></table></figure>
<p>å³ y ä¿®é¥°ç¬¦å·éšå«äº†å¤´éƒ¨åŒ¹é…çš„æ ‡å¿— ^ </p>
<p>å•å•ä¸€ä¸ªyä¿®é¥°ç¬¦å¯¹matchæ–¹æ³•ï¼Œåªèƒ½è¿”å›ç¬¬ä¸€ä¸ªåŒ¹é…ï¼Œå¿…é¡»ä¸gä¿®é¥°ç¬¦è”ç”¨ï¼Œæ‰èƒ½è¿”å›æ‰€æœ‰åŒ¹é…ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#39;a1a2a3&#39;.match(&#x2F;a\d&#x2F;y) &#x2F;&#x2F; [&quot;a1&quot;]</span><br><span class="line">&#39;a1a2a3&#39;.match(&#x2F;a\d&#x2F;gy) &#x2F;&#x2F; [&quot;a1&quot;, &quot;a2&quot;, &quot;a3&quot;]</span><br></pre></td></tr></table></figure>


<h2 id="å…·åç»„åŒ¹é…"><a href="#å…·åç»„åŒ¹é…" class="headerlink" title="å…·åç»„åŒ¹é…"></a>å…·åç»„åŒ¹é…</h2><p>ES2018å¼•å…¥</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const RE_DATE &#x3D; &#x2F;(?&lt;year&gt;\d&#123;4&#125;)-(?&lt;month&gt;\d&#123;2&#125;)-(?&lt;day&gt;\d&#123;2&#125;)&#x2F;;</span><br><span class="line"></span><br><span class="line">const matchObj &#x3D; RE_DATE.exec(&#39;1999-12-31&#39;);</span><br><span class="line">const year &#x3D; matchObj.groups.year; &#x2F;&#x2F; 1999</span><br><span class="line">const month &#x3D; matchObj.groups.month; &#x2F;&#x2F; 12</span><br><span class="line">const day &#x3D; matchObj.groups.day; &#x2F;&#x2F; 31</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥ä½¿ç”¨<code>\k&lt;ç»„å&gt;</code>å†™æ³•å’Œ<code>\1</code> æ•°å­—å¼•ç”¨</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const RE_TWICE &#x3D; &#x2F;^(?&lt;word&gt;[a-z]+)!\k&lt;word&gt;!\1$&#x2F;;</span><br><span class="line">RE_TWICE.test(&#39;abc!abc!abc&#39;) &#x2F;&#x2F; true</span><br><span class="line">RE_TWICE.test(&#39;abc!abc!ab&#39;) &#x2F;&#x2F; false</span><br></pre></td></tr></table></figure>

<h1 id="å‡½æ•°æ‹“å±•"><a href="#å‡½æ•°æ‹“å±•" class="headerlink" title="å‡½æ•°æ‹“å±•"></a>å‡½æ•°æ‹“å±•</h1><h2 id="å‡½æ•°é»˜è®¤å€¼"><a href="#å‡½æ•°é»˜è®¤å€¼" class="headerlink" title="å‡½æ•°é»˜è®¤å€¼"></a>å‡½æ•°é»˜è®¤å€¼</h2><p>åˆ©ç”¨å‡½æ•°é»˜è®¤å€¼ï¼Œå¯ä»¥æŒ‡å®šæŸä¸ªå‚æ•°ä¸å¾—çœç•¥å¦åˆ™æŠ›å‡ºå¼‚å¸¸</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">function throwIfMissing() &#123;</span><br><span class="line">  throw new Error(&#39;Missing parameter&#39;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function foo(mustBeProvided &#x3D; throwIfMissing()) &#123;</span><br><span class="line">  return mustBeProvided;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">foo()</span><br><span class="line">&#x2F;&#x2F; Error: Missing parameter</span><br></pre></td></tr></table></figure>

<h2 id="ä¸¥æ ¼æ¨¡å¼"><a href="#ä¸¥æ ¼æ¨¡å¼" class="headerlink" title="ä¸¥æ ¼æ¨¡å¼"></a>ä¸¥æ ¼æ¨¡å¼</h2><p>åªè¦å‡½æ•°å‚æ•°ä½¿ç”¨äº†é»˜è®¤å€¼ã€è§£æ„èµ‹å€¼ã€æˆ–è€…æ‰©å±•è¿ç®—ç¬¦ï¼Œé‚£ä¹ˆå‡½æ•°å†…éƒ¨å°±ä¸èƒ½æ˜¾å¼è®¾å®šä¸ºä¸¥æ ¼æ¨¡å¼</p>
<p>è§£æ³•æœ‰ï¼š1.è®¾å®šå…¨å±€ä¸¥æ ¼ 2.åŒ…åœ¨æ— å‚çš„ç«‹å³æ‰§è¡Œå‡½æ•°ä¸­</p>
<p>å°¾è°ƒç”¨ä¼˜åŒ–ï¼šä¸¥æ ¼æ¨¡å¼ä¸å«ä»¥ä¸‹å‚æ•°ï¼Œæ•…å¯ä»¥é‡‡ç”¨</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">func.argumentsï¼šè¿”å›è°ƒç”¨æ—¶å‡½æ•°çš„å‚æ•°ã€‚</span><br><span class="line">func.callerï¼šè¿”å›è°ƒç”¨å½“å‰å‡½æ•°çš„é‚£ä¸ªå‡½æ•°ã€‚</span><br></pre></td></tr></table></figure>

<h1 id="æ•°ç»„æ‹“å±•"><a href="#æ•°ç»„æ‹“å±•" class="headerlink" title="æ•°ç»„æ‹“å±•"></a>æ•°ç»„æ‹“å±•</h1><h2 id="ES5çš„ä¸€äº›å¸¸ç”¨ç”¨æ³•"><a href="#ES5çš„ä¸€äº›å¸¸ç”¨ç”¨æ³•" class="headerlink" title="ES5çš„ä¸€äº›å¸¸ç”¨ç”¨æ³•"></a>ES5çš„ä¸€äº›å¸¸ç”¨ç”¨æ³•</h2><p><code>[&#39;a&#39;,&#39;b&#39;,&#39;c&#39;].reduce((tot,cur)=&gt;tot+cur) === &#39;abc&#39;</code></p>
<h2 id="æ‹“å±•è¿ç®—ç¬¦-â€¦"><a href="#æ‹“å±•è¿ç®—ç¬¦-â€¦" class="headerlink" title="æ‹“å±•è¿ç®—ç¬¦ â€¦"></a>æ‹“å±•è¿ç®—ç¬¦ â€¦</h2><p>è¯¥è¿ç®—ç¬¦å°†ä¸€ä¸ªæ•°ç»„ï¼Œå˜ä¸ºå‚æ•°åºåˆ—ã€‚</p>
<h2 id="Array-from"><a href="#Array-from" class="headerlink" title="Array.from"></a>Array.from</h2><p><strong>ES5å†™æ³•ï¼š</strong><code>[].slice.call()</code><br><code>Array.from</code>ä¹Ÿæ˜¯<strong><code>æµ…å¤åˆ¶</code></strong><br>å°†ï¼ˆ1ï¼‰ç±»æ•°ç»„å¯¹è±¡(DOM æ“ä½œè¿”å›çš„ NodeList é›†åˆã€argumentså¯¹è±¡ )å’Œï¼ˆ2ï¼‰å¯éå†å¯¹è±¡ï¼ˆåŒ…æ‹¬set mapï¼‰è½¬ä¸ºæ•°ç»„<br>ä¾‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">let arrayLike &#x3D; &#123;</span><br><span class="line">    &#39;0&#39;: &#39;a&#39;,</span><br><span class="line">    &#39;1&#39;: &#39;b&#39;,</span><br><span class="line">    &#39;2&#39;: &#39;c&#39;,</span><br><span class="line">    length: 3&#125;;</span><br><span class="line">Array.from(arrayLike)</span><br><span class="line"></span><br><span class="line">let map &#x3D; new Map([</span><br><span class="line">  [1, &#39;one&#39;],</span><br><span class="line">  [2, &#39;two&#39;],</span><br><span class="line">  [3, &#39;three&#39;],</span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line">let arr &#x3D; [...map];</span><br></pre></td></tr></table></figure>
<p><code>Array.from</code> æ¥å—ç¬¬äºŒä¸ªå‚æ•° ç±»ä¼¼äºæ•°ç»„mapæ–¹æ³• å¯¹æ¯ä¸ªå…ƒç´ è¿›è¡Œå¤„ç†ï¼Œå†æ”¾å›æ•°ç»„</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">let arrayLike &#x3D;&#123;</span><br><span class="line">    &#39;0&#39;: 1,</span><br><span class="line">    &#39;1&#39;: 2,</span><br><span class="line">    &#39;2&#39;: 3,</span><br><span class="line">    length: 3</span><br><span class="line">&#125;</span><br><span class="line">Array.from(arrayLike , (x) &#x3D;&gt; x * x)</span><br><span class="line">&#x2F;&#x2F; [1, 4, 9]</span><br></pre></td></tr></table></figure>
<p>ç›¸æ¯”<code>Array.from().map()</code> çœç•¥äº†ä¸€ä¸ªæ­¥éª¤ï¼Œ<strong>æµ‹è¯•æ˜¾ç¤ºèŠ‚çœä¸€åŠæ—¶é—´</strong></p>
<p>åŒç†ï¼Œmapéœ€è¦ä¼ thisçš„è¯ï¼ŒArray.fromå¯ä»¥ä¼ ç¬¬ä¸‰ä¸ªå‚æ•°</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[1,2,3].map(x&#x3D;&gt;x*x,window)</span><br><span class="line">&#x2F;&#x2F;ç­‰ä»·äº</span><br><span class="line">Array.from([1,2,3] , (x) &#x3D;&gt; x * x,window)</span><br></pre></td></tr></table></figure>
<p><strong>åº”ç”¨</strong><br>è¿”å›å­—ç¬¦ä¸²é•¿åº¦ã€‚<br>ç”±äºå¤§äºâ€\uFFFFâ€çš„å­—ç¬¦çš„é•¿åº¦å¤§äº1ï¼Œè€Œæˆ‘ä»¬éœ€æ±‚ä¸€èˆ¬æ˜¯é•¿åº¦ç®—1<br>æ•…å¯ä»¥æŠŠå­—ç¬¦ä¸²è½¬ä¸ºæ•°ç»„åå¾—åˆ°å…¶æ•°ç»„å¤§å°<br><code>return Array.from(str).length</code></p>
<h2 id="Array-of"><a href="#Array-of" class="headerlink" title="Array.of"></a>Array.of</h2><p>ç”¨äºæ›¿ä»£<code>Array()</code>å’Œ<code>new Array()</code><br>å› ä¸ºåè€…æ ¹æ®å‚æ•°ä¸ªæ•°ä¸åŒè¡Œä¸ºæœ‰å¼‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Array() &#x2F;&#x2F; []</span><br><span class="line">Array(3) &#x2F;&#x2F; [, , ,]</span><br><span class="line">Array(3, 11, 8) &#x2F;&#x2F; [3, 11, 8]</span><br></pre></td></tr></table></figure>
<p>é‡‡ç”¨<code>Array.of</code>è¡¨ç°åˆ™ä¸€è‡´</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Array.of(3, 11, 8) &#x2F;&#x2F; [3,11,8]</span><br><span class="line">Array.of(3) &#x2F;&#x2F; [3]</span><br><span class="line">Array.of(3).length &#x2F;&#x2F; 1</span><br></pre></td></tr></table></figure>

<h2 id="findå’ŒfindIndex"><a href="#findå’ŒfindIndex" class="headerlink" title="findå’ŒfindIndex"></a>findå’ŒfindIndex</h2><p>findè¿”å›ç¬¬ä¸€ä¸ªè¿”å›å€¼ä¸ºtrueçš„æˆå‘˜ è‹¥æ— è¿”å›undefined</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[1, 4, -5, 10].find((n) &#x3D;&gt; n &lt; 0)</span><br><span class="line">&#x2F;&#x2F; -5</span><br><span class="line">[1, 5, 10, 15].find(function(value, index, arr) &#123;</span><br><span class="line">  return value &gt; 9;</span><br><span class="line">&#125;) &#x2F;&#x2F; 10</span><br></pre></td></tr></table></figure>
<p>findIndexè¿”å›ç¬¬ä¸€ä¸ªè¿”å›å€¼ä¸ºtrueçš„æˆå‘˜çš„ç´¢å¼•</p>
<h2 id="copyWithin"><a href="#copyWithin" class="headerlink" title="copyWithin"></a>copyWithin</h2><p>å°†æŒ‡å®šä½ç½®çš„æˆå‘˜å¤åˆ¶åˆ°å…¶ä»–ä½ç½®ï¼ˆä¼šè¦†ç›–åŸæœ‰æˆå‘˜ï¼‰ï¼Œç„¶åè¿”å›å½“å‰æ•°ç»„</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Array.prototype.copyWithin(target, start &#x3D; 0, end &#x3D; this.length)</span><br></pre></td></tr></table></figure>
<p>å®ƒæ¥å—ä¸‰ä¸ªå‚æ•°ã€‚</p>
<p>targetï¼ˆå¿…éœ€ï¼‰ï¼šä»è¯¥ä½ç½®å¼€å§‹æ›¿æ¢æ•°æ®ã€‚<br>startï¼ˆå¯é€‰ï¼‰ï¼šä»è¯¥ä½ç½®å¼€å§‹è¯»å–æ•°æ®ï¼Œé»˜è®¤ä¸º 0ã€‚å¦‚æœä¸ºè´Ÿå€¼ï¼Œè¡¨ç¤ºå€’æ•°ã€‚<br>endï¼ˆå¯é€‰ï¼‰ï¼šåˆ°è¯¥ä½ç½®å‰åœæ­¢è¯»å–æ•°æ®ï¼Œé»˜è®¤ç­‰äºæ•°ç»„é•¿åº¦ã€‚å¦‚æœä¸ºè´Ÿå€¼ï¼Œè¡¨ç¤ºå€’æ•°ã€‚</p>
<h2 id="fill"><a href="#fill" class="headerlink" title="fill"></a>fill</h2><p>ä½¿ç”¨ç»™å®šå€¼ï¼Œå¡«å……ä¸€ä¸ªæ•°ç»„</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">new Array(3).fill(7) &#x2F;&#x2F;[7,7,7]</span><br></pre></td></tr></table></figure>
<h2 id="keys-values-entries"><a href="#keys-values-entries" class="headerlink" title="keys() values() entries()"></a>keys() values() entries()</h2><h1 id="å¯¹è±¡çš„æ‹“å±•"><a href="#å¯¹è±¡çš„æ‹“å±•" class="headerlink" title="å¯¹è±¡çš„æ‹“å±•"></a>å¯¹è±¡çš„æ‹“å±•</h1><h2 id="Object-is"><a href="#Object-is" class="headerlink" title="Object.is()"></a>Object.is()</h2><p>ä¸===ç›¸æ¯” ä¸åŒä¹‹å¤„ä¸ºï¼š<strong>ä¸€æ˜¯+0ä¸ç­‰äº-0ï¼ŒäºŒæ˜¯NaNç­‰äºè‡ªèº«</strong></p>
<p>es5å¯ä»¥ç”¨</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">function(x, y) &#123;</span><br><span class="line">    if (x &#x3D;&#x3D;&#x3D; y) &#123;</span><br><span class="line">      &#x2F;&#x2F; é’ˆå¯¹+0 ä¸ç­‰äº -0çš„æƒ…å†µ</span><br><span class="line">      return x !&#x3D;&#x3D; 0 || 1 &#x2F; x &#x3D;&#x3D;&#x3D; 1 &#x2F; y;</span><br><span class="line">    &#125;</span><br><span class="line">    &#x2F;&#x2F; é’ˆå¯¹NaNçš„æƒ…å†µ</span><br><span class="line">    return x !&#x3D;&#x3D; x &amp;&amp; y !&#x3D;&#x3D; y;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<h2 id="Object-create"><a href="#Object-create" class="headerlink" title="Object.create"></a>Object.create</h2><blockquote>
<p>ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºåˆ›å»ºå¯¹è±¡çš„åŸå‹å¯¹è±¡<br>ä¼ å…¥nullæ—¶ï¼Œè¿”å›çš„æ˜¯ä¸€ä¸ªæ²¡æœ‰åŸå‹çš„å¯¹è±¡ï¼ˆæ§åˆ¶å°è°ƒè¯•ä¸‹ï¼Œ{}æ˜¾ç¤º No properties ï¼‰<br>è€Œåˆ›å»ºçš„{}ä¼šæœ‰åŸå‹</p>
</blockquote>
<p><code>({}).__proto__ ä¸ºä¸€ä¸ªå¯¹è±¡ ,Object.create(null).__proto__===undefined</code></p>
<h1 id="async-å‡½æ•°"><a href="#async-å‡½æ•°" class="headerlink" title="async å‡½æ•°"></a>async å‡½æ•°</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">async function test()&#123;</span><br><span class="line">	await new Promise((res,rej)&#x3D;&gt;rej())</span><br><span class="line">	console.log(&#39;hello&#39;)</span><br><span class="line">	await new Promise((res,rej)&#x3D;&gt;res())</span><br><span class="line">&#125;</span><br><span class="line">test()</span><br><span class="line">&#x2F;&#x2F;è¿”å› Promise &#123;[[PromiseStatus]]: &quot;rejected&quot;, [[PromiseValue]]: undefined&#125;</span><br></pre></td></tr></table></figure>
<p>asyncçš„æ˜¯promiseå¯¹è±¡ï¼Œå…¶ä¸­ä¸€æ­¥è¿”å›æˆ–è€…æŠ›å‡ºé”™è¯¯ï¼ˆreject,errorï¼‰åˆ™çŠ¶æ€æ”¹å˜,testæ‰§è¡Œthen/catchå›è°ƒ</p>
<h2 id="await"><a href="#await" class="headerlink" title="await"></a>await</h2><p>å…¶åæ¥ä¸€ä¸ªpromiseå¯¹è±¡ï¼Œéåˆ™è½¬</p>
<p>å®ç°é‡è¯•æ¬¡æ•°åŠŸèƒ½</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const superagent &#x3D; require(&#39;superagent&#39;);</span><br><span class="line">const NUM_RETRIES &#x3D; 3;</span><br><span class="line"></span><br><span class="line">async function test() &#123;</span><br><span class="line">  let i;</span><br><span class="line">  for (i &#x3D; 0; i &lt; NUM_RETRIES; ++i) &#123;</span><br><span class="line">    try &#123;</span><br><span class="line">      await superagent.get(&#39;http:&#x2F;&#x2F;google.com&#x2F;this-throws-an-error&#39;);</span><br><span class="line">      break;</span><br><span class="line">    &#125; catch(err) &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">  console.log(i); &#x2F;&#x2F; 3</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">test();</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢ä»£ç ä¸­ï¼Œå¦‚æœawaitæ“ä½œæˆåŠŸï¼Œå°±ä¼šä½¿ç”¨breakè¯­å¥é€€å‡ºå¾ªç¯ï¼›å¦‚æœå¤±è´¥ï¼Œä¼šè¢«catchè¯­å¥æ•æ‰ï¼Œç„¶åè¿›å…¥ä¸‹ä¸€è½®å¾ªç¯ã€‚</p>
<h2 id="æ³¨æ„ç‚¹"><a href="#æ³¨æ„ç‚¹" class="headerlink" title="æ³¨æ„ç‚¹"></a>æ³¨æ„ç‚¹</h2><p>å½“ä¸¤ä¸ªå¼‚æ­¥æ“ä½œæ— ç»§å‘å…³ç³»ï¼ˆæ•°æ®å­˜åœ¨ä¾èµ–ï¼‰ï¼Œå¯ä»¥åˆ©ç”¨<code>Promise.all</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">let foo &#x3D; await getFoo();</span><br><span class="line">let bar &#x3D; await getBar();</span><br><span class="line">&#x2F;&#x2F;æ”¹ä¸º</span><br><span class="line">let [foo, bar] &#x3D; await Promise.all([getFoo(), getBar()]);</span><br></pre></td></tr></table></figure>

<h1 id="Symbol"><a href="#Symbol" class="headerlink" title="Symbol"></a>Symbol</h1><p>Symbolå‡½æ•°çš„å‚æ•°åªæ˜¯è¡¨ç¤ºå¯¹å½“å‰ Symbol å€¼çš„æè¿°ï¼Œå› æ­¤ç›¸åŒå‚æ•°çš„Symbolå‡½æ•°çš„è¿”å›å€¼æ˜¯ä¸ç›¸ç­‰çš„</p>
<h2 id="Symbol-ä½œä¸ºå±æ€§å"><a href="#Symbol-ä½œä¸ºå±æ€§å" class="headerlink" title="Symbol ä½œä¸ºå±æ€§å"></a>Symbol ä½œä¸ºå±æ€§å</h2><p>1.ä¸èƒ½ç”¨ç‚¹è¿ç®—ç¬¦</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const mySymbol &#x3D; Symbol();</span><br><span class="line">a.mySymbol &#x3D; &#39;Hello!&#39;; &#x2F;&#x2F;å®é™…æ˜¯æŒ‡a[&#39;mySymbol&#39;] ä¸ºå­—ç¬¦ä¸²å±æ€§ ésymbolå±æ€§</span><br></pre></td></tr></table></figure>

<p>2.ä½¿ç”¨ Symbol å€¼å®šä¹‰å±æ€§æ—¶ï¼ŒSymbol å€¼å¿…é¡»æ”¾åœ¨æ–¹æ‹¬å·ä¹‹ä¸­ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">let s &#x3D; Symbol()</span><br><span class="line">let ss &#x3D; Symbol()</span><br><span class="line">let obj &#x3D; &#123;</span><br><span class="line">  [s]:function(arg)&#123;&#125;,</span><br><span class="line">  [ss]:33</span><br><span class="line">&#125;</span><br><span class="line">obj[s](123)</span><br><span class="line">obj[ss]</span><br></pre></td></tr></table></figure>

<p>3.ç”¨äºå®šä¹‰å¸¸é‡</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">log.levels &#x3D; &#123;</span><br><span class="line">  DEBUG: Symbol(&#39;debug&#39;),</span><br><span class="line">  INFO: Symbol(&#39;info&#39;),</span><br><span class="line">  WARN: Symbol(&#39;warn&#39;)</span><br><span class="line">&#125;;</span><br><span class="line">log(log.levels.DEBUG, &#39;debug message&#39;);</span><br><span class="line">log(log.levels.INFO, &#39;info message&#39;);</span><br></pre></td></tr></table></figure>
<p><strong>æ³¨</strong> Symbolä½œä¸ºå±æ€§åï¼Œè¯¥å±æ€§æ˜¯å…¬å¼€å±æ€§</p>
<h2 id="å±æ€§åéå†"><a href="#å±æ€§åéå†" class="headerlink" title="å±æ€§åéå†"></a>å±æ€§åéå†</h2><p>Symbol ä½œä¸ºå±æ€§åï¼Œè¯¥å±æ€§ä¸ä¼šå‡ºç°åœ¨forâ€¦inã€forâ€¦ofå¾ªç¯ï¼Œä¹Ÿä¸ä¼šè¢«Object.keys()ã€Object.getOwnPropertyNames()ã€JSON.stringify()è¿”å›</p>
<p>ä½†æ˜¯ï¼Œå®ƒä¹Ÿä¸æ˜¯ç§æœ‰å±æ€§ï¼Œæœ‰ä¸€ä¸ªObject.getOwnPropertySymbolsæ–¹æ³•ï¼Œå¯ä»¥è·å–æŒ‡å®šå¯¹è±¡çš„æ‰€æœ‰ Symbol å±æ€§åã€‚</p>
<h2 id="Symbol-for-ã€Symbol-keyFor"><a href="#Symbol-for-ã€Symbol-keyFor" class="headerlink" title="Symbol.for()ã€Symbol.keyFor()"></a>Symbol.for()ã€Symbol.keyFor()</h2><p>é‡æ–°ä½¿ç”¨åŒä¸€ä¸ªSymbolå€¼ã€‚</p>
<p><code>Symbol.for(&#39;test&#39;)</code> æœç´¢æ˜¯å¦æœ‰ä»¥<code>test</code>ä¸ºå‚æ•°çš„ Symbol å€¼ï¼Œæœ‰åˆ™è¿”å›æ— åˆ™åˆ›å»ºå¹¶ç™»è®°åˆ°å…¨å±€</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> s1 = <span class="built_in">Symbol</span>.for(<span class="string">'foo'</span>);</span><br><span class="line"><span class="keyword">let</span> s2 = <span class="built_in">Symbol</span>.for(<span class="string">'foo'</span>);</span><br><span class="line"></span><br><span class="line">s1 === s2 <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">Symbol</span>(<span class="string">'foo'</span>) === <span class="built_in">Symbol</span>.for(<span class="string">'foo'</span>) <span class="comment">//false</span></span><br><span class="line"><span class="comment">//åŸå› æ˜¯Symbol()æ²¡æœ‰ç™»è®°æœºåˆ¶ï¼Œåé¢Symbol.for()å°†æœç´¢ä¸åˆ°</span></span><br></pre></td></tr></table></figure>

<p><code>Symbol.keyFor</code>æ–¹æ³•è¿”å›ä¸€ä¸ªå·²ç™»è®°çš„ Symbol ç±»å‹å€¼çš„<code>key</code>,æ— åˆ™è¿”å›undefinedã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">let s1 &#x3D; Symbol.for(&quot;foo&quot;);</span><br><span class="line">Symbol.keyFor(s1) &#x2F;&#x2F; &quot;foo&quot;</span><br></pre></td></tr></table></figure>

<p><strong>æ³¨</strong> Symbol.for()æ³¨å†Œçš„symbolå€¼æ˜¯å…¨å±€ç¯å¢ƒçš„ ï¼ˆiframe ä¸­æ³¨å†Œçš„ä¸»é¡µé¢ä¹Ÿè·å–çš„åˆ°</p>
<h1 id="Reflect"><a href="#Reflect" class="headerlink" title="Reflect"></a>Reflect</h1><h2 id="è®©Objectæ“ä½œéƒ½å˜æˆå‡½æ•°è¡Œä¸º"><a href="#è®©Objectæ“ä½œéƒ½å˜æˆå‡½æ•°è¡Œä¸º" class="headerlink" title="è®©Objectæ“ä½œéƒ½å˜æˆå‡½æ•°è¡Œä¸º"></a>è®©Objectæ“ä½œéƒ½å˜æˆå‡½æ•°è¡Œä¸º</h2><p>å¦‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">delete obj[name]</span><br><span class="line">æ–°å†™æ³•</span><br><span class="line">Reflect.deleteProperty(obj, name)</span><br></pre></td></tr></table></figure>

<h2 id="ä¸Proxyä¸Šçš„æ–¹æ³•ä¸€ä¸€å¯¹åº”"><a href="#ä¸Proxyä¸Šçš„æ–¹æ³•ä¸€ä¸€å¯¹åº”" class="headerlink" title="ä¸Proxyä¸Šçš„æ–¹æ³•ä¸€ä¸€å¯¹åº”"></a>ä¸Proxyä¸Šçš„æ–¹æ³•ä¸€ä¸€å¯¹åº”</h2><p>Proxyä¸­å¯ä»¥è°ƒç”¨Reflectæ–¹æ³•ï¼Œå»å®Œæˆé»˜è®¤è¡Œä¸º</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Proxy(&#123;&#125;,&#123;</span><br><span class="line">  set:function(t,n,v)&#123;</span><br><span class="line">    let suc &#x3D; Reflect.set(t,n,v)</span><br><span class="line">    if(suc)&#123;</span><br><span class="line">      log(..)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="Reflect-set-target-name-value-receiver"><a href="#Reflect-set-target-name-value-receiver" class="headerlink" title="Reflect.set(target, name, value, receiver)"></a>Reflect.set(target, name, value, receiver)</h3><p><code>Reflect.set</code>æ–¹æ³•è®¾ç½®<code>target</code>å¯¹è±¡çš„ name å±æ€§ç­‰äº value</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">var myObject &#x3D; &#123;</span><br><span class="line">  foo: 4,</span><br><span class="line">  set bar(value) &#123;</span><br><span class="line">    return this.foo &#x3D; value;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">var myReceiverObject &#x3D; &#123;</span><br><span class="line">  foo: 0,</span><br><span class="line">&#125;;</span><br><span class="line">myObject.foo &#x2F;&#x2F; 4</span><br><span class="line"></span><br><span class="line">Reflect.set(myObject, &#39;foo&#39;, 2);</span><br><span class="line">myObject.foo &#x2F;&#x2F; 2</span><br><span class="line"></span><br><span class="line">Reflect.set(myObject, &#39;bar&#39;, 1, myReceiverObject);</span><br><span class="line">myObject.foo &#x2F;&#x2F; 2</span><br><span class="line">myReceiverObject.foo &#x2F;&#x2F; 1</span><br><span class="line"></span><br><span class="line">Reflect.set(myObject, &#39;foo&#39;, 3, myReceiverObject);</span><br><span class="line">myObject.foo &#x2F;&#x2F;2</span><br><span class="line">myReceiverObject.foo &#x2F;&#x2F;3</span><br></pre></td></tr></table></figure>
<p>å«receiverå‚æ•°çš„æ—¶å€™ï¼Œè‹¥nameå±æ€§å¯èµ‹å€¼æˆ–è®¾ç½®äº†èµ‹å€¼å‡½æ•°ï¼Œåˆ™è¯¥nameå±æ€§æˆ–nameå±æ€§å¯¹åº”çš„èµ‹å€¼å‡½æ•°çš„thisç»‘å®šreceiver</p>
<h3 id="Proxy-ä¸-Reflectä¸€èµ·ä½¿ç”¨"><a href="#Proxy-ä¸-Reflectä¸€èµ·ä½¿ç”¨" class="headerlink" title="Proxy ä¸ Reflectä¸€èµ·ä½¿ç”¨"></a>Proxy ä¸ Reflectä¸€èµ·ä½¿ç”¨</h3><p><strong>æ³¨æ„ï¼š</strong> Proxyçš„æ–¹æ³•ä¸­çš„<code>receiver</code> æ€»æ˜¯æŒ‡å‘<code>å½“å‰çš„Proxyå®ä¾‹</code></p>
<p>æ‰€ä»¥è‹¥Proxyçš„setæ–¹æ³•å«æœ‰<code>receiverå‚æ•°</code>ï¼Œæ‰§è¡Œ<code>Reflect.set</code> æ—¶ï¼Œä¼šå°†å±æ€§èµ‹å€¼ç»™ receiver ä¸Šé¢ï¼ˆå³Proxyå®ä¾‹ï¼‰ï¼Œå³è§¦å‘<code>Proxy.defineProperty</code></p>
<h1 id="å­—ç¬¦ä¸²çš„æ‹“å±•"><a href="#å­—ç¬¦ä¸²çš„æ‹“å±•" class="headerlink" title="å­—ç¬¦ä¸²çš„æ‹“å±•"></a>å­—ç¬¦ä¸²çš„æ‹“å±•</h1><h2 id="å¤ä¹ ä¸‹-es5-çš„ä¸€äº›ç”¨æ³•"><a href="#å¤ä¹ ä¸‹-es5-çš„ä¸€äº›ç”¨æ³•" class="headerlink" title="å¤ä¹ ä¸‹ es5 çš„ä¸€äº›ç”¨æ³•"></a>å¤ä¹ ä¸‹ es5 çš„ä¸€äº›ç”¨æ³•</h2><h3 id="åˆ‡å‰²å­—ç¬¦ä¸²"><a href="#åˆ‡å‰²å­—ç¬¦ä¸²" class="headerlink" title="åˆ‡å‰²å­—ç¬¦ä¸²"></a>åˆ‡å‰²å­—ç¬¦ä¸²</h3><blockquote>
<p>substr(start,len)<br>substring(start,end) </p>
</blockquote>
<h2 id="codePointAt"><a href="#codePointAt" class="headerlink" title="codePointAt()"></a>codePointAt()</h2><p>Unicode ç  å¤§äº 0xFFFF çš„å­—ç¬¦ ï¼Œç”±4ä¸ªå­—èŠ‚å­˜å‚¨</p>
<p>æ•…</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&quot;\u&#123;20BB7&#125;&quot; &#x2F;&#x2F;&quot;ğ ®·&quot;  ç”¨&#123;&#125;æ¥åŒ…è£… å¯ä»¥è¡¨ç¤ºåŒå­—èŠ‚ã€‚</span><br><span class="line">var s &#x3D; &quot;ğ ®·&quot;;</span><br><span class="line"></span><br><span class="line">s.length &#x2F;&#x2F; 2</span><br><span class="line">s.charAt(0) &#x2F;&#x2F; &#39;&#39;</span><br><span class="line">s.charAt(1) &#x2F;&#x2F; &#39;&#39;</span><br><span class="line">s.charCodeAt(0) &#x2F;&#x2F; 55362</span><br><span class="line">s.charCodeAt(1) &#x2F;&#x2F; 57271</span><br></pre></td></tr></table></figure>

<p>åˆ©ç”¨<code>codePointAt</code>å¯ä»¥æ‹¿åˆ° Unicodeç </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">let s &#x3D; &#39;ğ ®·a&#39;;</span><br><span class="line"></span><br><span class="line">s.codePointAt(0) &#x2F;&#x2F; 134071</span><br><span class="line">s.codePointAt(1) &#x2F;&#x2F; 57271</span><br><span class="line"></span><br><span class="line">s.codePointAt(2) &#x2F;&#x2F; 97</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·å†™çš„è¯ä¸å¤Ÿè‡ªåŠ¨ï¼Œå› ä¸ºä¸çŸ¥é“æ˜¯å¦è¯¥è·³è¿‡ï¼ˆå¦‚At(1)ï¼‰.</p>
<p>ä½¿ç”¨<code>for of</code>æ­£ç¡®è·å–</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">let s &#x3D; &#39;ğ ®·a&#39;;</span><br><span class="line">for (let ch of s) &#123;</span><br><span class="line">  console.log(ch.codePointAt(0).toString(16));</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;&#x2F; 20bb7</span><br><span class="line">&#x2F;&#x2F; 61</span><br></pre></td></tr></table></figure>

<p><code>String.fromCodePoint(0x20BB7)</code> ç”¨æ¥è§£å†³es5çš„<code>String.fromCharCode(0x20BB7)</code>ä¸èƒ½è¯†åˆ«32ä½å­—ç¬¦çš„é—®é¢˜</p>
<h2 id="includes-startsWith-endsWith"><a href="#includes-startsWith-endsWith" class="headerlink" title="includes(), startsWith(), endsWith()"></a>includes(), startsWith(), endsWith()</h2><p>å‚æ•°ï¼š <code>str,startIndex:å¼€å§‹æœç´¢çš„ä½ç½®</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">let s &#x3D; &#39;Hello world!&#39;;</span><br><span class="line"></span><br><span class="line">s.startsWith(&#39;world&#39;, 6) &#x2F;&#x2F; true</span><br><span class="line">s.endsWith(&#39;Hello&#39;, 5) &#x2F;&#x2F; true</span><br><span class="line">s.includes(&#39;Hello&#39;, 6) &#x2F;&#x2F; false</span><br></pre></td></tr></table></figure>

<h2 id="æ¨¡æ¿å­—ç¬¦ä¸²"><a href="#æ¨¡æ¿å­—ç¬¦ä¸²" class="headerlink" title="æ¨¡æ¿å­—ç¬¦ä¸²"></a>æ¨¡æ¿å­—ç¬¦ä¸²</h2><p>ä½¿ç”¨ <strong>`</strong>  ä¿ç•™æ¢è¡Œ</p>
<p>å˜é‡åå†™åœ¨<code>${}</code>ä¸­,<code>{}</code>ä¸­å¯ä»¥å†™ä»»ä½•jsä»£ç </p>
<p>æ¨¡æ¿å­—ç¬¦ä¸²å¯åµŒå¥—</p>
<h2 id="å®ä¾‹ï¼šæ¨¡æ¿ç¼–è¯‘"><a href="#å®ä¾‹ï¼šæ¨¡æ¿ç¼–è¯‘" class="headerlink" title="å®ä¾‹ï¼šæ¨¡æ¿ç¼–è¯‘"></a>å®ä¾‹ï¼šæ¨¡æ¿ç¼–è¯‘</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> templateStr = <span class="string">`</span></span><br><span class="line"><span class="string">&lt;ul class="users"&gt;</span></span><br><span class="line"><span class="string">  &lt;% users.forEach((user) =&gt; &#123; %&gt;</span></span><br><span class="line"><span class="string">    &lt;li class="user-item"&gt;</span></span><br><span class="line"><span class="string">      &lt;%= 'My name is ' + user.name %&gt;</span></span><br><span class="line"><span class="string">    &lt;/li&gt;</span></span><br><span class="line"><span class="string">  &lt;% &#125;) %&gt;</span></span><br><span class="line"><span class="string">&lt;/ul&gt;</span></span><br><span class="line"><span class="string">`</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> data = &#123;</span><br><span class="line">  users: [</span><br><span class="line">    &#123; <span class="attr">name</span>: <span class="string">'Jerry'</span>, <span class="attr">age</span>: <span class="number">12</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">name</span>: <span class="string">'Lucy'</span>, <span class="attr">age</span>: <span class="number">13</span> &#125;, </span><br><span class="line">    &#123; <span class="attr">name</span>: <span class="string">'Tomy'</span>, <span class="attr">age</span>: <span class="number">14</span> &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">render(templateStr, data)</span><br><span class="line"><span class="comment">/*è¿”å›ç»“æœï¼š</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">&lt;ul class="users"&gt;</span></span><br><span class="line"><span class="comment">  &lt;li class="user-item"&gt;</span></span><br><span class="line"><span class="comment">    My name is Jerry</span></span><br><span class="line"><span class="comment">  &lt;/li&gt;</span></span><br><span class="line"><span class="comment">  &lt;li class="user-item"&gt;</span></span><br><span class="line"><span class="comment">    My name is Lucy</span></span><br><span class="line"><span class="comment">  &lt;/li&gt;</span></span><br><span class="line"><span class="comment">  &lt;li class="user-item"&gt;</span></span><br><span class="line"><span class="comment">    My name is Tomy</span></span><br><span class="line"><span class="comment">  &lt;/li&gt;</span></span><br><span class="line"><span class="comment">&lt;/ul&gt;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>æ€è·¯</strong> å°†å…¶è½¬æˆï¼š</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">`</span></span><br><span class="line"><span class="comment">$&#123;</span></span><br><span class="line"><span class="comment">echo('&lt;ul class="users"&gt;')</span></span><br><span class="line"><span class="comment">  users.forEach((user) =&gt; &#123;</span></span><br><span class="line"><span class="comment">    echo('&lt;li class="user-item"&gt;')</span></span><br><span class="line"><span class="comment">      echo('My name is ' + user.name)</span></span><br><span class="line"><span class="comment">    echo('&lt;/li&gt;')</span></span><br><span class="line"><span class="comment">  &#125;)</span></span><br><span class="line"><span class="comment">&lt;/ul&gt;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">`</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">//å®šä¹‰echoå‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">echo</span>(<span class="params">html</span>)</span>&#123;</span><br><span class="line">  output += html;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ä»£ç å®ç°</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> render = <span class="function">(<span class="params">template, data</span>) =&gt;</span> <span class="comment">/* TODO */</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">let</span> exp0 = <span class="regexp">/&lt;%=(.+)%&gt;/g</span></span><br><span class="line">  <span class="keyword">let</span> exp1 = <span class="regexp">/&lt;%(.+)%&gt;/g</span></span><br><span class="line">  template = template.replace(exp0,<span class="string">'`);\n echo($1) \n echo(`'</span>).replace(exp1,<span class="string">'`);\n $1 \n echo(`'</span>)</span><br><span class="line">  template = <span class="string">'echo(`'</span> + template +<span class="string">'`)'</span></span><br><span class="line">  <span class="comment">//$&#123;template&#125;çš„ç»“æœä¸º è°ƒç”¨è‹¥å¹²echoå‡½æ•°</span></span><br><span class="line">  <span class="keyword">let</span> comp = <span class="string">`</span></span><br><span class="line"><span class="string">  let html = ''</span></span><br><span class="line"><span class="string">  function echo(t)&#123;</span></span><br><span class="line"><span class="string">    html+=t</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">  <span class="subst">$&#123;template&#125;</span></span></span><br><span class="line"><span class="string">  return html</span></span><br><span class="line"><span class="string">  `</span></span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Function</span>(...Object.keys(data),comp)(...Object.values(data))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="æ ‡ç­¾æ¨¡æ¿"><a href="#æ ‡ç­¾æ¨¡æ¿" class="headerlink" title="æ ‡ç­¾æ¨¡æ¿"></a>æ ‡ç­¾æ¨¡æ¿</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">tag</span>(<span class="params">s, v1, v2</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(s[<span class="number">0</span>]);</span><br><span class="line">  <span class="built_in">console</span>.log(s[<span class="number">1</span>]);</span><br><span class="line">  <span class="built_in">console</span>.log(s[<span class="number">2</span>]);</span><br><span class="line">  <span class="built_in">console</span>.log(v1);</span><br><span class="line">  <span class="built_in">console</span>.log(v2);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="string">"OK"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// "Hello "</span></span><br><span class="line"><span class="comment">// " world "</span></span><br><span class="line"><span class="comment">// ""</span></span><br><span class="line"><span class="comment">// 15</span></span><br><span class="line"><span class="comment">// 50</span></span><br><span class="line"><span class="comment">// "OK"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> a = <span class="number">5</span>;</span><br><span class="line"><span class="keyword">let</span> b = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">tag<span class="string">`Hello <span class="subst">$&#123; a + b &#125;</span> world <span class="subst">$&#123; a * b&#125;</span>`</span> <span class="comment">//æœ€åé¢éœ€è¦è¿˜æœ‰ä¸€ä¸ªä¸è¢«å˜é‡æ›¿æ¢çš„''</span></span><br><span class="line"><span class="comment">//ç­‰ä»·äº</span></span><br><span class="line">tag([<span class="string">'Hello '</span>, <span class="string">' world '</span>, <span class="string">''</span>], <span class="number">15</span>, <span class="number">50</span>)</span><br></pre></td></tr></table></figure>

<p><strong>åº”ç”¨ï¼š</strong> è¿‡æ»¤htmlå­—ç¬¦ä¸²ï¼Œé˜²æ­¢ç”¨æˆ·è¾“å…¥æ¶æ„å†…å®¹</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">function SaferHTML(templateData,...values) &#123;</span><br><span class="line">  let s &#x3D; &#39;&#39;;</span><br><span class="line">  let i &#x3D; 0</span><br><span class="line">  for (; i &lt; values.length; i++) &#123;</span><br><span class="line">    s +&#x3D; templateData[i];</span><br><span class="line">    let arg &#x3D; String(values[i]);</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; Escape special characters in the substitution.</span><br><span class="line">    s +&#x3D; arg.replace(&#x2F;&amp;&#x2F;g, &quot;&amp;&quot;)</span><br><span class="line">            .replace(&#x2F;&lt;&#x2F;g, &quot;&lt;&quot;)</span><br><span class="line">            .replace(&#x2F;&gt;&#x2F;g, &quot;&gt;&quot;);</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; Don&#39;t escape special characters in the template.</span><br><span class="line">    </span><br><span class="line">  &#125;</span><br><span class="line">  return s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">let sender &#x3D; &#39;&lt;script&gt;alert(&quot;abc&quot;)&lt;&#x2F;script&gt;&#39;; &#x2F;&#x2F; æ¶æ„ä»£ç </span><br><span class="line">let message &#x3D; SaferHTML&#96;&lt;p&gt;$&#123;sender&#125; has sent you a message.&lt;&#x2F;p&gt;&#96;;</span><br><span class="line"></span><br><span class="line">message</span><br><span class="line">&#x2F;&#x2F; &lt;p&gt;&lt;script&gt;alert(&quot;abc&quot;)&lt;&#x2F;script&gt; has sent you a message.&lt;&#x2F;p&gt;</span><br></pre></td></tr></table></figure>



<h1 id="Class"><a href="#Class" class="headerlink" title="Class"></a>Class</h1><p>ES5çš„åŸå‹é“¾ç»§æ‰¿</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">function Parent()&#123;</span><br><span class="line">  this.name &#x3D; &#39;parent&#39;</span><br><span class="line">&#125;</span><br><span class="line">function Child()&#123;</span><br><span class="line">  this.name &#x3D; &#39;child&#39;</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;&#x2F; ç”¨å­ç±»çš„åŸå‹å¯¹è±¡ç­‰äºçˆ¶ç±»çš„å®ä¾‹</span><br><span class="line">&#x2F;&#x2F; åˆ™å­ç±»åŸå‹æ‹¥æœ‰çˆ¶ç±»çš„æ‰€æœ‰å®ä¾‹å±æ€§å’Œå®ä¾‹æ–¹æ³•,å³Child.prototype.name &#x3D; &#39;parent&#39;</span><br><span class="line">Child.prototype &#x3D; new Parent()</span><br><span class="line">&#x2F;&#x2F; å®ä¾‹è°ƒç”¨æ–¹æ³•ï¼Œå…ˆå»æ‰¾å®ä¾‹æ–¹æ³• å†å»æ‰¾åŸå‹æ–¹æ³•</span><br></pre></td></tr></table></figure>

<h1 id="Set-amp-Map"><a href="#Set-amp-Map" class="headerlink" title="Set &amp; Map"></a>Set &amp; Map</h1><h2 id="Set"><a href="#Set" class="headerlink" title="Set"></a>Set</h2><p>ç”¨äºå»é‡ï¼Œå¯ä»¥å­˜å‚¨ä»»æ„ç±»å‹çš„å€¼</p>
<p>Set å­˜å‚¨å¯¹è±¡ï¼Œä¼šå­˜åœ¨ä¸€ä¸ªå¼•ç”¨ï¼Œå¯¼è‡´è¯¥å¯¹è±¡æ— æ³•è¢«åƒåœ¾å›æ”¶ï¼Œä½¿ç”¨æ—¶éœ€è¦æ³¨æ„æ‰‹åŠ¨åˆ é™¤å¼•ç”¨(ä» set ä¸­delete)</p>
<h2 id="WeakSet"><a href="#WeakSet" class="headerlink" title="WeakSet"></a>WeakSet</h2><p>åªèƒ½å­˜å‚¨å¯¹è±¡</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> ws = <span class="keyword">new</span> <span class="built_in">WeakSet</span>();</span><br><span class="line">ws.add(<span class="number">1</span>)</span><br><span class="line"><span class="comment">// TypeError: Invalid value used in weak set</span></span><br><span class="line">ws.add(<span class="built_in">Symbol</span>())</span><br><span class="line"><span class="comment">// TypeError: invalid value used in weak set</span></span><br></pre></td></tr></table></figure>
<p>åƒåœ¾å›æ”¶æœºåˆ¶ä¸è€ƒè™‘ WeakSet å¯¹è¯¥å¯¹è±¡çš„å¼•ç”¨</p>
<p>WeakSet å†…éƒ¨æœ‰å¤šå°‘ä¸ªæˆå‘˜ï¼Œå–å†³äºåƒåœ¾å›æ”¶æœºåˆ¶æœ‰æ²¡æœ‰è¿è¡Œï¼Œè¿è¡Œå‰åå¾ˆå¯èƒ½æˆå‘˜ä¸ªæ•°æ˜¯ä¸ä¸€æ ·çš„ï¼Œè€Œåƒåœ¾å›æ”¶æœºåˆ¶ä½•æ—¶è¿è¡Œæ˜¯ä¸å¯é¢„æµ‹çš„ï¼Œå› æ­¤ ES6 è§„å®š WeakSet <strong>ä¸å¯éå†</strong></p>
<p>ä½¿ç”¨åœºæ™¯ï¼š</p>
<ul>
<li>å­˜å‚¨ DOM èŠ‚ç‚¹</li>
</ul>
<p>ä¸¾ä¾‹</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> weakSet = <span class="keyword">new</span> <span class="built_in">WeakSet</span>()</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">set</span> = new Set()</span><br><span class="line">class Foo &#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> foo1 = <span class="keyword">new</span> Foo()</span><br><span class="line"><span class="keyword">let</span> foo2 = <span class="keyword">new</span> Foo()</span><br><span class="line">weakSet.add(foo1)</span><br><span class="line"><span class="keyword">set</span>.add(foo2)</span><br><span class="line">foo1 = null</span><br><span class="line">foo2 = null</span><br><span class="line"></span><br><span class="line">// è§‚å¯Ÿè¾“å‡ºçš„ç»“æœ</span><br><span class="line">// <span class="keyword">set</span> ä¸­æœ‰å…ƒç´ ï¼Œ weakSet ä¸­æ²¡æœ‰å…ƒç´ </span><br><span class="line">console.log(weakSet)</span><br><span class="line">console.log(<span class="keyword">set</span>)</span><br><span class="line"></span><br><span class="line">// å¦‚æœ weakSet ä¸­ä¹Ÿæœ‰å…ƒç´ ï¼Œåº”è¯¥æ˜¯è¿˜æ²¡æœ‰è§¦å‘åƒåœ¾å›æ”¶</span><br><span class="line">// æ‰‹åŠ¨è§¦å‘ GC -- Chrome Performance æ ‡ç­¾é¡µç‚¹å‡» Collect garbage</span><br></pre></td></tr></table></figure>

<h2 id="Map-amp-WeakMap"><a href="#Map-amp-WeakMap" class="headerlink" title="Map &amp; WeakMap"></a>Map &amp; WeakMap</h2><p>ä¸ Set/WeakSet ç±»ä¼¼ï¼Œåªæ˜¯å˜æˆå­˜å‚¨ k-v</p>
<p>åƒåœ¾å›æ”¶æœºåˆ¶ä¸è€ƒè™‘ WeakSet å¯¹ key å¯¹è±¡çš„å¼•ç”¨ </p>
]]></content>
      <categories>
        <category>å¤§å‰ç«¯</category>
      </categories>
      <tags>
        <tag>ECMAScript</tag>
      </tags>
  </entry>
  <entry>
    <title>è¶£å‘³js-åªç”¨ç‰¹æ®Šå­—ç¬¦ç”Ÿæˆä»»æ„å­—ç¬¦ä¸²</title>
    <url>/2018/01/07/2018Q1/%E8%B6%A3%E5%91%B3js-%E5%8F%AA%E7%94%A81%E5%92%8C%E7%89%B9%E6%AE%8A%E5%AD%97%E7%AC%A6%E7%94%9F%E6%88%90%E5%AD%97%E7%AC%A6%E4%B8%B2/</url>
    <content><![CDATA[<p><strong>180306æ›´æ–°</strong>ï¼šå‘ç°æœ‰ä¸ª<code>http://www.jsfuck.com/</code> ,ä¸Šé¢å°±åšäº†æˆ‘æƒ³åšçš„ä¸œè¥¿ã€‚ä¹Ÿæ‰¾åˆ°äº†Cçš„ç”Ÿæˆæ–¹æ³•</p>
<p>åŒæ—¶ï¼Œç”±äº+[]=0,+!+[]=1ã€‚æˆ‘ä»¬å¯ä»¥æŠŠ1ä¹Ÿç»™çœç•¥</p>
<p>jsfucké‡Œé¢è¿˜æœ‰å¾ˆå¤šéªšæ“ä½œï¼Œæ¯”å¦‚ <code>+(&quot;11e20&quot;)=1.1e+21</code></p>
<a id="more"></a>

<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ä»Šå¤©é€›<a href="http://justjavac.com/about.html" target="_blank" rel="noopener">justjavac è€å“¥çš„åšå®¢</a>çœ‹åˆ°äº†ç±»ä¼¼ä¸‹é¢çš„ä»£ç </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">(+([]+(11^(1&lt;&lt;1))+((1+1)&lt;&lt;(1+1))+(11&gt;&gt;&gt;1)+(1^1)+((11&gt;&gt;1)+(1&lt;&lt;1))+(-~1)+(-~1+1)+(1^1)+(1^1)))[(!!1+[])[1^1]+([]+&#123;&#125;+[])[1]+(([]+&#123;&#125;)[([]+&#123;&#125;)[11-1&gt;&gt;1]+[[],[]+&#123;&#125;+[]][[]+1][1]+(&#x2F;^&#x2F;[1]+[])[1|1&gt;&gt;1|1]+[&#123;&#125;,11^1,!&#123;&#125;+[]][1+1][1&lt;&lt;1^1]+(11&#x2F;!&#123;&#125;+&#123;&#125;)[~1+(11^1)+~1]+[!!&#123;&#125;+&#123;&#125;][[]&amp;111][1&amp;1]+(&#x2F;^&#x2F;[111]+[])[11^11]+[&#123;&#125;,[&#123;&#125;]+&#123;&#125;,1][1+[]][11-~1+11&gt;&gt;1]+(!!1+&#123;&#125;)[1&amp;1&gt;&gt;1]+([]+&#123;1:1&#125;+[])[1|1]+[[]+!!1][111&gt;&gt;&gt;111][1&lt;&lt;1&gt;&gt;1]]+[])[([]+![111])[1|1&lt;&lt;1|1]+[&#x2F;&#x3D;&#x2F;,[]+[][11]][1|[]][1&gt;&gt;1]+([&#123;&#125;]+&#123;&#125;)[1+!![1]]+[1,!1+&#x2F;~&#x2F;][1%11][1^1&lt;&lt;1]+(!!1+[])[1^1]+[!!&#x2F;-&#x2F;+&#x2F;-&#x2F;][11%11][+!!1]](11^1&lt;&lt;1,-~11&gt;&gt;1)](~1-~(11^1)&lt;&lt;1&lt;&lt;1)</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºï¼š<code>gahing</code></p>
<p>å®ç°çš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<h2 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h2><p>äº†è§£ js éšå¼ç±»å‹è½¬æ¢ï¼ˆä¸æ‡‚å¯ä»¥å‚è€ƒ<a href="https://github.com/jawil/blog/issues/5" target="_blank" rel="noopener">è¿™é‡Œ</a>ï¼‰çš„éƒ½çŸ¥é“</p>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡æ‰§è¡Œ<code>!1+[]</code>å¾—åˆ°<code>&quot;false&quot;</code></p>
<blockquote>
<p>å…·ä½“åŸç†æ˜¯ false+object æ“ä½œä¼šå…ˆå»è°ƒç”¨objectçš„valueOf()æ–¹æ³• å‘ç°å…¶å€¼=this </p>
</blockquote>
<blockquote>
<p>ç»§ç»­è°ƒç”¨toString()æ–¹æ³•å¾—åˆ°â€â€, ç»“æœå³false+â€â€ = â€œfalseâ€(åˆå»åšäº†éšå¼è½¬æ¢)</p>
</blockquote>
<p>æ•…æˆ‘ä»¬é€šè¿‡æ•°ç»„ä¸‹æ ‡å°±å¯ä»¥æ‹¿åˆ°æƒ³è¦çš„å­—ç¬¦<code>f,a,l,s,e</code></p>
<p>ç±»ä¼¼çš„æ–¹æ³•æˆ‘ä»¬è¿˜èƒ½å¤Ÿæ‹¿åˆ°</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">!<span class="number">1</span>+[] = <span class="string">"false"</span></span><br><span class="line">!!<span class="number">1</span>+[] = <span class="string">"true"</span></span><br><span class="line"><span class="number">1</span>/[]+[] = <span class="string">"Infinity"</span></span><br><span class="line">[]/[]+[] = <span class="string">"NaN"</span></span><br><span class="line">[]+&#123;&#125; = <span class="string">"[object Object]"</span></span><br><span class="line">[]+<span class="regexp">/^/</span>[<span class="number">1</span>] = <span class="string">"undefined"</span> <span class="comment">/* /^/æ˜¯æ­£åˆ™ */</span></span><br><span class="line">[]+<span class="regexp">/\:@$/</span> = <span class="string">"/\:@$/"</span> <span class="comment">/*é”®ç›˜å¯è§ç‰¹æ®Šå­—ç¬¦æ”¾/\ /å…¶ä¸­(\ç”¨äºè½¬ä¹‰)è·å–æ¯”å¦‚æ‹¿:å°±æ˜¯[1]*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//å¯æ‹¿åˆ°çš„å°å†™å­—æ¯æœ‰=abcdef ijln orst uy</span></span><br></pre></td></tr></table></figure>

<p>ç„¶åä½ ä¼šå‘ç°ï¼Œ26ä¸ªå­—æ¯è¿˜æ˜¯æœ‰å¥½å¤šä¸åœ¨ä¸Šé¢çš„ï¼Œå¹¶ä¸èƒ½é€šè¿‡æ¯æ¬¡å»ä¸Šé¢æ‹¿å­—ç¬¦ç„¶åå†åšæ‹¼æ¥</p>
<!--more-->

<p>ä½†æ˜¯ï¼ï¼<code>constructor</code> è¿™ä¸ªå­—ç¬¦ä¸²é‡Œé¢çš„å­—ç¬¦éƒ½å¯ä»¥é€šè¿‡ä¸Šé¢çš„æ‹¿åˆ°</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="string">"constructor"</span> = ([]+&#123;&#125;)[<span class="number">11</span><span class="number">-1</span>&gt;&gt;<span class="number">1</span>]+[[],[]+&#123;&#125;+[]][[]+<span class="number">1</span>][<span class="number">1</span>]+(<span class="regexp">/^/</span>[<span class="number">1</span>]+[])[<span class="number">1</span>|<span class="number">1</span>&gt;&gt;<span class="number">1</span>|<span class="number">1</span>]+[&#123;&#125;,<span class="number">11</span>^<span class="number">1</span>,!&#123;&#125;+[]][<span class="number">1</span>+<span class="number">1</span>][<span class="number">1</span>&lt;&lt;<span class="number">1</span>^<span class="number">1</span>]+(<span class="number">11</span>/!&#123;&#125;+&#123;&#125;)[~<span class="number">1</span>+(<span class="number">11</span>^<span class="number">1</span>)+~<span class="number">1</span>]+[!!&#123;&#125;+&#123;&#125;][[]&amp;<span class="number">111</span>][<span class="number">1</span>&amp;<span class="number">1</span>]+(<span class="regexp">/^/</span>[<span class="number">111</span>]+[])[<span class="number">11</span>^<span class="number">11</span>]+[&#123;&#125;,[&#123;&#125;]+&#123;&#125;,<span class="number">1</span>][<span class="number">1</span>+[]][<span class="number">11</span>-~<span class="number">1</span>+<span class="number">11</span>&gt;&gt;<span class="number">1</span>]+(!!<span class="number">1</span>+&#123;&#125;)[<span class="number">1</span>&amp;<span class="number">1</span>&gt;&gt;<span class="number">1</span>]+([]+&#123;<span class="number">1</span>:<span class="number">1</span>&#125;+[])[<span class="number">1</span>|<span class="number">1</span>]+[[]+!!<span class="number">1</span>][<span class="number">111</span>&gt;&gt;&gt;<span class="number">111</span>][<span class="number">1</span>&lt;&lt;<span class="number">1</span>&gt;&gt;<span class="number">1</span>]</span><br></pre></td></tr></table></figure>
<p><code>constructor</code>æœ‰ä»€ä¹ˆä½œç”¨å‘¢ï¼Œå…ˆæ€è€ƒä¸‹â€¦</p>
<hr>
<p>å¥½å§å…¶å®ä½œç”¨å°±æ˜¯<code>&quot;&quot;[&#39;constructor&#39;]+[]</code> å¯ä»¥æ‹¿åˆ°<code>&quot;function String() { [native code] }&quot;</code></p>
<p>äºæ˜¯ï¼Œæˆ‘æ‹¿åˆ°äº†<code>String</code>å­—ç¬¦ä¸²ï¼Œå†é€šè¿‡å…¶ä»–åœ°æ–¹åˆå¯æ‹¿åˆ°<code>to</code> ï¼Œäºæ˜¯<code>toString</code>æ–¹æ³•å°±getäº†</p>
<p>æœ€åå®ç°çš„åŸç†å…¶å®æ˜¯toString,å³:</p>
<p><code>(985072300).toString(36)</code> </p>
<p><code>36=~1-~(11^1)&lt;&lt;1&lt;&lt;1</code></p>
<p>å‰é¢çš„æ•°å­—ä¸²æ˜¯å­—ç¬¦ä¸²çš„36è¿›åˆ¶(0~9a-z)è¡¨ç¤º,æ¯”å¦‚ gahing çš„36è¿›åˆ¶è¡¨ç¤ºæ˜¯985072300</p>
<h3 id="è¿›åˆ¶è½¬æ¢ï¼š"><a href="#è¿›åˆ¶è½¬æ¢ï¼š" class="headerlink" title="è¿›åˆ¶è½¬æ¢ï¼š"></a>è¿›åˆ¶è½¬æ¢ï¼š</h3><p>36è¿›åˆ¶å¯ä»¥é¢„å…ˆé€šè¿‡ä¸‹é¢çš„æ–¹æ³•è·å¾—</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">parseInt</span>(<span class="string">"gahing"</span>,<span class="number">36</span>)</span><br><span class="line">=&gt;<span class="number">985072300</span></span><br><span class="line"></span><br><span class="line">(<span class="number">985072300</span>).toString(<span class="number">36</span>)</span><br><span class="line">=&gt;<span class="string">"gahing"</span></span><br></pre></td></tr></table></figure>

<h3 id="numberè½¬æ¢ä¸º1å’Œå­—ç¬¦ç»„åˆæ„æˆ"><a href="#numberè½¬æ¢ä¸º1å’Œå­—ç¬¦ç»„åˆæ„æˆ" class="headerlink" title="numberè½¬æ¢ä¸º1å’Œå­—ç¬¦ç»„åˆæ„æˆ"></a>numberè½¬æ¢ä¸º1å’Œå­—ç¬¦ç»„åˆæ„æˆ</h3><p>ä¸¾ä¸ªä¾‹å­å°±æ‡‚äº†</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[]+1+2+3 &#x3D; &quot;123&quot;</span><br><span class="line">(+([]+1+2+3)) &#x3D; 123</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬è®¾ç½®0~9çš„ç»„åˆä¸²ä¸ºå¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0:(1^1)</span><br><span class="line">1:(1|1)</span><br><span class="line">2:(-~1)</span><br><span class="line">3:(-~1|1)</span><br><span class="line">4:(-~1&lt;&lt;1)</span><br><span class="line">5:(11&gt;&gt;1)</span><br><span class="line">6:((11+1)&gt;&gt;1)</span><br><span class="line">7:(11&gt;&gt;1|-~1)</span><br><span class="line">8:(11^(-~1|1))</span><br><span class="line">9:(11^(1&lt;&lt;1))</span><br></pre></td></tr></table></figure>

<h2 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//$1="constructor"</span></span><br><span class="line"><span class="keyword">let</span> $<span class="number">1</span>  = ([]+&#123;&#125;)[<span class="number">11</span><span class="number">-1</span>&gt;&gt;<span class="number">1</span>]+[[],[]+&#123;&#125;+[]][[]+<span class="number">1</span>][<span class="number">1</span>]+(<span class="regexp">/^/</span>[<span class="number">1</span>]+[])[<span class="number">1</span>|<span class="number">1</span>&gt;&gt;<span class="number">1</span>|<span class="number">1</span>]+[&#123;&#125;,<span class="number">11</span>^<span class="number">1</span>,!&#123;&#125;+[]][<span class="number">1</span>+<span class="number">1</span>][<span class="number">1</span>&lt;&lt;<span class="number">1</span>^<span class="number">1</span>]+(<span class="number">11</span>/!&#123;&#125;+&#123;&#125;)[~<span class="number">1</span>+(<span class="number">11</span>^<span class="number">1</span>)+~<span class="number">1</span>]+[!!&#123;&#125;+&#123;&#125;][[]&amp;<span class="number">111</span>][<span class="number">1</span>&amp;<span class="number">1</span>]+(<span class="regexp">/^/</span>[<span class="number">111</span>]+[])[<span class="number">11</span>^<span class="number">11</span>]+[&#123;&#125;,[&#123;&#125;]+&#123;&#125;,<span class="number">1</span>][<span class="number">1</span>+[]][<span class="number">11</span>-~<span class="number">1</span>+<span class="number">11</span>&gt;&gt;<span class="number">1</span>]+(!!<span class="number">1</span>+&#123;&#125;)[<span class="number">1</span>&amp;<span class="number">1</span>&gt;&gt;<span class="number">1</span>]+([]+&#123;<span class="number">1</span>:<span class="number">1</span>&#125;+[])[<span class="number">1</span>|<span class="number">1</span>]+[[]+!!<span class="number">1</span>][<span class="number">111</span>&gt;&gt;&gt;<span class="number">111</span>][<span class="number">1</span>&lt;&lt;<span class="number">1</span>&gt;&gt;<span class="number">1</span>]</span><br><span class="line"><span class="comment">//$11="function String() &#123; [native code] &#125;"</span></span><br><span class="line"><span class="keyword">let</span> $<span class="number">11</span> = (([]+&#123;&#125;)[$<span class="number">1</span>]+[])</span><br><span class="line"><span class="comment">//$111="substr"</span></span><br><span class="line"><span class="keyword">let</span> $<span class="number">111</span> = ([]+![<span class="number">111</span>])[<span class="number">1</span>|<span class="number">1</span>&lt;&lt;<span class="number">1</span>|<span class="number">1</span>]+[<span class="regexp">/=/</span>,[]+[][<span class="number">11</span>]][<span class="number">1</span>|[]][<span class="number">1</span>&gt;&gt;<span class="number">1</span>]+([&#123;&#125;]+&#123;&#125;)[<span class="number">1</span>+!![<span class="number">1</span>]]+[<span class="number">1</span>,!<span class="number">1</span>+<span class="regexp">/~/</span>][<span class="number">1</span>%<span class="number">11</span>][<span class="number">1</span>^<span class="number">1</span>&lt;&lt;<span class="number">1</span>]+(!!<span class="number">1</span>+[])[<span class="number">1</span>^<span class="number">1</span>]+[!!<span class="regexp">/-/</span>+<span class="regexp">/-/</span>][<span class="number">11</span>%<span class="number">11</span>][+!!<span class="number">1</span>]</span><br><span class="line"><span class="comment">//$$="String"</span></span><br><span class="line"><span class="keyword">let</span> $$ = $<span class="number">11</span>[$<span class="number">111</span>](<span class="number">11</span>^<span class="number">1</span>&lt;&lt;<span class="number">1</span>,-~<span class="number">11</span>&gt;&gt;<span class="number">1</span>) <span class="comment">//substr(9,6)</span></span><br><span class="line"><span class="comment">//$_1="toString"</span></span><br><span class="line"><span class="keyword">let</span> $_1=(!!<span class="number">1</span>+[])[<span class="number">1</span>^<span class="number">1</span>]+([]+&#123;&#125;+[])[<span class="number">1</span>]+$$</span><br><span class="line"><span class="comment">//ç»“æœï¼š(985072300)['toString'](36)</span></span><br><span class="line">(+([]+(<span class="number">11</span>^(<span class="number">1</span>&lt;&lt;<span class="number">1</span>))+((<span class="number">1</span>+<span class="number">1</span>)&lt;&lt;(<span class="number">1</span>+<span class="number">1</span>))+(<span class="number">11</span>&gt;&gt;&gt;<span class="number">1</span>)+(<span class="number">1</span>^<span class="number">1</span>)+((<span class="number">11</span>&gt;&gt;<span class="number">1</span>)+(<span class="number">1</span>&lt;&lt;<span class="number">1</span>))+(-~<span class="number">1</span>)+(-~<span class="number">1</span>+<span class="number">1</span>)+(<span class="number">1</span>^<span class="number">1</span>)</span><br><span class="line">+(<span class="number">1</span>^<span class="number">1</span>)))[$_1](~<span class="number">1</span>-~(<span class="number">11</span>^<span class="number">1</span>)&lt;&lt;<span class="number">1</span>&lt;&lt;<span class="number">1</span>)</span><br></pre></td></tr></table></figure>


<h2 id="å­˜åœ¨çš„é—®é¢˜åŠå…¶æ”¹è¿›æ–¹æ³•"><a href="#å­˜åœ¨çš„é—®é¢˜åŠå…¶æ”¹è¿›æ–¹æ³•" class="headerlink" title="å­˜åœ¨çš„é—®é¢˜åŠå…¶æ”¹è¿›æ–¹æ³•"></a>å­˜åœ¨çš„é—®é¢˜åŠå…¶æ”¹è¿›æ–¹æ³•</h2><h3 id="é•¿å­—ç¬¦ä¸²"><a href="#é•¿å­—ç¬¦ä¸²" class="headerlink" title="é•¿å­—ç¬¦ä¸²"></a>é•¿å­—ç¬¦ä¸²</h3><p>å½“å­—ç¬¦ä¸²æœ‰å¤šç§ç±»å‹æ—¶ï¼ˆæ¯”å¦‚ä¸‹é¢ä¼šæåˆ°çš„ä¸­æ–‡ï¼‰éœ€è¦è€ƒè™‘åˆ†æ®µï¼Œå¤šæ¬¡<code>toString(36)</code>æœ€åæ‹¼æ¥èµ·æ¥ã€‚</p>
<p>ç”±äº<code>toString</code>æ–¹æ³•è·å¾—ä¸æ˜“ï¼Œè®©<code>$=&#39;toString&#39;</code>å§</p>
<h3 id="å¤§å†™å­—æ¯ã€ä¸­æ–‡å­—ç¬¦ã€éå¸¸è§å­—ç¬¦"><a href="#å¤§å†™å­—æ¯ã€ä¸­æ–‡å­—ç¬¦ã€éå¸¸è§å­—ç¬¦" class="headerlink" title="å¤§å†™å­—æ¯ã€ä¸­æ–‡å­—ç¬¦ã€éå¸¸è§å­—ç¬¦"></a>å¤§å†™å­—æ¯ã€ä¸­æ–‡å­—ç¬¦ã€éå¸¸è§å­—ç¬¦</h3><p>ä¸ªåˆ«å¤§å†™å­—æ¯å¯ä»¥é€šè¿‡ä»¥ä¸‹å¼å­å»æ‹¿åˆ°</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$1&#x3D;&#39;constructor&#39;</span><br><span class="line">A: [][$1]+[]&#x3D;&quot;function Array() &#123; [native code] &#125;&quot;</span><br><span class="line">B: (!!1)[$1]+[]&#x3D;&quot;function Boolean() &#123; [native code] &#125;&quot;</span><br><span class="line">I: 1&#x2F;[]+[] &#x3D; &quot;Infinity&quot;</span><br><span class="line">E: &#x2F;\\&#x2F;[$1]+[] &#x3D; &quot;function RegExp() &#123; [native code] &#125;&quot;</span><br><span class="line">N: []&#x2F;[]+[] &#x3D; &quot;NaN&quot;</span><br><span class="line">O: []+&#123;&#125;&#x3D;&quot;[object Object]&quot;</span><br><span class="line">S: &#39;&#39;[$1]+[] &#x3D; &quot;function String() &#123; [native code] &#125;&quot;</span><br><span class="line">R: &#x2F;\\&#x2F;[$1]+[] &#x3D; &quot;function RegExp() &#123; [native code] &#125;&quot;</span><br></pre></td></tr></table></figure>

<p><strong>å½“ç„¶ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨é»‘ç§‘æŠ€å»è·å–ã€‚</strong></p>
<p>Stringç±»æœ‰ä¸ªæ–¹æ³•<code>fromCodePoint</code>(ä¸ç”¨<code>fromCharCode</code>å› ä¸ºå…¶ä¸èƒ½è¯†åˆ«4å­—èŠ‚å­—ç¬¦)</p>
<p>é€šè¿‡ä¼ å…¥<code>Unicode</code> å€¼å³å¯å¾—åˆ°å¯¹åº”çš„å­—ç¬¦ï¼ŒStringç±»å¯ä»¥é€šè¿‡æ„é€ å‡½æ•°<code>&#39;&#39;[&#39;constructor&#39;]</code>æ‹¿åˆ°ã€‚</p>
<p>ä¾‹ï¼š<code>&#39;&#39;[&#39;constructor&#39;][&#39;fromCodePoint&#39;](23433) //è¾“å‡º&#39;å®‰&#39;</code></p>
<p><code>23433</code> æ˜¯ <code>å®‰</code> çš„unicodeç ï¼Œå¯ä»¥é€šè¿‡ <code>&#39;å®‰&#39;.codePointAt(0)</code> è·å¾—</p>
<p>æ•…æˆ‘ä»¬å¯ä»¥äº‹å…ˆå¾—åˆ°<code>fromCodePoint</code>çš„ç»„åˆä¸²ã€‚ç”¨ä¸€ä¸ªä¸´æ—¶å˜é‡ä¿å­˜ï¼Œä¼šç»å¸¸ç”¨åˆ°</p>
<p><del><strong>PS:å®åœ¨æ˜¯æ‰¾ä¸åˆ°æ€ä¹ˆç”Ÿæˆâ€™Câ€™çš„ã€‚ã€‚ä¸‹æ–‡å¯ä»¥ä¸ç”¨çœ‹äº†</strong></del><br>navigator.userAgent.match(RegExp(â€˜\u0043â€™)) æ€è·¯<br>eval(<code>${&#39;\\u0043&#39;}</code>) æ€è·¯</p>
<p><strong>180306æ›´æ–°</strong>ï¼šå‘ç°æœ‰ä¸ª<code>http://www.jsfuck.com/</code> ,ä¸Šé¢å°±åšäº†æˆ‘æƒ³åšçš„ä¸œè¥¿ã€‚ä¹Ÿæ‰¾åˆ°äº†Cçš„ç”Ÿæˆæ–¹æ³•<br>åŒæ—¶ï¼Œç”±äº+[]=0,+!+[]=1ã€‚æˆ‘ä»¬å¯ä»¥æŠŠ1ä¹Ÿç»™çœç•¥</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">let  fcp &#x3D; 74719523963420330000 &#x2F;&#x2F; &#39;fromCodePoint&#39;çš„36ä½ç¼–ç </span><br><span class="line">let $$ &#x3D;(fcp)[&#39;toString&#39;](36) &#x2F;&#x2F;&#39;fromCodePoint&#39;</span><br><span class="line">$1&#x3D;&#39;constructor&#39;</span><br><span class="line">&#39;&#39;[$1][$$](23433) &#x2F;&#x2F; è¾“å‡º&#39;å®‰&#39;</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·ï¼Œæ‰€æœ‰çš„å­—ç¬¦éƒ½å¯ä»¥å¾—åˆ°äº†ã€‚</p>
<h2 id="ç”Ÿäº§"><a href="#ç”Ÿäº§" class="headerlink" title="ç”Ÿäº§"></a>ç”Ÿäº§</h2><p>ç°åœ¨æˆ‘ä»¬çš„éœ€æ±‚æ˜¯ï¼šè¾“å…¥ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¾“å‡ºä¸€ä¸ªç»„åˆä¸²</p>
<h3 id="è§„åˆ™"><a href="#è§„åˆ™" class="headerlink" title="è§„åˆ™"></a>è§„åˆ™</h3><p><strong>ä¸€èˆ¬æ¥è¯´ï¼š</strong></p>
<ol start="0">
<li><p>æ•°å­—ä¸²ç›´æ¥ç”¨<code>([]+1+11)</code>å®ç°</p>
</li>
<li><p>è®©è¿ç»­çš„å°å†™å­—æ¯ä¸²ç”¨<code>toString(36)</code></p>
</li>
<li><p>å¯ä»¥ç›´æ¥æ‹¿åˆ°çš„è‹±æ–‡å­—ç¬¦ï¼Œç‰¹æ®Šå­—ç¬¦ï¼Œç›´æ¥å»è·å–</p>
</li>
<li><p>æœ€åå†ç”¨<code>fromCodePoint</code>æ–¹æ³•</p>
</li>
</ol>
<p><strong>ç®—æ³•å¦‚ä¸‹ï¼š</strong></p>
<ol>
<li><p>å­—ç¬¦ä¸²åˆ†å‰²ï¼šå°†è¿ç»­çš„æ•°å­—ä¸²ã€è¿ç»­çš„å°å†™å­—æ¯ä¸²ä½œä¸ºæ•´ä½“ï¼Œå…¶ä»–çš„ä½œä¸ºå•ä¸ªå­—ç¬¦</p>
<p>åˆ¤æ–­å­˜åœ¨çš„ç±»å‹ï¼Œäº‹å…ˆç”¨å˜é‡æ›¿æ¢éœ€è¦å¤šæ¬¡ç”¨åˆ°çš„æ–¹æ³•ä¸²ï¼Œæ¯”å¦‚ <code>fromCodePoint</code></p>
<p>åˆ†å‰²åçš„æ•°ç»„ã€å…ƒç´ ç±»åˆ«åŠä¸ªæ•° å¯¹åº”çš„æ•°æ®ç»“æ„ä¸º:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  [<span class="built_in">Symbol</span>.for(<span class="string">'numStr'</span>)]:<span class="number">0</span>,</span><br><span class="line">  [<span class="built_in">Symbol</span>.for(<span class="string">'commonLowercaseStr'</span>)]:<span class="number">0</span>,</span><br><span class="line">  [<span class="built_in">Symbol</span>.for(<span class="string">'otherLowercaseStr'</span>)]:<span class="number">0</span>,</span><br><span class="line">  [<span class="built_in">Symbol</span>.for(<span class="string">'commonCapital'</span>)]:<span class="number">0</span>,</span><br><span class="line">  [<span class="built_in">Symbol</span>.for(<span class="string">'commonSign'</span>)]:<span class="number">0</span>,</span><br><span class="line">  [<span class="built_in">Symbol</span>.for(<span class="string">'otherChar'</span>)]:<span class="number">0</span>,</span><br><span class="line">  arr:[&#123;<span class="attr">str</span>:<span class="string">''</span>,<span class="attr">type</span>:<span class="built_in">Symbol</span>.for(<span class="string">'numStr'</span>),<span class="attr">transStr</span>:<span class="string">''</span>&#125;,...]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>å­—ç¬¦ä¸²æ›¿æ¢ï¼šåˆ©ç”¨ä¸Šæ–‡æåˆ°çš„æ›¿æ¢å…¬å¼å°†å­—ç¬¦ä¸²æ›¿æ¢æ‰</p>
<p>2.1 æ•°å­—ä¸²é‡‡ç”¨<code>([]+1+11)</code>å®ç°ï¼Œæ¯ä¸ªæ•°å­—éƒ½æœ‰å¯¹åº”çš„ç»„åˆä¸²</p>
<p>2.2 å¤„ç†å°å†™å­—æ¯ä¸²ï¼Œè‹¥è¯¥ä¸²æ‰€æœ‰å­—ç¬¦å¯ç›´æ¥è·å–(abcdefijlnorstuy),åˆ™ç›´æ¥è·å–ï¼Œå¦åˆ™é‡‡ç”¨<code>toString(36)</code>å®ç°ï¼Œ36è¿›åˆ¶é€šè¿‡ <code>parseIntæ–¹æ³•</code> è·å–</p>
<p>2.3 ç‰¹æ®Šå­—ç¬¦ã€å¤§å†™å­—æ¯å…ˆçœ‹èƒ½å¦ç›´æ¥è·å–ï¼ˆABEFINORSï¼‰ï¼Œå¦åˆ™èµ° 2.4 æµç¨‹</p>
<p>2.4 åˆ©ç”¨<code>codePointAt</code>æ‹¿åˆ°<code>Unicode</code>ç ï¼Œå†ç”Ÿæˆ<code>String.fromCodePoint(unicode)</code> çš„ç»„åˆä¸²</p>
</li>
<li><p>å­—ç¬¦ä¸²æ‹¼æ¥ï¼šå°†åˆ†å‰²åæ›¿æ¢å®Œçš„ç»„åˆä¸²è¿›è¡Œæ‹¼æ¥</p>
</li>
</ol>
<p><strong>æ³¨ï¼š</strong> å®šä¹‰çš„å˜é‡ï¼Œä¸ºä¿æŒæ‹“å±•æ€§ï¼Œå˜é‡ç¬¬ä¸€ä½éƒ½æ˜¯$ ç¬¬äºŒä½ä¸º_è¡¨ç¤ºåé¢çš„æ˜¯æ›¿æ¢æ–¹æ³• ç¬¬äºŒä½ä¸º1è¡¨ç¤ºåé¢å°†æ˜¯æ›¿æ¢å…·ä½“å­—ç¬¦</p>
<h3 id="ä¸¾ä¸ªæ —å­"><a href="#ä¸¾ä¸ªæ —å­" class="headerlink" title="ä¸¾ä¸ªæ —å­"></a>ä¸¾ä¸ªæ —å­</h3><p>å¯¹äºåŸä¸²ï¼š<code>hello é€ä½ ä¸€å°iPhone6ï¼Œä»·å€¼$666</code></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//å°†å¸¸è§å­—ç¬¦çš„ç»„åˆä¸²è®¾ç½®åˆ°sourceä¸Š</span></span><br><span class="line"><span class="keyword">let</span> source = init() <span class="comment">//source:&#123;'0':'(1^1)',...&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯¹å­—ç¬¦ä¸²åˆ†å‰²åˆ†ç±»ï¼Œç”Ÿæˆæ•°æ®ç»“æ„</span></span><br><span class="line"><span class="keyword">let</span> data = split(str)</span><br><span class="line"><span class="comment">// arr = ['hello',' ','é€','ä½ ','ä¸€','å°','i','P','hone','6','ï¼Œ','ä»·','å€¼','$','666']</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">obj = &#123;</span></span><br><span class="line"><span class="comment">     [Symbol.for('numStr')]:2,</span></span><br><span class="line"><span class="comment">     [Symbol.for('commonLowercaseStr')]:1,</span></span><br><span class="line"><span class="comment">     [Symbol.for('otherLowercaseStr')]:2,</span></span><br><span class="line"><span class="comment">     [Symbol.for('commonCapital')]:0,</span></span><br><span class="line"><span class="comment">     [Symbol.for('commonSign')]:3,</span></span><br><span class="line"><span class="comment">     [Symbol.for('otherChar')]:7,</span></span><br><span class="line"><span class="comment">     arr:[&#123;str:'hello',type:Symbol.for('otherLowercaseStr'),transStr:''&#125;,</span></span><br><span class="line"><span class="comment">     &#123;str:' ',type:Symbol.for('commonSign'),transStr:''&#125;,</span></span><br><span class="line"><span class="comment">     &#123;str:'é€',type:Symbol.for('otherChar'),transStr:''&#125;,</span></span><br><span class="line"><span class="comment">     &#123;str:'ä½ ',type:Symbol.for('otherChar'),transStr:''&#125;,</span></span><br><span class="line"><span class="comment">     &#123;str:'ä¸€',type:Symbol.for('otherChar'),transStr:''&#125;,</span></span><br><span class="line"><span class="comment">     &#123;str:'å°',type:Symbol.for('otherChar'),transStr:''&#125;,</span></span><br><span class="line"><span class="comment">     &#123;str:'i',type:Symbol.for('commonLowercaseStr'),transStr:''&#125;,</span></span><br><span class="line"><span class="comment">     &#123;str:'P',type:Symbol.for('otherChar'),transStr:''&#125;,</span></span><br><span class="line"><span class="comment">     &#123;str:'hone',type:Symbol.for('otherLowercaseStr'),transStr:''&#125;,</span></span><br><span class="line"><span class="comment">     &#123;str:'6',type:Symbol.for('numStr'),transStr:''&#125;,</span></span><br><span class="line"><span class="comment">     &#123;str:'ï¼Œ',type:Symbol.for('commonSign'),transStr:''&#125;,</span></span><br><span class="line"><span class="comment">     &#123;str:'ä»·',type:Symbol.for('otherChar'),transStr:''&#125;,</span></span><br><span class="line"><span class="comment">     &#123;str:'å€¼',type:Symbol.for('otherChar'),transStr:''&#125;,</span></span><br><span class="line"><span class="comment">     &#123;str:'$',type:Symbol.for('commonSign'),transStr:''&#125;,</span></span><br><span class="line"><span class="comment">     &#123;str:'666',type:Symbol.for('numStr'),transStr:''&#125;]</span></span><br><span class="line"><span class="comment">   &#125;</span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//å¯¹æ•°ç»„å…ƒç´ ç±»å‹ï¼Œç”¨å˜é‡æ›¿æ¢ä¼šç”¨åˆ°çš„æ–¹æ³•ä¸²</span></span><br><span class="line"><span class="keyword">let</span> signObj = getSignOf(data.arr) <span class="comment">//signObj=&#123;useConstructor:'$_$=xxx;';useFromCodePoint:'$_1=xxx;'&#125;</span></span><br><span class="line"><span class="comment">//otherLowercaseStr&gt;0 åˆå§‹åŒ–$_$=constructorçš„ç»„åˆä¸²</span></span><br><span class="line"><span class="comment">//otherChar&gt;0 åˆå§‹åŒ–$_1=fromCodePointçš„ç»„åˆä¸²</span></span><br><span class="line"><span class="comment">//ä¸ºä¿æŒæ‹“å±•æ€§ã€‚å˜é‡ç¬¬ä¸€ä½éƒ½æ˜¯$ ç¬¬äºŒä½ä¸º_è¡¨ç¤ºåé¢çš„æ˜¯æ›¿æ¢æ–¹æ³• ç¬¬äºŒä½ä¸º1è¡¨ç¤ºåé¢å°†æ˜¯æ›¿æ¢å…·ä½“å­—ç¬¦</span></span><br><span class="line"><span class="keyword">let</span> result = <span class="string">''</span></span><br><span class="line"><span class="keyword">let</span> ua = signObj.useConstructor</span><br><span class="line"><span class="keyword">let</span> ub = signObj.useFromCodePoint</span><br><span class="line">ua&amp;&amp;(result+=ua)</span><br><span class="line">ub&amp;&amp;(result+=ub)</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¾ªç¯å…ƒç´ å¤„ç†ï¼Œç»“æœå­˜åœ¨transStr</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> obj <span class="keyword">of</span> data.arr)&#123;</span><br><span class="line">  <span class="keyword">switch</span>(obj.type)&#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="built_in">Symbol</span>.for(<span class="string">'numStr'</span>):&#123;handleNumStr(obj);<span class="keyword">break</span>;&#125;</span><br><span class="line">    <span class="keyword">case</span> <span class="built_in">Symbol</span>.for(<span class="string">'commonLowercaseStr'</span>):&#123;handleCommonLowercaseStr(obj);<span class="keyword">break</span>;&#125;</span><br><span class="line">    <span class="keyword">case</span> <span class="built_in">Symbol</span>.for(<span class="string">'otherLowercaseStr'</span>):&#123;handleOtherLowercaseStr(obj);<span class="keyword">break</span>;&#125;</span><br><span class="line">    <span class="keyword">case</span> <span class="built_in">Symbol</span>.for(<span class="string">'commonCapital'</span>):&#123;handleCommonCapital(obj);<span class="keyword">break</span>;&#125;</span><br><span class="line">    <span class="keyword">case</span> <span class="built_in">Symbol</span>.for(<span class="string">'commonSign'</span>):&#123;handleCommonSign(obj);<span class="keyword">break</span>;&#125;</span><br><span class="line">    <span class="keyword">case</span> <span class="built_in">Symbol</span>.for(<span class="string">'otherChar'</span>):&#123;handleOtherChar(obj);<span class="keyword">break</span>;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¾—åˆ°ç»“æœ</span></span><br><span class="line">result+=data.arr.reduce(<span class="function">(<span class="params">tot,cur</span>)=&gt;</span>tot+cur.transStr)</span><br></pre></td></tr></table></figure>

<h3 id="æ–¹æ³•ä»£ç "><a href="#æ–¹æ³•ä»£ç " class="headerlink" title="æ–¹æ³•ä»£ç "></a>æ–¹æ³•ä»£ç </h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> numStr = <span class="built_in">Symbol</span>.for(<span class="string">'numStr'</span>)</span><br><span class="line"><span class="keyword">const</span> commonLowercaseStr = <span class="built_in">Symbol</span>.for(<span class="string">'commonLowercaseStr'</span>)</span><br><span class="line"><span class="keyword">const</span> otherLowercaseStr = <span class="built_in">Symbol</span>.for(<span class="string">'otherLowercaseStr'</span>)</span><br><span class="line"><span class="keyword">const</span> commonCapital = <span class="built_in">Symbol</span>.for(<span class="string">'commonCapital'</span>)</span><br><span class="line"><span class="keyword">const</span> useConstructorCapital = <span class="built_in">Symbol</span>.for(<span class="string">'useConstructorCapital'</span>)</span><br><span class="line"><span class="keyword">const</span> commonSign = <span class="built_in">Symbol</span>.for(<span class="string">'commonSign'</span>)</span><br><span class="line"><span class="keyword">const</span> otherChar = <span class="built_in">Symbol</span>.for(<span class="string">'otherChar'</span>)</span><br><span class="line"><span class="keyword">const</span> string_null_error = <span class="built_in">Symbol</span>.for(<span class="string">'string_null_error'</span>)</span><br><span class="line"><span class="keyword">const</span> string_multitype_error = <span class="built_in">Symbol</span>.for(<span class="string">'string_multitype_error'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> StringBuilder = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> instance</span><br><span class="line">  <span class="keyword">let</span> builder = &#123;&#125;</span><br><span class="line">  <span class="keyword">let</span> init = <span class="function"><span class="keyword">function</span> (<span class="params">name</span>) </span>&#123;</span><br><span class="line">    builder[<span class="number">0</span>] = <span class="string">'1^1'</span></span><br><span class="line">    builder[<span class="number">1</span>] = <span class="string">'1|1'</span></span><br><span class="line">    builder[<span class="number">2</span>] = <span class="string">'-~1'</span></span><br><span class="line">    builder[<span class="number">3</span>] = <span class="string">'-~1|1'</span></span><br><span class="line">    builder[<span class="number">4</span>] = <span class="string">'-~1&lt;&lt;1'</span></span><br><span class="line">    builder[<span class="number">5</span>] = <span class="string">'11&gt;&gt;1'</span></span><br><span class="line">    builder[<span class="number">6</span>] = <span class="string">'(11+1)&gt;&gt;1'</span></span><br><span class="line">    builder[<span class="number">7</span>] = <span class="string">'11&gt;&gt;1|-~1'</span></span><br><span class="line">    builder[<span class="number">8</span>] = <span class="string">'11^(-~1|1)'</span></span><br><span class="line">    builder[<span class="number">9</span>] = <span class="string">'11^(1&lt;&lt;1)'</span></span><br><span class="line">    builder[<span class="number">12</span>] = <span class="string">'11+1'</span></span><br><span class="line">    builder[<span class="string">'false'</span>] = <span class="string">'!1+[]'</span></span><br><span class="line">    builder[<span class="string">'true'</span>] = <span class="string">'!!1+[]'</span></span><br><span class="line">    builder[<span class="string">'Infinity'</span>] = <span class="string">'1/[]+[]'</span></span><br><span class="line">    builder[<span class="string">'NaN'</span>] = <span class="string">'[]/[]+[]'</span></span><br><span class="line">    builder[<span class="string">'[object Object]'</span>] = <span class="string">'[]+&#123;&#125;'</span></span><br><span class="line">    builder[<span class="string">'undefined'</span>] = <span class="string">'[]+/^/[1]'</span></span><br><span class="line">    builder[<span class="string">'a'</span>] = <span class="string">`(<span class="subst">$&#123;builder[<span class="string">'false'</span>]&#125;</span>)[<span class="subst">$&#123;builder[<span class="number">1</span>]&#125;</span>]`</span></span><br><span class="line">    builder[<span class="string">'b'</span>] = <span class="string">`(<span class="subst">$&#123;builder[<span class="string">'[object Object]'</span>]&#125;</span>)[<span class="subst">$&#123;builder[<span class="number">2</span>]&#125;</span>]`</span></span><br><span class="line">    builder[<span class="string">'c'</span>] = <span class="string">`(<span class="subst">$&#123;builder[<span class="string">'[object Object]'</span>]&#125;</span>)[<span class="subst">$&#123;builder[<span class="number">5</span>]&#125;</span>]`</span></span><br><span class="line">    builder[<span class="string">'d'</span>] = <span class="string">`(<span class="subst">$&#123;builder[<span class="string">'undefined'</span>]&#125;</span>)[<span class="subst">$&#123;builder[<span class="number">2</span>]&#125;</span>]`</span></span><br><span class="line">    builder[<span class="string">'e'</span>] = <span class="string">`(<span class="subst">$&#123;builder[<span class="string">'true'</span>]&#125;</span>)[<span class="subst">$&#123;builder[<span class="number">3</span>]&#125;</span>]`</span></span><br><span class="line">    builder[<span class="string">'f'</span>] = <span class="string">`(<span class="subst">$&#123;builder[<span class="string">'false'</span>]&#125;</span>)[<span class="subst">$&#123;builder[<span class="number">0</span>]&#125;</span>]`</span></span><br><span class="line">    builder[<span class="string">'i'</span>] = <span class="string">`(<span class="subst">$&#123;builder[<span class="string">'undefined'</span>]&#125;</span>)[<span class="subst">$&#123;builder[<span class="number">5</span>]&#125;</span>]`</span></span><br><span class="line">    builder[<span class="string">'j'</span>] = <span class="string">`(<span class="subst">$&#123;builder[<span class="string">'[object Object]'</span>]&#125;</span>)[<span class="subst">$&#123;builder[<span class="number">3</span>]&#125;</span>]`</span></span><br><span class="line">    builder[<span class="string">'l'</span>] = <span class="string">`(<span class="subst">$&#123;builder[<span class="string">'false'</span>]&#125;</span>)[<span class="subst">$&#123;builder[<span class="number">2</span>]&#125;</span>]`</span></span><br><span class="line">    builder[<span class="string">'n'</span>] = <span class="string">`(<span class="subst">$&#123;builder[<span class="string">'Infinity'</span>]&#125;</span>)[<span class="subst">$&#123;builder[<span class="number">1</span>]&#125;</span>]`</span></span><br><span class="line">    builder[<span class="string">'o'</span>] = <span class="string">`(<span class="subst">$&#123;builder[<span class="string">'[object Object]'</span>]&#125;</span>)[<span class="subst">$&#123;builder[<span class="number">1</span>]&#125;</span>]`</span></span><br><span class="line">    builder[<span class="string">'r'</span>] = <span class="string">`(<span class="subst">$&#123;builder[<span class="string">'true'</span>]&#125;</span>)[<span class="subst">$&#123;builder[<span class="number">1</span>]&#125;</span>]`</span></span><br><span class="line">    builder[<span class="string">'s'</span>] = <span class="string">`(<span class="subst">$&#123;builder[<span class="string">'false'</span>]&#125;</span>)[<span class="subst">$&#123;builder[<span class="number">3</span>]&#125;</span>]`</span></span><br><span class="line">    builder[<span class="string">'t'</span>] = <span class="string">`(<span class="subst">$&#123;builder[<span class="string">'true'</span>]&#125;</span>)[<span class="subst">$&#123;builder[<span class="number">0</span>]&#125;</span>]`</span></span><br><span class="line">    builder[<span class="string">'u'</span>] = <span class="string">`(<span class="subst">$&#123;builder[<span class="string">'undefined'</span>]&#125;</span>)[<span class="subst">$&#123;builder[<span class="number">0</span>]&#125;</span>]`</span></span><br><span class="line">    builder[<span class="string">'y'</span>] = <span class="string">`(<span class="subst">$&#123;builder[<span class="string">'Infinity'</span>]&#125;</span>)[<span class="subst">$&#123;builder[<span class="number">7</span>]&#125;</span>]`</span></span><br><span class="line">    builder[<span class="string">'I'</span>] = <span class="string">`(<span class="subst">$&#123;builder[<span class="string">'Infinity'</span>]&#125;</span>)[<span class="subst">$&#123;builder[<span class="number">0</span>]&#125;</span>]`</span></span><br><span class="line">    builder[<span class="string">'N'</span>] = <span class="string">`(<span class="subst">$&#123;builder[<span class="string">'NaN'</span>]&#125;</span>)[<span class="subst">$&#123;builder[<span class="number">0</span>]&#125;</span>]`</span></span><br><span class="line">    builder[<span class="string">'O'</span>] = <span class="string">`(<span class="subst">$&#123;builder[<span class="string">'[object Object]'</span>]&#125;</span>)[<span class="subst">$&#123;builder[<span class="number">8</span>]&#125;</span>]`</span></span><br><span class="line">    builder[<span class="string">'constructor'</span>] = handleStrByType(<span class="string">'constructor'</span>)</span><br><span class="line">    <span class="comment">//let $_$=builder['constructor']</span></span><br><span class="line">    builder[<span class="string">'A'</span>] = <span class="string">`([][$_$&#125;]+[])[<span class="subst">$&#123;builder[<span class="number">9</span>]&#125;</span>]`</span></span><br><span class="line">    builder[<span class="string">'B'</span>] = <span class="string">`((!!1)[$_$]+[])[<span class="subst">$&#123;builder[<span class="number">9</span>]&#125;</span>]`</span></span><br><span class="line">    builder[<span class="string">'E'</span>] = <span class="string">`(/\\/[$_$]+[])[<span class="subst">$&#123;builder[<span class="number">9</span>]&#125;</span>]`</span></span><br><span class="line">    builder[<span class="string">'F'</span>] = <span class="string">`((()=&gt;&#123;&#125;)[$_$]+[])[<span class="subst">$&#123;builder[<span class="number">9</span>]&#125;</span>]`</span></span><br><span class="line">    builder[<span class="string">'R'</span>] = <span class="string">`(/\\/[$_$]+[])[<span class="subst">$&#123;builder[<span class="number">12</span>]&#125;</span>]`</span></span><br><span class="line">    builder[<span class="string">'S'</span>] = <span class="string">`(([]+1)[$_$]+[])[<span class="subst">$&#123;builder[<span class="number">9</span>]&#125;</span>]`</span></span><br><span class="line">    builder[<span class="string">'fromCodePoint'</span>] = handleStrByType(<span class="string">'fromCodePoint'</span>)</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      handleStr: <span class="function"><span class="keyword">function</span> (<span class="params">str</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">let</span> arr = split(str)</span><br><span class="line">        <span class="keyword">let</span> source = packArrToSource(arr)</span><br><span class="line">        <span class="keyword">let</span> result = getSign(source)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * å°†å­—ç¬¦ä¸²è¿›è¡Œåˆ†å‰²</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;any&#125;</span> </span>str </span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns </span>åˆ†å‰²åçš„æ•°ç»„</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">split</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!str || str.length === <span class="number">0</span>) <span class="keyword">throw</span> &#123; <span class="attr">type</span>: string_null_error, <span class="attr">message</span>: <span class="string">'å­—ç¬¦ä¸²ä¸ºç©º'</span> &#125;</span><br><span class="line">    <span class="keyword">let</span> arr = []</span><br><span class="line">    <span class="keyword">let</span> last = <span class="string">""</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> c <span class="keyword">of</span> str) &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> curType = getTypeOf(c)</span><br><span class="line">        <span class="keyword">if</span> (last.length === <span class="number">0</span>) &#123;</span><br><span class="line">          <span class="keyword">if</span> (curType === numStr || curType === commonLowercaseStr || curType === otherLowercaseStr) &#123;</span><br><span class="line">            last = c</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            arr.push(c)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="comment">//lastå¿…ä¸ºæ•°å­—æˆ–å°å†™å­—æ¯ä¸²</span></span><br><span class="line">          <span class="keyword">let</span> lastType = getTypeOf(last)</span><br><span class="line">          <span class="keyword">if</span> (curType === lastType || (lastType !== numStr &amp;&amp; (curType === commonLowercaseStr || curType === otherLowercaseStr))) &#123;</span><br><span class="line">            last += c</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            arr.push(last)</span><br><span class="line">            last = <span class="string">""</span></span><br><span class="line">            <span class="keyword">if</span> (curType === numStr || curType === commonLowercaseStr || curType === otherLowercaseStr) &#123;</span><br><span class="line">              last = c</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">              arr.push(c)</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">        <span class="built_in">console</span>.error(<span class="string">`å­—ç¬¦ä¸º<span class="subst">$&#123;c&#125;</span>`</span>)</span><br><span class="line">        <span class="keyword">throw</span> error</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (last !== <span class="string">""</span>) arr.push(last);</span><br><span class="line">    <span class="keyword">return</span> arr</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * å°†æ•°ç»„æ¯ä¸ªå…ƒç´ è¿›è¡ŒåŒ…è£…ï¼Œç”Ÿæˆæ•°æ®æº</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;any&#125;</span> </span>arr </span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">packArrToSource</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> obj = &#123;</span><br><span class="line">      [numStr]: <span class="number">0</span>,</span><br><span class="line">      [commonLowercaseStr]: <span class="number">0</span>,</span><br><span class="line">      [otherLowercaseStr]: <span class="number">0</span>,</span><br><span class="line">      [commonCapital]: <span class="number">0</span>,</span><br><span class="line">      [useConstructorCapital]: <span class="number">0</span>,</span><br><span class="line">      [commonSign]: <span class="number">0</span>,</span><br><span class="line">      [otherChar]: <span class="number">0</span>,</span><br><span class="line">      arr: []</span><br><span class="line">    &#125;</span><br><span class="line">    arr.forEach(<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> curTemp = getTypeOf(e)</span><br><span class="line">      obj[curTemp] += <span class="number">1</span></span><br><span class="line">      obj.arr.push(&#123;</span><br><span class="line">        oriStr: e,</span><br><span class="line">        type: curTemp,</span><br><span class="line">        transStr: <span class="string">''</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;, <span class="keyword">this</span>);</span><br><span class="line">    <span class="keyword">return</span> obj</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * è·å–å­—ç¬¦ä¸²æ‰€å±ç±»å‹</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;any&#125;</span> </span>str </span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns </span></span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">getTypeOf</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!str || str.length === <span class="number">0</span>) <span class="keyword">throw</span> &#123; <span class="attr">type</span>: string_null_error, <span class="attr">message</span>: <span class="string">'å­—ç¬¦ä¸²ä¸ºç©º'</span> &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="regexp">/^\d+$/</span>.test(str)) <span class="keyword">return</span> numStr;</span><br><span class="line">    <span class="keyword">if</span> (<span class="regexp">/^[abcdefijlnorstuy]+$/</span>.test(str)) <span class="keyword">return</span> commonLowercaseStr;</span><br><span class="line">    <span class="keyword">if</span> (<span class="regexp">/^[a-z]+$/</span>.test(str)) <span class="keyword">return</span> otherLowercaseStr;</span><br><span class="line">    <span class="keyword">if</span> (<span class="regexp">/^[INO]+$/</span>.test(str)) <span class="keyword">return</span> commonCapital;</span><br><span class="line">    <span class="keyword">if</span> (<span class="regexp">/^[ABEFRS]+$/</span>.test(str)) <span class="keyword">return</span> useConstructorCapital;</span><br><span class="line">    <span class="keyword">if</span> (<span class="regexp">/^((?=[\x21-\x7e])[^A-Za-z0-9])$/</span>.test(str)) <span class="keyword">return</span> commonSign;</span><br><span class="line">    <span class="comment">//å­˜åœ¨å¤šä¸ªå­—ç¬¦ï¼ŒæŠ¥é”™ï¼šæœ‰å¤šç§ç±»å‹ï¼Œéœ€è¦é‡æ–°split</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">Array</span>.from(str).length !== <span class="number">1</span>) <span class="keyword">throw</span> &#123; <span class="attr">type</span>: string_multitype_error, <span class="attr">message</span>: <span class="string">'å­˜åœ¨å¤šç§ç±»å‹'</span> &#125;</span><br><span class="line">    <span class="keyword">return</span> otherChar;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * è·å–åˆå§‹åŒ–å­—ç¬¦ä¸²ï¼Œå¹¶å¯¹sourceè¿›è¡Œ2ä¸ªå±æ€§çš„è®¾ç½®</span></span><br><span class="line"><span class="comment">   * otherLowercaseStr&gt;0 åˆå§‹åŒ–$_$=constructorçš„ç»„åˆä¸²</span></span><br><span class="line"><span class="comment">   * otherChar&gt;0 åˆå§‹åŒ–$_1=fromCodePointçš„ç»„åˆä¸²</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;any&#125;</span> </span>source </span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">getSign</span>(<span class="params">source</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//otherLowercaseStr&gt;0 åˆå§‹åŒ–$_$=constructorçš„ç»„åˆä¸²</span></span><br><span class="line">    <span class="comment">//otherChar&gt;0 åˆå§‹åŒ–$_1=fromCodePointçš„ç»„åˆä¸²</span></span><br><span class="line">    <span class="keyword">let</span> result = <span class="string">""</span></span><br><span class="line">    <span class="keyword">if</span> (source[otherLowercaseStr] &gt; <span class="number">0</span> || source[useConstructorCapital] &gt; <span class="number">0</span> || source[otherChar] &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      source[<span class="string">'useConstructor'</span>] = <span class="string">'$_$='</span> + builder[<span class="string">'constructor'</span>]</span><br><span class="line">      result += source[<span class="string">'useConstructor'</span>] + <span class="string">';'</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (source[otherChar] &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      source[<span class="string">'useFromCodePoint'</span>] = <span class="string">'$_1='</span> + builder[<span class="string">'fromCodePoint'</span>]</span><br><span class="line">      result += source[<span class="string">'useFromCodePoint'</span>] + <span class="string">';'</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * å°†åŸä¸²æ ¹æ®ç±»å‹ç”Ÿæˆè¿”å›ç»„åˆä¸²</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;any&#125;</span> </span>str </span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;any&#125;</span> </span>type </span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns </span></span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">handleStrByType</span>(<span class="params">str, type</span>) </span>&#123;</span><br><span class="line">    type = type || getTypeOf(str)</span><br><span class="line">    <span class="keyword">switch</span> (type) &#123;</span><br><span class="line">      <span class="keyword">case</span> numStr: <span class="keyword">return</span> handleNumStr(str);</span><br><span class="line">      <span class="keyword">case</span> commonLowercaseStr: <span class="keyword">return</span> handleCommonLowercaseStr(str);</span><br><span class="line">      <span class="keyword">case</span> otherLowercaseStr: <span class="keyword">return</span> handleOtherLowercaseStr(str);</span><br><span class="line">      <span class="keyword">case</span> commonCapital: <span class="keyword">return</span> handleCommonCapital(str);</span><br><span class="line">      <span class="keyword">case</span> useConstructorCapital: <span class="keyword">return</span> handleUseConstructorCapital(str);</span><br><span class="line">      <span class="keyword">case</span> commonSign: <span class="keyword">return</span> handleCommonSign(str);</span><br><span class="line">      <span class="keyword">case</span> otherChar: <span class="keyword">return</span> handleOtherChar(str);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">handleNumStr</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">handleCommonLowercaseStr</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Array</span>.from(str, c =&gt; obj[c]).reduce(<span class="function">(<span class="params">tot, cur</span>) =&gt;</span> tot + <span class="string">'+'</span> + cur)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">handleOtherLowercaseStr</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">handleCommonCapital</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">handleUseConstructorCapital</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">handleCommonSign</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">handleOtherChar</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//ä¿®æ”¹æºçš„</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">setSourceBuilder</span>(<span class="params">s,str</span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    getInstance: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> instance || (instance = init())</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)()</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> StringBuilder</span><br></pre></td></tr></table></figure>

<h3 id="ä¼˜åŒ–"><a href="#ä¼˜åŒ–" class="headerlink" title="ä¼˜åŒ–"></a>ä¼˜åŒ–</h3><p>å¯¹äºç”Ÿæˆçš„å­—ç¬¦ä¸²ï¼Œæˆ‘ä»¬è¦æ±‚å°½é‡çŸ­ä¸€ç‚¹ã€‚è€ƒè™‘æ˜¯å¦æœ‰åšå‹ç¼©çš„å¯èƒ½æ€§ï¼š</p>
<p>å¯¹äºé‡å¤çš„å­—ç¬¦ä¸²ï¼Œå¯ä»¥ç”¨ä»¥ä¸‹æ–¹æ³•</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="string">'a'</span>[<span class="string">'repeat'</span>](<span class="number">5</span>) === <span class="string">"aaaaa"</span></span><br><span class="line"></span><br><span class="line">[][<span class="string">"constructor"</span>](<span class="number">3</span>)[<span class="string">'fill'</span>](<span class="string">'a'</span>)[<span class="string">'join'</span>](<span class="string">''</span>) === <span class="string">"aaa"</span></span><br></pre></td></tr></table></figure>

<p>ä½†ä¸€èˆ¬å­—ç¬¦ä¸²å¾ˆå°‘æœ‰è¿™æ ·é‡å¤çš„</p>
<p>å¯¹äºé•¿è‹±æ–‡ä¸²ï¼Œæ˜¯å¦å¯ä»¥äº‹å…ˆå¾—åˆ°æ‰€æœ‰å­—æ¯çš„ç»„åˆä¸²ï¼Œç”¨å˜é‡è¡¨ç¤ºï¼Œåé¢ç›´æ¥ä½¿ç”¨å˜é‡ã€‚</p>
<p>å¦‚ <code>$_$$$ = &#39;a&#39;; $_$_1 = &#39;b&#39;</code> </p>
<p>å³æŠŠ <code>$</code> çœ‹åš <code>0</code> ï¼Œ é‡‡ç”¨ç±»ä¼¼ <code>ASCIIç </code> çš„æ–¹å¼å®ç°</p>
<h4 id="zipå‹ç¼©ï¼ˆLZ77ï¼‰ç®€å•åŸç†"><a href="#zipå‹ç¼©ï¼ˆLZ77ï¼‰ç®€å•åŸç†" class="headerlink" title="zipå‹ç¼©ï¼ˆLZ77ï¼‰ç®€å•åŸç†"></a>zipå‹ç¼©ï¼ˆLZ77ï¼‰ç®€å•åŸç†</h4><ol>
<li>å½“å‰å¾…å‹ç¼©å­—ç¬¦ä¸²å¾€å‰ä¸€ä¸ªæ»‘åŠ¨çª—å£æ‰¾æœ€å¤§åŒ¹é…ä¸²</li>
</ol>
<blockquote>
<p>ä¸€ä¸ªæ»‘åŠ¨çª—å£è¡¨ç¤ºæœ€å¤šå¾€å‰æ‰¾çš„å­—ç¬¦ä¸²é•¿åº¦,zipé€šå¸¸æ˜¯32KB</p>
</blockquote>
<ol start="2">
<li>è®¾ç½®ï¼ˆè·ç¦»dis,åŒ¹é…ä¸²é•¿åº¦lenï¼‰ä½œä¸ºæ ‡è¯†ä½ï¼Œè§£å‹æ—¶ä¼šå»å¾€å‰æ‰¾åŸä¸²ã€‚</li>
</ol>
<blockquote>
<p>æ ‡å¿—ä½æœ¬èº«ä¹Ÿä¼šå ç”¨ç©ºé—´ã€‚æ•…åŒ¹é…çš„å­—ç¬¦ä¸²ä¸€èˆ¬è¦æ»¡è¶³&gt;=ä¸‰ä¸ªå­—èŠ‚</p>
</blockquote>
<ol start="3">
<li><p>å¯¹ (dis,len) åšå“ˆå¤«æ›¼ç¼–ç ï¼Œå¾—åˆ°è¾ƒå°çš„å­—èŠ‚ä¸²</p>
</li>
<li><p>æ–‡ä»¶å¤´å†™å­—å…¸:(k,v)=&gt;(å“ˆå¤«æ›¼ç¼–ç ,(dis,len))</p>
</li>
</ol>
<h4 id="zipè§£å‹ç¼©å¯¹æœ¬é¡¹ç›®çš„åº”ç”¨"><a href="#zipè§£å‹ç¼©å¯¹æœ¬é¡¹ç›®çš„åº”ç”¨" class="headerlink" title="zipè§£å‹ç¼©å¯¹æœ¬é¡¹ç›®çš„åº”ç”¨"></a>zipè§£å‹ç¼©å¯¹æœ¬é¡¹ç›®çš„åº”ç”¨</h4><ul>
<li><p>åˆå§‹åŒ–è®¾ç½®ï¼š</p>
<blockquote>
<ol>
<li>åŒ¹é…ä¸²éœ€è¦&gt;=8ä¸ªå­—ç¬¦æ‰åšå‹ç¼©</li>
<li>æ»‘åŠ¨çª—å£è®¾ä¸º64å­—ç¬¦ä¸²é•¿åº¦</li>
</ol>
</blockquote>
</li>
<li><p>å‹ç¼©æ•ˆæœ</p>
</li>
</ul>
<hr>
<p>æœªå®Œå¾…ç»­</p>
<h2 id="githubåº“"><a href="#githubåº“" class="headerlink" title="githubåº“"></a>githubåº“</h2><h2 id="ScriptOJ-å‡ºé¢˜"><a href="#ScriptOJ-å‡ºé¢˜" class="headerlink" title="ScriptOJ å‡ºé¢˜"></a>ScriptOJ å‡ºé¢˜</h2>]]></content>
      <categories>
        <category>å¤§å‰ç«¯</category>
      </categories>
  </entry>
  <entry>
    <title>Androidæ¨¡æ‹Ÿè§¦æ§è§£å†³æ–¹æ¡ˆ</title>
    <url>/2016/11/18/2016-2017%E7%9B%B4%E6%92%AD%E7%9B%B8%E5%85%B3/Android%E6%A8%A1%E6%8B%9F%E8%A7%A6%E6%8E%A7%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/</url>
    <content><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>å¦‚ä½•æ•è·ç”¨æˆ·è§¦æ§ä¿¡æ¯ï¼Ÿå¦‚ä½•æ¨¡æ‹Ÿï¼Ÿ</p>
<a id="more"></a>

<h1 id="æ•°æ®é‡‡é›†"><a href="#æ•°æ®é‡‡é›†" class="headerlink" title="æ•°æ®é‡‡é›†"></a>æ•°æ®é‡‡é›†</h1><h2 id="Androidç«¯"><a href="#Androidç«¯" class="headerlink" title="Androidç«¯"></a>Androidç«¯</h2><p>é‡å†™ onTouchEvent ,æ”¶é›† event æ•°æ®,ä»¥ä¸€å®šçš„ç¼–ç ä¼ è¾“</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouchEvent</span><span class="params">(MotionEvent event)</span></span>&#123;</span><br><span class="line">	String rec=<span class="string">""</span>;</span><br><span class="line">    <span class="keyword">int</span> pointerCount = event.getPointerCount();</span><br><span class="line">    <span class="keyword">if</span> (pointerCount &gt; MAX_TOUCHPOINTS) &#123;</span><br><span class="line">        pointerCount = MAX_TOUCHPOINTS;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> opt=event.getAction();</span><br><span class="line">    <span class="keyword">boolean</span> isFirst=<span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">if</span>(opt==<span class="number">2</span>)&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; pointerCount; i++) &#123;</span><br><span class="line">            <span class="keyword">int</span> id = event.getPointerId(i);</span><br><span class="line">            <span class="keyword">int</span> x = (<span class="keyword">int</span>) event.getX(i);</span><br><span class="line">            <span class="keyword">int</span> y = (<span class="keyword">int</span>) event.getY(i);</span><br><span class="line">            <span class="keyword">if</span>(isFirst)&#123;isFirst=<span class="keyword">false</span>;&#125;</span><br><span class="line">            <span class="keyword">else</span> rec+=<span class="string">";"</span>;</span><br><span class="line">            rec+=id+<span class="string">",2,"</span>+x+<span class="string">","</span>+y;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(opt==<span class="number">0</span>||(opt-<span class="number">5</span>)%<span class="number">256</span>==<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="comment">//ä¸ºäº†ç®€åŒ–ï¼Œæˆ‘ä»¬å‡è®¾è¿™è¿‡ç¨‹ä¸ä¼šè¿›è¡ŒMOVE</span></span><br><span class="line">        <span class="keyword">int</span> ind=(event.getAction()-<span class="number">5</span>)/<span class="number">256</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; pointerCount; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(i==ind)&#123;</span><br><span class="line">                <span class="keyword">int</span> id = event.getPointerId(i);</span><br><span class="line">                <span class="keyword">int</span> x = (<span class="keyword">int</span>) event.getX(i);</span><br><span class="line">                <span class="keyword">int</span> y = (<span class="keyword">int</span>) event.getY(i);</span><br><span class="line">                <span class="keyword">if</span>(isFirst)&#123;isFirst=<span class="keyword">false</span>;&#125;</span><br><span class="line">                <span class="keyword">else</span> rec+=<span class="string">";"</span>;</span><br><span class="line">                rec+=id+<span class="string">",0,"</span>+x+<span class="string">","</span>+y;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(opt==<span class="number">1</span>||(opt-<span class="number">6</span>)%<span class="number">256</span>==<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">int</span> ind=(event.getAction()-<span class="number">6</span>)/<span class="number">256</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; pointerCount; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(i==ind)&#123;</span><br><span class="line">                <span class="keyword">int</span> id = event.getPointerId(i);</span><br><span class="line">                <span class="keyword">if</span>(isFirst)&#123;isFirst=<span class="keyword">false</span>;&#125;</span><br><span class="line">                <span class="keyword">else</span> rec+=<span class="string">";"</span>;</span><br><span class="line">                rec+=id+<span class="string">",1"</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h2><p>è§å¦ä¸€ç¯‡æ–‡ç« <a href="http://hongweipeng.com/index.php/archives/838/" target="_blank" rel="noopener">videoæ ‡ç­¾ä¸‹è§¦æ‘¸åæ ‡å½’ä¸€åŒ–</a></p>
<h2 id="åµŒå…¥å¼è®¾å¤‡"><a href="#åµŒå…¥å¼è®¾å¤‡" class="headerlink" title="åµŒå…¥å¼è®¾å¤‡"></a>åµŒå…¥å¼è®¾å¤‡</h2><p>å¾…ç ”ç©¶</p>
<h1 id="æ•°æ®ç¼–ç "><a href="#æ•°æ®ç¼–ç " class="headerlink" title="æ•°æ®ç¼–ç "></a>æ•°æ®ç¼–ç </h1><p>æœ€åæ•°æ®ä»¥<code>ID,OPTION,X,Y</code>è¿™æ ·çš„å­—ç¬¦ä¸²ä¼ è¾“,å¤šæŒ‡æ“ä½œé€šè¿‡<code>;</code>éš”å¼€</p>
<ul>
<li><strong>OPTION:</strong> <code>0:DOWN</code>; <code>1:UP</code>;<code>2:MOVE</code></li>
<li><strong>ID:</strong> è§¦ç‚¹ID é€šè¿‡<code>event.getPointerId</code> è·å–ï¼Œ å¯¹åº”æœåŠ¡å™¨çš„<code>0x2f</code></li>
<li><strong>X,Y</strong> æŒ‰é“ç†èŒƒå›´åº”è¯¥åœ¨<code>[0,1]</code>;å³æœ¬æœºåˆ†è¾¨ç‡çš„ç™¾åˆ†æ¯”ã€‚æœåŠ¡ç«¯å†ä»¥è¯¥ç³»æ•°æ¨¡æ‹Ÿã€‚è¿™è¾¹æˆ‘ä»¬å…ˆå‡è®¾ä¸¤è¾¹æœºå™¨ä¸€æ ·ï¼Œç›´æ¥ä¼ å®é™…int</li>
</ul>
<h1 id="æ•°æ®ä¼ è¾“"><a href="#æ•°æ®ä¼ è¾“" class="headerlink" title="æ•°æ®ä¼ è¾“"></a>æ•°æ®ä¼ è¾“</h1><h2 id="socket"><a href="#socket" class="headerlink" title="socket"></a>socket</h2><h3 id="å®¢æˆ·ç«¯"><a href="#å®¢æˆ·ç«¯" class="headerlink" title="å®¢æˆ·ç«¯"></a>å®¢æˆ·ç«¯</h3><p>1.åœ¨å­çº¿ç¨‹ä¸­åˆå§‹åŒ–<code>socket</code>å’Œ<code>Handler mHandler</code><br>2.UIçº¿ç¨‹æ”¶åˆ°ç¼–ç æ•°æ®åï¼Œæ‰§è¡Œ<code>mHandler.sendMessage(message)</code>æ“ä½œ<br>3.<code>Looper</code>åœ¨å­çº¿ç¨‹çš„<code>mHandler</code>å°†ä¼šå›è°ƒ<code>handleMessage</code>ï¼Œåœ¨è¿™é‡Œè¿›è¡Œsocketä¼ è¾“</p>
<p>ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Socket socket = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> BufferedWriter writer = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> BufferedReader reader = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MyHandler</span> <span class="keyword">extends</span> <span class="title">Handler</span> </span>&#123;</span><br><span class="line">       <span class="comment">//è¿™è¾¹è¿™ä¸ªlooperå‚æ•°æ˜¯å¦åº”è¯¥è½¯å¼•ç”¨ï¼Ÿ</span></span><br><span class="line">       <span class="function"><span class="keyword">public</span> <span class="title">MyHandler</span><span class="params">(Looper looper)</span> </span>&#123;</span><br><span class="line">           <span class="keyword">super</span>(looper);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="meta">@Override</span></span><br><span class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(Message msg)</span> </span>&#123;</span><br><span class="line">           <span class="comment">//å­çº¿ç¨‹æ”¶åˆ°æ•°æ®ï¼Œè¿›è¡Œsocket send data</span></span><br><span class="line">           <span class="keyword">super</span>.handleMessage(msg);</span><br><span class="line">           Log.i(<span class="string">"RECEIVE"</span>, <span class="string">"å­çº¿ç¨‹æ”¶åˆ°:"</span> + msg.obj);</span><br><span class="line">           <span class="keyword">try</span> &#123;</span><br><span class="line">               writer.write(msg.obj + <span class="string">"\n"</span>);<span class="comment">//å¿…é¡»åŠ ä¸Šæ¢è¡Œ</span></span><br><span class="line">               writer.flush();</span><br><span class="line">           &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="class"><span class="keyword">class</span> <span class="title">SockRunnable</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            Log.i(<span class="string">"THREAD"</span>, <span class="string">"START"</span>);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                socket = <span class="keyword">new</span> Socket(<span class="string">"192.168.191.1"</span>, <span class="number">12345</span>);</span><br><span class="line">                writer = <span class="keyword">new</span> BufferedWriter(<span class="keyword">new</span> OutputStreamWriter(</span><br><span class="line">                        socket.getOutputStream(), <span class="string">"utf-8"</span>));</span><br><span class="line">                reader = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(</span><br><span class="line">                        socket.getInputStream(), <span class="string">"utf-8"</span>));</span><br><span class="line">                Log.i(<span class="string">"CONNECT"</span>, <span class="string">"è¿æ¥æˆåŠŸ"</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Looper.prepare();</span><br><span class="line">                <span class="comment">//è®©MyHandleä¸ºå­çº¿ç¨‹æœåŠ¡</span></span><br><span class="line">                mHandler = <span class="keyword">new</span> MyHandler(Looper.myLooper());</span><br><span class="line">                Looper.loop();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                Log.e(<span class="string">"zjx"</span>, <span class="string">"error"</span>);</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onDestroy();</span><br><span class="line">        <span class="keyword">if</span> (mHandler != <span class="keyword">null</span>) &#123;</span><br><span class="line">            mHandler.removeCallbacksAndMessages(<span class="keyword">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (writer != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                writer.close();</span><br><span class="line">                reader.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    onCreate&#123;</span><br><span class="line">    	<span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">       <span class="keyword">new</span> Thread(<span class="keyword">new</span> SockRunnable()).start();</span><br><span class="line">       ReceiveData rd=<span class="keyword">new</span> ReceiveData() &#123;</span><br><span class="line">           <span class="meta">@Override</span></span><br><span class="line">           <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">receive</span><span class="params">(String json)</span> </span>&#123;</span><br><span class="line">               Log.i(<span class="string">"SEND"</span>,json);</span><br><span class="line">               <span class="comment">//ADD æ—¶é—´è½´</span></span><br><span class="line">               <span class="comment">//MOVEæ•°æ®çš„è¿‡æ»¤ å¹³æ–¹å’Œ&lt;12</span></span><br><span class="line">               <span class="comment">//SOCKETæ•°æ®å‘é€</span></span><br><span class="line">               Message message=<span class="keyword">new</span> Message();</span><br><span class="line">               message.obj=json;</span><br><span class="line">               <span class="keyword">if</span>(mHandler!=<span class="keyword">null</span>)&#123;</span><br><span class="line">                   mHandler.sendMessage(message);</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;;</span><br><span class="line">    </span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<h3 id="æœåŠ¡ç«¯"><a href="#æœåŠ¡ç«¯" class="headerlink" title="æœåŠ¡ç«¯"></a>æœåŠ¡ç«¯</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ServerListener</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;  </span><br><span class="line">   	<span class="meta">@Override</span>  </span><br><span class="line">   	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">       	<span class="keyword">try</span> &#123;  </span><br><span class="line">           	ServerSocket serverSocket = <span class="keyword">new</span> ServerSocket(<span class="number">12345</span>);  </span><br><span class="line">       	    <span class="comment">// å¾ªç¯çš„ç›‘å¬  </span></span><br><span class="line">           	<span class="keyword">while</span> (<span class="keyword">true</span>) &#123;  </span><br><span class="line">               	Socket socket = serverSocket.accept();<span class="comment">// é˜»å¡  </span></span><br><span class="line">               	JOptionPane.showMessageDialog(<span class="keyword">null</span>, <span class="string">"æœ‰å®¢æˆ·ç«¯è¿æ¥åˆ°æœ¬æœºçš„12345ç«¯å£ï¼"</span>);  </span><br><span class="line">               	<span class="comment">// å°†socketä¼ ç»™æ–°çš„çº¿ç¨‹  </span></span><br><span class="line">               	ChatSocket cs = <span class="keyword">new</span> ChatSocket(socket);  </span><br><span class="line">               	cs.start();  </span><br><span class="line">               	<span class="comment">//æŠŠsocketåŠ å…¥ChatManager  </span></span><br><span class="line">               	ChatManager.getChatManager().add(cs);  </span><br><span class="line">           	&#125;  </span><br><span class="line">       	&#125; <span class="keyword">catch</span> (IOException e) &#123;  </span><br><span class="line">           	e.printStackTrace();  </span><br><span class="line">       	&#125;  </span><br><span class="line">   	&#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="DataChannel"><a href="#DataChannel" class="headerlink" title="DataChannel"></a>DataChannel</h2><p>ç•¥</p>
<h1 id="æ•°æ®è§£ç "><a href="#æ•°æ®è§£ç " class="headerlink" title="æ•°æ®è§£ç "></a>æ•°æ®è§£ç </h1><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">decodeData</span><span class="params">(String json)</span> </span>&#123;</span><br><span class="line">	String ls[] = json.split(<span class="string">";"</span>);</span><br><span class="line">	<span class="keyword">for</span> (String s : ls) &#123;</span><br><span class="line">		String cs[] = s.split(<span class="string">","</span>);</span><br><span class="line">		<span class="keyword">int</span> id = Integer.valueOf(cs[<span class="number">0</span>]);</span><br><span class="line">		<span class="keyword">int</span> opt = Integer.valueOf(cs[<span class="number">1</span>]);</span><br><span class="line">		<span class="keyword">switch</span> (opt) &#123;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">			sendDown(id, cs[<span class="number">2</span>], cs[<span class="number">3</span>]);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">			sendUp(id);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">			sendMove(id, cs[<span class="number">2</span>], cs[<span class="number">3</span>]);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="æ•°æ®æ¨¡æ‹Ÿ"><a href="#æ•°æ®æ¨¡æ‹Ÿ" class="headerlink" title="æ•°æ®æ¨¡æ‹Ÿ"></a>æ•°æ®æ¨¡æ‹Ÿ</h1><p>ä»¥ä¸‹æ–¹å¼å‡¡æ˜¯åˆ©ç”¨sendeventçš„ï¼Œéƒ½å¯ä»¥é€šè¿‡geteventå›å»åˆ°å¯¹åº”çš„æŒ‡ä»¤</p>
<p>è€Œä¼ å…¥MotionEvent.obtainçš„ï¼Œåªèƒ½é€šè¿‡å¼€å¯å¼€å‘è€…é€‰æ‹©çš„è§¦ç‚¹æ˜¾ç¤º</p>
<h2 id="1-adb-shell"><a href="#1-adb-shell" class="headerlink" title="1. adb shell"></a>1. adb shell</h2><p>åœ¨ <code>system/core/include/private/android_filesystem_config.h</code> ä¸­å®šä¹‰äº†Androidçš„ç”¨æˆ·å’Œç»„</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment">#define AID_SHELL 2000 /* adb and debug shell user UID=2000*/</span></span><br><span class="line"><span class="comment">#å³</span></span><br><span class="line">root uid 0 gid0 </span><br><span class="line">system uid 1000 gid1000</span><br><span class="line">shell uid 2000 gid2000</span><br><span class="line">app uid &gt;10000 gid &gt;10000</span><br></pre></td></tr></table></figure>
<p>åŒæ—¶æˆ‘ä»¬æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼ˆ<a href="http://www.linuxidc.com/Linux/2012-09/70492.htm" target="_blank" rel="noopener">ls -lå‘½ä»¤è¯¦è§£</a></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">shell@android:/dev/input $ ls -l</span><br><span class="line">crw-rw---- root     	input     	13,  64 2016-11-18 08:17 event0</span><br><span class="line">crw-rw---- root     	input     	13,  65 2016-11-18 08:17 event1</span><br><span class="line">crw-rw---- root     	input     	13,  66 2016-11-18 08:17 event2</span><br><span class="line">crw-rw---- root     	input     	13,  67 2016-11-18 08:17 event3</span><br><span class="line">æ–‡ä»¶å±æ€§	   æ–‡ä»¶æ‹¥æœ‰è€…     æ‹¥æœ‰è€…æ‰€åœ¨ä¸»ç»„							    æ–‡ä»¶å</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å‘ç°inputç»„æ˜¯æ‹¥æœ‰ <code>rw-</code> æƒé™çš„ã€‚</p>
<p>é€šè¿‡è¿è¡Œidå‘½ä»¤å¾—åˆ°å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">shell@android:&#x2F; $ id</span><br><span class="line">uid&#x3D;2000(shell) gid&#x3D;2000(shell) groups&#x3D;1003(graphics),1004(input),1007(log),1009</span><br><span class="line">(mount),1011(adb),1015(sdcard_rw),1028(sdcard_r),3001(net_bt_admin),3002(net_bt)</span><br><span class="line">,3003(inet),3006(net_bw_stats)</span><br></pre></td></tr></table></figure>
<p>shellå±äºinputç»„ï¼Œé‚£ä¹ˆshellä¹Ÿå°±æ‹¥æœ‰<code>rw-</code>çš„æƒé™,æ„æ€å°±æ˜¯è¯´shellç”¨æˆ·(orå…¶è¿è¡Œçš„ç¨‹åº)å¯ä»¥å¯¹eventXæ–‡ä»¶è¿›è¡Œè¯»å†™</p>
<p>é‚£ä¹ˆè¯»å†™çš„å½¢å¼å°±æœ‰ä»¥ä¸‹ä¸¤ç§äº†ï¼š</p>
<h3 id="1-1-serverç«¯æ‰§è¡Œshellè„šæœ¬"><a href="#1-1-serverç«¯æ‰§è¡Œshellè„šæœ¬" class="headerlink" title="1.1 serverç«¯æ‰§è¡Œshellè„šæœ¬"></a>1.1 serverç«¯æ‰§è¡Œshellè„šæœ¬</h3><h4 id="å¤§è‡´æµç¨‹ï¼š"><a href="#å¤§è‡´æµç¨‹ï¼š" class="headerlink" title="å¤§è‡´æµç¨‹ï¼š"></a><strong>å¤§è‡´æµç¨‹ï¼š</strong></h4><p>Javaçš„è¯å¯é‡‡ç”¨Runtime</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">process = Runtime.getRuntime().exec(<span class="string">"adb shell"</span>);</span><br><span class="line"><span class="comment">// è·å–è¾“å‡ºæµ</span></span><br><span class="line">outputStream = process.getOutputStream();</span><br><span class="line">dataOutputStream = <span class="keyword">new</span> DataOutputStream(outputStream);</span><br><span class="line"><span class="comment">// æ‰§è¡ŒcmdæŒ‡ä»¤ï¼Œä¾‹ï¼š cmd="sendevent /dev/input/event3 0 0 0";</span></span><br><span class="line">dataOutputStream.writeBytes(cmd + <span class="string">"\n"</span>);</span><br></pre></td></tr></table></figure>

<h4 id="å®ç°éš¾åº¦ï¼š5-5"><a href="#å®ç°éš¾åº¦ï¼š5-5" class="headerlink" title="å®ç°éš¾åº¦ï¼š5/5"></a><strong>å®ç°éš¾åº¦ï¼š5/5</strong></h4><p>å®ç°ç®€å•ï¼Œä»£ç é‡å°‘ã€‚å¤šç§è¯­è¨€å‡æ”¯æŒæ‰§è¡Œshellå‘½ä»¤</p>
<h4 id="ç»´æŠ¤æ‹“å±•ï¼š-1-5"><a href="#ç»´æŠ¤æ‹“å±•ï¼š-1-5" class="headerlink" title="ç»´æŠ¤æ‹“å±•ï¼š 1/5"></a><strong>ç»´æŠ¤æ‹“å±•ï¼š 1/5</strong></h4><p>Runtimeä¼šé—´æ¥æ€§å‡ºé—®é¢˜(åŸå› æœªæ˜)</p>
<p>dataOutputStreamæ“ä½œä¼šå µå¡æœ¬åœ°IOé€šé“ï¼Œä¸é€‚åˆå¤šå¼€ã€‚</p>
<p>Javaæ‰§è¡Œè·¨å¹³å°ï¼Œæ˜“è¿ç§»ï¼Œç»™1æ˜Ÿã€‚</p>
<h4 id="éœ€è¦rootï¼Ÿ-å¦"><a href="#éœ€è¦rootï¼Ÿ-å¦" class="headerlink" title="éœ€è¦rootï¼Ÿ å¦"></a><strong>éœ€è¦rootï¼Ÿ</strong> å¦</h4><h4 id="æ•ˆç‡å»¶è¿Ÿï¼š1-5"><a href="#æ•ˆç‡å»¶è¿Ÿï¼š1-5" class="headerlink" title="æ•ˆç‡å»¶è¿Ÿï¼š1/5"></a><strong>æ•ˆç‡å»¶è¿Ÿï¼š1/5</strong></h4><p>æ•ˆç‡æå·®ï¼Œ<strong><code>æŒ‡ä»¤ç»„</code></strong>ï¼ˆå•æŒ‡move,down,upç­‰æ“ä½œç§°ä¸ºæŒ‡ä»¤ç»„ï¼ŒåŒ…å«å¤šæ¡sendeventåŸºç¡€æŒ‡ä»¤ï¼‰<strong><code>å“åº”æ—¶é—´</code></strong>(æŒ‡ä»¤æ‰§è¡Œæ—¶é—´é—´éš”)&gt;200ms</p>
<h4 id="æ¨èæŒ‡æ•°ï¼š-1-5"><a href="#æ¨èæŒ‡æ•°ï¼š-1-5" class="headerlink" title="æ¨èæŒ‡æ•°ï¼š 1/5"></a><strong>æ¨èæŒ‡æ•°ï¼š</strong> 1/5</h4><h3 id="1-2-androidç«¯æ‰§è¡Œadb-shellç”¨æˆ·å¯åŠ¨çš„ç¨‹åº"><a href="#1-2-androidç«¯æ‰§è¡Œadb-shellç”¨æˆ·å¯åŠ¨çš„ç¨‹åº" class="headerlink" title="1.2 androidç«¯æ‰§è¡Œadb shellç”¨æˆ·å¯åŠ¨çš„ç¨‹åº"></a>1.2 androidç«¯æ‰§è¡Œadb shellç”¨æˆ·å¯åŠ¨çš„ç¨‹åº</h3><h4 id="å¤§è‡´æµç¨‹ï¼š-1"><a href="#å¤§è‡´æµç¨‹ï¼š-1" class="headerlink" title="å¤§è‡´æµç¨‹ï¼š"></a><strong>å¤§è‡´æµç¨‹ï¼š</strong></h4><p>1.ç¼–å†™C socketç¨‹åº<code>minitouch</code>ï¼Œå¹¶æ”¾åˆ°<code>/data/local/tmp/</code> ç›®å½•(<code>user,group=shell</code>)ä¸‹</p>
<p>2.chmod 777è¯¥æ–‡ä»¶åï¼Œrunå®ƒ</p>
<p>3.æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">adb forward tcp:1111 localabstract:minitouch</span><br></pre></td></tr></table></figure>
<p>è¡¨ç¤ºserveræœ¬åœ°çš„1111ç«¯å£ä¼šæ˜ å°„åˆ°minitouchä¸Š</p>
<p>4.æœ¬åœ°åˆ©ç”¨socketé€šä¿¡å‘é€æ•°æ®åˆ°1111ç«¯å£ï¼Œminitouchè¿›ä¸€æ­¥å¤„ç†</p>
<p><em>ä»¥ä¸Šåªæ˜¯å¤§è‡´æµç¨‹ï¼Œminitouchè¿˜æ¶‰åŠåˆ°abiå’Œsdkçš„ç‰ˆæœ¬çš„å¤„ç†</em></p>
<p><a href="https://github.com/openstf/minitouch" target="_blank" rel="noopener">å¼€æºå®ç°minitouch</a></p>
<p><a href="https://testerhome.com/topics/4400" target="_blank" rel="noopener">minitouchä½¿ç”¨æµç¨‹ï¼Œminitapå¼€æºé¡¹ç›®ç±»ä¼¼ ä¹Ÿå¯é‡‡ç”¨</a></p>
<h4 id="å®ç°éš¾åº¦ï¼š4-5"><a href="#å®ç°éš¾åº¦ï¼š4-5" class="headerlink" title="å®ç°éš¾åº¦ï¼š4/5"></a><strong>å®ç°éš¾åº¦ï¼š4/5</strong></h4><p>éœ€è¦ç¼–å†™ä¸¤ç«¯ç¨‹åºï¼šæ”¾äºandroidçš„socketç¨‹åºï¼Œæœ¬åœ°å‘é€æ•°æ®ç¨‹åºã€‚</p>
<p>ç›¸å¯¹ç®€å•ï¼Œä¸”æœ‰å¼€æºå®ç°ã€‚</p>
<h4 id="ç»´æŠ¤æ‹“å±•ï¼š-4-5"><a href="#ç»´æŠ¤æ‹“å±•ï¼š-4-5" class="headerlink" title="ç»´æŠ¤æ‹“å±•ï¼š 4/5"></a><strong>ç»´æŠ¤æ‹“å±•ï¼š 4/5</strong></h4><p>åˆ†é…æœ¬åœ°ç«¯å£å¹¶è½¬å‘åˆ°android socketç¨‹åºä¸Šï¼Œç«¯å£æ˜¯è¶³å¤Ÿç”¨çš„ï¼Œåªè¦è®¾ç½®è§„èŒƒä¸ä¼šäº§ç”Ÿå†²çª</p>
<h4 id="éœ€è¦rootï¼Ÿ-å¦-1"><a href="#éœ€è¦rootï¼Ÿ-å¦-1" class="headerlink" title="éœ€è¦rootï¼Ÿ å¦"></a><strong>éœ€è¦rootï¼Ÿ</strong> å¦</h4><p><code>sdk 10-21</code> æ— éœ€root,<code>21+</code>éœ€è¦root,<code>sdk 20 Android Wear</code> éœ€è¦root</p>
<h4 id="æ•ˆç‡å»¶è¿Ÿï¼š5-5"><a href="#æ•ˆç‡å»¶è¿Ÿï¼š5-5" class="headerlink" title="æ•ˆç‡å»¶è¿Ÿï¼š5/5"></a><strong>æ•ˆç‡å»¶è¿Ÿï¼š5/5</strong></h4><p><strong><code>æŒ‡ä»¤ç»„å“åº”æ—¶é—´</code></strong>&lt;10ms</p>
<h4 id="æ¨èæŒ‡æ•°ï¼š-4-5-5"><a href="#æ¨èæŒ‡æ•°ï¼š-4-5-5" class="headerlink" title="æ¨èæŒ‡æ•°ï¼š 4.5/5"></a><strong>æ¨èæŒ‡æ•°ï¼š</strong> 4.5/5</h4><h2 id="2-Androidç«¯-root-sendevent"><a href="#2-Androidç«¯-root-sendevent" class="headerlink" title="2. Androidç«¯ root sendevent"></a>2. Androidç«¯ root sendevent</h2><h3 id="2-1-Runtime-getRuntime-exec-â€œsuâ€"><a href="#2-1-Runtime-getRuntime-exec-â€œsuâ€" class="headerlink" title="2.1 Runtime.getRuntime().exec(â€œsuâ€)"></a>2.1 Runtime.getRuntime().exec(â€œsuâ€)</h3><h4 id="å¤§è‡´æµç¨‹ï¼š-2"><a href="#å¤§è‡´æµç¨‹ï¼š-2" class="headerlink" title="å¤§è‡´æµç¨‹ï¼š"></a>å¤§è‡´æµç¨‹ï¼š</h4><p>Androidç«¯è·å–suæƒé™åï¼Œåˆ©ç”¨Runtimeæ‰§è¡Œsendeventå‘½ä»¤</p>
<p>è¿™é‡Œçš„cmds å¯ä»¥æ˜¯<code>sendevent</code> ä¹Ÿå¯ä»¥æ˜¯<code>input swipe</code> </p>
<p>æ³¨ï¼šinput swipe å³æä¾›ä¸¤ç‚¹åæ ‡ ç„¶åmoveä¸”åªèƒ½å•æŒ‡</p>
<p>ä¹Ÿå°±æ˜¯è¯´è¦ç­‰ä¸€ä¸ªå®Œæ•´çš„DOWN-MOVE-UPè¿‡ç¨‹ ç„¶åå‘é€èµ·å§‹-ç»ˆç‚¹ä½ç½®ã€‚</p>
<p>ä¸å…¶è¿™æ · è¿˜ä¸å¦‚ç”¨sendevent ä¼˜åŒ–moveé—´éš”</p>
<p>geteventè·å–ä¸åˆ°è§¦æ§ä¿¡æ¯ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">execShellCmd</span><span class="params">(String[] cmds)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    Process process = Runtime.getRuntime().exec(<span class="string">"su"</span>);</span><br><span class="line">    DataOutputStream os = <span class="keyword">new</span> DataOutputStream(process.getOutputStream());</span><br><span class="line">    <span class="keyword">for</span> (String tmpCmd : cmds) &#123;</span><br><span class="line">        os.writeBytes(tmpCmd + <span class="string">"\n"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    os.writeBytes(<span class="string">"exit\n"</span>);</span><br><span class="line">    os.flush();</span><br><span class="line">    os.close();</span><br><span class="line">    process.waitFor();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="å®ç°éš¾åº¦ï¼š5-5-1"><a href="#å®ç°éš¾åº¦ï¼š5-5-1" class="headerlink" title="å®ç°éš¾åº¦ï¼š5/5"></a><strong>å®ç°éš¾åº¦ï¼š5/5</strong></h4><p>å®ç°ç®€å•ï¼Œä»£ç é‡å°‘ã€‚</p>
<h4 id="ç»´æŠ¤æ‹“å±•ï¼š1-5"><a href="#ç»´æŠ¤æ‹“å±•ï¼š1-5" class="headerlink" title="ç»´æŠ¤æ‹“å±•ï¼š1/5"></a><strong>ç»´æŠ¤æ‹“å±•ï¼š1/5</strong></h4><p>åŒ1.1,åŒºåˆ«åªæ˜¯ç¨‹åºè¿è¡Œä¸Androidç«¯ã€‚</p>
<h4 id="éœ€è¦rootï¼Ÿ-æ˜¯"><a href="#éœ€è¦rootï¼Ÿ-æ˜¯" class="headerlink" title="éœ€è¦rootï¼Ÿ æ˜¯"></a><strong>éœ€è¦rootï¼Ÿ</strong> æ˜¯</h4><h4 id="æ•ˆç‡å»¶è¿Ÿï¼š1-5-1"><a href="#æ•ˆç‡å»¶è¿Ÿï¼š1-5-1" class="headerlink" title="æ•ˆç‡å»¶è¿Ÿï¼š1/5"></a><strong>æ•ˆç‡å»¶è¿Ÿï¼š1/5</strong></h4><p><strong><code>æŒ‡ä»¤ç»„å“åº”æ—¶é—´</code></strong>&gt;200ms</p>
<h4 id="æ¨èæŒ‡æ•°ï¼š-1-5-1"><a href="#æ¨èæŒ‡æ•°ï¼š-1-5-1" class="headerlink" title="æ¨èæŒ‡æ•°ï¼š 1/5"></a><strong>æ¨èæŒ‡æ•°ï¼š</strong> 1/5</h4><h3 id="2-2-linux-c"><a href="#2-2-linux-c" class="headerlink" title="2.2 linux c"></a>2.2 linux c</h3><p>ç”±äºæˆ‘ä»¬æ˜¯è‡ªå·±ç¼–è¯‘Androidç³»ç»Ÿï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å†™ä¸ªlinux C socketç¨‹åºæ”¾åœ¨Androidé‡Œ</p>
<p>linux C socketç¼–ç¨‹è¿™è¾¹ä¸æåŠï¼Œæˆ‘ä»¬å‡è®¾å–å¾—è§£ç çš„å€¼äº†</p>
<p>ç¼–å†™å¦‚ä¸‹æ–‡ä»¶</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;jni.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;android/log.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;errno.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/stat.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;linux/input.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/time.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LOG_TAG <span class="meta-string">"ZJX"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ABS_MT_SLOT 0x2f</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ABS_MT_TOUCH_MAJOR 0x30</span></span><br><span class="line"><span class="comment">/* WARNING: DO NOT EDIT, AUTO-GENERATED CODE - SEE TOP FOR INSTRUCTIONS */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ABS_MT_TOUCH_MINOR 0x31</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ABS_MT_WIDTH_MAJOR 0x32</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ABS_MT_WIDTH_MINOR 0x33</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ABS_MT_ORIENTATION 0x34</span></span><br><span class="line"><span class="comment">/* WARNING: DO NOT EDIT, AUTO-GENERATED CODE - SEE TOP FOR INSTRUCTIONS */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ABS_MT_POSITION_X 0x35</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ABS_MT_POSITION_Y 0x36</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ABS_MT_TOOL_TYPE 0x37</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ABS_MT_BLOB_ID 0x38</span></span><br><span class="line"><span class="comment">/* WARNING: DO NOT EDIT, AUTO-GENERATED CODE - SEE TOP FOR INSTRUCTIONS */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ABS_MT_TRACKING_ID 0x39</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> finger_count=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">int</span> fd_touch=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">int</span> finger_id=<span class="number">520</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">sendEvent</span><span class="params">(__u16 type,__u16 code,<span class="keyword">int</span> value)</span></span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">input_event</span> <span class="title">event</span>;</span></span><br><span class="line">    event.type = type;</span><br><span class="line">    event.code = code;</span><br><span class="line">    event.value = value;</span><br><span class="line">	<span class="comment">//    gettimeofday(&amp;event.time,0);</span></span><br><span class="line">	<span class="built_in">write</span>(fd_touch, &amp;event, <span class="keyword">sizeof</span>(event));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">touchMove</span><span class="params">(<span class="keyword">int</span> finger_index,<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span></span>&#123;</span><br><span class="line">    sendEvent( EV_ABS,ABS_MT_SLOT,finger_index);</span><br><span class="line">    sendEvent( EV_ABS, ABS_MT_POSITION_X, x);</span><br><span class="line">    sendEvent( EV_ABS, ABS_MT_POSITION_Y, y);</span><br><span class="line">    sendEvent( EV_SYN, SYN_REPORT, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">touchDown</span><span class="params">(<span class="keyword">int</span> finger_index,<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span></span>&#123;</span><br><span class="line">    finger_count++;</span><br><span class="line">    sendEvent( EV_ABS, ABS_MT_SLOT, finger_index);</span><br><span class="line">   	<span class="comment">//éœ€è¦æŒ‡å®šABS_MT_TRACKING_IDï¼Œå¦åˆ™sendevent( EV_ABS, ABS_MT_TRACKING_ID, -1);ä¸ä¼šç”Ÿæ•ˆ</span></span><br><span class="line">   	sendEvent( EV_ABS, ABS_MT_TRACKING_ID, finger_id++);</span><br><span class="line">   	sendEvent( EV_ABS, ABS_MT_POSITION_X, x);</span><br><span class="line">   	sendEvent( EV_ABS, ABS_MT_POSITION_Y, y);</span><br><span class="line">   	<span class="keyword">if</span>(finger_count==<span class="number">1</span>)&#123;</span><br><span class="line">   	    sendEvent( EV_KEY, BTN_TOUCH, <span class="number">1</span>);</span><br><span class="line">   	&#125;</span><br><span class="line">   	sendEvent( EV_SYN, SYN_REPORT, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">touchUp</span><span class="params">(<span class="keyword">int</span> finger_index)</span> </span>&#123;</span><br><span class="line">   	finger_count--;</span><br><span class="line">   	sendEvent( EV_ABS, ABS_MT_SLOT, finger_index);</span><br><span class="line">   	sendEvent( EV_ABS, ABS_MT_TRACKING_ID, <span class="number">-1</span>);</span><br><span class="line">   	<span class="keyword">if</span>(finger_count==<span class="number">0</span>)&#123;</span><br><span class="line">   	    sendEvent( EV_KEY, BTN_TOUCH, <span class="number">0</span>);</span><br><span class="line">   	&#125;</span><br><span class="line">   	sendEvent( EV_SYN, SYN_REPORT, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨mainå†™ä¸ªæµ‹è¯•</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	fd_touch = <span class="built_in">open</span>(<span class="string">"/dev/input/event3"</span>, O_RDWR);</span><br><span class="line">   	<span class="keyword">if</span>(fd_touch&lt;=<span class="number">0</span>) &#123;</span><br><span class="line">       	<span class="keyword">return</span> env-&gt;NewStringUTF(strerror(errno));</span><br><span class="line">   	&#125;</span><br><span class="line">    	touchDown(<span class="number">0</span>,<span class="number">380</span>,<span class="number">400</span>);</span><br><span class="line"><span class="comment">//     touchDown(1,250,250);</span></span><br><span class="line"></span><br><span class="line">     touchMove(<span class="number">0</span>,<span class="number">300</span>,<span class="number">300</span>);</span><br><span class="line"><span class="comment">//     touchMove(1,350,350);</span></span><br><span class="line">     touchMove(<span class="number">0</span>,<span class="number">200</span>,<span class="number">400</span>);</span><br><span class="line"><span class="comment">//     touchMove(1,300,500);</span></span><br><span class="line">     touchMove(<span class="number">0</span>,<span class="number">350</span>,<span class="number">250</span>);</span><br><span class="line"><span class="comment">//     touchMove(1,250,250);</span></span><br><span class="line">     touchMove(<span class="number">0</span>,<span class="number">200</span>,<span class="number">600</span>);</span><br><span class="line"></span><br><span class="line">     touchUp(<span class="number">0</span>);</span><br><span class="line"><span class="comment">//     touchUp(1);</span></span><br><span class="line">   	<span class="built_in">close</span>(fd_touch);</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<blockquote>
<p>è¿™è¾¹æˆ‘ä»¬æ˜¯ä¸€æ¥å—åˆ°socketä¼ æ¥çš„å€¼åï¼Œå°±è¿›è¡Œå¤„ç†ï¼Œé‚£ä¹ˆéœ€è¦ç»™inpue_eventèµ‹å€¼timeå±æ€§å—ï¼Ÿ</p>
</blockquote>
<p>ä¸ç”¨èµ‹å€¼ã€‚åšäº†ä¸‹æµ‹è¯•ï¼Œæ„Ÿè§‰æ²¡èµ‹å€¼çš„è¯å†™å…¥æ—¶é»˜è®¤å°±æ˜¯å½“å‰æ—¶é—´ï¼Œå…·ä½“eventæ–‡ä»¶è¯»å†™åŸç†æœ‰ç©ºå†çœ‹ã€‚æˆ–è€…æ‡‚çš„å¤§ç‰›å‘Šè¯‰æˆ‘ä¸‹ã€‚</p>
<blockquote>
<p>å¦‚æœæ˜¯è‡ªå·±å†™çš„ç¨‹åºæƒ³æ¨¡æ‹Ÿé•¿æŒ‰ï¼Œæ˜¯é€šè¿‡èµ‹å€¼timeè¿˜æ˜¯Thread.sleep?</p>
</blockquote>
<p>å¦‚æœæƒ³åšå»¶è¿Ÿï¼Œè¦åœ¨ä¸Šä¸€å±‚å»åšï¼Œè€Œä¸æ˜¯èµ‹å€¼timeæˆ–è€…åœ¨æœ¬å±‚å µå¡çº¿ç¨‹,ä¸Šä¸€å±‚åšæ›´å®‰å…¨ã€‚</p>
<blockquote>
<p>æµ‹è¯•çš„æ—¶å€™ï¼Œæ‰“å°äº†onTouch(MotionEvent ev)ä¸­evçš„å€¼ï¼Œå‘ç°éƒ¨åˆ†moveäº‹ä»¶æ²¡æ‰¾åˆ°ï¼Œæ˜¯è¢«ä¸¢å¼ƒäº†å—ï¼Ÿ</p>
</blockquote>
<p>å¹¶ä¸æ˜¯ï¼Œæ‰“å°geteventå°±æ‰¾åˆ°æ˜¯éƒ½ä¼šå“åº”çš„ã€‚</p>
<p>åªæ˜¯ç”±äºæŒ‡ä»¤å¤ªå¿« Moveä¼šè¿›è¡Œåˆå¹¶ï¼ŒonTouchä¸­æ‰“å°getHistorySizeå°±æ˜ç™½äº†</p>
<p>æ‰€ä»¥ä¸è¦å› ä¸ºæµ‹è¯•çš„æ—¶å€™ç”»æ¿ç”»å‡ºæ¥çš„ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„è·¯çº¿å°±ä»¥ä¸ºæ˜¯æ•°æ®è¢«ä¸¢æ‰äº†- -</p>
<h4 id="å®ç°éš¾åº¦ï¼š4-5-5"><a href="#å®ç°éš¾åº¦ï¼š4-5-5" class="headerlink" title="å®ç°éš¾åº¦ï¼š4.5/5"></a><strong>å®ç°éš¾åº¦ï¼š4.5/5</strong></h4><p>å®ç°ç®€å•ï¼Œä»£ç é‡å°‘ã€‚åªè¦æ‡‚C Socketç¼–ç¨‹å°±å¯ä»¥äº†ã€‚</p>
<h4 id="ç»´æŠ¤æ‹“å±•ï¼š3-5-5"><a href="#ç»´æŠ¤æ‹“å±•ï¼š3-5-5" class="headerlink" title="ç»´æŠ¤æ‹“å±•ï¼š3.5/5"></a><strong>ç»´æŠ¤æ‹“å±•ï¼š3.5/5</strong></h4><p>éœ€è¦åœ¨è‡ªç¼–è¯‘çš„androidç³»ç»Ÿä¸Šï¼Œä»¥inputç»„ç”¨æˆ·è¿è¡Œ</p>
<p>æˆ–è€…åœ¨éè‡ªç¼–è¯‘ç³»ç»Ÿé‡‡ç”¨1.2çš„åšæ³•</p>
<h4 id="éœ€è¦rootï¼Ÿ-ä¸ç¡®å®š"><a href="#éœ€è¦rootï¼Ÿ-ä¸ç¡®å®š" class="headerlink" title="éœ€è¦rootï¼Ÿ ä¸ç¡®å®š"></a><strong>éœ€è¦rootï¼Ÿ</strong> ä¸ç¡®å®š</h4><p>è‡ªç¼–è¯‘çš„ç³»ç»Ÿï¼Œå¯ä»¥ä»¥shellç”¨æˆ·å†™eventXæ–‡ä»¶</p>
<p>å½“ç„¶æœ€æ–¹ä¾¿è¿˜æ˜¯ç›´æ¥ç”¨rootå•¦</p>
<h4 id="æ•ˆç‡å»¶è¿Ÿï¼š5-5-1"><a href="#æ•ˆç‡å»¶è¿Ÿï¼š5-5-1" class="headerlink" title="æ•ˆç‡å»¶è¿Ÿï¼š5/5"></a><strong>æ•ˆç‡å»¶è¿Ÿï¼š5/5</strong></h4><p><strong><code>æŒ‡ä»¤ç»„å“åº”æ—¶é—´</code></strong>&lt;10ms</p>
<h4 id="æ¨èæŒ‡æ•°ï¼š-4-7-5"><a href="#æ¨èæŒ‡æ•°ï¼š-4-7-5" class="headerlink" title="æ¨èæŒ‡æ•°ï¼š 4.7/5"></a><strong>æ¨èæŒ‡æ•°ï¼š</strong> 4.7/5</h4><h3 id="2-3-jni"><a href="#2-3-jni" class="headerlink" title="2.3  jni"></a>2.3  jni</h3><p>æ•°æ®å¤„ç†ä¸<strong>2.2</strong>ä¸€è‡´ï¼Œåªæ˜¯socketæ˜¯Android Serviceå»åšçš„ï¼Œé€šè¿‡jniè°ƒç”¨</p>
<p>åšæ³•ï¼š</p>
<p>1.å…ˆä¿®æ”¹æ–‡ä»¶æƒé™</p>
<pre><code>shell@android:/ $ su            
root@android:/ # chmod 777 /dev/input/event3  æ³¨ Android 5.x ç”±äºSELinux?è¿˜æ˜¯æƒé™å—é™</code></pre><p>2.ç„¶åå¾€<code>/dev/input/eventX</code>å†™æ•°æ®å°±å¥½äº†</p>
<pre><code>extern &quot;C&quot;
jstring Java_com_example_zhengjx_myapplication_MainActivity_sendEvent2(
    JNIEnv* env,
    jobject obj,jint type,jint a,jint b,jint c) {
    char *hello = &quot;Hello from C++&quot;;
    fd_touch = open(&quot;/dev/input/event3&quot;, O_RDWR);
    if(fd_touch&lt;=0) {
        return env-&gt;NewStringUTF(strerror(errno));
    }
    //å°†ç³»ç»Ÿå½“å‰æ—¶é—´ä»¥ç»“æ„ä½“å½¢å¼è¿”å›ç»™cur,åˆå§‹æ—¶é—´æˆ³
    struct timeval cur;
    gettimeofday(&amp;cur, NULL);
    switch (type){
        case 0:touchDown(a,b,c);break;
        case 1:touchUp(a);break;
        case 2:touchMove(a,b,c);break;
    }
    close(fd_touch);
    return env-&gt;NewStringUTF(hello);
}</code></pre><p>TEST:</p>
<pre><code>sendEvent2(0,0,380,400);
sendEvent2(2,0,300,300);
sendEvent2(2,0,200,400);
sendEvent2(2,0,350,250);
sendEvent2(2,0,400,600);
sendEvent2(1,0,0,0);</code></pre><blockquote>
<p>ä¸2.2ç›¸æ¯”å°±æ˜¯å¤šäº†ä¸€ä¸ªjniè°ƒç”¨çš„è€—æ—¶(è¯¥éƒ¨åˆ†è€—æ—¶&lt;10ms)</p>
</blockquote>
<p>ä¸ºäº†ä¸è®©eventX åšmoveä¼˜åŒ–ï¼Œè¯¥éƒ¨åˆ†è€—æ—¶åè€Œæ˜¯å¥½çš„,æµ‹è¯•çš„æ—¶å€™æ¯æ¡moveæŒ‡ä»¤éƒ½ä¼šå“åº”ï¼ŒåŸºæœ¬ä¸ä¼šè¿›è¡Œmoveåˆå¹¶ã€‚</p>
<p>å¦å¤–è®°å¾—æŠŠevent3æ–‡ä»¶å¼€æˆå…¨å±€çš„ï¼Œé˜²æ­¢æ¯æ¬¡éƒ½è¦åˆ›å»º å…³é—­æµçš„è€—æ—¶- -ï¼Œè€Œä¸”ä¸çŸ¥é“ä¼šä¸ä¼šæœ‰ä»€ä¹ˆå½±å“</p>
<blockquote>
<p>5.x chmod 777 åæƒé™å—é™é—®é¢˜</p>
</blockquote>
<p>æŒ‰è§£å†³é—®é¢˜çš„æƒ³æ³•ï¼Œä¸ç”¨rootçš„æ–¹æ³•æˆ‘ä»¬ç”¨adb shellä¸ä¼šå‡ºç°è¿™é—®é¢˜ï¼Œéœ€è¦rootçš„æˆ‘ä»¬ç›´æ¥linux Cï¼Œè¿™æ–¹æ³•æ²¡æœ‰ä»€ä¹ˆä»·å€¼ã€‚</p>
<h4 id="å®ç°éš¾åº¦ï¼š5-5-2"><a href="#å®ç°éš¾åº¦ï¼š5-5-2" class="headerlink" title="å®ç°éš¾åº¦ï¼š5/5"></a><strong>å®ç°éš¾åº¦ï¼š5/5</strong></h4><p>å®ç°ç®€å•ï¼Œä»£ç é‡å°‘ã€‚</p>
<h4 id="ç»´æŠ¤æ‹“å±•ï¼š4-5"><a href="#ç»´æŠ¤æ‹“å±•ï¼š4-5" class="headerlink" title="ç»´æŠ¤æ‹“å±•ï¼š4/5"></a><strong>ç»´æŠ¤æ‹“å±•ï¼š4/5</strong></h4><p>5.X çš„ æƒé™å—é™é—®é¢˜ï¼Œæ­£åœ¨ç ”ç©¶è§£å†³æ–¹æ¡ˆã€‚ã€‚</p>
<h4 id="éœ€è¦rootï¼Ÿ-éœ€è¦"><a href="#éœ€è¦rootï¼Ÿ-éœ€è¦" class="headerlink" title="éœ€è¦rootï¼Ÿ éœ€è¦"></a><strong>éœ€è¦rootï¼Ÿ</strong> éœ€è¦</h4><p>éœ€è¦rootç”¨æˆ·å…ˆå°†eventXæ–‡ä»¶å±æ€§æ”¹ä¸º777</p>
<h4 id="æ•ˆç‡å»¶è¿Ÿï¼š5-5-2"><a href="#æ•ˆç‡å»¶è¿Ÿï¼š5-5-2" class="headerlink" title="æ•ˆç‡å»¶è¿Ÿï¼š5/5"></a><strong>æ•ˆç‡å»¶è¿Ÿï¼š5/5</strong></h4><p><strong><code>æŒ‡ä»¤ç»„å“åº”æ—¶é—´</code></strong>â‰ˆ10ms</p>
<h4 id="æ¨èæŒ‡æ•°ï¼š-4-7-5-1"><a href="#æ¨èæŒ‡æ•°ï¼š-4-7-5-1" class="headerlink" title="æ¨èæŒ‡æ•°ï¼š 4.7/5"></a><strong>æ¨èæŒ‡æ•°ï¼š</strong> 4.7/5</h4><h3 id="2-4-RootTools"><a href="#2-4-RootTools" class="headerlink" title="2.4  RootTools"></a>2.4  RootTools</h3><p>RootToolsæ˜¯ä¸€ä¸ªç”¨äºæ‰§è¡ŒlinuxæŒ‡ä»¤çš„<a href="https://github.com/Stericson/RootTools" target="_blank" rel="noopener">å¼€æºå·¥å…·</a></p>
<p>ç”¨æ³•ï¼š</p>
<pre><code>CommandCapture cmd = new CommandCapture(0, &quot;sendevent /dev/input/event3 0 0 &quot;);
RootTools.getShell(true).add(cmd);</code></pre><p>å¤§è‡´ç ”ç©¶äº†ä¸‹ï¼Œæ˜¯é€šè¿‡çº¿ç¨‹æ± é¡ºåºæ‰§è¡ŒæŒ‡ä»¤ï¼Œæ•ˆç‡åˆæ¯”Rumtimeé«˜é‚£ä¹ˆä¸€ç‚¹ç‚¹</p>
<h4 id="å®ç°éš¾åº¦ï¼š5-5-3"><a href="#å®ç°éš¾åº¦ï¼š5-5-3" class="headerlink" title="å®ç°éš¾åº¦ï¼š5/5"></a><strong>å®ç°éš¾åº¦ï¼š5/5</strong></h4><p>å®ç°ç®€å•ï¼Œä»£ç é‡å°‘ã€‚</p>
<h4 id="ç»´æŠ¤æ‹“å±•ï¼š5-5"><a href="#ç»´æŠ¤æ‹“å±•ï¼š5-5" class="headerlink" title="ç»´æŠ¤æ‹“å±•ï¼š5/5"></a><strong>ç»´æŠ¤æ‹“å±•ï¼š5/5</strong></h4><h4 id="éœ€è¦rootï¼Ÿ-æ˜¯-1"><a href="#éœ€è¦rootï¼Ÿ-æ˜¯-1" class="headerlink" title="éœ€è¦rootï¼Ÿ æ˜¯"></a><strong>éœ€è¦rootï¼Ÿ</strong> æ˜¯</h4><h4 id="æ•ˆç‡å»¶è¿Ÿï¼š2-5"><a href="#æ•ˆç‡å»¶è¿Ÿï¼š2-5" class="headerlink" title="æ•ˆç‡å»¶è¿Ÿï¼š2/5"></a><strong>æ•ˆç‡å»¶è¿Ÿï¼š2/5</strong></h4><p><strong><code>æŒ‡ä»¤ç»„å“åº”æ—¶é—´</code></strong> :æŒ‡ä»¤ç»„ä¸­æŒ‡ä»¤æ•°é‡ï¼š1æ¡100ms 2æ¡120-200ms 3+:200+ms</p>
<h4 id="æ¨èæŒ‡æ•°ï¼š-2-5"><a href="#æ¨èæŒ‡æ•°ï¼š-2-5" class="headerlink" title="æ¨èæŒ‡æ•°ï¼š 2/5"></a><strong>æ¨èæŒ‡æ•°ï¼š</strong> 2/5</h4><h2 id="3-MotionEvent-obtain"><a href="#3-MotionEvent-obtain" class="headerlink" title="3. MotionEvent.obtain"></a>3. MotionEvent.obtain</h2><h3 id="3-1-Instrumentation"><a href="#3-1-Instrumentation" class="headerlink" title="3.1 Instrumentation"></a>3.1 Instrumentation</h3><h4 id="å¤§è‡´æµç¨‹"><a href="#å¤§è‡´æµç¨‹" class="headerlink" title="å¤§è‡´æµç¨‹"></a>å¤§è‡´æµç¨‹</h4><pre><code>Instrumentation m_Instrumentation = new Instrumentation();
long downTime = SystemClock.uptimeMillis();
long eventTime = SystemClock.uptimeMillis() + 100;
long eventTime2 = SystemClock.uptimeMillis() + 200;
float x=200.0f;
float y=280.0f;
m_Instrumentation.sendPointerSync(MotionEvent.obtain(downTime,
downTime,MotionEvent.ACTION_DOWN,x, y, 0));
for(int i=1;i&lt;=50;i++){
    m_Instrumentation.sendPointerSync(MotionEvent.obtain(downTime,
        SystemClock.uptimeMillis(),MotionEvent.ACTION_MOVE,x+i, y, 0));
}
for(int i=1;i&lt;=50;i++){
    m_Instrumentation.sendPointerSync(MotionEvent.obtain(downTime,
        SystemClock.uptimeMillis(),MotionEvent.ACTION_MOVE,x+50, y+i, 0));
}
for(int i=50;i&gt;=1;i--){
    m_Instrumentation.sendPointerSync(MotionEvent.obtain(downTime,
        SystemClock.uptimeMillis(),MotionEvent.ACTION_MOVE,x+i, y+50, 0));
}
for(int i=50;i&gt;=1;i--){
    m_Instrumentation.sendPointerSync(MotionEvent.obtain(downTime,
        SystemClock.uptimeMillis(),MotionEvent.ACTION_MOVE,x, y+i, 0));
}
m_Instrumentation.sendPointerSync(MotionEvent.obtain(downTime,
    eventTime2,MotionEvent.ACTION_UP,550, 550, 0));</code></pre><p>APIæ˜¯å¼€æ”¾çš„</p>
<p>åœ¨å…¶ä»–åº”ç”¨ä¸Šä½¿ç”¨ä¼šå‡ºç°è¿™æ ·çš„æç¤ºï¼š</p>
<p><code>java.lang.SecurityException: Injecting to another application requires INJECT_EVENTS permission</code></p>
<p><code>http://stackoverflow.com/questions/22163424/android-java-lang-securityexception-injecting-to-another-application-requires</code> æ— è§£</p>
<p>æ·»åŠ æƒé™æ— æ•ˆï¼Œå¿…é¡»å°†è¯¥åº”ç”¨ç½®ä¸ºsystemåº”ç”¨.</p>
<p>åº•å±‚è¿˜æ˜¯åŸºäºIwindowManager å»åšçš„ï¼Œè¿™è¾¹æˆ‘ä»¬ä¸å†åˆ†æç›´æ¥è®¨è®º3.2</p>
<h3 id="3-2-IWindowManager"><a href="#3-2-IWindowManager" class="headerlink" title="3.2 IWindowManager"></a>3.2 IWindowManager</h3><p>monkeyï¼ŒRobotiumå°±æ˜¯åŸºäºå®ƒåšçš„</p>
<pre><code>IWindowManager.Stub.asInterface(ServiceManager
               .getService(&quot;window&quot;))).injectPointerEvent(event, true);</code></pre><p>ä»API 8å¼€å§‹IWindowManageræ¥å£å°±è¢«å±è”½æ‰äº†ï¼Œæ²¡æœ‰è¿™ä¸ªAPIç›´æ¥è°ƒç”¨ã€‚</p>
<p>å¯ä»¥æºç ç¼–è¯‘ç”ŸæˆjaråŒ… rootæƒé™ä¸‹é™jarå¯¼å…¥    <code>/system/framework/</code>ä¸‹ï¼Œæˆ–è€…ç›´æ¥ç”¨åå°„(æ•ˆç‡å·®ç‚¹) </p>
<p>å¦‚ä½•è·³å‡ºè¿›ç¨‹é—´é™åˆ¶ï¼Ÿ<a href="http://blog.csdn.net/zhubaitian/article/details/40430053" target="_blank" rel="noopener">è¯¥ç¯‡è¯‘æ–‡ç»™å‡ºäº†é“¾æ¥</a></p>
<h4 id="å®ç°éš¾åº¦ï¼š4-5-1"><a href="#å®ç°éš¾åº¦ï¼š4-5-1" class="headerlink" title="å®ç°éš¾åº¦ï¼š4/5"></a><strong>å®ç°éš¾åº¦ï¼š4/5</strong></h4><p>ä¸»è¦æ˜¯å¤šæŒ‡çš„ä»£ç ä¼šæ¯”è¾ƒå¤šå’Œå¤æ‚ï¼Œä¸æ˜“å°è£…ã€‚</p>
<p>æ²¡æœ‰æä¾›å†…éƒ¨æ¥å£çš„é—®é¢˜è§£å†³æ–¹æ¡ˆä¹Ÿç»™å‡ºäº†ï¼Œæˆ–è€…ç›´æ¥ç”¨<code>Instrumentation</code>ã€‚</p>
<h4 id="ç»´æŠ¤æ‹“å±•ï¼š4-5-1"><a href="#ç»´æŠ¤æ‹“å±•ï¼š4-5-1" class="headerlink" title="ç»´æŠ¤æ‹“å±•ï¼š4/5"></a><strong>ç»´æŠ¤æ‹“å±•ï¼š4/5</strong></h4><p>ç ”ç©¶çš„ä¸æ·±ï¼Œå¯èƒ½æœ‰äº›å‘å­˜åœ¨</p>
<h4 id="éœ€è¦rootï¼Ÿ-å¦-2"><a href="#éœ€è¦rootï¼Ÿ-å¦-2" class="headerlink" title="éœ€è¦rootï¼Ÿ å¦"></a><strong>éœ€è¦rootï¼Ÿ</strong> å¦</h4><p>ä½†æ˜¯åº”ç”¨éœ€è¦æ‹¥æœ‰systemæƒé™</p>
<h4 id="æ•ˆç‡å»¶è¿Ÿï¼š3-5-5"><a href="#æ•ˆç‡å»¶è¿Ÿï¼š3-5-5" class="headerlink" title="æ•ˆç‡å»¶è¿Ÿï¼š3.5/5"></a><strong>æ•ˆç‡å»¶è¿Ÿï¼š3.5/5</strong></h4><p><strong><code>æŒ‡ä»¤ç»„å“åº”æ—¶é—´</code></strong>20~50ms</p>
<h4 id="æ¨èæŒ‡æ•°ï¼š-4-5"><a href="#æ¨èæŒ‡æ•°ï¼š-4-5" class="headerlink" title="æ¨èæŒ‡æ•°ï¼š 4/5"></a><strong>æ¨èæŒ‡æ•°ï¼š</strong> 4/5</h4><h2 id="Accessibilityservice"><a href="#Accessibilityservice" class="headerlink" title="Accessibilityservice"></a>Accessibilityservice</h2><p>å€ŸåŠ©Androidæä¾›çš„æ— éšœç¢æœåŠ¡<br>åœ¨<code>res/xml</code>ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ª<code>accessibility_service_config.xml</code>æ–‡ä»¶</p>
<pre><code>&lt;intent-filter&gt;
    &lt;action android:name=&quot;android.accessibilityservice.AccessibilityService&quot; /&gt;
&lt;/intent-filter&gt;</code></pre><p><code>http://blog.csdn.net/sinyu890807/article/details/47803149</code></p>
<p>å®ç°è¦å„ç§åˆ¤æ–­:</p>
<pre><code>çª—å£åå¤ªå¤š æ‰‹åŠ¨ç”Ÿæˆaccessibility_service_configå†serviceæ‰‹åŠ¨Intentæ³¨å…¥actionä¸å¤ªåˆé€‚
ç„¶åæ“ä½œèŠ‚ç‚¹ç­‰åˆæ˜¯å¾ˆéº»çƒ¦çš„ä¸€ä»¶äº‹ï¼šé€‚åˆå¯¹å·²çŸ¥èŠ‚ç‚¹æ“ä½œï¼Œä¸é€‚åˆæ¨¡æ‹Ÿ</code></pre><p><strong>(å¼ƒ</strong></p>
<p>å…¶ä»–ï¼šérootæ–¹æ³•</p>
<p>é€šè¿‡hookæ–¹æ³•ç»•è¿‡æƒé™éªŒè¯</p>
<pre><code>//http://blog.sina.com.cn/s/blog_151b043850102wiv9.html</code></pre><p>ä»¥åæœ‰ç©ºå†ç ”ç©¶</p>
<h1 id="é™„å½•"><a href="#é™„å½•" class="headerlink" title="é™„å½•"></a>é™„å½•</h1><p>sendevent.c<br><a href="http://www.netmite.com/android/mydroid/system/core/toolbox/sendevent.c" target="_blank" rel="noopener">http://www.netmite.com/android/mydroid/system/core/toolbox/sendevent.c</a><br><a href="http://androidxref.com/4.4.4_r1/xref/system/core/toolbox/getevent.c" target="_blank" rel="noopener">http://androidxref.com/4.4.4_r1/xref/system/core/toolbox/getevent.c</a></p>
<h1 id="é˜²é€€å‡ºå…¨å±"><a href="#é˜²é€€å‡ºå…¨å±" class="headerlink" title="é˜²é€€å‡ºå…¨å±"></a>é˜²é€€å‡ºå…¨å±</h1><p>1.çŠ¶æ€æ </p>
<h2 id="çº¯å®¢æˆ·ç«¯å»åš"><a href="#çº¯å®¢æˆ·ç«¯å»åš" class="headerlink" title="çº¯å®¢æˆ·ç«¯å»åš"></a>çº¯å®¢æˆ·ç«¯å»åš</h2><p>ç›®å‰æ¯”è¾ƒç®€å•çš„å®šä¹‰æ˜¯ï¼š<br>å½“TOUCH_DOWNå¤„äº çºµåæ ‡0.9-1.0åŒºåŸŸæ—¶ï¼Œå°†æ­¤æ—¶çš„äº‹ä»¶æ”¾å…¥buffer,<br>æ¥ä¸‹æ¥çš„æ“ä½œï¼Œå¦‚æœä¸ºTOUCH_MOVE,ä¸”å…¶åæ ‡åœ¨TOUCH_DOWNçš„åæ ‡ä¸Šæ–¹ï¼Œéƒ½å°†æ”¾å…¥bufferã€‚</p>
<p><strong>å®¢æˆ·ç«¯å»åšä¸å¤ªå¯è¡Œ ä¸€äº›å¥‡æ€ªçš„æ‰‹åŠ¿ä¸èƒ½è¿‡æ»¤æ‰</strong> </p>
<h2 id="åšä¸€ä¸ªç³»ç»Ÿåº”ç”¨ï¼Œéœ€è¦æœ‰ç³»ç»Ÿç­¾å"><a href="#åšä¸€ä¸ªç³»ç»Ÿåº”ç”¨ï¼Œéœ€è¦æœ‰ç³»ç»Ÿç­¾å" class="headerlink" title="åšä¸€ä¸ªç³»ç»Ÿåº”ç”¨ï¼Œéœ€è¦æœ‰ç³»ç»Ÿç­¾å"></a>åšä¸€ä¸ªç³»ç»Ÿåº”ç”¨ï¼Œéœ€è¦æœ‰ç³»ç»Ÿç­¾å</h2><pre><code> 1   public static final void collapseStatusBar(Context ctx) {
 2   Object sbservice = ctx.getSystemService(&quot;statusbar&quot;);
 3   try {
 4   Class&lt;?&gt; statusBarManager = Class.forName(&quot;android.app.StatusBarManager&quot;);
 5   Method collapse;
 6   if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.JELLY_BEAN_MR1) {
 7   collapse = statusBarManager.getMethod(&quot;collapsePanels&quot;);
 8   } else {
 9   collapse = statusBarManager.getMethod(&quot;collapse&quot;);
10   }
11   collapse.invoke(sbservice);
12   } catch (Exception e) {
13   e.printStackTrace();
14   }
15   }</code></pre><p>collapseåªæ˜¯æŠ˜å çŠ¶æ€æ ï¼Œè¿˜æ˜¯èƒ½å¼ºè¡Œæ‹–åŠ¨ä¸‹æ‹‰ï¼Œä¸èƒ½æ ¹æœ¬çš„å±è”½</p>
<p>éœ€è¦è°ƒç”¨disableæ–¹æ³•</p>
<pre><code>@Override
protected void onResume() {
    Toast.makeText(this,&quot;onResume&quot;,Toast.LENGTH_LONG).show();
    Object service = getSystemService(&quot;statusbar&quot;);
    try {
        Class &lt;?&gt; statusBarManager = Class.forName(&quot;android.app.StatusBarManager&quot;);
        Method expand = statusBarManager.getMethod(&quot;disable&quot;,int.class);
        expand.invoke (service,0x00010000);
        Toast.makeText(this,&quot;success&quot;,Toast.LENGTH_LONG).show();
    } catch (Exception e) {
        Toast.makeText(this,e.toString(),Toast.LENGTH_LONG).show();
        e.printStackTrace();
    }
    super.onResume();
}
@Override
protected void onDestroy() {
    //è§£é™¤ç¦æ­¢ï¼Œåå°„ mStatusBarManager.disable(StatusBarManager.DISABLE_NONE);0x00000000
    super.onDestroy();
}


package=&quot;com.ws.tryplayservice&quot; android:sharedUserId=&quot;android.uid.system&quot;&gt;
&lt;uses-permission android:name=&quot;android.permission.STATUS_BAR&quot; /&gt;
&lt;uses-permission android:name=&quot;android.permission.EXPAND_STATUS_BAR&quot; /&gt;</code></pre><p>2.åº•éƒ¨å¯¼èˆªæ </p>
<p>éœ€æ±‚æ˜¯ä¸è®©å¯¼èˆªæ æ˜¾ç¤ºï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬çš„è™šæ‹ŸæŒ‰é”®æŒ‰é”®ä¸æ˜¾ç¤ºï¼Œé‚£ä¹ˆåœ¨æ¨¡æ‹Ÿå™¨é…ç½®HardWare Profielä¸­å¼€å¯ç¡¬ä»¶æŒ‰é’®ï¼ˆHas HardWare Buttonï¼‰</p>
<h1 id="æ•è·åŸºæœ¬çŸ¥è¯†"><a href="#æ•è·åŸºæœ¬çŸ¥è¯†" class="headerlink" title="æ•è·åŸºæœ¬çŸ¥è¯†"></a>æ•è·åŸºæœ¬çŸ¥è¯†</h1><pre><code>//ACTION_POINTER_i_DOWN:5 261 517 773 å­˜åœ¨è§¦ç‚¹çš„æƒ…å†µä¸‹ DOWN
//ACTION_POINTER_i_UP:6 262 518 774   å­˜åœ¨è§¦ç‚¹çš„æƒ…å†µä¸‹ UP
//æ¯æ¬¡UPæ—¶è¿”å›indexåï¼Œå†æ¬¡UPæ—¶ç³»ç»Ÿä¼šé‡åšå¡«å……ï¼Œ
//å³æŒ‰é¡ºåº1 2 3 4 DOWNåï¼Œ UPäº†1 è¿”å›6 æ­¤æ—¶UP 2 è¿”å›çš„è¿˜æ˜¯6 è¯´æ˜å†æ¬¡UPæ—¶ä¼šæŠŠè§¦ç‚¹INDEXå¾€å‰å¡«å……
//å¤šä¸ªè§¦ç‚¹æ—¶ï¼ŒUPç¬¬ä¸€ä¸ªè¿”å›çš„æ˜¯6ï¼Œä½†æ˜¯åªæœ‰ä¸€ä¸ªè§¦ç‚¹æ—¶è¿”å›çš„æ˜¯2
//æŒ‰é¡ºåº1 2 3 4 DOWNåï¼ŒUP 1è¿”å›6ï¼Œæ­¤æ—¶å†DOWN 5è¿”å›çš„æ˜¯5ï¼Œè¯´æ˜å†æ¬¡DOWNä¼šä»å¤´æ‰¾å¼€å§‹å¡«å……
//UPæ—¶ï¼Œé€šè¿‡event.getPointerCount()å¾—åˆ°çš„æ•°é‡ä¸ä¼šå˜ï¼Œåªæœ‰å†æ¬¡æ‰ä¼šæ›´æ–°ï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦å¾—åˆ°UPç‚¹çš„x,yç­‰ä¿¡æ¯
// DOWN 0 1 2 å UP äº† 1 æ­¤æ—¶å‰© 0 2 getPointerId(1)å¯ä»¥è¿”å›index=1çš„ç‚¹idä¸º2
//éœ€è¦ç†æ¸…çš„æ˜¯pointerIndexä¸pointerIDéç­‰åŒ
//éMOVEäº‹ä»¶ï¼Œè§¦ç‚¹åæ ‡ä¹Ÿå¯èƒ½æ”¹å˜ã€‚ä¾‹ï¼š1 2æŒ‡æŒ‰ï¼Œ1æŒ‡æŠ¬ï¼ŒACTION=6 æ­¤æ—¶è·å–2æŒ‡çš„x,yå¯èƒ½ä¼šä¸1æŒ‡æœªæŠ¬æ—¶çš„ä½ç½®ä¸ä¸€è‡´
//å› ä¸ºè§¦æ‘¸å±æ˜¯æŒ‰ä¸€å®šæ—¶é—´é—´éš”çš„ï¼Œåœ¨è¿™å¾ˆå°çš„æ—¶é—´é—´éš”å†…ï¼ŒåŒæ—¶å‡ºç°äº†MOVEå’ŒUP,ä¼˜å…ˆUP,æ‰€ä»¥ACTION=UP ä½†æ˜¯ä½ç½®è¿˜æ˜¯ä¼šç§»åŠ¨
//å‹åŠ› ç­‰ä¼ æ„Ÿå™¨ æš‚æ—¶ä¸è€ƒè™‘ï¼Œè§¦æ‘¸ç‚¹ç›´å¾„ä¹Ÿæš‚æ—¶ä¸è€ƒè™‘
//å‡ºç°å“ªäº›äº‹ä»¶éœ€è¦å‘æ•°æ®ï¼Œå‘ä»€ä¹ˆæ•°æ®ï¼Ÿä¸sendEventå¯¹åº”
//0.(é‡)è¿›æ¸¸æˆç•Œé¢æ—¶ï¼Œå‘é€æ¸…ç©ºæ‰€æœ‰è§¦ç‚¹çš„æŒ‡ä»¤
//1.DOWN  or UP å‘å…¶ä½ç½® SENDEVENT 1 or 0 å…·ä½“æ•°æ® åŒæ—¶æ›´æ–° åˆ é™¤æ•°ç»„æ•°æ®
//2.MOVE  æŒ‰IDå¾—åˆ°æ–°çš„ä½ç½® ä¸ä¹‹å‰è¿›è¡Œæ¯”è¾ƒ</code></pre><h1 id="æ•è·æ—¶å¼‚å¸¸"><a href="#æ•è·æ—¶å¼‚å¸¸" class="headerlink" title="æ•è·æ—¶å¼‚å¸¸"></a>æ•è·æ—¶å¼‚å¸¸</h1><p>å•æŒ‡ä¸‹ï¼š<br>åœ¨GameViewä¸­æ»‘åŠ¨æ—¶(DOWNåœ¨GameViewä¸­) èƒ½å¤Ÿæ•è·åˆ°touchä¿¡æ¯ï¼Œæ»‘åŠ¨åˆ°GameViewå¤–ä¹Ÿèƒ½æ•è·åˆ°MOVE,UPä¿¡æ¯ã€‚<br>è€Œä»GameViewå¤–æ»‘è¿›GameView(downåœ¨GameViewå¤–)æ•è·ä¸åˆ°touchä¿¡æ¯</p>
<p>å¤šæŒ‡ï¼š<br>è‹¥å·²æœ‰ä¸€ä¸ªè§¦ç‚¹åœ¨GameViewå†…ï¼ˆå¯ä»¥æ•è·åˆ°touchä¿¡æ¯ï¼‰ï¼Œå¦ä¸€ä¸ªè§¦ç‚¹ä»GameViewå¤–æ»‘å…¥ã€‚ä¹Ÿæ˜¯å¯ä»¥æ•è·å¾—åˆ°å¦ä¸€ä¸ªè§¦ç‚¹çš„touchä¿¡æ¯ã€‚<br>å› ä¸ºç¬¬äºŒä¸ªè§¦ç‚¹çš„downä¸æ˜¯TOUCH_DOWN è€Œæ˜¯ TOUCH_POINTER_DOWN</p>
<p>æ€»çš„æ¥è¯´ï¼Œåªè¦æœ‰touchdownäº‹ä»¶ï¼Œç›´æ¥å¯¹å±å¹•çš„æ“ä½œéƒ½èƒ½è¢«æ•è·åˆ°</p>
<p>å¦‚æœä»ç”»é¢å¤–å¼€å§‹çš„touchéƒ½è¿‡æ»¤çš„è¯ æ“ä½œå¦‚ä¸‹ï¼š</p>
<p>onTouchæ”¾åœ¨GameViewä¸Šç›‘å¬</p>
<p>if(opt=touch_down){<br>    æ­£å¸¸å‘é€<br>}<br>else if(opt=touch_up){<br>    æ­£å¸¸å‘é€<br>}<br>else if(opt=touch_move){<br>    for(){<br>        if(IDå¤„äºé»‘åå•)è¯¥idçš„moveä¸å‘é€<br>        else æ­£å¸¸å‘é€<br>    }<br>}else if(opt=touch_pointer_down){<br>    if(downåæ ‡å¤„äºGameViewä¹‹å¤–)å°†è¯¥idæ”¾å…¥é»‘åå•<br>    else æ­£å¸¸å‘é€<br>}else if(opt=touch_pointer_up){<br>    if(idå¤„äºé»‘åå•)åˆ™è¯¥idçš„upä¸å‘é€<br>    else æ­£å¸¸å‘é€<br>}</p>
<p>å¦‚æœè¦ä¿ç•™ä»ç”»é¢å¤–å¼€å§‹çš„touch,ç›´åˆ°ç”»é¢å†…æ‰å¼€å§‹æ•è·ï¼š</p>
<p>onTouchæ”¾åœ¨GameViewçš„å¤–å±‚GameViewLayoutä¸Šå»ç›‘å¬</p>
<pre><code>int opt = event.getAction();
Log.d(TAG, &quot;onTouch: &quot; + opt);
if (opt == 2) {
    List&lt;TouchEvent&gt; whiteList = new ArrayList();
    for (int i = 0; i &lt; pointerCount; i++) {
        int id = event.getPointerId(i);
        float x = event.getX(i);
        float y = event.getY(i);
        //if idä½äºç°åå•ï¼Œå¦‚æœmoveè¿›GameViewåˆ™éœ€è¦è¡¥ä¸Šdownäº‹ä»¶,å¹¶ä»ç°åå•ä¸­åˆ é™¤
        //else æ”¾å…¥ç™½åå•ï¼Œæœ€ålistå‘é€
        if (graySet.contains(id)) {
            //ä¸ä½äºGameViewåˆ™ä¸å¤„ç†
            if (locateGameView(x, y)) {
                //ä¹‹å‰æœªå‘è¿‡downåˆ™å‘é€downäº‹ä»¶
                receiveData(new TouchEvent(id, 0, x, y));
                graySet.remove(id);
                receiveData(new SyncEvent(pointerCount-graySet.size()));
            }
        } else {
            whiteList.add(new TouchEvent(id, 2, x, y));
        }
    }
    if (whiteList != null &amp;&amp; whiteList.size() &gt; 0) {
        receiveData(whiteList);
    }
} else if (opt == 0 || (opt - 5) % 256 == 0) {
    //ä¸ºäº†ç®€åŒ–ï¼Œæˆ‘ä»¬å‡è®¾è¿™è¿‡ç¨‹ä¸ä¼šè¿›è¡ŒMOVE
    //ind æŒ‡å½“å‰è§¦æ‘¸åºåˆ—çš„ç´¢å¼•å€¼ï¼Œä¸ä¸€å®šè¿ç»­
    //è·å–idè¿˜å¾—é€šè¿‡getPointerId
    int ind = (event.getAction() - 5) / 256;
    int id = event.getPointerId(ind);
    float x = event.getX(ind);
    float y = event.getY(ind);
    if (!locateGameView(x, y)) {
        //å°†è¯¥idæ”¾å…¥ç°åå•
        Log.d(TAG, &quot;receiveData:graySet.add&quot;);
        graySet.add(id);
    } else {
        receiveData(new TouchEvent(id, 0, x, y));
        receiveData(new SyncEvent(pointerCount-graySet.size()));
    }
} else if (opt == 1 || (opt - 6) % 256 == 0) {
    int ind = (event.getAction() - 6) / 256;
    int id = event.getPointerId(ind);
    //if å¤„äºç°åå• ç§»é™¤
    //else å‘é€upäº‹ä»¶
    if (!graySet.contains(id)) {
        receiveData(new TouchEvent(id, 1, 0, 0));
        receiveData(new SyncEvent(pointerCount -graySet.size() - 1));
    }else{
        graySet.remove(id);
    }
}</code></pre><h1 id="æ¨¡æ‹Ÿå™¨ä¸æ”¯æŒMuiti-Touch"><a href="#æ¨¡æ‹Ÿå™¨ä¸æ”¯æŒMuiti-Touch" class="headerlink" title="æ¨¡æ‹Ÿå™¨ä¸æ”¯æŒMuiti-Touch"></a>æ¨¡æ‹Ÿå™¨ä¸æ”¯æŒMuiti-Touch</h1><p>ä¸€å¼€å§‹ä»¥ä¸ºè¦å‡çº§æ¨¡æ‹Ÿå™¨ç‰ˆæœ¬ï¼Œå¥½åƒæ˜¯ä¸åŒæ¨¡æ‹Ÿå™¨é»˜è®¤çš„è§¦æ§åè®®ä¸ä¸€æ ·ï¼Œæˆ‘ä»¬çš„æ–¹å¼çš„è¯è¦ç”¨Båè®®ï¼ŒAåè®®çš„è¯ä»£ç éœ€è¦ä¿®æ”¹ã€‚</p>
<p>SYN_EVENTé‡Œé¢æœ‰</p>
<pre><code>#define SYN_REPORT 0
#define SYN_CONFIG 1
/* SYN_MT_REPORT ä¸å¤šç‚¹è§¦æ§ä¹Ÿæœ‰å…³ç³» ä¸çŸ¥é“ä½ç‰ˆæœ¬æ˜¯å¦å…¼å®¹ */
#define SYN_MT_REPORT 2</code></pre>]]></content>
      <categories>
        <category>Android</category>
      </categories>
      <tags>
        <tag>å¤šç‚¹è§¦æ§</tag>
      </tags>
  </entry>
  <entry>
    <title>Androidç›‘å¬å±å¹•æ—‹è½¬</title>
    <url>/2016/10/18/2016-2017%E7%9B%B4%E6%92%AD%E7%9B%B8%E5%85%B3/Android%E7%9B%91%E5%90%AC%E5%B1%8F%E5%B9%95%E6%97%8B%E8%BD%AC/</url>
    <content><![CDATA[<h2 id="éœ€æ±‚"><a href="#éœ€æ±‚" class="headerlink" title="éœ€æ±‚"></a>éœ€æ±‚</h2><p>ç›‘å¬å±å¹•æ—‹è½¬ï¼Œä¸é‡å»ºActivity</p>
<p>å¤§å‰æï¼šActivity å·²ç»é™å®šå±å¹•ç«–å±</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">android:screenOrientation="portrait"</span><br></pre></td></tr></table></figure>
<a id="more"></a>
<h2 id="æ–¹æ¡ˆ"><a href="#æ–¹æ¡ˆ" class="headerlink" title="æ–¹æ¡ˆ"></a>æ–¹æ¡ˆ</h2><h3 id="æ–¹æ³•ä¸€ã€ç»“è®ºä¸å¯è¡Œã€‘"><a href="#æ–¹æ³•ä¸€ã€ç»“è®ºä¸å¯è¡Œã€‘" class="headerlink" title="æ–¹æ³•ä¸€ã€ç»“è®ºä¸å¯è¡Œã€‘"></a>æ–¹æ³•ä¸€ã€ç»“è®ºä¸å¯è¡Œã€‘</h3><p>è¦æƒ³ç›‘å¬å±å¹•æ—‹è½¬ï¼Œéœ€è¦ï¼š</p>
<p>1.æƒé™å£°æ˜</p>
<pre><code>&lt;uses-permission android:name=&quot;android.permission.CHANGE_CONFIGURATION&quot;&gt;&lt;/uses-permission&gt;</code></pre><p>2.å£°æ˜activityè¦æ•è·çš„äº‹ä»¶ç±»å‹</p>
<pre><code>android:configChanges=&quot;orientation&quot;</code></pre><p>keyboardHiddenè¡¨ç¤ºé”®ç›˜è¾…åŠ©åŠŸèƒ½éšè—ï¼Œå¦‚æœä½ çš„å¼€å‘APIç­‰çº§ç­‰äºæˆ–é«˜äº13ï¼Œè¿˜éœ€è¦è®¾ç½®screenSizeï¼Œå› ä¸ºscreenSizeä¼šåœ¨å±å¹•æ—‹è½¬æ—¶æ”¹å˜ï¼›</p>
<p>ä¸€èˆ¬è¿™æ ·è®¾</p>
<pre><code>android:configChanges=&quot;keyboardHidden|orientation|screenSize&quot;</code></pre><p>ä¼˜ç‚¹ï¼šæˆ‘ä»¬å¯ä»¥éšæ—¶ç›‘å¬å±å¹•æ—‹è½¬å˜åŒ–ï¼Œå¹¶å¯¹åº”åšå‡ºç›¸åº”çš„æ“ä½œï¼›</p>
<p>ç¼ºç‚¹ï¼šå®ƒåªèƒ½ä¸€æ¬¡æ—‹è½¬90åº¦ï¼Œå¦‚æœä¸€ä¸‹å­æ—‹è½¬180åº¦ï¼ŒonConfigurationChangedå‡½æ•°ä¸ä¼šè¢«è°ƒç”¨ã€‚</p>
<p>3.é‡å†™Activityä¸­çš„onConfigurationChangedæ–¹æ³•</p>
<pre><code>@Override
public void onConfigurationChanged(Configuration newConfig) {
// å½“æ–°è®¾ç½®ä¸­ï¼Œå±å¹•å¸ƒå±€æ¨¡å¼ä¸ºæ¨ªæ’æ—¶
    if(newConfig.orientation == ActivityInfo.SCREEN_ORIENTATION_LANDSCAPE)
    {
    //TODO æŸäº›æ“ä½œ 
    }
    super.onConfigurationChanged(newConfig);
}</code></pre><p>å‰æï¼šæœªå¼€å¯æ–¹å‘é”å®š or æœªè®¾ç½® android:screenOrientation æ–¹å‘å›ºå®šorå¿½è§†ä¼ æ„Ÿå™¨</p>
<p>ä¸å¤§å‰æä¸ç¬¦</p>
<h3 id="æ–¹æ¡ˆäºŒ-åˆ©ç”¨é‡åŠ›ä¼ æ„Ÿå™¨"><a href="#æ–¹æ¡ˆäºŒ-åˆ©ç”¨é‡åŠ›ä¼ æ„Ÿå™¨" class="headerlink" title="æ–¹æ¡ˆäºŒ åˆ©ç”¨é‡åŠ›ä¼ æ„Ÿå™¨"></a>æ–¹æ¡ˆäºŒ åˆ©ç”¨é‡åŠ›ä¼ æ„Ÿå™¨</h3><p>å¯æ‹“å±•æ€§å¥½</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ws.tryplay.util;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.content.Context;</span><br><span class="line"><span class="keyword">import</span> android.content.pm.ActivityInfo;</span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"><span class="keyword">import</span> android.view.OrientationEventListener;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by zhengjx on 2016/12/14.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ScreenOrientationUtil</span> </span>&#123;</span><br><span class="line">   <span class="keyword">private</span> OrientationEventListener mOrientationListener;</span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">boolean</span> mScreenPortrait = <span class="keyword">true</span>;</span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">boolean</span> mCurrentOrient = <span class="keyword">false</span>;</span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">"ScreenOrientationUtil"</span>;</span><br><span class="line">   <span class="keyword">private</span> OrientationEvent event;</span><br><span class="line">   <span class="keyword">private</span> Context mContext;</span><br><span class="line">   <span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">OrientationEvent</span></span>&#123;</span><br><span class="line">       <span class="function"><span class="keyword">void</span> <span class="title">orientationChanged</span><span class="params">(<span class="keyword">int</span> orientation)</span></span>;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">ScreenOrientationUtil</span><span class="params">(OrientationEvent event, Context mContext)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">this</span>.event = event;</span><br><span class="line">       <span class="keyword">this</span>.mContext = mContext;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">startOrientationChangeListener</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       mOrientationListener = <span class="keyword">new</span> OrientationEventListener(<span class="keyword">this</span>.mContext) &#123;</span><br><span class="line">           <span class="meta">@Override</span></span><br><span class="line">           <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onOrientationChanged</span><span class="params">(<span class="keyword">int</span> rotation)</span> </span>&#123;</span><br><span class="line">               <span class="keyword">if</span> (((rotation &gt;= <span class="number">0</span>) &amp;&amp; (rotation &lt;= <span class="number">45</span>)) || (rotation &gt;= <span class="number">315</span>)||(rotation&gt;=<span class="number">135</span>)&amp;&amp;(rotation&lt;=<span class="number">225</span>))) &#123;<span class="comment">//portrait</span></span><br><span class="line">                   mCurrentOrient = <span class="keyword">true</span>;</span><br><span class="line">                   <span class="keyword">if</span>(mCurrentOrient!=mScreenPortrait)</span><br><span class="line">                   &#123;</span><br><span class="line">                       mScreenPortrait = mCurrentOrient;</span><br><span class="line">                       event.orientationChanged(ActivityInfo.SCREEN_ORIENTATION_PORTRAIT);</span><br><span class="line">                       Log.d(TAG, <span class="string">"Screen orientation changed from Landscape to Portrait!"</span>);</span><br><span class="line">                   &#125;</span><br><span class="line">               &#125;</span><br><span class="line">               <span class="keyword">else</span> <span class="keyword">if</span> (((rotation &gt; <span class="number">45</span>) &amp;&amp; (rotation &lt; <span class="number">135</span>))||((rotation&gt;<span class="number">225</span>)&amp;&amp;(rotation&lt;<span class="number">315</span>))) &#123;<span class="comment">//landscape</span></span><br><span class="line">                   mCurrentOrient = <span class="keyword">false</span>;</span><br><span class="line">                   <span class="keyword">if</span>(mCurrentOrient!=mScreenPortrait)</span><br><span class="line">                   &#123;</span><br><span class="line">                       mScreenPortrait = mCurrentOrient;</span><br><span class="line">                       event.orientationChanged(ActivityInfo.SCREEN_ORIENTATION_LANDSCAPE);</span><br><span class="line">                       Log.d(TAG, <span class="string">"Screen orientation changed from Portrait to Landscape!"</span>);</span><br><span class="line">                   &#125;</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;;</span><br><span class="line">       mOrientationListener.enable();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>Activityä¸­å»æ³¨å†Œç›‘å¬</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> ScreenOrientationUtil.OrientationEvent orientationEvent=<span class="keyword">new</span> ScreenOrientationUtil.OrientationEvent() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">orientationChanged</span><span class="params">(<span class="keyword">int</span> orientation)</span> </span>&#123;</span><br><span class="line">        Log.d(TAG, <span class="string">"orientationChanged() called with: orientation = ["</span> + orientation + <span class="string">"]"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> ScreenOrientationUtil(orientationEvent,GameActivity.<span class="keyword">this</span>).startOrientationChangeListener();</span><br></pre></td></tr></table></figure>



]]></content>
      <categories>
        <category>Android</category>
      </categories>
  </entry>
  <entry>
    <title>æµåª’ä½“ç›´æ’­â€”WebRTC native 2 browser</title>
    <url>/2016/08/24/2016-2017%E7%9B%B4%E6%92%AD%E7%9B%B8%E5%85%B3/%E6%B5%81%E5%AA%92%E4%BD%93%E7%9B%B4%E6%92%AD%E2%80%94WebRTC%20native%202%20browser%20/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å…³äºbrowser 2 browserçš„ç½‘ä¸Šæ–‡ç« å¾ˆå¤šï¼Œæˆ‘å°±ä¸ä»‹ç»äº†ã€‚</p>
<p>å¯ä»¥å‚è€ƒæˆ‘çš„è¿™ç¯‡æ–‡ç« <a href="https://www.hongweipeng.com/index.php/archives/835/" target="_blank" rel="noopener">æµåª’ä½“ç›´æ’­â€”â€”èµ„æ–™æ•´ç†ã€ä½ æƒ³è¦äº†è§£çš„éƒ½åœ¨è¿™</a></p>
<p>é‡Œé¢ç»™çš„é“¾æ¥å¯ä»¥å»çœ‹çœ‹</p>
<p>è¿™è¾¹æˆ‘è¦è®²çš„æ˜¯<strong>WebRTCç¼–è¯‘åçš„æ‰§è¡Œæ–‡ä»¶</strong>å’Œ<strong>Webç«¯</strong>è¿›è¡Œäº¤äº’ã€‚</p>
<p><strong>é¦–å…ˆè¦æ˜ç¡®çš„æ˜¯</strong>ï¼Œbrowser 2 browserçš„åº”ç”¨åœºæ™¯å¤ªç‹­å°äº†ï¼šè§†é¢‘é€šè¯â€¦</p>
<p>è€Œç¼–è¯‘WebRTCæˆ‘ä»¬å°±å¯ä»¥åšæ›´å¤šçš„äº‹ï¼šå±å¹•å…±äº«.. å½•æ’­.. è¿œç¨‹æ•™è‚²ã€åˆ‡æ¢é€šè¯å’Œå±å¹•ã€‘..</p>
<p>å› ä¸ºè§†é¢‘æºæˆ‘ä»¬æ˜¯å¯æ§çš„ï¼Œä¸åƒ Web. ã€å…¶å®b2bä¹Ÿå¯ä»¥åšå±å¹•å…±äº«ï¼Œä¸è¿‡c2bä¼šæ¯”è¾ƒå¯æ§ã€‘</p>
<p>ç¼–è¯‘WebRTCæ˜¯ä¸€ä»¶éº»çƒ¦çš„äº‹ï¼Œå¯ä»¥å‚è€ƒä¸Šé¢é‚£ç¯‡æ–‡ç« ã€‚<br>è¿™é‡Œæˆ‘ç›´æ¥ç»™å‡ºä¸¤ä¸ªå¯è¿è¡Œç¨‹åº</p>
<blockquote>
<p>ä¸‹è½½åœ°å€ï¼š<a href="http://pan.baidu.com/s/1bVpx9O" target="_blank" rel="noopener">http://pan.baidu.com/s/1bVpx9O</a></p>
</blockquote>
<p>å¦‚æœç½‘ç›˜æŒ‚äº†è¯·æé†’æˆ‘</p>
<a id="more"></a>


<h1 id="æµç¨‹"><a href="#æµç¨‹" class="headerlink" title="æµç¨‹"></a>æµç¨‹</h1><p>å…ˆç”¨èµ·æ¥å§ï¼Œè™½ç„¶jsæœ‰æ³¨é‡Šï¼Œä¸è¿‡æˆ‘åé¢è¿˜æ˜¯ä¼šè¯¦ç»†è§£æçš„ã€‚</p>
<h2 id="æ„æ¶Webç«¯"><a href="#æ„æ¶Webç«¯" class="headerlink" title="æ„æ¶Webç«¯"></a>æ„æ¶Webç«¯</h2><ol>
<li>æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ä½œä¸ºè¯¥webé¡¹ç›®çš„æ ¹ç›®å½•ï¼Œå°±å«WebrtcTESTå§</li>
<li>åœ¨æ ¹ç›®å½•ä¸‹æ–°å»ºjsæ–‡ä»¶å¤¹</li>
<li>ä¸‹è½½<a href="https://www.hongweipeng.com/usr/uploads/2016/08/2467397271.rar" target="_blank" rel="noopener">æ‰€éœ€jsæ–‡ä»¶.rar</a>å¹¶è§£å‹ï¼ŒæŠŠå¾—åˆ°çš„æ–‡ä»¶æ”¾å…¥jsæ–‡ä»¶å¤¹ä¸­ã€‚</li>
<li>æ ¹ç›®å½•ä¸‹æ–°å»ºtest.htmlæ–‡ä»¶ï¼Œä»£ç å¦‚ä¸‹</li>
</ol>
<pre><code>&lt;!DOCTYPE html&gt;
&lt;html&gt;

    &lt;head&gt;
        &lt;meta charset=&quot;utf-8&quot; /&gt;
        &lt;title&gt;æ¸¸æˆ&lt;/title&gt;
        &lt;script type=&quot;text/javascript&quot; src=&quot;./jquery-1.11.1.min.js&quot;&gt;&lt;/script&gt;
        &lt;script type=&quot;text/javascript&quot; src=&quot;./adapter.js&quot;&gt;&lt;/script&gt;
        &lt;!--&lt;script type=&quot;text/javascript&quot; src=&quot;./adapter_no_global.js&quot;&gt;&lt;/script&gt;--&gt;
        &lt;script&gt;
            var request = null;
            var hangingGet = null;
            var localName;
            var server;
            var my_id = -1;
            //è®°å½•å…¶ä»–peer
            var other_peers = {};
            var message_counter = 0;

            // added stuff start 
            var pc;
            //constraints for desktop browser 
            var desktopConstraints = {

                video: {
                    mandatory: {
                        maxWidth: 800,
                        maxHeight: 600
                    }
                },

                audio: true
            };

            //constraints for mobile browser 
            var mobileConstraints = {

                video: {
                    mandatory: {
                        maxWidth: 480,
                        maxHeight: 320,
                    }
                },

                audio: true
            }

            //if a user is using a mobile browser 
            if(/Android|iPhone|iPad/i.test(navigator.userAgent)) {
                var constraints = mobileConstraints;
            } else {
                var constraints = desktopConstraints;
            }
            var remoteStream;

            function trace(txt) {
                var elem = document.getElementById(&quot;debug&quot;);
                elem.innerHTML += txt + &quot;&lt;br&gt;&quot;;
            }

            function sendToPeer(peer_id, data) {
                if(my_id == -1) {
                    alert(&quot;Not connected&quot;);
                    return;
                }
                if(peer_id == my_id) {
                    alert(&quot;Can&apos;t send a message to oneself :)&quot;);
                    return;
                }
                var r = new XMLHttpRequest();
                r.open(&quot;POST&quot;, server + &quot;/message?peer_id=&quot; + my_id + &quot;&amp;to=&quot; + peer_id,
                    false);
                r.setRequestHeader(&quot;Content-Type&quot;, &quot;text/plain&quot;);
                r.send(data);
                console.log(peer_id, &quot; Send &quot;, data);
                trace(peer_id + &quot; Send :&quot; + data);
                var dataJson = JSON.parse(data);
                console.log(peer_id, &quot; send &quot;, data);
                r = null;
            }
            var onSessionConnecting = function(message) {

                console.log(&quot;Session connecting.&quot;);
                trace(&quot;Session connecting.&quot;);
            }

            var onSessionOpened = function(message) {
                console.log(&quot;Session opened.&quot;);
                trace(&quot;Session opened.&quot;);
            }

            var onRemoteStreamRemoved = function(event) {
                    console.log(&quot;Remote stream removed.&quot;);
                    trace(&quot;Remote stream removed.&quot;);
                }
                //This function 
            var createPeerConnection = function(connectionId) {
                var pc_config = {
                    &quot;iceServers&quot;: [{
                        &quot;url&quot;: &quot;stun:stun.l.google.com:19302&quot;
                    }]
                };
                try {
                    console.log(pc_config);
                    trace(pc_config);
                    // åˆ›å»ºPeerConnectionå®ä¾‹ (å‚æ•°ä¸ºnullåˆ™æ²¡æœ‰iceserverï¼Œå³ä½¿æ²¡æœ‰stunserverå’Œturnserverï¼Œä»å¯åœ¨å±€åŸŸç½‘ä¸‹é€šè®¯)
                    pc = new RTCPeerConnection(pc_config);
                    // å‘é€ICEå€™é€‰åˆ°å…¶ä»–å®¢æˆ·ç«¯
                    pc.onicecandidate = function(event) {
                        if(event.candidate) {
                            var msgCANDIDATE = {};
                            msgCANDIDATE.sdpMLineIndex = event.candidate.sdpMLineIndex;
                            msgCANDIDATE.sdpMid = event.candidate.sdpMid;
                            msgCANDIDATE.candidate = event.candidate.candidate;
                            sendToPeer(connectionId, JSON.stringify(msgCANDIDATE));
                        } else {
                            console.log(&quot;End of candidates.&quot;);
                            trace(&quot;End of candidates.&quot;);
                        }
                    };
                    pc.onconnecting = onSessionConnecting;
                    pc.onopen = onSessionOpened;
                    // å¦‚æœæ£€æµ‹åˆ°åª’ä½“æµè¿æ¥åˆ°æœ¬åœ°ï¼Œå°†å…¶ç»‘å®šåˆ°ä¸€ä¸ªvideoæ ‡ç­¾ä¸Šè¾“å‡º
                    pc.onaddstream = function(event) {
                        console.log(&quot;Remote stream added.&quot;);
                        trace(&quot;Remote stream added.&quot;);
                        document.getElementById(&apos;remoteVideo&apos;).src = URL.createObjectURL(event.stream);
                    }
                    pc.onremovestream = onRemoteStreamRemoved;
                    console.log(&quot;Created RTCPeerConnnection with config \&quot;&quot; + JSON.stringify(pc_config) + &quot;\&quot;. for &quot;);
                    trace(&quot;Created RTCPeerConnnection with config \&quot;&quot; + JSON.stringify(pc_config) + &quot;\&quot;. for &quot;);
                    //setLocalStream(connectionId);//è§£é™¤æ³¨é‡Šå°†å¯ä»¥åŒç«¯é€šä¿¡ ä¸è¿‡å»¶è¿Ÿå°±é«˜äº†
                } catch(e) {
                    console.log(&quot;Failed to create PeerConnection with &quot; + connectionId + &quot;, exception: &quot; + e.message);
                    trace(&quot;Failed to create PeerConnection with &quot; + connectionId + &quot;, exception: &quot; + e.message);
                }

            }

            function setLocalStream(connectionId) {
                // è·å–æœ¬åœ°éŸ³é¢‘å’Œè§†é¢‘æµ
                navigator.getUserMedia(constraints, function(stream) {
                    //ç»‘å®šæœ¬åœ°åª’ä½“æµåˆ°videoæ ‡ç­¾ç”¨äºè¾“å‡º
                    document.getElementById(&apos;localVideo&apos;).src = URL.createObjectURL(stream);
                    //å‘PeerConnectionä¸­åŠ å…¥éœ€è¦å‘é€çš„æµ
                    pc.addStream(stream);
                    //å¦‚æœæ˜¯å‘èµ·æ–¹åˆ™å‘é€ä¸€ä¸ªofferä¿¡ä»¤
                    pc.createOffer(function sendOfferFn(desc) {
                        pc.setLocalDescription(desc);
                        var data = JSON.stringify(desc);
                        sendToPeer(connectionId, data);
                    }, function(error) {
                        console.log(&apos;Failure callback: &apos; + error);
                        trace(&apos;Failure callback: &apos; + error);
                    });
                }, function(error) {
                    //å¤„ç†åª’ä½“æµåˆ›å»ºå¤±è´¥é”™è¯¯
                    console.log(&apos;getUserMedia error: &apos; + error);
                    trace(&apos;getUserMedia error: &apos; + error);
                });

            }
            //æ·»åŠ æ–°åŠ å…¥çš„peeråˆ°æœ¬åœ°
            function handleServerNotification(data) {
                console.log(&quot;Server notification: &quot; + data);
                trace(&quot;Server notification: &quot; + data);
                var parsed = data.split(&apos;,&apos;);
                if(parseInt(parsed[2]) != 0)
                    other_peers[parseInt(parsed[1])] = parsed[0];
            }
            //å¦‚æœæ˜¯ä¸€ä¸ªICEçš„å€™é€‰ï¼Œåˆ™å°†å…¶åŠ å…¥åˆ°PeerConnectionä¸­ï¼Œå¦åˆ™è®¾å®šå¯¹æ–¹çš„sessionæè¿°ä¸ºä¼ é€’è¿‡æ¥çš„æè¿°
            function handlePeerMessage(peer_id, data) {
                var dataJson = JSON.parse(data);
                if(data.search(&quot;offer&quot;) != -1) {
                    //json:{&quot;sdp&quot;:xxx,type:&quot;offer&quot;}
                    createPeerConnection(peer_id);
                    pc.setRemoteDescription(new RTCSessionDescription(dataJson));
                    pc.createAnswer(function(sessionDescription) {
                        var answerData = JSON.stringify(sessionDescription);
                        console.log(&quot;answer:&quot; + answerData);
                        trace(&quot;answer:&quot; + answerData);
                        pc.setLocalDescription(sessionDescription);
                        sendToPeer(peer_id, answerData);
                    }, function(error) {
                        console.log(&apos;Failure callback: &apos; + error);
                        trace(&apos;Failure callback: &apos; + error);
                    });
                } else {
                    //It is a candidate
                    var candidate = new RTCIceCandidate({
                        sdpMLineIndex: dataJson.sdpMLineIndex,
                        candidate: dataJson.candidate
                    });
                    pc.addIceCandidate(candidate);
                }
            }

            function GetIntHeader(r, name) {
                var val = r.getResponseHeader(name);
                return val != null &amp;&amp; val.length ? parseInt(val) : -1;
            }
            //ç­‰å¾…æœåŠ¡å™¨è¿”å›ï¼Œå½“å‡ºç°ä»¥ä¸‹æƒ…å†µæˆ–è¶…æ—¶æ‰ä¼šè¿”å› 
            //1.å…¶ä»–peerè¿æ¥ä¸Šserverä¼šè¿”å›peerçš„æ•°æ®{peerName,peerID,xx};ç”¨äºæœ¬åœ°æ·»åŠ 
            //æœ¬åœ°å“åº”handleServerNotification
            //2.å…¶ä»–peerç‚¹å‡»my_name(å³å‘é€ å‘é€-æ¥æ”¶è§†é¢‘ è¯·æ±‚)ï¼Œè¿”å› ä¸€ä¸ªiceçš„å€™é€‰æˆ–è€…offer
            //    {
            // &quot;candidate&quot; : &quot;candidate:1918330882 1 udp 2122260223 192.168.253.1 55710 typ host generation 0 ufrag YUtt network-id 4 network-cost 50&quot;,
            // &quot;sdpMLineIndex&quot; : 0,
            // &quot;sdpMid&quot; : &quot;audio&quot;
            //} this is ice
            //æœ¬åœ°å“åº”handlePeerMessage
            function hangingGetCallback() {
                try {
                    if(hangingGet.readyState != 4)
                        return; //why?
                    if(hangingGet.status != 200) {
                        console.log(&quot;server error: &quot; + hangingGet.statusText);
                        trace(&quot;server error: &quot; + hangingGet.statusText);
                        disconnect();
                    } else {
                        var peer_id = GetIntHeader(hangingGet, &quot;Pragma&quot;);

                        if(peer_id == my_id) {
                            console.log(&quot;handleServerNotification:&quot; + hangingGet.responseText);
                            trace(&quot;handleServerNotification:&quot; + hangingGet.responseText);
                            handleServerNotification(hangingGet.responseText);
                        } else {
                            console.log(&quot;handlePeerMessage:&quot; + hangingGet.responseText);
                            trace(&quot;handlePeerMessage:&quot; + hangingGet.responseText);
                            handlePeerMessage(peer_id, hangingGet.responseText);
                        }
                    }

                    if(hangingGet) {
                        hangingGet.abort();
                        hangingGet = null;
                    }

                    if(my_id != -1)
                        window.setTimeout(startHangingGet, 0);
                } catch(e) {
                    console.log(&quot;Hanging get error: &quot; + e.description);
                    trace(&quot;Hanging get error: &quot; + e.description);
                }
            }
            //ç»§ç»­æŠŠmy_idå‘ç»™server å½“å…¶ä»–peerè¿æ¥æœåŠ¡å™¨çš„æ—¶å€™å…¶ä»–peerå°±å¯ä»¥è·å–my_id
            function startHangingGet() {
                try {
                    hangingGet = new XMLHttpRequest();
                    hangingGet.onreadystatechange = hangingGetCallback;
                    hangingGet.ontimeout = onHangingGetTimeout;
                    hangingGet.open(&quot;GET&quot;, server + &quot;/wait?peer_id=&quot; + my_id, true);
                    hangingGet.send();
                } catch(e) {
                    console.log(&quot;error&quot; + e.description);
                    trace(&quot;error&quot; + e.description);
                }
            }
            //å¦‚æœè¶…æ—¶åˆ™ç»§ç»­å‘é€startHangingGetè¯·æ±‚
            function onHangingGetTimeout() {
                console.log(&quot;hanging get timeout. issuing again.&quot;);
                trace(&quot;hanging get timeout. issuing again.&quot;);
                hangingGet.abort();
                hangingGet = null;
                if(my_id != -1)
                    window.setTimeout(startHangingGet, 0);
            }
            //serverè¿”å›my_id(æœåŠ¡å™¨å·²é€’å¢çš„æ–¹å¼ç”Ÿæˆid)å’Œè¿œç«¯peerçš„id
            //é‚£å¦‚æœbrowserå…ˆè¿æ¥ï¼Œæ²¡æœ‰å…¶ä»–peerï¼Œè¯¥æ–¹æ³•è¿”å›æ—¶æ²¡æœ‰è¿œç«¯peerçš„id åé¢æ˜¯å“ªé‡Œè·å–çš„å‘¢ï¼Ÿ
            //æ‰€ä»¥å®ƒåˆåšäº†ä¸€ä¸ªstartHangingGet();
            //é€šè¿‡handleServerNotification å¾—åˆ°,log:Server notification: zhengjx@X-CDN-zhengjx,2,1
            function signInCallback() {
                try {
                    console.log(&quot;request.readyState:&quot; + request.readyState);
                    trace(&quot;request.readyState:&quot; + request.readyState);
                    if(request.readyState == 4) {
                        if(request.status == 200) {
                            var peers = request.responseText.split(&quot;\n&quot;);
                            my_id = parseInt(peers[0].split(&apos;,&apos;)[1]);
                            console.log(&quot;My id: &quot; + my_id); //My id 1
                            trace(&quot;My id: &quot; + my_id); //My id 1
                            //Peer 1: zhengjx@X-CDN-zhengjx,2,parsed[2]æ²¡ç”¨åˆ° 
                            for(var i = 1; i &lt; peers.length; ++i) {
                                if(peers[i].length &gt; 0) {
                                    console.log(&quot;Peer &quot; + i + &quot;: &quot; + peers[i]);
                                    trace(&quot;Peer &quot; + i + &quot;: &quot; + peers[i]);
                                    var parsed = peers[i].split(&apos;,&apos;);
                                    other_peers[parseInt(parsed[1])] = parsed[0];
                                }
                            }
                            startHangingGet();
                            request = null;
                        }
                    }
                } catch(e) {
                    console.log(&quot;error: &quot; + e.description);
                    trace(&quot;error: &quot; + e.description);
                }
            }
            //æ³¨å†Œï¼ŒæŠŠè‡ªå·±çš„localNameå‘ç»™server
            function signIn() {
                try {
                    request = new XMLHttpRequest();
                    request.onreadystatechange = signInCallback;
                    request.open(&quot;GET&quot;, server + &quot;/sign_in?&quot; + localName, true);
                    request.send();
                } catch(e) {
                    console.log(&quot;error: &quot; + e.description);
                    trace(&quot;error: &quot; + e.description);
                }
            }

            function connect() {
                localName = document.getElementById(&quot;local&quot;).value.toLowerCase();
                server = document.getElementById(&quot;server&quot;).value.toLowerCase();
                if(localName.length == 0) {
                    alert(&quot;I need a name please.&quot;);
                    document.getElementById(&quot;local&quot;).focus();
                } else {
                    document.getElementById(&quot;connect&quot;).disabled = true;
                    document.getElementById(&quot;disconnect&quot;).disabled = false;
                    //document.getElementById(&quot;send&quot;).disabled = false;
                    signIn();
                }
            }

            function disconnect() {
                if(request) {
                    request.abort();
                    request = null;
                }

                if(hangingGet) {
                    hangingGet.abort();
                    hangingGet = null;
                }

                if(my_id != -1) {
                    request = new XMLHttpRequest();
                    request.open(&quot;GET&quot;, server + &quot;/sign_out?peer_id=&quot; + my_id, false);
                    request.send();
                    request = null;
                    my_id = -1;
                }

                document.getElementById(&quot;connect&quot;).disabled = false;
                document.getElementById(&quot;disconnect&quot;).disabled = true;
                //document.getElementById(&quot;send&quot;).disabled = true;
            }
        &lt;/script&gt;
    &lt;/head&gt;

    &lt;body&gt;
        Local: &lt;br&gt;
        &lt;video id=&quot;localVideo&quot; autoplay&gt;&lt;/video&gt;&lt;br&gt; Remote: &lt;br&gt;
        &lt;video id=&quot;remoteVideo&quot; autoplay style=&quot;width:400px;height:300px;&quot;&gt;&lt;/video&gt;

        Server: &lt;input type=&quot;text&quot; id=&quot;server&quot; value=&quot;http://172.27.35.1:8888&quot; /&gt;&lt;br&gt; Your name: &lt;input type=&quot;text&quot; id=&quot;local&quot; value=&quot;my_name&quot; /&gt;
        &lt;button id=&quot;connect&quot; onclick=&quot;connect();&quot;&gt;Connect&lt;/button&gt;
        &lt;button disabled=&quot;true&quot; id=&quot;disconnect&quot; onclick=&quot;disconnect();&quot;&gt;Disconnect&lt;/button&gt;
        &lt;pre id=&quot;debug&quot;&gt;
        &lt;/pre&gt;
    &lt;/body&gt;

&lt;/html&gt;</code></pre><p>å°†WebrtcTESTé¡¹ç›®æ”¾å…¥HTTPæœåŠ¡å™¨<br>è®¿é—® <a href="http://localhost/WebrtcTEST/test.html" target="_blank" rel="noopener">http://localhost/WebrtcTEST/test.html</a></p>
<h1 id="æœåŠ¡å™¨ç«¯"><a href="#æœåŠ¡å™¨ç«¯" class="headerlink" title="æœåŠ¡å™¨ç«¯"></a>æœåŠ¡å™¨ç«¯</h1><p>ä¸‹è½½ç™¾åº¦äº‘çš„é‚£ä¸ªrarå¹¶è§£å‹å¾—åˆ°<br><code>peerconnection_client.exe</code> å’Œ <code>peerconnection_server.exe</code><br><code>peerconnection_client.exe</code>çš„ç½‘ç»œè¿è¡Œç¯å¢ƒä»»æ„ï¼Œå¯å±€åŸŸç½‘å¯å…¬ç½‘ã€‚<br>ä½†<code>peerconnection_server.exe</code>ç½‘ç»œè¿è¡Œç¯å¢ƒå¿…é¡»ä¿è¯èƒ½è®©<code>peerconnection_client</code>å’Œ<code>Webç«¯localhost</code>æ‰€åœ¨ç½‘ç»œè¿è¡Œç¯å¢ƒè®¿é—®åˆ°ã€‚<br>ä¹Ÿå°±æ˜¯è¯´ï¼Œ<strong>è¦ä¹ˆ<code>peerconnection_server</code>å¤„äºå…¬ç½‘ï¼Œè¦ä¹ˆä¸‰è€…å‡å¤„äºå±€åŸŸç½‘ã€‚</strong></p>
<blockquote>
<p>PS:æµ‹è¯•æ—¶ä¸ºäº†æ–¹ä¾¿é€‰æ‹©å±€åŸŸç½‘ï¼Œå¹¶è®©peerconnection_clientå’Œpeerconnection_serverå¤„äºåŒä¸€å°PC</p>
</blockquote>
<h2 id="æµ‹è¯•æµç¨‹å¦‚ä¸‹ï¼š"><a href="#æµ‹è¯•æµç¨‹å¦‚ä¸‹ï¼š" class="headerlink" title="æµ‹è¯•æµç¨‹å¦‚ä¸‹ï¼š"></a>æµ‹è¯•æµç¨‹å¦‚ä¸‹ï¼š</h2><ol>
<li>æœåŠ¡å™¨ç«¯è¿è¡Œ<code>peerconnection_server</code></li>
<li>æœåŠ¡å™¨ç«¯è¿è¡Œ<code>peerconnection_client</code>ï¼Œå¹¶ç›´æ¥ç‚¹å‡»<code>connect</code></li>
<li>å¦ä¸€Clientçš„Webç«¯è®¾ç½®<code>Server IP</code>åœ°å€å’Œ<code>Your name</code>ã€nameéšæ„ã€‘,ç‚¹å‡»<code>connect</code></li>
<li>æœåŠ¡å™¨ç«¯peerconnection_clientæ˜¾ç¤ºWebç«¯è¿æ¥ä¸Šäº†ï¼Œåˆ—è¡¨ä¸Šå‡ºç°nameï¼Œå¯¹å…¶è¿›è¡Œç‚¹å‡»;</li>
<li>ç°åœ¨å°±å¯ä»¥åœ¨Webç«¯çœ‹åˆ°æœåŠ¡å™¨ç«¯æ‘„åƒå¤´çš„ç”»é¢äº†ï¼Œå»¶è¿Ÿå°äº200ms.</li>
<li>å¦‚æœæƒ³è®©æœåŠ¡å™¨ç«¯çœ‹åˆ°Webç«¯ç”¨æˆ·æ‘„åƒå¤´ç”»é¢ï¼Œå°†test.htmlçš„ç¬¬132è¡Œæ³¨é‡Šå»æ‰</li>
</ol>
<pre><code>//setLocalStream(connectionId);//è§£é™¤æ³¨é‡Šå°†å¯ä»¥åŒç«¯é€šä¿¡ ä¸è¿‡å»¶è¿Ÿå°±é«˜äº†</code></pre><h1 id="JSå…·ä½“æµç¨‹åˆ†æ"><a href="#JSå…·ä½“æµç¨‹åˆ†æ" class="headerlink" title="JSå…·ä½“æµç¨‹åˆ†æ"></a>JSå…·ä½“æµç¨‹åˆ†æ</h1><h2 id="ä»function-connect-å¼€å§‹åˆ†æ"><a href="#ä»function-connect-å¼€å§‹åˆ†æ" class="headerlink" title="ä»function connect() å¼€å§‹åˆ†æ"></a>ä»<code>function connect()</code> å¼€å§‹åˆ†æ</h2><h2 id="è°ƒç”¨signIn-å‡½æ•°"><a href="#è°ƒç”¨signIn-å‡½æ•°" class="headerlink" title="è°ƒç”¨signIn()å‡½æ•°"></a>è°ƒç”¨signIn()å‡½æ•°</h2><p>å°†è‡ªå·±çš„localNameã€å¡«å†™çš„Your nameã€‘å‘ç»™server,å“åº”ç»“æŸå°†è°ƒç”¨signInCallback</p>
<h2 id="åˆ†æsignInCallback"><a href="#åˆ†æsignInCallback" class="headerlink" title="åˆ†æsignInCallback()"></a>åˆ†æsignInCallback()</h2><p>serverè¿”å›my_id(æœåŠ¡å™¨å·²é€’å¢çš„æ–¹å¼ç”Ÿæˆid)å’Œè¿œç«¯peerçš„id<br><strong>é‚£å¦‚æœbrowserå…ˆè¿æ¥ï¼Œæ²¡æœ‰å…¶ä»–peerï¼Œè¯¥æ–¹æ³•è¿”å›æ—¶æ²¡æœ‰è¿œç«¯peerçš„id åé¢æ˜¯å“ªé‡Œè·å–çš„å‘¢ï¼Ÿ</strong><br>æ‰€ä»¥å®ƒåˆåšäº†ä¸€ä¸ªstartHangingGet();<br>è¿”å›çš„peeræ•°æ®æ ¼å¼ï¼špeer_name,peer_id,ç¬¬ä¸‰ä¸ªå‚æ•°æ²¡æœ‰ç”¨åˆ°æˆ‘ä¹Ÿä¸çŸ¥é“æ˜¯ä»€ä¹ˆã€‚</p>
<h2 id="æ‰§è¡ŒstartHangingGet"><a href="#æ‰§è¡ŒstartHangingGet" class="headerlink" title="æ‰§è¡ŒstartHangingGet();"></a>æ‰§è¡ŒstartHangingGet();</h2><p>ä¸ç®¡ä¸Šä¸€æ­¥æœ‰æ²¡æœ‰è·å–åˆ°peerè¯¥æ­¥éª¤éƒ½ä¼šè¿›è¡Œçš„ã€‚</p>
<h4 id="è¯¥æ­¥éª¤æ˜¯æŠŠmy-idå‘é€ç»™server"><a href="#è¯¥æ­¥éª¤æ˜¯æŠŠmy-idå‘é€ç»™server" class="headerlink" title="è¯¥æ­¥éª¤æ˜¯æŠŠmy_idå‘é€ç»™server."></a>è¯¥æ­¥éª¤æ˜¯æŠŠmy_idå‘é€ç»™server.</h4><p>å½“å…¶ä»–peerè¿›è¡Œæ“ä½œ<strong>[1.è¿æ¥æœåŠ¡å™¨çš„æ—¶å€™å…¶ä»–peerå°±å¯ä»¥è·å–my_id;2.å‘é€æ’­æµæŒ‡ä»¤]</strong>XHRè¯·æ±‚å°†æˆåŠŸå“åº”,å¹¶ä¸”è‡ªå·±å°†æ‰§è¡ŒhangingGetCallbackã€‚<br>å¦‚æœè¯·æ±‚è¶…æ—¶çš„è¯å°†å›è°ƒonHangingGetTimeoutï¼Œå…¶ç»“æœæ˜¯é‡æ–°æ‰§è¡ŒstartHangingGet</p>
<h2 id="æ‰§è¡ŒhangingGetCallback"><a href="#æ‰§è¡ŒhangingGetCallback" class="headerlink" title="æ‰§è¡ŒhangingGetCallback"></a>æ‰§è¡ŒhangingGetCallback</h2><p>æ­£å¦‚åˆšåˆšè¯´çš„ï¼Œæœ‰ä¸¤ç§æƒ…å†µï¼ŒæœåŠ¡å™¨å°†å“åº”è¿”å›</p>
<h3 id="1-å…¶ä»–peerè¿æ¥ä¸Šserverä¼šè¿”å›peerçš„æ•°æ®-peerName-peerID-xx-ç”¨äºæœ¬åœ°æ·»åŠ "><a href="#1-å…¶ä»–peerè¿æ¥ä¸Šserverä¼šè¿”å›peerçš„æ•°æ®-peerName-peerID-xx-ç”¨äºæœ¬åœ°æ·»åŠ " class="headerlink" title="1.å…¶ä»–peerè¿æ¥ä¸Šserverä¼šè¿”å›peerçš„æ•°æ®{peerName,peerID,xx};ç”¨äºæœ¬åœ°æ·»åŠ "></a>1.å…¶ä»–peerè¿æ¥ä¸Šserverä¼šè¿”å›peerçš„æ•°æ®{peerName,peerID,xx};ç”¨äºæœ¬åœ°æ·»åŠ </h3><p>æœ¬åœ°å“åº”<code>handleServerNotification</code><br>logæ‰“å°ï¼š</p>
<pre><code>handleServerNotification:zhengjx@X-CDN-zhengjx,4,1
Server notification: zhengjx@X-CDN-zhengjx,4,1</code></pre><h3 id="2-å…¶ä»–peerç‚¹å‡»my-name-å³å‘é€-æ’­æµ-è¯·æ±‚-ï¼Œè¿”å›-ä¸€ä¸ªiceçš„å€™é€‰æˆ–è€…offer"><a href="#2-å…¶ä»–peerç‚¹å‡»my-name-å³å‘é€-æ’­æµ-è¯·æ±‚-ï¼Œè¿”å›-ä¸€ä¸ªiceçš„å€™é€‰æˆ–è€…offer" class="headerlink" title="2.å…¶ä»–peerç‚¹å‡»my_name(å³å‘é€ æ’­æµ è¯·æ±‚)ï¼Œè¿”å› ä¸€ä¸ªiceçš„å€™é€‰æˆ–è€…offer"></a>2.å…¶ä»–peerç‚¹å‡»my_name(å³å‘é€ æ’­æµ è¯·æ±‚)ï¼Œè¿”å› ä¸€ä¸ªiceçš„å€™é€‰æˆ–è€…offer</h3><p>æœ¬åœ°å“åº”<code>handlePeerMessage</code></p>
<h2 id="è¿™é‡Œæˆ‘ä»¬ç›´æ¥åˆ†æpeerå‘é€æ’­æµè¯·æ±‚"><a href="#è¿™é‡Œæˆ‘ä»¬ç›´æ¥åˆ†æpeerå‘é€æ’­æµè¯·æ±‚" class="headerlink" title="è¿™é‡Œæˆ‘ä»¬ç›´æ¥åˆ†æpeerå‘é€æ’­æµè¯·æ±‚"></a>è¿™é‡Œæˆ‘ä»¬ç›´æ¥åˆ†æpeerå‘é€æ’­æµè¯·æ±‚</h2><h3 id="è¿œç«¯peerå…ˆå‘é€äº†ä¸€ä¸ªæºå¸¦éŸ³è§†é¢‘ä¿¡æ¯sdpçš„offer"><a href="#è¿œç«¯peerå…ˆå‘é€äº†ä¸€ä¸ªæºå¸¦éŸ³è§†é¢‘ä¿¡æ¯sdpçš„offer" class="headerlink" title="è¿œç«¯peerå…ˆå‘é€äº†ä¸€ä¸ªæºå¸¦éŸ³è§†é¢‘ä¿¡æ¯sdpçš„offer"></a>è¿œç«¯peerå…ˆå‘é€äº†ä¸€ä¸ªæºå¸¦éŸ³è§†é¢‘ä¿¡æ¯sdpçš„offer</h3><pre><code>handlePeerMessage:{
   &quot;sdp&quot; : &quot;v=0\r\no=- 1915807044938492152 2 IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\na=group:BUNDLE audio video\r\na=msid-semantic: WMS stream_label\r\nm=audio 9 UDP/TLS/RTP/SAVPF 111 103 104 9 102 0 8 106 105 13 127 126\r\nc=IN IP4 0.0.0.0\r\na=rtcp:9 IN IP4 0.0.0.0\r\na=ice-ufrag:s+rj\r\na=ice-pwd:JZspr0P/+RWnF3WFF7H2njf+\r\na=fingerprint:sha-256 DC:1B:45:26:86:B0:51:E1:2C:84:F6:04:83:1F:13:87:5F:54:9D:9F:4C:8D:04:33:E3:2F:69:BC:69:23:51:D5\r\na=setup:actpass\r\na=mid:audio\r\na=extmap:1 urn:ietf:params:rtp-hdrext:ssrc-audio-level\r\na=extmap:3 http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time\r\na=sendrecv\r\na=rtcp-mux\r\na=rtpmap:111 opus/48000/2\r\na=rtcp-fb:111 transport-cc\r\na=fmtp:111 minptime=10;useinbandfec=1\r\na=rtpmap:103 ISAC/16000\r\na=rtpmap:104 ISAC/32000\r\na=rtpmap:9 G722/8000\r\na=rtpmap:102 ILBC/8000\r\na=rtpmap:0 PCMU/8000\r\na=rtpmap:8 PCMA/8000\r\na=rtpmap:106 CN/32000\r\na=rtpmap:105 CN/16000\r\na=rtpmap:13 CN/8000\r\na=rtpmap:127 red/8000\r\na=rtpmap:126 telephone-event/8000\r\na=ssrc:1946889360 cname:oeS68Tdb4Ls6Qz2u\r\na=ssrc:1946889360 msid:stream_label audio_label\r\na=ssrc:1946889360 mslabel:stream_label\r\na=ssrc:1946889360 label:audio_label\r\nm=video 9 UDP/TLS/RTP/SAVPF 100 101 116 117 96 97 98\r\nc=IN IP4 0.0.0.0\r\na=rtcp:9 IN IP4 0.0.0.0\r\na=ice-ufrag:s+rj\r\na=ice-pwd:JZspr0P/+RWnF3WFF7H2njf+\r\na=fingerprint:sha-256 DC:1B:45:26:86:B0:51:E1:2C:84:F6:04:83:1F:13:87:5F:54:9D:9F:4C:8D:04:33:E3:2F:69:BC:69:23:51:D5\r\na=setup:actpass\r\na=mid:video\r\na=extmap:2 urn:ietf:params:rtp-hdrext:toffset\r\na=extmap:3 http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time\r\na=extmap:4 urn:3gpp:video-orientation\r\na=sendrecv\r\na=rtcp-mux\r\na=rtcp-rsize\r\na=rtpmap:100 VP8/90000\r\na=rtcp-fb:100 ccm fir\r\na=rtcp-fb:100 nack\r\na=rtcp-fb:100 nack pli\r\na=rtcp-fb:100 goog-remb\r\na=rtcp-fb:100 transport-cc\r\na=rtpmap:101 VP9/90000\r\na=rtcp-fb:101 ccm fir\r\na=rtcp-fb:101 nack\r\na=rtcp-fb:101 nack pli\r\na=rtcp-fb:101 goog-remb\r\na=rtcp-fb:101 transport-cc\r\na=rtpmap:116 red/90000\r\na=rtpmap:117 ulpfec/90000\r\na=rtpmap:96 rtx/90000\r\na=fmtp:96 apt=100\r\na=rtpmap:97 rtx/90000\r\na=fmtp:97 apt=101\r\na=rtpmap:98 rtx/90000\r\na=fmtp:98 apt=116\r\na=ssrc-group:FID 1010645505 1298682012\r\na=ssrc:1010645505 cname:oeS68Tdb4Ls6Qz2u\r\na=ssrc:1010645505 msid:stream_label video_label\r\na=ssrc:1010645505 mslabel:stream_label\r\na=ssrc:1010645505 label:video_label\r\na=ssrc:1298682012 cname:oeS68Tdb4Ls6Qz2u\r\na=ssrc:1298682012 msid:stream_label video_label\r\na=ssrc:1298682012 mslabel:stream_label\r\na=ssrc:1298682012 label:video_label\r\n&quot;,
   &quot;type&quot; : &quot;offer&quot;
}</code></pre><h3 id="createPeerConnectionï¼Œè®¾å®šå¯¹æ–¹çš„sdpä¸ºä¼ é€’è¿‡æ¥çš„æè¿°"><a href="#createPeerConnectionï¼Œè®¾å®šå¯¹æ–¹çš„sdpä¸ºä¼ é€’è¿‡æ¥çš„æè¿°" class="headerlink" title="createPeerConnectionï¼Œè®¾å®šå¯¹æ–¹çš„sdpä¸ºä¼ é€’è¿‡æ¥çš„æè¿°"></a>createPeerConnectionï¼Œè®¾å®šå¯¹æ–¹çš„sdpä¸ºä¼ é€’è¿‡æ¥çš„æè¿°</h3><p>æ‰§è¡Œ</p>
<pre><code>createPeerConnection(peer_id);
pc.setRemoteDescription(new RTCSessionDescription(dataJson));                                    pc.createAnswer(function(sessionDescription)  {
        var answerData = JSON.stringify(sessionDescription);
        console.log(&quot;answer:&quot; + answerData);
        trace(&quot;answer:&quot; + answerData);
        pc.setLocalDescription(sessionDescription);
        sendToPeer(peer_id, answerData);
                    }, function(error) {
                        console.log(&apos;Failure callback: &apos; + error);
                        trace(&apos;Failure callback: &apos; + error);
                    });</code></pre><p>åˆ›å»ºPeerConnectionå®ä¾‹ (å‚æ•°ä¸ºnullåˆ™æ²¡æœ‰iceserverï¼Œå³ä½¿æ²¡æœ‰stunserverå’Œturnserverï¼Œä»å¯åœ¨å±€åŸŸç½‘ä¸‹é€šè®¯)<br>è¿™é‡Œæˆ‘ä»¬è®¾ç½®äº†<code>onicecandidate</code>ï¼š</p>
<pre><code>{&quot;iceServers&quot;:[{&quot;url&quot;:&quot;stun:stun.l.google.com:19302&quot;}]}</code></pre><p>é€šè¿‡æ‰§è¡ŒsendToPeerå‡½æ•°å‘é€ICEå€™é€‰åˆ°å…¶ä»–å®¢æˆ·ç«¯ï¼Œè¯¥è¿‡ç¨‹ä¼šæ…¢äºRTCPeerConnection.onaddstreamã€‚</p>
<p>å½“ä¸Šé¢åšçš„pc.setRemoteDescriptionæˆåŠŸæ‰§è¡Œæ—¶ï¼Œpc.onaddstreamå°†è°ƒç”¨ã€‚<br>å®˜ç½‘åŸè¯:</p>
<pre><code>RTCPeerConnection.onaddstreamï¼š
The event is sent immediately after the call RTCPeerConnection.setRemoteDescription() </code></pre><p>å›å¤çš„answer sdp å¦‚ä¸‹ï¼š</p>
<pre><code>answer:{&quot;type&quot;:&quot;answer&quot;,&quot;sdp&quot;:&quot;v=0\r\no=- 681837714082552550 2 IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\na=group:BUNDLE audio video\r\na=msid-semantic: WMS\r\nm=audio 9 UDP/TLS/RTP/SAVPF 111 103 104 9 0 8 106 105 13 126\r\nc=IN IP4 0.0.0.0\r\na=rtcp:9 IN IP4 0.0.0.0\r\na=ice-ufrag:XNSrC9DEJco2wMEV\r\na=ice-pwd:PhP5CUsS6P8wxnCZZa5aZ5nD\r\na=fingerprint:sha-256 F8:93:41:5C:50:E9:EF:11:66:0F:2F:64:F7:CE:C4:BB:C5:57:D8:3C:C3:04:19:27:33:B7:93:DE:58:9F:DF:74\r\na=setup:active\r\na=mid:audio\r\na=extmap:1 urn:ietf:params:rtp-hdrext:ssrc-audio-level\r\na=extmap:3 http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time\r\na=recvonly\r\na=rtcp-mux\r\na=rtpmap:111 opus/48000/2\r\na=rtcp-fb:111 transport-cc\r\na=fmtp:111 minptime=10;useinbandfec=1\r\na=rtpmap:103 ISAC/16000\r\na=rtpmap:104 ISAC/32000\r\na=rtpmap:9 G722/8000\r\na=rtpmap:0 PCMU/8000\r\na=rtpmap:8 PCMA/8000\r\na=rtpmap:106 CN/32000\r\na=rtpmap:105 CN/16000\r\na=rtpmap:13 CN/8000\r\na=rtpmap:126 telephone-event/8000\r\na=maxptime:60\r\nm=video 9 UDP/TLS/RTP/SAVPF 100 101 116 117 96 97 98\r\nc=IN IP4 0.0.0.0\r\na=rtcp:9 IN IP4 0.0.0.0\r\na=ice-ufrag:XNSrC9DEJco2wMEV\r\na=ice-pwd:PhP5CUsS6P8wxnCZZa5aZ5nD\r\na=fingerprint:sha-256 F8:93:41:5C:50:E9:EF:11:66:0F:2F:64:F7:CE:C4:BB:C5:57:D8:3C:C3:04:19:27:33:B7:93:DE:58:9F:DF:74\r\na=setup:active\r\na=mid:video\r\na=extmap:2 urn:ietf:params:rtp-hdrext:toffset\r\na=extmap:3 http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time\r\na=extmap:4 urn:3gpp:video-orientation\r\na=recvonly\r\na=rtcp-mux\r\na=rtcp-rsize\r\na=rtpmap:100 VP8/90000\r\na=rtcp-fb:100 ccm fir\r\na=rtcp-fb:100 nack\r\na=rtcp-fb:100 nack pli\r\na=rtcp-fb:100 goog-remb\r\na=rtcp-fb:100 transport-cc\r\na=rtpmap:101 VP9/90000\r\na=rtcp-fb:101 ccm fir\r\na=rtcp-fb:101 nack\r\na=rtcp-fb:101 nack pli\r\na=rtcp-fb:101 goog-remb\r\na=rtcp-fb:101 transport-cc\r\na=rtpmap:116 red/90000\r\na=rtpmap:117 ulpfec/90000\r\na=rtpmap:96 rtx/90000\r\na=fmtp:96 apt=100\r\na=rtpmap:97 rtx/90000\r\na=fmtp:97 apt=101\r\na=rtpmap:98 rtx/90000\r\na=fmtp:98 apt=116\r\n&quot;}</code></pre><h3 id="æ¥ä¸‹æ¥çš„è¿‡ç¨‹"><a href="#æ¥ä¸‹æ¥çš„è¿‡ç¨‹" class="headerlink" title="æ¥ä¸‹æ¥çš„è¿‡ç¨‹"></a>æ¥ä¸‹æ¥çš„è¿‡ç¨‹</h3><p>ä¸Šä¸€æ­¥æåˆ°çš„ï¼Œæœ¬åœ°å‘é€ICEå€™é€‰åˆ°å…¶ä»–å®¢æˆ·ç«¯</p>
<pre><code>&quot; Send &quot; &quot;{&quot;sdpMLineIndex&quot;:0,&quot;sdpMid&quot;:&quot;audio&quot;,&quot;candidate&quot;:&quot;candidate:3604340130 1 udp 2122260223 192.168.216.1 50938 typ host generation 0 ufrag XNSrC9DEJco2wMEV network-id 4&quot;}&quot;</code></pre><p>è¯¥è¿‡ç¨‹ä¼šæ‰§è¡Œå¤šæ¬¡ï¼Œæ¯æ¬¡æºå¸¦çš„candidateéƒ½ä¸ä¸€è‡´ï¼Œç›´åˆ°æ‰“å°<code>console.log(&quot;End of candidates.&quot;);</code><br>ä¸æ­¤åŒæ—¶ï¼Œæœ¬åœ°é€šè¿‡handlePeerMessageè·å–åˆ°ICEçš„å€™é€‰ï¼Œå¹¶å°†å…¶åŠ å…¥åˆ°PeerConnectionä¸­ã€‚<br>è¿™æ ·ä¸¤ç«¯å°±éƒ½æœ‰å„è‡ªçš„ICEå€™é€‰äº†ï¼Œé‚£ä¹ˆå°±å¯ä»¥è¿›è¡Œé€šä¿¡ã€‚</p>
<p>pc.onaddstreamåœ¨å‰ä¸€æ­¥è°ƒç”¨ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥peerå°±åº”è¯¥å¼€å§‹ä¼ æµã€‚<br>æœ¬åœ°é€šè¿‡handlePeerMessageè·å–çš„éŸ³è§†é¢‘æ•°æ®éƒ¨åˆ†å¦‚ä¸‹</p>
<pre><code>handlePeerMessage:{
   &quot;candidate&quot; : &quot;candidate:2013099291 2 udp 2122194686 10.8.146.177 54148 typ host generation 0 ufrag s+rj network-id 3 network-cost 50&quot;,
   &quot;sdpMLineIndex&quot; : 0,
   &quot;sdpMid&quot; : &quot;audio&quot;
}

VM122 phone_frame.html:450 handlePeerMessage:{
   &quot;candidate&quot; : &quot;candidate:2719042630 1 udp 2122260223 172.27.35.1 54149 typ host generation 0 ufrag s+rj network-id 4 network-cost 50&quot;,
   &quot;sdpMLineIndex&quot; : 1,
   &quot;sdpMid&quot; : &quot;video&quot;
}</code></pre><p><strong>[æ³¨æ„ä¹‹é—´å»ºç«‹äº†çš„candidateä¼šåœ¨ä¼ è¾“æ—¶ç”¨åˆ°ï¼Œæ‰€ä»¥å¯ä»¥ç†è§£candidateæ˜¯ä¸€ç§ç®¡é“ï¼Œæˆ‘ä»¬åˆ›å»ºäº†å¤šä¸ªcandidateå°±æ˜¯å¤šä¸ªç®¡é“ï¼Œè§†éŸ³é¢‘æ•°æ®å°±æ˜¯é€šè¿‡è¿™äº›ç®¡é“æ¥ä¼ è¾“]</strong><br>å½“ç„¶ï¼Œå†å…·ä½“çš„åŸç†å°±ä¸æ¢è®¨äº†ï¼Œæ¶‰åŠç©¿é€ç­‰é«˜æ·±çš„çŸ¥è¯†= =ã€‚</p>
<p>ç”±äºç ”ç©¶æœªæ·±ï¼Œå¦‚æœ‰é”™è¯¯ï¼Œçƒ¦è¯·æŒ‡æ­£ï¼Œè°¢è°¢ã€‚</p>
]]></content>
      <categories>
        <category>æµåª’ä½“</category>
      </categories>
      <tags>
        <tag>WebRTC</tag>
        <tag>ffmpeg</tag>
      </tags>
  </entry>
  <entry>
    <title>WebSocket ä¸ WebRTC ç›´æ’­æ–¹æ¡ˆå¯¹æ¯”åˆ†æ</title>
    <url>/2016/08/24/2016-2017%E7%9B%B4%E6%92%AD%E7%9B%B8%E5%85%B3/WebSocket%E4%B8%8EWebRTC%E6%96%B9%E6%A1%88%E5%88%86%E6%9E%90/</url>
    <content><![CDATA[<h1 id="WebSocket"><a href="#WebSocket" class="headerlink" title="WebSocket"></a>WebSocket</h1><h2 id="åŒæ­¥"><a href="#åŒæ­¥" class="headerlink" title="åŒæ­¥"></a>åŒæ­¥</h2><p>é¦–å…ˆè¯´åŒæ­¥ç­–ç•¥</p>
<a id="more"></a>

<h3 id="é‡‡ç”¨RTMPåè®®"><a href="#é‡‡ç”¨RTMPåè®®" class="headerlink" title="é‡‡ç”¨RTMPåè®®"></a>é‡‡ç”¨RTMPåè®®</h3><p>éœ€è¦äº†è§£RTMPçš„åè®®ï¼Œå°†éŸ³è§†é¢‘æµ(H264/SPEEX)æ„é€ æˆRTMPåŒ…ï¼Œé€šè¿‡WebSocketå‘é€åˆ°å®¢æˆ·ç«¯<br>è¿™æ ·çš„è¯ï¼Œå¼€å‘æˆæœ¬å¤§ï¼Œéœ€è¦æ­å»ºä¸€å°ç”¨äºå‘é€RTMPåŒ…çš„WebSocketæœåŠ¡å™¨è€Œä¸æ˜¯æ™®é€šçš„RTMPæœåŠ¡å™¨<br>è¿™ä¸œè¥¿ç½‘ä¸ŠåŸºæœ¬æ²¡äººåšï¼Œæœåˆ°äº†ä¸€ä¸ªåˆ«äººåšçš„demoï¼Œä½†æ˜¯æ²¡æœ‰æ–‡æ¡£ï¼Œå®åœ¨éš¾ä»¥ç ”ç©¶,ä¸”ä¸çŸ¥æ€§èƒ½å¦‚ä½•</p>
<p>å‚è€ƒï¼š<a href="http://my.oschina.net/langhuihui/blog" target="_blank" rel="noopener">http://my.oschina.net/langhuihui/blog</a></p>
<h3 id="å¼€ä¸¤ä¸ªWebSocket"><a href="#å¼€ä¸¤ä¸ªWebSocket" class="headerlink" title="å¼€ä¸¤ä¸ªWebSocket"></a>å¼€ä¸¤ä¸ªWebSocket</h3><p>æˆ‘è‡ªå·±å†™çš„ï¼Œä»æœåŠ¡å™¨ç«¯åŒæ—¶å‘é€éŸ³è§†é¢‘æµï¼Œç”±äºéŸ³é¢‘æ–¹é¢æˆ‘æ²¡åšç¼–è§£ç ç›´æ¥æ¨çš„PCMå¯èƒ½æ•°æ®é‡è¾ƒå¤§ï¼Œ<br>è§†é¢‘çš„è¯é‡‡ç”¨jsmpegè§£ç ç„¶åé€šè¿‡canvasç»˜åˆ¶</p>
<p>è¿™æ ·çš„è¯æ²¡æœ‰åšåŒæ­¥ã€‚</p>
<p>å¯ä»¥å‚è€ƒæˆ‘ä¸Šæ¬¡å‘çš„fiiseræŠ€æœ¯ç ”ç©¶ï¼š</p>
<p>åŒæ­¥ï¼šæ¯5så‘é€ä¸€ä¸ªåŒæ­¥æŒ‡ä»¤ç»™å®¢æˆ·ç«¯è¿›è¡ŒåŒæ­¥(å…·ä½“ç»†èŠ‚æˆ‘å°±ä¸æ‡‚äº†)</p>
<p>ç¼–è§£ç :BroadwayJS+SpeexJS å¤§æ¦‚åšæ³•å’Œæˆ‘å·®ä¸å¤š å°±æ˜¯ç¼–è§£ç çš„æ•ˆç‡é—®é¢˜äº†</p>
<h2 id="è§£ç -è½¯è§£ç "><a href="#è§£ç -è½¯è§£ç " class="headerlink" title="è§£ç -è½¯è§£ç "></a>è§£ç -è½¯è§£ç </h2><p>å¦‚æœæ˜¯é‡‡ç”¨RTMPåŒæ­¥ï¼Œå®¢æˆ·ç«¯è¿˜è¦å»å†™JSè§£åè®®åŒ…(è¿™æ–¹é¢ä¸æ‡‚ï¼Œèµ„æ–™ä¹Ÿæ¯”è¾ƒå°‘)</p>
<p>ç„¶åä¸€èˆ¬éƒ½æ˜¯åˆ©ç”¨BroadwayJS+SpeexJSæ¥è§£ç ï¼Œè¿™ä¸¤ä¸ªæ˜¯åˆ©ç”¨EmscriptenæŠŠåŸç”Ÿä»£ç ç¼–è¯‘æˆJSï¼Œæ¯”æ™®é€šJSæ•ˆç‡é«˜</p>
<h2 id="æ¸²æŸ“"><a href="#æ¸²æŸ“" class="headerlink" title="æ¸²æŸ“"></a>æ¸²æŸ“</h2><p>Canvas+AudioContext </p>
<h2 id="æ”¯æŒæƒ…å†µ"><a href="#æ”¯æŒæƒ…å†µ" class="headerlink" title="æ”¯æŒæƒ…å†µ"></a>æ”¯æŒæƒ…å†µ</h2><p>é™¤IEå¤–ï¼Œå…¶ä»–å¤§éƒ¨åˆ†PC/Mobileæµè§ˆå™¨(æœ‰çš„å¯èƒ½éœ€è¦è¾ƒæ–°ç‰ˆæœ¬)éƒ½æ”¯æŒä¸Šè¿°æŠ€æœ¯</p>
<h2 id="å»¶è¿ŸåŠå¡é¡¿æƒ…å†µ"><a href="#å»¶è¿ŸåŠå¡é¡¿æƒ…å†µ" class="headerlink" title="å»¶è¿ŸåŠå¡é¡¿æƒ…å†µ"></a>å»¶è¿ŸåŠå¡é¡¿æƒ…å†µ</h2><p>å±€åŸŸç½‘å†…ï¼Œæˆ‘çš„æ–¹æ¡ˆåŸºæœ¬æ²¡æœ‰å»¶è¿Ÿ(200msä»¥å†…)å’Œå¡é¡¿</p>
<h2 id="å¼€å‘æˆæœ¬"><a href="#å¼€å‘æˆæœ¬" class="headerlink" title="å¼€å‘æˆæœ¬"></a>å¼€å‘æˆæœ¬</h2><p>é¦–å…ˆåŒæ­¥æœ¬èº«ä¸å¥½åšï¼Œè¿˜æœ‰ç¼–è§£ç è¿™å—ï¼Œéœ€è¦ç¼–è¯‘ä¸Šè¿°ä¸¤ä¸ªè§£ç åº“ç„¶åæ‰¾ä¸‹æ–‡æ¡£çœ‹æ€ä¹ˆç”¨ï¼Œç„¶åæœåŠ¡ç«¯è¿˜å¾—æ„é€ ç›¸åº”ç¼–ç çš„æµæ¥æµ‹è¯•ã€‚</p>
<p>æƒ³åšå¥½ä¸€å¥—è§£å†³æ–¹æ¡ˆä¸€ä¸ªäººåŸºæœ¬æä¸å®š</p>
<h1 id="WebRTC"><a href="#WebRTC" class="headerlink" title="WebRTC"></a>WebRTC</h1><h2 id="åŒæ­¥åŠæ¸²æŸ“"><a href="#åŒæ­¥åŠæ¸²æŸ“" class="headerlink" title="åŒæ­¥åŠæ¸²æŸ“"></a>åŒæ­¥åŠæ¸²æŸ“</h2><p>æµè§ˆå™¨ç«¯å·²ç»åšå¥½åŒæ­¥ç­–ç•¥ï¼Œç»‘å®š<code>&lt;video&gt;</code>æ ‡ç­¾è¿›è¡Œæ¸²æŸ“</p>
<h2 id="è§£ç -ç¡¬è§£ç "><a href="#è§£ç -ç¡¬è§£ç " class="headerlink" title="è§£ç -ç¡¬è§£ç "></a>è§£ç -ç¡¬è§£ç </h2><h2 id="æ”¯æŒæƒ…å†µ-1"><a href="#æ”¯æŒæƒ…å†µ-1" class="headerlink" title="æ”¯æŒæƒ…å†µ"></a>æ”¯æŒæƒ…å†µ</h2><ul>
<li>PC:Chrome29å’Œç«ç‹47ä»¥ä¸Šæ”¯æŒï¼ŒOpera 39ä»¥ä¸Šæ”¯æŒï¼ŒIEå†…æ ¸çš„æµè§ˆå™¨ã€Edgeã€Safariä¸æ”¯æŒ</li>
<li>Mobileï¼šChrome for Android ï¼Œfirefox for Androidæ”¯æŒ<br>Android WebView(5.0ä»¥ä¸Šæ”¯æŒï¼Œ4.4éƒ¨åˆ†æ‰‹æœº(samsung htcç­‰)æ”¯æŒ)ï¼Œæ‰‹æœºè‡ªå¸¦æµè§ˆå™¨(4.4ä»¥ä¸Šéƒ¨åˆ†å‚å•†æ”¯æŒ)<br>QQ/UC/ç™¾åº¦æµè§ˆå™¨ æ­£åœ¨æµ‹è¯•ï¼Œ<br>WPæ‰‹æœºä¸æ”¯æŒ(å¯ä»¥è€ƒè™‘åé¢å…¼å®¹ORTC)</li>
</ul>
<p>å‚è€ƒ <a href="http://www.tutorialspoint.com/webrtc/webrtc_mobile_support.htm" target="_blank" rel="noopener">http://www.tutorialspoint.com/webrtc/webrtc_mobile_support.htm</a> å¹¶åšäº†ä¸‹éªŒè¯</p>
<h3 id="Question-è‹¹æœç”¨æˆ·æ€ä¹ˆä½¿ç”¨"><a href="#Question-è‹¹æœç”¨æˆ·æ€ä¹ˆä½¿ç”¨" class="headerlink" title="Question:è‹¹æœç”¨æˆ·æ€ä¹ˆä½¿ç”¨"></a>Question:è‹¹æœç”¨æˆ·æ€ä¹ˆä½¿ç”¨</h3><p>è‹¹æœå®˜æ–¹15å¹´åº•å£°ç§°Safariæ¥ä¸‹æ¥ä¼šæ”¯æŒï¼Œæœ‰æœ›åœ¨è¿‘ä¸¤å¹´å¾—åˆ°ä½¿ç”¨</p>
<p>å¦‚æœè‹¹æœç”¨æˆ·æƒ³ä½¿ç”¨ï¼Œå¯ä»¥ä¸‹è½½ Bowser(<a href="http://www.openwebrtc.org/bowser/" target="_blank" rel="noopener">http://www.openwebrtc.org/bowser/</a>) æˆ–è€…Chrome</p>
]]></content>
      <categories>
        <category>æµåª’ä½“</category>
      </categories>
      <tags>
        <tag>WebRTC</tag>
        <tag>ffmpeg</tag>
      </tags>
  </entry>
  <entry>
    <title>videoæ ‡ç­¾ä¸‹è§¦æ‘¸åæ ‡å½’ä¸€åŒ–</title>
    <url>/2016/08/24/2016-2017%E7%9B%B4%E6%92%AD%E7%9B%B8%E5%85%B3/Web_video%E6%A0%87%E7%AD%BE%E4%B8%8B%E8%A7%A6%E6%91%B8%E5%9D%90%E6%A0%87%E5%BD%92%E4%B8%80%E5%8C%96/</url>
    <content><![CDATA[<h1 id="åŸºæœ¬çŸ¥è¯†"><a href="#åŸºæœ¬çŸ¥è¯†" class="headerlink" title="åŸºæœ¬çŸ¥è¯†"></a>åŸºæœ¬çŸ¥è¯†</h1><h2 id="è§¦æ‘¸ç‚¹ä½ç½®"><a href="#è§¦æ‘¸ç‚¹ä½ç½®" class="headerlink" title="è§¦æ‘¸ç‚¹ä½ç½®"></a>è§¦æ‘¸ç‚¹ä½ç½®</h2><ul>
<li>clientX / clientYï¼š// è§¦æ‘¸ç‚¹ç›¸å¯¹äºæµè§ˆå™¨çª—å£viewportçš„ä½ç½®  å‚ç…§ç‚¹ä¼šéšç€æµè§ˆå™¨çš„æ»šåŠ¨è€Œå˜åŒ–</li>
<li>pageX / pageYï¼š// è§¦æ‘¸ç‚¹ç›¸å¯¹äºé¡µé¢çš„ä½ç½®  å‚ç…§ç‚¹ä¸ä¼šéšç€æµè§ˆå™¨çš„æ»šåŠ¨è€Œå˜åŒ–</li>
<li>screenX /screenYï¼š// è§¦æ‘¸ç‚¹ç›¸å¯¹äºå±å¹•çš„ä½ç½® </li>
</ul>
<p>æ‰€ä»¥å¦‚æœè¦ç®—é¼ æ ‡åœ¨å½“å‰divçš„ç›¸å¯¹ä½ç½® </p>
<p>é€šè¿‡è·å–<code>var offset = $(&quot;#mainScreen&quot;).offset();</code>å</p>
<p>å½“å‰é¼ æ ‡çš„ç»å¯¹ä½ç½®è¦ç”¨ <strong><code>pageX/Y</code></strong> å»æ‹¿ å¦åˆ™æµè§ˆå™¨é¡µé¢æ»šåŠ¨åä¼šå°‘ç®—ä¸€æ®µ</p>
<h2 id="è§¦æ‘¸äº‹ä»¶"><a href="#è§¦æ‘¸äº‹ä»¶" class="headerlink" title="è§¦æ‘¸äº‹ä»¶"></a>è§¦æ‘¸äº‹ä»¶</h2><h3 id="PC"><a href="#PC" class="headerlink" title="PC"></a>PC</h3><pre><code>onmousemove    script    å½“é¼ æ ‡æŒ‡é’ˆç§»åŠ¨åˆ°å…ƒç´ ä¸Šæ—¶è§¦å‘ã€‚
onmouseout    script    å½“é¼ æ ‡æŒ‡é’ˆç§»å‡ºå…ƒç´ æ—¶è§¦å‘ã€‚
onmouseup å±æ€§åœ¨æ¾å¼€é¼ æ ‡æŒ‰é’®æ—¶è§¦å‘ã€‚
æç¤ºï¼šç›¸å¯¹äº onmouseup äº‹ä»¶çš„äº‹ä»¶æ¬¡åºï¼ˆé™äºé¼ æ ‡å·¦/ä¸­é”®ï¼‰ï¼š
onmousedown
onmouseup
onclick
onmouseup äº‹ä»¶çš„äº‹ä»¶æ¬¡åºï¼ˆé™äºé¼ æ ‡å³é”®ï¼‰ï¼š
onmousedown
onmouseup
oncontextmenu
onMouseoverå’ŒonMousemoveæœ‰ä»€ä¹ˆåŒºåˆ«?
åŒºåˆ«æ˜¯è¿›å…¥åonmousemoveé¼ æ ‡æ¯åŠ¨ä¸€ä¸‹éƒ½ä¼šæ‰§è¡Œäº‹ä»¶ï¼Œonmouseoveråªåœ¨é¼ æ ‡è¿›å…¥æ—¶æ‰§è¡Œä¸€æ¬¡</code></pre><h3 id="Mobile"><a href="#Mobile" class="headerlink" title="Mobile"></a>Mobile</h3><p>åŸºæœ¬äº‹ä»¶å¦‚ä¸‹ï¼Œå…¶ä»–çš„éƒ½æ˜¯å¯¹è¿™äº›äº‹ä»¶çš„ç»„åˆå°è£…</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">mainScreen.addEventListener(<span class="string">"touchmove"</span>, touchMove, <span class="literal">false</span>);<span class="comment">//æ‰‹æŒ‡åœ¨å±å¹•ä¸Šç§»åŠ¨æ—¶è§¦å‘[ä¸åŠ¨ä½†åœç•™å¤ªä¹…ä¹Ÿä¼šè§¦å‘]</span></span><br><span class="line">mainScreen.addEventListener(<span class="string">"touchstart"</span>, touchStart, <span class="literal">false</span>);<span class="comment">//æ‰‹æŒ‡ä¸€è§¦æ‘¸å±å¹•å°±è§¦å‘</span></span><br><span class="line">mainScreen.addEventListener(<span class="string">"touchend"</span>, touchEnd, <span class="literal">false</span>);<span class="comment">//æ‰‹æŒ‡ç¦»å¼€å±å¹•è§¦å‘</span></span><br></pre></td></tr></table></figure>

<a id="more"></a>

<h2 id="å…¨å±"><a href="#å…¨å±" class="headerlink" title="å…¨å±"></a>å…¨å±</h2><h3 id="è¿›å…¥å…¨å±"><a href="#è¿›å…¥å…¨å±" class="headerlink" title="è¿›å…¥å…¨å±"></a>è¿›å…¥å…¨å±</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">launchFullScreen</span> (<span class="params">element</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (element.requestFullscreen) &#123;</span><br><span class="line">    element.requestFullscreen();</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (element.mozRequestFullScreen) &#123;</span><br><span class="line">    element.mozRequestFullScreen();</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (element.webkitRequestFullscreen) &#123;</span><br><span class="line">    element.webkitRequestFullscreen();</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (element.msRequestFullscreen) &#123;</span><br><span class="line">    element.msRequestFullscreen();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="é€€å‡ºå…¨å±"><a href="#é€€å‡ºå…¨å±" class="headerlink" title="é€€å‡ºå…¨å±"></a>é€€å‡ºå…¨å±</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">cancelFullScreen</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">document</span>.cancelFullScreen) &#123;</span><br><span class="line">    <span class="built_in">document</span>.cancelFullScreen();</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">document</span>.mozCancelFullScreen) &#123;</span><br><span class="line">    <span class="built_in">document</span>.mozCancelFullScreen();</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">document</span>.webkitCancelFullScreen) &#123;</span><br><span class="line">    <span class="built_in">document</span>.webkitCancelFullScreen();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="åˆ¤æ–­æ˜¯å¦å…¨å±"><a href="#åˆ¤æ–­æ˜¯å¦å…¨å±" class="headerlink" title="åˆ¤æ–­æ˜¯å¦å…¨å±"></a>åˆ¤æ–­æ˜¯å¦å…¨å±</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//åå°„èª¿ç”¨</span></span><br><span class="line"><span class="keyword">var</span> invokeFieldOrMethod = <span class="function"><span class="keyword">function</span> (<span class="params">element, method</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> usablePrefixMethod;</span><br><span class="line">  [<span class="string">"webkit"</span>, <span class="string">"moz"</span>, <span class="string">"ms"</span>, <span class="string">"o"</span>, <span class="string">""</span>].forEach(<span class="function"><span class="keyword">function</span> (<span class="params">prefix</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (usablePrefixMethod) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">if</span> (prefix === <span class="string">""</span>) &#123;</span><br><span class="line">      <span class="comment">// æ— å‰ç¼€ï¼Œæ–¹æ³•é¦–å­—æ¯å°å†™</span></span><br><span class="line">      method = method.slice(<span class="number">0</span>, <span class="number">1</span>).toLowerCase() + method.slice(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> typePrefixMethod = <span class="keyword">typeof</span> element[prefix + method];</span><br><span class="line">    <span class="keyword">if</span> (typePrefixMethod + <span class="string">""</span> !== <span class="string">"undefined"</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (typePrefixMethod === <span class="string">"function"</span>) &#123;</span><br><span class="line">        usablePrefixMethod = element[prefix + method]();</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        usablePrefixMethod = element[prefix + method];</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> usablePrefixMethod;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//åˆ¤æ–­æ˜¯å¦æ˜¯å…¨å±</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isFullScreen</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> invokeFieldOrMethod(<span class="built_in">document</span>, <span class="string">'FullScreen'</span>) || invokeFieldOrMethod(<span class="built_in">document</span>, <span class="string">'IsFullScreen'</span>) || <span class="built_in">document</span>.IsFullScreen;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ç›‘å¬æ‰‹æœºæ¨ªç«–å±çŠ¶æ€"><a href="#ç›‘å¬æ‰‹æœºæ¨ªç«–å±çŠ¶æ€" class="headerlink" title="ç›‘å¬æ‰‹æœºæ¨ªç«–å±çŠ¶æ€"></a>ç›‘å¬æ‰‹æœºæ¨ªç«–å±çŠ¶æ€</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> mOrientation = <span class="number">0</span>;</span><br><span class="line">$(<span class="built_in">window</span>).on(<span class="string">"orientationchange"</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  mOrientation = <span class="built_in">window</span>.orientation;</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">window</span>.orientation == <span class="number">0</span>) <span class="comment">// Portrait</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"ç«–å±çŠ¶æ€"</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="comment">// Landscape</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"æ¨ªå±çŠ¶æ€"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="ç«–å±0-æ¨ªå±-90ï¼ˆæ­£å¸¸æ¨ªæ”¾ï¼‰-90-ï¼ˆæ‰‹æœºé¡¶éƒ¨åœ¨å³ä¾§ï¼‰"><a href="#ç«–å±0-æ¨ªå±-90ï¼ˆæ­£å¸¸æ¨ªæ”¾ï¼‰-90-ï¼ˆæ‰‹æœºé¡¶éƒ¨åœ¨å³ä¾§ï¼‰" class="headerlink" title="ç«–å±0 æ¨ªå± 90ï¼ˆæ­£å¸¸æ¨ªæ”¾ï¼‰ -90 ï¼ˆæ‰‹æœºé¡¶éƒ¨åœ¨å³ä¾§ï¼‰"></a>ç«–å±0 æ¨ªå± 90ï¼ˆæ­£å¸¸æ¨ªæ”¾ï¼‰ -90 ï¼ˆæ‰‹æœºé¡¶éƒ¨åœ¨å³ä¾§ï¼‰</h3><h2 id="CSS3æ—‹è½¬å…ƒç´ "><a href="#CSS3æ—‹è½¬å…ƒç´ " class="headerlink" title="CSS3æ—‹è½¬å…ƒç´ "></a>CSS3æ—‹è½¬å…ƒç´ </h2><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.trans90</span> &#123;</span><br><span class="line">  <span class="comment">/* Rotate div */</span></span><br><span class="line">  <span class="attribute">transform</span>: <span class="built_in">rotate</span>(<span class="number">9deg</span>);</span><br><span class="line">  <span class="attribute">-ms-transform</span>: <span class="built_in">rotate</span>(<span class="number">90deg</span>);</span><br><span class="line">  <span class="comment">/* Internet Explorer */</span></span><br><span class="line">  <span class="attribute">-moz-transform</span>: <span class="built_in">rotate</span>(<span class="number">90deg</span>);</span><br><span class="line">  <span class="comment">/* Firefox */</span></span><br><span class="line">  <span class="attribute">-webkit-transform</span>: <span class="built_in">rotate</span>(<span class="number">90deg</span>);</span><br><span class="line">  <span class="comment">/* Safari å’Œ Chrome */</span></span><br><span class="line">  <span class="attribute">-o-transform</span>: <span class="built_in">rotate</span>(<span class="number">90deg</span>);</span><br><span class="line">  <span class="comment">/* Opera */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">transfVideo</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  $(<span class="string">"#remoteVideo"</span>).addClass(<span class="string">"trans90"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="æ³¨æ„ï¼šå…¨å±çŠ¶æ€ä¸‹å…ƒç´ çš„æ—‹è½¬æ•ˆæœæ— æ•ˆ"><a href="#æ³¨æ„ï¼šå…¨å±çŠ¶æ€ä¸‹å…ƒç´ çš„æ—‹è½¬æ•ˆæœæ— æ•ˆ" class="headerlink" title="æ³¨æ„ï¼šå…¨å±çŠ¶æ€ä¸‹å…ƒç´ çš„æ—‹è½¬æ•ˆæœæ— æ•ˆ"></a>æ³¨æ„ï¼šå…¨å±çŠ¶æ€ä¸‹å…ƒç´ çš„æ—‹è½¬æ•ˆæœæ— æ•ˆ</h3><h2 id="videoå…ƒç´ "><a href="#videoå…ƒç´ " class="headerlink" title="videoå…ƒç´ "></a>videoå…ƒç´ </h2><pre><code>&lt;video id=&quot;remoteVideo&quot; autoplay width=&quot;100%&quot; height=&quot;100%&quot;&gt;
    &lt;p&gt;æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè¯¥æ ‡ç­¾&lt;/p&gt;
&lt;/video&gt;</code></pre><h3 id="å±æ€§è¯¦è§£"><a href="#å±æ€§è¯¦è§£" class="headerlink" title="å±æ€§è¯¦è§£"></a>å±æ€§è¯¦è§£</h3><ul>
<li><strong>autoplay</strong> ï¼šè‡ªåŠ¨æ’­æ”¾</li>
<li><strong>width=â€100%â€ height=â€100%â€</strong> ï¼šè®¾ç½®å…ƒç´ çš„å®½é«˜ï¼Œ<strong><code>éæºæ•°æ®çš„å®½é«˜</code></strong></li>
</ul>
<p>ä¸æŒ‡å®šcontrols å±æ€§ï¼Œåˆ™ä¸ä¼šæ˜¾ç¤ºé»˜è®¤çš„æ’­æ”¾ï¼Œè¿›åº¦æ¡ç­‰æ ·å¼,ä½†æ˜¯å…¨å±æ—¶åˆä¼šæ˜¾ç¤ºï¼Œæ€ä¹ˆå»æ‰ï¼Ÿ</p>
<p>å‚è€ƒ<a href="https://segmentfault.com/a/1190000000380064" target="_blank" rel="noopener">https://segmentfault.com/a/1190000000380064</a></p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*ä¼ªå…ƒç´ ï¼Œè®¾ç½®å…¨å±æ—¶ä¸æ˜¾ç¤ºæ§ä»¶*/</span></span><br><span class="line"><span class="selector-tag">video</span><span class="selector-pseudo">::-webkit-media-controls-enclosure</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">video</span><span class="selector-pseudo">::-moz-media-controls-enclosure</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">video</span><span class="selector-pseudo">::media-controls-enclosure</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: none;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong><code>videoWidth,videoHeightå±æ€§</code></strong>:æŒ‡çš„æ˜¯è§†é¢‘æºæ•°æ®ï¼Œä¸ä¼šæ”¹å˜ï¼Œä¹Ÿä¸èƒ½ä¿®æ”¹ã€‚</li>
<li><strong><code>width,heightå±æ€§</code></strong>ï¼švideoå®¹å™¨å¤§å°ï¼Œå½“å…¶å€¼è®¾ç½®çš„ä¸è§†é¢‘æºæ•°æ®ä¸åŒæ—¶ï¼Œä¼šå°†è§†é¢‘æºæ•°æ®è¿›è¡Œä¸€å®šæ¯”ä¾‹(videoWidth,videoHeightçš„æ¯”ä¾‹)çš„ç¼©æ”¾ï¼Œ<strong>ä½¿å¾—è§†é¢‘æ•°æ®å°½é‡å……æ»¡videoå®¹å™¨</strong></li>
</ul>
<h2 id="bodyåœ¨ç§»åŠ¨ç«¯æ˜¾ç¤ºæ—¶å·¦ä¾§ä¼šç•™å‡ºä¸€å®šå®½åº¦çš„ç«–æ¡ï¼Œè®¾ç½®100-é¡µæ²¡æœ‰ç”¨"><a href="#bodyåœ¨ç§»åŠ¨ç«¯æ˜¾ç¤ºæ—¶å·¦ä¾§ä¼šç•™å‡ºä¸€å®šå®½åº¦çš„ç«–æ¡ï¼Œè®¾ç½®100-é¡µæ²¡æœ‰ç”¨" class="headerlink" title="bodyåœ¨ç§»åŠ¨ç«¯æ˜¾ç¤ºæ—¶å·¦ä¾§ä¼šç•™å‡ºä¸€å®šå®½åº¦çš„ç«–æ¡ï¼Œè®¾ç½®100%é¡µæ²¡æœ‰ç”¨"></a>bodyåœ¨ç§»åŠ¨ç«¯æ˜¾ç¤ºæ—¶å·¦ä¾§ä¼šç•™å‡ºä¸€å®šå®½åº¦çš„ç«–æ¡ï¼Œè®¾ç½®100%é¡µæ²¡æœ‰ç”¨</h2><p>ç§»åŠ¨ç«¯ä¼šç•™ä¸æ»šåŠ¨æ¡æœ‰å…³ï¼Œæ”¹marginå°±è¡Œ</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: white;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="Touchäº‹ä»¶æ•è·"><a href="#Touchäº‹ä»¶æ•è·" class="headerlink" title="Touchäº‹ä»¶æ•è·"></a>Touchäº‹ä»¶æ•è·</h1><h2 id="åŸºæœ¬æ–¹æ³•"><a href="#åŸºæœ¬æ–¹æ³•" class="headerlink" title="åŸºæœ¬æ–¹æ³•"></a>åŸºæœ¬æ–¹æ³•</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">touchMove</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">  event.preventDefault();</span><br><span class="line">  <span class="keyword">if</span>(!event.touches.length) <span class="keyword">return</span>;</span><br><span class="line">  <span class="keyword">var</span> touch = event.touches[<span class="number">0</span>];</span><br><span class="line">  sendTouchEvent(touch, <span class="string">"TOUCH_MOVE"</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">touchStart</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">  event.preventDefault();</span><br><span class="line">  <span class="keyword">if</span>(!event.touches.length) <span class="keyword">return</span>;</span><br><span class="line">  <span class="keyword">var</span> touch = event.touches[<span class="number">0</span>];</span><br><span class="line">  sendTouchEvent(touch, <span class="string">"TOUCH_START"</span>);</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">touchEnd</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"type:end"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">mainScreen.addEventListener(<span class="string">"touchmove"</span>, touchMove, <span class="literal">false</span>);</span><br><span class="line">mainScreen.addEventListener(<span class="string">"touchstart"</span>, touchStart, <span class="literal">false</span>);</span><br><span class="line">mainScreen.addEventListener(<span class="string">"touchend"</span>, touchEnd, <span class="literal">false</span>);</span><br></pre></td></tr></table></figure>
<h2 id="å±å¹•åˆ†è¾¨ç‡"><a href="#å±å¹•åˆ†è¾¨ç‡" class="headerlink" title="å±å¹•åˆ†è¾¨ç‡"></a>å±å¹•åˆ†è¾¨ç‡</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">" å±å¹•åˆ†è¾¨ç‡çš„é«˜ï¼š"</span> + <span class="built_in">window</span>.screen.height + <span class="string">"\n"</span> + <span class="string">" å±å¹•åˆ†è¾¨ç‡çš„å®½ï¼š"</span> + <span class="built_in">window</span>.screen.width + <span class="string">"\n"</span>)</span><br></pre></td></tr></table></figure>

<h3 id="æ¨ªå±ä¸‹-window-screen-width-å¾—åˆ°çš„-æ‰‹æœºçš„é«˜åº¦çš„é‚£ä¸ªåˆ†è¾¨ç‡è€Œä¸æ˜¯å®½åº¦"><a href="#æ¨ªå±ä¸‹-window-screen-width-å¾—åˆ°çš„-æ‰‹æœºçš„é«˜åº¦çš„é‚£ä¸ªåˆ†è¾¨ç‡è€Œä¸æ˜¯å®½åº¦" class="headerlink" title="æ¨ªå±ä¸‹ window.screen.width å¾—åˆ°çš„ æ‰‹æœºçš„é«˜åº¦çš„é‚£ä¸ªåˆ†è¾¨ç‡è€Œä¸æ˜¯å®½åº¦"></a>æ¨ªå±ä¸‹ <code>window.screen.width</code> å¾—åˆ°çš„ æ‰‹æœºçš„é«˜åº¦çš„é‚£ä¸ªåˆ†è¾¨ç‡è€Œä¸æ˜¯å®½åº¦</h3><h2 id="å‘é€touchäº‹ä»¶æ–¹æ³•â€”â€”sendTouchEvent"><a href="#å‘é€touchäº‹ä»¶æ–¹æ³•â€”â€”sendTouchEvent" class="headerlink" title="å‘é€touchäº‹ä»¶æ–¹æ³•â€”â€”sendTouchEvent"></a>å‘é€touchäº‹ä»¶æ–¹æ³•â€”â€”sendTouchEvent</h2><p>å¦‚æœè¦è€ƒè™‘å®Œå…¨çš„è¯ï¼Œéœ€è¦è€ƒè™‘12ç§æƒ…å†µ</p>
<p>3ç§å±å¹•æ–¹å‘*æ˜¯å¦å…¨å±2ç§æƒ…å†µ*æºæ•°æ®æ¨ªç«–å±æƒ…å†µ(å®½é«˜æ¯”)2ç§æƒ…å†µ=12</p>
<h3 id="ä¸ºä»€ä¹ˆè€ƒè™‘æºæ•°æ®æ¨ªç«–å±æƒ…å†µï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆè€ƒè™‘æºæ•°æ®æ¨ªç«–å±æƒ…å†µï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆè€ƒè™‘æºæ•°æ®æ¨ªç«–å±æƒ…å†µï¼Ÿ"></a>ä¸ºä»€ä¹ˆè€ƒè™‘æºæ•°æ®æ¨ªç«–å±æƒ…å†µï¼Ÿ</h3><p>è¿›è¡Œåæ ‡æ˜ å°„ã€å½’ä¸€åŒ–çš„æ—¶å€™ä½ å°±çŸ¥é“äº†</p>
<p>æ˜¯å¦å…¨å±ä¸‹ï¼Œvideoéƒ½è¦è‡ªåŠ¨å……æ»¡å±å¹•(videoWidth:videoHeightä¸å˜)</p>
<p>å…¶videoå®¹å™¨çš„å®½åº¦è¦ä¿æŒå’Œwindow.screen.widthä¸€è‡´</p>
<p>ä»£ç å¦‚ä¸‹ ç›®å‰åªè€ƒè™‘<code>ä»¥ä¸‹6ç§æƒ…å†µ</code>ï¼Œå…¶ä»–æƒ…å†µä¸ºéæ³•æ“ä½œ</p>
<ol>
<li><p>ç«–å±*æ˜¯å¦å…¨å±(2ç§)*æºæ•°æ®æ¨ªç«–å±(2ç§)</p>
</li>
<li><p>æ¨ªå±(90å’Œ-90ä¸¤ç§æƒ…å†µ)*å…¨å±*æºæ•°æ®æ¨ªå±</p>
</li>
</ol>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sendTouchEvent</span> (<span class="params">touch, eventType</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//videoWidthã€videoHeightã€widthå’Œheightçš„å¤§å°åˆ‡å±ä¸ä¼šæ”¹å˜å¤§å°</span></span><br><span class="line">  <span class="comment">//æš‚ä¸è€ƒè™‘éå…¨å±æ—¶æ¨ªå±åæ ‡ 0 90ï¼ˆæ­£å¸¸æ¨ªæ”¾ï¼‰ -90 ï¼ˆæœºé¡¶åœ¨å³ä¾§ï¼‰</span></span><br><span class="line">  <span class="comment">//å…¨å±æ¨¡å¼ä¸‹ touch.pageX/Y ä¸ç”¨å‚è€ƒoffset</span></span><br><span class="line">  trace(mOrientation);</span><br><span class="line">  <span class="keyword">var</span> remoteVideo = <span class="built_in">document</span>.getElementById(<span class="string">"remoteVideo"</span>);</span><br><span class="line">  <span class="comment">//æš‚ä¸è€ƒè™‘videoWidth&gt;videoHeightæ—¶mOrientation == 0çš„å…¨å±æƒ…å†µ</span></span><br><span class="line">  <span class="keyword">if</span> (mOrientation == <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> currentWidth = remoteVideo.width;</span><br><span class="line">    <span class="keyword">var</span> currentHeight = (remoteVideo.width / remoteVideo.videoWidth * remoteVideo.videoHeight);</span><br><span class="line">    <span class="comment">//						trace("å½“å‰æ€»å®½åº¦" + currentWidth + "å½“å‰æ€»é«˜åº¦:" + currentHeight);</span></span><br><span class="line">    <span class="keyword">var</span> relativeX = (touch.pageX - offset.left);</span><br><span class="line">    <span class="keyword">var</span> relativeY = (touch.pageY - offset.top);</span><br><span class="line">    <span class="comment">//åˆ¤æ–­æ˜¯å¦ä¸ºå…¨å± å…¨å±ä¸‹ä½ç½®ä¸º touch.pageY-(window.screen.height-currentWidth)/2</span></span><br><span class="line">    <span class="keyword">var</span> posX = relativeX;</span><br><span class="line">    <span class="keyword">if</span> (isFullScreen()) &#123;</span><br><span class="line">      <span class="comment">//å…¨å±æƒ…å†µä¸‹è¦è€ƒè™‘videoWidth&gt;videoHeigh</span></span><br><span class="line">      <span class="keyword">if</span> (remoteVideo.videoWidth &lt;= remoteVideo.videoHeight) &#123;</span><br><span class="line">        <span class="comment">//console.log("touch.pageY:"+touch.pageY+" window.screen.height:"+window.screen.height+" remoteVideo.videoHeight:"+remoteVideo.videoHeight+" relativeY:"+relativeY);</span></span><br><span class="line">        <span class="keyword">var</span> posY = (touch.pageY - (<span class="built_in">window</span>.screen.height - currentHeight) / <span class="number">2</span>);</span><br><span class="line">        <span class="comment">//console.log("x:" + relativeX + " y:" + posY+ " type:"+eventType+" full");</span></span><br><span class="line">        <span class="keyword">var</span> floatX = posX &lt; <span class="number">0</span> ? <span class="number">0</span> : (posX &gt; currentWidth ? <span class="number">1</span> : posX / currentWidth);</span><br><span class="line">        <span class="keyword">var</span> floatY = posY &lt; <span class="number">0</span> ? <span class="number">0</span> : (posY &gt; currentHeight ? <span class="number">1</span> : posY / currentHeight);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"å‘é€ç»“æœï¼šæ¨ªåæ ‡ï¼š"</span> + floatX + <span class="string">" çºµåæ ‡"</span> + floatY + <span class="string">"ç±»å‹:"</span> + eventType);</span><br><span class="line">        trace(<span class="string">"å‘é€ç»“æœï¼šæ¨ªåæ ‡ï¼š"</span> + floatX + <span class="string">" çºµåæ ‡"</span> + floatY + <span class="string">"ç±»å‹:"</span> + eventType);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> posY = relativeX;</span><br><span class="line">        <span class="keyword">var</span> posX = currentHeight - (touch.pageY - (<span class="built_in">window</span>.screen.height - currentHeight) / <span class="number">2</span>);</span><br><span class="line">        <span class="keyword">var</span> floatX = posX &lt; <span class="number">0</span> ? <span class="number">0</span> : (posX &gt; currentHeight ? <span class="number">1</span> : posX / currentHeight);</span><br><span class="line">        <span class="keyword">var</span> floatY = posY &lt; <span class="number">0</span> ? <span class="number">0</span> : (posY &gt; currentWidth ? <span class="number">1</span> : posY / currentWidth);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"å‘é€ç»“æœï¼šæ¨ªåæ ‡ï¼š"</span> + floatX + <span class="string">" çºµåæ ‡"</span> + floatY + <span class="string">"ç±»å‹:"</span> + eventType);</span><br><span class="line">        trace(<span class="string">"å‘é€ç»“æœï¼šæ¨ªåæ ‡ï¼š"</span> + floatX + <span class="string">" çºµåæ ‡"</span> + floatY + <span class="string">"ç±»å‹:"</span> + eventType);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">//console.log("x:" + relativeX + " y:" + relativeY + " type:"+eventType+" nofull");</span></span><br><span class="line">      <span class="keyword">if</span> (remoteVideo.videoWidth &lt;= remoteVideo.videoHeight) &#123;</span><br><span class="line">        <span class="keyword">var</span> posY = relativeY;</span><br><span class="line">        <span class="keyword">var</span> floatX = posX &lt; <span class="number">0</span> ? <span class="number">0</span> : (posX &gt; currentWidth ? <span class="number">1</span> : posX / currentWidth);</span><br><span class="line">        <span class="keyword">var</span> floatY = posY &lt; <span class="number">0</span> ? <span class="number">0</span> : (posY &gt; currentHeight ? <span class="number">1</span> : posY / currentHeight);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"å‘é€ç»“æœï¼šæ¨ªåæ ‡ï¼š"</span> + floatX + <span class="string">" çºµåæ ‡"</span> + floatY + <span class="string">"ç±»å‹:"</span> + eventType);</span><br><span class="line">        trace(<span class="string">"å‘é€ç»“æœï¼šæ¨ªåæ ‡ï¼š"</span> + floatX + <span class="string">" çºµåæ ‡"</span> + floatY + <span class="string">"ç±»å‹:"</span> + eventType);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> posY = relativeX;</span><br><span class="line">        <span class="keyword">var</span> posX = currentHeight - relativeY;</span><br><span class="line">        <span class="keyword">var</span> floatX = posX &lt; <span class="number">0</span> ? <span class="number">0</span> : (posX &gt; currentHeight ? <span class="number">1</span> : posX / currentHeight);</span><br><span class="line">        <span class="keyword">var</span> floatY = posY &lt; <span class="number">0</span> ? <span class="number">0</span> : (posY &gt; currentWidth ? <span class="number">1</span> : posY / currentWidth);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"å‘é€ç»“æœï¼šæ¨ªåæ ‡ï¼š"</span> + floatX + <span class="string">" çºµåæ ‡"</span> + floatY + <span class="string">"ç±»å‹:"</span> + eventType);</span><br><span class="line">        trace(<span class="string">"å‘é€ç»“æœï¼šæ¨ªåæ ‡ï¼š"</span> + floatX + <span class="string">" çºµåæ ‡"</span> + floatY + <span class="string">"ç±»å‹:"</span> + eventType);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (mOrientation == <span class="number">90</span>) &#123;</span><br><span class="line">    <span class="comment">//ç›®å‰åªè€ƒè™‘å…¨å±çš„æƒ…å†µ</span></span><br><span class="line">    <span class="comment">//widthå’Œheightè¯´æ³•è¿˜æ˜¯å’Œæ‰‹æœºä¿æŒä¸€è‡´ ä¸å—å½±å“</span></span><br><span class="line">    <span class="comment">//videoWidthã€videoHeightã€widthå’Œheightçš„å¤§å°ä¸æ¨ªå±æ—¶ä¿æŒä¸€è‡´ 640 480</span></span><br><span class="line">    <span class="keyword">var</span> currentWidth = remoteVideo.width;</span><br><span class="line">    <span class="keyword">var</span> currentHeight = (remoteVideo.videoWidth / remoteVideo.videoHeight) * remoteVideo.width;</span><br><span class="line">    <span class="comment">//						trace("å½“å‰æ€»å®½åº¦" + currentWidth + "å½“å‰æ€»é«˜åº¦:" + currentHeight);//360 480</span></span><br><span class="line">    <span class="comment">//						trace("touch.pageX:"+touch.pageX+" touch.pageY:"+touch.pageY);</span></span><br><span class="line">    <span class="keyword">var</span> posX = currentWidth - touch.pageY;</span><br><span class="line">    <span class="comment">//æ¨ªå±ä¸‹ window.screen.widthå¾—åˆ°çš„ æ‰‹æœºçš„é«˜åº¦çš„é‚£ä¸ªåˆ†è¾¨ç‡è€Œä¸æ˜¯å®½åº¦</span></span><br><span class="line">    <span class="keyword">var</span> posY = touch.pageX - (<span class="built_in">window</span>.screen.width - currentHeight) / <span class="number">2</span>;</span><br><span class="line">    <span class="comment">//è¿˜å¾—è€ƒè™‘videoHeight&gt;videoWidthï¼Œéå…¨å±çš„æƒ…å†µ è¿™è¾¹ä¸å†™äº†</span></span><br><span class="line">    <span class="keyword">if</span> (isFullScreen()) &#123;</span><br><span class="line">      <span class="comment">//							trace("posX:"+posX+" posY"+posY);</span></span><br><span class="line">      <span class="comment">//							trace("touch.pageX:"+touch.pageX+" window.screen.width:"+window.screen.width+" currentHeight:"+currentHeight);</span></span><br><span class="line">      <span class="keyword">var</span> floatX = posX &lt; <span class="number">0</span> ? <span class="number">0</span> : (posX &gt; currentWidth ? <span class="number">1</span> : posX / currentWidth);</span><br><span class="line">      <span class="keyword">var</span> floatY = posY &lt; <span class="number">0</span> ? <span class="number">0</span> : (posY &gt; currentHeight ? <span class="number">1</span> : posY / currentHeight);</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"å‘é€ç»“æœï¼šæ¨ªåæ ‡ï¼š"</span> + floatX + <span class="string">" çºµåæ ‡"</span> + floatY + <span class="string">"ç±»å‹:"</span> + eventType);</span><br><span class="line">      trace(<span class="string">"å‘é€ç»“æœï¼šæ¨ªåæ ‡ï¼š"</span> + floatX + <span class="string">" çºµåæ ‡"</span> + floatY + <span class="string">"ç±»å‹:"</span> + eventType);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (mOrientation == <span class="number">-90</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> currentWidth = remoteVideo.width;</span><br><span class="line">    <span class="keyword">var</span> currentHeight = (remoteVideo.videoWidth / remoteVideo.videoHeight) * remoteVideo.width;</span><br><span class="line">    <span class="keyword">var</span> posX = currentWidth - touch.pageY;</span><br><span class="line">    <span class="comment">//éœ€è¦window.screen.widthå»å‡</span></span><br><span class="line">    <span class="keyword">var</span> posY = touch.pageX - (<span class="built_in">window</span>.screen.width - currentHeight) / <span class="number">2</span>;</span><br><span class="line">    <span class="comment">//è¿˜å¾—è€ƒè™‘videoHeight&gt;videoWidthçš„æƒ…å†µ è¿™è¾¹ä¸å†™äº†</span></span><br><span class="line">    <span class="keyword">if</span> (isFullScreen()) &#123;</span><br><span class="line">      <span class="comment">//							trace("posX:"+posX+" posY"+posY);</span></span><br><span class="line">      <span class="comment">//							trace("touch.pageX:"+touch.pageX+" window.screen.width:"+window.screen.width+" currentHeight:"+currentHeight);</span></span><br><span class="line">      <span class="keyword">var</span> floatX = posX &lt; <span class="number">0</span> ? <span class="number">0</span> : (posX &gt; currentWidth ? <span class="number">1</span> : posX / currentWidth);</span><br><span class="line">      <span class="keyword">var</span> floatY = posY &lt; <span class="number">0</span> ? <span class="number">0</span> : (posY &gt; currentHeight ? <span class="number">1</span> : posY / currentHeight);</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"å‘é€ç»“æœï¼šæ¨ªåæ ‡ï¼š"</span> + floatX + <span class="string">" çºµåæ ‡"</span> + floatY + <span class="string">"ç±»å‹:"</span> + eventType);</span><br><span class="line">      trace(<span class="string">"å‘é€ç»“æœï¼šæ¨ªåæ ‡ï¼š"</span> + floatX + <span class="string">" çºµåæ ‡"</span> + floatY + <span class="string">"ç±»å‹:"</span> + eventType);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>å¤§å‰ç«¯</category>
      </categories>
      <tags>
        <tag>HTML</tag>
        <tag>å¤šç‚¹è§¦æ§</tag>
      </tags>
  </entry>
  <entry>
    <title>æµåª’ä½“ç›´æ’­â€”â€”èµ„æ–™æ•´ç†ã€ä½ æƒ³è¦äº†è§£çš„éƒ½åœ¨è¿™</title>
    <url>/2016/08/24/2016-2017%E7%9B%B4%E6%92%AD%E7%9B%B8%E5%85%B3/%E6%B5%81%E5%AA%92%E4%BD%93%E7%9B%B4%E6%92%AD%E2%80%94%E2%80%94%E8%B5%84%E6%96%99%E6%95%B4%E7%90%86/</url>
    <content><![CDATA[<p>å¹¶æ²¡æœ‰æŒ‰ç…§æŸç§æ ‡å‡†è¿›è¡Œåˆ†ç±»ã€‚</p>
<p>æ„Ÿå…´è¶£çš„å¯ä»¥å°†å…¶ä½œä¸ºchromeä¹¦ç­¾=ã€‚=</p>
<p>ã€æ–‡æœ«é™„ä¸ŠBookmarks Jsonã€‘</p>
<a id="more"></a>

<h1 id="WebRTC"><a href="#WebRTC" class="headerlink" title="WebRTC"></a>WebRTC</h1><ol>
<li><a href="https://imququ.com/post/html5-live-player-3.html" target="_blank" rel="noopener">HTML5 è§†é¢‘ç›´æ’­ï¼ˆä¸‰ï¼‰ | JerryQu çš„å°ç«™</a><br>ä»è¿™è¾¹å¼€å§‹äº†è§£çš„WebRTC,é‡Œé¢æ¨èçš„æ–‡ç« éƒ½å¯ä»¥å»è¯»è¯»ï¼Œåé¢ä¹¦ç­¾å¯èƒ½ä¸ä¼šæåˆ°ã€‚</li>
<li><a href="https://github.com/LingyuCoder/SkyRTC-demo" target="_blank" rel="noopener">LingyuCoder/SkyRTC-demo: A simple demo used SkyRTC</a><br>åˆ«äººåšçš„ä¸€å¥—WebRTCç³»ç»Ÿï¼Œæ”¯æŒéŸ³è§†é¢‘ï¼Œæˆ¿é—´ï¼Œæ–‡ä»¶ä¼ è¾“ï¼Œåœ¨çº¿èŠå¤©ï¼Œäº†è§£WebRTCåå…¶å®å‘ç°ä¹Ÿæ²¡æœ‰ä»€ä¹ˆæŠ€æœ¯éš¾ç‚¹</li>
<li><a href="http://webrtc.org.cn/" target="_blank" rel="noopener">WebRTCä¸­æ–‡ç½‘-æœ€æƒå¨çš„RTCå®æ—¶é€šä¿¡å¹³å°</a><br>è¯´æ˜¯æƒå¨çš„ä¸­æ–‡ç½‘ï¼Œå…¶å®é‡Œé¢è®²çš„ç®—æ˜¯æ¯”è¾ƒç®€å•çš„ä¸œè¥¿ï¼Œè€Œä¸”åŸºæœ¬æ²¡æœ‰nativeçš„æ–‡ç« ã€‚ä¸€èˆ¬æ–‡ç« éƒ½æ˜¯è€å¤–çš„ç¿»è¯‘ï¼Œæœ‰æ—¶é—´å¯ä»¥ä¸Šå»çœ‹çœ‹ï¼Œè™½ç„¶ä¸€èˆ¬æ˜¯ç®€å•çš„ ä½†æ˜¯è¯´ä¸å®šæœ‰æ”¶è·å‘¢ã€‚</li>
<li><a href="http://www.html5rocks.com/en/tutorials/webrtc/basics/" target="_blank" rel="noopener">Getting Started with WebRTC - HTML5 Rocks</a><br>çœ‹æ ‡é¢˜å°±çŸ¥é“äº†ï¼Œå…¥é—¨å¿…å¤‡ï¼Œä¸è¿‡æ˜¯è‹±æ–‡çš„ï¼1.ä¸­æåˆ°çš„æ¨èæ–‡ç« é‡Œé¢æœ‰è¿™ä¸ª</li>
<li><a href="https://webrtc.org/" target="_blank" rel="noopener">WebRTC Home | WebRTC</a><br>å®˜ç½‘</li>
<li><a href="https://bloggeek.me/" target="_blank" rel="noopener">BlogGeek.me â€¢ The leading authority on WebRTCã€è€å¤–åšå®¢ã€‘</a><br>æœ‰å…³WebRTCçš„ï¼Œèµ„æ–™ä¼šæ¯”è¾ƒæ–°ã€‚</li>
<li><a href="https://w3c.github.io/mediacapture-main/getusermedia.html" target="_blank" rel="noopener">Media Capture and Streams</a><br>è®²è§£ä¸€äº›æ›´å…·ä½“çš„APIå‚æ•°ä»¥åŠç”¨æ³•ï¼Œæ”¶ç›Šä¸å¤§ï¼ŒAPIä½¿ç”¨å…¶ä»–æ–‡ç« éƒ½å¯ä»¥å­¦åˆ°</li>
<li><a href="http://www.blogjava.net/linli/archive/2014/10/21/418910.html" target="_blank" rel="noopener">æœ€ç®€å•çš„WebRTCç¤ºä¾‹ - ä¸æ€¥ä¸å¾ï¼ŒæŒä¹‹ä»¥æ’ã€‚ - BlogJava</a><br>demo,ä½œä¸ºå¿«é€Ÿæµ‹è¯•</li>
<li><a href="http://www.cnblogs.com/fangkm/category/670346.html" target="_blank" rel="noopener">WebRTCæ¨¡å—åˆ†æåšå®¢</a><br>nativeç‰ˆï¼Œå†™çš„ä¸é”™ï¼Œåšnativeå¼€å‘çš„å€¼å¾—çœ‹</li>
<li><a href="https://github.com/muaz-khan/WebRTC-Experiment" target="_blank" rel="noopener">WebRTCæºç åŠé¡¹ç›®</a></li>
<li><a href="https://tools.ietf.org/html/draft-alvestrand-constraints-resolution-00#page-6" target="_blank" rel="noopener">æ¥æ”¶éŸ³è§†é¢‘æµçš„å‚æ•°è®¾ç½®</a></li>
<li><a href="http://res.imtt.qq.com/qqbrowser_x5/h5/v8.0/h5_support.htm" target="_blank" rel="noopener">qqæµè§ˆå™¨å¯¹h5çš„æ”¯æŒç¨‹åº¦How well does x5 browser support HTML5?</a></li>
<li><a href="https://github.com/webrtc/samples" target="_blank" rel="noopener">WebRTC æµè§ˆå™¨ç«¯demoåŒ…æ‹¬æ ·å¼ æµè®°å½•ä¹‹ç±»çš„</a><br>å¤‡ç€ï¼Œä»¥ååº”è¯¥ä¼šç”¨åˆ°ã€‚</li>
<li><a href="http://www.tutorialspoint.com/webrtc/webrtc_mobile_support.htm" target="_blank" rel="noopener">WebRTC Mobile æ”¯æŒç¨‹åº¦</a><br>å¯ä»¥çœ‹ä¸‹</li>
<li><a href="https://github.com/GoogleChrome/chromium-webview-samples" target="_blank" rel="noopener">WebRTC åœ¨WebViewçš„ä½¿ç”¨ï¼Œå…¨å±ï¼Œè§¦æ‘¸äº‹ä»¶</a></li>
<li><a href="http://blog.csdn.net/nonmarking/article/details/46785197" target="_blank" rel="noopener">windowsä¸‹webrtcçš„ç¼–è¯‘ 2016 - å¼ æ™– - åšå®¢é¢‘é“ - CSDN.NET</a></li>
</ol>
<h2 id="native-2-browser"><a href="#native-2-browser" class="headerlink" title="native 2 browser"></a><strong>native 2 browser</strong></h2><ol>
<li><a href="http://stackoverflow.com/questions/17552333/is-it-possible-to-use-webrtc-to-streaming-video-from-server-to-client" target="_blank" rel="noopener">Is it possible to use WebRTC to streaming video from Server to Client? - Stack Overflow</a><br>å¯ä»¥çœ‹ä¸‹è®¨è®º</li>
<li><a href="https://groups.google.com/forum/#!msg/discuss-webrtc/Pdas21qohck/CCRZTxPx5esJ" target="_blank" rel="noopener">WebRTC Native c++ to web demo </a><br>çœ‹è®¨è®ºæˆåŠŸå€Ÿé‰´</li>
<li><a href="http://sourcey.com/webrtc-native-to-browser-video-streaming-example/" target="_blank" rel="noopener">WebRTC Native C++ to Browser</a><br>è¿˜æœªçœ‹ä»£ç ï¼Œå› ä¸ºè‡ªå·±å®ç°äº†</li>
</ol>
<!--more-->


<h1 id="RTMP"><a href="#RTMP" class="headerlink" title="RTMP"></a>RTMP</h1><ol>
<li><a href="http://blog.csdn.net/leixiaohua1020/article/details/15814587" target="_blank" rel="noopener">[æ€»ç»“]RTMPæµåª’ä½“æŠ€æœ¯é›¶åŸºç¡€å­¦ä¹ æ–¹æ³• [å†™çš„ä¸é”™ï¼]</a><br>é›·ç¥å‡ºå“ã€‚è¿™é‡Œè¯´ä¸‹é¢˜å¤–è¯ï¼Œæ„Ÿè°¢é›·ç¥å¯¹æµåª’ä½“åšå‡ºçš„è´¡çŒ®ï¼Œæ„¿å¤©å ‚æ²¡æœ‰ä»£ç ..</li>
<li><a href="http://www.wowza.com/resources/3.5.0/examples/LiveVideoStreaming/FlashRTMPPlayer/player.html" target="_blank" rel="noopener">rtmpåœ¨çº¿æµ‹è¯•æ’­æ”¾wowza</a><br>RTMPæµæµ‹è¯•æ’­æ”¾ï¼Œéšæ—¶å¯ç”¨ã€‚</li>
</ol>
<h1 id="ijkplayer-bilibiliå¼€æºé¡¹ç›®"><a href="#ijkplayer-bilibiliå¼€æºé¡¹ç›®" class="headerlink" title="ijkplayer[bilibiliå¼€æºé¡¹ç›®]"></a>ijkplayer[bilibiliå¼€æºé¡¹ç›®]</h1><ol>
<li>issueè®¨è®ºï¼ŒåŸºæœ¬æ˜¯å…³äºå»¶è¿Ÿé—®é¢˜<br><a href="https://github.com/Bilibili/ijkplayer/issues/1233" target="_blank" rel="noopener">Help with Buffering Settings Â· Issue #1233 Â· Bilibili/ijkplayer</a><br><a href="https://github.com/Bilibili/ijkplayer/blob/master/ijkmedia/ijkplayer/ff_ffplay_options.h#L114" target="_blank" rel="noopener">ijkplayer/ff_ffplay_options.h at master Â· Bilibili/ijkplayer</a><br><a href="https://github.com/Bilibili/ijkplayer/issues/1106" target="_blank" rel="noopener">Too big delay on start playing Â· Issue #1106 Â· Bilibili/ijkplayer</a><br><a href="https://github.com/Bilibili/ijkplayer/issues/210" target="_blank" rel="noopener">ijkplayeræ’­æ”¾rtmpç›´æ’­æµï¼Œå»¶è¿Ÿæ˜æ˜¾ Â· Issue #210 Â· Bilibili/ijkplayer</a><br>é‚£ä¹ˆå¦‚ä½•ç¼©å°å»¶è¿Ÿå‘¢ï¼Œ<br>ä¿®æ”¹ <code>\ijkplayer-android-demo\ijkplayer-java\src\main\java\tv\danmaku\ijk\media\player\IjkMediaPlayer.java</code><br>ä¸­<br><code>public void setDataSource(String path, Map&lt;String, String&gt; headers)</code>å‡½æ•°<br>åé¢æ·»åŠ ï¼š</li>
</ol>
<pre><code>Log.i(&quot;zjx&quot;,&quot;set packet-buffering&quot;);
setDataSource(path);
setOption(IjkMediaPlayer.OPT_CATEGORY_PLAYER, &quot;packet-buffering&quot;, 0);
setOption(IjkMediaPlayer.OPT_CATEGORY_FORMAT, &quot;fflags&quot;, &quot;nobuffer&quot;);
setOption(IjkMediaPlayer.OPT_CATEGORY_FORMAT, &quot;max-buffer-size&quot;, 512*1024);
setOption(IjkMediaPlayer.OPT_CATEGORY_PLAYER, &quot;min-frames&quot;, 5);
setOption(IjkMediaPlayer.OPT_CATEGORY_PLAYER, &quot;start-on-prepared&quot;, 1);
setOption(IjkMediaPlayer.OPT_CATEGORY_FORMAT, &quot;probsize&quot;, &quot;4096&quot;);
setOption(IjkMediaPlayer.OPT_CATEGORY_FORMAT, &quot;analyzeduration&quot;, &quot;2000000&quot;);</code></pre><p>å› ä¸ºijkmediaplayeré»˜è®¤æ˜¯ä½œä¸ºç‚¹æ’­æ’­æ”¾å™¨çš„ï¼Œæ‰€ä»¥bufferä¹‹ç±»çš„ä¼šå¼€çš„æ¯”è¾ƒå¤§ï¼Œç›´æ’­å°±è¦è¿›è¡Œç›¸åº”çš„è°ƒæ•´ã€‚æµ‹è¯•ç»“æœï¼Œå»¶è¿Ÿ&lt;200ms</p>
<ol start="2">
<li><p><a href="http://www.jianshu.com/p/8436c7353296" target="_blank" rel="noopener">ijkplayeråœ¨windowsä¸‹ç¼–è¯‘å¹¶å¯¼å…¥Android Studioã€æˆ‘å°±æ˜¯ç›´æ¥ç”¨çš„ä»–ç¼–è¯‘å¥½çš„é¡¹ç›®]</a></p>
</li>
<li><p><a href="http://www.jianshu.com/p/8436c7353296" target="_blank" rel="noopener">ijkplayerçš„å¼•å…¥&amp;ä»‹ç»&amp;ä½¿ç”¨/androidéŸ³è§†é¢‘ç‚¹/ç›´æ’­æ¨¡å—å¼€å‘ - ç®€ä¹¦</a><br>å¯ä»¥çœ‹ä¸‹</p>
</li>
</ol>
<h1 id="ffmpeg"><a href="#ffmpeg" class="headerlink" title="ffmpeg"></a>ffmpeg</h1><ol>
<li><a href="http://blog.csdn.net/leixiaohua1020/article/details/15811977" target="_blank" rel="noopener">[æ€»ç»“]FFMPEGè§†éŸ³é¢‘ç¼–è§£ç é›¶åŸºç¡€å­¦ä¹ æ–¹æ³• - é›·éœ„éª…(leixiaohua1020)çš„ä¸“æ  - åšå®¢é¢‘é“ - CSDN.NET</a><br>å¿…çœ‹</li>
<li><strong>å‘½ä»¤</strong><br><a href="https://ffmpeg.org/ffmpeg-devices.html#dshow" target="_blank" rel="noopener">FFmpeg Devices Documentation#dshow winé‡‡é›†å‘½ä»¤</a><br><a href="https://ffmpeg.org/ffmpeg-all.html#rtsp" target="_blank" rel="noopener">ffmpeg å‘é€æµåª’ä½“åˆ°rtsp/udp/rtmpç­‰ å‘½ä»¤</a><br><a href="http://www.cnblogs.com/wainiwann/p/4128154.html" target="_blank" rel="noopener">gdigrabæŠ“å±é‡‡é›†ï¼Œè§†é¢‘é‡‡é›†ç¼–ç rtmpåè®®å‘é€ å‘½ä»¤</a><br><a href="http://blog.csdn.net/leixiaohua1020/article/details/38284961" target="_blank" rel="noopener">FFmpegè·å–DirectShowè®¾å¤‡æ•°æ®ï¼ˆæ‘„åƒå¤´ï¼Œå½•å±ï¼‰</a><br>ã€audioè®¾å¤‡ä¹±ç çš„çœŸå®åå¯ä»¥çœ‹è¿™ç¯‡ï¼Œå…¶ä»–çš„å‘½ä»¤å’Œä¸Šé¢ä¹¦ç­¾éƒ½æœ‰é‡å¤ã€‘</li>
<li><a href="http://blog.csdn.net/leixiaohua1020/article/details/47008825" target="_blank" rel="noopener">æœ€ç®€å•çš„åŸºäºFFmpegçš„ç§»åŠ¨ç«¯ä¾‹å­ï¼šAndroid HelloWorld -</a><br>ã€æˆåŠŸè¿è¡Œæ˜¾ç¤ºæ•°æ®ï¼Œå¯ä»¥è‡ªå·±ç¼–soä¹Ÿå¯ä»¥ç›´æ¥ç”¨ä»–çš„ã€‘</li>
<li><a href="https://github.com/dxjia/ffmpeg-compile-shared-library-for-android" target="_blank" rel="noopener">ç§»æ¤ffmpegåˆ°androidï¼Œç¼–è¯‘å¯ç”¨äºjniè°ƒç”¨çš„soåº“.</a><br>ã€æœ‰å‚è€ƒï¼Œè‡ªå·±åˆå†™äº†ä¸€ç¯‡blogã€‘</li>
<li><a href="https://trac.ffmpeg.org/wiki/CompilationGuide/Ubuntu" target="_blank" rel="noopener">CompilationGuide/Ubuntu â€“ FFmpeg</a><br>ã€å¯ä»¥å‚è€ƒã€‘</li>
<li><a href="https://trac.ffmpeg.org/wiki/audio%20types" target="_blank" rel="noopener">audioç±»å‹ (PCM AAC)ï¼Œffmpegå‘½ä»¤é‡ŒæŒ‡å®špcmæ•°æ®æ—¶ç¼©å†™çš„å«ä¹‰</a></li>
<li><a href="http://blog.csdn.net/leixiaohua1020/article/details/43870599" target="_blank" rel="noopener">æœ€ç®€å•çš„è§†é¢‘ç½‘ç«™ï¼ˆJavaEE+FFmpegï¼‰</a><br>ã€æ–°æ‰‹å…¥é—¨ç¬¬ä¸€ä¸ªåº”ç”¨ï¼Œä¸è¿‡çœ‹çœ‹æ•ˆæœå°±å¥½äº†ï¼Œæ²¡ä»€ä¹ˆå­¦ä¹ çš„å¸®åŠ©ã€‘</li>
</ol>
<h1 id="vlc"><a href="#vlc" class="headerlink" title="vlc"></a>vlc</h1><ol>
<li><a href="http://blog.chinaunix.net/uid-20671208-id-3755470.html" target="_blank" rel="noopener">VLCæ’­æ”¾RTSPè§†é¢‘å»¶è¿Ÿé—®é¢˜-garfield_trump-ChinaUnixåšå®¢</a></li>
<li><a href="http://blog.csdn.net/banketree/article/details/39575973" target="_blank" rel="noopener">Vlc for Android å…¨é¢é˜è¿° - banketree - åšå®¢é¢‘é“ - CSDN.NET</a><br>ç”¨vlc for android çš„å¯ä»¥çœ‹ä¸‹è¿™ç¯‡ã€‚<h1 id="ç«å“åˆ†æ"><a href="#ç«å“åˆ†æ" class="headerlink" title="ç«å“åˆ†æ"></a>ç«å“åˆ†æ</h1>ç•¥<h1 id="éŸ³è§†é¢‘åŸºç¡€"><a href="#éŸ³è§†é¢‘åŸºç¡€" class="headerlink" title="éŸ³è§†é¢‘åŸºç¡€"></a>éŸ³è§†é¢‘åŸºç¡€</h1></li>
<li><a href="http://www.code06.com/other/aoshilang2249/92451.html" target="_blank" rel="noopener">éŸ³é¢‘ å±æ€§è¯¦è§£(æ¶‰åŠé‡‡æ ·ç‡ã€é€šé“æ•°ã€ä½æ•°ã€æ¯”ç‰¹ç‡ã€å¸§ç­‰) - code06ç½‘</a></li>
<li><a href="http://blog.csdn.net/leixiaohua1020/article/details/18893769" target="_blank" rel="noopener">[æ€»ç»“]è§†éŸ³é¢‘ç¼–è§£ç æŠ€æœ¯é›¶åŸºç¡€å­¦ä¹ æ–¹æ³• - é›·éœ„éª…(leixiaohua1020)çš„ä¸“æ  - åšå®¢é¢‘é“ - CSDN.NET</a><br>å¿…çœ‹ã€‚</li>
<li><a href="http://blog.jobbole.com/95862/" target="_blank" rel="noopener">è§†é¢‘ç¼–ç åŸç†ç®€ä»‹ - åšå®¢ - ä¼¯ä¹åœ¨çº¿</a><br>å’Œä¸‹é¢é›·é‚£è¿™ç¯‡æœ‰ç‚¹é‡äº†ï¼Œä¸è¿‡è¿™ç¯‡ä¹Ÿå¯ä»¥çœ‹ä¸‹ã€‚</li>
<li><a href="http://blog.csdn.net/flowingflying/article/month/2010/07" target="_blank" rel="noopener">ç¼–è§£ç æŠ€æœ¯ä»‹ç» æ„·é£ï¼ˆWeiï¼‰çš„ä¸“æ  - åšå®¢é¢‘é“ - CSDN.NET</a><br>å¯¹æ‰€æœ‰ç¼–ç ç®—æ³•å’Œå®¹å™¨çš„ä»‹ç»å§ï¼Œä¸ä»‹ç»åŸç†ï¼Œä¹Ÿä¸ä»‹ç»ç¼–ç æ ¼å¼ï¼Œåªä»‹ç»å†å²ä¹‹ç±»çš„ï¼Œä¸è¿‡æœ‰äº›ä¿¡æ¯ç™¾åº¦ä¸æ˜¯é‚£ä¹ˆå®¹æ˜“æ‰¾åˆ°ã€‚å¯çœ‹å¯ä¸çœ‹ã€‚</li>
<li><a href="http://blog.csdn.net/leixiaohua1020/article/details/28114081" target="_blank" rel="noopener">è§†é¢‘å‹ç¼©ç¼–ç å’ŒéŸ³é¢‘å‹ç¼©ç¼–ç çš„åŸºæœ¬åŸç† - é›·éœ„éª…(leixiaohua1020)çš„ä¸“æ  - åšå®¢é¢‘é“ - CSDN.NET</a><br>å¿…çœ‹</li>
<li><a href="http://blog.csdn.net/leixiaohua1020/article/details/17934487" target="_blank" rel="noopener">FLVå°è£…æ ¼å¼åˆ†æå™¨ - é›·éœ„éª…(leixiaohua1020)çš„ä¸“æ  - åšå®¢é¢‘é“ - CSDN.NET</a></li>
<li><a href="http://wenku.baidu.com/view/0de48034f111f18583d05a65.html" target="_blank" rel="noopener">aacç¼–ç ä»‹ç»_ç™¾åº¦æ–‡åº“</a></li>
</ol>
<h1 id="RED5"><a href="#RED5" class="headerlink" title="RED5"></a>RED5</h1><p>ä¸€å¼€å§‹æ¥è§¦ç›´æ’­æ—¶æœåŠ¡å™¨éƒ½æ˜¯ç”¨çš„RED5ã€å½“ç„¶ç°åœ¨åšrtmpå¼€å‘ä¸€èˆ¬ä¹Ÿè¿˜æ˜¯ç”¨çš„red5ã€‘</p>
<ol>
<li><a href="http://www.ibm.com/developerworks/cn/opensource/os-cn-Red5/" target="_blank" rel="noopener">åŸºäº Red5 çš„æµåª’ä½“æœåŠ¡å™¨çš„æ­å»ºå’Œåº”ç”¨</a><br>å…¶å®è¿™ç¯‡æˆ‘æ²¡ä»€ä¹ˆçœ‹</li>
<li><a href="http://blog.csdn.net/kinglong68/article/details/50848785" target="_blank" rel="noopener">Red5 Proé…ç½®åŠæµ‹è¯•</a><br>ã€Red5 Proä¼šæ¯”Red5æ›´å®¹æ˜“ä½¿ç”¨ã€‘</li>
<li><a href="http://blog.csdn.net/wk313753744/article/details/50458360" target="_blank" rel="noopener">ä½¿ç”¨red5å’ŒOBSæå‡ºè‡ªå·±çš„ç›´æ’­å¹³å°æ¥æŒ‘æˆ˜bilibili(Bç«™) - ä¸€åæ¸…å®˜ - åšå®¢é¢‘é“ - CSDN.NET</a><br>å¬åå­—å°±çŸ¥é“æ˜¯å…¥é—¨ç³»åˆ—ï¼Œä½œä¸ºå…¥é—¨æ¥è¯´æ˜¯æœ€å¥½çš„ã€‚</li>
<li><a href="https://www.red5pro.com/docs/server/red5prolive/" target="_blank" rel="noopener">Creating Your First Red5 Application - Red5 Pro</a><br>å®˜ç½‘æ•™ç¨‹ï¼Œå¯çœ‹å¯ä¸çœ‹ã€‚</li>
</ol>
<h1 id="EasyDarwin"><a href="#EasyDarwin" class="headerlink" title="EasyDarwin"></a>EasyDarwin</h1><p>å…¶å®è¿™å¥—äº§å“çœ‹ä¸Šå»ä¸é”™ï¼Œä½†æ˜¯æˆ‘æ²¡æœ‰ç”¨è¿‡ã€‚å› ä¸ºä¸ç¬¦åˆæˆ‘ä»¬çš„ä¸šåŠ¡</p>
<ol>
<li><a href="http://doc.easydarwin.org/EasyDarwin/README/" target="_blank" rel="noopener">EasyDarwin - EasyDarwinæ–‡æ¡£ä¸­å¿ƒ</a></li>
<li><a href="https://github.com/EasyDarwin/EasyDarwin" target="_blank" rel="noopener">EasyDarwin/EasyDarwin: OPENï¼šé«˜æ€§èƒ½å¼€æºæµåª’ä½“æœåŠ¡å™¨ï¼Œæ”¯æŒRTSPã€HLSã€HTTPç›´æ’­</a></li>
</ol>
<h1 id="SRS"><a href="#SRS" class="headerlink" title="SRS"></a>SRS</h1><p><a href="https://github.com/ossrs/srs/wiki/v2_CN_Home" target="_blank" rel="noopener">v2_CN_Home Â· ossrs/srs Wiki</a><br>è¿™å¥—æœåŠ¡å™¨çœ‹ä¸Šå»æ˜¯ä¸é”™çš„ï¼Œç‰¹åˆ«æ˜¯é‡Œé¢æœ‰æˆ‘æƒ³ç”¨çš„HTTP-FLVæ¨¡å—ã€‚<br>ä½†æ˜¯å®¢æˆ·ç«¯è¿™è¾¹ä»–æ˜¯ä¾èµ–äºflashæ¥åšè§£ç çš„ã€‚<br>æ‰€ä»¥åé¢æˆ‘å°±è§‰å¾—é‚£è¿˜æ˜¯å»WebSocketçš„æ–¹å¼å§ï¼Œæ•ˆæœä¹Ÿæ¯”è¾ƒå¯æ§ï¼Œæ¯”è¾ƒä»£ç ä¼šæ¯”è¾ƒäº†è§£ã€‚</p>
<h1 id="WebSocket"><a href="#WebSocket" class="headerlink" title="WebSocket"></a>WebSocket</h1><ol>
<li><a href="https://github.com/langhuihui/H5RtmpClient" target="_blank" rel="noopener">langhuihui/H5RtmpClient</a><br>å›½äººåšçš„ä¸€å¥—H5è§£å†³æ–¹æ¡ˆï¼Œç”±äºæºç æ¯«æ— æ–‡æ¡£ï¼ŒåŸºæœ¬ä¸èƒ½å€Ÿé‰´ï¼Œä¹Ÿæ²¡æœ‰è¿è¡ŒæˆåŠŸã€‚ç›®å‰æˆ‘æ­£å¾€è¿™æ–¹é¢å‰è¿›ã€‚</li>
<li><a href="https://github.com/illuspas/Node-Media-Server" target="_blank" rel="noopener">illuspas/Node-Media-Server: A Node.js implementation of RTMP Server</a><br>NodeJSçš„rtmpæœåŠ¡å™¨ï¼Œåé¢éŸ³è§†é¢‘å°è£…åè®®çš„æ—¶å€™å¯ä»¥å‚è€ƒã€‚</li>
<li><a href="http://bbs.csdn.net/topics/391819855" target="_blank" rel="noopener">é€šè¿‡websocketæ¥æ”¶çš„éŸ³é¢‘æµï¼Œå¦‚ä½•ä½¿ç”¨audioæ ‡ç­¾æ’­æ”¾-</a><br>æµ‹è¯•MP3ä¸èƒ½æ’­æ”¾ æ–‡ä»¶æ ¼å¼å¤§å°ä»€ä¹ˆçš„éœ€è¦è€ƒè™‘</li>
<li><a href="http://my.oschina.net/langhuihui/blog" target="_blank" rel="noopener">ä½¿ç”¨JSå®ç°RTMPåè®®ç›´æ’­</a><br>åˆšåˆšè¯´çš„é‚£ä¸ªåšH5ç›´æ’­çš„å›½äººçš„åšå®¢ã€‚</li>
<li><a href="https://github.com/audiocogs/aurora.js/issues/48" target="_blank" rel="noopener">å‚è€ƒissue æˆåŠŸå®ç°AACæ’­æ”¾ . Â· Issue #48 Â· audiocogs/aurora.js</a></li>
<li><a href="https://github.com/audiocogs/aurora.js/wiki" target="_blank" rel="noopener">audiocogs/aurora.js Wiki ä¸€å¥—å®Œæ•´çš„éŸ³é¢‘è§£ç JS</a></li>
<li><a href="https://github.com/fabienbrooke/aurora-websocket" target="_blank" rel="noopener">aurora-websocketæ’ä»¶ WebSocket audio streaming plugin for aurora.js</a><h2 id="jsmpeg"><a href="#jsmpeg" class="headerlink" title="jsmpeg"></a>jsmpeg</h2>åˆ©ç”¨jsmpegè¿›è¡Œè§†é¢‘ç›´æ’­</li>
<li><a href="https://github.com/phoboslab/jsmpeg" target="_blank" rel="noopener">phoboslab/jsmpeg: MPEG1 Video Decoder in JavaScript</a><br>è¿™æ˜¯å…¶githubï¼Œç”¨æ³•ä»€ä¹ˆçš„å¯ä»¥åœ¨è¿™è¾¹çœ‹ã€‚</li>
<li><a href="https://imququ.com/post/html5-live-player-2.html" target="_blank" rel="noopener">HTML5 è§†é¢‘ç›´æ’­ï¼ˆäºŒï¼‰ | JerryQu çš„å°ç«™</a><br>ä»è¿™è¾¹çŸ¥é“æœ‰è¿™ä¹ˆä¸ªJS. è¿™ç¯‡æ–‡ç« ä¹Ÿæœ‰è®²æ€ä¹ˆç”¨ï¼Œé€šä¿—æ˜“æ‡‚ã€‚</li>
<li><a href="https://github.com/kevinschaul/jsmpeg/tree/feature/audio" target="_blank" rel="noopener">kevinschaul/jsmpeg at feature/audio</a><br>å…¶ä»–äººforkååšäº†ä¸€ä¸ªfeatureç‰ˆæœ¬ç”¨äºæ”¯æŒéŸ³é¢‘ç„¶è€Œã€ç”¨çš„httpè¯·æ±‚æ²¡ä»€ä¹ˆå‚è€ƒä»·å€¼ï¼Œåé¢è‡ªå·±å®ç°wsæ’­æ”¾PCMæˆåŠŸã€‘</li>
</ol>
<h1 id="å…¶ä»–æ–‡ç« "><a href="#å…¶ä»–æ–‡ç« " class="headerlink" title="å…¶ä»–æ–‡ç« "></a>å…¶ä»–æ–‡ç« </h1><ol>
<li><a href="http://blog.csdn.net/charleslei?viewmode=contents" target="_blank" rel="noopener">è§‚æ­¢äº‘ç›´æ’­ - åšå®¢é¢‘é“ - CSDN.NET</a><br>é‡Œé¢ä¼šä»‹ç»è§‚æ­¢äº‘ç›´æ’­çš„ä¸€äº›è§£å†³æ–¹æ¡ˆ</li>
<li><a href="http://www.infoq.com/cn/articles/alibaba-broadcast-platform-technology-challenges" target="_blank" rel="noopener">é–æˆ˜åŒåä¸€-é˜¿é‡Œç›´æ’­å¹³å°é¢ä¸´çš„æŠ€æœ¯æŒ‘æˆ˜</a><br>æ¯”è¾ƒè€ƒè™‘ä¸šåŠ¡ï¼Œå¦‚å®‰å…¨ã€å¼¹å¹•è¿™ç±»çš„ã€‚</li>
<li><a href="https://developer.android.com/guide/appendix/media-formats.html#network" target="_blank" rel="noopener">Android Media and Camera</a><br>åŸç”ŸAPIå¯¹æµåª’ä½“çš„æ”¯æŒç¨‹åº¦</li>
<li><a href="http://tech.lmtw.com/technews/201504/115637.html" target="_blank" rel="noopener">æ·±å…¥æµ…å‡ºçœ‹æµåª’ä½“å‰ä¸–ä»Šç”Ÿï¼Œåˆ†åˆ†é’ŸäºŒé€¼å˜ç‰›é€¼ - æŠ€æœ¯å¹³å° - æµåª’ä½“ç½‘</a><br>è®²çš„è¿˜å¯ä»¥ï¼Œèƒ½å¤Ÿç°æœ‰çš„æµåª’ä½“æŠ€æœ¯æœ‰ä¸ªå¤§ä½“çš„äº†è§£ã€‚</li>
</ol>
<h1 id="ä¸‹é¢æ˜¯æˆ‘åšæµåª’ä½“æŠ€æœ¯é€‰å‹æ—¶çš„ä¸€ä¸ªç®€å•æ•´ç†ã€‚"><a href="#ä¸‹é¢æ˜¯æˆ‘åšæµåª’ä½“æŠ€æœ¯é€‰å‹æ—¶çš„ä¸€ä¸ªç®€å•æ•´ç†ã€‚" class="headerlink" title="ä¸‹é¢æ˜¯æˆ‘åšæµåª’ä½“æŠ€æœ¯é€‰å‹æ—¶çš„ä¸€ä¸ªç®€å•æ•´ç†ã€‚"></a>ä¸‹é¢æ˜¯æˆ‘åšæµåª’ä½“æŠ€æœ¯é€‰å‹æ—¶çš„ä¸€ä¸ªç®€å•æ•´ç†ã€‚</h1><p>æŠ€æœ¯å’Œæ°´å¹³æœ‰é™ï¼Œæˆ‘ä¼šä¸æ–­æ›´æ–°çš„=ã€‚=<br>ä»¥ä¸‹è§£å†³æ–¹æ¡ˆéƒ½æ˜¯ä¸ä¼šè€ƒè™‘flashå’Œæµè§ˆå™¨æ’ä»¶çš„ã€‚</p>
<p>åŸç”Ÿå¼€å‘çš„è¯å¯ä»¥è€ƒè™‘ijkplayerï¼ŒåŸºäºffmpeg,ç¼–è¯‘å¯æ‹”æ’ï¼ŒåŸºæœ¬ä¸Šæ”¯æŒRTMPã€H264/AACçš„soåŒ…ä¸ä¼šè¶…è¿‡4M</p>
<table>
<thead>
<tr>
<th>æŠ€æœ¯é€‰å‹</th>
<th>æè¿°</th>
<th>å…¼å®¹æ€§</th>
<th>å¤‡æ³¨</th>
</tr>
</thead>
<tbody><tr>
<td>H5 WebSocket</td>
<td>åˆ©ç”¨JSè¿›è¡Œç¼–è§£ç (jsmpeg,aurora)ï¼Œç›®å‰æ²¡æœ‰å®Œæ•´çš„å•†ä¸šè§£å†³æ–¹æ¡ˆ</td>
<td>IEä¸æ”¯æŒï¼Œå…¶ä»–å¤§éƒ¨åˆ†æµè§ˆå™¨éƒ½æ”¯æŒ</td>
<td>æœ‰å‰æ™¯</td>
</tr>
<tr>
<td>Webæ— æ’ä»¶æ’­æ”¾RTSP</td>
<td>ç›®å‰åªæœ‰firefoxæ”¯æŒlive rtsp,å…¶ä»–æµè§ˆå™¨ä¸æ”¯æŒï¼›Android VideoViewæ”¯æŒrtspæ–‡ä»¶,ä¸æ”¯æŒrtspå®æ—¶æµ,å¯é‡‡ç”¨ijkplayer</td>
<td>ä»…firefox,å¹¶ä¸”æˆ‘æ²¡æœ‰æµ‹è¯•è¿‡</td>
<td>å¬è¯´è¿˜è¦å‡ºä¸€ä¸ªRTSP2æ ‡å‡†äº†</td>
</tr>
<tr>
<td>Webæ— æ’ä»¶æ’­æ”¾RTMP</td>
<td>Html5<video>æ ‡ç­¾ä¸æ”¯æŒRTMPï¼Œéœ€è¦flash player ã€‚Android VideoView ä¸æ”¯æŒrtmpï¼Œå¯é‡‡ç”¨ijkplayer</td>
<td>æ— é€‚ç”¨</td>
<td>video.jsä»ç„¶éœ€è¦flash</td>
</tr>
<tr>
<td>HLS</td>
<td>å»¶è¿Ÿè¾ƒå¤§ï¼Œé™ä½å»¶è¿Ÿå°†åŠ å¤§æœåŠ¡å™¨å‹åŠ›</td>
<td>å¤§éƒ¨åˆ†æµè§ˆå™¨æ”¯æŒï¼Œè‹¹æœå®Œå…¨æ”¯æŒï¼ŒAndroid 3.0+æ”¯æŒ[ç›´æ¥ç”¨VideoViewæ’­æ”¾]</td>
<td>æ— </td>
</tr>
<tr>
<td>WebRTC</td>
<td>å»¶è¿Ÿå°ï¼Œè·¨å¹³å°ï¼Œæœ‰å‰æ™¯ï¼Œä½†ç›®å‰æ”¯æŒçš„æµè§ˆå™¨ä¸å¤š</td>
<td>Chrome29+ã€ç«ç‹47+ã€Opera 39+æ”¯æŒIEå†…æ ¸çš„æµè§ˆå™¨ã€Edgeã€Safariä¸æ”¯æŒï¼›Chrome for Android ï¼Œfirefox for Androidæ”¯æŒï¼ŒAndroid WebView(5.0ä»¥ä¸Šæ”¯æŒï¼Œ4.4.3éƒ¨åˆ†æ‰‹æœº(samsung htcç­‰)æ”¯æŒ)ï¼Œæ‰‹æœºè‡ªå¸¦æµè§ˆå™¨(4.4.3ä»¥ä¸Šéƒ¨åˆ†å‚å•†æ”¯æŒ)ï¼ŒQQ/UC/ç™¾åº¦æµè§ˆå™¨ç›®å‰ä¸æ”¯æŒï¼ŒWPæ‰‹æœºä¸æ”¯æŒ(å¯ä»¥è€ƒè™‘åé¢å…¼å®¹ORTC)ï¼›è‹¹æœç”¨æˆ·è€ƒè™‘å®‰è£…chromeã€‚</td>
<td>æœ‰å‰æ™¯</td>
</tr>
<tr>
<td>HTTP+FLV</td>
<td>ç›®å‰ç›´æ’­æœ€ä¸»è¦çš„è§£å†³æ–¹æ¡ˆï¼Œå»¶è¿Ÿ&lt;2S,å…¶å®æœ‰ç‚¹ç±»ä¼¼WebSocket,HTTP+FLVæ˜¯å¯ä»¥ä¾èµ–äºflashçš„ï¼Œæ‰€ä»¥PCæ­£å¸¸æ’­æ”¾ï¼Œç§»åŠ¨Webçš„è¯ï¼Œæœ‰äººå¯¹å…¶è¿›è¡Œä¿®æ”¹ï¼Œä¼°è®¡ä¹Ÿæ˜¯è¿›è¡Œjsè§£ç äº†</td>
<td>åŸºæœ¬æ‰€æœ‰æµè§ˆå™¨</td>
<td>æœ‰å‰æ™¯</td>
</tr>
</tbody></table>
<h1 id="ä¹¦ç­¾JSONï¼š"><a href="#ä¹¦ç­¾JSONï¼š" class="headerlink" title="ä¹¦ç­¾JSONï¼š"></a>ä¹¦ç­¾JSONï¼š</h1><pre><code>{
    &quot;children&quot;: [
        {
            &quot;children&quot;: [
                {
                    &quot;date_added&quot;: &quot;13113462703329928&quot;,
                    &quot;id&quot;: &quot;491&quot;,
                    &quot;name&quot;: &quot;HTML5 è§†é¢‘ç›´æ’­ï¼ˆä¸‰ï¼‰ | JerryQu çš„å°ç«™&quot;,
                    &quot;sync_transaction_version&quot;: &quot;597&quot;,
                    &quot;type&quot;: &quot;url&quot;,
                    &quot;url&quot;: &quot;https://imququ.com/post/html5-live-player-3.html&quot;
                }, {
                    &quot;date_added&quot;: &quot;13113452866183134&quot;,
                    &quot;id&quot;: &quot;487&quot;,
                    &quot;name&quot;: &quot;LingyuCoder/SkyRTC-demo: A simple demo used SkyRTC&quot;,
                    &quot;sync_transaction_version&quot;: &quot;598&quot;,
                    &quot;type&quot;: &quot;url&quot;,
                    &quot;url&quot;: &quot;https://github.com/LingyuCoder/SkyRTC-demo&quot;
                }, {
                    &quot;date_added&quot;: &quot;13113454481787310&quot;,
                    &quot;id&quot;: &quot;488&quot;,
                    &quot;name&quot;: &quot;WebRTCä¸­æ–‡ç½‘-æœ€æƒå¨çš„RTCå®æ—¶é€šä¿¡å¹³å°&quot;,
                    &quot;sync_transaction_version&quot;: &quot;599&quot;,
                    &quot;type&quot;: &quot;url&quot;,
                    &quot;url&quot;: &quot;http://webrtc.org.cn/&quot;
                }, {
                    &quot;date_added&quot;: &quot;13113455763479783&quot;,
                    &quot;id&quot;: &quot;489&quot;,
                    &quot;name&quot;: &quot;Getting Started with WebRTC - HTML5 Rocks&quot;,
                    &quot;sync_transaction_version&quot;: &quot;600&quot;,
                    &quot;type&quot;: &quot;url&quot;,
                    &quot;url&quot;: &quot;http://www.html5rocks.com/en/tutorials/webrtc/basics/&quot;
                }, {
                    &quot;date_added&quot;: &quot;13113476654399248&quot;,
                    &quot;id&quot;: &quot;492&quot;,
                    &quot;name&quot;: &quot;WebRTC Home | WebRTC&quot;,
                    &quot;sync_transaction_version&quot;: &quot;603&quot;,
                    &quot;type&quot;: &quot;url&quot;,
                    &quot;url&quot;: &quot;https://webrtc.org/&quot;
                }, {
                    &quot;date_added&quot;: &quot;13113478543413919&quot;,
                    &quot;id&quot;: &quot;493&quot;,
                    &quot;name&quot;: &quot;WebRTC API - Web API æ¥å£ | MDN&quot;,
                    &quot;sync_transaction_version&quot;: &quot;606&quot;,
                    &quot;type&quot;: &quot;url&quot;,
                    &quot;url&quot;: &quot;https://developer.mozilla.org/zh-CN/docs/Web/API/WebRTC_API&quot;
                }, {
                    &quot;date_added&quot;: &quot;13113478554114551&quot;,
                    &quot;id&quot;: &quot;494&quot;,
                    &quot;name&quot;: &quot;WebRTC - Web é–‹ç™¼è€…æŒ‡å¼• | MDN&quot;,
                    &quot;sync_transaction_version&quot;: &quot;609&quot;,
                    &quot;type&quot;: &quot;url&quot;,
                    &quot;url&quot;: &quot;https://developer.mozilla.org/zh-TW/docs/Web/Guide/API/WebRTC&quot;
                }, {
                    &quot;date_added&quot;: &quot;13113478966534107&quot;,
                    &quot;id&quot;: &quot;495&quot;,
                    &quot;name&quot;: &quot;Media Capture and Streams&quot;,
                    &quot;sync_transaction_version&quot;: &quot;612&quot;,
                    &quot;type&quot;: &quot;url&quot;,
                    &quot;url&quot;: &quot;https://w3c.github.io/mediacapture-main/getusermedia.html&quot;
                }, {
                    &quot;date_added&quot;: &quot;13113479111074785&quot;,
                    &quot;id&quot;: &quot;496&quot;,
                    &quot;name&quot;: &quot;æœ€ç®€å•çš„WebRTCç¤ºä¾‹ - ä¸æ€¥ä¸å¾ï¼ŒæŒä¹‹ä»¥æ’ã€‚ - BlogJava&quot;,
                    &quot;sync_transaction_version&quot;: &quot;614&quot;,
                    &quot;type&quot;: &quot;url&quot;,
                    &quot;url&quot;: &quot;http://www.blogjava.net/linli/archive/2014/10/21/418910.html&quot;
                }, {
                    &quot;date_added&quot;: &quot;13113480530031815&quot;,
                    &quot;id&quot;: &quot;497&quot;,
                    &quot;name&quot;: &quot;WebRTCæ¨¡å—åˆ†æåšå®¢ å†™çš„ä¸é”™&quot;,
                    &quot;sync_transaction_version&quot;: &quot;830&quot;,
                    &quot;type&quot;: &quot;url&quot;,
                    &quot;url&quot;: &quot;http://www.cnblogs.com/fangkm/category/670346.html&quot;
                }, {
                    &quot;date_added&quot;: &quot;13114593439338259&quot;,
                    &quot;id&quot;: &quot;561&quot;,
                    &quot;name&quot;: &quot;WebRTCæºç åŠé¡¹ç›®&quot;,
                    &quot;sync_transaction_version&quot;: &quot;760&quot;,
                    &quot;type&quot;: &quot;url&quot;,
                    &quot;url&quot;: &quot;https://github.com/muaz-khan/WebRTC-Experiment&quot;
                }, {
                    &quot;date_added&quot;: &quot;13114661947006949&quot;,
                    &quot;id&quot;: &quot;568&quot;,
                    &quot;name&quot;: &quot;æ¥æ”¶éŸ³è§†é¢‘æµçš„å‚æ•°è®¾ç½®&quot;,
                    &quot;sync_transaction_version&quot;: &quot;774&quot;,
                    &quot;type&quot;: &quot;url&quot;,
                    &quot;url&quot;: &quot;https://tools.ietf.org/html/draft-alvestrand-constraints-resolution-00#page-6&quot;
                }, {
                    &quot;date_added&quot;: &quot;13114666836368586&quot;,
                    &quot;id&quot;: &quot;570&quot;,
                    &quot;name&quot;: &quot;qqæµè§ˆå™¨å¯¹h5çš„æ”¯æŒç¨‹åº¦How well does x5 browser support HTML5?&quot;,
                    &quot;sync_transaction_version&quot;: &quot;782&quot;,
                    &quot;type&quot;: &quot;url&quot;,
                    &quot;url&quot;: &quot;http://res.imtt.qq.com/qqbrowser_x5/h5/v8.0/h5_support.htm&quot;
                }, {
                    &quot;date_added&quot;: &quot;13114678478862750&quot;,
                    &quot;id&quot;: &quot;571&quot;,
                    &quot;name&quot;: &quot;WebRTC æµè§ˆå™¨ç«¯demoåŒ…æ‹¬æ ·å¼ æµè®°å½•ä¹‹ç±»çš„&quot;,
                    &quot;sync_transaction_version&quot;: &quot;786&quot;,
                    &quot;type&quot;: &quot;url&quot;,
                    &quot;url&quot;: &quot;https://github.com/webrtc/samples&quot;
                }, {
                    &quot;date_added&quot;: &quot;13113889282475314&quot;,
                    &quot;id&quot;: &quot;525&quot;,
                    &quot;name&quot;: &quot;Is it possible to use WebRTC to streaming video from Server to Client? - Stack Overflow&quot;,
                    &quot;sync_transaction_version&quot;: &quot;795&quot;,
                    &quot;type&quot;: &quot;url&quot;,
                    &quot;url&quot;: &quot;http://stackoverflow.com/questions/17552333/is-it-possible-to-use-webrtc-to-streaming-video-from-server-to-client&quot;
                }, {
                    &quot;date_added&quot;: &quot;13114517904945265&quot;,
                    &quot;id&quot;: &quot;558&quot;,
                    &quot;name&quot;: &quot;WebRTC Native c++ to web demo [çœ‹è®¨è®ºæˆåŠŸå€Ÿé‰´,&quot;,
                    &quot;sync_transaction_version&quot;: &quot;994&quot;,
                    &quot;type&quot;: &quot;url&quot;,
                    &quot;url&quot;: &quot;https://groups.google.com/forum/#!msg/discuss-webrtc/Pdas21qohck/CCRZTxPx5esJ&quot;
                }, {
                    &quot;date_added&quot;: &quot;13113650005578365&quot;,
                    &quot;id&quot;: &quot;509&quot;,
                    &quot;name&quot;: &quot;WebRTC Native C++ to Browser[è¿˜æœªçœ‹ä»£ç ï¼Œå› ä¸ºè‡ªå·±å®ç°äº†&quot;,
                    &quot;sync_transaction_version&quot;: &quot;841&quot;,
                    &quot;type&quot;: &quot;url&quot;,
                    &quot;url&quot;: &quot;http://sourcey.com/webrtc-native-to-browser-video-streaming-example/&quot;
                }, {
                    &quot;date_added&quot;: &quot;13114690596278212&quot;,
                    &quot;id&quot;: &quot;574&quot;,
                    &quot;name&quot;: &quot;WebRTC Mobile æ”¯æŒç¨‹åº¦&quot;,
                    &quot;sync_transaction_version&quot;: &quot;820&quot;,
                    &quot;type&quot;: &quot;url&quot;,
                    &quot;url&quot;: &quot;http://www.tutorialspoint.com/webrtc/webrtc_mobile_support.htm&quot;
                }, {
                    &quot;date_added&quot;: &quot;13114767584864111&quot;,
                    &quot;id&quot;: &quot;580&quot;,
                    &quot;name&quot;: &quot;WebRTC åœ¨WebViewçš„ä½¿ç”¨ï¼Œå…¨å±ï¼Œè§¦æ‘¸äº‹ä»¶&quot;,
                    &quot;sync_transaction_version&quot;: &quot;839&quot;,
                    &quot;type&quot;: &quot;url&quot;,
                    &quot;url&quot;: &quot;https://github.com/GoogleChrome/chromium-webview-samples&quot;
                }, {
                    &quot;date_added&quot;: &quot;13113643637152077&quot;,
                    &quot;id&quot;: &quot;506&quot;,
                    &quot;name&quot;: &quot;windowsä¸‹webrtcçš„ç¼–è¯‘ 2016 - å¼ æ™– - åšå®¢é¢‘é“ - CSDN.NET&quot;,
                    &quot;sync_transaction_version&quot;: &quot;995&quot;,
                    &quot;type&quot;: &quot;url&quot;,
                    &quot;url&quot;: &quot;http://blog.csdn.net/nonmarking/article/details/46785197&quot;
                }, {
                    &quot;date_added&quot;: &quot;13114855122833789&quot;,
                    &quot;id&quot;: &quot;594&quot;,
                    &quot;name&quot;: &quot;BlogGeek.me â€¢ The leading authority on WebRTCã€è€å¤–åšå®¢ã€‘&quot;,
                    &quot;sync_transaction_version&quot;: &quot;1059&quot;,
                    &quot;type&quot;: &quot;url&quot;,
                    &quot;url&quot;: &quot;https://bloggeek.me/&quot;
                }
            ],
            &quot;date_added&quot;: &quot;13113462686245057&quot;,
            &quot;date_modified&quot;: &quot;13115444886462470&quot;,
            &quot;id&quot;: &quot;490&quot;,
            &quot;name&quot;: &quot;WebRTC&quot;,
            &quot;sync_transaction_version&quot;: &quot;593&quot;,
            &quot;type&quot;: &quot;folder&quot;
        }, {
            &quot;children&quot;: [
                {
                    &quot;date_added&quot;: &quot;13112272435590549&quot;,
                    &quot;id&quot;: &quot;407&quot;,
                    &quot;name&quot;: &quot;[æ€»ç»“]RTMPæµåª’ä½“æŠ€æœ¯é›¶åŸºç¡€å­¦ä¹ æ–¹æ³• [å†™çš„ä¸é”™ï¼]&quot;,
                    &quot;sync_transaction_version&quot;: &quot;888&quot;,
                    &quot;type&quot;: &quot;url&quot;,
                    &quot;url&quot;: &quot;http://blog.csdn.net/leixiaohua1020/article/details/15814587&quot;
                }, {
                    &quot;date_added&quot;: &quot;13113653020038405&quot;,
                    &quot;id&quot;: &quot;510&quot;,
                    &quot;name&quot;: &quot;rtmpåœ¨çº¿æµ‹è¯•æ’­æ”¾wowza&quot;,
                    &quot;sync_transaction_version&quot;: &quot;904&quot;,
                    &quot;type&quot;: &quot;url&quot;,
                    &quot;url&quot;: &quot;http://www.wowza.com/resources/3.5.0/examples/LiveVideoStreaming/FlashRTMPPlayer/player.html&quot;
                }
            ],
            &quot;date_added&quot;: &quot;13111577706985142&quot;,
            &quot;date_modified&quot;: &quot;13114771844206771&quot;,
            &quot;id&quot;: &quot;16&quot;,
            &quot;name&quot;: &quot;RTMP[çº¯è®²è¿™ä¸ªçš„ï¼Œå¦åˆ™å°±å½’å…¥å…¶ä»–ç»„]&quot;,
            &quot;sync_transaction_version&quot;: &quot;881&quot;,
            &quot;type&quot;: &quot;folder&quot;
        }, {
            &quot;children&quot;: [
                {
                    &quot;date_added&quot;: &quot;13112782051707527&quot;,
                    &quot;id&quot;: &quot;439&quot;,
                    &quot;name&quot;: &quot;Help with Buffering Settings Â· Issue #1233 Â· Bilibili/ijkplayer&quot;,
                    &quot;sync_transaction_version&quot;: &quot;419&quot;,
                    &quot;type&quot;: &quot;url&quot;,
                    &quot;url&quot;: &quot;https://github.com/Bilibili/ijkplayer/issues/1233&quot;
                }, {
                    &quot;date_added&quot;: &quot;13112782057660261&quot;,
                    &quot;id&quot;: &quot;440&quot;,
                    &quot;name&quot;: &quot;ijkplayer/ff_ffplay_options.h at master Â· Bilibili/ijkplayer&quot;,
                    &quot;sync_transaction_version&quot;: &quot;422&quot;,
                    &quot;type&quot;: &quot;url&quot;,
                    &quot;url&quot;: &quot;https://github.com/Bilibili/ijkplayer/blob/master/ijkmedia/ijkplayer/ff_ffplay_options.h#L114&quot;
                }, {
                    &quot;date_added&quot;: &quot;13112782060979256&quot;,
                    &quot;id&quot;: &quot;441&quot;,
                    &quot;name&quot;: &quot;Too big delay on start playing Â· Issue #1106 Â· Bilibili/ijkplayer&quot;,
                    &quot;sync_transaction_version&quot;: &quot;425&quot;,
                    &quot;type&quot;: &quot;url&quot;,
                    &quot;url&quot;: &quot;https://github.com/Bilibili/ijkplayer/issues/1106&quot;
                }, {
                    &quot;date_added&quot;: &quot;13112782063899411&quot;,
                    &quot;id&quot;: &quot;442&quot;,
                    &quot;name&quot;: &quot;ijkplayeræ’­æ”¾rtmpç›´æ’­æµï¼Œå»¶è¿Ÿæ˜æ˜¾ Â· Issue #210 Â· Bilibili/ijkplayer&quot;,
                    &quot;sync_transaction_version&quot;: &quot;428&quot;,
                    &quot;type&quot;: &quot;url&quot;,
                    &quot;url&quot;: &quot;https://github.com/Bilibili/ijkplayer/issues/210&quot;
                }, {
                    &quot;date_added&quot;: &quot;13112762225311574&quot;,
                    &quot;id&quot;: &quot;435&quot;,
                    &quot;name&quot;: &quot;ijkplayeråœ¨windowsä¸‹ç¼–è¯‘å¹¶å¯¼å…¥Android Studioã€æˆ‘å°±æ˜¯ç›´æ¥ç”¨çš„ä»–ç¼–è¯‘å¥½çš„é¡¹ç›®]&quot;,
                    &quot;sync_transaction_version&quot;: &quot;885&quot;,
                    &quot;type&quot;: &quot;url&quot;,
                    &quot;url&quot;: &quot;http://blog.csdn.net/u010072711/article/details/51354834&quot;
                }, {
                    &quot;date_added&quot;: &quot;13112703447816808&quot;,
                    &quot;id&quot;: &quot;432&quot;,
                    &quot;name&quot;: &quot;ijkplayerçš„å¼•å…¥&amp;ä»‹ç»&amp;ä½¿ç”¨/androidéŸ³è§†é¢‘ç‚¹/ç›´æ’­æ¨¡å—å¼€å‘ - ç®€ä¹¦&quot;,
                    &quot;sync_transaction_version&quot;: &quot;879&quot;,
                    &quot;type&quot;: &quot;url&quot;,
                    &quot;url&quot;: &quot;http://www.jianshu.com/p/8436c7353296&quot;
                }
            ],
            &quot;date_added&quot;: &quot;13112782021507841&quot;,
            &quot;date_modified&quot;: &quot;13114770163783196&quot;,
            &quot;id&quot;: &quot;438&quot;,
            &quot;name&quot;: &quot;ijkplayer[bilibiliå¼€æºé¡¹ç›®]&quot;,
            &quot;sync_transaction_version&quot;: &quot;883&quot;,
            &quot;type&quot;: &quot;folder&quot;
        }, {
            &quot;children&quot;: [
                {
                    &quot;date_added&quot;: &quot;13112446245896420&quot;,
                    &quot;id&quot;: &quot;418&quot;,
                    &quot;name&quot;: &quot;[æ€»ç»“]FFMPEGè§†éŸ³é¢‘ç¼–è§£ç é›¶åŸºç¡€å­¦ä¹ æ–¹æ³• - é›·éœ„éª…(leixiaohua1020)çš„ä¸“æ  - åšå®¢é¢‘é“ - CSDN.NET&quot;,
                    &quot;sync_transaction_version&quot;: &quot;894&quot;,
                    &quot;type&quot;: &quot;url&quot;,
                    &quot;url&quot;: &quot;http://blog.csdn.net/leixiaohua1020/article/details/15811977&quot;
                }, {
                    &quot;date_added&quot;: &quot;13112033881317009&quot;,
                    &quot;id&quot;: &quot;385&quot;,
                    &quot;name&quot;: &quot;FFmpeg Devices Documentation#dshow winé‡‡é›†å‘½ä»¤&quot;,
                    &quot;sync_transaction_version&quot;: &quot;886&quot;,
                    &quot;type&quot;: &quot;url&quot;,
                    &quot;url&quot;: &quot;https://ffmpeg.org/ffmpeg-devices.html#dshow&quot;
                }, {
                    &quot;date_added&quot;: &quot;13112098376989131&quot;,
                    &quot;id&quot;: &quot;390&quot;,
                    &quot;name&quot;: &quot;ffmpeg å‘é€æµåª’ä½“åˆ°rtsp/udp/rtmpç­‰ å‘½ä»¤&quot;,
                    &quot;sync_transaction_version&quot;: &quot;892&quot;,
                    &quot;type&quot;: &quot;url&quot;,
                    &quot;url&quot;: &quot;https://ffmpeg.org/ffmpeg-all.html#rtsp&quot;
                }, {
                    &quot;date_added&quot;: &quot;13112355490224569&quot;,
                    &quot;id&quot;: &quot;411&quot;,
                    &quot;name&quot;: &quot;gdigrabæŠ“å±é‡‡é›†ï¼Œè§†é¢‘é‡‡é›†ç¼–ç rtmpåè®®å‘é€ å‘½ä»¤&quot;,
                    &quot;sync_transaction_version&quot;: &quot;893&quot;,
                    &quot;type&quot;: &quot;url&quot;,
                    &quot;url&quot;: &quot;http://www.cnblogs.com/wainiwann/p/4128154.html&quot;
                }, {
                    &quot;date_added&quot;: &quot;13112531655347495&quot;,
                    &quot;id&quot;: &quot;421&quot;,
                    &quot;name&quot;: &quot;æœ€ç®€å•çš„åŸºäºFFmpegçš„ç§»åŠ¨ç«¯ä¾‹å­ï¼šAndroid HelloWorld - ã€æˆåŠŸè¿è¡Œæ˜¾ç¤ºæ•°æ®ï¼Œå¯ä»¥è‡ªå·±ç¼–soä¹Ÿå¯ä»¥ç›´æ¥ç”¨ä»–çš„ã€‘&quot;,
                    &quot;sync_transaction_version&quot;: &quot;896&quot;,
                    &quot;type&quot;: &quot;url&quot;,
                    &quot;url&quot;: &quot;http://blog.csdn.net/leixiaohua1020/article/details/47008825&quot;
                }, {
                    &quot;date_added&quot;: &quot;13112625045047452&quot;,
                    &quot;id&quot;: &quot;425&quot;,
                    &quot;name&quot;: &quot;ç§»æ¤ffmpegåˆ°androidï¼Œç¼–è¯‘å¯ç”¨äºjniè°ƒç”¨çš„soåº“.ã€æœ‰å‚è€ƒï¼Œè‡ªå·±åˆå†™äº†ä¸€ç¯‡blogã€‘&quot;,
                    &quot;sync_transaction_version&quot;: &quot;897&quot;,
                    &quot;type&quot;: &quot;url&quot;,
                    &quot;url&quot;: &quot;https://github.com/dxjia/ffmpeg-compile-shared-library-for-android&quot;
                }, {
                    &quot;date_added&quot;: &quot;13112642530759864&quot;,
                    &quot;id&quot;: &quot;427&quot;,
                    &quot;name&quot;: &quot;CompilationGuide/Ubuntu â€“ FFmpegã€å¯ä»¥å‚è€ƒã€‘&quot;,
                    &quot;sync_transaction_version&quot;: &quot;899&quot;,
                    &quot;type&quot;: &quot;url&quot;,
                    &quot;url&quot;: &quot;https://trac.ffmpeg.org/wiki/CompilationGuide/Ubuntu&quot;
                }, {
                    &quot;date_added&quot;: &quot;13112876675250710&quot;,
                    &quot;id&quot;: &quot;451&quot;,
                    &quot;name&quot;: &quot;FFmpegè·å–DirectShowè®¾å¤‡æ•°æ®ï¼ˆæ‘„åƒå¤´ï¼Œå½•å±ï¼‰ã€audioè®¾å¤‡ä¹±ç çš„çœŸå®åå¯ä»¥çœ‹è¿™ç¯‡ï¼Œå…¶ä»–çš„å‘½ä»¤å’Œå…¶ä»–ä¹¦ç­¾éƒ½æœ‰é‡å¤ã€‘&quot;,
                    &quot;sync_transaction_version&quot;: &quot;895&quot;,
                    &quot;type&quot;: &quot;url&quot;,
                    &quot;url&quot;: &quot;http://blog.csdn.net/leixiaohua1020/article/details/38284961&quot;
                }, {
                    &quot;date_added&quot;: &quot;13113886157396632&quot;,
                    &quot;id&quot;: &quot;524&quot;,
                    &quot;name&quot;: &quot;audioç±»å‹ (PCM AAC)ï¼Œffmpegå‘½ä»¤é‡ŒæŒ‡å®špcmæ•°æ®æ—¶ç¼©å†™çš„å«ä¹‰&quot;,
                    &quot;sync_transaction_version&quot;: &quot;902&quot;,
                    &quot;type&quot;: &quot;url&quot;,
                    &quot;url&quot;: &quot;https://trac.ffmpeg.org/wiki/audio%20types&quot;
                }, {
                    &quot;date_added&quot;: &quot;13109230127960109&quot;,
                    &quot;id&quot;: &quot;355&quot;,
                    &quot;name&quot;: &quot;æœ€ç®€å•çš„è§†é¢‘ç½‘ç«™ï¼ˆJavaEE+FFmpegï¼‰ã€æ–°æ‰‹å…¥é—¨ç¬¬ä¸€ä¸ªåº”ç”¨ï¼Œä¸è¿‡çœ‹çœ‹æ•ˆæœå°±å¥½äº†ï¼Œæ²¡ä»€ä¹ˆå­¦ä¹ çš„å¸®åŠ©ã€‘&quot;,
                    &quot;sync_transaction_version&quot;: &quot;901&quot;,
                    &quot;type&quot;: &quot;url&quot;,
                    &quot;url&quot;: &quot;http://blog.csdn.net/leixiaohua1020/article/details/43870599&quot;
                }
            ],
            &quot;date_added&quot;: &quot;13113041308166155&quot;,
            &quot;date_modified&quot;: &quot;13116415773337933&quot;,
            &quot;id&quot;: &quot;462&quot;,
            &quot;name&quot;: &quot;ffmpeg&quot;,
            &quot;sync_transaction_version&quot;: &quot;491&quot;,
            &quot;type&quot;: &quot;folder&quot;
        }, {
            &quot;children&quot;: [
                {
                    &quot;date_added&quot;: &quot;13112030857137550&quot;,
                    &quot;id&quot;: &quot;382&quot;,
                    &quot;name&quot;: &quot;phoboslab/jsmpeg: MPEG1 Video Decoder in JavaScript&quot;,
                    &quot;sync_transaction_version&quot;: &quot;497&quot;,
                    &quot;type&quot;: &quot;url&quot;,
                    &quot;url&quot;: &quot;https://github.com/phoboslab/jsmpeg&quot;
                }, {
                    &quot;date_added&quot;: &quot;13112007882031863&quot;,
                    &quot;id&quot;: &quot;381&quot;,
                    &quot;name&quot;: &quot;HTML5 è§†é¢‘ç›´æ’­ï¼ˆäºŒï¼‰ | JerryQu çš„å°ç«™&quot;,
                    &quot;sync_transaction_version&quot;: &quot;498&quot;,
                    &quot;type&quot;: &quot;url&quot;,
                    &quot;url&quot;: &quot;https://imququ.com/post/html5-live-player-2.html&quot;
                }, {
                    &quot;date_added&quot;: &quot;13113044479616838&quot;,
                    &quot;id&quot;: &quot;467&quot;,
                    &quot;name&quot;: &quot;kevinschaul/jsmpeg at feature/audioã€ç”¨çš„httpè¯·æ±‚æ²¡ä»€ä¹ˆå‚è€ƒä»·å€¼ï¼Œåé¢è‡ªå·±å®ç°wsæ’­æ”¾PCMæˆåŠŸã€‘&quot;,
                    &quot;sync_transaction_version&quot;: &quot;906&quot;,
                    &quot;type&quot;: &quot;url&quot;,
                    &quot;url&quot;: &quot;https://github.com/kevinschaul/jsmpeg/tree/feature/audio&quot;
                }, {
                    &quot;date_added&quot;: &quot;13113043079921347&quot;,
                    &quot;id&quot;: &quot;466&quot;,
                    &quot;name&quot;: &quot;audiocogs/mp3.js: A JavaScript MP3 decoder for Aurora.js[è¿˜æ²¡ä½¿ç”¨]&quot;,
                    &quot;sync_transaction_version&quot;: &quot;907&quot;,
                    &quot;type&quot;: &quot;url&quot;,
                    &quot;url&quot;: &quot;https://github.com/audiocogs/mp3.js&quot;
                }
            ],
            &quot;date_added&quot;: &quot;13113041334403824&quot;,
            &quot;date_modified&quot;: &quot;13114691190080078&quot;,
            &quot;id&quot;: &quot;463&quot;,
            &quot;name&quot;: &quot;jsmpeg[mpegç¼–è§£ç å®ç°ç”»é¢ç›´æ’­]&quot;,
            &quot;sync_transaction_version&quot;: &quot;903&quot;,
            &quot;type&quot;: &quot;folder&quot;
        }, {
            &quot;children&quot;: [
                {
                    &quot;date_added&quot;: &quot;13111662621346305&quot;,
                    &quot;id&quot;: &quot;370&quot;,
                    &quot;name&quot;: &quot;Integrating mNectar using a Native Android SDK â€” mNectar Support documentation&quot;,
                    &quot;sync_transaction_version&quot;: &quot;504&quot;,
                    &quot;type&quot;: &quot;url&quot;,
                    &quot;url&quot;: &quot;http://support.mnectar.com/publishers/android/mnectarsdk/native.html&quot;
                }, {
                    &quot;date_added&quot;: &quot;13111668169618559&quot;,
                    &quot;id&quot;: &quot;373&quot;,
                    &quot;name&quot;: &quot;mNectar | Applications&quot;,
                    &quot;sync_transaction_version&quot;: &quot;505&quot;,
                    &quot;type&quot;: &quot;url&quot;,
                    &quot;url&quot;: &quot;https://pub.mnectar.com/v2/pm/apps&quot;
                }, {
                    &quot;date_added&quot;: &quot;13111665650703175&quot;,
                    &quot;id&quot;: &quot;372&quot;,
                    &quot;name&quot;: &quot;MRAIDæ‰©å±•åè®® - missyou ä¸“æ  - åšå®¢é¢‘é“ - CSDN.NET&quot;,
                    &quot;sync_transaction_version&quot;: &quot;506&quot;,
                    &quot;type&quot;: &quot;url&quot;,
                    &quot;url&quot;: &quot;http://blog.csdn.net/gaoqiv0447/article/details/46618365&quot;
                }, {
                    &quot;date_added&quot;: &quot;13111834536618303&quot;,
                    &quot;id&quot;: &quot;376&quot;,
                    &quot;name&quot;: &quot;GitHub - VMFive/adplay-web-sdk-demo&quot;,
                    &quot;sync_transaction_version&quot;: &quot;507&quot;,
                    &quot;type&quot;: &quot;url&quot;,
                    &quot;url&quot;: &quot;https://github.com/VMFive/adplay-web-sdk-demo&quot;
                }, {
                    &quot;date_added&quot;: &quot;13111834565183148&quot;,
                    &quot;id&quot;: &quot;377&quot;,
                    &quot;name&quot;: &quot;mnectarinc Â· GitHub&quot;,
                    &quot;sync_transaction_version&quot;: &quot;508&quot;,
                    &quot;type&quot;: &quot;url&quot;,
                    &quot;url&quot;: &quot;https://github.com/mnectarinc&quot;
                }, {
                    &quot;date_added&quot;: &quot;13112357464675332&quot;,
                    &quot;id&quot;: &quot;412&quot;,
                    &quot;name&quot;: &quot;SDKå°ï¼Œå•†ä¸šRTMP Client &quot;,
                    &quot;sync_transaction_version&quot;: &quot;522&quot;,
                    &quot;type&quot;: &quot;url&quot;,
                    &quot;url&quot;: &quot;http://www.nodemedia.cn/doc/%E7%AE%80%E4%BB%8B&quot;
                }, {
                    &quot;date_added&quot;: &quot;13113020499274967&quot;,
                    &quot;id&quot;: &quot;459&quot;,
                    &quot;name&quot;: &quot;å¸®åŠ©æ–‡æ¡£_å¼€æ”¾å¹³å°_å¤œç¥å®‰å“æ¨¡æ‹Ÿå™¨&quot;,
                    &quot;sync_transaction_version&quot;: &quot;908&quot;,
                    &quot;type&quot;: &quot;url&quot;,
                    &quot;url&quot;: &quot;http://dev.noxphone.com/application/doc?type=client&quot;
                }, {
                    &quot;date_added&quot;: &quot;13113021878734088&quot;,
                    &quot;id&quot;: &quot;460&quot;,
                    &quot;name&quot;: &quot;å¤œç¥å…¬å¸çš„js å¯å‚çœ‹&quot;,
                    &quot;sync_transaction_version&quot;: &quot;530&quot;,
                    &quot;type&quot;: &quot;url&quot;,
                    &quot;url&quot;: &quot;http://access.noxphone.com/js/NoxCloudPhone.min.js&quot;
                }
            ],
            &quot;date_added&quot;: &quot;13113041369785043&quot;,
            &quot;date_modified&quot;: &quot;13113043079921347&quot;,
            &quot;id&quot;: &quot;464&quot;,
            &quot;name&quot;: &quot;ç«å“&quot;,
            &quot;sync_transaction_version&quot;: &quot;503&quot;,
            &quot;type&quot;: &quot;folder&quot;
        }, {
            &quot;children&quot;: [
                {
                    &quot;date_added&quot;: &quot;13112076652281998&quot;,
                    &quot;id&quot;: &quot;388&quot;,
                    &quot;name&quot;: &quot;VLCæ’­æ”¾RTSPè§†é¢‘å»¶è¿Ÿé—®é¢˜-garfield_trump-ChinaUnixåšå®¢&quot;,
                    &quot;sync_transaction_version&quot;: &quot;514&quot;,
                    &quot;type&quot;: &quot;url&quot;,
                    &quot;url&quot;: &quot;http://blog.chinaunix.net/uid-20671208-id-3755470.html&quot;
                }, {
                    &quot;date_added&quot;: &quot;13109183062278069&quot;,
                    &quot;id&quot;: &quot;354&quot;,
                    &quot;name&quot;: &quot;Vlc for Android å…¨é¢é˜è¿° - banketree - åšå®¢é¢‘é“ - CSDN.NET&quot;,
                    &quot;sync_transaction_version&quot;: &quot;860&quot;,
                    &quot;type&quot;: &quot;url&quot;,
                    &quot;url&quot;: &quot;http://blog.csdn.net/banketree/article/details/39575973&quot;
                }
            ],
            &quot;date_added&quot;: &quot;13113041405405258&quot;,
            &quot;date_modified&quot;: &quot;13114769084905304&quot;,
            &quot;id&quot;: &quot;465&quot;,
            &quot;name&quot;: &quot;vlc&quot;,
            &quot;sync_transaction_version&quot;: &quot;513&quot;,
            &quot;type&quot;: &quot;folder&quot;
        }, {
            &quot;children&quot;: [
                {
                    &quot;date_added&quot;: &quot;13113884215111729&quot;,
                    &quot;id&quot;: &quot;523&quot;,
                    &quot;name&quot;: &quot;éŸ³é¢‘ å±æ€§è¯¦è§£(æ¶‰åŠé‡‡æ ·ç‡ã€é€šé“æ•°ã€ä½æ•°ã€æ¯”ç‰¹ç‡ã€å¸§ç­‰) - code06ç½‘&quot;,
                    &quot;sync_transaction_version&quot;: &quot;664&quot;,
                    &quot;type&quot;: &quot;url&quot;,
                    &quot;url&quot;: &quot;http://www.code06.com/other/aoshilang2249/92451.html&quot;
                }, {
                    &quot;date_added&quot;: &quot;13112444209807667&quot;,
                    &quot;id&quot;: &quot;417&quot;,
                    &quot;name&quot;: &quot;[æ€»ç»“]è§†éŸ³é¢‘ç¼–è§£ç æŠ€æœ¯é›¶åŸºç¡€å­¦ä¹ æ–¹æ³• - é›·éœ„éª…(leixiaohua1020)çš„ä¸“æ  - åšå®¢é¢‘é“ - CSDN.NET&quot;,
                    &quot;sync_transaction_version&quot;: &quot;880&quot;,
                    &quot;type&quot;: &quot;url&quot;,
                    &quot;url&quot;: &quot;http://blog.csdn.net/leixiaohua1020/article/details/18893769&quot;
                }, {
                    &quot;date_added&quot;: &quot;13101623361247230&quot;,
                    &quot;id&quot;: &quot;313&quot;,
                    &quot;name&quot;: &quot;è§†é¢‘ç¼–ç åŸç†ç®€ä»‹ - åšå®¢ - ä¼¯ä¹åœ¨çº¿&quot;,
                    &quot;sync_transaction_version&quot;: &quot;1002&quot;,
                    &quot;type&quot;: &quot;url&quot;,
                    &quot;url&quot;: &quot;http://blog.jobbole.com/95862/&quot;
                }, {
                    &quot;date_added&quot;: &quot;13115902958125694&quot;,
                    &quot;id&quot;: &quot;677&quot;,
                    &quot;name&quot;: &quot;ç¼–è§£ç æŠ€æœ¯ä»‹ç» æ„·é£ï¼ˆWeiï¼‰çš„ä¸“æ  - åšå®¢é¢‘é“ - CSDN.NET&quot;,
                    &quot;sync_transaction_version&quot;: &quot;1260&quot;,
                    &quot;type&quot;: &quot;url&quot;,
                    &quot;url&quot;: &quot;http://blog.csdn.net/flowingflying/article/month/2010/07&quot;
                }, {
                    &quot;date_added&quot;: &quot;13115962607276122&quot;,
                    &quot;id&quot;: &quot;680&quot;,
                    &quot;name&quot;: &quot;è§†é¢‘å‹ç¼©ç¼–ç å’ŒéŸ³é¢‘å‹ç¼©ç¼–ç çš„åŸºæœ¬åŸç† - é›·éœ„éª…(leixiaohua1020)çš„ä¸“æ  - åšå®¢é¢‘é“ - CSDN.NET&quot;,
                    &quot;sync_transaction_version&quot;: &quot;1263&quot;,
                    &quot;type&quot;: &quot;url&quot;,
                    &quot;url&quot;: &quot;http://blog.csdn.net/leixiaohua1020/article/details/28114081&quot;
                }, {
                    &quot;date_added&quot;: &quot;13115978781923325&quot;,
                    &quot;id&quot;: &quot;681&quot;,
                    &quot;name&quot;: &quot;FLVå°è£…æ ¼å¼åˆ†æå™¨ - é›·éœ„éª…(leixiaohua1020)çš„ä¸“æ  - åšå®¢é¢‘é“ - CSDN.NET&quot;,
                    &quot;sync_transaction_version&quot;: &quot;1267&quot;,
                    &quot;type&quot;: &quot;url&quot;,
                    &quot;url&quot;: &quot;http://blog.csdn.net/leixiaohua1020/article/details/17934487&quot;
                }, {
                    &quot;date_added&quot;: &quot;13116483060559062&quot;,
                    &quot;id&quot;: &quot;711&quot;,
                    &quot;name&quot;: &quot;aacç¼–ç ä»‹ç»_ç™¾åº¦æ–‡åº“&quot;,
                    &quot;sync_transaction_version&quot;: &quot;1354&quot;,
                    &quot;type&quot;: &quot;url&quot;,
                    &quot;url&quot;: &quot;http://wenku.baidu.com/view/0de48034f111f18583d05a65.html&quot;
                }
            ],
            &quot;date_added&quot;: &quot;13113884201796385&quot;,
            &quot;date_modified&quot;: &quot;13116483065958840&quot;,
            &quot;id&quot;: &quot;521&quot;,
            &quot;name&quot;: &quot;éŸ³è§†é¢‘åŸºç¡€&quot;,
            &quot;sync_transaction_version&quot;: &quot;662&quot;,
            &quot;type&quot;: &quot;folder&quot;
        }, {
            &quot;children&quot;: [
                {
                    &quot;date_added&quot;: &quot;13113218690999115&quot;,
                    &quot;id&quot;: &quot;473&quot;,
                    &quot;name&quot;: &quot;langhuihui/H5RtmpClient&quot;,
                    &quot;sync_transaction_version&quot;: &quot;791&quot;,
                    &quot;type&quot;: &quot;url&quot;,
                    &quot;url&quot;: &quot;https://github.com/langhuihui/H5RtmpClient&quot;
                }, {
                    &quot;date_added&quot;: &quot;13113219351831260&quot;,
                    &quot;id&quot;: &quot;474&quot;,
                    &quot;name&quot;: &quot;illuspas/Node-Media-Server: A Node.js implementation of RTMP Server&quot;,
                    &quot;sync_transaction_version&quot;: &quot;792&quot;,
                    &quot;type&quot;: &quot;url&quot;,
                    &quot;url&quot;: &quot;https://github.com/illuspas/Node-Media-Server&quot;
                }, {
                    &quot;date_added&quot;: &quot;13112963192356543&quot;,
                    &quot;id&quot;: &quot;454&quot;,
                    &quot;name&quot;: &quot;é€šè¿‡websocketæ¥æ”¶çš„éŸ³é¢‘æµï¼Œå¦‚ä½•ä½¿ç”¨audioæ ‡ç­¾æ’­æ”¾-æµ‹è¯•MP3ä¸èƒ½æ’­æ”¾ æ–‡ä»¶æ ¼å¼å¤§å°ä»€ä¹ˆçš„éœ€è¦è€ƒè™‘&quot;,
                    &quot;sync_transaction_version&quot;: &quot;1341&quot;,
                    &quot;type&quot;: &quot;url&quot;,
                    &quot;url&quot;: &quot;http://bbs.csdn.net/topics/391819855&quot;
                }, {
                    &quot;date_added&quot;: &quot;13113217892050897&quot;,
                    &quot;id&quot;: &quot;472&quot;,
                    &quot;name&quot;: &quot;ä½¿ç”¨JSå®ç°RTMPåè®®ç›´æ’­&quot;,
                    &quot;sync_transaction_version&quot;: &quot;806&quot;,
                    &quot;type&quot;: &quot;url&quot;,
                    &quot;url&quot;: &quot;http://my.oschina.net/langhuihui/blog&quot;
                }, {
                    &quot;date_added&quot;: &quot;13116414665452336&quot;,
                    &quot;id&quot;: &quot;706&quot;,
                    &quot;name&quot;: &quot;å‚è€ƒissue æˆåŠŸå®ç°AACæ’­æ”¾ . Â· Issue #48 Â· audiocogs/aurora.js&quot;,
                    &quot;sync_transaction_version&quot;: &quot;1337&quot;,
                    &quot;type&quot;: &quot;url&quot;,
                    &quot;url&quot;: &quot;https://github.com/audiocogs/aurora.js/issues/48&quot;
                }, {
                    &quot;date_added&quot;: &quot;13116394153581764&quot;,
                    &quot;id&quot;: &quot;702&quot;,
                    &quot;name&quot;: &quot;audiocogs/aurora.js Wiki ä¸€å¥—å®Œæ•´çš„éŸ³é¢‘è§£ç JS&quot;,
                    &quot;sync_transaction_version&quot;: &quot;1340&quot;,
                    &quot;type&quot;: &quot;url&quot;,
                    &quot;url&quot;: &quot;https://github.com/audiocogs/aurora.js/wiki&quot;
                }, {
                    &quot;date_added&quot;: &quot;13116480353611833&quot;,
                    &quot;id&quot;: &quot;710&quot;,
                    &quot;name&quot;: &quot;aurora-websocketæ’ä»¶ WebSocket audio streaming plugin for aurora.js&quot;,
                    &quot;sync_transaction_version&quot;: &quot;1350&quot;,
                    &quot;type&quot;: &quot;url&quot;,
                    &quot;url&quot;: &quot;https://github.com/fabienbrooke/aurora-websocket&quot;
                }
            ],
            &quot;date_added&quot;: &quot;13114683602955114&quot;,
            &quot;date_modified&quot;: &quot;13116483060559062&quot;,
            &quot;id&quot;: &quot;572&quot;,
            &quot;name&quot;: &quot;WebSocket&quot;,
            &quot;sync_transaction_version&quot;: &quot;797&quot;,
            &quot;type&quot;: &quot;folder&quot;
        }, {
            &quot;children&quot;: [],
            &quot;date_added&quot;: &quot;13114768048613751&quot;,
            &quot;date_modified&quot;: &quot;13114768196400213&quot;,
            &quot;id&quot;: &quot;581&quot;,
            &quot;name&quot;: &quot;HLS&quot;,
            &quot;sync_transaction_version&quot;: &quot;844&quot;,
            &quot;type&quot;: &quot;folder&quot;
        }, {
            &quot;children&quot;: [
                {
                    &quot;date_added&quot;: &quot;13109021383226132&quot;,
                    &quot;id&quot;: &quot;351&quot;,
                    &quot;name&quot;: &quot;åŸºäº Red5 çš„æµåª’ä½“æœåŠ¡å™¨çš„æ­å»ºå’Œåº”ç”¨&quot;,
                    &quot;sync_transaction_version&quot;: &quot;851&quot;,
                    &quot;type&quot;: &quot;url&quot;,
                    &quot;url&quot;: &quot;http://www.ibm.com/developerworks/cn/opensource/os-cn-Red5/&quot;
                }, {
                    &quot;date_added&quot;: &quot;13110289117401478&quot;,
                    &quot;id&quot;: &quot;362&quot;,
                    &quot;name&quot;: &quot;Red5 Proé…ç½®åŠæµ‹è¯•ã€Red5 Proä¼šæ¯”Red5æ›´å®¹æ˜“ä½¿ç”¨ã€‘&quot;,
                    &quot;sync_transaction_version&quot;: &quot;864&quot;,
                    &quot;type&quot;: &quot;url&quot;,
                    &quot;url&quot;: &quot;http://blog.csdn.net/kinglong68/article/details/50848785&quot;
                }, {
                    &quot;date_added&quot;: &quot;13114770064241261&quot;,
                    &quot;id&quot;: &quot;585&quot;,
                    &quot;name&quot;: &quot;ä½¿ç”¨red5å’ŒOBSæå‡ºè‡ªå·±çš„ç›´æ’­å¹³å°æ¥æŒ‘æˆ˜bilibili(Bç«™) - ä¸€åæ¸…å®˜ - åšå®¢é¢‘é“ - CSDN.NET&quot;,
                    &quot;sync_transaction_version&quot;: &quot;869&quot;,
                    &quot;type&quot;: &quot;url&quot;,
                    &quot;url&quot;: &quot;http://blog.csdn.net/wk313753744/article/details/50458360&quot;
                }, {
                    &quot;date_added&quot;: &quot;13110221725552373&quot;,
                    &quot;id&quot;: &quot;361&quot;,
                    &quot;name&quot;: &quot;Creating Your First Red5 Application - Red5 Pro&quot;,
                    &quot;sync_transaction_version&quot;: &quot;876&quot;,
                    &quot;type&quot;: &quot;url&quot;,
                    &quot;url&quot;: &quot;https://www.red5pro.com/docs/server/red5prolive/&quot;
                }
            ],
            &quot;date_added&quot;: &quot;13114768638797469&quot;,
            &quot;date_modified&quot;: &quot;13114770140782156&quot;,
            &quot;id&quot;: &quot;582&quot;,
            &quot;name&quot;: &quot;Red5&quot;,
            &quot;sync_transaction_version&quot;: &quot;850&quot;,
            &quot;type&quot;: &quot;folder&quot;
        }, {
            &quot;children&quot;: [
                {
                    &quot;date_added&quot;: &quot;13109022139149196&quot;,
                    &quot;id&quot;: &quot;353&quot;,
                    &quot;name&quot;: &quot;EasyDarwin - EasyDarwinæ–‡æ¡£ä¸­å¿ƒ&quot;,
                    &quot;sync_transaction_version&quot;: &quot;856&quot;,
                    &quot;type&quot;: &quot;url&quot;,
                    &quot;url&quot;: &quot;http://doc.easydarwin.org/EasyDarwin/README/&quot;
                }, {
                    &quot;date_added&quot;: &quot;13114768877093516&quot;,
                    &quot;id&quot;: &quot;584&quot;,
                    &quot;name&quot;: &quot;EasyDarwin/EasyDarwin: OPENï¼šé«˜æ€§èƒ½å¼€æºæµåª’ä½“æœåŠ¡å™¨ï¼Œæ”¯æŒRTSPã€HLSã€HTTPç›´æ’­&quot;,
                    &quot;sync_transaction_version&quot;: &quot;859&quot;,
                    &quot;type&quot;: &quot;url&quot;,
                    &quot;url&quot;: &quot;https://github.com/EasyDarwin/EasyDarwin&quot;
                }
            ],
            &quot;date_added&quot;: &quot;13114768850751352&quot;,
            &quot;date_modified&quot;: &quot;13114768877093516&quot;,
            &quot;id&quot;: &quot;583&quot;,
            &quot;name&quot;: &quot;EasyDarwin&quot;,
            &quot;sync_transaction_version&quot;: &quot;855&quot;,
            &quot;type&quot;: &quot;folder&quot;
        }, {
            &quot;children&quot;: [
                {
                    &quot;date_added&quot;: &quot;13116065354065376&quot;,
                    &quot;id&quot;: &quot;687&quot;,
                    &quot;name&quot;: &quot;v2_CN_Home Â· ossrs/srs Wiki&quot;,
                    &quot;sync_transaction_version&quot;: &quot;1320&quot;,
                    &quot;type&quot;: &quot;url&quot;,
                    &quot;url&quot;: &quot;https://github.com/ossrs/srs/wiki/v2_CN_Home&quot;
                }
            ],
            &quot;date_added&quot;: &quot;13116400435306683&quot;,
            &quot;date_modified&quot;: &quot;13116400435306897&quot;,
            &quot;id&quot;: &quot;704&quot;,
            &quot;name&quot;: &quot;SRS&quot;,
            &quot;sync_transaction_version&quot;: &quot;1322&quot;,
            &quot;type&quot;: &quot;folder&quot;
        }, {
            &quot;date_added&quot;: &quot;13115727320729413&quot;,
            &quot;id&quot;: &quot;657&quot;,
            &quot;name&quot;: &quot;è§‚æ­¢äº‘ç›´æ’­ - åšå®¢é¢‘é“ - CSDN.NET&quot;,
            &quot;sync_transaction_version&quot;: &quot;1171&quot;,
            &quot;type&quot;: &quot;url&quot;,
            &quot;url&quot;: &quot;http://blog.csdn.net/charleslei?viewmode=contents&quot;
        }, {
            &quot;date_added&quot;: &quot;13112163617867209&quot;,
            &quot;id&quot;: &quot;398&quot;,
            &quot;name&quot;: &quot;é–æˆ˜åŒåä¸€-é˜¿é‡Œç›´æ’­å¹³å°é¢ä¸´çš„æŠ€æœ¯æŒ‘æˆ˜&quot;,
            &quot;sync_transaction_version&quot;: &quot;1172&quot;,
            &quot;type&quot;: &quot;url&quot;,
            &quot;url&quot;: &quot;http://www.infoq.com/cn/articles/alibaba-broadcast-platform-technology-challenges&quot;
        }, {
            &quot;date_added&quot;: &quot;13112096770353514&quot;,
            &quot;id&quot;: &quot;389&quot;,
            &quot;name&quot;: &quot;Android Media and Camera åŸç”ŸAPIå¯¹æµåª’ä½“çš„æ”¯æŒç¨‹åº¦&quot;,
            &quot;sync_transaction_version&quot;: &quot;1173&quot;,
            &quot;type&quot;: &quot;url&quot;,
            &quot;url&quot;: &quot;https://developer.android.com/guide/appendix/media-formats.html#network&quot;
        }, {
            &quot;date_added&quot;: &quot;13116067904989673&quot;,
            &quot;id&quot;: &quot;688&quot;,
            &quot;name&quot;: &quot;æ·±å…¥æµ…å‡ºçœ‹æµåª’ä½“å‰ä¸–ä»Šç”Ÿï¼Œåˆ†åˆ†é’ŸäºŒé€¼å˜ç‰›é€¼ - æŠ€æœ¯å¹³å° - æµåª’ä½“ç½‘&quot;,
            &quot;sync_transaction_version&quot;: &quot;1286&quot;,
            &quot;type&quot;: &quot;url&quot;,
            &quot;url&quot;: &quot;http://tech.lmtw.com/technews/201504/115637.html&quot;
        }
    ],
    &quot;date_added&quot;: &quot;13111659536756641&quot;,
    &quot;date_modified&quot;: &quot;13116414650884522&quot;,
    &quot;id&quot;: &quot;369&quot;,
    &quot;name&quot;: &quot;ç›´æ’­&quot;,
    &quot;sync_transaction_version&quot;: &quot;588&quot;,
    &quot;type&quot;: &quot;folder&quot;
}</code></pre>]]></content>
      <categories>
        <category>æµåª’ä½“</category>
      </categories>
      <tags>
        <tag>WebRTC</tag>
        <tag>ffmpeg</tag>
      </tags>
  </entry>
  <entry>
    <title>H5éŸ³é¢‘ç›´æ’­â€”æ¢ç´¢å†ç¨‹ã€aurora.jsæºç è§£æã€éŸ³é¢‘ç¼–ç åŸºæœ¬åŸç†</title>
    <url>/2016/08/23/2016-2017%E7%9B%B4%E6%92%AD%E7%9B%B8%E5%85%B3/H5%E9%9F%B3%E9%A2%91%E7%9B%B4%E6%92%AD%E2%80%94%E6%8E%A2%E7%B4%A2%E5%8E%86%E7%A8%8B%E3%80%81aurora.js%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90%E3%80%81%E9%9F%B3%E9%A2%91%E7%BC%96%E7%A0%81%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86%20/</url>
    <content><![CDATA[<p>ä¸Šæ¬¡è®²è§£äº†H5çš„è§†é¢‘ç›´æ’­ï¼Œè¿™æ¬¡æˆ‘ä»¬è¦è®²çš„å°±æ˜¯H5çš„éŸ³é¢‘ç›´æ’­å•¦.æœ‰æ²¡æœ‰å¾ˆæœŸå¾…= =</p>
<p>ä¸‹é¢æ˜¯æˆ‘çš„æ¢ç´¢å†ç¨‹ï¼Œä¸æ„Ÿå…´è¶£çš„å¯ä»¥ç›´æ¥çœ‹æœ€åä¸€ä¸ªæ–¹æ¡ˆã€‚</p>
<h1 id="æ¢ç´¢å†ç¨‹"><a href="#æ¢ç´¢å†ç¨‹" class="headerlink" title="æ¢ç´¢å†ç¨‹"></a>æ¢ç´¢å†ç¨‹</h1><p>æ³¨ï¼šæœ¬æ–‡ä½¿ç”¨çš„Serveréƒ½æ˜¯nodejs,å¦‚æœä¸äº†è§£çš„è¯·å…ˆçœ‹ä¸‹åŸºç¡€æ•™ç¨‹</p>
<p>å¦å¤–ffmpegæ˜¯å¿…é¡»çš„ï¼Œä¸ä»…æ˜¯ç”¨æ¥æµ‹è¯•ï¼Œåšæµåª’ä½“å¼€å‘çš„åŸºæœ¬éƒ½è¦ä¼šç”¨è¿™ä¸ª</p>
<a id="more"></a>


<h2 id="PCMéŸ³é¢‘ç›´æ’­"><a href="#PCMéŸ³é¢‘ç›´æ’­" class="headerlink" title="PCMéŸ³é¢‘ç›´æ’­"></a>PCMéŸ³é¢‘ç›´æ’­</h2><p>æµç¨‹ï¼š</p>
<h3 id="1-Serverç«¯æ¥æ”¶ffmpegæ¨é€çš„PCMæµ-è¿™é‡Œæˆ‘ä»¬æŠŠMP3æ–‡ä»¶æ¨æˆPCMæµï¼Œå½“ç„¶è¾“å…¥æºä»»æ„"><a href="#1-Serverç«¯æ¥æ”¶ffmpegæ¨é€çš„PCMæµ-è¿™é‡Œæˆ‘ä»¬æŠŠMP3æ–‡ä»¶æ¨æˆPCMæµï¼Œå½“ç„¶è¾“å…¥æºä»»æ„" class="headerlink" title="1.Serverç«¯æ¥æ”¶ffmpegæ¨é€çš„PCMæµ(è¿™é‡Œæˆ‘ä»¬æŠŠMP3æ–‡ä»¶æ¨æˆPCMæµï¼Œå½“ç„¶è¾“å…¥æºä»»æ„"></a>1.Serverç«¯æ¥æ”¶ffmpegæ¨é€çš„PCMæµ(è¿™é‡Œæˆ‘ä»¬æŠŠMP3æ–‡ä»¶æ¨æˆPCMæµï¼Œå½“ç„¶è¾“å…¥æºä»»æ„</h3><p><strong>åšæ³•(1)</strong>:Serverå¼€å¯ä¸€ä¸ªç«¯å£å¦‚8088ï¼Œffmpegæ‰§è¡Œè¯¥å‘½ä»¤</p>
<pre><code>ffmpeg -re -i D://A.mp3 -ac 1 -f f32le http://localhost:8088</code></pre><p>å‚æ•°è§£æï¼š</p>
<blockquote>
<p><strong>-re</strong> ä»¥MP3çš„å®é™…å¸§ç‡å»è½¬ç è¾“å‡º å¦åˆ™å¾ˆå¿«å°±ä¼ è¾“å®Œäº†<br><strong>-ac channels</strong>   éŸ³é¢‘é€šé“æ•° è¿™è¾¹æŒ‡å®šä¸º1ï¼Œå¯¹åº”çš„webç«¯è§£ç æ—¶ä¹Ÿåº”è¯¥æŒ‡å®š(å› ä¸ºpcmæ˜¯è£¸æ•°æ®ï¼Œæ²¡æœ‰ä¼ è¾“éŸ³é¢‘å¤´æ¥åˆå§‹åŒ–<br><strong>-f f32le</strong>  è¾“å‡ºæ ¼å¼ï¼Œpcmçš„ PCM 32-bit floating-point little-endianï¼Œå¯¹åº”çš„webç«¯ä¹Ÿè¦æŒ‡å®šï¼Œåé¢ä¼šè®².æ›´å¤šæ ¼å¼è¯·å‚è€ƒ<a href="https://trac.ffmpeg.org/wiki/audio%20types" target="_blank" rel="noopener">è¿™é‡Œ</a></p>
</blockquote>
<p><strong>åšæ³•(2)</strong>:nodejsç›´æ¥åˆ©ç”¨å‘½åæŠŠè¾“å‡ºæµé€šè¿‡ç®¡é“è¾“å‡ºï¼Œstdoutç›‘å¬æ•°æ®ä¼ è¾“äº‹ä»¶<br>ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code>var child_process = require(&quot;child_process&quot;);
var ffmpeg = child_process.spawn(&quot;ffmpeg&quot;,[
    &quot;-re&quot;,&quot;-i&quot;,
    &quot;A.mp3&quot;,
    &quot;-ac&quot;,&quot;1&quot;,&quot;-f&quot;,
    &quot;f32le&quot;,
    &quot;pipe:1&quot;                     // Output to STDOUT
    ]);

 ffmpeg.stdout.on(&apos;data&apos;, function(data)
 {
    //å¤„ç†æ•°æ®.. å¦‚è¾“å‡ºåˆ°socket_client
 });</code></pre><p>WebSocketè·å–åˆ°éŸ³é¢‘æ•°æ®message</p>
<h3 id="2-serverå°†æ•°æ®è¾“å‡ºç»™socket-client"><a href="#2-serverå°†æ•°æ®è¾“å‡ºç»™socket-client" class="headerlink" title="2.serverå°†æ•°æ®è¾“å‡ºç»™socket_client."></a>2.serverå°†æ•°æ®è¾“å‡ºç»™socket_client.</h3><p>å½“ç„¶ï¼Œäº‹å…ˆè¦å…ˆå¼€å¯ç«¯å£è®©webç«¯è¿æ¥</p>
<pre><code>var ws = require(&apos;websocket.io&apos;), 
//WebSocket è¿æ¥3000ç«¯å£
server = ws.listen(3000);
server.on(&apos;connection&apos;, function (socket) 
{
    //å®šä¹‰å…¨å±€å˜é‡ä¿å­˜socket,åœ¨å¦å¼€å¯çš„ç›‘å¬æµåª’ä½“ç«¯å£å‡½æ•°ä¸­å°†æ•°æ®ä¼ ç»™socket
    //æˆ–è€…è¿™é‡Œä¸€è¿ä¸Šå°±ç”¨ä¸Šé¢çš„åšæ³•(2)ç›´æ¥æ¨æµç»™ä»–
    //ä¸¤ç§æ–¹æ¡ˆæŒ‰ç…§è‡ªå·±é€‰æ‹©
    console.log(&apos;New client connected&apos;);
}</code></pre><h3 id="æ–¹æ¡ˆ-2-å®Œæ•´ä»£ç "><a href="#æ–¹æ¡ˆ-2-å®Œæ•´ä»£ç " class="headerlink" title="æ–¹æ¡ˆ(2)å®Œæ•´ä»£ç "></a>æ–¹æ¡ˆ(2)å®Œæ•´ä»£ç </h3><pre><code>var ws = require(&apos;websocket.io&apos;), 
server = ws.listen(3000);
var child_process = require(&quot;child_process&quot;);
var i = 0;
server.on(&apos;connection&apos;, function (socket) 
{

console.log(&apos;New client connected&apos;);

var ffmpeg = child_process.spawn(&quot;ffmpeg&quot;,[
    &quot;-re&quot;,&quot;-i&quot;,
    &quot;A.mp3&quot;,
    &quot;-ac&quot;,&quot;1&quot;,&quot;-f&quot;,
    &quot;f32le&quot;,
    &quot;pipe:1&quot;                     // Output to STDOUT
    ]);

 ffmpeg.stdout.on(&apos;data&apos;, function(data)
 {
    var buff = new Buffer(data);
    //åšäº†base64ç¼–ç ï¼Œéå¿…è¦
    socket.send(buff.toString(&apos;base64&apos;));
 });
});</code></pre><h3 id="3-å®¢æˆ·ç«¯WebSocketè¿æ¥æ¥æ”¶æ•°æ®å¹¶å¤„ç†"><a href="#3-å®¢æˆ·ç«¯WebSocketè¿æ¥æ¥æ”¶æ•°æ®å¹¶å¤„ç†" class="headerlink" title="3.å®¢æˆ·ç«¯WebSocketè¿æ¥æ¥æ”¶æ•°æ®å¹¶å¤„ç†"></a>3.å®¢æˆ·ç«¯WebSocketè¿æ¥æ¥æ”¶æ•°æ®å¹¶å¤„ç†</h3><p>base64è§£ç å‡½æ•°ï¼š</p>
<pre><code>var base64EncodeChars = &quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;;
            var base64DecodeChars = new Array(-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 62, -1, -1, -1, 63, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, -1, -1, -1, -1, -1, -1, -1, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, -1, -1, -1, -1, -1, -1, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, -1, -1, -1, -1, -1);

            //base64è§£ç  
            function base64decode(str) {
                var c1, c2, c3, c4;
                var i, len, out;
                len = str.length;
                i = 0;
                out = &quot;&quot;;
                while(i &lt; len) {
                    /* c1 */
                    do {
                        c1 = base64DecodeChars[str.charCodeAt(i++) &amp; 0xff];
                    }
                    while (i &lt; len &amp;&amp; c1 == -1);
                    if(c1 == -1)
                        break;
                    /* c2 */
                    do {
                        c2 = base64DecodeChars[str.charCodeAt(i++) &amp; 0xff];
                    }
                    while (i &lt; len &amp;&amp; c2 == -1);
                    if(c2 == -1)
                        break;
                    out += String.fromCharCode((c1 &lt;&lt; 2) | ((c2 &amp; 0x30) &gt;&gt; 4));
                    /* c3 */
                    do {
                        c3 = str.charCodeAt(i++) &amp; 0xff;
                        if(c3 == 61)
                            return out;
                        c3 = base64DecodeChars[c3];
                    }
                    while (i &lt; len &amp;&amp; c3 == -1);
                    if(c3 == -1)
                        break;
                    out += String.fromCharCode(((c2 &amp; 0XF) &lt;&lt; 4) | ((c3 &amp; 0x3C) &gt;&gt; 2));
                    /* c4 */
                    do {
                        c4 = str.charCodeAt(i++) &amp; 0xff;
                        if(c4 == 61)
                            return out;
                        c4 = base64DecodeChars[c4];
                    }
                    while (i &lt; len &amp;&amp; c4 == -1);
                    if(c4 == -1)
                        break;
                    out += String.fromCharCode(((c3 &amp; 0x03) &lt;&lt; 6) | c4);
                }
                return out;
            }</code></pre><p>åˆå§‹åŒ–AudioContext</p>
<pre><code>var audio = document.querySelector(&apos;audio&apos;);
            window.AudioContext = window.AudioContext || window.webkitAudioContext;
            var context = new AudioContext();
            var audioBuffer = null;
            //var context = null;
            window.addEventListener(&apos;load&apos;, init, false);

            function init() {
                try {
                    context = new AudioContext();
                } catch(e) {
                    alert(&apos;Web Audio API is not supported in this browser&apos;);
                }
            }</code></pre><p>å°†base64è§£ç åçš„stringè½¬ä¸ºArrayBuffer</p>
<pre><code>function str2ab(str) {
                var buf = new ArrayBuffer(str.length); // 2 bytes for each char
                var bufView = new Uint8Array(buf);
                for(var i = 0, strLen = str.length; i &lt; strLen; i++) {
                    bufView[i] = str.charCodeAt(i);
                }
                return buf;
            }</code></pre><p>ç»§ç»­å°è£…ï¼Œä½œä¸ºcontextçš„æ•°æ®æº</p>
<pre><code>var d1 = str2ab(decs)
                var d2 = new DataView(d1);
                //PCMæµä¸ºf32æ ¼å¼
                var data = new Float32Array(d2.byteLength / Float32Array.BYTES_PER_ELEMENT);
                for(var jj = 0; jj &lt; data.length; ++jj) {
                    data[jj] = d2.getFloat32(jj * Float32Array.BYTES_PER_ELEMENT, true);
                }

                var audioBuffer = context.createBuffer(2, data.length, 44100);
                audioBuffer.getChannelData(0).set(data);

                var source = context.createBufferSource(); // creates a sound source
                source.buffer = audioBuffer;
                source.connect(context.destination); // connect the source to the context&apos;s destination (the speakers)
                source.start(0);</code></pre><p>å®¢æˆ·ç«¯å®Œæ•´ä»£ç </p>
<pre><code>&lt;!DOCTYPE html&gt;
&lt;html&gt;

    &lt;head&gt;
        &lt;meta name=&quot;viewport&quot; content=&quot;width=320, initial-scale=1&quot; /&gt;
        &lt;title&gt;jsmpeg streaming&lt;/title&gt;
        &lt;style type=&quot;text/css&quot;&gt;
            body {
                background: #333;
                text-align: center;
                margin-top: 10%;
            }

            #videoCanvas {
                /* Always stretch the canvas to 640x480, regardless of its
            internal size. */
                width: 640px;
                height: 480px;
            }
        &lt;/style&gt;
        &lt;script src=&apos;http://code.jquery.com/jquery-1.9.1.min.js&apos;&gt;&lt;/script&gt;
    &lt;/head&gt;

    &lt;body&gt;
        &lt;!-- The Canvas size specified here is the &quot;initial&quot; internal resolution. jsmpeg will
        change this internal resolution to whatever the source provides. The size the
        canvas is displayed on the website is dictated by the CSS style.
    --&gt;

        &lt;audio controls autoplay&gt;
            &lt;p&gt;
                Please use a browser that supports the Canvas Element, like
                &lt;a href=&quot;http://www.google.com/chrome&quot;&gt;Chrome&lt;/a&gt;,
                &lt;a href=&quot;http://www.mozilla.com/firefox/&quot;&gt;Firefox&lt;/a&gt;,
                &lt;a href=&quot;http://www.apple.com/safari/&quot;&gt;Safari&lt;/a&gt; or Internet Explorer 10
            &lt;/p&gt;
        &lt;/audio&gt;
        &lt;script type=&quot;text/javascript&quot;&gt;
            var base64EncodeChars = &quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;;
            var base64DecodeChars = new Array(-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 62, -1, -1, -1, 63, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, -1, -1, -1, -1, -1, -1, -1, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, -1, -1, -1, -1, -1, -1, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, -1, -1, -1, -1, -1);

            function base64decode(str) {
                var c1, c2, c3, c4;
                var i, len, out;
                len = str.length;
                i = 0;
                out = &quot;&quot;;
                while(i &lt; len) {
                    /* c1 */
                    do {
                        c1 = base64DecodeChars[str.charCodeAt(i++) &amp; 0xff];
                    }
                    while (i &lt; len &amp;&amp; c1 == -1);
                    if(c1 == -1)
                        break;
                    /* c2 */
                    do {
                        c2 = base64DecodeChars[str.charCodeAt(i++) &amp; 0xff];
                    }
                    while (i &lt; len &amp;&amp; c2 == -1);
                    if(c2 == -1)
                        break;
                    out += String.fromCharCode((c1 &lt;&lt; 2) | ((c2 &amp; 0x30) &gt;&gt; 4));
                    /* c3 */
                    do {
                        c3 = str.charCodeAt(i++) &amp; 0xff;
                        if(c3 == 61)
                            return out;
                        c3 = base64DecodeChars[c3];
                    }
                    while (i &lt; len &amp;&amp; c3 == -1);
                    if(c3 == -1)
                        break;
                    out += String.fromCharCode(((c2 &amp; 0XF) &lt;&lt; 4) | ((c3 &amp; 0x3C) &gt;&gt; 2));
                    /* c4 */
                    do {
                        c4 = str.charCodeAt(i++) &amp; 0xff;
                        if(c4 == 61)
                            return out;
                        c4 = base64DecodeChars[c4];
                    }
                    while (i &lt; len &amp;&amp; c4 == -1);
                    if(c4 == -1)
                        break;
                    out += String.fromCharCode(((c3 &amp; 0x03) &lt;&lt; 6) | c4);
                }
                return out;
            }

            var audio = document.querySelector(&apos;audio&apos;);
            window.AudioContext = window.AudioContext || window.webkitAudioContext;
            var context = new AudioContext();
            var audioBuffer = null;
            //var context = null;
            window.addEventListener(&apos;load&apos;, init, false);

            function init() {
                try {
                    context = new AudioContext();
                } catch(e) {
                    alert(&apos;Web Audio API is not supported in this browser&apos;);
                }
            }

            function str2ab(str) {
                var buf = new ArrayBuffer(str.length); // 2 bytes for each char
                var bufView = new Uint8Array(buf);
                for(var i = 0, strLen = str.length; i &lt; strLen; i++) {
                    bufView[i] = str.charCodeAt(i);
                }
                return buf;
            }
            var ws = new WebSocket(&quot;ws://localhost:3000/&quot;);
            //ws.binaryType = &quot;arraybuffer&quot;;
            ws.onmessage = function(message) {
                //console.log(message);
                var decs = base64decode(message.data);
                //var obj = new Uint8Array();
                //obj= decs.split(&quot;&quot;);
                console.log(decs);
                var d1 = str2ab(decs)
                var d2 = new DataView(d1);
                //PCMæµä¸ºf32æ ¼å¼
                var data = new Float32Array(d2.byteLength / Float32Array.BYTES_PER_ELEMENT);
                for(var jj = 0; jj &lt; data.length; ++jj) {
                    data[jj] = d2.getFloat32(jj * Float32Array.BYTES_PER_ELEMENT, true);
                }

                var audioBuffer = context.createBuffer(2, data.length, 44100);
                audioBuffer.getChannelData(0).set(data);

                var source = context.createBufferSource(); // creates a sound source
                source.buffer = audioBuffer;
                source.connect(context.destination); // connect the source to the context&apos;s destination (the speakers)
                source.start(0);
            };
        &lt;/script&gt;
    &lt;/body&gt;

&lt;/html&gt;</code></pre><h3 id="ä¼˜ç¼ºç‚¹"><a href="#ä¼˜ç¼ºç‚¹" class="headerlink" title="ä¼˜ç¼ºç‚¹"></a>ä¼˜ç¼ºç‚¹</h3><p>æ•°æ®é‡å¤ªå¤§ï¼Œä¸åˆ©äºç½‘ç»œä¼ è¾“ã€‚<br>å®ç°ç®€å•ï¼Œå½“ç„¶å¹¶æ²¡æœ‰ä»€ä¹ˆåµç”¨ï¼Œæƒå½“å­¦ä¹ ã€‚<br>å¯èƒ½å”¯ä¸€æœ‰ç”¨çš„å°±æ˜¯ç”±äºæœªå‹ç¼©ï¼ŒéŸ³é¢‘æ— æŸã€‚</p>
<h2 id="AAC-MP3-FLAC-ALAC-ç›´æ’­"><a href="#AAC-MP3-FLAC-ALAC-ç›´æ’­" class="headerlink" title="AAC/MP3/FLAC/ALAC ç›´æ’­"></a>AAC/MP3/FLAC/ALAC ç›´æ’­</h2><p>ä¸Šè¿°ç¼–ç æ ¼å¼å‹ç¼©ç‡é«˜ï¼Œé€‚åˆç½‘ç»œä¼ è¾“ã€‚<br>è‡ªå·±åšè§£ç è‚¯å®šæ˜¯ä¸é è°±çš„ï¼Œå½“ç„¶æˆ‘ä»¬åé¢å¯ä»¥å¯¹å…¶è¿›è¡Œå®šåˆ¶ï¼Œåè¯äº†ã€‚<br>ç½‘ä¸Šæ‰¾åˆ°äº†ä¸€ä¸ªjséŸ³é¢‘è§£ç æ¡†æ¶aurora.js<br><strong>github wiki:</strong><a href="https://github.com/audiocogs/aurora.js/wiki" target="_blank" rel="noopener">https://github.com/audiocogs/aurora.js/wiki</a><br>ä¸¥æ ¼æ„ä¹‰ä¸Šæ¥è¯´ï¼Œä»–åªæ˜¯ç”¨æ¥åˆå§‹åŒ–è§£ç å™¨å’ŒéŸ³é¢‘æ’­æ”¾çš„ã€‚<br>ä¼ è¾“è¿‡æ¥çš„éŸ³é¢‘æ•°æ®ï¼Œç¬¬ä¸€åŒ…ä¼šå¸¦æœ‰è¿™äº›éŸ³é¢‘ç¼–ç ä¿¡æ¯çš„æ•°æ®ï¼Œäº¤ç”±aurora.jså¤„ç†åï¼Œè¯†åˆ«æ˜¯å“ªä¸€ç§éŸ³é¢‘ç¼–ç æ ¼å¼åï¼Œå†è°ƒç”¨å…·ä½“çš„JSè§£ç å™¨å»åšè§£ç ï¼Œè§£ç åçš„æ•°æ®äº¤ç”±auroraå»æ¸²æŸ“ã€‚</p>
<p>æ³¨ï¼šJSè§£ç å™¨éœ€è¦å¦å¤–æ·»åŠ æ–‡ä»¶ï¼Œauroraä¸­å¹¶æ²¡æœ‰ï¼Œéœ€è¦è§£ä»€ä¹ˆæ•°æ®å°±å¼•å…¥ç›¸åº”çš„JSæ–‡ä»¶</p>
<blockquote>
<p>è¿™é‡Œæ˜¯ä½œè€…çš„<a href="https://github.com/audiocogs" target="_blank" rel="noopener">æ‰€æœ‰å·¥ç¨‹</a>ï¼Œé‡Œé¢éƒ½å¯ä»¥æ‰¾åˆ°srcæ–‡ä»¶ã€‚<br>å½“ç„¶ï¼Œå¦‚æœæƒ³ç›´æ¥ç”¨aac.js/mp3.jsç­‰ï¼Œå¯ä»¥çœ‹è¿™ä¸ª<a href="http://audiocogs.org/codecs/flac/" target="_blank" rel="noopener">demo</a>,å¤åˆ¶é‡Œé¢çš„jsæ–‡ä»¶å³å¯</p>
</blockquote>
<h3 id="å…ˆæ¥ä¸ªç”¨XHRè®¿é—®æœåŠ¡å™¨æ–‡ä»¶ï¼Œè¿›è¡Œè§£ç æ’­æ”¾çš„ã€‚"><a href="#å…ˆæ¥ä¸ªç”¨XHRè®¿é—®æœåŠ¡å™¨æ–‡ä»¶ï¼Œè¿›è¡Œè§£ç æ’­æ”¾çš„ã€‚" class="headerlink" title="å…ˆæ¥ä¸ªç”¨XHRè®¿é—®æœåŠ¡å™¨æ–‡ä»¶ï¼Œè¿›è¡Œè§£ç æ’­æ”¾çš„ã€‚"></a>å…ˆæ¥ä¸ªç”¨XHRè®¿é—®æœåŠ¡å™¨æ–‡ä»¶ï¼Œè¿›è¡Œè§£ç æ’­æ”¾çš„ã€‚</h3><p>å¾ˆç®€å•ï¼ŒæŠŠtest.aacæ–‡ä»¶æ”¾åˆ°HTTPæœåŠ¡å™¨ä¸‹<br>å®¢æˆ·ç«¯è¿™æ ·å†™å°±å¯ä»¥äº†</p>
<pre><code>&lt;!DOCTYPE html&gt;
&lt;html&gt;

    &lt;head&gt;
        &lt;meta charset=&quot;UTF-8&quot;&gt;
        &lt;title&gt;&lt;/title&gt;
        &lt;script src=&quot;aurora.js&quot;&gt;&lt;/script&gt;
        &lt;script src=&quot;aac.js&quot;&gt;&lt;/script&gt;
    &lt;/head&gt;

    &lt;body&gt;
        &lt;script&gt;
            var player = AV.Player.fromURL(&apos;http://localhost/testAAC/test.aac&apos;);
            player.play();
        &lt;/script&gt;

    &lt;/body&gt;

&lt;/html&gt;</code></pre><h3 id="ç”¨XHRçš„æ€ä¹ˆèƒ½ç®—æ˜¯ç›´æ’­å‘¢ï¼"><a href="#ç”¨XHRçš„æ€ä¹ˆèƒ½ç®—æ˜¯ç›´æ’­å‘¢ï¼" class="headerlink" title="ç”¨XHRçš„æ€ä¹ˆèƒ½ç®—æ˜¯ç›´æ’­å‘¢ï¼"></a>ç”¨XHRçš„æ€ä¹ˆèƒ½ç®—æ˜¯ç›´æ’­å‘¢ï¼</h3><p>æœ‰äººå¯¹auroraçš„æ•°æ®è·å–è¿‡ç¨‹åšäº†ä¸€ä¸ªä¿®æ”¹ï¼Œæ”¹ç”¨websocket<br>è§ï¼š<a href="https://github.com/fabienbrooke/aurora-websocket" target="_blank" rel="noopener">aurora-websocket</a></p>
<p>æµç¨‹ç›¸å¯¹ä¸Šé¢é‚£ä¸ªå¤æ‚ä¸€ç‚¹ç‚¹ã€‚<br>1.server:D:\nodejs\projects\aurora_ws_aac\server.js<br>ä»£ç åº”è¯¥å¾ˆå¥½æ‡‚ï¼Œæ˜¯live_pcmçš„ç¬¬ä¸€ç§åšæ³•<br>å¦‚ä¸‹ï¼š</p>
<pre><code>var http = require(&apos;http&apos;);
var connect = require(&apos;connect&apos;);
var ws = require(&apos;ws&apos;);

// Consume the ffmpeg audio stream
var audio_consumer = http.createServer( function(req, res) {
    console.log(&apos;Audio Stream Connected: &apos; + req.socket.remoteAddress);
    req.on(&apos;data&apos;, function(data){
        //When video data arrives, send to all the producer&apos;s clients
        for (var i in audio_producer.clients){
            audio_producer.clients[i].send(data, {binary:true});
        };
    });

    req.on(&apos;end&apos;, function () {
        res.end(&quot;Thanks&quot;);
    }); 

    req.on(&apos;error&apos;, function(e) {
        console.log(&quot;ERROR ERROR: &quot; + e.message);
    });
}).listen(8081, &quot;127.0.0.1&quot;);


var audio_producer = new ws.Server({port: 8071});
audio_producer.on(&apos;connection&apos;, function(socket) {

    console.log(&apos;Audio Client Connected&apos;); 

    socket.on(&apos;close&apos;, function(code, message){
        console.log( &apos;Disconnected Audio WebSocket (&apos;+audio_producer.clients.length+&apos; total)&apos; );
    });
});

console.log(&apos;Awaiting ws Audio Connections on http://127.0.0.1:8071/&apos;);</code></pre><p>8071ç«¯å£ç”¨äºè·å–ffmpegçš„æ¨æµ<strong><code>[audio_producer]</code></strong><br>8081ç«¯å£ç”¨äºé€šè¿‡websocketæ¨é€æ•°æ®ç»™Webç«¯<strong><code>[audio_consumer]</code></strong><br>Webç«¯ä¹Ÿæ˜¯å¾ˆç®€å•çš„ä»£ç ï¼š</p>
<pre><code>&lt;!DOCTYPE html&gt;
&lt;html&gt;

    &lt;head&gt;
        &lt;meta charset=&quot;UTF-8&quot;&gt;
        &lt;title&gt;&lt;/title&gt;
        &lt;script src=&quot;jquery-1.11.1.min.js&quot;&gt;&lt;/script&gt;
        &lt;script src=&quot;aurora.js&quot;&gt;&lt;/script&gt;
        &lt;script src=&quot;aac.js&quot;&gt;&lt;/script&gt;
        &lt;script src=&quot;aurora-websocket.min.js&quot;&gt;&lt;/script&gt;
        &lt;script type=&quot;text/javascript&quot;&gt;
            //&lt;![CDATA[
            $(document).ready(function() {
                var player=AV.Player.fromWebSocket(&apos;ws://localhost:8071&apos;);
                player.play();
            });
            //]]&gt;
        &lt;/script&gt;
    &lt;/head&gt;

    &lt;body&gt;
        &lt;!--&lt;script&gt;
            var player = AV.Player.fromURL(&apos;http://localhost/testAAC/test.aac&apos;);
            player.play();
        &lt;/script&gt;--&gt;

    &lt;/body&gt;

&lt;/html&gt;</code></pre><p>å¥½äº†ï¼Œç°åœ¨æˆ‘ä»¬å¼€å¯serverï¼ŒHTTPæœåŠ¡å™¨ï¼Œè®¿é—®<br><a href="http://localhost/testAAC/test.html" target="_blank" rel="noopener">http://localhost/testAAC/test.html</a> ã€‚<br>ç„¶åå†è¿›è¡Œffmpegæ¨æµ</p>
<pre><code>ffmpeg -re -i d://test.aac http://127.0.0.1:8081/a.aac</code></pre><p><strong>a.aacè§£é‡Šï¼š</strong><br>åæ­£è¦é€åˆ°8081ç«¯å£ï¼Œåé¢å¯ä»¥æŒ‡å®šä¸€ä¸ªa.aacï¼Œå¯ä»¥ç†è§£ä¸ºæ–‡ä»¶å®¹å™¨å§ã€‚<br>å¦åˆ™ç”±äºå‰é¢ä¸æŒ‡å®š-fï¼Œç›´æ¥é€åˆ°<a href="http://127.0.0.1:8081/ä¼šæŠ¥*`Invalid" target="_blank" rel="noopener">http://127.0.0.1:8081/ä¼šæŠ¥*`Invalid</a> argumenté”™è¯¯`*</p>
<h3 id="æµ‹è¯•ç»“æœï¼š"><a href="#æµ‹è¯•ç»“æœï¼š" class="headerlink" title="æµ‹è¯•ç»“æœï¼š"></a><strong>æµ‹è¯•ç»“æœï¼š</strong></h3><p>ffmpegä¸€è¿›è¡Œæ¨é€ï¼Œwebç«¯é©¬ä¸Šå°±å¯ä»¥æ’­æ”¾ã€‚</p>
<h3 id="ä¼˜ç‚¹ï¼š"><a href="#ä¼˜ç‚¹ï¼š" class="headerlink" title="ä¼˜ç‚¹ï¼š"></a><strong>ä¼˜ç‚¹ï¼š</strong></h3><p>éŸ³é¢‘å‹ç¼©ç‡é«˜ï¼Œè·¨å¹³å°ã€‚è¿™æ ·åº”è¯¥ç®—æ˜¯ç»å¯¹å¤§çš„ä¼˜åŠ¿äº†å§ã€‚</p>
<h3 id="å­˜åœ¨çš„é—®é¢˜åŠè§£å†³æ–¹æ¡ˆï¼š"><a href="#å­˜åœ¨çš„é—®é¢˜åŠè§£å†³æ–¹æ¡ˆï¼š" class="headerlink" title="å­˜åœ¨çš„é—®é¢˜åŠè§£å†³æ–¹æ¡ˆï¼š"></a><strong>å­˜åœ¨çš„é—®é¢˜åŠè§£å†³æ–¹æ¡ˆï¼š</strong></h3><p><strong>é—®é¢˜1:ä¸æ”¯æŒIE11ã€‚</strong><br>æè¿°ï¼šIE11è™½ç„¶æ”¯æŒWebSocket,ä½†æ˜¯ä¸æ”¯æŒWeb Audio APIã€‚æ‰€ä»¥ä¹Ÿå°±ä¸èƒ½é€šè¿‡AudioContextæ’­æ”¾è§£ç åçš„pcmæ•°æ®ã€‚<br><strong>è§£å†³æ–¹æ¡ˆï¼š</strong> IEåªå­˜åœ¨äºPCç«¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±æ²¡å¿…è¦ä¸€å®šç”¨H5çš„æ–¹æ¡ˆäº†ï¼Œå¯ä»¥ç›´æ¥ç”¨flashçš„è§£å†³æ–¹æ¡ˆï¼šrtmp</p>
<p><del>~ <strong>é—®é¢˜2ï¼šclientå¿…é¡»å…ˆè¿æ¥serverå†è¿›è¡Œæ¨æµï¼Œä¸æ˜¯å…ˆæ¨æµclientéšæ—¶è¿ä¸Šéƒ½å¯ä»¥æ’­æ”¾ã€‚</strong> ~</del><br><del>~ æè¿°ï¼šå…ˆè¿ä¸Šå†æ¨æµï¼Œæ˜¯ä¸ºäº†è·å–å‰å‡ åŒ…é‡Œé¢çš„æ•°æ®ç”¨æ¥åˆå§‹åŒ–è§£ç å™¨ã€‚å¦‚æœæ²¡æœ‰è·å–åˆ°çš„è¯ï¼Œä¼šè‡ªåŠ¨æŠ¥é”™ã€‚ç›®å‰æˆ‘ä»¬çš„åº”ç”¨åœºæ™¯æ˜¯åæ¨æµçš„ï¼Œæ‰€ä»¥è¿™ä¸ªé—®é¢˜å¯¹æˆ‘æ¥è¯´ä¸æ˜¯é—®é¢˜ã€‚å½“ç„¶è€ƒè™‘ä»¥åçš„æ‹“å±•ï¼Œæœ‰ä»¥ä¸‹è§£å†³æ–¹æ¡ˆã€‚</del><br><del>~ <strong>è§£å†³æ–¹æ¡ˆï¼š</strong> ~</del><br><del>(1)serverè·å–ffmpegæ¨æµçš„æ—¶å€™ï¼Œä¿å­˜å‰å‡ åŒ…æ•°æ®ã€å½“ç„¶è¿™è¾¹éœ€è¦äº†è§£ç¼–ç æ ¼å¼ã€‘åˆ°å†…å­˜ã€‚client connectè¿æ¥åï¼Œserveråˆ¤æ–­æ˜¯å¦ffmpegå·²ç»æ¨æµåˆ°serverè¿‡äº†ï¼Œæ¨æµè¿‡åˆ™è¡¥å‘ç¼–ç ä¿¡æ¯åŒ…ã€‚</del><br><del>(2)jsè¿™è¾¹åšä¸€ä¸ªé™å®šï¼Œå’Œlive_pcmä¸€æ ·ï¼Œç¼–ç ä¿¡æ¯éƒ½å›ºå®šå¥½ï¼Œè¿™æ ·å°±æ¯”è¾ƒæ²¡æœ‰å¯æ‹“å±•æ€§ã€‚</del><br>ã€20160825æ›´æ–°ã€‘</p>
<blockquote>
<p> aacç­‰ç¼–ç æœ‰åˆ†å¸¦å†…ä¼ è¾“è¿˜æ˜¯å¸¦å¤–ä¼ è¾“ã€‚<br><strong>å¸¦å†…ä¼ è¾“</strong>å°±æ˜¯æ¯ä¸€å¸§éƒ½ä¼šå¸¦æœ‰ç¼–ç ä¿¡æ¯ï¼Œé€‚åº”ç¼–ç ä¸æ–­ç¼–ç çš„æƒ…å†µï¼Œç›¸åº”æºå¸¦çš„æ•°æ®å°±ä¼šæ¯”è¾ƒå¤šï¼›<br><strong>å¸¦å¤–ä¼ è¾“</strong>ç¬¬ä¸€åŒ…å°±æŒ‡å®šäº†ç¼–ç ä¿¡æ¯ï¼Œåé¢çš„å¸§éƒ½æŒ‰è¿™ä¸ªç¼–ç ä¿¡æ¯æ¥ã€‚ä¸èƒ½é€‚åº”ç¼–ç ä¿®æ”¹æƒ…å†µï¼Œæœªå¤„ç†æƒ…å†µä¸‹ä¸èƒ½ä»æµä¸­é—´æ’­æ”¾ï¼Œç›¸åº”çš„æºå¸¦æ•°æ®ä¼šæ¯”è¾ƒå°‘ã€‚<br>å®éªŒæµ‹è¯•auroraéƒ½æ˜¯æ”¯æŒçš„ã€‚</p>
</blockquote>
<h1 id="aurora-jsæºç è§£æ"><a href="#aurora-jsæºç è§£æ" class="headerlink" title="aurora.jsæºç è§£æ"></a>aurora.jsæºç è§£æ</h1>]]></content>
      <categories>
        <category>æµåª’ä½“</category>
      </categories>
      <tags>
        <tag>HTML</tag>
      </tags>
  </entry>
  <entry>
    <title>H5è§†é¢‘ç›´æ’­â€”JSMPEGæºç è§£æã€è§†é¢‘å‹ç¼©ç¼–ç ã€MPEG-1æ ‡å‡†</title>
    <url>/2016/08/17/2016-2017%E7%9B%B4%E6%92%AD%E7%9B%B8%E5%85%B3/H5%E8%A7%86%E9%A2%91%E7%9B%B4%E6%92%AD%E2%80%94JSMPEG%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90%E3%80%81%E8%A7%86%E9%A2%91%E5%8E%8B%E7%BC%A9%E7%BC%96%E7%A0%81%E3%80%81MPEG-1%E6%A0%87%E5%87%86/</url>
    <content><![CDATA[<h1 id="jsmpegæ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#jsmpegæ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="jsmpegæ˜¯ä»€ä¹ˆï¼Ÿ"></a>jsmpegæ˜¯ä»€ä¹ˆï¼Ÿ</h1><pre><code>https://github.com/phoboslab/jsmpeg</code></pre><p>ä¸€ä¸ª<a href="http://baike.baidu.com/link?url=IdDNfUYYiss4iUee-J5RKHujDyCinU3pO07wdRGuMfEHw9Ih3OaoOHbCRwTuMT_ktsTwTgvniHVHVrmBZu3G8K" target="_blank" rel="noopener">mpeg-1</a> videoçš„jsè§£ç åº“</p>
<a id="more"></a>

<h1 id="jsmpegå¯ä»¥ç”¨æ¥å¹²ä»€ä¹ˆï¼Ÿ"><a href="#jsmpegå¯ä»¥ç”¨æ¥å¹²ä»€ä¹ˆï¼Ÿ" class="headerlink" title="jsmpegå¯ä»¥ç”¨æ¥å¹²ä»€ä¹ˆï¼Ÿ"></a>jsmpegå¯ä»¥ç”¨æ¥å¹²ä»€ä¹ˆï¼Ÿ</h1><p>åˆ©ç”¨ffmpegé‡‡é›†è§†é¢‘æºå¹¶æ¨é€åˆ°node.jsæœåŠ¡å™¨<br>nodejsåˆ©ç”¨wsæ¨¡å—*[åŸºäºtcp]*å°†æ•°æ®åŒ…è½¬å‘åˆ°ç½‘é¡µï¼Œåˆ©ç”¨è¯¥jsè¿›è¡Œè§£ç ï¼Œæä¾›canvasæ¸²æŸ“<br>æœ€åçš„æ•ˆæœå°±æ˜¯æµè§ˆå™¨èƒ½å¤Ÿå®æ—¶çœ‹åˆ°è§†é¢‘æºçš„æ•°æ®</p>
<blockquote>
<p>ä½¿ç”¨æ–¹æ³•è¯·å‚è€ƒgithub<br>æœ¬ç”µè„‘ä½¿ç”¨è®°å½•</p>
</blockquote>
<pre><code>1. cdåˆ°å¯¹åº”ç›®å½•D:\nodejs\projects\live_audio 
2. node stream-server.js ququ 9091 9092
3. ffmpeg -f dshow -i video=&quot;Integrated Webcam&quot;  -f mpeg1video -b 500k -r 20 -vf scale=640:360  http://localhost:9091/ququ/640/360</code></pre><h1 id="åº”ç”¨åœºæ™¯"><a href="#åº”ç”¨åœºæ™¯" class="headerlink" title="åº”ç”¨åœºæ™¯"></a>åº”ç”¨åœºæ™¯</h1><p>åŸºæœ¬ç›´æ’­åœºæ™¯éƒ½å¯ä»¥ç”¨åˆ°<strong>[æ³¨æ„æ˜¯åŸºäºtcpçš„]</strong><br>ä½†æ˜¯æ³¨æ„ï¼ï¼è¿™ä¸ªæ˜¯åªæœ‰è§†é¢‘ æ²¡æœ‰éŸ³é¢‘<br>PS:å…³äºéŸ³é¢‘ä»¥åŠåˆ©ç”¨æµåª’ä½“åè®®æˆ–å°è£…æ ¼å¼åšåŒæ­¥çš„ä¸‹ç¯‡æ–‡ç« ä¼šå†™åˆ°</p>
<!--more-->

<h1 id="mpeg-1-video-ç®€ä»‹"><a href="#mpeg-1-video-ç®€ä»‹" class="headerlink" title="mpeg-1 video ç®€ä»‹"></a>mpeg-1 video ç®€ä»‹</h1><blockquote>
<p>éšæœºè®¿é—®<br>çµæ´»çš„å¸§ç‡<code>ï¼ˆæœ€å¤§25å¸§/sï¼‰</code><br>å¯å˜çš„å›¾åƒå°ºå¯¸<code>(æœ€å¤§720*576)</code><br>å®šä¹‰äº†<code>I-å¸§</code>ã€<code>P-å¸§ï¼ˆå‚è€ƒä¹‹å‰çš„Iæˆ–Pï¼‰</code>å’Œ<code>B-å¸§ï¼ˆå‚è€ƒå‰åçš„Iæˆ–P å®æ—¶æµä¸ç”¨è¿™ä¸ªï¼‰</code><br>è¿åŠ¨è¡¥å¿å¯è·¨è¶Šå¤šä¸ªå¸§<br>åŠåƒç´ ç²¾åº¦çš„è¿åŠ¨å‘é‡ ã€é‡åŒ–çŸ©é˜µã€GOFç»“æ„ ã€sliceç»“æ„<br>ç‰ˆæƒï¼šfree</p>
</blockquote>
<p><strong>æ»¡è¶³å¤šè¾¾16è·¯ä»¥ä¸Š25å¸§/ç§’çš„å‹ç¼©é€Ÿåº¦ï¼Œåœ¨500kbit/sçš„å‹ç¼©ç æµå’Œ352åƒç´ Ã—288è¡Œçš„æ¸…æ™°åº¦ä¸‹ï¼Œæ¯å¸§å¤§å°ä»…ä¸º2k</strong></p>
<h1 id="mpeg-1-video-ç¼–ç ç®€ä»‹"><a href="#mpeg-1-video-ç¼–ç ç®€ä»‹" class="headerlink" title="mpeg-1 video ç¼–ç ç®€ä»‹"></a>mpeg-1 video ç¼–ç ç®€ä»‹</h1><p>è¿™è¾¹åªæ˜¯è¯´ä¸€ä¸‹ç®€å•çš„åšæ³•ï¼Œæˆ–è€…è¯´æ˜¯è§†é¢‘ç¼–ç çš„åŸºæœ¬åšæ³• å¿½ç•¥äº†å¾ˆå¤šç»†èŠ‚..<br>h164å’Œmpeg1éƒ½æ˜¯åœ¨æ­¤åŸºç¡€ä¸Šè¿›è¡Œæ”¹è¿›çš„</p>
<p>å‚è€ƒ</p>
<blockquote>
<p><a href="http://blog.jobbole.com/95862/" target="_blank" rel="noopener">http://blog.jobbole.com/95862/</a><br><a href="http://blog.csdn.net/leixiaohua1020/article/details/28114081" target="_blank" rel="noopener">http://blog.csdn.net/leixiaohua1020/article/details/28114081</a></p>
</blockquote>
<h2 id="ï¼ˆ1ï¼‰Iå¸§-I-frames"><a href="#ï¼ˆ1ï¼‰Iå¸§-I-frames" class="headerlink" title="ï¼ˆ1ï¼‰Iå¸§(I-frames)"></a>ï¼ˆ1ï¼‰Iå¸§(I-frames)</h2><p>ä¸ä¾èµ–äºå…¶ä»–è§†é¢‘å¸§<br>å¸§å†…å‹ç¼©ï¼Œjpegç¼–ç æŠ€æœ¯,é‡‡ç”¨ç¦»æ•£ä½™å¼¦å˜æ¢DCTçš„å‹ç¼©æŠ€æœ¯ï¼ŒGOP(å¸§ç»„)çš„ç¬¬ä¸€å¸§ä¸”ä¸€ç»„åªæœ‰ä¸€ä¸ªIå¸§ï¼Œä¸è€ƒè™‘è¿åŠ¨çŸ¢é‡</p>
<h3 id="å˜æ¢ç¼–ç -äºŒç»´DCT"><a href="#å˜æ¢ç¼–ç -äºŒç»´DCT" class="headerlink" title="å˜æ¢ç¼–ç -äºŒç»´DCT"></a>å˜æ¢ç¼–ç -äºŒç»´DCT</h3><ol>
<li>å‡è®¾ä¸€å¸§å›¾åƒçš„å¤§å°ä¸º1280 * 720ï¼Œé¦–å…ˆå°†å…¶ä»¥ç½‘æ ¼çŠ¶çš„å½¢å¼åˆ†æˆ160 * 90ä¸ªå°ºå¯¸ä¸º8 * 8çš„å½¼æ­¤æ²¡æœ‰é‡å çš„å›¾åƒå—</li>
<li>æ¯ä¸ª8 * 8ç‚¹çš„å›¾åƒå—è¢«é€å…¥DCTç¼–ç å™¨ï¼Œå°†8 * 8çš„å›¾åƒå—ä»ç©ºé—´åŸŸå˜æ¢ä¸ºé¢‘ç‡åŸŸ</li>
<li>ä¸€ä¸ªå®é™…8*8å›¾åƒå—[äº®åº¦å€¼] ç›¸é‚»åƒç´ äº®åº¦å€¼å·®è·ä¸å¤§<br><img src="http://img.blog.csdn.net/20140602173641875?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGVpeGlhb2h1YTEwMjA=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="è¯·è¾“å…¥å›¾ç‰‡æè¿°">  </li>
<li>å›¾åƒå—ç»è¿‡DCTå˜æ¢åçš„ç³»æ•°<br><img src="http://img.blog.csdn.net/20140602173658734?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGVpeGlhb2h1YTEwMjA=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="å›¾åƒå—ç»è¿‡DCTå˜æ¢åçš„ç³»æ•°"></li>
</ol>
<p>ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œå·¦ä¸Šè§’(ä½é¢‘ç³»æ•°)é›†ä¸­å¤§é‡èƒ½é‡ï¼Œå³ä¸‹è§’(é«˜é¢‘ç³»æ•°)èƒ½é‡å°</p>
<ol start="5">
<li>é‡åŒ–-æœ‰æŸå‹ç¼©ã€‚äººçœ¼å¯¹ä½é¢‘æ•æ„Ÿå¯¹é«˜é¢‘ä¸æ•æ„Ÿï¼Œæ•…å¯¹ä½é¢‘åŒºçš„ç³»æ•°è¿›è¡Œç»†é‡åŒ–ï¼Œé«˜é¢‘åŒºçš„ç³»æ•°è¿›è¡Œç²—é‡åŒ–ã€‚<br><strong>é‡åŒ–å…¬å¼</strong>ï¼š<img src="http://img.blog.csdn.net/20140602173713140?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGVpeGlhb2h1YTEwMjA=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="è¯·è¾“å…¥å›¾ç‰‡æè¿°"></li>
</ol>
<p>å…¶ä¸­<code>FQï¼ˆu,vï¼‰</code>è¡¨ç¤ºç»è¿‡é‡åŒ–åçš„DCTç³»æ•°ï¼›<br><code>Fï¼ˆu,vï¼‰</code>è¡¨ç¤ºé‡åŒ–å‰çš„DCTç³»æ•°ï¼›<br><code>Qï¼ˆu,vï¼‰</code>è¡¨ç¤ºé‡åŒ–åŠ æƒçŸ©é˜µï¼›<br><code>q</code>è¡¨ç¤ºé‡åŒ–æ­¥é•¿ï¼›<br><code>round</code>è¡¨ç¤ºå½’æ•´ï¼Œå³å°†è¾“å‡ºçš„å€¼å–ä¸ºä¸ä¹‹æœ€æ¥è¿‘çš„æ•´æ•°å€¼ã€‚<br>åˆç†é€‰æ‹©é‡åŒ–ç³»æ•°ï¼Œå¯¹å˜æ¢åçš„å›¾åƒå—è¿›è¡Œé‡åŒ–åçš„ç»“æœå¦‚å›¾æ‰€ç¤ºã€‚<br><img src="http://img.blog.csdn.net/20140602173723046?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGVpeGlhb2h1YTEwMjA=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="è¯·è¾“å…¥å›¾ç‰‡æè¿°"></p>
<p>DCTç³»æ•°é‡åŒ–åå¤§éƒ¨åˆ†ä¸ºå˜ä¸º0ï¼Œå°†å°‘éƒ¨åˆ†é0å€¼è¿›è¡Œå‹ç¼©ç¼–ç å³å¯ã€‚</p>
<h3 id="ç†µç¼–ç "><a href="#ç†µç¼–ç " class="headerlink" title="ç†µç¼–ç "></a>ç†µç¼–ç </h3><p> å¤šç”¨å¯å˜å­—é•¿ç¼–ç (VLC) å®ç°<br>åŸºæœ¬åŸç†æ˜¯å¯¹ä¿¡æºä¸­<strong>å‡ºç°æ¦‚ç‡å¤§çš„ç¬¦å·èµ‹äºˆçŸ­ç </strong>ï¼Œå¯¹äº<strong>å‡ºç°æ¦‚ç‡å°çš„ç¬¦å·èµ‹äºˆé•¿ç </strong>ï¼Œä»è€Œåœ¨ç»Ÿè®¡ä¸Šè·å¾—è¾ƒçŸ­çš„å¹³å‡ç é•¿ã€‚<br>æ¸¸ç¨‹ç¼–ç <code>[å¸¸ç”¨ï¼Œå‹ç¼©æ•ˆç‡ä¸é«˜ï¼Œä½†ç¼–è§£ç å¿«]</code><br>å‚è€ƒï¼š<a href="http://blog.jobbole.com/79758/" target="_blank" rel="noopener">è®¡ç®—æœºç®—æ³•ï¼šæ•°æ®å‹ç¼©ä¹‹æ¸¸ç¨‹ç¼–ç </a><br>å®ç°ï¼š</p>
<ol>
<li>åœ¨ä¸Šå›¾é‡åŒ–DCTæ—¶å¯¹ç»“æœè¿›è¡Œ<code>Z-å‹æ‰«æ</code>åŒ–ä¸ºä¸€ç»´åºåˆ—(æŒ‰å›¾ç®­å¤´æ–¹å‘)</li>
<li>å°†è¯¥ä¸€ç»´åºåˆ—è¿›è¡Œæ¸¸ç¨‹ç¼–ç </li>
<li>å¯¹ç¼–ç åçš„æ•°æ®å†æ¬¡è¿›è¡ŒVLC ( æ¯”å¦‚ <code>Huffman</code>ç¼–ç <h2 id="ï¼ˆ2ï¼‰På¸§"><a href="#ï¼ˆ2ï¼‰På¸§" class="headerlink" title="ï¼ˆ2ï¼‰På¸§"></a>ï¼ˆ2ï¼‰På¸§</h2>æ’­æ”¾è§£ç æ—¶éœ€è¦ä¾èµ–äºå‰é¢å·²è§£ç çš„å‚è€ƒå¸§<br>éœ€è¦å¸§å­˜å‚¨å™¨ <blockquote>
<p>PS:è§£ç æ—¶å¦‚æœéƒ½ä¾èµ–Iå¸§å°±æ¯”è¾ƒç®€å•ï¼Œä¿å­˜ä¸€ä»½Iå¸§æ•°æ®åˆ°å¸§å­˜å‚¨å™¨å³å¯ï¼Œå¦åˆ™ç”±äºä¸çŸ¥é“å‚è€ƒçš„å“ªä¸€å¸§ éœ€è¦ä¿å­˜GOPé‡Œçš„æ‰€æœ‰I Påˆ°å¸§å­˜å‚¨å™¨</p>
</blockquote>
</li>
</ol>
<p>ç¼–ç æ—¶ç›´æ¥æ‹¿å‰é¢å‚è€ƒå¸§çš„æœªç¼–ç æ•°æ®</p>
<h3 id="è¿åŠ¨é¢„æµ‹"><a href="#è¿åŠ¨é¢„æµ‹" class="headerlink" title="è¿åŠ¨é¢„æµ‹"></a>è¿åŠ¨é¢„æµ‹</h3><p>å°†å‚è€ƒå¸§(P1,å¯ä»¥æ˜¯Iå¸§ä¹Ÿå¯ä»¥æ˜¯På¸§)ï¼Œé¢„æµ‹å¸§(P2,å¾…ç¼–ç çš„På¸§) åˆ†å—(ä¾‹å¦‚å°†å›¾åƒåˆ†å‰²æˆnä¸ª16*16å›¾åƒå—)<br>å®šä¹‰ä¸¤ä¸ªé¢œè‰²çš„è¯¯å·®ä¸ºï¼š</p>
<pre><code>PixelDiff(c1, c2) = (c1- c2) ^ 2</code></pre><p>ä¸¤ä¸ªå›¾åƒå—ä¹‹é—´çš„è¯¯å·®å³16*16ä¸ªPixelDiffçš„sum</p>
<pre><code>int block_diff(const unsigned char b1[16][16], const unsigned char b2[16][16]) { 
    int sum = 0; 
    for (int i = 0; i &lt; 16; i++) { 
         for (int j = 0; j &lt; 16; j++) { 
              int c1 = b1[i][j]; 
              int c2 = b2[i][j]; 
              sum += (c1 â€“ c2) * (c1 â€“ c2); 
         } 
    } 
    return sum; 
}</code></pre><p>P2ä¸­æ¯ä¸€ä¸ªblockæ‰¾å‡ºä¸Šä¸€å¸§ä¸­ç›¸ä¼¼åº¦æœ€é«˜çš„blockåæ ‡ï¼Œå¹¶è®°å½•ä¸‹æ¥<br>åšæ³•å¯ä»¥ç›´æ¥2ä¸ªforå¾ªç¯(æš´åŠ›)<br>å½“ç„¶å®é™…ä¸­ä¸å¯èƒ½è¿™ä¹ˆæš´åŠ›æœç´¢ï¼Œè€Œæ˜¯å›´ç»•P2ä¸­è¯¥blockå¯¹åº”åæ ‡åœ¨P1ä¸­ä½ç½®ä½œä¸ºä¸­å¿ƒï¼Œæ…¢æ…¢å››å‘¨æ‰©æ•£ï¼Œæœç´¢<strong><em>ä¸€å®šæ­¥é•¿,åœ¨ä¸€å®šè¯¯å·®èŒƒå›´å†…çš„å®å—åæ ‡</em></strong>ã€‚<br>æ‰€ä»¥ç»“æœæ˜¯ï¼ŒP2è¿›è¡Œè¿åŠ¨é¢„æµ‹ç¼–ç çš„ç»“æœå°±æ˜¯ä¸€å¤§å †(x,y)çš„åæ ‡ï¼Œä»£è¡¨P2ä¸Šæ¯ä¸ªblockåœ¨ä¸Šä¸€å¸§P1é‡Œé¢æœ€ç›¸ä¼¼çš„ blockçš„ä½ç½®</p>
<h3 id="På¸§ç¼–ç "><a href="#På¸§ç¼–ç " class="headerlink" title="På¸§ç¼–ç "></a>På¸§ç¼–ç </h3><p>åˆšæ‰çš„è¿åŠ¨é¢„æµ‹çŸ¢é‡ï¼ˆä¸€å †blockçš„åæ ‡ï¼‰ï¼Œæˆ‘ä»¬å…ˆç”¨P1æŒ‰ç…§è¿™äº›æ•°æ®æ‹¼å‡‘å‡ºä¸€å¼ ç±»ä¼¼P2çš„æ–°å›¾ç‰‡å«åšP2â€™ï¼Œç„¶ååŒP2ä¸Š<strong>æ¯ä¸ªåƒç´ </strong>åšå‡æ³•ï¼Œå¾—åˆ°ä¸€å¼ ä¿å­˜differçš„å›¾ç‰‡ï¼š</p>
<pre><code>D = (P2 â€“ P2â€²) / 2 </code></pre><p>ç”¨ä¸€ä¸ª <code>8ä½çš„æ•´æ•°(åªå¤Ÿè¡¨ç¤º256ä¸ªæ•°å­—)</code> å¯ä»¥è¡¨ç¤º [-255, 255] ä¹‹é—´çš„è¯¯å·®èŒƒå›´ï¼Œæ­¥é•¿ç²¾åº¦æ˜¯2ã€‚</p>
<blockquote>
<p>å³-2 -3æ˜ å°„åˆ°-1 (1000001) è§£ç æ—¶*2å³å¯</p>
</blockquote>
<p>ç”±äºæ˜¯ <strong>å›¾ç‰‡ç»†èŠ‚çš„ä¿®æ”¹</strong>ï¼Œæ¯”èµ·Iå¸§è¿™ç§ä¸€æ•´å¼ å›¾çš„å›¾ç‰‡ <strong>ç†µè¦ä½å¾ˆå¤š</strong>ï¼Œå çš„ç©ºé—´ä¹Ÿæ¯”è¾ƒå°<br>ç„¶åå°†Dç”¨ç±»ä¼¼äºjpegçš„ç®—æ³•è¿›è¡Œç¼–ç  <strong><code>[DCT+ç†µç¼–ç ]</code></strong><br>æ•…På¸§çš„å®Œæ•´ç¼–ç ä¸ºï¼š</p>
<pre><code>Encode(P2)=è®°å½•P1 blockä½ç½®(x,y)çš„çŸ©é˜µ+ç±»jpegæœ‰æŸå›¾åƒç¼–ç (D)</code></pre><h2 id="ï¼ˆ3ï¼‰GOP"><a href="#ï¼ˆ3ï¼‰GOP" class="headerlink" title="ï¼ˆ3ï¼‰GOP"></a>ï¼ˆ3ï¼‰GOP</h2><p>å®æ—¶ä¼ è¾“æ”¶åˆ°Bå¸§æ— æ³•æ’­æ”¾ï¼Œè¿™é‡Œå°±ä¸ä»‹ç»Bå¸§äº†ï¼Œä¸€èˆ¬ I P å°±è¶³å¤Ÿäº†<br>ä¸€ä¸ªGOPæ˜¯è¿™æ ·çš„ I P1 P2 P3 P4â€¦<br>ä¸€èˆ¬ P1 - Pn éƒ½å‚è€ƒI å°±å¥½äº†ï¼Œ è™½ç„¶å‚è€ƒPå¯ä»¥å¾—åˆ°æ›´é«˜çš„å‹ç¼©ç©ºé—´</p>
<h2 id="ï¼ˆ4ï¼‰è§†é¢‘å®¹å™¨"><a href="#ï¼ˆ4ï¼‰è§†é¢‘å®¹å™¨" class="headerlink" title="ï¼ˆ4ï¼‰è§†é¢‘å®¹å™¨"></a>ï¼ˆ4ï¼‰è§†é¢‘å®¹å™¨</h2><p>mpg è®°å½•è§†é¢‘ä¿¡æ¯ï¼Œæ¯”å¦‚åˆ†è¾¨ç‡ï¼Œå¸§ç‡ï¼Œæ—¶é—´ç´¢å¼•</p>
<h2 id="ï¼ˆ5ï¼‰ä¼˜åŒ–"><a href="#ï¼ˆ5ï¼‰ä¼˜åŒ–" class="headerlink" title="ï¼ˆ5ï¼‰ä¼˜åŒ–"></a>ï¼ˆ5ï¼‰ä¼˜åŒ–</h2><p>ç¼–ç æ•ˆç‡ä¼˜åŒ–ï¼šè¿½æ±‚åŒè´¨é‡ï¼ˆåŒä¿¡å™ªæ¯”ï¼‰ä¸‹æ›´ä½çš„ç ç‡<br>ç¼–ç æ€§èƒ½ä¼˜åŒ–ï¼šè¿½æ±‚åŒæ ·è´¨é‡å’Œç ç‡çš„æƒ…å†µä¸‹ï¼Œæ›´å¿«çš„ç¼–ç é€Ÿåº¦ã€‚</p>
<h1 id="æ··åˆç¼–ç æ¨¡å‹"><a href="#æ··åˆç¼–ç æ¨¡å‹" class="headerlink" title="æ··åˆç¼–ç æ¨¡å‹"></a>æ··åˆç¼–ç æ¨¡å‹</h1><p><img src="http://img.blog.csdn.net/20140602173439593?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGVpeGlhb2h1YTEwMjA=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="è¯·è¾“å…¥å›¾ç‰‡æè¿°"></p>
<p>åº”ç”¨äºMPEG1ï¼ŒMPEG2ï¼ŒH.264ç­‰æ ‡å‡†ä¸­</p>
<h1 id="MPEG1-æ ‡å‡†"><a href="#MPEG1-æ ‡å‡†" class="headerlink" title="MPEG1 æ ‡å‡†"></a>MPEG1 æ ‡å‡†</h1><p>ä¸åˆšåˆšæ‰€è¯´çš„ç®€å•ç¼–ç æ‰€è°“çš„ä¼˜åŒ–ã€‚<br>MPEG1æ˜¯ä¿å­˜çš„æ˜¯YCbCrçš„4:2:2<br>å…³äºYCbCrå¯ä»¥å‚è€ƒ<a href="http://blog.sina.com.cn/s/blog_a85e142101010h8n.html" target="_blank" rel="noopener">RGBã€YUVå’ŒYCbCr</a></p>
<p>å¾…æ›´æ–°ã€‚ã€‚</p>
]]></content>
      <categories>
        <category>æµåª’ä½“</category>
      </categories>
      <tags>
        <tag>HTML</tag>
      </tags>
  </entry>
  <entry>
    <title>adbæ§åˆ¶avd</title>
    <url>/2016/07/13/2016-2017%E7%9B%B4%E6%92%AD%E7%9B%B8%E5%85%B3/adb%E6%8E%A7%E5%88%B6avd/</url>
    <content><![CDATA[<h2 id="1-æ˜¾ç¤ºæ‰€æœ‰avd"><a href="#1-æ˜¾ç¤ºæ‰€æœ‰avd" class="headerlink" title="1.æ˜¾ç¤ºæ‰€æœ‰avd"></a>1.æ˜¾ç¤ºæ‰€æœ‰avd</h2><a id="more"></a>

<pre><code>android list avd
ç¤ºä¾‹è¾“å‡º
Available Android Virtual Devices:
    Name: Nexus_5_API_23
  Device: Nexus 5 (Google)
    Path: C:\Users\zhengjx\.android\avd\Nexus_5_API_23.avd
  Target: Android 6.0 (API level 23)
 Tag/ABI: google_apis/x86_64
    Skin: nexus_5
  Sdcard: 100M
---------
    Name: Nexus_6
  Device: Nexus 6 (Google)
    Path: C:\Users\zhengjx\.android\avd\Nexus_6.avd
  Target: Android 6.0 (API level 23)
 Tag/ABI: google_apis/x86
    Skin: nexus_6
  Sdcard: 100M</code></pre><!--more-->


<h2 id="2-å¯åŠ¨æ¨¡æ‹Ÿå™¨ï¼š"><a href="#2-å¯åŠ¨æ¨¡æ‹Ÿå™¨ï¼š" class="headerlink" title="2.å¯åŠ¨æ¨¡æ‹Ÿå™¨ï¼š"></a>2.å¯åŠ¨æ¨¡æ‹Ÿå™¨ï¼š</h2><pre><code>emulator -avd æ¨¡æ‹Ÿå™¨åç§°   
ç¤ºä¾‹
emulator -avd Nexus_6
å¼€å§‹è¯¥æ¨¡æ‹Ÿå™¨åcmdçª—å£å µå¡
æ­¤æ—¶å¯å¦å¼€å¯ä¸€ä¸ªçª—å£æ“ä½œå‘½ä»¤(æ‰‹åŠ¨æƒ…å†µä¸‹)
ps:Ctrl+C å¯å…³é—­è¯¥æ¨¡æ‹Ÿå™¨</code></pre><h2 id="3-æŸ¥çœ‹æ´»åŠ¨çš„avd"><a href="#3-æŸ¥çœ‹æ´»åŠ¨çš„avd" class="headerlink" title="3.æŸ¥çœ‹æ´»åŠ¨çš„avd"></a>3.æŸ¥çœ‹æ´»åŠ¨çš„avd</h2><pre><code>adb devices

ç¤ºä¾‹è¾“å‡º
List of devices attached
emulator-5554   device
HT49NYC00215    device  (è¯¥è®¾å¤‡æ˜¯çœŸæœº)</code></pre><h2 id="4-å¯¹è¯¥avdè¿›è¡Œæ“ä½œ"><a href="#4-å¯¹è¯¥avdè¿›è¡Œæ“ä½œ" class="headerlink" title="4.å¯¹è¯¥avdè¿›è¡Œæ“ä½œ"></a>4.å¯¹è¯¥avdè¿›è¡Œæ“ä½œ</h2><pre><code>avd -s &lt;avdç¼–å·&gt; å‘½ä»¤
ä¾‹ï¼š
adb -s emulator-5554 shell input keyevent 3  //æ¨¡æ‹ŸæŒ‰homeé”®

adb -s emulator-5554 shell input tap 250 250 //æ¨¡æ‹Ÿå•å‡»&lt;x,y&gt;ä½ç½®

adb -s emulator-5554 shell input swipe 250 250 400 400 500//æ¨¡æ‹Ÿæ»‘åŠ¨&lt;p1,p2,æ»‘åŠ¨çš„æ—¶é—´ms&gt;</code></pre><h3 id="é¢˜å¤–è¯"><a href="#é¢˜å¤–è¯" class="headerlink" title="é¢˜å¤–è¯"></a>é¢˜å¤–è¯</h3><p>ffmpeg é€šè¿‡ gdigrab æ— æ³•ç›´æ¥å½•åˆ¶avd</p>
<pre><code>ffmpeg -f gdigrab -i desktop out.mpg</code></pre><p>ç”»é¢æ˜¯é»‘å±çš„ ä¸”å¸¦æœ‰æ‰‹æœºå¤–è§‚ </p>
]]></content>
      <categories>
        <category>Android</category>
      </categories>
      <tags>
        <tag>adb</tag>
      </tags>
  </entry>
  <entry>
    <title>Ubuntu 14ä¸‹ffmpeg2.6ç¼–è¯‘å’Œå‰ªè£(librtmp,h264,aac) åŠAndroidå¼€å‘</title>
    <url>/2016/07/10/2016-2017%E7%9B%B4%E6%92%AD%E7%9B%B8%E5%85%B3/Ubuntu%2014%E4%B8%8Bffmpeg2.6%E7%BC%96%E8%AF%91%E5%92%8C%E5%89%AA%E8%A3%81(librtmp,h264,aac)%20%E5%8F%8AAndroid%E5%BC%80%E5%8F%91/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æœ¬æ¥å†™çš„æ˜¯æœ€æ–°ç‰ˆ3.0çš„ ä½†æ˜¯é‡åˆ°å¤ªå¤šå‘ï¼Œç¼–è¯‘è€é”™ æ¢è€ç‰ˆæœ¬çš„2.6</p>
<h2 id="é…ç½®Javaç¯å¢ƒ"><a href="#é…ç½®Javaç¯å¢ƒ" class="headerlink" title="é…ç½®Javaç¯å¢ƒ"></a>é…ç½®Javaç¯å¢ƒ</h2><p><strong>å¦‚æœåªæ˜¯ç¼–è¯‘ffmpeg è¯¥æ­¥éª¤éå¿…è¦ï¼Œä»…æ˜¯åšä¸ªè®°å½•</strong><br>ä»<a href="http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html" target="_blank" rel="noopener">http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html</a>ä¸‹è½½jdk8</p>
<p>ä¸‹è½½å®Œæ–‡ä»¶é»˜è®¤åœ¨ <code>~/Downloads</code></p>
<a id="more"></a>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">~# cd Downloads</span><br><span class="line">~&#x2F;Downloads# sudo mkdir &#x2F;usr&#x2F;java       &#x2F;&#x2F;åˆ›å»ºç›®å½•ç”¨äºå­˜æ”¾</span><br><span class="line">~&#x2F;Downloads# sudo tar zxvf jdk-8u91-linux-x64.tar.gz -C &#x2F;usr&#x2F;java &#x2F;&#x2F;è§£å‹</span><br><span class="line">~&#x2F;Downloads# cd &#x2F;usr&#x2F;java&#x2F;</span><br><span class="line">&#x2F;usr&#x2F;java# sudo mv jdk-8u91-linux-x64  jdk8  &#x2F;&#x2F;æ”¹å,åé¢é…ç½®å°±æ¯”è¾ƒæ–¹ä¾¿</span><br><span class="line">&#x2F;usr&#x2F;java# sudo gedit &#x2F;etc&#x2F;environment</span><br><span class="line">&#x2F;&#x2F;å¦‚æœå‘ç°é”™è¯¯ï¼Œå¯èƒ½æ˜¯geditçš„å‘½ä»¤(usr&#x2F;bin)æ²¡æ·»åŠ åˆ°ç³»ç»Ÿç¯å¢ƒä¸‹</span><br><span class="line">&#x2F;&#x2F;å¦‚æœä¸èƒ½è®¿é—® å°±chmod 777 &#x2F;etc&#x2F;environment  </span><br><span class="line">&#x2F;&#x2F;å¹¶ä¸”åœ¨environmentä¸­é…ç½®çš„åªæœ‰rootç”¨æˆ·æœ‰æ•ˆ ä¸”å…³é—­ç»ˆç«¯åæ— æ•ˆå› æ­¤é…ç½®åœ¨&#x2F;etc&#x2F;profileæœ€å¥½</span><br><span class="line">&#x2F;&#x2F;å†è¿™é‡Œæˆ‘ä»¬å¯ä»¥ç”¨geditçš„å…¨è·¯å¾„ ä¹Ÿå¯ä»¥ç”¨vim</span><br><span class="line">&#x2F;&#x2F; å…ˆæŒ‰ç…§</span><br><span class="line">sudo apt-get install vim</span><br><span class="line">&#x2F;usr&#x2F;java# sudo vim &#x2F;etc&#x2F;profile</span><br><span class="line">&#x2F;&#x2F;vimå‘½ä»¤ï¼šddåˆ é™¤ä¸€æ · yyå¤åˆ¶ä¸€è¡Œ pç²˜è´´ åœ¨environmentä¸­åŠ å…¥</span><br><span class="line"> export JAVA_HOME&#x3D;&#x2F;usr&#x2F;java&#x2F;jdk8</span><br><span class="line"> export JRE_HOME&#x3D;&#x2F;usr&#x2F;java&#x2F;jdk8&#x2F;jre</span><br><span class="line"> export CLASSPATH&#x3D;.:$JAVA_HOME&#x2F;lib:$JRE_HOME&#x2F;lib:$CLASSPATH</span><br><span class="line"> export PATH&#x3D;$JAVA_HOME&#x2F;bin:$JRE_HOME&#x2F;bin:$PATH</span><br><span class="line"> &gt; ubuntuå¯åŠ¨å å…ˆåŠ è½½environmentå†åŠ è½½profile</span><br><span class="line"> &#x2F;&#x2F;æ³¨æ„ è¦æŒ‰é¡ºåºå†™ æ¯”å¦‚JAVA_HOMEå†™åœ¨åé¢ PATHçš„$JAVA_HOMEå°±æ˜¯ç©ºäº†</span><br><span class="line"> &#x2F;&#x2F;:wq ä¿å­˜é€€å‡º</span><br><span class="line"> æ³¨æ„ è¦é‡å¯ã€‚ä¸”æ³¨æ„è¿™è¾¹é…ç½®è¦å°å¿ƒ å¦åˆ™ä¼šå¼€ä¸äº†æœº</span><br><span class="line"> java -version æŸ¥çœ‹jdkç‰ˆæœ¬ è¾“å‡ºä¿¡æ¯åˆ™æˆåŠŸ</span><br></pre></td></tr></table></figure>

<h2 id="é…ç½®android-linux-NDKä»¥åŠSDK"><a href="#é…ç½®android-linux-NDKä»¥åŠSDK" class="headerlink" title="é…ç½®android linux NDKä»¥åŠSDK"></a>é…ç½®android linux NDKä»¥åŠSDK</h2><p>å¦‚æœåªæ˜¯ç¼–è¯‘ffmpeg åªè¦ä¸‹è½½sdk ndkå¹¶é…ç½®ç¯å¢ƒå°±å¯ä»¥</p>
<h3 id="Android-studio-2-1-download"><a href="#Android-studio-2-1-download" class="headerlink" title="Android studio 2.1 download"></a>Android studio 2.1 download</h3><p>å‚è€ƒï¼š<a href="https://developer.android.com/studio/install.html" target="_blank" rel="noopener">https://developer.android.com/studio/install.html</a><br>ä¸‹è½½<code>android studio 2.1</code><br><a href="https://developer.android.com/studio/index.html" target="_blank" rel="noopener">https://developer.android.com/studio/index.html</a> (æ‹–åˆ°ä¸‹é¢æœ‰å„ç§ç‰ˆæœ¬)</p>
<pre><code>/usr# sudo mkdir android
~/Downloads# unzip xxx.zip -d /usr/android å°†xxxæ–‡ä»¶è§£å‹åˆ°androidç›®å½•ä¸‹</code></pre><p><code>Note</code>: If you are running <code>a 64-bit version of Ubuntu</code>, you need to install some 32-bit libraries with the following command:</p>
<pre><code>sudo apt-get install lib32z1 lib32ncurses5 lib32bz2-1.0 lib32stdc++6</code></pre><p>åˆ©ç”¨<code>/bin/studio.sh</code>å¯ä»¥å¯åŠ¨<code>android-studio</code></p>
<pre><code>Tip: Add android-studio/bin/ to your PATH environment variable so you can start Android Studio from any directory.</code></pre><p>è¿è¡Œ<code>studio.sh</code></p>
<pre><code>`error:`unable to detect graphics environment
xdg_runtime_dir not set in the environment

å‚è€ƒ http://www.cnblogs.com/gaodong/p/3463152.html
åŠ ä¸Š `export DISPLAY=:0.0`</code></pre><p>åˆ‡æ¢åˆ°ç•Œé¢çª—å£<br> æŒ‰æ­¥éª¤å®‰è£… å¯ä»¥é€‰æ‹©ä¹‹å‰ä¸‹å¥½çš„sdk</p>
<p>ç„¶ååˆ›å»º helloworldé¡¹ç›® è¿è¡Œ..ï¼ˆè¯è¯´ï¼ŒçœŸæ˜¯å¡ã€‚ã€‚ï¼‰</p>
<p>è¿˜æ˜¯ç”¨å‘½ä»¤å§..</p>
<h3 id="é…ç½®-sdk-ndk-ç¯å¢ƒå˜é‡"><a href="#é…ç½®-sdk-ndk-ç¯å¢ƒå˜é‡" class="headerlink" title="é…ç½® sdk ndk ç¯å¢ƒå˜é‡"></a>é…ç½® sdk ndk ç¯å¢ƒå˜é‡</h3><p>sdkä¸‹è½½<a href="https://developer.android.com/studio/index.html" target="_blank" rel="noopener">https://developer.android.com/studio/index.html</a> ä¸‹æ–¹<br>ndkä¸‹è½½<a href="https://developer.android.com/ndk/downloads/index.html" target="_blank" rel="noopener">https://developer.android.com/ndk/downloads/index.html</a></p>
<p>ç±»ä¼¼é…ç½®ï¼š<code>PATH=$PATH:/home/android_sdk/tools:/home/android_sdk/ndk</code></p>
<h2 id="ä»ffmpegå®˜ç½‘ä¸‹è½½ffmpegæºç åŒ…"><a href="#ä»ffmpegå®˜ç½‘ä¸‹è½½ffmpegæºç åŒ…" class="headerlink" title="ä»ffmpegå®˜ç½‘ä¸‹è½½ffmpegæºç åŒ…"></a>ä»ffmpegå®˜ç½‘ä¸‹è½½ffmpegæºç åŒ…</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://git.ffmpeg.org/ffmpeg.git ffmpeg</span><br><span class="line"><span class="comment"># æ²¡å®‰è£…gitçš„å…ˆå®‰è£…</span></span><br><span class="line">sudo apt-get install git</span><br></pre></td></tr></table></figure>

<h2 id="ä¿®æ”¹-ffmpeg-configure-æ–‡ä»¶"><a href="#ä¿®æ”¹-ffmpeg-configure-æ–‡ä»¶" class="headerlink" title="ä¿®æ”¹ ffmpeg/configure æ–‡ä»¶"></a>ä¿®æ”¹ ffmpeg/configure æ–‡ä»¶</h2><p>å°†è¯¥æ–‡ä»¶</p>
<pre><code>SLIBNAME_WITH_MAJOR=&apos;$(SLIBNAME).$(LIBMAJOR)&apos;
LIB_INSTALL_EXTRA_CMD=&apos;$$(RANLIB)&quot;$(LIBDIR)/$(LIBNAME)&quot;&apos;
SLIB_INSTALL_NAME=&apos;$(SLIBNAME_WITH_VERSION)&apos;
SLIB_INSTALL_LINKS=&apos;$(SLIBNAME_WITH_MAJOR)$(SLIBNAME)&apos;</code></pre><p>ä¿®æ”¹ä¸ºï¼š</p>
<pre><code>SLIBNAME_WITH_MAJOR=&apos;$(SLIBPREF)$(FULLNAME)-$(LIBMAJOR)$(SLIBSUF)&apos;
LIB_INSTALL_EXTRA_CMD=&apos;$$(RANLIB)&quot;$(LIBDIR)/$(LIBNAME)&quot;&apos;
SLIB_INSTALL_NAME=&apos;$(SLIBNAME_WITH_MAJOR)&apos;
SLIB_INSTALL_LINKS=&apos;$(SLIBNAME)&apos;</code></pre><p>è¿™æ ·ç¼–è¯‘å‡ºæ¥çš„soå‘½åæ‰ç¬¦åˆandroidçš„ä½¿ç”¨</p>
<p>æ¥ä¸‹æ¥è¿™äº›å‚è€ƒï¼š<a href="https://trac.ffmpeg.org/wiki/CompilationGuide/Ubuntu" target="_blank" rel="noopener">https://trac.ffmpeg.org/wiki/CompilationGuide/Ubuntu</a></p>
<h2 id="å®‰è£…ç±»åº“"><a href="#å®‰è£…ç±»åº“" class="headerlink" title="å®‰è£…ç±»åº“"></a>å®‰è£…ç±»åº“</h2><h3 id="å®‰è£…åŸºæœ¬çš„å·¥å…·ç±»åº“"><a href="#å®‰è£…åŸºæœ¬çš„å·¥å…·ç±»åº“" class="headerlink" title="å®‰è£…åŸºæœ¬çš„å·¥å…·ç±»åº“"></a>å®‰è£…åŸºæœ¬çš„å·¥å…·ç±»åº“</h3><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install build-essential checkinstall git libfaac-dev libjack-jackd2-dev   libmp3lame-dev libopencore-amrnb-dev libopencore-amrwb-dev libsdl1.2-dev libtheora-dev    libva-dev libvdpau-dev libvorbis-dev libx11-dev libxfixes-dev texi2html zlib1g-dev       libssl1.0.0 libssl-dev libxvidcore-dev libxvidcore4 libass-dev</span><br></pre></td></tr></table></figure>

<h3 id="Yasm"><a href="#Yasm" class="headerlink" title="Yasm"></a>Yasm</h3><p>ä¸€ä¸ªæ±‡ç¼–ç¨‹åºè¢«æ¨èç”¨äºx264 å’Œ ffmpeg (åªè¦è§£ç ä¸çŸ¥é“è¿™æ ·è¦ä¸è¦è£… è›®è£…äº†<br>å¦‚æœ åº“ä¸­ yasm package â‰¥ 1.2.0 å¯ä»¥è¿™æ ·</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sudo apt-get install yasm</span><br></pre></td></tr></table></figure>

<p>å¦åˆ™åªèƒ½</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/ffmpeg_sources</span><br><span class="line">wget http://www.tortall.net/projects/yasm/releases/yasm-1.3.0.tar.gz</span><br><span class="line">tar xzvf yasm-1.3.0.tar.gz</span><br><span class="line"><span class="built_in">cd</span> yasm-1.3.0</span><br><span class="line">./configure --prefix=<span class="string">"<span class="variable">$HOME</span>/ffmpeg_build"</span> --bindir=<span class="string">"<span class="variable">$HOME</span>/bin"</span></span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line">make distclean</span><br></pre></td></tr></table></figure>
<h3 id="libx264"><a href="#libx264" class="headerlink" title="libx264"></a>libx264</h3><p>æ›´å¤šçš„è¯¦è§<a href="https://trac.ffmpeg.org/wiki/CompilationGuide/Ubuntu" target="_blank" rel="noopener">https://trac.ffmpeg.org/wiki/CompilationGuide/Ubuntu</a><br>æˆ‘åªéœ€è¦è§£ç çš„ è¿™è¾¹æˆ‘å°±ä¸éœ€è¦å®‰è£…äº†</p>
<h3 id="librtmpçš„æ”¯æŒ"><a href="#librtmpçš„æ”¯æŒ" class="headerlink" title="librtmpçš„æ”¯æŒ"></a>librtmpçš„æ”¯æŒ</h3><p>è‡ªå¸¦çš„rtmpåªèƒ½æ”¯æŒæ’­æ”¾éç›´æ’­çš„ <code>rtmp(live !=1)</code>ï¼Œè€Œæ·»åŠ  librtmp ä¹‹åæ˜¯å¯ä»¥æ’­æ”¾ç›´æ’­çš„è§†é¢‘ å¹¶æ”¯æŒå¤šç§æ ¼å¼(rtmp://, rtmpt://, rtmpe://, rtmpte://,ä»¥åŠ rtmps://åè®®)</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/src</span><br><span class="line">git <span class="built_in">clone</span> git://git.ffmpeg.org/rtmpdump</span><br><span class="line"><span class="built_in">cd</span> rtmpdump</span><br><span class="line">make SYS=posix</span><br><span class="line">sudo checkinstall --pkgname=rtmpdump --pkgversion=<span class="string">"2:<span class="variable">$(date +%Y%m%d%H%M)</span>-git"</span> --backup=no  --deldoc=yes --fstrans=no --default</span><br></pre></td></tr></table></figure>

<h3 id="ç¼–è¯‘è„šæœ¬å’Œé…ç½®é€‰é¡¹"><a href="#ç¼–è¯‘è„šæœ¬å’Œé…ç½®é€‰é¡¹" class="headerlink" title="ç¼–è¯‘è„šæœ¬å’Œé…ç½®é€‰é¡¹"></a>ç¼–è¯‘è„šæœ¬å’Œé…ç½®é€‰é¡¹</h3><p>å‚è€ƒ<a href="https://github.com/dxjia/ffmpeg-compile-shared-library-for-android" target="_blank" rel="noopener">https://github.com/dxjia/ffmpeg-compile-shared-library-for-android</a></p>
<ol>
<li><p>æŒ‡å®šä¸´æ—¶ç›®å½•</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">export</span> TMPDIR=/home/gahing/tmpdir</span><br></pre></td></tr></table></figure>
</li>
<li><p>æŒ‡å®šNDKè·¯å¾„</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">NDK&#x3D;&#x2F;home&#x2F;Downloads&#x2F;android-linux-sdk&#x2F;android-ndk-r12b</span><br></pre></td></tr></table></figure>
</li>
<li><p>æŒ‡å®šä½¿ç”¨NDK Platformç‰ˆæœ¬</p>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">SYSROOT&#x3D;$NDK&#x2F;platforms&#x2F;android-16&#x2F;arch-arm&#x2F;</span><br></pre></td></tr></table></figure>

<p>ä¸€å®šè¦é€‰æ‹©æ¯”ä½ çš„ç›®æ ‡æœºå™¨ä½¿ç”¨çš„ç‰ˆæœ¬ä½çš„</p>
<ol start="4">
<li>æŒ‡å®šç¼–è¯‘å·¥å…·é“¾</li>
</ol>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">TOOLCHAIN&#x3D;$ND</span><br><span class="line">K&#x2F;toolchains&#x2F;arm-linux-androideabi-4.9&#x2F;prebuilt&#x2F;linux-x86_64</span><br></pre></td></tr></table></figure>
<ol start="5">
<li>æŒ‡å®šç¼–è¯‘åçš„å®‰è£…ç›®å½•</li>
</ol>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">PREFIX&#x3D;&#x2F;home&#x2F;gahing&#x2F;ffmpeg_shared_compile&#x2F;arm</span><br></pre></td></tr></table></figure>

<p>ç¤ºä¾‹è„šæœ¬1 æ”¯æŒæ‰€æœ‰çš„ç¼–è§£ç å™¨ armç‰ˆæœ¬</p>
<p>#!/bin/bash<br>export TMPDIR=/home/gahing/tmpdir<br>PREFIX=$HOME/ffmpeg_shared_compile/<br>NDK=/home/gahing/Downloads/android-sdk-linux/android-ndk-r12b<br>SYSROOT=$NDK/platforms/android-16/arch-arm/<br>TOOLCHAIN=$NDK/toolchains/arm-linux-androideabi-4.9/prebuilt/linux-x86_64<br>CPU=arm<br>ADDI_CFLAGS=â€-marmâ€<br>function build_one<br>{<br>./configure <br>â€“prefix=$PREFIX <br>â€“enable-shared <br>â€“disable-static <br>â€“disable-doc <br>â€“disable-ffmpeg <br>â€“disable-ffplay <br>â€“disable-ffprobe <br>â€“disable-ffserver <br>â€“disable-doc <br>â€“disable-symver <br>â€“enable-small <br>â€“cross-prefix=$TOOLCHAIN/bin/arm-linux-androideabi- <br>â€“target-os=linux <br>â€“arch=arm <br>â€“enable-cross-compile <br>â€“sysroot=$SYSROOT <br>â€“extra-cflags=â€-Os -fpic $ADDI_CFLAGSâ€ <br>â€“extra-ldflags=â€$ADDI_LDFLAGSâ€ <br>$ADDITIONAL_CONFIGURE_FLAG<br>make clean<br>make<br>make install<br>}<br>build_one</p>
<p>soçš„å…¨éƒ¨æ–‡ä»¶å¤§æ¦‚8~9M</p>
<p>ç¤ºä¾‹è„šæœ¬2 æœ¬ç« é¢˜ç›®çš„è¦æ±‚ï¼ˆè¯¥è„šæœ¬æœ‰é—®é¢˜ å¾…è§£æ•‘ï¼‰</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">make clean</span><br><span class="line"><span class="built_in">export</span> TMPDIR=/home/gahing/tmpdir</span><br><span class="line">PREFIX=<span class="variable">$HOME</span>/ffmpeg_shared_compile/</span><br><span class="line">NDK=/home/gahing/Downloads/android-sdk-linux/android-ndk-r12b</span><br><span class="line">SYSROOT=<span class="variable">$NDK</span>/platforms/android-16/arch-arm/</span><br><span class="line">TOOLCHAIN=<span class="variable">$NDK</span>/toolchains/arm-linux-androideabi-4.9/prebuilt/linux-x86_64</span><br><span class="line">CPU=arm</span><br><span class="line">ADDI_CFLAGS=<span class="string">"-marm"</span></span><br><span class="line"><span class="keyword">function</span> build_one</span><br><span class="line">&#123;</span><br><span class="line">./configure \</span><br><span class="line">--prefix=<span class="variable">$PREFIX</span> \</span><br><span class="line">--<span class="built_in">enable</span>-shared \</span><br><span class="line">--<span class="built_in">disable</span>-static \</span><br><span class="line">--<span class="built_in">disable</span>-avdevice \</span><br><span class="line">--<span class="built_in">disable</span>-avfilter \</span><br><span class="line">--<span class="built_in">disable</span>-network \</span><br><span class="line">--<span class="built_in">disable</span>-encoders \</span><br><span class="line">--<span class="built_in">disable</span>-doc \</span><br><span class="line">--<span class="built_in">disable</span>-ffmpeg \</span><br><span class="line">--<span class="built_in">disable</span>-ffplay \</span><br><span class="line">--<span class="built_in">disable</span>-ffprobe \</span><br><span class="line">--<span class="built_in">disable</span>-ffserver \</span><br><span class="line">--<span class="built_in">disable</span>-doc \</span><br><span class="line">--<span class="built_in">disable</span>-symver \</span><br><span class="line">--<span class="built_in">disable</span>-muxers \</span><br><span class="line">--<span class="built_in">disable</span>-demuxers \</span><br><span class="line">--<span class="built_in">disable</span>-debug  \</span><br><span class="line">--<span class="built_in">disable</span>-yasm \</span><br><span class="line">--<span class="built_in">disable</span>-parsers \</span><br><span class="line">--<span class="built_in">disable</span>-decoders \</span><br><span class="line">--<span class="built_in">disable</span>-everything \</span><br><span class="line">--<span class="built_in">enable</span>-nonfree \</span><br><span class="line">--<span class="built_in">enable</span>-gpl  \</span><br><span class="line">--<span class="built_in">enable</span>-postproc  \</span><br><span class="line">--<span class="built_in">enable</span>-vdpau \</span><br><span class="line">--<span class="built_in">enable</span>-librtmp \</span><br><span class="line">--<span class="built_in">enable</span>-decoder=h264 \</span><br><span class="line">--<span class="built_in">enable</span>-decoder=aac  \</span><br><span class="line">--<span class="built_in">enable</span>-decoder=h264_vdpau\</span><br><span class="line">--<span class="built_in">enable</span>-parser=aac \</span><br><span class="line">--<span class="built_in">enable</span>-parser=h264 \</span><br><span class="line">--<span class="built_in">enable</span>-protocol=rtmp \</span><br><span class="line">--<span class="built_in">enable</span>-small \</span><br><span class="line">--cross-prefix=<span class="variable">$TOOLCHAIN</span>/bin/arm-linux-androideabi- \</span><br><span class="line">--target-os=linux \</span><br><span class="line">--arch=arm \</span><br><span class="line">--<span class="built_in">enable</span>-cross-compile \</span><br><span class="line">--sysroot=<span class="variable">$SYSROOT</span> \</span><br><span class="line">--extra-cflags=<span class="string">"-Os -fpic <span class="variable">$ADDI_CFLAGS</span>"</span> \</span><br><span class="line">--extra-ldflags=<span class="string">"<span class="variable">$ADDI_LDFLAGS</span>"</span> \</span><br><span class="line"><span class="variable">$ADDITIONAL_CONFIGURE_FLAG</span>  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line">build_one  </span><br><span class="line">  </span><br><span class="line">make  </span><br><span class="line">make install</span><br></pre></td></tr></table></figure>



<ol start="6">
<li>ç”Ÿæˆso</li>
</ol>
<p>è¿è¡Œè„šæœ¬å <code>$PREFIX</code> ç›®å½•ä¸‹ç”Ÿæˆ includeå’Œlibä¸¤ä¸ªæ–‡ä»¶å¤¹ï¼Œå°†libæ–‡ä»¶å¤¹ä¸­çš„ pkgconfig ç›®å½•å’Œsoçš„é“¾æ¥æ–‡ä»¶åˆ é™¤ï¼Œåªä¿ç•™soæ–‡ä»¶ï¼Œç„¶åå°†include å’Œlibä¸¤ä¸ªç›®å½•ä¸€èµ·copyåˆ°ä½ çš„apk jniä¸‹å»ç¼–è¯‘</p>
<p>ä¹‹åå¯ä»¥å‚è€ƒ<br><a href="http://blog.csdn.net/leixiaohua1020/article/details/47008825" target="_blank" rel="noopener">http://blog.csdn.net/leixiaohua1020/article/details/47008825</a></p>
<p>eclipseä¸‹ç¼–å†™jniå‚è€ƒ<a href="http://www.cnblogs.com/skyseraph/p/3979238.html" target="_blank" rel="noopener">http://www.cnblogs.com/skyseraph/p/3979238.html</a></p>
]]></content>
      <categories>
        <category>æµåª’ä½“</category>
      </categories>
      <tags>
        <tag>ffmpeg</tag>
        <tag>Android</tag>
      </tags>
  </entry>
  <entry>
    <title>Androidå¼€å‘æŠ€å·§</title>
    <url>/2016/04/13/2016-2017%E7%9B%B4%E6%92%AD%E7%9B%B8%E5%85%B3/Android%E5%BC%80%E5%8F%91%E6%8A%80%E5%B7%A7/</url>
    <content><![CDATA[<h2 id="å•æ­¥è°ƒè¯•"><a href="#å•æ­¥è°ƒè¯•" class="headerlink" title="å•æ­¥è°ƒè¯•"></a>å•æ­¥è°ƒè¯•</h2><p><code>F6</code> <code>Step Over</code> ç¨‹åºå‘ä¸‹æ‰§è¡Œä¸€è¡Œï¼ˆå¦‚æœå½“å‰è¡Œæœ‰æ–¹æ³•è°ƒç”¨ï¼Œä¸è¿›å…¥æ–¹æ³•ä½“ï¼Œç›´æ¥åˆ°ä¸‹ä¸€è¡Œï¼‰</p>
<p><code>F5</code> <code>Step Into</code> ç¨‹åºå‘ä¸‹æ‰§è¡Œä¸€è¡Œï¼ˆå¦‚æœè¯¥è¡Œæœ‰è‡ªå®šä¹‰æ–¹æ³•ï¼Œåˆ™è¿è¡Œè¿›å…¥è‡ªå®šä¹‰æ–¹æ³•ï¼ˆä¸ä¼šè¿›å…¥å®˜æ–¹ç±»åº“çš„æ–¹æ³•ï¼‰ä¼šè¿›å…¥Logæ–¹æ³•ï¼Œç®—æ˜¯bugå—ï¼Ÿ</p>
<p><code>Alt+Shift+F7</code>  <code>Force Step Into</code> ä»»ä½•æ–¹æ³•éƒ½ä¼šè¿›å…¥</p>
<p><code>F7</code> <code>Step Out</code>  è·³å‡ºå½“å‰æ–¹æ³•ï¼Œè¿”å›åˆ°è¯¥æ–¹æ³•è¢«è°ƒç”¨å¤„çš„ä¸‹ä¸€è¡Œè¯­å¥ã€‚tips:å¾ªç¯ä»£ç æ®µï¼Œæ‰§è¡ŒStep Outå°†è·³è¿‡ä¸€æ¬¡å¾ªç¯.</p>
<p><code>Ctrl + R</code> <code>Run to Cursor</code> ç›´æ¥åˆ°å…‰æ ‡å¤„</p>
<p><code>Drop Frame</code> è¿”å›å½“å‰æ–¹æ³•çš„è°ƒç”¨å¤„é‡æ–°æ‰§è¡Œï¼Œä¸Šä¸‹æ–‡å˜é‡ä¹Ÿæ¢å¤å¦‚åˆã€‚æœªæµ‹è¯•è¿‡..</p>
<a id="more"></a>

<h2 id="é«˜çº§è°ƒè¯•"><a href="#é«˜çº§è°ƒè¯•" class="headerlink" title="é«˜çº§è°ƒè¯•"></a>é«˜çº§è°ƒè¯•</h2><h3 id="è·¨æ–­ç‚¹"><a href="#è·¨æ–­ç‚¹" class="headerlink" title="è·¨æ–­ç‚¹"></a>è·¨æ–­ç‚¹</h3><p>ç‚¹å‡»å³ä¸‰è§’æŒ‰é’®(Resume Program) <code>F8</code> ,è¿›å…¥ä¸‹ä¸€æ–­ç‚¹ã€‚ï¼ˆä¸¤æ–­ç‚¹é—´ä»£ç å·²æ‰§è¡Œå®Œæ¯•</p>
<p>æ³¨ï¼šæ–­ç‚¹æ‰“åœ¨å¾ªç¯ä¸Šçš„è¯ï¼Œä¸‹ä¸€æ–­ç‚¹è¿˜æ˜¯å¾ªç¯ä½“</p>
<h3 id="è®¾ç½®å˜é‡å€¼"><a href="#è®¾ç½®å˜é‡å€¼" class="headerlink" title="è®¾ç½®å˜é‡å€¼"></a>è®¾ç½®å˜é‡å€¼</h3><p>å˜é‡å³é”® set value</p>
<h3 id="æŸ¥çœ‹æ–­ç‚¹View-BreakPoints-Ctrl-Shift-F8"><a href="#æŸ¥çœ‹æ–­ç‚¹View-BreakPoints-Ctrl-Shift-F8" class="headerlink" title="æŸ¥çœ‹æ–­ç‚¹View BreakPoints Ctrl+Shift_F8"></a>æŸ¥çœ‹æ–­ç‚¹<code>View BreakPoints</code> <code>Ctrl+Shift_F8</code></h3><p>ä¸¤ä¸ªé‡å åœˆçš„æŒ‰é’®ï¼Œå¼¹å‡ºä¸€ä¸ªç•Œé¢.</p>
<p>å¯ä»¥è®¾ç½®æ¡ä»¶æ–­ç‚¹ æ»¡è¶³æ¡ä»¶æ—¶æš‚åœç¨‹åºè¿è¡Œ.</p>
<p>è¯¥åšæ³•æ›´çµæ´»ï¼Œå®šä½å¿«ã€‚</p>
<h2 id="Log"><a href="#Log" class="headerlink" title="Log"></a>Log</h2><p>logt : TAG<br>logm : å¸¦æ–¹æ³•ã€å‚æ•°çš„Log.d<br>logd : å¸¦æ–¹æ³•çš„Log.d</p>
<p>##AS é¡¹ç›®ç»“æ„</p>
<p><code>*.iml</code>æ–‡ä»¶ asé¡¹ç›®ç»“æ„çš„é…ç½®æ–‡ä»¶</p>
<p>project :demo ä¸æ­¤åŒæ—¶å®ƒä¹Ÿæ˜¯ä¸€ä¸ªè·Ÿmodule æ‰€ä»¥åœ¨æ ¹è·¯å¾„ä¸‹ç‚¹make module ä¼šæœ‰demoå’Œå­module</p>
<p>module : é»˜è®¤app å¯æ·»åŠ å¤šä¸ªï¼Œä¸€èˆ¬ä¸€ä¸ªä¸»å·¥ç¨‹ å…¶ä»–çš„ä¸ºsdk</p>
<h2 id="SVN-ä½¿ç”¨"><a href="#SVN-ä½¿ç”¨" class="headerlink" title="SVN ä½¿ç”¨"></a>SVN ä½¿ç”¨</h2><p>å–æ¶ˆä¸SVNçš„å…³è”/æ‰¾ä¸åˆ°Share Project(Subversion)</p>
<p>åœ¨Projectæ¨¡å¼ä¸‹æœ‰ä¸ª.ideaæ–‡ä»¶å¤¹,æ‰¾åˆ°vcs.xmlæ–‡ä»¶,æŠŠé‡Œé¢çš„vcs=â€svnâ€æ”¹ä¸ºvcs=â€â€å³å¯ã€‚</p>
<h2 id="SVN-è®¾ç½®è¿‡æ»¤"><a href="#SVN-è®¾ç½®è¿‡æ»¤" class="headerlink" title="SVN è®¾ç½®è¿‡æ»¤"></a>SVN è®¾ç½®è¿‡æ»¤</h2><p>æ–¹æ³•ä¸€ã€åœ¨é¡¹ç›®çš„.idea/workspace.xmlçš„æ–‡ä»¶é‡Œè®¾ç½®</p>
<?xml version="1.0" encoding="UTF-8"?><p><br>    <project><br>        <component name="ChangeListManager"><br>            â€¦<br>        <ignored path=".gradle/" /><br>        <ignored path=".idea/" /><br>        <ignored path="gradle/" /><br>        <ignored path="é¡¹ç›®å/build/" /><br>        <ignored path="gradlew" /><br>        <ignored path="gradlew.bat" /><br>        <ignored mask="*.iml" /><br>        <ignored path="local.properties" /><br>        <ignored path="build/" /><br>        <ignored mask="*.apk" /><br>        </component><br>        â€¦<br>    </project>  </p>
<p>ç™½è‰²ä¸»é¢˜çš„ï¼šé»„è‰²è¡¨ç¤ºè¢«è¿‡æ»¤ ç»¿è‰²ä¸ºæœªè¿‡æ»¤</p>
<h2 id="Mark-Resolved"><a href="#Mark-Resolved" class="headerlink" title="Mark Resolved"></a>Mark Resolved</h2><p>å‡ºç°å†²çªåï¼Œæˆ‘æ–¹ä¸èƒ½æäº¤ï¼Œæ­¤æ—¶åªè¦å°†å†²çªæ–‡ä»¶æ ‡è®°è§£å†³å†²çªåï¼Œå³å¯æäº¤</p>
<h2 id="ç‰ˆæœ¬æ§åˆ¶è‡ªåŠ¨add-å¯ä»¥å†settingé‡Œè®¾ç½®"><a href="#ç‰ˆæœ¬æ§åˆ¶è‡ªåŠ¨add-å¯ä»¥å†settingé‡Œè®¾ç½®" class="headerlink" title="ç‰ˆæœ¬æ§åˆ¶è‡ªåŠ¨add å¯ä»¥å†settingé‡Œè®¾ç½®"></a>ç‰ˆæœ¬æ§åˆ¶è‡ªåŠ¨add å¯ä»¥å†settingé‡Œè®¾ç½®</h2><p>ç›®å‰å‘ç°commitå°±ç›´æ¥pushåˆ°è¿œç«¯svnäº† è€Œä¸æ˜¯ ç­‰å¸Œæœ›push commitsçš„æ—¶å€™å†push</p>
<p>å¾…è§£å†³</p>
<h2 id="è·å–å½“å‰åº”ç”¨çš„æ–¹å‘"><a href="#è·å–å½“å‰åº”ç”¨çš„æ–¹å‘" class="headerlink" title="è·å–å½“å‰åº”ç”¨çš„æ–¹å‘"></a>è·å–å½“å‰åº”ç”¨çš„æ–¹å‘</h2><p>å¼€ä¸ªservice,å®šæ—¶å»è·å–æˆ–æŒ‰éœ€è·å–</p>
<pre><code>int screenWidth = getWindowManager().getDefaultDisplay().getWidth();
                    int screenHeight = getWindowManager().getDefaultDisplay().getHeight();
                    Log.d(&quot;ori&quot;, &quot;now the screen width is :&quot; + screenWidth + &quot;screen height is:&quot; + screenHeight);
                    if(screenWidth&gt;screenHeight){
                        Log.d(&quot;ori&quot;, &quot;æ¨ªå± &quot;);
                    }else{
                        Log.d(&quot;ori&quot;, &quot;ç«–å± &quot;);
                    }</code></pre><h2 id="ç¦æ­¢çŠ¶æ€æ ä¸‹æ‹‰å’Œå¯¼èˆªæ ä¸Šæ‹‰"><a href="#ç¦æ­¢çŠ¶æ€æ ä¸‹æ‹‰å’Œå¯¼èˆªæ ä¸Šæ‹‰" class="headerlink" title="ç¦æ­¢çŠ¶æ€æ ä¸‹æ‹‰å’Œå¯¼èˆªæ ä¸Šæ‹‰"></a>ç¦æ­¢çŠ¶æ€æ ä¸‹æ‹‰å’Œå¯¼èˆªæ ä¸Šæ‹‰</h2><p>è§ <code>Androidæ¨¡æ‹Ÿè§¦æ§è§£å†³æ–¹æ¡ˆ.md</code></p>
<h2 id="soåŒ…å’ŒAndroidç³»ç»Ÿ"><a href="#soåŒ…å’ŒAndroidç³»ç»Ÿ" class="headerlink" title="soåŒ…å’ŒAndroidç³»ç»Ÿ"></a>soåŒ…å’ŒAndroidç³»ç»Ÿ</h2><p><a href="http://www.jianshu.com/p/cb05698a1968" target="_blank" rel="noopener">http://www.jianshu.com/p/cb05698a1968</a></p>
<h2 id="Inflateä½¿ç”¨"><a href="#Inflateä½¿ç”¨" class="headerlink" title="Inflateä½¿ç”¨"></a>Inflateä½¿ç”¨</h2><p><a href="http://www.sxt.cn/info-9373-u-14124.html" target="_blank" rel="noopener">http://www.sxt.cn/info-9373-u-14124.html</a></p>
]]></content>
      <categories>
        <category>Android</category>
      </categories>
  </entry>
</search>
